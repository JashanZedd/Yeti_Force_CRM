'use strict';

var Vtiger_PBXManager_Js={registerPBXCall:function registerPBXCall(){Vtiger_PBXManager_Js.requestPBXgetCalls();},registerPBXOutboundCall:function registerPBXOutboundCall(number,record){Vtiger_PBXManager_Js.makeOutboundCall(number,record);},requestPBXgetCalls:function requestPBXgetCalls(){AppConnector.request('index.php?module=PBXManager&action=IncomingCallPoll&mode=searchIncomingCalls').done(function(data){if(data.success&&data.result)for(i=0;i<data.result.length;i++){var record=data.result[i];0==jQuery('#pbxcall_'+record.pbxmanagerid+'').size()?Vtiger_PBXManager_Js.showPBXIncomingCallPopup(record):Vtiger_PBXManager_Js.updatePBXIncomingCallPopup(record);}}),Vtiger_PBXManager_Js.removeCompletedCallPopup();},showPBXIncomingCallPopup:function showPBXIncomingCallPopup(record){var params={title:app.vtranslate('JS_PBX_INCOMING_CALL'),text:'<div class="row pbxcall" id="pbxcall_'+record.pbxmanagerid+'" callid='+record.pbxmanagerid+' style="color:black"><span class="col-md-12" id="caller"value="'+record.customernumber+'">'+app.vtranslate('JS_PBX_CALL_FROM')+' : '+record.customernumber+'</span><span class="d-none col-md-12" id="contactsave_'+record.pbxmanagerid+'"><span><input class="col-md-3" id="email_'+record.pbxmanagerid+'" type="text" placeholder="Enter Email-id"></input>&nbsp;&nbsp;&nbsp;<select class="input-small" id="module_'+record.pbxmanagerid+'"placeholder="Select"><option>Select</option></select><h5 class="alert-danger d-none col-md-3"id="alert_msg">'+app.vtranslate('JS_PBX_FILL_ALL_FIELDS')+'</h5><button class="btn btn-success pull-right"  id="pbxcontactsave_'+record.pbxmanagerid+'" recordid="'+record.pbxmanagerid+'" type="submit">Save</button></span></span><br /><span class="col-md-12" style="display:none" id="answeredby"><i class="icon-headphones"></i>&nbsp;<span id="answeredbyname"></span></span></div>',width:'28%',min_height:'75px',addclass:'vtCall',icon:'vtCall-icon',hide:!1,closer:!0,type:'info',after_open:function after_open(p){jQuery(p).data('info',record);}};Vtiger_Helper_Js.showPnotify(params),record.user&&record.user!=record.current_user_id&&Vtiger_PBXManager_Js.removeCallPopup(record.pbxmanagerid),Vtiger_PBXManager_Js.checkIfRelatedModuleRecordExist(record),null!=record.answeredby&&(jQuery('#answeredbyname','#pbxcall_'+record.pbxmanagerid+'').text(record.answeredby),jQuery('#answeredby','#pbxcall_'+record.pbxmanagerid+'').show()),jQuery('#pbxcontactsave_'+record.pbxmanagerid+'').bind('click',function(e){var pbxmanagerid=jQuery(e.currentTarget).attr('recordid');return 'Select'==jQuery('#module_'+pbxmanagerid+'').val()?(jQuery('#alert_msg').show(),!1):''==jQuery('#email_'+pbxmanagerid+'').val()?(jQuery('#alert_msg').show(),!1):void(Vtiger_PBXManager_Js.createRecord(e,record),jQuery('#pbxcontactsave_'+record.pbxmanagerid+'').unbind('click'))});},createRecord:function createRecord(e,record){var pbxmanagerid=jQuery(e.currentTarget).attr('recordid'),email=jQuery('#email_'+pbxmanagerid+'').val(),moduleName=jQuery('#module_'+pbxmanagerid+'').val(),number=jQuery('#caller','#pbxcall_'+pbxmanagerid+'').attr('value'),url='index.php?module=PBXManager&action=IncomingCallPoll&mode=createRecord&number='+encodeURIComponent(number)+'&email='+encodeURIComponent(email)+'&callid='+record.sourceuuid+'&modulename='+moduleName;AppConnector.request(url).done(function(data){data.success&&data.result&&jQuery('#contactsave_'+pbxmanagerid+'').hide();});},checkIfRelatedModuleRecordExist:function checkIfRelatedModuleRecordExist(record){if(null===record.callername){AppConnector.request('index.php?module=PBXManager&action=IncomingCallPoll&mode=checkModuleViewPermission&view=EditView').done(function(data){var newEle,responsedata=JSON.parse(data),showSaveOption=!1,moduleList=responsedata.result.modules,contents=jQuery('#module_'+record.pbxmanagerid+'');for(var module in moduleList)moduleList.hasOwnProperty(module)&&moduleList[module]&&(newEle='<option id="select_'+module+'" value="'+module+'">'+app.vtranslate(module)+'</option>',contents.append(newEle),showSaveOption=!0);responsedata.success&&showSaveOption&&jQuery('#contactsave_'+record.pbxmanagerid+'').show();});}else jQuery('#caller','#pbxcall_'+record.pbxmanagerid+'').html(app.vtranslate('JS_PBX_CALL_FROM')+' :&nbsp;<a href="index.php?module='+record.customertype+'&view=Detail&record='+record.customer+'">'+record.callername+'</a>');},updatePBXIncomingCallPopup:function updatePBXIncomingCallPopup(record){null!=record.answeredby&&(jQuery('#answeredbyname','#pbxcall_'+record.pbxmanagerid+'').text(record.answeredby),jQuery('#answeredby','#pbxcall_'+record.pbxmanagerid+'').show()),null!=record.customer&&''!=record.customer&&(jQuery('#caller','#pbxcall_'+record.pbxmanagerid+'').html(app.vtranslate('JS_PBX_CALL_FROM')+' :&nbsp;<a href="index.php?module='+record.customertype+'&view=Detail&record='+record.customer+'">'+record.callername+'</a>'),jQuery('#contactsave_'+record.pbxmanagerid+'').hide()),record.user&&record.user!=record.current_user_id&&Vtiger_PBXManager_Js.removeCallPopup(record.pbxmanagerid);},removeCompletedCallPopup:function removeCompletedCallPopup(){for(var callid=null,pbxcall=jQuery('.pbxcall'),i=0;i<pbxcall.length;i++){callid=pbxcall[i].getAttribute('callid');var url='index.php?module=PBXManager&action=IncomingCallPoll&mode=getCallStatus&callid='+encodeURIComponent(callid)+'';AppConnector.request(url).done(function(data){data.result&&'in-progress'!=data.result&&'ringing'!=data.result&&Vtiger_PBXManager_Js.removeCallPopup(callid);});}},removeCallPopup:function removeCallPopup(callid){jQuery('#pbxcall_'+callid+'').parent().parent().parent().remove();},getContentHolder:function getContentHolder(view){return 'List'==view?jQuery('.listViewContentDiv'):jQuery('.detailViewContainer')},makeOutboundCall:function makeOutboundCall(number,record){var params={number:number,record:record,module:'PBXManager',action:'OutgoingCall'};AppConnector.request(params).done(function(data){params=data.result?{text:app.vtranslate('JS_PBX_OUTGOING_SUCCESS'),type:'info'}:{text:app.vtranslate('JS_PBX_OUTGOING_FAILURE'),type:'error'},Vtiger_Helper_Js.showPnotify(params);});},registerEvents:function registerEvents(){AppConnector.request('index.php?module=PBXManager&action=IncomingCallPoll&mode=checkPermissionForPolling').done(function(data){data.result&&(Vtiger_PBXManager_Js.registerPBXCall(),setInterval('Vtiger_PBXManager_Js.registerPBXCall()',3e3));});}};jQuery(document).ready(function(){Vtiger_PBXManager_Js.registerEvents();});
//# sourceMappingURL=PBXManagerJS.min.js.map
