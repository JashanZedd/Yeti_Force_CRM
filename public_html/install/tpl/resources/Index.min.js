
jQuery.Class("Install_Index_Js",{fieldsCached:["db_hostname","db_username","db_name","create_db","db_root_username","currency_name","firstname","lastname","admin_email","dateformat","timezone"],checkUsername:function(e,r,t,a){var n=jQuery.parseJSON(jQuery("#not_allowed_logins").val());if(-1!==jQuery.inArray(e.val(),n))return app.vtranslate("LBL_INVALID_USERNAME_ERROR")}},{registerEventForStep1:function(){jQuery(".bt_install").on("click",function(e){jQuery('input[name="mode"]').val("step2"),jQuery('form[name="step1"]').submit()}),jQuery(".bt_migrate").on("click",function(e){jQuery('input[name="mode"]').val("mStep0"),jQuery('form[name="step1"]').submit()})},registerEventForStep3:function(){jQuery("#recheck").on("click",function(){window.location.reload()}),jQuery('input[name="step4"]').on("click",function(e){if(jQuery(".no").length>0){var r=app.vtranslate("LBL_PHP_WARNING");return!!confirm(r)&&(jQuery('form[name="step3"]').submit(),!0)}jQuery('form[name="step3"]').submit()})},checkPwdEvent:function(){var e=this;jQuery('input[name="password"]').on("blur",function(){e.checkPwd(jQuery(this).val())})},checkPwd:function(e){var r=!1;return e.length<8?(jQuery("#passwordError").html(app.vtranslate("LBL_PASS_TO_SHORT")),r=!0):e.length>32?(jQuery("#passwordError").html(app.vtranslate("LBL_PASS_TO_LONG")),r=!0):-1==e.search(/\d/)?(jQuery("#passwordError").html(app.vtranslate("LBL_PASS_NO_NUM")),r=!0):-1==e.search(/[A-Z]/)?(jQuery("#passwordError").html(app.vtranslate("LBL_PASS_LACK_OF_CAPITAL_LETTERS")),r=!0):-1==e.search(/[a-z]/)&&(jQuery("#passwordError").html(app.vtranslate("LBL_PASS_LACK_OF_LOWERCASE_LETTERS")),r=!0),r},registerEventForStep4:function(){var e=JSON.parse(localStorage.getItem("yetiforce_install"));Install_Index_Js.fieldsCached.forEach(function(r){if(e&&void 0!==e[r]){var t=jQuery('[name="'+r+'"]');"SELECT"==jQuery(t).prop("tagName")?(jQuery(t).val(e[r]),jQuery(t).select2("destroy"),jQuery(t).select2()):"INPUT"==jQuery(t).prop("tagName")&&"checkbox"==jQuery(t).attr("type")?1==e[r]&&(jQuery(t).prop("checked",!0),jQuery(".config-table tr.d-none").removeClass("d-none")):jQuery(t).val(e[r])}});var r=this;function t(){jQuery("#passwordError").html("")}jQuery('input[name="create_db"]').on("click",function(){var e=jQuery("#root_user"),r=jQuery("#root_password");jQuery(this).is(":checked")?(e.removeClass("d-none"),r.removeClass("d-none")):(e.addClass("d-none"),r.addClass("d-none"))}),jQuery('input[name="retype_password"]').on("blur",function(e){var r=jQuery(e.currentTarget);jQuery('input[name="password"]').val()!==r.val()&&jQuery("#passwordError").html(app.vtranslate("LBL_PASS_REENTER_ERROR"))}),jQuery('input[name="password"]').on("blur",function(e){var r=jQuery('input[name="retype_password"]');""!=r.val()&&r.val()!==jQuery(e.currentTarget).val()?jQuery("#passwordError").html(app.vtranslate("LBL_PASS_REENTER_ERROR")):t()}),jQuery('input[name="retype_password"]').on("keypress",function(e){t()}),jQuery('input[name="step5"]').on("click",function(){var e=!1,t=["db_hostname","db_username","db_name","password","retype_password","lastname","admin_email"];for(var a in t){var n=jQuery('input[name="'+t[a]+'"]');if(""==n.val()){n.addClass("error").focus(),e=!0;break}n.removeClass("error")}if(jQuery('input[name="create_db"]:checked').length>0){var s=jQuery('input[name="db_root_username"]');""==s.val()?(s.addClass("error").focus(),e=!0):s.removeClass("error")}jQuery("#passwordError").html().trim()&&(e=!0);var o=jQuery('input[name="admin_email"]'),u=!1;/^[_/a-zA-Z0-9*]+([!"#$%&'()*+,./:;<=>?\^_`{|}~-]?[a-zA-Z0-9/_/-])*@[a-zA-Z0-9]+([\_\-\.]?[a-zA-Z0-9]+)*\.([\-\_]?[a-zA-Z0-9])+(\.?[a-zA-Z0-9]+)?$/.test(o.val())||""==o.val()?o.removeClass("error"):(u=!0,o.addClass("error").focus(),e=!0);var i;if((i=r.checkPwd(jQuery('input[name="password"]').val()))&&(e=!0),e){var l;l=u?'<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+jQuery('[name="invalidEmailError"]').val()+"</div></div>":i?'<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+jQuery('[name="insufficientlyStrongPassword"]').val()+"</div></div>":'<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+app.vtranslate("LBL_MANDATORY_FIELDS_ERROR")+"</div></div>",jQuery("#errorMessage").html(l).show()}else{var m={db_hostname:document.step4.db_hostname.value,db_username:document.step4.db_username.value,db_name:document.step4.db_name.value,create_db:jQuery('[name="create_db"]').prop("checked"),db_root_username:document.step4.db_root_username.value,currency_name:document.step4.currency_name.value,firstname:document.step4.firstname.value,lastname:document.step4.lastname.value,admin_email:document.step4.admin_email.value,dateformat:document.step4.dateformat.value,timezone:document.step4.timezone.value};window.localStorage.setItem("yetiforce_install",JSON.stringify(m)),jQuery('form[name="step4"]').submit()}}),this.checkPwdEvent()},registerEventForStep5:function(){jQuery('input[name="step6"]').on("click",function(){if(jQuery("#errorMessage").length)return alert(app.vtranslate("LBL_RESOLVE_ERROR")),!1;jQuery("#progressIndicator").removeClass("d-none"),jQuery('form[name="step5"]').submit().hide()})},registerEventForStep6:function(){jQuery('input[name="step7"]').on("click",function(){$('form[name="step6"]').validationEngine("validate")&&(jQuery("#progressIndicator").show().removeClass("d-none"),jQuery('form[name="step6"]').submit().parent().hide())})},registerEventForMigration:function(){"mStep3"==jQuery('input[name="mode"]').val()&&jQuery("form").on("submit",function(){jQuery("#progressIndicator").show(),jQuery("#mainContainer").hide()})},changeLanguage:function(e){$(e.currentTarget);jQuery('input[name="mode"]').val("step1"),jQuery('form[name="step1"]').submit()},registerEvents:function(){jQuery('input[name="back"]').on("click",function(){jQuery('input[name="create_db"]:checked').length>0&&jQuery('input[name="create_db"]').removeAttr("checked"),window.history.back()}),jQuery("form").validationEngine(app.validationEngineOptions),this.registerEventForStep1(),this.registerEventForStep3(),this.registerEventForStep4(),this.registerEventForStep5(),this.registerEventForStep6(),this.registerEventForMigration(),$('select[name="lang"]').change(this.changeLanguage)}}),jQuery(document).ready(function(){(new Install_Index_Js).registerEvents()});
