'use strict';

jQuery.Class('Install_Index_Js',{fieldsCached:['db_hostname','db_username','db_name','create_db','db_root_username','currency_name','firstname','lastname','admin_email','dateformat','timezone'],checkUsername:function checkUsername(field){var logins=JSON.parse(jQuery('#not_allowed_logins').val());if(-1!==jQuery.inArray(field.val(),logins))return app.vtranslate('LBL_INVALID_USERNAME_ERROR')}},{registerEventForStep1:function registerEventForStep1(){jQuery('.bt_install').on('click',function(){jQuery('input[name="mode"]').val('step2'),jQuery('form[name="step1"]').submit();}),jQuery('.bt_migrate').on('click',function(){jQuery('input[name="mode"]').val('mStep0'),jQuery('form[name="step1"]').submit();});},registerEventForStep2:function registerEventForStep2(){var modalContainer=$('.js-license-modal');modalContainer.on('shown.bs.modal',function(){app.registerDataTables(modalContainer.find('.js-data-table'),{lengthMenu:[[10,25,50,-1],[10,25,50,app.vtranslate('JS_ALL')]]});});},registerEventForStep3:function registerEventForStep3(){$('#recheck').on('click',function(){window.location.reload();});var elements=jQuery('.js-wrong-status');$('.js-confirm').on('submit',function(e){0<elements.length&&(e.preventDefault(),app.showConfirmModal(app.vtranslate('LBL_PHP_WARNING')).done(function(data){if(data)return elements=!1,void $('form[name="step3"]').submit()}));});},checkPwdEvent:function checkPwdEvent(){var thisInstance=this;jQuery('input[name="password"]').on('blur',function(){thisInstance.checkPwd(jQuery(this).val());});},checkPwd:function checkPwd(pass){var error=!1;return 8>pass.length?(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_TO_SHORT')),error=!0):32<pass.length?(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_TO_LONG')),error=!0):-1==pass.search(/\d/)?(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_NO_NUM')),error=!0):-1==pass.search(/[A-Z]/)?(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_LACK_OF_CAPITAL_LETTERS')),error=!0):-1==pass.search(/[a-z]/)&&(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_LACK_OF_LOWERCASE_LETTERS')),error=!0),error},registerEventForStep4:function registerEventForStep4(){function clearPasswordError(){jQuery('#passwordError').html('');}function setPasswordError(){jQuery('#passwordError').html(app.vtranslate('LBL_PASS_REENTER_ERROR'));}var config=JSON.parse(localStorage.getItem('yetiforce_install'));Install_Index_Js.fieldsCached.forEach(function(field){if(config&&'undefined'!=typeof config[field]){var formField=jQuery('[name="'+field+'"]');'SELECT'==jQuery(formField).prop('tagName')?(jQuery(formField).val(config[field]),jQuery(formField).select2('destroy'),App.Fields.Picklist.showSelect2ElementView(jQuery(formField))):'INPUT'==jQuery(formField).prop('tagName')&&'checkbox'==jQuery(formField).attr('type')?!0==config[field]&&(jQuery(formField).prop('checked',!0),jQuery('.config-table tr.d-none').removeClass('d-none')):jQuery(formField).val(config[field]);}});var thisInstance=this;jQuery('input[name="create_db"]').on('click',function(){var userName=jQuery('#root_user'),password=jQuery('#root_password');jQuery(this).is(':checked')?(userName.removeClass('d-none'),password.removeClass('d-none')):(userName.addClass('d-none'),password.addClass('d-none'));}),jQuery('input[name="retype_password"]').on('blur',function(e){var element=jQuery(e.currentTarget),password=jQuery('input[name="password"]').val();password!==element.val()&&setPasswordError();}),jQuery('input[name="password"]').on('blur',function(e){var retypePassword=jQuery('input[name="retype_password"]');''!=retypePassword.val()&&retypePassword.val()!==jQuery(e.currentTarget).val()?jQuery('#passwordError').html(app.vtranslate('LBL_PASS_REENTER_ERROR')):clearPasswordError();}),jQuery('input[name="retype_password"]').on('keypress',function(){clearPasswordError();}),jQuery('input[name="step5"]').on('click',function(){var error=!1,validateFieldNames=['db_hostname','db_username','db_name','password','retype_password','lastname','admin_email'];for(var fieldName in validateFieldNames){var field=jQuery('input[name="'+validateFieldNames[fieldName]+'"]');if(''==field.val()){field.addClass('error').focus(),error=!0;break}else field.removeClass('error');}var createDatabase=jQuery('input[name="create_db"]:checked');if(0<createDatabase.length){var dbRootUser=jQuery('input[name="db_root_username"]');''==dbRootUser.val()?(dbRootUser.addClass('error').focus(),error=!0):dbRootUser.removeClass('error');}var password=jQuery('#passwordError');password.html().trim()&&(error=!0);var emailField=jQuery('input[name="admin_email"]'),invalidEmailAddress=!1,regex=/^[_/a-zA-Z0-9*]+([!"#$%&'()*+,./:;<=>?\^_`{|}~-]?[a-zA-Z0-9/_/-])*@[a-zA-Z0-9]+([\_\-\.]?[a-zA-Z0-9]+)*\.([\-\_]?[a-zA-Z0-9])+(\.?[a-zA-Z0-9]+)?$/;regex.test(emailField.val())||''==emailField.val()?emailField.removeClass('error'):(invalidEmailAddress=!0,emailField.addClass('error').focus(),error=!0);var checkPwdError=!1;if(checkPwdError=thisInstance.checkPwd(jQuery('input[name="password"]').val()),checkPwdError&&(error=!0),error){var content;content=invalidEmailAddress?'<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+jQuery('[name="invalidEmailError"]').val()+'</div></div>':checkPwdError?'<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+jQuery('[name="insufficientlyStrongPassword"]').val()+'</div></div>':'<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+app.vtranslate('LBL_MANDATORY_FIELDS_ERROR')+'</div></div>',jQuery('#errorMessage').html(content).show();}else{var config={db_hostname:document.step4.db_hostname.value,db_username:document.step4.db_username.value,db_name:document.step4.db_name.value,create_db:jQuery('[name="create_db"]').prop('checked'),db_root_username:document.step4.db_root_username.value,currency_name:document.step4.currency_name.value,firstname:document.step4.firstname.value,lastname:document.step4.lastname.value,admin_email:document.step4.admin_email.value,dateformat:document.step4.dateformat.value,timezone:document.step4.timezone.value};window.localStorage.setItem('yetiforce_install',JSON.stringify(config)),jQuery('form[name="step4"]').submit();}}),this.checkPwdEvent();},registerEventForStep5:function registerEventForStep5(){jQuery('input[name="step6"]').on('click',function(){var error=jQuery('#errorMessage');return error.length?(app.showAlert(app.vtranslate('LBL_RESOLVE_ERROR')),!1):void(jQuery('#progressIndicator').removeClass('d-none'),jQuery('form[name="step5"]').submit().hide())});},registerEventForStep6:function registerEventForStep6(){jQuery('input[name="step7"]').on('click',function(){$('form[name="step6"]').validationEngine('validate')&&(jQuery('#progressIndicator').show().removeClass('d-none'),jQuery('form[name="step6"]').submit().parent().hide());});},registerEventForMigration:function registerEventForMigration(){var step=jQuery('input[name="mode"]').val();'mStep3'==step&&jQuery('form').on('submit',function(){jQuery('#progressIndicator').show(),jQuery('#mainContainer').hide();});},changeLanguage:function changeLanguage(){jQuery('input[name="mode"]').val('step1'),jQuery('form[name="step1"]').submit();},registerEvents:function registerEvents(){jQuery('input[name="back"]').on('click',function(){var createDatabase=jQuery('input[name="create_db"]:checked');0<createDatabase.length&&jQuery('input[name="create_db"]').removeAttr('checked'),window.history.back();}),jQuery('form').validationEngine(app.validationEngineOptions),this.registerEventForStep1(),this.registerEventForStep2(),this.registerEventForStep3(),this.registerEventForStep4(),this.registerEventForStep5(),this.registerEventForStep6(),this.registerEventForMigration(),$('select[name="lang"]').on('change',this.changeLanguage);}}),jQuery(document).ready(function(){var install=new Install_Index_Js;install.registerEvents();});
//# sourceMappingURL=Index.min.js.map
