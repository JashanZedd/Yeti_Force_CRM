{"version":3,"file":"Index.min.js","sources":["Index.js"],"sourcesContent":["/*+**********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n * Contributor(s): YetiForce.com\n ************************************************************************************/\n\njQuery.Class(\n\t'Install_Index_Js',\n\t{\n\t\tfieldsCached: [\n\t\t\t'db_server',\n\t\t\t'db_username',\n\t\t\t'db_name',\n\t\t\t'currency_name',\n\t\t\t'firstname',\n\t\t\t'lastname',\n\t\t\t'admin_email',\n\t\t\t'dateformat',\n\t\t\t'default_timezone'\n\t\t],\n\t\tcheckUsername: function(field, rules, i, options) {\n\t\t\tlet fieldValue = field.val(),\n\t\t\t\tnegativeRegex = /^[a-zA-Z0-9_.@-]{3,64}$/,\n\t\t\t\tresult = negativeRegex.test(fieldValue);\n\t\t\tif (!result) {\n\t\t\t\treturn app.vtranslate('JS_CONTAINS_ILLEGAL_CHARACTERS');\n\t\t\t}\n\t\t\tlet logins = JSON.parse($('#not_allowed_logins').val());\n\t\t\tif ($.inArray(fieldValue, logins) !== -1) {\n\t\t\t\treturn app.vtranslate('LBL_INVALID_USERNAME_ERROR');\n\t\t\t}\n\t\t},\n\t\tcheckDbName: function(field, rules, i, options) {\n\t\t\tlet fieldValue = field.val(),\n\t\t\t\tnegativeRegex = /^[^\\\\/?%*:|\\\\\\\"<>.\\s]{1,64}$/,\n\t\t\t\tresult = negativeRegex.test(fieldValue);\n\t\t\tif (!result) {\n\t\t\t\treturn app.vtranslate('JS_CONTAINS_ILLEGAL_CHARACTERS');\n\t\t\t}\n\t\t}\n\t},\n\t{\n\t\tregisterEventForStep1: function() {\n\t\t\tjQuery('.bt_install').on('click', function(e) {\n\t\t\t\tjQuery('input[name=\"mode\"]').val('step2');\n\t\t\t\tjQuery('form[name=\"step1\"]').submit();\n\t\t\t});\n\t\t\tjQuery('.bt_migrate').on('click', function(e) {\n\t\t\t\tjQuery('input[name=\"mode\"]').val('mStep0');\n\t\t\t\tjQuery('form[name=\"step1\"]').submit();\n\t\t\t});\n\t\t},\n\t\tregisterEventForStep2: function() {\n\t\t\tlet modalContainer = $('.js-license-modal');\n\t\t\tmodalContainer.on('shown.bs.modal', function(e) {\n\t\t\t\tapp.registerDataTables(modalContainer.find('.js-data-table'), {\n\t\t\t\t\tlengthMenu: [[10, 25, 50, -1], [10, 25, 50, app.vtranslate('JS_ALL')]],\n\t\t\t\t\tretrieve: true\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tshowBuyModal(event) {\n\t\t\t$.get(`Install.php?mode=showBuyModal&product=${$(event.currentTarget).data('product')}`).done(data => {\n\t\t\t\tapp.showModalWindow(data, '', modalContainer => {\n\t\t\t\t\tnew window.Settings_YetiForce_Shop_Js().registerBuyModalEvents(modalContainer);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tregisterEventForStepChooseHost() {\n\t\t\t$('.js-buy-modal').on('click', this.showBuyModal);\n\t\t\t$('.js-product-modal').on('click', e => {\n\t\t\t\t$.get(`Install.php?mode=showProductModal&product=${$(e.currentTarget).data('product')}`).done(data => {\n\t\t\t\t\tapp.showModalWindow(data, '', modalContainer => {\n\t\t\t\t\t\tmodalContainer.find('.js-modal__save').on('click', _ => {\n\t\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t\t\tthis.showBuyModal(e);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tregisterEventForStep3: function() {\n\t\t\t$('#recheck').on('click', function() {\n\t\t\t\twindow.location.reload();\n\t\t\t});\n\t\t\tlet elements = jQuery('.js-wrong-status');\n\t\t\t$('.js-confirm').on('submit', function(e) {\n\t\t\t\tif (elements.length > 0) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tapp.showConfirmModal(app.vtranslate('LBL_PHP_WARNING')).done(function(data) {\n\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\telements = false;\n\t\t\t\t\t\t\t$('form[name=\"step3\"]').submit();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tcheckPwdEvent: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tjQuery('input[name=\"password\"]').on('blur', function() {\n\t\t\t\tthisInstance.checkPwd(jQuery(this).val());\n\t\t\t});\n\t\t},\n\t\tcheckPwd: function(pass) {\n\t\t\tlet error = false;\n\n\t\t\tif (pass.length < 8) {\n\t\t\t\tjQuery('#passwordError').html(app.vtranslate('LBL_PASS_TO_SHORT'));\n\t\t\t\terror = true;\n\t\t\t} else if (pass.length > 32) {\n\t\t\t\tjQuery('#passwordError').html(app.vtranslate('LBL_PASS_TO_LONG'));\n\t\t\t\terror = true;\n\t\t\t} else if (pass.search(/\\d/) == -1) {\n\t\t\t\tjQuery('#passwordError').html(app.vtranslate('LBL_PASS_NO_NUM'));\n\t\t\t\terror = true;\n\t\t\t} else if (pass.search(/[A-Z]/) == -1) {\n\t\t\t\tjQuery('#passwordError').html(app.vtranslate('LBL_PASS_LACK_OF_CAPITAL_LETTERS'));\n\t\t\t\terror = true;\n\t\t\t} else if (pass.search(/[a-z]/) == -1) {\n\t\t\t\tjQuery('#passwordError').html(app.vtranslate('LBL_PASS_LACK_OF_LOWERCASE_LETTERS'));\n\t\t\t\terror = true;\n\t\t\t}\n\n\t\t\treturn error;\n\t\t},\n\t\tregisterEventForStep4: function() {\n\t\t\tvar config = JSON.parse(localStorage.getItem('yetiforce_install'));\n\t\t\tInstall_Index_Js.fieldsCached.forEach(function(field) {\n\t\t\t\tif (config && typeof config[field] !== 'undefined') {\n\t\t\t\t\tvar formField = jQuery('[name=\"' + field + '\"]');\n\t\t\t\t\tif ('SELECT' == jQuery(formField).prop('tagName')) {\n\t\t\t\t\t\tjQuery(formField).val(config[field]);\n\t\t\t\t\t\tjQuery(formField).select2('destroy');\n\t\t\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(jQuery(formField));\n\t\t\t\t\t} else if ('INPUT' == jQuery(formField).prop('tagName') && 'checkbox' == jQuery(formField).attr('type')) {\n\t\t\t\t\t\tif (true == config[field]) {\n\t\t\t\t\t\t\tjQuery(formField).prop('checked', true);\n\t\t\t\t\t\t\tjQuery('.config-table tr.d-none').removeClass('d-none');\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tjQuery(formField).val(config[field]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfunction clearPasswordError() {\n\t\t\t\tjQuery('#passwordError').html('');\n\t\t\t}\n\n\t\t\tfunction setPasswordError() {\n\t\t\t\tjQuery('#passwordError').html(app.vtranslate('LBL_PASS_REENTER_ERROR'));\n\t\t\t}\n\n\t\t\tjQuery('input[name=\"retype_password\"]').on('blur', function(e) {\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\tvar password = jQuery('input[name=\"password\"]').val();\n\t\t\t\tif (password !== element.val()) {\n\t\t\t\t\tsetPasswordError();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tjQuery('input[name=\"password\"]').on('blur', function(e) {\n\t\t\t\tvar retypePassword = jQuery('input[name=\"retype_password\"]');\n\t\t\t\tif (retypePassword.val() != '' && retypePassword.val() !== jQuery(e.currentTarget).val()) {\n\t\t\t\t\tjQuery('#passwordError').html(app.vtranslate('LBL_PASS_REENTER_ERROR'));\n\t\t\t\t} else {\n\t\t\t\t\tclearPasswordError();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tjQuery('input[name=\"retype_password\"]').on('keypress', function(e) {\n\t\t\t\tclearPasswordError();\n\t\t\t});\n\t\t\t$('form[name=\"step4\"]').on('submit', e => {\n\t\t\t\tif (this.checkForm()) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t} else {\n\t\t\t\t\t$('form[name=\"step4\"]').off('submit');\n\t\t\t\t\tthis.submitForm();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.checkPwdEvent();\n\t\t},\n\t\tregisterEventForStep5: function() {\n\t\t\tjQuery('input[name=\"step6\"]').on('click', function() {\n\t\t\t\tvar error = jQuery('#errorMessage');\n\t\t\t\tif (error.length) {\n\t\t\t\t\tapp.showAlert(app.vtranslate('LBL_RESOLVE_ERROR'));\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\tjQuery('#progressIndicator').removeClass('d-none');\n\t\t\t\t\tjQuery('form[name=\"step5\"]')\n\t\t\t\t\t\t.submit()\n\t\t\t\t\t\t.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterEventForStep6: function() {\n\t\t\tvar form = $('form[name=\"step6\"]');\n\t\t\tform.on('submit', function() {\n\t\t\t\tif (form.validationEngine('validate')) {\n\t\t\t\t\tform.submit();\n\t\t\t\t\t$('.js-submit').attr('disabled', true);\n\t\t\t\t} else {\n\t\t\t\t\tapp.formAlignmentAfterValidation(form);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterEventForMigration: function() {\n\t\t\tvar step = jQuery('input[name=\"mode\"]').val();\n\t\t\tif (step == 'mStep3') {\n\t\t\t\tjQuery('form').on('submit', function() {\n\t\t\t\t\tjQuery('#progressIndicator').show();\n\t\t\t\t\tjQuery('#mainContainer').hide();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tcheckForm() {\n\t\t\tlet error = false;\n\t\t\tif (\n\t\t\t\tjQuery('#passwordError')\n\t\t\t\t\t.html()\n\t\t\t\t\t.trim()\n\t\t\t) {\n\t\t\t\terror = true;\n\t\t\t}\n\t\t\tif (this.checkPwd(jQuery('input[name=\"password\"]').val())) {\n\t\t\t\terror = true;\n\t\t\t}\n\t\t\treturn error;\n\t\t},\n\t\tsubmitForm() {\n\t\t\twindow.localStorage.setItem(\n\t\t\t\t'yetiforce_install',\n\t\t\t\tJSON.stringify({\n\t\t\t\t\tdb_server: document.step4.db_server.value,\n\t\t\t\t\tdb_username: document.step4.db_username.value,\n\t\t\t\t\tdb_name: document.step4.db_name.value,\n\t\t\t\t\tcurrency_name: document.step4.currency_name.value,\n\t\t\t\t\tfirstname: document.step4.firstname.value,\n\t\t\t\t\tlastname: document.step4.lastname.value,\n\t\t\t\t\tadmin_email: document.step4.admin_email.value,\n\t\t\t\t\tdateformat: document.step4.dateformat.value,\n\t\t\t\t\tdefault_timezone: document.step4.default_timezone.value\n\t\t\t\t})\n\t\t\t);\n\t\t},\n\t\tchangeLanguage: function(e) {\n\t\t\tjQuery('input[name=\"mode\"]').val('step1');\n\t\t\tjQuery('form[name=\"step1\"]').submit();\n\t\t},\n\t\tregisterEvents: function() {\n\t\t\tconst form = $('form');\n\t\t\tjQuery('input[name=\"back\"]').on('click', function() {\n\t\t\t\twindow.history.back();\n\t\t\t});\n\t\t\tform.validationEngine(app.validationEngineOptions);\n\t\t\tthis.registerEventForStep1();\n\t\t\tthis.registerEventForStep2();\n\t\t\tthis.registerEventForStep3();\n\t\t\tthis.registerEventForStep4();\n\t\t\tthis.registerEventForStep5();\n\t\t\tthis.registerEventForStep6();\n\t\t\tthis.registerEventForMigration();\n\t\t\tif (form.attr('name') === 'step-stepChooseHost') {\n\t\t\t\tthis.registerEventForStepChooseHost();\n\t\t\t}\n\t\t\t$('select[name=\"lang\"]').on('change', this.changeLanguage);\n\t\t}\n\t}\n);\njQuery(document).ready(function() {\n\tvar install = new Install_Index_Js();\n\tinstall.registerEvents();\n});\n"],"names":["jQuery","Class","field","rules","i","options","fieldValue","val","test","app","vtranslate","logins","JSON","parse","$","inArray","on","e","submit","modalContainer","registerDataTables","find","event","get","currentTarget","data","done","showModalWindow","window","Settings_YetiForce_Shop_Js","registerBuyModalEvents","this","showBuyModal","hideModalWindow","location","reload","elements","length","preventDefault","showConfirmModal","thisInstance","checkPwd","pass","error","html","search","config","localStorage","getItem","clearPasswordError","fieldsCached","forEach","formField","prop","select2","Fields","Picklist","showSelect2ElementView","attr","removeClass","element","retypePassword","_this2","checkForm","off","submitForm","checkPwdEvent","showAlert","hide","form","validationEngine","formAlignmentAfterValidation","show","trim","setItem","stringify","document","step4","db_server","value","db_username","db_name","currency_name","firstname","lastname","admin_email","dateformat","default_timezone","history","back","validationEngineOptions","registerEventForStep1","registerEventForStep2","registerEventForStep3","registerEventForStep4","registerEventForStep5","registerEventForStep6","registerEventForMigration","registerEventForStepChooseHost","changeLanguage","ready","Install_Index_Js","registerEvents"],"mappings":"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"}