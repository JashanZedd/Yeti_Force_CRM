"use strict";Vtiger_Edit_Js("HelpDesk_Edit_Js",{},{registerRecordPreSaveEventEvent:function(form){var self=this,lockSave=!0;form.on(Vtiger_Edit_Js.recordPreSave,(function(e,data){var closedStatus=JSON.parse(app.getMainParams("closeTicketForStatus")),status=form.find('[name="ticketstatus"] :selected').val(),progress=$.progressIndicator({position:"html",blockInfo:{enabled:!0}}),isClosedStatusSet=status in closedStatus,recordId=app.getRecordId();(app.getMainParams("checkIfRecordHasTimeControl")||app.getMainParams("checkIfRelatedTicketsAreClosed"))&&isClosedStatusSet&&recordId&&!data.module&&lockSave&&recordId&&(e.preventDefault(),AppConnector.request({action:"CheckValidateToClose",module:app.getModuleName(),record:recordId,status:form.find('[name="ticketstatus"] :selected').val()}).done((function(response){progress.progressIndicator({mode:"hide"}),response.result.hasTimeControl.result&&response.result.relatedTicketsClosed.result&&(lockSave=!1,form.submit()),response.result.hasTimeControl.result||(Vtiger_Helper_Js.showPnotify({text:response.result.hasTimeControl.message,type:"info"}),self.addTimeControl({recordId:recordId,url:"index.php?module=OSSTimeControl&view=Edit&sourceModule=HelpDesk&sourceRecord="+recordId+"&relationOperation=true&subprocess="+recordId+"&subprocess="+recordId})),response.result.relatedTicketsClosed.result||Vtiger_Helper_Js.showPnotify({text:response.result.relatedTicketsClosed.message,type:"info"})}))),!isClosedStatusSet||recordId&&!data.module||(Vtiger_Helper_Js.showPnotify({text:app.vtranslate("JS_CANT_CLOSE_NEW_RECROD"),type:"info"}),progress.progressIndicator({mode:"hide"}),e.preventDefault())}))},addTimeControl:function(params){var aDeferred=jQuery.Deferred(),parentId=params.recordId,quickCreateParams={},relatedParams={},fullFormUrl=params.url;relatedParams.subprocess=parentId;var eliminatedKeys=new Array("view","module","mode","action");if(void 0!==fullFormUrl&&-1!==fullFormUrl.indexOf("?"))for(var queryParameters=fullFormUrl.split("?")[1].split("&"),index=0;index<queryParameters.length;index++){var queryParamComponents=queryParameters[index].split("=");"-1"==jQuery.inArray(queryParamComponents[0],eliminatedKeys)&&(relatedParams[queryParamComponents[0]]=queryParamComponents[1])}return quickCreateParams.data=relatedParams,quickCreateParams.callbackFunction=function(){},quickCreateParams.callbackPostShown=function(data){var index=void 0,queryParamComponents=void 0,queryParameters=[];if(void 0!==fullFormUrl&&-1!==fullFormUrl.indexOf("?"))for(queryParameters=fullFormUrl.split("?")[1].split("&"),index=0;index<queryParameters.length;index++)"mode"==(queryParamComponents=queryParameters[index].split("="))[0]&&"Calendar"==queryParamComponents[1]&&data.find('a[data-tab-name="Task"]').trigger("click");for(jQuery('<input type="hidden" name="sourceModule" value="HelpDesk" />').appendTo(data),jQuery('<input type="hidden" name="sourceRecord" value="'+parentId+'" />').appendTo(data),jQuery('<input type="hidden" name="relationOperation" value="true" />').appendTo(data),0==data.find('[name="subprocess"]').length&&jQuery('<input type="hidden" name="subprocess" value="'+parentId+'" />').appendTo(data),index=0;index<queryParameters.length;index++)queryParamComponents=queryParameters[index].split("="),"-1"==jQuery.inArray(queryParamComponents[0],eliminatedKeys)&&0==data.find('[name="'+queryParamComponents[0]+'"]').length&&jQuery('<input type="hidden" name="'+queryParamComponents[0]+'" value="'+queryParamComponents[1]+'" />').appendTo(data)},quickCreateParams.noCache=!0,Vtiger_Header_Js.getInstance().quickCreateModule("OSSTimeControl",quickCreateParams),aDeferred.promise()}});
//# sourceMappingURL=Edit.min.js.map
