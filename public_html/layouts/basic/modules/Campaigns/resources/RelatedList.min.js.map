{"version":3,"file":"RelatedList.min.js","sources":["RelatedList.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nVtiger_RelatedList_Js(\n\t'Campaigns_RelatedList_Js',\n\t{\n\t\t/*\n\t\t * function to trigger send Email\n\t\t * @params: send email url , module name.\n\t\t */\n\t\ttriggerSendEmail: function() {\n\t\t\tlet params = Vtiger_RelatedList_Js.relatedListInstance.getDefaultParams();\n\t\t\tVtiger_List_Js.triggerSendEmail(\n\t\t\t\t$.extend(params, {\n\t\t\t\t\trelatedLoad: true,\n\t\t\t\t\tsourceModule: app.getModuleName(),\n\t\t\t\t\tsourceRecord: app.getRecordId()\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t},\n\t{\n\t\tgetCompleteParams: function() {\n\t\t\tvar params = this._super();\n\t\t\tvar container = this.getRelatedContainer();\n\t\t\tparams['selectedIds'] = container.find('#selectedIds').data('selectedIds');\n\t\t\tparams['excludedIds'] = container.find('#excludedIds').data('excludedIds');\n\t\t\treturn params;\n\t\t},\n\t\tchangeCustomFilterElementView: function() {\n\t\t\tvar filterSelectElement = this.content.find('#customFilter');\n\t\t\tif (filterSelectElement.length > 0) {\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(filterSelectElement, {\n\t\t\t\t\ttemplateSelection: function(data) {\n\t\t\t\t\t\tvar resultContainer = jQuery('<span></span>');\n\t\t\t\t\t\tresultContainer.append(\n\t\t\t\t\t\t\tjQuery(\n\t\t\t\t\t\t\t\tjQuery('.filterImage')\n\t\t\t\t\t\t\t\t\t.detach()\n\t\t\t\t\t\t\t\t\t.get(0)\n\t\t\t\t\t\t\t).show()\n\t\t\t\t\t\t);\n\t\t\t\t\t\tresultContainer.append(data.text);\n\t\t\t\t\t\treturn resultContainer;\n\t\t\t\t\t},\n\t\t\t\t\tcustomSortOptGroup: true,\n\t\t\t\t\tcloseOnSelect: true\n\t\t\t\t});\n\t\t\t\tvar select2Instance = filterSelectElement.data('select2');\n\t\t\t\tselect2Instance.$dropdown.append(this.content.find('span.filterActionsDiv'));\n\t\t\t}\n\t\t},\n\t\tregisterChangeCustomFilterEvent: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar relatedContainer = thisInstance.getRelatedContainer();\n\t\t\tvar filterSelectElement = relatedContainer.find('.loadFormFilterButton');\n\t\t\tvar customFilter = relatedContainer.find('#customFilter');\n\t\t\tfilterSelectElement.on('click', function(e) {\n\t\t\t\tvar message = app.vtranslate('JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_ADD_THIS_FILTER');\n\t\t\t\tVtiger_Helper_Js.showConfirmationBox({ message: message }).done(function() {\n\t\t\t\t\tvar cvId = customFilter.val();\n\t\t\t\t\tvar relatedModuleName = relatedContainer.find('.relatedModuleName').val();\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\tsourceRecord: app.getRecordId(),\n\t\t\t\t\t\trelatedModule: relatedModuleName,\n\t\t\t\t\t\tviewId: cvId,\n\t\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\t\taction: 'RelationAjax',\n\t\t\t\t\t\tmode: 'addRelationsFromRelatedModuleViewId'\n\t\t\t\t\t};\n\t\t\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t\t\tposition: 'html',\n\t\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\t\tenabled: true\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tAppConnector.request(params)\n\t\t\t\t\t\t.done(function(responseData) {\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\tif (responseData.result === false) {\n\t\t\t\t\t\t\t\tvar message = app.vtranslate('JS_NO_RECORDS_RELATED_TO_THIS_FILTER');\n\t\t\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\t\t\ttext: message,\n\t\t\t\t\t\t\t\t\ttype: 'info'\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tVtiger_Detail_Js.reloadRelatedList();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function to edit related status for email enabled modules of campaigns\n\t\t */\n\t\tregisterEventToEditRelatedStatus: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar relatedContainer = thisInstance.getRelatedContainer();\n\t\t\trelatedContainer.find('.currentStatus').on('click', function(e) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\telement.addClass('open');\n\t\t\t});\n\t\t\tvar statusDropdown = relatedContainer.find('.currentStatus').find('.dropdown-menu');\n\t\t\tstatusDropdown.on('click', 'a', function(e) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\tvar liContainer = element.closest('li');\n\t\t\t\tvar currentStatus = element.closest('.currentStatus');\n\t\t\t\tvar selectedStatusId = liContainer.attr('id');\n\t\t\t\tvar selectedStatusValue = liContainer.data('status');\n\t\t\t\tvar relatedRecordId = element.closest('tr').data('id');\n\t\t\t\tvar params = {\n\t\t\t\t\trelatedModule: thisInstance.relatedModulename,\n\t\t\t\t\trelatedRecord: relatedRecordId,\n\t\t\t\t\tstatus: selectedStatusId,\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: 'RelationAjax',\n\t\t\t\t\tsourceRecord: thisInstance.parentRecordId,\n\t\t\t\t\tmode: 'updateStatus'\n\t\t\t\t};\n\t\t\t\telement.progressIndicator();\n\t\t\t\tAppConnector.request(params)\n\t\t\t\t\t.done(function(responseData) {\n\t\t\t\t\t\tif (responseData.result[0]) {\n\t\t\t\t\t\t\telement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\tcurrentStatus.find('.statusValue').text(selectedStatusValue);\n\t\t\t\t\t\t\tcurrentStatus.removeClass('open');\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\telement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tregisterPostLoadEvents: function() {\n\t\t\tthis._super();\n\t\t\tthis.changeCustomFilterElementView();\n\t\t\tthis.registerChangeCustomFilterEvent();\n\t\t\tthis.registerEventToEditRelatedStatus();\n\t\t}\n\t}\n);\n"],"names":["Vtiger_RelatedList_Js","params","relatedListInstance","getDefaultParams","triggerSendEmail","$","extend","app","getModuleName","getRecordId","_super","container","getRelatedContainer","find","data","filterSelectElement","content","length","Fields","Picklist","showSelect2ElementView","resultContainer","jQuery","append","detach","get","show","text","select2Instance","$dropdown","thisInstance","relatedContainer","customFilter","on","e","message","vtranslate","showConfirmationBox","done","cvId","val","relatedModuleName","progressIndicatorElement","progressIndicator","request","responseData","mode","result","showMessage","reloadRelatedList","fail","stopImmediatePropagation","element","currentTarget","addClass","statusDropdown","liContainer","closest","currentStatus","selectedStatusId","attr","selectedStatusValue","relatedRecordId","relatedModulename","parentRecordId","removeClass","changeCustomFilterElementView","registerChangeCustomFilterEvent","registerEventToEditRelatedStatus"],"mappings":"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"}