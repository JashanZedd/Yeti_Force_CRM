{"version":3,"file":"RelatedList.min.js","sources":["RelatedList.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nVtiger_RelatedList_Js(\n\t'Campaigns_RelatedList_Js',\n\t{\n\t\t/*\n\t\t * function to trigger send Email\n\t\t * @params: send email url , module name.\n\t\t */\n\t\ttriggerSendEmail: function() {\n\t\t\tlet params = Vtiger_RelatedList_Js.relatedListInstance.getDefaultParams();\n\t\t\tVtiger_List_Js.triggerSendEmail(\n\t\t\t\t$.extend(params, {\n\t\t\t\t\trelatedLoad: true,\n\t\t\t\t\tsourceModule: app.getModuleName(),\n\t\t\t\t\tsourceRecord: app.getRecordId()\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t},\n\t{\n\t\tgetCompleteParams: function() {\n\t\t\tvar params = this._super();\n\t\t\tvar container = this.getRelatedContainer();\n\t\t\tparams['selectedIds'] = container.find('#selectedIds').data('selectedIds');\n\t\t\tparams['excludedIds'] = container.find('#excludedIds').data('excludedIds');\n\t\t\treturn params;\n\t\t},\n\t\tchangeCustomFilterElementView: function() {\n\t\t\tvar filterSelectElement = this.content.find('#customFilter');\n\t\t\tif (filterSelectElement.length > 0) {\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(filterSelectElement, {\n\t\t\t\t\ttemplateSelection: function(data) {\n\t\t\t\t\t\tvar resultContainer = jQuery('<span></span>');\n\t\t\t\t\t\tresultContainer.append(\n\t\t\t\t\t\t\tjQuery(\n\t\t\t\t\t\t\t\tjQuery('.filterImage')\n\t\t\t\t\t\t\t\t\t.detach()\n\t\t\t\t\t\t\t\t\t.get(0)\n\t\t\t\t\t\t\t).show()\n\t\t\t\t\t\t);\n\t\t\t\t\t\tresultContainer.append(data.text);\n\t\t\t\t\t\treturn resultContainer;\n\t\t\t\t\t},\n\t\t\t\t\tcustomSortOptGroup: true,\n\t\t\t\t\tcloseOnSelect: true\n\t\t\t\t});\n\t\t\t\tvar select2Instance = filterSelectElement.data('select2');\n\t\t\t\tselect2Instance.$dropdown.append(this.content.find('span.filterActionsDiv'));\n\t\t\t}\n\t\t},\n\t\tregisterChangeCustomFilterEvent: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar relatedContainer = thisInstance.getRelatedContainer();\n\t\t\tvar filterSelectElement = relatedContainer.find('.loadFormFilterButton');\n\t\t\tvar customFilter = relatedContainer.find('#customFilter');\n\t\t\tfilterSelectElement.on('click', function(e) {\n\t\t\t\tvar message = app.vtranslate('JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_ADD_THIS_FILTER');\n\t\t\t\tVtiger_Helper_Js.showConfirmationBox({ message: message }).done(function() {\n\t\t\t\t\tvar cvId = customFilter.val();\n\t\t\t\t\tvar relatedModuleName = relatedContainer.find('.relatedModuleName').val();\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\tsourceRecord: app.getRecordId(),\n\t\t\t\t\t\trelatedModule: relatedModuleName,\n\t\t\t\t\t\tviewId: cvId,\n\t\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\t\taction: 'RelationAjax',\n\t\t\t\t\t\tmode: 'addRelationsFromRelatedModuleViewId'\n\t\t\t\t\t};\n\t\t\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t\t\tposition: 'html',\n\t\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\t\tenabled: true\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tAppConnector.request(params)\n\t\t\t\t\t\t.done(function(responseData) {\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\tif (responseData.result === false) {\n\t\t\t\t\t\t\t\tvar message = app.vtranslate('JS_NO_RECORDS_RELATED_TO_THIS_FILTER');\n\t\t\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\t\t\ttext: message,\n\t\t\t\t\t\t\t\t\ttype: 'info'\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tVtiger_Detail_Js.reloadRelatedList();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function to edit related status for email enabled modules of campaigns\n\t\t */\n\t\tregisterEventToEditRelatedStatus: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar relatedContainer = thisInstance.getRelatedContainer();\n\t\t\trelatedContainer.find('.currentStatus').on('click', function(e) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\telement.addClass('open');\n\t\t\t});\n\t\t\tvar statusDropdown = relatedContainer.find('.currentStatus').find('.dropdown-menu');\n\t\t\tstatusDropdown.on('click', 'a', function(e) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\tvar liContainer = element.closest('li');\n\t\t\t\tvar currentStatus = element.closest('.currentStatus');\n\t\t\t\tvar selectedStatusId = liContainer.attr('id');\n\t\t\t\tvar selectedStatusValue = liContainer.data('status');\n\t\t\t\tvar relatedRecordId = element.closest('tr').data('id');\n\t\t\t\tvar params = {\n\t\t\t\t\trelatedModule: thisInstance.relatedModulename,\n\t\t\t\t\trelatedRecord: relatedRecordId,\n\t\t\t\t\tstatus: selectedStatusId,\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: 'RelationAjax',\n\t\t\t\t\tsourceRecord: thisInstance.parentRecordId,\n\t\t\t\t\tmode: 'updateStatus'\n\t\t\t\t};\n\t\t\t\telement.progressIndicator();\n\t\t\t\tAppConnector.request(params)\n\t\t\t\t\t.done(function(responseData) {\n\t\t\t\t\t\tif (responseData.result[0]) {\n\t\t\t\t\t\t\telement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\tcurrentStatus.find('.statusValue').text(selectedStatusValue);\n\t\t\t\t\t\t\tcurrentStatus.removeClass('open');\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\telement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tregisterPostLoadEvents: function() {\n\t\t\tthis._super();\n\t\t\tthis.changeCustomFilterElementView();\n\t\t\tthis.registerChangeCustomFilterEvent();\n\t\t\tthis.registerEventToEditRelatedStatus();\n\t\t}\n\t}\n);\n"],"names":["Vtiger_RelatedList_Js","params","relatedListInstance","getDefaultParams","triggerSendEmail","$","extend","app","getModuleName","getRecordId","this","_super","container","getRelatedContainer","find","data","filterSelectElement","content","length","Fields","Picklist","showSelect2ElementView","resultContainer","jQuery","append","detach","get","show","text","$dropdown","relatedContainer","customFilter","on","e","message","vtranslate","showConfirmationBox","done","cvId","val","relatedModuleName","progressIndicatorElement","progressIndicator","request","responseData","mode","result","showMessage","reloadRelatedList","fail","thisInstance","stopImmediatePropagation","currentTarget","addClass","element","liContainer","closest","currentStatus","selectedStatusId","attr","selectedStatusValue","relatedRecordId","relatedModulename","parentRecordId","removeClass","changeCustomFilterElementView","registerChangeCustomFilterEvent","registerEventToEditRelatedStatus"],"mappings":"aAUAA,sBACC,2BACA,kBAKmB,eACbC,OAASD,sBAAsBE,oBAAoBC,kCACxCC,iBACdC,EAAEC,OAAOL,OAAQ,cACH,eACCM,IAAIC,6BACJD,IAAIE,mBAKtB,mBACoB,eACdR,OAASS,KAAKC,SACdC,UAAYF,KAAKG,oCACrB,YAAwBD,UAAUE,KAAK,gBAAgBC,KAAK,sBAC5D,YAAwBH,UAAUE,KAAK,gBAAgBC,KAAK,eACrDd,sCAEuB,eAC1Be,oBAAsBN,KAAKO,QAAQH,KAAK,iBACxCE,oBAAoBE,OAAS,QAC5BC,OAAOC,SAASC,uBAAuBL,oBAAqB,mBAC5C,SAASD,UACvBO,gBAAkBC,OAAO,wCACbC,OACfD,OACCA,OAAO,gBACLE,SACAC,IAAI,IACLC,wBAEaH,OAAOT,KAAKa,MACrBN,qCAEY,iBACL,IAEMN,oBAAoBD,KAAK,WAC/Bc,UAAUL,OAAOd,KAAKO,QAAQH,KAAK,4DAGpB,eAE5BgB,iBADepB,KACiBG,sBAChCG,oBAAsBc,iBAAiBhB,KAAK,yBAC5CiB,aAAeD,iBAAiBhB,KAAK,qCACrBkB,GAAG,SAAS,SAASC,OACpCC,QAAU3B,IAAI4B,WAAW,oEACZC,oBAAoB,CAAEF,QAASA,UAAWG,MAAK,eAC3DC,KAAOP,aAAaQ,MACpBC,kBAAoBV,iBAAiBhB,KAAK,sBAAsByB,MAChEtC,OAAS,cACEM,IAAIE,4BACH+B,yBACPF,YACA/B,IAAIC,uBACJ,oBACF,uCAEHiC,yBAA2BlB,OAAOmB,kBAAkB,UAC7C,iBACC,UACD,kBAGEC,QAAQ1C,QACnBoC,MAAK,SAASO,0CACWF,kBAAkB,CAAEG,KAAM,UACvB,IAAxBD,aAAaE,OAAkB,KAE9B7C,OAAS,MADCM,IAAI4B,WAAW,6CAGtB,yBAEUY,YAAY9C,8BAEZ+C,uBAGlBC,MAAK,oCACoBP,kBAAkB,CAAEG,KAAM,oDAQtB,eAC7BK,aAAexC,KACfoB,iBAAmBoB,aAAarC,uCACnBC,KAAK,kBAAkBkB,GAAG,SAAS,SAASC,KAC1DkB,2BACY5B,OAAOU,EAAEmB,eACfC,SAAS,WAEGvB,iBAAiBhB,KAAK,kBAAkBA,KAAK,kBACnDkB,GAAG,QAAS,KAAK,SAASC,KACtCkB,+BACEG,QAAU/B,OAAOU,EAAEmB,eACnBG,YAAcD,QAAQE,QAAQ,MAC9BC,cAAgBH,QAAQE,QAAQ,kBAChCE,iBAAmBH,YAAYI,KAAK,MACpCC,oBAAsBL,YAAYxC,KAAK,UACvC8C,gBAAkBP,QAAQE,QAAQ,MAAMzC,KAAK,MAC7Cd,OAAS,eACGiD,aAAaY,gCACbD,uBACPH,wBACAnD,IAAIC,uBACJ,4BACM0C,aAAaa,oBACrB,wBAECrB,iCACKC,QAAQ1C,QACnBoC,MAAK,SAASO,cACVA,aAAaE,OAAO,aACfJ,kBAAkB,CAAEG,KAAM,uBACpB/B,KAAK,gBAAgBc,KAAKgC,mCAC1BI,YAAY,YAG3Bf,MAAK,mBACGP,kBAAkB,CAAEG,KAAM,uCAId,gBAClBlC,cACAsD,qCACAC,uCACAC"}