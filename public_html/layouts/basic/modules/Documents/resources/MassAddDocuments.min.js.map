{"version":3,"file":"MassAddDocuments.min.js","sources":["MassAddDocuments.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n/**\n * Class Documents_MassAddDocuments_Js.\n * @type {window.Documents_MassAddDocuments_Js}\n */\nwindow.Documents_MassAddDocuments_Js = class Documents_MassAddDocuments_Js {\n\t/**\n\t * Create a class object\n\t * @param {jQuery} modal\n\t * @param {jQuery.Event} e\n\t */\n\tstatic register(modal, e) {\n\t\tconst self = new window[this.name]();\n\t\tself.registerEvents(modal, e);\n\t}\n\tregisterSubmit() {\n\t\tconst uploadButton = this.modal.find('#filesToUpload'),\n\t\t\ttemplate = this.modal.find('.fileContainer'),\n\t\t\tuploadContainer = this.modal.find('.uploadFileContainer');\n\t\tuploadButton.on('change', function () {\n\t\t\tuploadContainer.find('.fileItem').remove();\n\t\t\tlet files = uploadButton[0].files;\n\t\t\tfor (let file of files) {\n\t\t\t\tuploadContainer.append(template.html());\n\t\t\t\tuploadContainer.find('[name=\"nameFile[]\"]:last').val(file.name);\n\t\t\t}\n\t\t});\n\t\tthis.form.on('submit', (e) => {\n\t\t\te.preventDefault();\n\t\t\tthis.submit();\n\t\t});\n\t}\n\t/**\n\t * Submit\n\t */\n\tsubmit() {\n\t\tlet moduleName = app.getModuleName(),\n\t\t\trecordId = app.getRecordId();\n\t\tif (this.modal.find('[name=\"sourceModule\"]').length > 0) {\n\t\t\tmoduleName = this.modal.find('[name=\"sourceModule\"]').val();\n\t\t}\n\t\tif (this.modal.find('[name=\"sourceRecord\"]').length > 0) {\n\t\t\trecordId = this.modal.find('[name=\"sourceRecord\"]').val();\n\t\t}\n\t\tapp.removeEmptyFilesInput(this.form[0]);\n\t\tlet formData = new FormData(this.form[0]);\n\t\tif (this.button.data('view') === 'Detail') {\n\t\t\tformData.append('createmode', 'link');\n\t\t\tformData.append('return_module', moduleName);\n\t\t\tformData.append('return_id', recordId);\n\t\t}\n\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\tblockInfo: { enabled: true }\n\t\t});\n\t\tAppConnector.request({\n\t\t\turl: 'index.php',\n\t\t\ttype: 'POST',\n\t\t\tdata: formData,\n\t\t\tprocessData: false,\n\t\t\tcontentType: false\n\t\t}).done((response) => {\n\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\tapp.hideModalWindow();\n\t\t\tswitch (this.button.data('view')) {\n\t\t\t\tcase 'Detail':\n\t\t\t\t\tconst detailView = Vtiger_Detail_Js.getInstance(),\n\t\t\t\t\t\tselectedTabElement = detailView.getSelectedTab();\n\t\t\t\t\tif (selectedTabElement.data('reference') === 'Documents') {\n\t\t\t\t\t\tdetailView.reloadTabContent();\n\t\t\t\t\t} else if (detailView.getContentHolder().find('.detailViewBlockLink').data('reference') === 'Documents') {\n\t\t\t\t\t\tVtiger_RelatedList_Js.getInstance(\n\t\t\t\t\t\t\tdetailView.getRecordId(),\n\t\t\t\t\t\t\tapp.getModuleName(),\n\t\t\t\t\t\t\tselectedTabElement,\n\t\t\t\t\t\t\t'Documents'\n\t\t\t\t\t\t).loadRelatedList();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst updatesWidget = this.button.closest('.widgetContentBlock');\n\t\t\t\t\t\tif (updatesWidget.length > 0) {\n\t\t\t\t\t\t\tdetailView.loadWidget(updatesWidget, detailView.getFiltersData(updatesWidget)['params']);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'List':\n\t\t\t\t\tconst listInstance = Vtiger_List_Js.getInstance();\n\t\t\t\t\tlistInstance.getListViewRecords().done(function () {\n\t\t\t\t\t\tlistInstance.calculatePages().done(function () {\n\t\t\t\t\t\t\tlistInstance.updatePagination();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Edit':\n\t\t\t\t\tif (response['result']) {\n\t\t\t\t\t\tconst fieldBlock = this.button.closest('.js-field-block-column'),\n\t\t\t\t\t\t\tfield = fieldBlock.find('[name=\"' + fieldBlock.data('field') + '[]\"]');\n\t\t\t\t\t\tApp.Fields.Utils.setValue(field, response['result'], { extend: true }, false);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t}\n\t/**\n\t * Register events.\n\t * @param {jQuery} modal\n\t * @param {jQuery.Event} e\n\t */\n\tregisterEvents(modal, e) {\n\t\tthis.modal = modal;\n\t\tthis.form = modal.find('form');\n\t\tthis.button = $(e.currentTarget);\n\t\tthis.registerSubmit();\n\t}\n};\n"],"names":["window","Documents_MassAddDocuments_Js","uploadButton","modal","find","template","uploadContainer","on","remove","files","file","append","html","val","name","form","e","preventDefault","submit","moduleName","app","getModuleName","recordId","getRecordId","length","removeEmptyFilesInput","formData","FormData","button","data","progressIndicatorElement","$","progressIndicator","blockInfo","enabled","AppConnector","request","url","type","processData","contentType","done","response","mode","hideModalWindow","detailView","Vtiger_Detail_Js","getInstance","selectedTabElement","getSelectedTab","reloadTabContent","getContentHolder","Vtiger_RelatedList_Js","loadRelatedList","updatesWidget","closest","loadWidget","getFiltersData","listInstance","Vtiger_List_Js","getListViewRecords","calculatePages","updatePagination","fieldBlock","field","App","Fields","Utils","setValue","extend","currentTarget","registerSubmit","self","registerEvents"],"mappings":"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"}