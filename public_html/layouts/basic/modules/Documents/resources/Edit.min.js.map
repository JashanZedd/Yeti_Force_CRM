{"version":3,"file":"Edit.min.js","sources":["Edit.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n * Contributor(s): YetiForce S.A.\n *************************************************************************************/\n'use strict';\n\nVtiger_Edit_Js(\n\t'Documents_Edit_Js',\n\t{},\n\t{\n\t\tINTERNAL_FILE_LOCATION_TYPE: 'I',\n\t\tEXTERNAL_FILE_LOCATION_TYPE: 'E',\n\n\t\tisFileLocationInternalType: function (fileLocationElement) {\n\t\t\tif (fileLocationElement.val() == this.INTERNAL_FILE_LOCATION_TYPE) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\tisFileLocationExternalType: function (fileLocationElement) {\n\t\t\tif (fileLocationElement.val() == this.EXTERNAL_FILE_LOCATION_TYPE) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\tconvertFileSizeInToDisplayFormat: function (fileSizeInBytes) {\n\t\t\tvar i = -1;\n\t\t\tvar byteUnits = [' kB', ' MB', ' GB', ' TB', 'PB', 'EB', 'ZB', 'YB'];\n\t\t\tdo {\n\t\t\t\tfileSizeInBytes = fileSizeInBytes / 1024;\n\t\t\t\ti++;\n\t\t\t} while (fileSizeInBytes > 1024);\n\n\t\t\treturn Math.max(fileSizeInBytes, 0.1).toFixed(1) + byteUnits[i];\n\t\t},\n\n\t\tregisterFileLocationTypeChangeEvent: function (container) {\n\t\t\tvar thisInstance = this;\n\t\t\tcontainer.on('change', 'select[name=\"filelocationtype\"]', function (e) {\n\t\t\t\tvar fileLocationTypeElement = container.find('[name=\"filelocationtype\"]');\n\t\t\t\tvar fileNameElement = container.find('[name=\"filename\"]');\n\t\t\t\tvar newFileNameElement;\n\t\t\t\tif (thisInstance.isFileLocationInternalType(fileLocationTypeElement)) {\n\t\t\t\t\tnewFileNameElement = jQuery('<input type=\"file\"/>');\n\t\t\t\t} else {\n\t\t\t\t\tnewFileNameElement = jQuery('<input type=\"text\" />');\n\t\t\t\t}\n\t\t\t\tvar oldElementAttributeList = fileNameElement.get(0).attributes;\n\n\t\t\t\tfor (var index = 0; index < oldElementAttributeList.length; index++) {\n\t\t\t\t\tvar attributeObject = oldElementAttributeList[index];\n\t\t\t\t\t//Dont update the type attribute\n\t\t\t\t\tif (attributeObject.name == 'type' || attributeObject.name == 'value' || attributeObject.name == 'class') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvar value = attributeObject.value;\n\t\t\t\t\tvar className = '';\n\t\t\t\t\tif (attributeObject.name == 'data-fieldinfo') {\n\t\t\t\t\t\tvalue = JSON.parse(value);\n\t\t\t\t\t\tif (thisInstance.isFileLocationExternalType(fileLocationTypeElement)) {\n\t\t\t\t\t\t\tvalue['type'] = 'url';\n\t\t\t\t\t\t\tclassName = 'form-control';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvalue['type'] = 'file';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvalue = JSON.stringify(value);\n\t\t\t\t\t}\n\t\t\t\t\tnewFileNameElement.attr(attributeObject.name, value);\n\t\t\t\t\tnewFileNameElement.addClass(className);\n\t\t\t\t}\n\t\t\t\tfileNameElement.replaceWith(newFileNameElement);\n\t\t\t\tvar fileNameElementTd = newFileNameElement.closest('.fieldValue');\n\t\t\t\tvar uploadFileDetails = fileNameElementTd.find('.uploadedFileDetails');\n\t\t\t\tif (thisInstance.isFileLocationExternalType(fileLocationTypeElement)) {\n\t\t\t\t\tuploadFileDetails.addClass('d-none').removeClass('show');\n\t\t\t\t} else {\n\t\t\t\t\tuploadFileDetails.addClass('show').removeClass('d-none');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tregisterFileChangeEvent: function (container) {\n\t\t\tvar thisInstance = this;\n\n\t\t\tcontainer.on('change', 'input[name=\"filename\"]', function (e) {\n\t\t\t\tif (e.target.type === 'text') {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tlet element = container.find('[name=\"filename\"]');\n\t\t\t\t//ignore all other types than file\n\t\t\t\tif (element.attr('type') !== 'file') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet uploadFileSizeHolder = element.closest('.fileUploadContainer').find('.uploadedFileSize');\n\t\t\t\tlet fileSize = element.get(0).files[0].size;\n\t\t\t\tif (fileSize > CONFIG['maxUploadLimit']) {\n\t\t\t\t\tapp.showAlert(app.vtranslate('JS_UPLOADED_FILE_SIZE_EXCEEDS'));\n\t\t\t\t\telement.val('');\n\t\t\t\t\tuploadFileSizeHolder.text('');\n\t\t\t\t} else {\n\t\t\t\t\tuploadFileSizeHolder.text(thisInstance.convertFileSizeInToDisplayFormat(fileSize));\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Function to save the quickcreate module\n\t\t * @param accepts form element as parameter\n\t\t * @returns {Promise}\n\t\t */\n\t\tquickCreateSave: function (form) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar aDeferred = jQuery.Deferred();\n\t\t\t//Using formData object to send data to server as a multipart/form-data form submit\n\t\t\tvar formData = new FormData(form[0]);\n\t\t\tvar fileLocationTypeElement = form.find('[name=\"filelocationtype\"]');\n\t\t\tvar params = {\n\t\t\t\turl: 'index.php',\n\t\t\t\ttype: 'POST',\n\t\t\t\tdata: formData,\n\t\t\t\tprocessData: false,\n\t\t\t\tcontentType: false\n\t\t\t};\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function (data) {\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t})\n\t\t\t\t.fail(function (textStatus, errorThrown) {\n\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\tregisterBasicEvents: function (container) {\n\t\t\tthis._super(container);\n\t\t\tthis.registerFileLocationTypeChangeEvent(container);\n\t\t\tthis.registerFileChangeEvent(container);\n\t\t},\n\n\t\tregisterEvents: function () {\n\t\t\tthis._super();\n\t\t}\n\t}\n);\n"],"names":["Vtiger_Edit_Js","INTERNAL_FILE_LOCATION_TYPE","EXTERNAL_FILE_LOCATION_TYPE","isFileLocationInternalType","fileLocationElement","val","isFileLocationExternalType","convertFileSizeInToDisplayFormat","fileSizeInBytes","i","Math","max","toFixed","registerFileLocationTypeChangeEvent","container","thisInstance","on","newFileNameElement","fileLocationTypeElement","find","fileNameElement","jQuery","attributeObject","oldElementAttributeList","get","attributes","index","length","name","value","className","JSON","parse","stringify","attr","addClass","replaceWith","fileNameElementTd","closest","uploadFileDetails","removeClass","registerFileChangeEvent","e","target","type","element","uploadFileSizeHolder","fileSize","files","size","CONFIG","app","showAlert","vtranslate","text","quickCreateSave","form","aDeferred","Deferred","formData","FormData","AppConnector","request","url","data","processData","contentType","done","resolve","fail","textStatus","errorThrown","reject","promise","registerBasicEvents","_super","registerEvents"],"mappings":"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"}