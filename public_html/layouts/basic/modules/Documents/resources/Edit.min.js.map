{"version":3,"file":"Edit.min.js","sources":["Edit.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nVtiger_Edit_Js(\n\t'Documents_Edit_Js',\n\t{},\n\t{\n\t\tINTERNAL_FILE_LOCATION_TYPE: 'I',\n\t\tEXTERNAL_FILE_LOCATION_TYPE: 'E',\n\n\t\tgetMaxiumFileUploadingSize: function(container) {\n\t\t\treturn container.find('.maxUploadSize').data('value');\n\t\t},\n\n\t\tisFileLocationInternalType: function(fileLocationElement) {\n\t\t\tif (fileLocationElement.val() == this.INTERNAL_FILE_LOCATION_TYPE) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\tisFileLocationExternalType: function(fileLocationElement) {\n\t\t\tif (fileLocationElement.val() == this.EXTERNAL_FILE_LOCATION_TYPE) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\tconvertFileSizeInToDisplayFormat: function(fileSizeInBytes) {\n\t\t\tvar i = -1;\n\t\t\tvar byteUnits = [' kB', ' MB', ' GB', ' TB', 'PB', 'EB', 'ZB', 'YB'];\n\t\t\tdo {\n\t\t\t\tfileSizeInBytes = fileSizeInBytes / 1024;\n\t\t\t\ti++;\n\t\t\t} while (fileSizeInBytes > 1024);\n\n\t\t\treturn Math.max(fileSizeInBytes, 0.1).toFixed(1) + byteUnits[i];\n\t\t},\n\n\t\tregisterFileLocationTypeChangeEvent: function(container) {\n\t\t\tvar thisInstance = this;\n\t\t\tcontainer.on('change', 'select[name=\"filelocationtype\"]', function(e) {\n\t\t\t\tvar fileLocationTypeElement = container.find('[name=\"filelocationtype\"]');\n\t\t\t\tvar fileNameElement = container.find('[name=\"filename\"]');\n\t\t\t\tvar newFileNameElement;\n\t\t\t\tif (thisInstance.isFileLocationInternalType(fileLocationTypeElement)) {\n\t\t\t\t\tnewFileNameElement = jQuery('<input type=\"file\"/>');\n\t\t\t\t} else {\n\t\t\t\t\tnewFileNameElement = jQuery('<input type=\"text\" />');\n\t\t\t\t}\n\t\t\t\tvar oldElementAttributeList = fileNameElement.get(0).attributes;\n\n\t\t\t\tfor (var index = 0; index < oldElementAttributeList.length; index++) {\n\t\t\t\t\tvar attributeObject = oldElementAttributeList[index];\n\t\t\t\t\t//Dont update the type attribute\n\t\t\t\t\tif (attributeObject.name == 'type' || attributeObject.name == 'value' || attributeObject.name == 'class') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvar value = attributeObject.value;\n\t\t\t\t\tvar className = '';\n\t\t\t\t\tif (attributeObject.name == 'data-fieldinfo') {\n\t\t\t\t\t\tvalue = JSON.parse(value);\n\t\t\t\t\t\tif (thisInstance.isFileLocationExternalType(fileLocationTypeElement)) {\n\t\t\t\t\t\t\tvalue['type'] = 'url';\n\t\t\t\t\t\t\tclassName = 'form-control';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvalue['type'] = 'file';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvalue = JSON.stringify(value);\n\t\t\t\t\t}\n\t\t\t\t\tnewFileNameElement.attr(attributeObject.name, value);\n\t\t\t\t\tnewFileNameElement.addClass(className);\n\t\t\t\t}\n\t\t\t\tfileNameElement.replaceWith(newFileNameElement);\n\t\t\t\tvar fileNameElementTd = newFileNameElement.closest('.fieldValue');\n\t\t\t\tvar uploadFileDetails = fileNameElementTd.find('.uploadedFileDetails');\n\t\t\t\tif (thisInstance.isFileLocationExternalType(fileLocationTypeElement)) {\n\t\t\t\t\tuploadFileDetails.addClass('d-none').removeClass('show');\n\t\t\t\t} else {\n\t\t\t\t\tuploadFileDetails.addClass('show').removeClass('d-none');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tregisterFileChangeEvent: function(container) {\n\t\t\tvar thisInstance = this;\n\t\t\tcontainer.on('change', 'input[name=\"filename\"]', function(e) {\n\t\t\t\tif (e.target.type === 'text') {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tlet element = container.find('[name=\"filename\"]');\n\t\t\t\t//ignore all other types than file\n\t\t\t\tif (element.attr('type') !== 'file') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet uploadFileSizeHolder = element.closest('.fileUploadContainer').find('.uploadedFileSize');\n\t\t\t\tlet fileSize = element.get(0).files[0].size;\n\t\t\t\tif (fileSize > thisInstance.getMaxiumFileUploadingSize(container)) {\n\t\t\t\t\tapp.showAlert(app.vtranslate('JS_EXCEEDS_MAX_UPLOAD_SIZE'));\n\t\t\t\t\telement.val('');\n\t\t\t\t\tuploadFileSizeHolder.text('');\n\t\t\t\t} else {\n\t\t\t\t\tuploadFileSizeHolder.text(thisInstance.convertFileSizeInToDisplayFormat(fileSize));\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Function to save the quickcreate module\n\t\t * @param accepts form element as parameter\n\t\t * @return returns deferred promise\n\t\t */\n\t\tquickCreateSave: function(form) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar aDeferred = jQuery.Deferred();\n\t\t\t//Using formData object to send data to server as a multipart/form-data form submit\n\t\t\tvar formData = new FormData(form[0]);\n\t\t\tvar fileLocationTypeElement = form.find('[name=\"filelocationtype\"]');\n\t\t\tvar params = {\n\t\t\t\turl: 'index.php',\n\t\t\t\ttype: 'POST',\n\t\t\t\tdata: formData,\n\t\t\t\tprocessData: false,\n\t\t\t\tcontentType: false\n\t\t\t};\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t})\n\t\t\t\t.fail(function(textStatus, errorThrown) {\n\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\tregisterBasicEvents: function(container) {\n\t\t\tthis._super(container);\n\t\t\tthis.registerFileLocationTypeChangeEvent(container);\n\t\t\tthis.registerFileChangeEvent(container);\n\t\t},\n\n\t\tregisterEvents: function() {\n\t\t\tthis._super();\n\t\t}\n\t}\n);\n"],"names":["Vtiger_Edit_Js","container","find","data","fileLocationElement","val","INTERNAL_FILE_LOCATION_TYPE","EXTERNAL_FILE_LOCATION_TYPE","fileSizeInBytes","i","byteUnits","Math","max","toFixed","thisInstance","on","e","fileLocationTypeElement","fileNameElement","newFileNameElement","isFileLocationInternalType","jQuery","oldElementAttributeList","get","attributes","index","length","attributeObject","name","value","className","JSON","parse","isFileLocationExternalType","stringify","attr","addClass","replaceWith","fileNameElementTd","closest","uploadFileDetails","removeClass","target","type","element","uploadFileSizeHolder","fileSize","files","size","getMaxiumFileUploadingSize","showAlert","app","vtranslate","text","convertFileSizeInToDisplayFormat","form","aDeferred","Deferred","formData","FormData","params","request","done","resolve","fail","textStatus","errorThrown","reject","promise","_super","registerFileLocationTypeChangeEvent","registerFileChangeEvent"],"mappings":"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"}