{"version":3,"file":"Edit.min.js","sources":["Edit.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nVtiger_Edit_Js(\"OSSTimeControl_Edit_Js\", {}, {\n\n\tregisterGenerateTCFieldTimeAndCost: function () {\n\t\tvar thisInstance = this;\n\t\t$('input[name=\"sum_time\"]').attr('readonly', 'readonly').css('width', '80px');\n\t\tvar form = thisInstance.getForm();\n\t\tvar sumeTime = thisInstance.differenceDays(form);\n\t\tvar hours = (Math.ceil((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\n\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\tjQuery('.dateField').on('change', function () {\n\t\t\tsumeTime = thisInstance.differenceDays(form);\n\t\t\tif (sumeTime == 'Error') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\thours = (Math.ceil((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\t\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\t});\n\t\tjQuery('.clockPicker').on('change', function () {\n\t\t\tsumeTime = thisInstance.differenceDays(form);\n\t\t\tif (sumeTime == 'Error') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\thours = (Math.round((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\t\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\t});\n\n\t},\n\n\tdifferenceDays: function (container) {\n\t\tvar firstDate = container.find('input[name=\"date_start\"]');\n\t\tvar firstDateFormat = firstDate.data('date-format');\n\t\tvar firstDateValue = firstDate.val();\n\t\tvar secondDate = container.find('input[name=\"due_date\"]');\n\t\tvar secondDateFormat = secondDate.data('date-format');\n\t\tvar secondDateValue = secondDate.val();\n\t\tvar firstTime = container.find('input[name=\"time_start\"]');\n\t\tvar secondTime = container.find('input[name=\"time_end\"]');\n\t\tvar firstTimeValue = firstTime.val();\n\t\tvar secondTimeValue = secondTime.val();\n\t\tvar firstDateTimeValue = firstDateValue + ' ' + firstTimeValue;\n\t\tvar secondDateTimeValue = secondDateValue + ' ' + secondTimeValue;\n\t\ttry {\n\t\t\tvar firstDateInstance = Vtiger_Helper_Js.getDateInstance(firstDateTimeValue, firstDateFormat);\n\t\t\tvar secondDateInstance = Vtiger_Helper_Js.getDateInstance(secondDateTimeValue, secondDateFormat);\n\t\t\tvar timeBetweenDates = secondDateInstance - firstDateInstance;\n\t\t\tif (timeBetweenDates >= 0) {\n\t\t\t\treturn timeBetweenDates;\n\t\t\t}\n\t\t} catch (err){\n\t\t\treturn 'Error';\n\t\t}\n\t\treturn 'Error';\n\t},\n\n\t/**\n\t * Function to register recordpresave event\n\t */\n\tregisterRecordPreSaveEvent: function (container) {\n\t\tvar thisInstance = this;\n\t\tvar form = $('.recordEditView[name=\"QuickCreate\"]');\n\t\tif (form.length == 0) {\n\t\t\tform = this.getForm();\n\t\t}\n\t\tform.on(Vtiger_Edit_Js.recordPreSave, function (e, data) {\n\t\t\tvar sumeTime2 = thisInstance.differenceDays(form);\n\t\t\tif (sumeTime2 == 'Error') {\n\t\t\t\tvar parametres = {\n\t\t\t\t\ttext: app.vtranslate('JS_DATE_SHOULD_BE_GREATER_THAN'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t};\n\t\t\t\tVtiger_Helper_Js.showPnotify(parametres);\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tif (app.getMainParams('disallowLongerThan24Hours')) {\n\t\t\t\t\tsumeTime2 = sumeTime2 / 1000 / 60 / 60;\n\t\t\t\t\tif (sumeTime2 > 24) {\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\ttext: app.vtranslate('JS_DATE_NOT_SHOULD_BE_GREATER_THAN_24H'),\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tform.submit();\n\t\t\t}\n\t\t});\n\t},\n\tregisterGenerateTCFromHelpDesk: function () {\n\t\tvar thisInstance = this;\n\t\tvar sourceDesk = jQuery('input[name=\"sourceRecord\"]').val();\n\t\tvar moduleName = jQuery('input[name=\"sourceModule\"]').val();\n\t\tif (typeof sourceDesk !== \"undefined\") {\n\n\t\t\tvar params = {};\n\t\t\tparams.data = {module: 'OSSTimeControl', action: 'GetTCInfo', id: sourceDesk, sourceModule: moduleName};\n\t\t\tparams.async = false;\n\t\t\tparams.dataType = 'json';\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\t\tvar response = data['result'];\n\t\t\t\t\tif (response['success']) {\n\t\t\t\t\t\tvar sourceD = response.sourceData;\n\n\t\t\t\t\t\tif (moduleName == 'HelpDesk') {\n\t\t\t\t\t\t\tif ('contact_id' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid\"]').val(sourceD.contact_id);\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid_display\"]').val(thisInstance.replaceAll(sourceD.contact_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ('parent_id' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid\"]').val(sourceD.parent_id);\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid_display\"]').val(thisInstance.replaceAll(sourceD.account_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (moduleName == 'Project') {\n\t\t\t\t\t\t\tif ('contact_label' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid\"]').val(sourceD.contact_id);\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid_display\"]').val(thisInstance.replaceAll(sourceD.contact_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ('account_label' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid\"]').val(sourceD.linktoaccountscontacts);\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid_display\"]').val(thisInstance.replaceAll(sourceD.account_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\ttext: app.vtranslate('message'),\n\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t};\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify(params);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).fail(function () {\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttext: app.vtranslate('JS_ERROR_CONNECTING'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\tescapeRegExp: function (string) {\n\t\treturn string.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n\t},\n\n\treplaceAll: function (string, find, replace) {\n\t\tvar thisInstance = this;\n\t\tstring = string.replace(new RegExp(thisInstance.escapeRegExp('&Oacute;'), 'g'), 'Ó');\n\t\treturn string.replace(new RegExp(thisInstance.escapeRegExp(find), 'g'), replace);\n\t},\n\tregisterBasicEvents: function (container) {\n\t\tthis._super(container);\n\t\tthis.registerRecordPreSaveEvent(container);\n\t},\n\tregisterEvents: function () {\n\t\tthis._super();\n\t\tthis.registerGenerateTCFieldTimeAndCost();\n\t\tthis.registerGenerateTCFromHelpDesk();\n\t}\n});\n"],"names":["Vtiger_Edit_Js","thisInstance","this","attr","css","form","getForm","sumeTime","differenceDays","hours","Math","ceil","toFixed","val","on","round","container","firstDate","find","firstDateFormat","data","firstDateValue","secondDate","secondDateFormat","secondDateValue","firstTime","secondTime","firstDateTimeValue","secondDateTimeValue","firstDateInstance","Vtiger_Helper_Js","getDateInstance","timeBetweenDates","err","$","length","recordPreSave","e","sumeTime2","parametres","app","vtranslate","showPnotify","getMainParams","submit","sourceDesk","jQuery","moduleName","params","module","action","id","sourceModule","async","dataType","request","done","response","sourceD","sourceData","contact_id","replaceAll","contact_label","prop","parent_id","account_label","linktoaccountscontacts","fail","string","replace","RegExp","escapeRegExp","_super","registerRecordPreSaveEvent","registerGenerateTCFieldTimeAndCost","registerGenerateTCFromHelpDesk"],"mappings":"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"}