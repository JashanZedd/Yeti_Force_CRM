{"version":3,"file":"Edit.min.js","sources":["Edit.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nVtiger_Edit_Js(\"OSSTimeControl_Edit_Js\", {}, {\n\n\tregisterGenerateTCFieldTimeAndCost: function () {\n\t\tvar thisInstance = this;\n\t\t$('input[name=\"sum_time\"]').attr('readonly', 'readonly').css('width', '80px');\n\t\tvar form = thisInstance.getForm();\n\t\tvar sumeTime = thisInstance.differenceDays(form);\n\t\tvar hours = (Math.ceil((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\n\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\tjQuery('.dateField').on('change', function () {\n\t\t\tsumeTime = thisInstance.differenceDays(form);\n\t\t\tif (sumeTime == 'Error') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\thours = (Math.ceil((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\t\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\t});\n\t\tjQuery('.clockPicker').on('change', function () {\n\t\t\tsumeTime = thisInstance.differenceDays(form);\n\t\t\tif (sumeTime == 'Error') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\thours = (Math.round((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\t\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\t});\n\n\t},\n\n\tdifferenceDays: function (container) {\n\t\tvar firstDate = container.find('input[name=\"date_start\"]');\n\t\tvar firstDateFormat = firstDate.data('date-format');\n\t\tvar firstDateValue = firstDate.val();\n\t\tvar secondDate = container.find('input[name=\"due_date\"]');\n\t\tvar secondDateFormat = secondDate.data('date-format');\n\t\tvar secondDateValue = secondDate.val();\n\t\tvar firstTime = container.find('input[name=\"time_start\"]');\n\t\tvar secondTime = container.find('input[name=\"time_end\"]');\n\t\tvar firstTimeValue = firstTime.val();\n\t\tvar secondTimeValue = secondTime.val();\n\t\tvar firstDateTimeValue = firstDateValue + ' ' + firstTimeValue;\n\t\tvar secondDateTimeValue = secondDateValue + ' ' + secondTimeValue;\n\t\ttry {\n\t\t\tvar firstDateInstance = Vtiger_Helper_Js.getDateInstance(firstDateTimeValue, firstDateFormat);\n\t\t\tvar secondDateInstance = Vtiger_Helper_Js.getDateInstance(secondDateTimeValue, secondDateFormat);\n\t\t\tvar timeBetweenDates = secondDateInstance - firstDateInstance;\n\t\t\tif (timeBetweenDates >= 0) {\n\t\t\t\treturn timeBetweenDates;\n\t\t\t}\n\t\t} catch (err){\n\t\t\treturn 'Error';\n\t\t}\n\t\treturn 'Error';\n\t},\n\n\t/**\n\t * Function to register recordpresave event\n\t */\n\tregisterRecordPreSaveEvent: function (container) {\n\t\tvar thisInstance = this;\n\t\tvar form = $('.recordEditView[name=\"QuickCreate\"]');\n\t\tif (form.length == 0) {\n\t\t\tform = this.getForm();\n\t\t}\n\t\tform.on(Vtiger_Edit_Js.recordPreSave, function (e, data) {\n\t\t\tvar sumeTime2 = thisInstance.differenceDays(form);\n\t\t\tif (sumeTime2 == 'Error') {\n\t\t\t\tvar parametres = {\n\t\t\t\t\ttext: app.vtranslate('JS_DATE_SHOULD_BE_GREATER_THAN'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t};\n\t\t\t\tVtiger_Helper_Js.showPnotify(parametres);\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tif (app.getMainParams('disallowLongerThan24Hours')) {\n\t\t\t\t\tsumeTime2 = sumeTime2 / 1000 / 60 / 60;\n\t\t\t\t\tif (sumeTime2 > 24) {\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\ttext: app.vtranslate('JS_DATE_NOT_SHOULD_BE_GREATER_THAN_24H'),\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tform.submit();\n\t\t\t}\n\t\t});\n\t},\n\tregisterGenerateTCFromHelpDesk: function () {\n\t\tvar thisInstance = this;\n\t\tvar sourceDesk = jQuery('input[name=\"sourceRecord\"]').val();\n\t\tvar moduleName = jQuery('input[name=\"sourceModule\"]').val();\n\t\tif (typeof sourceDesk !== \"undefined\") {\n\n\t\t\tvar params = {};\n\t\t\tparams.data = {module: 'OSSTimeControl', action: 'GetTCInfo', id: sourceDesk, sourceModule: moduleName};\n\t\t\tparams.async = false;\n\t\t\tparams.dataType = 'json';\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\t\tvar response = data['result'];\n\t\t\t\t\tif (response['success']) {\n\t\t\t\t\t\tvar sourceD = response.sourceData;\n\n\t\t\t\t\t\tif (moduleName == 'HelpDesk') {\n\t\t\t\t\t\t\tif ('contact_id' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid\"]').val(sourceD.contact_id);\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid_display\"]').val(thisInstance.replaceAll(sourceD.contact_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ('parent_id' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid\"]').val(sourceD.parent_id);\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid_display\"]').val(thisInstance.replaceAll(sourceD.account_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (moduleName == 'Project') {\n\t\t\t\t\t\t\tif ('contact_label' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid\"]').val(sourceD.contact_id);\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid_display\"]').val(thisInstance.replaceAll(sourceD.contact_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ('account_label' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid\"]').val(sourceD.linktoaccountscontacts);\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid_display\"]').val(thisInstance.replaceAll(sourceD.account_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\ttext: app.vtranslate('message'),\n\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t};\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify(params);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).fail(function () {\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttext: app.vtranslate('JS_ERROR_CONNECTING'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\tescapeRegExp: function (string) {\n\t\treturn string.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n\t},\n\n\treplaceAll: function (string, find, replace) {\n\t\tvar thisInstance = this;\n\t\tstring = string.replace(new RegExp(thisInstance.escapeRegExp('&Oacute;'), 'g'), 'Ó');\n\t\treturn string.replace(new RegExp(thisInstance.escapeRegExp(find), 'g'), replace);\n\t},\n\tregisterBasicEvents: function (container) {\n\t\tthis._super(container);\n\t\tthis.registerRecordPreSaveEvent(container);\n\t},\n\tregisterEvents: function () {\n\t\tthis._super();\n\t\tthis.registerGenerateTCFieldTimeAndCost();\n\t\tthis.registerGenerateTCFromHelpDesk();\n\t}\n});\n"],"names":["Vtiger_Edit_Js","thisInstance","attr","css","form","getForm","sumeTime","differenceDays","hours","Math","ceil","toFixed","val","on","round","container","firstDate","find","firstDateFormat","data","firstDateValue","secondDate","secondDateFormat","secondDateValue","firstTime","secondTime","firstTimeValue","secondTimeValue","firstDateTimeValue","secondDateTimeValue","firstDateInstance","Vtiger_Helper_Js","getDateInstance","secondDateInstance","timeBetweenDates","err","$","length","recordPreSave","e","sumeTime2","parametres","app","vtranslate","showPnotify","getMainParams","submit","sourceDesk","jQuery","moduleName","params","module","action","id","sourceModule","async","dataType","request","done","response","sourceD","sourceData","contact_id","replaceAll","contact_label","prop","parent_id","account_label","linktoaccountscontacts","fail","string","replace","RegExp","escapeRegExp","_super","registerRecordPreSaveEvent","registerGenerateTCFieldTimeAndCost","registerGenerateTCFromHelpDesk"],"mappings":";;AAAA;AACA;AAEAA,eAAe,wBAAf,EAAyC,EAAzC,EAA6C;;qCAER,8CAAY;MAC3CC,eAAe,IAAnB;IACE,wBAAF,EAA4BC,IAA5B,CAAiC,UAAjC,EAA6C,UAA7C,EAAyDC,GAAzD,CAA6D,OAA7D,EAAsE,MAAtE;MACIC,OAAOH,aAAaI,OAAb,EAAX;MACIC,WAAWL,aAAaM,cAAb,CAA4BH,IAA5B,CAAf;MACII,QAAQ,CAACC,KAAKC,IAAL,CAAWJ,WAAW,OAAZ,GAAuB,GAAjC,IAAwC,GAAzC,EAA8CK,OAA9C,CAAsD,CAAtD,CAAZ;;SAEO,wBAAP,EAAiCC,GAAjC,CAAqCJ,KAArC;SACO,YAAP,EAAqBK,EAArB,CAAwB,QAAxB,EAAkC,YAAY;cAClCZ,aAAaM,cAAb,CAA4BH,IAA5B,CAAX;OACIE,YAAY,OAAhB,EAAyB;WACjB,KAAP;;WAEO,CAACG,KAAKC,IAAL,CAAWJ,WAAW,OAAZ,GAAuB,GAAjC,IAAwC,GAAzC,EAA8CK,OAA9C,CAAsD,CAAtD,CAAR;UACO,wBAAP,EAAiCC,GAAjC,CAAqCJ,KAArC;GAND;SAQO,cAAP,EAAuBK,EAAvB,CAA0B,QAA1B,EAAoC,YAAY;cACpCZ,aAAaM,cAAb,CAA4BH,IAA5B,CAAX;OACIE,YAAY,OAAhB,EAAyB;WACjB,KAAP;;WAEO,CAACG,KAAKK,KAAL,CAAYR,WAAW,OAAZ,GAAuB,GAAlC,IAAyC,GAA1C,EAA+CK,OAA/C,CAAuD,CAAvD,CAAR;UACO,wBAAP,EAAiCC,GAAjC,CAAqCJ,KAArC;GAND;EAlB2C;;iBA6B5B,wBAAUO,SAAV,EAAqB;MAChCC,YAAYD,UAAUE,IAAV,CAAe,0BAAf,CAAhB;MACIC,kBAAkBF,UAAUG,IAAV,CAAe,aAAf,CAAtB;MACIC,iBAAiBJ,UAAUJ,GAAV,EAArB;MACIS,aAAaN,UAAUE,IAAV,CAAe,wBAAf,CAAjB;MACIK,mBAAmBD,WAAWF,IAAX,CAAgB,aAAhB,CAAvB;MACII,kBAAkBF,WAAWT,GAAX,EAAtB;MACIY,YAAYT,UAAUE,IAAV,CAAe,0BAAf,CAAhB;MACIQ,aAAaV,UAAUE,IAAV,CAAe,wBAAf,CAAjB;MACIS,iBAAiBF,UAAUZ,GAAV,EAArB;MACIe,kBAAkBF,WAAWb,GAAX,EAAtB;MACIgB,qBAAqBR,iBAAiB,GAAjB,GAAuBM,cAAhD;MACIG,sBAAsBN,kBAAkB,GAAlB,GAAwBI,eAAlD;MACI;OACCG,oBAAoBC,iBAAiBC,eAAjB,CAAiCJ,kBAAjC,EAAqDV,eAArD,CAAxB;OACIe,qBAAqBF,iBAAiBC,eAAjB,CAAiCH,mBAAjC,EAAsDP,gBAAtD,CAAzB;OACIY,mBAAmBD,qBAAqBH,iBAA5C;OACII,oBAAoB,CAAxB,EAA2B;WACnBA,gBAAP;;GALF,CAOE,OAAOC,GAAP,EAAW;UACL,OAAP;;SAEM,OAAP;EApD2C;;;;;6BA0DhB,oCAAUpB,SAAV,EAAqB;MAC5Cd,eAAe,IAAnB;MACIG,OAAOgC,EAAE,qCAAF,CAAX;MACIhC,KAAKiC,MAAL,IAAe,CAAnB,EAAsB;UACd,KAAKhC,OAAL,EAAP;;OAEIQ,EAAL,CAAQb,eAAesC,aAAvB,EAAsC,UAAUC,CAAV,EAAapB,IAAb,EAAmB;OACpDqB,YAAYvC,aAAaM,cAAb,CAA4BH,IAA5B,CAAhB;OACIoC,aAAa,OAAjB,EAA0B;QACrBC,aAAa;WACVC,IAAIC,UAAJ,CAAe,gCAAf,CADU;WAEV;KAFP;qBAIiBC,WAAjB,CAA6BH,UAA7B;WACO,KAAP;IAND,MAOO;QACFC,IAAIG,aAAJ,CAAkB,2BAAlB,CAAJ,EAAoD;iBACvCL,YAAY,IAAZ,GAAmB,EAAnB,GAAwB,EAApC;SACIA,YAAY,EAAhB,EAAoB;uBACFI,WAAjB,CAA6B;aACtBF,IAAIC,UAAJ,CAAe,wCAAf,CADsB;aAEtB;OAFP;aAIO,KAAP;;;SAGGG,MAAL;;GApBF;EAhE2C;iCAwFZ,0CAAY;MACvC7C,eAAe,IAAnB;MACI8C,aAAaC,OAAO,4BAAP,EAAqCpC,GAArC,EAAjB;MACIqC,aAAaD,OAAO,4BAAP,EAAqCpC,GAArC,EAAjB;MACI,OAAOmC,UAAP,KAAsB,WAA1B,EAAuC;;OAElCG,SAAS,EAAb;UACO/B,IAAP,GAAc,EAACgC,QAAQ,gBAAT,EAA2BC,QAAQ,WAAnC,EAAgDC,IAAIN,UAApD,EAAgEO,cAAcL,UAA9E,EAAd;UACOM,KAAP,GAAe,KAAf;UACOC,QAAP,GAAkB,MAAlB;gBACaC,OAAb,CAAqBP,MAArB,EAA6BQ,IAA7B,CAAkC,UAAUvC,IAAV,EAAgB;QAC5CwC,WAAWxC,KAAK,QAAL,CAAf;QACIwC,SAAS,SAAT,CAAJ,EAAyB;SACpBC,UAAUD,SAASE,UAAvB;;SAEIZ,cAAc,UAAlB,EAA8B;UACzB,gBAAgBW,OAApB,EAA6B;cACrB,oBAAP,EAA6BhD,GAA7B,CAAiCgD,QAAQE,UAAzC;cACO,4BAAP,EAAqClD,GAArC,CAAyCX,aAAa8D,UAAb,CAAwBH,QAAQI,aAAhC,EAA+C,UAA/C,EAA2D,GAA3D,CAAzC,EAA0GC,IAA1G,CAA+G,UAA/G,EAA2H,IAA3H;;UAEG,eAAeL,OAAnB,EAA4B;cACpB,oBAAP,EAA6BhD,GAA7B,CAAiCgD,QAAQM,SAAzC;cACO,4BAAP,EAAqCtD,GAArC,CAAyCX,aAAa8D,UAAb,CAAwBH,QAAQO,aAAhC,EAA+C,UAA/C,EAA2D,GAA3D,CAAzC,EAA0GF,IAA1G,CAA+G,UAA/G,EAA2H,IAA3H;;MAPF,MASO,IAAIhB,cAAc,SAAlB,EAA6B;UAC/B,mBAAmBW,OAAvB,EAAgC;cACxB,oBAAP,EAA6BhD,GAA7B,CAAiCgD,QAAQE,UAAzC;cACO,4BAAP,EAAqClD,GAArC,CAAyCX,aAAa8D,UAAb,CAAwBH,QAAQI,aAAhC,EAA+C,UAA/C,EAA2D,GAA3D,CAAzC,EAA0GC,IAA1G,CAA+G,UAA/G,EAA2H,IAA3H;;UAEG,mBAAmBL,OAAvB,EAAgC;cACxB,oBAAP,EAA6BhD,GAA7B,CAAiCgD,QAAQQ,sBAAzC;cACO,4BAAP,EAAqCxD,GAArC,CAAyCX,aAAa8D,UAAb,CAAwBH,QAAQO,aAAhC,EAA+C,UAA/C,EAA2D,GAA3D,CAAzC,EAA0GF,IAA1G,CAA+G,UAA/G,EAA2H,IAA3H;;;KAnBH,MAuBO;SACFf,SAAS;YACNR,IAAIC,UAAJ,CAAe,SAAf,CADM;YAEN;MAFP;sBAIiBC,WAAjB,CAA6BM,MAA7B;;IA9BH,EAiCEmB,IAjCF,CAiCO,YAAY;qBACDzB,WAAjB,CAA6B;WACtBF,IAAIC,UAAJ,CAAe,qBAAf,CADsB;WAEtB;KAFP;IAlCD;;EAlG0C;;eA4I9B,sBAAU2B,MAAV,EAAkB;SACxBA,OAAOC,OAAP,CAAe,6BAAf,EAA8C,MAA9C,CAAP;EA7I2C;;aAgJhC,oBAAUD,MAAV,EAAkBrD,IAAlB,EAAwBsD,OAAxB,EAAiC;MACxCtE,eAAe,IAAnB;WACSqE,OAAOC,OAAP,CAAe,IAAIC,MAAJ,CAAWvE,aAAawE,YAAb,CAA0B,UAA1B,CAAX,EAAkD,GAAlD,CAAf,EAAuE,GAAvE,CAAT;SACOH,OAAOC,OAAP,CAAe,IAAIC,MAAJ,CAAWvE,aAAawE,YAAb,CAA0BxD,IAA1B,CAAX,EAA4C,GAA5C,CAAf,EAAiEsD,OAAjE,CAAP;EAnJ2C;sBAqJvB,6BAAUxD,SAAV,EAAqB;OACpC2D,MAAL,CAAY3D,SAAZ;OACK4D,0BAAL,CAAgC5D,SAAhC;EAvJ2C;iBAyJ5B,0BAAY;OACtB2D,MAAL;OACKE,kCAAL;OACKC,8BAAL;;CA5JF"}