"use strict";Vtiger_Edit_Js("OSSTimeControl_Edit_Js",{},{registerGenerateTCFieldTimeAndCost:function(){var thisInstance=this;$('input[name="sum_time"]').attr("readonly","readonly").css("width","80px");var form=thisInstance.getForm(),sumeTime=thisInstance.differenceDays(form),hours=(Math.ceil(sumeTime/36e5*100)/100).toFixed(2);jQuery('input[name="sum_time"]').val(hours),jQuery(".dateField").on("change",(function(){if("Error"==(sumeTime=thisInstance.differenceDays(form)))return!1;hours=(Math.ceil(sumeTime/36e5*100)/100).toFixed(2),jQuery('input[name="sum_time"]').val(hours)})),jQuery(".clockPicker").on("change",(function(){if("Error"==(sumeTime=thisInstance.differenceDays(form)))return!1;hours=(Math.round(sumeTime/36e5*100)/100).toFixed(2),jQuery('input[name="sum_time"]').val(hours)}))},differenceDays:function(container){var firstDate=container.find('input[name="date_start"]'),firstDateFormat=firstDate.data("date-format"),firstDateValue=firstDate.val(),secondDate=container.find('input[name="due_date"]'),secondDateFormat=secondDate.data("date-format"),secondDateValue=secondDate.val(),firstTime=container.find('input[name="time_start"]'),secondTime=container.find('input[name="time_end"]'),firstDateTimeValue=firstDateValue+" "+firstTime.val(),secondDateTimeValue=secondDateValue+" "+secondTime.val();try{var firstDateInstance=Vtiger_Helper_Js.getDateInstance(firstDateTimeValue,firstDateFormat),timeBetweenDates=Vtiger_Helper_Js.getDateInstance(secondDateTimeValue,secondDateFormat)-firstDateInstance;if(timeBetweenDates>=0)return timeBetweenDates}catch(err){return"Error"}return"Error"},registerRecordPreSaveEvent:function(container){var thisInstance=this,form=$('.recordEditView[name="QuickCreate"]');0==form.length&&(form=this.getForm()),form.on(Vtiger_Edit_Js.recordPreSave,(function(e,data){var sumeTime2=thisInstance.differenceDays(form);if("Error"==sumeTime2){var parametres={text:app.vtranslate("JS_DATE_SHOULD_BE_GREATER_THAN"),type:"error"};return Vtiger_Helper_Js.showPnotify(parametres),!1}if(app.getMainParams("disallowLongerThan24Hours")&&(sumeTime2=sumeTime2/1e3/60/60)>24)return Vtiger_Helper_Js.showPnotify({text:app.vtranslate("JS_DATE_NOT_SHOULD_BE_GREATER_THAN_24H"),type:"error"}),!1;form.submit()}))},registerGenerateTCFromHelpDesk:function(){var thisInstance=this,sourceDesk=jQuery('input[name="sourceRecord"]').val(),moduleName=jQuery('input[name="sourceModule"]').val();if(void 0!==sourceDesk){var params={};params.data={module:"OSSTimeControl",action:"GetTCInfo",id:sourceDesk,sourceModule:moduleName},params.async=!1,params.dataType="json",AppConnector.request(params).done((function(data){var response=data.result;if(response.success){var sourceD=response.sourceData;"HelpDesk"==moduleName?("contact_id"in sourceD&&(jQuery('[name="contactid"]').val(sourceD.contact_id),jQuery('[name="contactid_display"]').val(thisInstance.replaceAll(sourceD.contact_label,"&oacute;","ó")).prop("readonly",!0)),"parent_id"in sourceD&&(jQuery('[name="accountid"]').val(sourceD.parent_id),jQuery('[name="accountid_display"]').val(thisInstance.replaceAll(sourceD.account_label,"&oacute;","ó")).prop("readonly",!0))):"Project"==moduleName&&("contact_label"in sourceD&&(jQuery('[name="contactid"]').val(sourceD.contact_id),jQuery('[name="contactid_display"]').val(thisInstance.replaceAll(sourceD.contact_label,"&oacute;","ó")).prop("readonly",!0)),"account_label"in sourceD&&(jQuery('[name="accountid"]').val(sourceD.linktoaccountscontacts),jQuery('[name="accountid_display"]').val(thisInstance.replaceAll(sourceD.account_label,"&oacute;","ó")).prop("readonly",!0)))}else{var params={text:app.vtranslate("message"),type:"error"};Vtiger_Helper_Js.showPnotify(params)}})).fail((function(){Vtiger_Helper_Js.showPnotify({text:app.vtranslate("JS_ERROR_CONNECTING"),type:"error"})}))}},escapeRegExp:function(string){return string.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},replaceAll:function(string,find,replace){return(string=string.replace(new RegExp(this.escapeRegExp("&Oacute;"),"g"),"Ó")).replace(new RegExp(this.escapeRegExp(find),"g"),replace)},registerBasicEvents:function(container){this._super(container),this.registerRecordPreSaveEvent(container)},registerEvents:function(){this._super(),this.registerGenerateTCFieldTimeAndCost(),this.registerGenerateTCFromHelpDesk()}});
//# sourceMappingURL=Edit.min.js.map
