{"version":3,"file":"outlookMessageCompose.min.js","sources":["outlookMessageCompose.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nconst MailIntegration_Compose = {\n\t/**\n\t * AppConnector wrapper\n\t *\n\t * @param   {object}  request\n\t *\n\t * @return  {object}           AppConnector object with done method\n\t */\n\tconnector(request) {\n\t\treturn AppConnector.request(request).fail(error => {\n\t\t\tthis.showResponseMessage(false);\n\t\t});\n\t},\n\t/**\n\t * Show response message\n\t *\n\t * @param   {boolean}  success\n\t * @param   {string}  message\n\t */\n\tshowResponseMessage(success, message = '') {\n\t\tif (success) {\n\t\t\tOffice.context.mailbox.item.notificationMessages.replaceAsync('information', {\n\t\t\t\ttype: 'informationalMessage',\n\t\t\t\tmessage: message,\n\t\t\t\ticon: 'iconid',\n\t\t\t\tpersistent: false\n\t\t\t});\n\t\t} else {\n\t\t\tOffice.context.mailbox.item.notificationMessages.replaceAsync('error', {\n\t\t\t\ttype: 'errorMessage',\n\t\t\t\tmessage: app.vtranslate('JS_ERROR') + ' ' + message\n\t\t\t});\n\t\t}\n\t},\n\t/**\n\t * Registered autocomplete template\n\t *\n\t * @return  {object}  overwrite ui-autocomplete list item template\n\t */\n\tregisterAutocompleteTemplate() {\n\t\t$.widget('ui.autocomplete', $.ui.autocomplete, {\n\t\t\t_renderItem: function(ul, item) {\n\t\t\t\tconst listItemTemplate = user => {\n\t\t\t\t\treturn `\n\t\t\t\t\t\t\t<li class=\"c-search-item js-search-item\">\n\t\t\t\t\t\t\t\t<div class=\"d-flex flex-nowrap\">\n\t\t\t\t\t\t\t\t\t<div class=\"d-flex flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"u-font-size-14px\">\n\t\t\t\t\t\t\t\t\t\t\t${user.name}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"c-search-item__mail small\">\n\t\t\t\t\t\t\t\t\t\t\t${user.mail}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"btn-group flex-nowrap align-items-center\">\n\t\t\t\t\t\t\t\t\t\t<button class=\"c-search-item__btn btn btn-xs btn-outline-primary\" data-copy-target=\"cc\">\n\t\t\t\t\t\t\t\t\t\t\t${app.vtranslate('JS_CC')}\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t<button class=\"c-search-item__btn btn btn-xs btn-outline-primary\" data-copy-target=\"bcc\">\n\t\t\t\t\t\t\t\t\t\t\t${app.vtranslate('JS_BCC')}\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>`;\n\t\t\t\t};\n\t\t\t\treturn $(listItemTemplate(item)).appendTo(ul);\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Register autocomplete\n\t *\n\t * @return  {object}  autocomplete instance\n\t */\n\tregisterAutocomplete() {\n\t\treturn this.container.find('.js-search-input').autocomplete({\n\t\t\tdelay: '600',\n\t\t\tminLength: '3',\n\t\t\tclasses: {\n\t\t\t\t'ui-autocomplete': 'mobile'\n\t\t\t},\n\t\t\tsource: this.findEmail.bind(this),\n\t\t\tselect: this.onSelectRecipient.bind(this)\n\t\t});\n\t},\n\t/**\n\t * Find mail action for autocomplete source\n\t *\n\t * @param   {object}  request   autocomplete param\n\t * @param   {fuction}  callBack  autocomplete callBack\n\t */\n\tfindEmail(request, callBack) {\n\t\tthis.connector({\n\t\t\tmodule: 'MailIntegration',\n\t\t\taction: 'Mail',\n\t\t\tmode: 'findEmail',\n\t\t\tsearch: request.term\n\t\t}).done(responseData => {\n\t\t\tconst data = responseData.result.map(user => {\n\t\t\t\tlet userData = user.split(' <');\n\t\t\t\tconst name = userData[0];\n\t\t\t\tconst mail = userData[1].slice(0, -1);\n\t\t\t\treturn { name, mail };\n\t\t\t});\n\t\t\tcallBack(data);\n\t\t});\n\t},\n\t/**\n\t * [onRecipientSelect description]\n\t *\n\t * @param   {object}  toElement  html node object\n\t * @param   {object}  item       selected item object\n\t */\n\tonSelectRecipient({ toElement }, { item }) {\n\t\tconst newRecipient = [\n\t\t\t{\n\t\t\t\tdisplayName: item.name,\n\t\t\t\temailAddress: item.mail\n\t\t\t}\n\t\t];\n\t\tconst recipientsField = toElement.dataset.copyTarget ? toElement.dataset.copyTarget : 'to';\n\t\tthis.copyRecipient(recipientsField, newRecipient);\n\t},\n\t/**\n\t * Copy recipient to outlook field\n\t *\n\t * @param   {string}  recipientsField  to, cc, bcc\n\t * @param   {object}  newRecipient\n\t */\n\tcopyRecipient(recipientsField, newRecipient) {\n\t\tOffice.context.mailbox.item[recipientsField].addAsync(newRecipient, function(result) {\n\t\t\tif (result.error) {\n\t\t\t\tOffice.context.mailbox.item.notificationMessages.replaceAsync('error', {\n\t\t\t\t\ttype: 'errorMessage',\n\t\t\t\t\tmessage: app.vtranslate('JS_ERROR') + ' ' + result.error\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\tregisterEvents() {\n\t\tif (!$('.js-exception-error').length) {\n\t\t\tthis.container = $('#page');\n\t\t\tthis.registerAutocompleteTemplate();\n\t\t\tthis.registerAutocomplete();\n\t\t}\n\t}\n};\n(function($) {\n\tOffice.onReady(info => {\n\t\tif (info.host === Office.HostType.Outlook) {\n\t\t\tMailIntegration_Compose.registerEvents();\n\t\t}\n\t});\n})($);\n"],"names":["MailIntegration_Compose","request","AppConnector","fail","showResponseMessage","success","message","context","mailbox","item","notificationMessages","replaceAsync","app","vtranslate","widget","$","ui","autocomplete","ul","listItemTemplate","user","name","mail","appendTo","container","find","findEmail","bind","onSelectRecipient","callBack","connector","term","done","data","responseData","result","map","userData","split","slice","toElement","newRecipient","recipientsField","dataset","copyTarget","copyRecipient","addAsync","error","length","registerAutocompleteTemplate","registerAutocomplete","onReady","info","host","Office","HostType","Outlook","registerEvents"],"mappings":";;AAAA;AACA;AAEA,IAAMA,0BAA0B;;;;;;;;UAAA,qBAQrBC,OARqB,EAQZ;;;SACXC,aAAaD,OAAb,CAAqBA,OAArB,EAA8BE,IAA9B,CAAmC,iBAAS;SAC7CC,mBAAL,CAAyB,KAAzB;GADM,CAAP;EAT8B;;;;;;;;oBAAA,+BAmBXC,OAnBW,EAmBY;MAAdC,OAAc,uEAAJ,EAAI;;MACtCD,OAAJ,EAAa;UACLE,OAAP,CAAeC,OAAf,CAAuBC,IAAvB,CAA4BC,oBAA5B,CAAiDC,YAAjD,CAA8D,aAA9D,EAA6E;UACtE,sBADsE;aAEnEL,OAFmE;UAGtE,QAHsE;gBAIhE;IAJb;GADD,MAOO;UACCC,OAAP,CAAeC,OAAf,CAAuBC,IAAvB,CAA4BC,oBAA5B,CAAiDC,YAAjD,CAA8D,OAA9D,EAAuE;UAChE,cADgE;aAE7DC,IAAIC,UAAJ,CAAe,UAAf,IAA6B,GAA7B,GAAmCP;IAF7C;;EA5B6B;;;;;;;6BAAA,0CAuCA;IAC5BQ,MAAF,CAAS,iBAAT,EAA4BC,EAAEC,EAAF,CAAKC,YAAjC,EAA+C;gBACjC,qBAASC,EAAT,EAAaT,IAAb,EAAmB;QACzBU,mBAAmB,SAAnBA,gBAAmB,OAAQ;0PAMxBC,KAAKC,IALb,yHAQQD,KAAKE,IARb,8QAaQV,IAAIC,UAAJ,CAAe,OAAf,CAbR,8KAgBQD,IAAIC,UAAJ,CAAe,QAAf,CAhBR;KADD;WAuBOE,EAAEI,iBAAiBV,IAAjB,CAAF,EAA0Bc,QAA1B,CAAmCL,EAAnC,CAAP;;GAzBF;EAxC8B;;;;;;;qBAAA,kCA0ER;SACf,KAAKM,SAAL,CAAeC,IAAf,CAAoB,kBAApB,EAAwCR,YAAxC,CAAqD;UACpD,KADoD;cAEhD,GAFgD;YAGlD;uBACW;IAJuC;WAMnD,KAAKS,SAAL,CAAeC,IAAf,CAAoB,IAApB,CANmD;WAOnD,KAAKC,iBAAL,CAAuBD,IAAvB,CAA4B,IAA5B;GAPF,CAAP;EA3E8B;;;;;;;;UAAA,qBA2FrB1B,OA3FqB,EA2FZ4B,QA3FY,EA2FF;OACvBC,SAAL,CAAe;WACN,iBADM;WAEN,MAFM;SAGR,WAHQ;WAIN7B,QAAQ8B;GAJjB,EAKGC,IALH,CAKQ,wBAAgB;OACjBC,OAAOC,aAAaC,MAAb,CAAoBC,GAApB,CAAwB,gBAAQ;QACxCC,WAAWjB,KAAKkB,KAAL,CAAW,IAAX,CAAf;QACMjB,OAAOgB,SAAS,CAAT,CAAb;QACMf,OAAOe,SAAS,CAAT,EAAYE,KAAZ,CAAkB,CAAlB,EAAqB,CAAC,CAAtB,CAAb;WACO,EAAElB,UAAF,EAAQC,UAAR,EAAP;IAJY,CAAb;YAMSW,IAAT;GAZD;EA5F8B;;;;;;;;kBAAA,0CAiHY;MAAvBO,SAAuB,QAAvBA,SAAuB;MAAR/B,IAAQ,SAARA,IAAQ;;MACpCgC,eAAe,CACpB;gBACchC,KAAKY,IADnB;iBAEeZ,KAAKa;GAHA,CAArB;MAMMoB,kBAAkBF,UAAUG,OAAV,CAAkBC,UAAlB,GAA+BJ,UAAUG,OAAV,CAAkBC,UAAjD,GAA8D,IAAtF;OACKC,aAAL,CAAmBH,eAAnB,EAAoCD,YAApC;EAzH8B;;;;;;;;cAAA,yBAiIjBC,eAjIiB,EAiIAD,YAjIA,EAiIc;SACrClC,OAAP,CAAeC,OAAf,CAAuBC,IAAvB,CAA4BiC,eAA5B,EAA6CI,QAA7C,CAAsDL,YAAtD,EAAoE,UAASN,MAAT,EAAiB;OAChFA,OAAOY,KAAX,EAAkB;WACVxC,OAAP,CAAeC,OAAf,CAAuBC,IAAvB,CAA4BC,oBAA5B,CAAiDC,YAAjD,CAA8D,OAA9D,EAAuE;WAChE,cADgE;cAE7DC,IAAIC,UAAJ,CAAe,UAAf,IAA6B,GAA7B,GAAmCsB,OAAOY;KAFpD;;GAFF;EAlI8B;eAAA,4BA2Id;MACZ,CAAChC,EAAE,qBAAF,EAAyBiC,MAA9B,EAAsC;QAChCxB,SAAL,GAAiBT,EAAE,OAAF,CAAjB;QACKkC,4BAAL;QACKC,oBAAL;;;CA/IH;AAmJA,CAAC,UAASnC,CAAT,EAAY;QACLoC,OAAP,CAAe,gBAAQ;MAClBC,KAAKC,IAAL,KAAcC,OAAOC,QAAP,CAAgBC,OAAlC,EAA2C;2BAClBC,cAAxB;;EAFF;CADD,EAMG1C,CANH"}