{"version":3,"file":"Detail.min.js","sources":["Detail.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nVtiger_Detail_Js(\"Contacts_Detail_Js\", {}, {\n\thierarchyResponseCache: {},\n\t/**\n\t * Function to register recordpresave event\n\t */\n\tregisterRecordPreSaveEvent: function (form) {\n\t\tvar primaryEmailField = jQuery('[name=\"email\"]');\n\t\tif (typeof form === \"undefined\") {\n\t\t\tform = this.getForm();\n\t\t}\n\n\t\tform.on(this.fieldPreSave, '[name=\"portal\"]', function (e, data) {\n\t\t\tvar portalField = jQuery(e.currentTarget);\n\n\t\t\tvar primaryEmailValue = primaryEmailField.val();\n\t\t\tvar isAlertAlreadyShown = jQuery('.ui-pnotify').length;\n\n\n\t\t\tif (portalField.is(':checked')) {\n\t\t\t\tif (primaryEmailField.length == 0) {\n\t\t\t\t\tif (isAlertAlreadyShown <= 0) {\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify(app.vtranslate('JS_PRIMARY_EMAIL_FIELD_DOES_NOT_EXISTS'));\n\t\t\t\t\t}\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t\tif (primaryEmailValue == \"\") {\n\t\t\t\t\tif (isAlertAlreadyShown <= 0) {\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify(app.vtranslate('JS_PLEASE_ENTER_PRIMARY_EMAIL_VALUE_TO_ENABLE_PORTAL_USER'));\n\t\t\t\t\t}\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Function to get response from hierarchy\n\t * @param {array} params\n\t * @returns {*|jQuery}\n\t */\n\tgetHierarchyResponseData: function (params) {\n\t\tlet thisInstance = this,\n\t\t\taDeferred = jQuery.Deferred();\n\n\t\tif (!($.isEmptyObject(thisInstance.hierarchyResponseCache))) {\n\t\t\taDeferred.resolve(thisInstance.hierarchyResponseCache);\n\t\t} else {\n\t\t\tAppConnector.request(params).then(\n\t\t\t\tfunction (data) {\n\t\t\t\t\tthisInstance.hierarchyResponseCache = data;\n\t\t\t\t\taDeferred.resolve(thisInstance.hierarchyResponseCache);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn aDeferred.promise();\n\t},\n\t/**\n\t * function to display the hierarchy response data\n\t * @param {array} data\n\t */\n\tdisplayHierarchyResponseData: function (data) {\n\t\tlet callbackFunction = function () {\n\t\t\tapp.showScrollBar(jQuery('#hierarchyScroll'), {\n\t\t\t\theight: '300px',\n\t\t\t\trailVisible: true,\n\t\t\t\tsize: '6px'\n\t\t\t});\n\t\t};\n\t\tapp.showModalWindow(data, function () {\n\t\t\tif (typeof callbackFunction == 'function' && $(\"#hierarchyScroll\").height() > 300) {\n\t\t\t\tcallbackFunction();\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Registers read count of hierarchy if it is possoble\n\t */\n\tregisterHierarchyRecordCount: function () {\n\t\tlet hierarchyButton = $('.js-detail-hierarchy'),\n\t\t\tparams = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'RelationAjax',\n\t\t\t\trecord: app.getRecordId(),\n\t\t\t\tmode: 'getHierarchyCount'\n\t\t\t};\n\t\tif (hierarchyButton.length) {\n\t\t\tAppConnector.request(params).then(function (response) {\n\t\t\t\tif (response.success) {\n\t\t\t\t\t$('.hierarchy .badge').html(response.result);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\t/**\n\t * Shows hierarchy\n\t */\n\tregisterShowHierarchy: function () {\n\t\tlet thisInstance = this,\n\t\t\thierarchyButton = $('.detailViewTitle'),\n\t\t\tparams = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\tview: 'Hierarchy',\n\t\t\t\trecord: app.getRecordId()\n\t\t\t};\n\t\thierarchyButton.on('click', '.js-detail-hierarchy', function () {\n\t\t\tlet progressIndicatorElement = $.progressIndicator({\n\t\t\t\t'position': 'html',\n\t\t\t\t'blockInfo': {\n\t\t\t\t\t'enabled': true\n\t\t\t\t}\n\t\t\t});\n\t\t\tthisInstance.getHierarchyResponseData(params).then(function (data) {\n\t\t\t\tthisInstance.displayHierarchyResponseData(data);\n\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t});\n\t\t});\n\t},\n\t/**\n\t * Function which will register all the events\n\t */\n\tregisterEvents: function () {\n\t\tvar form = this.getForm();\n\t\tthis._super();\n\t\tthis.registerHierarchyRecordCount();\n\t\tthis.registerShowHierarchy();\n\t\tthis.registerRecordPreSaveEvent(form);\n\t}\n});\n"],"names":["Vtiger_Detail_Js","form","primaryEmailField","jQuery","getForm","on","fieldPreSave","e","data","portalField","currentTarget","primaryEmailValue","val","isAlertAlreadyShown","length","is","showPnotify","app","vtranslate","preventDefault","params","thisInstance","aDeferred","Deferred","$","isEmptyObject","hierarchyResponseCache","resolve","request","then","promise","callbackFunction","showScrollBar","showModalWindow","height","hierarchyButton","getModuleName","getRecordId","response","success","html","result","progressIndicatorElement","progressIndicator","getHierarchyResponseData","displayHierarchyResponseData","_super","registerHierarchyRecordCount","registerShowHierarchy","registerRecordPreSaveEvent"],"mappings":"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"}