{"version":3,"file":"Detail.min.js","sources":["Detail.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nVtiger_Detail_Js(\"Accounts_Detail_Js\", {}, {\n\t//It stores the Account Hierarchy response data\n\taccountHierarchyResponseCache: {},\n\t/*\n\t * function to get the AccountHierarchy response data\n\t */\n\tgetAccountHierarchyResponseData: function (params) {\n\t\tvar thisInstance = this;\n\t\tvar aDeferred = jQuery.Deferred();\n\n\t\t//Check in the cache\n\t\tif (!(jQuery.isEmptyObject(thisInstance.accountHierarchyResponseCache))) {\n\t\t\taDeferred.resolve(thisInstance.accountHierarchyResponseCache);\n\t\t} else {\n\t\t\tAppConnector.request(params).done(\n\t\t\t\tfunction (data) {\n\t\t\t\t\t//store it in the cache, so that we dont do multiple request\n\t\t\t\t\tthisInstance.accountHierarchyResponseCache = data;\n\t\t\t\t\taDeferred.resolve(thisInstance.accountHierarchyResponseCache);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn aDeferred.promise();\n\t},\n\tregisterButtons: function (container) {\n\t\tcontainer.find('.toChangeBtn').on('click', function (e) {\n\t\t\tvar currentTarget = $(e.currentTarget);\n\t\t\tvar fieldname = currentTarget.data('fieldname');\n\t\t\tvar params = {\n\t\t\t\tvalue: currentTarget.hasClass('btn-success') ? 0 : 1,\n\t\t\t\tfield: fieldname,\n\t\t\t\trecord: currentTarget.data('recordId'),\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'SaveAjax'\n\t\t\t};\n\t\t\tAppConnector.request(params).done(\n\t\t\t\tfunction (data) {\n\t\t\t\t\tif (currentTarget.hasClass('btn-warning')) {\n\t\t\t\t\t\tcurrentTarget.removeClass('btn-warning');\n\t\t\t\t\t\tcurrentTarget.addClass('btn-success');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrentTarget.addClass('btn-warning');\n\t\t\t\t\t\tcurrentTarget.removeClass('btn-success');\n\t\t\t\t\t}\n\t\t\t\t\tcurrentTarget.html(data.result[fieldname].display_value);\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\ttitle: app.vtranslate('JS_LBL_PERMISSION'),\n\t\t\t\t\t\ttext: app.vtranslate('JS_SAVE_NOTIFY_OK'),\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t},\n\t/*\n\t * function to display the AccountHierarchy response data\n\t */\n\tdisplayAccountHierarchyResponseData: function (data) {\n\t\tvar thisInstance = this;\n\t\tapp.showModalWindow(data, function (container) {\n\t\t\tvar bodyModal = container.find('.maxHeightModal');\n\t\t\tapp.showScrollBar(bodyModal, {\n\t\t\t\theight: bodyModal.height,\n\t\t\t\trailVisible: true,\n\t\t\t\tsize: '6px'\n\t\t\t});\n\t\t\tthisInstance.registerButtons(container);\n\t\t});\n\t},\n\tregisterHierarchyRecordCount: function () {\n\t\tvar hierarchyButton = $('.detailViewTitle .hierarchy');\n\t\tif (hierarchyButton.length) {\n\t\t\tvar params = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'RelationAjax',\n\t\t\t\trecord: app.getRecordId(),\n\t\t\t\tmode: 'getHierarchyCount',\n\t\t\t};\n\t\t\tAppConnector.request(params).done(function (response) {\n\t\t\t\tif (response.success) {\n\t\t\t\t\t$('.detailViewTitle .hierarchy .badge').html(response.result);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\tregisterShowHierarchy: function () {\n\t\tvar thisInstance = this;\n\t\tvar hierarchyButton = $('.detailViewTitle');\n\t\tvar url = \"index.php?module=Accounts&view=AccountHierarchy&record=\" + app.getRecordId();\n\t\thierarchyButton.on('click', '.js-detail__icon, .recordLabelValue', function (e) {\n\t\t\tthisInstance.getAccountHierarchyResponseData(url).done(function (data) {\n\t\t\t\tthisInstance.displayAccountHierarchyResponseData(data);\n\t\t\t});\n\t\t});\n\t},\n\tregisterEvents: function () {\n\t\tthis._super();\n\t\tthis.registerHierarchyRecordCount();\n\t\tthis.registerShowHierarchy();\n\t}\n});\n"],"names":["Vtiger_Detail_Js","params","thisInstance","aDeferred","jQuery","Deferred","isEmptyObject","accountHierarchyResponseCache","resolve","request","done","data","promise","container","find","on","e","currentTarget","$","fieldname","hasClass","app","getModuleName","removeClass","addClass","html","result","display_value","vtranslate","showMessage","showModalWindow","bodyModal","showScrollBar","height","registerButtons","hierarchyButton","length","getRecordId","response","success","url","getAccountHierarchyResponseData","displayAccountHierarchyResponseData","_super","registerHierarchyRecordCount","registerShowHierarchy"],"mappings":";;AAAA;;;;;;;;AAQA;AAEAA,iBAAiB,oBAAjB,EAAuC,EAAvC,EAA2C;;gCAEX,EAFW;;;;kCAMT,yCAAUC,MAAV,EAAkB;MAC9CC,eAAe,IAAnB;MACIC,YAAYC,OAAOC,QAAP,EAAhB;;;MAGI,CAAED,OAAOE,aAAP,CAAqBJ,aAAaK,6BAAlC,CAAN,EAAyE;aAC9DC,OAAV,CAAkBN,aAAaK,6BAA/B;GADD,MAEO;gBACOE,OAAb,CAAqBR,MAArB,EAA6BS,IAA7B,CACC,UAAUC,IAAV,EAAgB;;iBAEFJ,6BAAb,GAA6CI,IAA7C;cACUH,OAAV,CAAkBN,aAAaK,6BAA/B;IAJF;;SAQMJ,UAAUS,OAAV,EAAP;EAtByC;kBAwBzB,yBAAUC,SAAV,EAAqB;YAC3BC,IAAV,CAAe,cAAf,EAA+BC,EAA/B,CAAkC,OAAlC,EAA2C,UAAUC,CAAV,EAAa;OACnDC,gBAAgBC,EAAEF,EAAEC,aAAJ,CAApB;OACIE,YAAYF,cAAcN,IAAd,CAAmB,WAAnB,CAAhB;OACIV,SAAS;WACLgB,cAAcG,QAAd,CAAuB,aAAvB,IAAwC,CAAxC,GAA4C,CADvC;WAELD,SAFK;YAGJF,cAAcN,IAAd,CAAmB,UAAnB,CAHI;YAIJU,IAAIC,aAAJ,EAJI;YAKJ;IALT;gBAOab,OAAb,CAAqBR,MAArB,EAA6BS,IAA7B,CACC,UAAUC,IAAV,EAAgB;QACXM,cAAcG,QAAd,CAAuB,aAAvB,CAAJ,EAA2C;mBAC5BG,WAAd,CAA0B,aAA1B;mBACcC,QAAd,CAAuB,aAAvB;KAFD,MAGO;mBACQA,QAAd,CAAuB,aAAvB;mBACcD,WAAd,CAA0B,aAA1B;;kBAEaE,IAAd,CAAmBd,KAAKe,MAAL,CAAYP,SAAZ,EAAuBQ,aAA1C;QACI1B,SAAS;YACLoB,IAAIO,UAAJ,CAAe,mBAAf,CADK;WAENP,IAAIO,UAAJ,CAAe,mBAAf,CAFM;WAGN;KAHP;qBAKiBC,WAAjB,CAA6B5B,MAA7B;IAfF;GAVD;EAzByC;;;;sCA0DL,6CAAUU,IAAV,EAAgB;MAChDT,eAAe,IAAnB;MACI4B,eAAJ,CAAoBnB,IAApB,EAA0B,UAAUE,SAAV,EAAqB;OAC1CkB,YAAYlB,UAAUC,IAAV,CAAe,iBAAf,CAAhB;OACIkB,aAAJ,CAAkBD,SAAlB,EAA6B;YACpBA,UAAUE,MADU;iBAEf,IAFe;UAGtB;IAHP;gBAKaC,eAAb,CAA6BrB,SAA7B;GAPD;EA5DyC;+BAsEZ,wCAAY;MACrCsB,kBAAkBjB,EAAE,6BAAF,CAAtB;MACIiB,gBAAgBC,MAApB,EAA4B;OACvBnC,SAAS;YACJoB,IAAIC,aAAJ,EADI;YAEJ,cAFI;YAGJD,IAAIgB,WAAJ,EAHI;UAIN;IAJP;gBAMa5B,OAAb,CAAqBR,MAArB,EAA6BS,IAA7B,CAAkC,UAAU4B,QAAV,EAAoB;QACjDA,SAASC,OAAb,EAAsB;OACnB,oCAAF,EAAwCd,IAAxC,CAA6Ca,SAASZ,MAAtD;;IAFF;;EA/EwC;wBAsFnB,iCAAY;MAC9BxB,eAAe,IAAnB;MACIiC,kBAAkBjB,EAAE,kBAAF,CAAtB;MACIsB,MAAM,4DAA4DnB,IAAIgB,WAAJ,EAAtE;kBACgBtB,EAAhB,CAAmB,OAAnB,EAA4B,qCAA5B,EAAmE,UAAUC,CAAV,EAAa;gBAClEyB,+BAAb,CAA6CD,GAA7C,EAAkD9B,IAAlD,CAAuD,UAAUC,IAAV,EAAgB;iBACzD+B,mCAAb,CAAiD/B,IAAjD;IADD;GADD;EA1FyC;iBAgG1B,0BAAY;OACtBgC,MAAL;OACKC,4BAAL;OACKC,qBAAL;;CAnGF"}