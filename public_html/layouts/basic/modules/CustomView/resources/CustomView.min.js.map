{"version":3,"file":"CustomView.min.js","sources":["CustomView.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n * Contributor(s): YetiForce.com\n *************************************************************************************/\n'use strict';\n\nclass CustomView {\n\n\tconstructor(url) {\n\t\tlet progressIndicatorElement = $.progressIndicator();\n\t\tapp.showModalWindow(null, url, () => {\n\t\t\tthis.contentsCotainer = $('.js-filter-modal__container');\n\t\t\tthis.advanceFilterInstance = Vtiger_AdvanceFilter_Js.getInstance(this.contentsCotainer.find('.filterContainer'));\n\t\t\t//This will store the columns selection container\n\t\t\tthis.columnSelectElement = false;\n\t\t\tthis.registerEvents();\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t});\n\t}\n\n\tloadDateFilterValues() {\n\t\tlet selectedDateFilter = $('#standardDateFilter option:selected');\n\t\tlet currentDate = selectedDateFilter.data('currentdate');\n\t\tlet endDate = selectedDateFilter.data('enddate');\n\t\t$(\"#standardFilterCurrentDate\").val(currentDate);\n\t\t$(\"#standardFilterEndDate\").val(endDate);\n\t}\n\n\t/**\n\t * Function to get the contents container\n\t * @return : jQuery object of contents container\n\t */\n\tgetContentsContainer() {\n\t\tif (this.contentsCotainer == false) {\n\t\t\tthis.contentsCotainer = $('.js-filter-modal__container');\n\t\t}\n\t\treturn this.contentsCotainer;\n\t}\n\n\t/**\n\t * Function to get the view columns selection element\n\t * @return : jQuery object of view columns selection element\n\t */\n\tgetColumnSelectElement() {\n\t\tif (this.columnSelectElement == false) {\n\t\t\tthis.columnSelectElement = $('#viewColumnsSelect');\n\t\t}\n\t\treturn this.columnSelectElement;\n\t}\n\n\t/**\n\t * Function which will get the selected columns\n\t * @return : array of selected values\n\t */\n\tgetSelectedColumns() {\n\t\tlet columnListSelectElement = this.getColumnSelectElement();\n\t\treturn columnListSelectElement.val();\n\t}\n\n\tsaveFilter() {\n\t\tlet aDeferred = $.Deferred();\n\t\tlet formData = $(\"#CustomView\").serializeFormData();\n\t\tAppConnector.request(formData, true).done(function (data) {\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error) {\n\t\t\taDeferred.reject(error);\n\t\t});\n\t\treturn aDeferred.promise();\n\t}\n\n\tsaveAndViewFilter() {\n\t\tthis.saveFilter().done(function (response) {\n\t\t\tif (response.success) {\n\t\t\t\tlet url;\n\t\t\t\tif (app.getParentModuleName() == 'Settings') {\n\t\t\t\t\turl = 'index.php?module=CustomView&parent=Settings&view=Index&sourceModule=' + $('#sourceModule').val();\n\t\t\t\t} else {\n\t\t\t\t\turl = response['result']['listviewurl'];\n\t\t\t\t}\n\t\t\t\twindow.location.href = url;\n\t\t\t} else {\n\t\t\t\t$.unblockUI();\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttitle: app.vtranslate('JS_DUPLICATE_RECORD'),\n\t\t\t\t\ttext: response.error['message']\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tregisterIconEvents() {\n\t\tthis.getContentsContainer().find('.js-filter-preferences').on('change', '.js-filter-preference', (e) => {\n\t\t\tlet currentTarget = $(e.currentTarget);\n\t\t\tlet iconElement = currentTarget.next();\n\t\t\tif (currentTarget.prop('checked')) {\n\t\t\t\ticonElement.removeClass(iconElement.data('unchecked')).addClass(iconElement.data('check'));\n\t\t\t} else {\n\t\t\t\ticonElement.removeClass(iconElement.data('check')).addClass(iconElement.data('unchecked'));\n\t\t\t}\n\t\t});\n\t}\n\n\tregisterBlockToggleEvent() {\n\t\tconst container = this.getContentsContainer();\n\t\tcontainer.on('click', '.blockHeader', function (e) {\n\t\t\tconst target = $(e.target);\n\t\t\tif (target.is('input') || target.is('button') || target.parents().is('button') || target.hasClass('js-stop-propagation') || target.parents().hasClass('js-stop-propagation')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst blockHeader = $(e.currentTarget);\n\t\t\tconst blockContents = blockHeader.next();\n\t\t\tconst iconToggle = blockHeader.find('.iconToggle');\n\t\t\tif (blockContents.hasClass('d-none')) {\n\t\t\t\tblockContents.removeClass('d-none');\n\t\t\t\ticonToggle.removeClass(iconToggle.data('hide')).addClass(iconToggle.data('show'));\n\t\t\t} else {\n\t\t\t\tblockContents.addClass('d-none');\n\t\t\t\ticonToggle.removeClass(iconToggle.data('show')).addClass(iconToggle.data('hide'));\n\t\t\t}\n\t\t});\n\t}\n\n\tregisterColorEvent() {\n\t\tconst container = this.getContentsContainer();\n\t\tcontainer.find('.js-color-picker').colorpicker({\n\t\t\tformat: 'hex',\n\t\t\tautoInputFallback: false\n\t\t});\n\t}\n\n\tregisterSubmitEvent(select2Element) {\n\t\t$(\"#CustomView\").on('submit', (e) => {\n\t\t\tlet selectElement = this.getColumnSelectElement();\n\t\t\tif ($('#viewname').val().length > 40) {\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttitle: app.vtranslate('JS_MESSAGE'),\n\t\t\t\t\ttext: app.vtranslate('JS_VIEWNAME_ALERT')\n\t\t\t\t});\n\t\t\t\te.preventDefault();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t//Mandatory Fields selection validation\n\t\t\t//Any one Mandatory Field should select while creating custom view.\n\t\t\tlet mandatoryFieldsList = JSON.parse($('#mandatoryFieldsList').val());\n\t\t\tlet selectedOptions = selectElement.val();\n\t\t\tlet mandatoryFieldsMissing = true;\n\t\t\tif (selectedOptions) {\n\t\t\t\tfor (let i = 0; i < selectedOptions.length; i++) {\n\t\t\t\t\tif ($.inArray(selectedOptions[i], mandatoryFieldsList) >= 0) {\n\t\t\t\t\t\tmandatoryFieldsMissing = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (mandatoryFieldsMissing) {\n\t\t\t\tselectElement.validationEngine(\n\t\t\t\t\t'showPrompt',\n\t\t\t\t\tapp.vtranslate('JS_PLEASE_SELECT_ATLEAST_ONE_MANDATORY_FIELD'),\n\t\t\t\t\t'error',\n\t\t\t\t\t'topLeft',\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t\te.preventDefault();\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tselect2Element.validationEngine('hide');\n\t\t\t}\n\t\t\t//Mandatory Fields validation ends\n\t\t\tlet result = $(e.currentTarget).validationEngine('validate');\n\t\t\tif (result == true) {\n\t\t\t\t//handled standard filters saved values.\n\t\t\t\tlet stdfilterlist = {};\n\n\t\t\t\tif (($('#standardFilterCurrentDate').val() != '') && ($('#standardFilterEndDate').val() != '') && ($('select.standardFilterColumn option:selected').val() != 'none')) {\n\t\t\t\t\tstdfilterlist['columnname'] = $('select.standardFilterColumn option:selected').val();\n\t\t\t\t\tstdfilterlist['stdfilter'] = $('select#standardDateFilter option:selected').val();\n\t\t\t\t\tstdfilterlist['startdate'] = $('#standardFilterCurrentDate').val();\n\t\t\t\t\tstdfilterlist['enddate'] = $('#standardFilterEndDate').val();\n\t\t\t\t\t$('#stdfilterlist').val(JSON.stringify(stdfilterlist));\n\t\t\t\t}\n\t\t\t\t//handled advanced filters saved values.\n\t\t\t\tlet advfilterlist = this.advanceFilterInstance.getValues();\n\t\t\t\t$('#advfilterlist').val(JSON.stringify(advfilterlist));\n\t\t\t\t$('input[name=\"columnslist\"]', this.getContentsContainer()).val(JSON.stringify(this.getSelectedColumns()));\n\t\t\t\tthis.saveAndViewFilter();\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tapp.formAlignmentAfterValidation($(e.currentTarget));\n\t\t\t}\n\t\t});\n\t}\n\n\tregisterEvents() {\n\t\tthis.registerIconEvents();\n\t\tnew App.Fields.Text.Editor(this.getContentsContainer().find('.js-editor'));\n\t\tthis.registerBlockToggleEvent();\n\t\tthis.registerColorEvent();\n\t\tlet select2Element = App.Fields.Picklist.showSelect2ElementView(this.getColumnSelectElement());\n\t\tthis.registerSubmitEvent(select2Element);\n\t\t$('.stndrdFilterDateSelect').datepicker();\n\t\t$(\"#standardDateFilter\").on('change', () => {\n\t\t\tthis.loadDateFilterValues();\n\t\t});\n\t\t$('#CustomView').validationEngine(app.validationEngineOptions);\n\t}\n};\n"],"names":["url","$","progressIndicator","app","showModalWindow","contentsCotainer","advanceFilterInstance","Vtiger_AdvanceFilter_Js","getInstance","find","columnSelectElement","registerEvents","progressIndicatorElement","currentDate","selectedDateFilter","data","endDate","val","getColumnSelectElement","Deferred","formData","serializeFormData","request","done","aDeferred","resolve","fail","error","reject","promise","saveFilter","response","success","getParentModuleName","window","location","href","unblockUI","Vtiger_Helper_Js","showPnotify","title","vtranslate","text","getContentsContainer","on","e","currentTarget","iconElement","next","prop","removeClass","addClass","container","target","is","parents","hasClass","blockContents","blockHeader","iconToggle","colorpicker","format","autoInputFallback","select2Element","length","preventDefault","JSON","parse","selectedOptions","selectElement","mandatoryFieldsMissing","i","inArray","mandatoryFieldsList","validationEngine","stdfilterlist","stringify","getValues","advfilterlist","getSelectedColumns","saveAndViewFilter","formAlignmentAfterValidation","registerIconEvents","Fields","Text","Editor","registerBlockToggleEvent","registerColorEvent","App","Picklist","showSelect2ElementView","registerSubmitEvent","datepicker","loadDateFilterValues","validationEngineOptions"],"mappings":"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"}