"use strict";function registerUserList(){var selectUsers=$(".js-header__btn--mail select");selectUsers.data("select2")?selectUsers.select2("destroy"):selectUsers.on("change",handleChangeUserEvent),App.Fields.Picklist.showSelect2ElementView(selectUsers,{templateResult:function(state){if(!state.id)return state.text;var element=jQuery(state.element),text=element.data("nomail")?" ("+element.data("nomail")+")":"";return $("<span>"+state.text+'<span class"text-left"><span>'+text+"</span>")},templateSelection:function(data){var element=jQuery(data.element),text=element.data("nomail")?" ("+element.data("nomail")+")":"",resultContainer=jQuery("<span></span>");return resultContainer.append(data.text+text),resultContainer},closeOnSelect:!0});var select2Instance=selectUsers.data("select2");select2Instance.$dropdown.on("mouseup","li",(function(e){"true"==jQuery(e.currentTarget).attr("aria-selected")&&selectUsers.trigger("change")})),select2Instance.$container.find(".select2-selection__rendered").on("mousedown",(function(e){e.stopPropagation(),selectUsers.trigger("change")})),$(".js-mail-list").on("click",".js-mail-link",handleChangeUserEvent)}function handleChangeUserEvent(){var params={module:"OSSMail",action:"SetUser",user:$(this).val()};AppConnector.request(params).done((function(response){"OSSMail"==app.getModuleName()?window.location.href=window.location.href:window.location.href="index.php?module=OSSMail&view=Index"}))}function startCheckMails(){var users=[],timeCheckingMails=$(".js-header__btn--mail").data("interval");if($(".js-header__btn--mail .noMails").each((function(index){users.push($(this).data("id"))})),users.length>0){checkMails(users);var refreshIntervalId=setInterval((function(){0==window.stopScanMails?checkMails(users):clearInterval(refreshIntervalId)}),1e3*timeCheckingMails)}}function checkMails(users){var params={module:"OSSMail",action:"CheckMails",users:users},reloadSelect=!1;AppConnector.request(params).done((function(response){if(response.success&&1!=response.success.error&&1!=response.result.error){var result=response.result;$(".js-header__btn--mail .noMails").each((function(index){var element=jQuery(this),id=element.data("id");if(jQuery.inArray(id,result)){var num=result[id];if(element.is("option"))element.data("nomail",num),reloadSelect=!0;else{var prevVal=element.data("nomail");element.data("nomail",num);var text="";num>0&&(text=' <span class="badge badge-danger mr-1">'+num+"</span>"),element.html(text),(prevVal<num&&prevVal>=0||!prevVal&&num>0)&&(element.parent().effect("pulsate",1500),app.playSound("MAILS"))}}})),reloadSelect&&registerUserList()}else window.stopScanMails=!0})).fail((function(){window.stopScanMails=!0}))}function getUrlVars(){var vars={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(m,key,value){vars[key]=value})),vars}jQuery((function(){null!=$(".js-header__btn--mail").data("numberunreademails")&&(window.stopScanMails=!1,"Popup"!=getUrlVars().view&&startCheckMails()),$(".js-header__btn--mail select").length>0&&registerUserList()}));
//# sourceMappingURL=checkmails.min.js.map
