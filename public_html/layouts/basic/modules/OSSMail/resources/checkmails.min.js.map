{"version":3,"file":"checkmails.min.js","sources":["checkmails.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\njQuery(function () {\n\tif ($('.js-header__btn--mail').data('numberunreademails') != undefined) {\n\t\twindow.stopScanMails = false;\n\t\tif (getUrlVars()['view'] != 'Popup') {\n\t\t\tstartCheckMails();\n\t\t}\n\t}\n\tif ($('.js-header__btn--mail select').length > 0) {\n\t\tregisterUserList();\n\t}\n});\n\nfunction registerUserList() {\n\tvar selectUsers = $('.js-header__btn--mail select');\n\tif (selectUsers.data('select2')) {\n\t\tselectUsers.select2('destroy');\n\t} else {\n\t\tselectUsers.on('change', handleChangeUserEvent);\n\t}\n\tApp.Fields.Picklist.showSelect2ElementView(selectUsers, {\n\t\ttemplateResult: function (data) {\n\t\t\tconst main = document.createElement('span');\n\t\t\tif (data.id) {\n\t\t\t\tconst element = $(data.element),\n\t\t\t\t\tmail = document.createElement('span');\n\t\t\t\tmail.innerText = data.text;\n\t\t\t\tmain.appendChild(mail);\n\t\t\t\tif (element.data('nomail')) {\n\t\t\t\t\tconst badge = document.createElement('span');\n\t\t\t\t\tbadge.className = 'badge badge-danger ml-1';\n\t\t\t\t\tbadge.innerText = element.data('nomail');\n\t\t\t\t\tmain.appendChild(badge);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmain.innerText = data.text;\n\t\t\t}\n\t\t\treturn main;\n\t\t},\n\t\ttemplateSelection: function (data) {\n\t\t\tconst element = $(data.element),\n\t\t\t\tmain = document.createElement('span'),\n\t\t\t\tmail = document.createElement('span');\n\t\t\tmail.innerText = data.text;\n\t\t\tmain.appendChild(mail);\n\t\t\tif (element.data('nomail')) {\n\t\t\t\tconst badge = document.createElement('span');\n\t\t\t\tbadge.className = 'badge badge-danger ml-1';\n\t\t\t\tbadge.innerText = element.data('nomail');\n\t\t\t\tmain.appendChild(badge);\n\t\t\t}\n\t\t\treturn main;\n\t\t},\n\t\tcloseOnSelect: true\n\t});\n\tconst select2Instance = selectUsers.data('select2');\n\tselect2Instance.$dropdown.on('mouseup', 'li', function (e) {\n\t\tif (jQuery(e.currentTarget).attr('aria-selected') == 'true') {\n\t\t\tselectUsers.trigger('change');\n\t\t}\n\t});\n\tselect2Instance.$container.find('.select2-selection__rendered').on('mousedown', function (e) {\n\t\te.stopPropagation();\n\t\tselectUsers.trigger('change');\n\t});\n\t$('.js-mail-list').on('click', '.js-mail-link', handleChangeUserEvent);\n}\n\nfunction handleChangeUserEvent() {\n\tAppConnector.request({\n\t\tmodule: 'OSSMail',\n\t\taction: 'SetUser',\n\t\tuser: $(this).val()\n\t}).done(function (_) {\n\t\tif (app.getModuleName() == 'OSSMail') {\n\t\t\twindow.location.href = window.location.href;\n\t\t} else {\n\t\t\twindow.location.href = 'index.php?module=OSSMail&view=Index';\n\t\t}\n\t});\n}\n\nfunction startCheckMails() {\n\tlet users = [];\n\tlet timeCheckingMails = $('.js-header__btn--mail').data('interval');\n\t$('.js-header__btn--mail .noMails').each(function (_) {\n\t\tusers.push($(this).data('id'));\n\t});\n\tif (users.length > 0) {\n\t\tcheckMails(users, true);\n\t\tlet refreshIntervalId = setInterval(function () {\n\t\t\tif (window.stopScanMails == false) {\n\t\t\t\tcheckMails(users);\n\t\t\t} else {\n\t\t\t\tclearInterval(refreshIntervalId);\n\t\t\t}\n\t\t}, timeCheckingMails * 1000);\n\t}\n}\n\nfunction checkMails(users, initial = false) {\n\tlet reloadSelect = false;\n\tAppConnector.request({\n\t\tmodule: 'OSSMail',\n\t\taction: 'CheckMails',\n\t\tusers: users\n\t})\n\t\t.done(function (response) {\n\t\t\tif (response.success && response.success.error != true && response.result.error != true) {\n\t\t\t\tlet result = response.result;\n\t\t\t\t$('.js-header__btn--mail .noMails').each(function (_) {\n\t\t\t\t\tlet element = jQuery(this);\n\t\t\t\t\tlet id = element.data('id');\n\t\t\t\t\tif (jQuery.inArray(id, result)) {\n\t\t\t\t\t\tlet num = result[id];\n\t\t\t\t\t\tif (element.is('option')) {\n\t\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\t\treloadSelect = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet prevVal = element.data('nomail');\n\t\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\t\tlet text = '';\n\t\t\t\t\t\t\tif (num > 0) {\n\t\t\t\t\t\t\t\ttext = ' <span class=\"badge badge-danger mr-1\">' + num + '</span>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telement.html(text);\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tinitial === false &&\n\t\t\t\t\t\t\t\t(this.tagName === 'SPAN' || this.selected) &&\n\t\t\t\t\t\t\t\t((prevVal < num && prevVal >= 0) || (!prevVal && num > 0))\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\telement.parent().effect('pulsate', 1500);\n\t\t\t\t\t\t\t\tapp.playSound('MAILS');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (reloadSelect) {\n\t\t\t\t\tregisterUserList();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twindow.stopScanMails = true;\n\t\t\t}\n\t\t})\n\t\t.fail(function () {\n\t\t\twindow.stopScanMails = true;\n\t\t});\n}\n\nfunction getUrlVars() {\n\tlet vars = {};\n\twindow.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {\n\t\tvars[key] = value;\n\t});\n\treturn vars;\n}\n"],"names":["jQuery","$","data","window","stopScanMails","getUrlVars","startCheckMails","length","registerUserList","selectUsers","select2","on","handleChangeUserEvent","App","Fields","Picklist","showSelect2ElementView","templateResult","document","createElement","id","element","mail","innerText","text","main","appendChild","badge","className","templateSelection","closeOnSelect","select2Instance","$dropdown","e","currentTarget","attr","trigger","$container","find","stopPropagation","AppConnector","request","module","action","user","val","done","location","href","app","getModuleName","timeCheckingMails","each","users","push","checkMails","refreshIntervalId","setInterval","clearInterval","reloadSelect","response","success","error","result","inArray","is","num","html","initial","tagName","selected","prevVal","parent","effect","playSound","fail","replace","m","key","value","vars"],"mappings":"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"}