{"version":3,"file":"checkmails.min.js","sources":["checkmails.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery(function () {\n\tif ($('.js-header__btn--mail').data('numberunreademails') != undefined) {\n\t\twindow.stopScanMails = false;\n\t\tif (getUrlVars()['view'] != 'Popup') {\n\t\t\tstartCheckMails();\n\t\t}\n\t}\n\tif ($('.js-header__btn--mail select').length > 0) {\n\t\tregisterUserList();\n\t}\n});\n\nfunction registerUserList() {\n\tvar selectUsers = $('.js-header__btn--mail select');\n\tif (selectUsers.data('select2')) {\n\t\tselectUsers.select2('destroy');\n\t} else {\n\t\tselectUsers.on('change', handleChangeUserEvent);\n\t}\n\tApp.Fields.Picklist.showSelect2ElementView(selectUsers, {\n\t\ttemplateResult: function (state) {\n\t\t\tif (!state.id) {\n\t\t\t\treturn state.text;\n\t\t\t}\n\t\t\tvar element = jQuery(state.element);\n\t\t\tvar text = element.data('nomail') ? ' (' + element.data('nomail') + ')' : '';\n\t\t\tvar $state = $('<span>' + state.text + '<span class\"text-left\"><span>' + text + '</span>');\n\t\t\treturn $state;\n\t\t},\n\t\ttemplateSelection: function (data) {\n\t\t\tvar element = jQuery(data.element);\n\t\t\tvar text = element.data('nomail') ? ' (' + element.data('nomail') + ')' : '';\n\t\t\tvar resultContainer = jQuery('<span></span>');\n\t\t\tresultContainer.append(data.text + text);\n\t\t\treturn resultContainer;\n\t\t},\n\t\tcloseOnSelect: true\n\t});\n\tvar select2Instance = selectUsers.data('select2');\n\tselect2Instance.$dropdown.on('mouseup', 'li', function (e) {\n\t\tif (jQuery(e.currentTarget).attr('aria-selected') == 'true') {\n\t\t\tselectUsers.trigger('change');\n\t\t}\n\t});\n\tselect2Instance.$container.find('.select2-selection__rendered').on('mousedown', function (e) {\n\t\te.stopPropagation();\n\t\tselectUsers.trigger('change');\n\t});\n\t$('.js-mail-list').on('click', '.js-mail-link', handleChangeUserEvent);\n}\n\nfunction handleChangeUserEvent() {\n\tvar params = {\n\t\t'module': 'OSSMail',\n\t\t'action': \"SetUser\",\n\t\t'user': $(this).val()\n\t};\n\tAppConnector.request(params).done(function (response) {\n\t\tif (app.getModuleName() == 'OSSMail') {\n\t\t\twindow.location.href = window.location.href;\n\t\t} else {\n\t\t\twindow.location.href = \"index.php?module=OSSMail&view=Index\";\n\t\t}\n\t});\n}\n\nfunction startCheckMails() {\n\tvar users = [];\n\tvar timeCheckingMails = $('.js-header__btn--mail').data('interval');\n\t$(\".js-header__btn--mail .noMails\").each(function (index) {\n\t\tusers.push($(this).data('id'));\n\t});\n\tif (users.length > 0) {\n\t\tcheckMails(users);\n\t\tvar refreshIntervalId = setInterval(function () {\n\t\t\tif (window.stopScanMails == false) {\n\t\t\t\tcheckMails(users);\n\t\t\t} else {\n\t\t\t\tclearInterval(refreshIntervalId);\n\t\t\t}\n\t\t}, timeCheckingMails * 1000);\n\t}\n}\n\nfunction checkMails(users) {\n\tvar params = {\n\t\t'module': 'OSSMail',\n\t\t'action': \"CheckMails\",\n\t\t'users': users,\n\t};\n\tvar reloadSelect = false;\n\tAppConnector.request(params).done(function (response) {\n\t\tif (response.success && response.success.error != true && response.result.error != true) {\n\t\t\tvar result = response.result;\n\t\t\t$(\".js-header__btn--mail .noMails\").each(function (index) {\n\t\t\t\tvar element = jQuery(this);\n\t\t\t\tvar id = element.data('id');\n\t\t\t\tif (jQuery.inArray(id, result)) {\n\t\t\t\t\tvar num = result[id];\n\t\t\t\t\tif (element.is('option')) {\n\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\treloadSelect = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet prevVal = element.data('nomail');\n\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\tvar text = '';\n\t\t\t\t\t\tif (num > 0) {\n\t\t\t\t\t\t\ttext = ' <span class=\"badge badge-danger mr-1\">' + num + '</span>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telement.html(text);\n\t\t\t\t\t\tif ((prevVal < num && prevVal >= 0) || (!prevVal && num > 0)) {\n\t\t\t\t\t\t\telement.parent().effect(\"pulsate\", 1500);\n\t\t\t\t\t\t\tapp.playSound('MAILS');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (reloadSelect) {\n\t\t\t\tregisterUserList();\n\t\t\t}\n\t\t} else {\n\t\t\twindow.stopScanMails = true;\n\t\t}\n\t}).fail(function () {\n\t\twindow.stopScanMails = true;\n\t});\n}\n\nfunction getUrlVars() {\n\tvar vars = {};\n\twindow.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {\n\t\tvars[key] = value;\n\t});\n\treturn vars;\n}\n"],"names":["registerUserList","selectUsers","$","data","select2","on","handleChangeUserEvent","Fields","Picklist","showSelect2ElementView","state","id","text","element","jQuery","resultContainer","append","select2Instance","$dropdown","e","currentTarget","attr","trigger","$container","find","stopPropagation","params","this","val","request","done","response","app","getModuleName","location","href","window","startCheckMails","users","timeCheckingMails","each","index","push","length","refreshIntervalId","setInterval","stopScanMails","checkMails","reloadSelect","success","error","result","inArray","num","is","prevVal","html","parent","effect","playSound","fail","getUrlVars","vars","replace","m","key","value","undefined"],"mappings":"aAeA,SAASA,uBACJC,YAAcC,EAAE,gCAChBD,YAAYE,KAAK,uBACRC,QAAQ,uBAERC,GAAG,SAAUC,2BAEtBC,OAAOC,SAASC,uBAAuBR,YAAa,gBACvC,SAAUS,WACpBA,MAAMC,UACHD,MAAME,SAEVC,QAAUC,OAAOJ,MAAMG,SACvBD,KAAOC,QAAQV,KAAK,UAAY,KAAOU,QAAQV,KAAK,UAAY,IAAM,UAC7DD,EAAE,SAAWQ,MAAME,KAAO,gCAAkCA,KAAO,8BAG9D,SAAUT,UACxBU,QAAUC,OAAOX,KAAKU,SACtBD,KAAOC,QAAQV,KAAK,UAAY,KAAOU,QAAQV,KAAK,UAAY,IAAM,GACtEY,gBAAkBD,OAAO,wCACbE,OAAOb,KAAKS,KAAOA,MAC5BG,gCAEO,QAEZE,gBAAkBhB,YAAYE,KAAK,2BACvBe,UAAUb,GAAG,UAAW,MAAM,SAAUc,GACF,QAAjDL,OAAOK,EAAEC,eAAeC,KAAK,8BACpBC,QAAQ,6BAGNC,WAAWC,KAAK,gCAAgCnB,GAAG,aAAa,SAAUc,KACvFM,8BACUH,QAAQ,eAEnB,iBAAiBjB,GAAG,QAAS,gBAAiBC,uBAGjD,SAASA,4BACJoB,OAAS,QACF,iBACA,eACFxB,EAAEyB,MAAMC,oBAEJC,QAAQH,QAAQI,MAAK,SAAUC,UAChB,WAAvBC,IAAIC,uBACAC,SAASC,KAAOC,OAAOF,SAASC,YAEhCD,SAASC,KAAO,yCAK1B,SAASE,sBACJC,MAAQ,GACRC,kBAAoBrC,EAAE,yBAAyBC,KAAK,iBACtD,kCAAkCqC,MAAK,SAAUC,aAC5CC,KAAKxC,EAAEyB,MAAMxB,KAAK,UAErBmC,MAAMK,OAAS,EAAG,YACVL,WACPM,kBAAoBC,aAAY,WACP,GAAxBT,OAAOU,yBACCR,qBAEGM,qBAEO,IAApBL,oBAIL,SAASQ,WAAWT,WACfZ,OAAS,QACF,iBACA,mBACDY,OAENU,cAAe,eACNnB,QAAQH,QAAQI,MAAK,SAAUC,aACvCA,SAASkB,SAAqC,GAA1BlB,SAASkB,QAAQC,OAA0C,GAAzBnB,SAASoB,OAAOD,MAAe,KACpFC,OAASpB,SAASoB,SACpB,kCAAkCX,MAAK,SAAUC,WAC9C5B,QAAUC,OAAOa,MACjBhB,GAAKE,QAAQV,KAAK,SAClBW,OAAOsC,QAAQzC,GAAIwC,QAAS,KAC3BE,IAAMF,OAAOxC,OACbE,QAAQyC,GAAG,kBACNnD,KAAK,SAAUkD,mBACR,MACT,KACFE,QAAU1C,QAAQV,KAAK,kBACnBA,KAAK,SAAUkD,SACnBzC,KAAO,GACPyC,IAAM,SACF,0CAA4CA,IAAM,mBAElDG,KAAK5C,OACR2C,QAAUF,KAAOE,SAAW,IAAQA,SAAWF,IAAM,aACjDI,SAASC,OAAO,UAAW,UAC/BC,UAAU,eAKdX,6CAIGF,eAAgB,KAEtBc,MAAK,kBACAd,eAAgB,KAIzB,SAASe,iBACJC,KAAO,iBACJ5B,SAASC,KAAK4B,QAAQ,2BAA2B,SAAUC,EAAGC,IAAKC,YACpED,KAAOC,SAENJ,KArIRhD,QAAO,WACuDqD,MAAzDjE,EAAE,yBAAyBC,KAAK,+BAC5B2C,eAAgB,EACK,SAAxBe,aAAA,yBAID3D,EAAE,gCAAgCyC,OAAS"}