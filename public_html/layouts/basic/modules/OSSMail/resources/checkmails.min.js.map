{"version":3,"file":"checkmails.min.js","sources":["checkmails.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery(function () {\n\tif ($('.js-header__btn--mail').data('numberunreademails') != undefined) {\n\t\twindow.stopScanMails = false;\n\t\tif (getUrlVars()['view'] != 'Popup') {\n\t\t\tstartCheckMails();\n\t\t}\n\t}\n\tif ($('.js-header__btn--mail select').length > 0) {\n\t\tregisterUserList();\n\t}\n});\n\nfunction registerUserList() {\n\tvar selectUsers = $('.js-header__btn--mail select');\n\tif (selectUsers.data('select2')) {\n\t\tselectUsers.select2('destroy');\n\t} else {\n\t\tselectUsers.on('change', handleChangeUserEvent);\n\t}\n\tApp.Fields.Picklist.showSelect2ElementView(selectUsers, {\n\t\ttemplateResult: function (state) {\n\t\t\tif (!state.id) {\n\t\t\t\treturn state.text;\n\t\t\t}\n\t\t\tvar element = jQuery(state.element);\n\t\t\tvar text = element.data('nomail') ? ' (' + element.data('nomail') + ')' : '';\n\t\t\tvar $state = $('<span>' + state.text + '<span class\"text-left\"><span>' + text + '</span>');\n\t\t\treturn $state;\n\t\t},\n\t\ttemplateSelection: function (data) {\n\t\t\tvar element = jQuery(data.element);\n\t\t\tvar text = element.data('nomail') ? ' (' + element.data('nomail') + ')' : '';\n\t\t\tvar resultContainer = jQuery('<span></span>');\n\t\t\tresultContainer.append(data.text + text);\n\t\t\treturn resultContainer;\n\t\t},\n\t\tcloseOnSelect: true\n\t});\n\tvar select2Instance = selectUsers.data('select2');\n\tselect2Instance.$dropdown.on('mouseup', 'li', function (e) {\n\t\tif (jQuery(e.currentTarget).attr('aria-selected') == 'true') {\n\t\t\tselectUsers.trigger('change');\n\t\t}\n\t});\n\tselect2Instance.$container.find('.select2-selection__rendered').on('mousedown', function (e) {\n\t\te.stopPropagation();\n\t\tselectUsers.trigger('change');\n\t});\n\t$('.js-mail-list').on('click', '.js-mail-link', handleChangeUserEvent);\n}\n\nfunction handleChangeUserEvent() {\n\tvar params = {\n\t\t'module': 'OSSMail',\n\t\t'action': \"SetUser\",\n\t\t'user': $(this).val()\n\t};\n\tAppConnector.request(params).done(function (response) {\n\t\tif (app.getModuleName() == 'OSSMail') {\n\t\t\twindow.location.href = window.location.href;\n\t\t} else {\n\t\t\twindow.location.href = \"index.php?module=OSSMail&view=Index\";\n\t\t}\n\t});\n}\n\nfunction startCheckMails() {\n\tvar users = [];\n\tvar timeCheckingMails = $('.js-header__btn--mail').data('interval');\n\t$(\".js-header__btn--mail .noMails\").each(function (index) {\n\t\tusers.push($(this).data('id'));\n\t});\n\tif (users.length > 0) {\n\t\tcheckMails(users);\n\t\tvar refreshIntervalId = setInterval(function () {\n\t\t\tif (window.stopScanMails == false) {\n\t\t\t\tcheckMails(users);\n\t\t\t} else {\n\t\t\t\tclearInterval(refreshIntervalId);\n\t\t\t}\n\t\t}, timeCheckingMails * 1000);\n\t}\n}\n\nfunction checkMails(users) {\n\tvar params = {\n\t\t'module': 'OSSMail',\n\t\t'action': \"CheckMails\",\n\t\t'users': users,\n\t};\n\tvar reloadSelect = false;\n\tAppConnector.request(params).done(function (response) {\n\t\tif (response.success && response.success.error != true && response.result.error != true) {\n\t\t\tvar result = response.result;\n\t\t\t$(\".js-header__btn--mail .noMails\").each(function (index) {\n\t\t\t\tvar element = jQuery(this);\n\t\t\t\tvar id = element.data('id');\n\t\t\t\tif (jQuery.inArray(id, result)) {\n\t\t\t\t\tvar num = result[id];\n\t\t\t\t\tif (element.is('option')) {\n\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\treloadSelect = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet prevVal = element.data('nomail');\n\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\tvar text = '';\n\t\t\t\t\t\tif (num > 0) {\n\t\t\t\t\t\t\ttext = ' <span class=\"badge badge-danger mr-1\">' + num + '</span>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telement.html(text);\n\t\t\t\t\t\tif ((prevVal < num && prevVal >= 0) || (!prevVal && num > 0)) {\n\t\t\t\t\t\t\telement.parent().effect(\"pulsate\", 1500);\n\t\t\t\t\t\t\tapp.playSound('MAILS');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (reloadSelect) {\n\t\t\t\tregisterUserList();\n\t\t\t}\n\t\t} else {\n\t\t\twindow.stopScanMails = true;\n\t\t}\n\t}).fail(function () {\n\t\twindow.stopScanMails = true;\n\t});\n}\n\nfunction getUrlVars() {\n\tvar vars = {};\n\twindow.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {\n\t\tvars[key] = value;\n\t});\n\treturn vars;\n}\n"],"names":["jQuery","$","data","undefined","stopScanMails","getUrlVars","length","registerUserList","selectUsers","select2","on","handleChangeUserEvent","Fields","Picklist","showSelect2ElementView","state","id","text","element","$state","resultContainer","append","select2Instance","$dropdown","e","currentTarget","attr","trigger","$container","find","stopPropagation","params","val","request","done","response","app","getModuleName","location","href","window","startCheckMails","users","timeCheckingMails","each","index","push","refreshIntervalId","setInterval","checkMails","reloadSelect","success","error","result","inArray","num","is","prevVal","html","parent","effect","playSound","fail","vars","replace","m","key","value"],"mappings":"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"}