{"version":3,"file":"StocktakingModal.min.js","sources":["StocktakingModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nwindow.Products_StocktakingModal_JS = class {\n\t/**\n\t * Show step by name.\n\t * @param {string} name\n\t */\n\tshowStep(name) {\n\t\tthis.container.find('.js-step').addClass('d-none');\n\t\tthis.container.find(`.js-step[data-step=\"${name}\"]`).removeClass('d-none');\n\t}\n\t/**\n\t * Register analyze file events.\n\t */\n\tregisterAnalyzeFile() {\n\t\tlet form = this.container.find('form');\n\t\tform.validationEngine(app.validationEngineOptions);\n\t\tthis.container.find('.js-send-file').on('click', () => {\n\t\t\tif (!form.validationEngine('validate')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet formData = new FormData(form[0]);\n\t\t\tformData.append('module', 'Products');\n\t\t\tformData.append('action', 'StocktakingModal');\n\t\t\tformData.append('mode', 'analyzeFile');\n\t\t\tlet progress = $.progressIndicator({ position: 'html', blockInfo: { enabled: true } });\n\t\t\tAppConnector.request({\n\t\t\t\turl: 'index.php',\n\t\t\t\ttype: 'POST',\n\t\t\t\tdata: formData,\n\t\t\t\tprocessData: false,\n\t\t\t\tcontentType: false\n\t\t\t})\n\t\t\t\t.done((response) => {\n\t\t\t\t\tthis.showStep('selectColumn');\n\t\t\t\t\tthis.container.find('.js-encoding').val(response.result.encoding);\n\t\t\t\t\tthis.container.find('.js-count').val(response.result.count);\n\t\t\t\t\tthis.container.find('.js-randomKey').val(response.result.randomKey);\n\t\t\t\t\tlet eanField = this.container.find('#skuColumnSeq');\n\t\t\t\t\tlet qtyField = this.container.find('#qtyColumnSeq');\n\t\t\t\t\t$.each(response.result.column, function (index, value) {\n\t\t\t\t\t\teanField.append(`<option value=\"${index}\">${value}</option>`);\n\t\t\t\t\t\tqtyField.append(`<option value=\"${index}\">${value}</option>`);\n\t\t\t\t\t});\n\t\t\t\t\tqtyField.val(1);\n\t\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(qtyField);\n\t\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(eanField);\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail(() => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttext: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\t/**\n\t * Register compare stock levels.\n\t */\n\tregisterCompare() {\n\t\tlet form = this.container.find('form');\n\t\tthis.container.find('.js-compare').on('click', () => {\n\t\t\tlet formData = form.serializeFormData();\n\t\t\tformData['module'] = 'Products';\n\t\t\tformData['action'] = 'StocktakingModal';\n\t\t\tformData['mode'] = 'compare';\n\t\t\tlet progress = $.progressIndicator({ position: 'html', blockInfo: { enabled: true } });\n\t\t\tAppConnector.request(formData)\n\t\t\t\t.done((response) => {\n\t\t\t\t\tthis.showStep('showCompare');\n\t\t\t\t\tthis.container.find('.js-entries-update').val(response.result.update);\n\t\t\t\t\tthis.container.find('.js-entries-no-update').val(response.result.same);\n\t\t\t\t\tthis.container.find('.js-entries-not-found').val(response.result.counterNotFound);\n\t\t\t\t\tthis.container.find('.js-list-entries-not-found').val(response.result.notFound);\n\t\t\t\t\tthis.toUpdate = response.result.toUpdate;\n\t\t\t\t\tif (response.result.update === 0) {\n\t\t\t\t\t\tthis.container.find('.js-import').addClass('d-none');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (formData['storage'] != 0) {\n\t\t\t\t\t\t\tthis.container.find('.js-record-name').removeClass('d-none');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail(() => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttext: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\t/**\n\t * Register importing stock differences.\n\t */\n\tregisterImport() {\n\t\tlet form = this.container.find('form');\n\t\tthis.container.find('.js-import').on('click', () => {\n\t\t\tlet formData = form.serializeFormData();\n\t\t\tif (formData['storage'] != 0 && !form.validationEngine('validate')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tformData['module'] = 'Products';\n\t\t\tformData['action'] = 'StocktakingModal';\n\t\t\tformData['mode'] = 'import';\n\t\t\tformData['records'] = this.toUpdate;\n\t\t\tlet progress = $.progressIndicator({ position: 'html', blockInfo: { enabled: true } });\n\t\t\tAppConnector.request(formData)\n\t\t\t\t.done((response) => {\n\t\t\t\t\tthis.showStep('showSummary');\n\t\t\t\t\tif (response.result.product) {\n\t\t\t\t\t\tthis.container.find('.js-imported').removeClass('d-none');\n\t\t\t\t\t\tthis.container.find('.js-imported-counter').val(response.result.product);\n\t\t\t\t\t}\n\t\t\t\t\tif (response.result.igin) {\n\t\t\t\t\t\tthis.container\n\t\t\t\t\t\t\t.find('.js-btn-igin')\n\t\t\t\t\t\t\t.removeClass('d-none')\n\t\t\t\t\t\t\t.attr('href', 'index.php?module=IGIN&view=Detail&record=' + response.result.igin);\n\t\t\t\t\t}\n\t\t\t\t\tif (response.result.iidn) {\n\t\t\t\t\t\tthis.container\n\t\t\t\t\t\t\t.find('.js-btn-iidn')\n\t\t\t\t\t\t\t.removeClass('d-none')\n\t\t\t\t\t\t\t.attr('href', 'index.php?module=IIDN&view=Detail&record=' + response.result.iidn);\n\t\t\t\t\t}\n\t\t\t\t\tif (response.result.igin || response.result.iidn) {\n\t\t\t\t\t\tthis.container.find('.js-alert').removeClass('d-none');\n\t\t\t\t\t}\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail(() => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttext: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\t/**\n\t * Register modal events.\n\t * @param {jQuery} modalContainer\n\t */\n\tregisterEvents(modalContainer) {\n\t\tthis.container = modalContainer;\n\t\tthis.registerAnalyzeFile();\n\t\tthis.registerCompare();\n\t\tthis.registerImport();\n\t}\n};\n"],"names":["window","Products_StocktakingModal_JS","name","container","find","addClass","removeClass","form","validationEngine","app","validationEngineOptions","on","formData","append","$","progressIndicator","position","blockInfo","enabled","AppConnector","request","url","type","data","processData","contentType","done","response","showStep","val","result","encoding","count","randomKey","eanField","qtyField","each","column","index","value","App","Fields","Picklist","showSelect2ElementView","progress","mode","fail","showNotify","text","vtranslate","serializeFormData","update","same","counterNotFound","notFound","toUpdate","product","igin","attr","iidn","modalContainer","registerAnalyzeFile","registerCompare","registerImport"],"mappings":"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"}