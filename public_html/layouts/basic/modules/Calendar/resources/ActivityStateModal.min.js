'use strict';

jQuery.Class('Calendar_ActivityStateModal_Js',{},{registerActivityState:function registerActivityState(){var self=this;$('.js-activity-state button:not(.close)').on('click',function(e){var currentTarget=$(e.currentTarget),viewName=app.getViewName();if(currentTarget.closest('.modal').addClass('d-none'),1===currentTarget.data('type'))self.updateActivityState(currentTarget);else if('Calendar'===app.getModuleName()&&'CalendarExtended'===viewName)Calendar_Calendar_Js.getInstanceByView().getCalendarEditView(currentTarget.data('id'),{isDuplicate:!0,addRelation:!0,sourceModule:'Calendar',sourceRecord:currentTarget.data('id')});else if(currentTarget.hasClass('showQuickCreate')){var progressIndicatorElement=$.progressIndicator({position:'html',blockInfo:{enabled:!0}}),url='index.php?module=Calendar&view=QuickCreateAjax&addRelation=true&sourceModule=Calendar&sourceRecord='+currentTarget.data('id'),params={},subject=currentTarget.closest('.modalEditStatus').find('.modalSummaryValues .fieldVal').data('subject'),headerInstance=Vtiger_Header_Js.getInstance();params.noCache=!0,headerInstance.getQuickCreateForm(url,'Calendar',params).done(function(data){if(progressIndicatorElement.progressIndicator({mode:'hide'}),'0'==currentTarget.data('type')&&'undefined'!=typeof subject&&0<subject.length){data=$(data);var element=data.find('[name="subject"]');element.length&&element.val(subject);}headerInstance.handleQuickCreateData(data,{callbackFunction:function callbackFunction(data){data&&data.success&&data.result.followup.value==currentTarget.data('id')&&self.updateActivityState(currentTarget);}});});}});},updateActivityState:function updateActivityState(currentTarget){var params={module:'Calendar',action:'ActivityStateAjax',record:currentTarget.data('id'),state:currentTarget.data('state')};app.hideModalWindow();var progressIndicatorElement=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});AppConnector.request(params).done(function(data){if(data.success){var viewName=app.getViewName();if('Detail'===viewName){var _thisInstance=Vtiger_Detail_Js.getInstance(),widget=$('.activityWidgetContainer .widgetContentBlock');if(widget.length)_thisInstance.loadWidget(widget);else{var recentActivitiesTab=_thisInstance.getTabByLabel(_thisInstance.detailViewRecentActivitiesTabLabel);recentActivitiesTab&&recentActivitiesTab.trigger('click'),'Calendar'===app.getModuleName()&&(recentActivitiesTab=_thisInstance.getSelectedTab().length&&_thisInstance.getSelectedTab().data('linkKey')!=_thisInstance.detailViewDetailsTabLabel?$('<div></div>'):_thisInstance.getTabContainer().find('[data-link-key="'+_thisInstance.detailViewDetailsTabLabel+'"]:not(.d-none)'),$('.showModal.closeCalendarRekord').addClass('d-none'),recentActivitiesTab.trigger('click'));}}if('List'===viewName){var listinstance=new Vtiger_List_Js;listinstance.getListViewRecords();}if('DashBoard'===viewName&&new Vtiger_DashBoard_Js().getContainer().find('a[name="drefresh"]').trigger('click'),'Calendar'===app.getModuleName()&&('Calendar'===viewName||'CalendarExtended'===viewName)){var calendarInstance=Calendar_Calendar_Js.getInstanceByView();calendarInstance.loadCalendarData(),calendarInstance.getCalendarCreateView();}Vtiger_Index_Js.requestReminder(),progressIndicatorElement.progressIndicator({mode:'hide'});}else return !1});},registerEvents:function registerEvents(){this.registerActivityState();}}),jQuery(document).ready(function(){var instance=new Calendar_ActivityStateModal_Js;instance.registerEvents();});
//# sourceMappingURL=ActivityStateModal.min.js.map
