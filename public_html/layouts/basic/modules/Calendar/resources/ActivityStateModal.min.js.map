{"version":3,"file":"ActivityStateModal.min.js","sources":["ActivityStateModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\"Calendar_ActivityStateModal_Js\", {}, {\n\tregisterActivityState() {\n\t\tconst self = this;\n\t\t$('.js-activity-buttons button:not(.close)').on('click', function (e) {\n\t\t\tlet currentTarget = $(e.currentTarget),\n\t\t\t\tviewName = app.getViewName();\n\t\t\tapp.hideModalWindow();\n\t\t\tif (1 === currentTarget.data('type')) {\n\t\t\t\tself.updateActivityState(currentTarget);\n\t\t\t} else {\n\t\t\t\tlet isReminder = currentTarget.closest('#calendar-reminder-modal').length;\n\t\t\t\tif (app.getModuleName() === 'Calendar' && viewName === 'CalendarExtended' && !isReminder) {\n\t\t\t\t\tlet calendarInstance = new Calendar_CalendarExtended_Js;\n\t\t\t\t\tcalendarInstance.getCalendarSidebarData({\n\t\t\t\t\t\tmodule: 'Calendar',\n\t\t\t\t\t\tview: 'EventForm',\n\t\t\t\t\t\trecord: currentTarget.data('id'),\n\t\t\t\t\t\tisDuplicate: true,\n\t\t\t\t\t\taddRelation: true,\n\t\t\t\t\t\tsourceModule: 'Calendar',\n\t\t\t\t\t\tsourceRecord: currentTarget.data('id')\n\t\t\t\t\t});\n\t\t\t\t} else if (currentTarget.hasClass('showQuickCreate') || isReminder) {\n\t\t\t\t\tlet progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\t\t\t'position': 'html',\n\t\t\t\t\t\t\t'blockInfo': {\n\t\t\t\t\t\t\t\t'enabled': true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\turl = 'index.php?module=Calendar&view=QuickCreateAjax&addRelation=true&sourceModule=Calendar&sourceRecord=' + currentTarget.data('id'),\n\t\t\t\t\t\tparams = {},\n\t\t\t\t\t\tsubject = currentTarget.closest('.modalEditStatus').find('.modalSummaryValues .fieldVal').data('subject'),\n\t\t\t\t\t\theaderInstance = Vtiger_Header_Js.getInstance();\n\t\t\t\t\tparams.noCache = true;\n\t\t\t\t\theaderInstance.getQuickCreateForm(url, 'Calendar', params).done(function (data) {\n\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t\t\t\tif (currentTarget.data('type') == '0' && typeof subject !== \"undefined\" && subject.length > 0) {\n\t\t\t\t\t\t\tdata = $(data);\n\t\t\t\t\t\t\tlet element = data.find('[name=\"subject\"]');\n\t\t\t\t\t\t\tif (element.length) {\n\t\t\t\t\t\t\t\telement.val(subject);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\theaderInstance.handleQuickCreateData(data, {\n\t\t\t\t\t\t\tcallbackFunction: function (data) {\n\t\t\t\t\t\t\t\tif (data && data.success && data.result.followup.value == currentTarget.data('id')) {\n\t\t\t\t\t\t\t\t\tself.updateActivityState(currentTarget);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tupdateActivityState: function (currentTarget) {\n\t\tlet params = {\n\t\t\tmodule: 'Calendar',\n\t\t\taction: \"ActivityStateAjax\",\n\t\t\trecord: currentTarget.data('id'),\n\t\t\tstate: currentTarget.data('state')\n\t\t};\n\t\tapp.hideModalWindow();\n\t\tlet progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tif (data.success) {\n\t\t\t\tlet viewName = app.getViewName();\n\t\t\t\tif (viewName === 'Detail') {\n\t\t\t\t\tconst thisInstance = Vtiger_Detail_Js.getInstance();\n\t\t\t\t\tlet widget = $('.activityWidgetContainer .widgetContentBlock');\n\t\t\t\t\tif (widget.length) {\n\t\t\t\t\t\tthisInstance.loadWidget(widget);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet recentActivitiesTab = thisInstance.getTabByLabel(thisInstance.detailViewRecentActivitiesTabLabel);\n\t\t\t\t\t\tif (recentActivitiesTab) {\n\t\t\t\t\t\t\trecentActivitiesTab.trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (app.getModuleName() === 'Calendar') {\n\t\t\t\t\t\t\trecentActivitiesTab = ((!thisInstance.getSelectedTab().length || thisInstance.getSelectedTab().data('linkKey') == thisInstance.detailViewDetailsTabLabel) ? thisInstance.getTabContainer().find('[data-link-key=\"' + thisInstance.detailViewDetailsTabLabel + '\"]:not(.d-none)') : $('<div></div>'));\n\t\t\t\t\t\t\t$('.showModal.closeCalendarRekord').addClass('d-none');\n\t\t\t\t\t\t\trecentActivitiesTab.trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (viewName === 'List') {\n\t\t\t\t\tlet listinstance = new Vtiger_List_Js();\n\t\t\t\t\tlistinstance.getListViewRecords();\n\t\t\t\t}\n\t\t\t\tif (viewName === 'DashBoard') {\n\t\t\t\t\t(new Vtiger_DashBoard_Js()).getContainer().find('a[name=\"drefresh\"]').trigger('click');\n\t\t\t\t}\n\t\t\t\tif (app.getModuleName() === 'Calendar' && (viewName === 'Calendar' || viewName === 'CalendarExtended')) {\n\t\t\t\t\tconst calendarInstance = new window[`Calendar_${viewName}_Js`];\n\t\t\t\t\tcalendarInstance.loadCalendarData();\n\t\t\t\t\tcalendarInstance.getCalendarCreateView();\n\t\t\t\t}\n\t\t\t\t//updates the Calendar Reminder popup's status\n\t\t\t\tVtiger_Index_Js.requestReminder();\n\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t},\n\tregisterEvents: function () {\n\t\tthis.registerActivityState();\n\t}\n\n});\n\njQuery(document).ready(function (e) {\n\tvar instance = new Calendar_ActivityStateModal_Js();\n\tinstance.registerEvents();\n});\n"],"names":["jQuery","Class","self","on","e","currentTarget","$","viewName","app","getViewName","hideModalWindow","data","updateActivityState","isReminder","closest","length","getModuleName","calendarInstance","Calendar_CalendarExtended_Js","getCalendarSidebarData","hasClass","progressIndicatorElement","progressIndicator","url","params","subject","find","headerInstance","Vtiger_Header_Js","getInstance","noCache","getQuickCreateForm","done","element","val","handleQuickCreateData","success","result","followup","value","request","thisInstance","Vtiger_Detail_Js","widget","loadWidget","recentActivitiesTab","getTabByLabel","detailViewRecentActivitiesTabLabel","trigger","getSelectedTab","detailViewDetailsTabLabel","getTabContainer","addClass","listinstance","Vtiger_List_Js","getListViewRecords","Vtiger_DashBoard_Js","getContainer","window","loadCalendarData","getCalendarCreateView","requestReminder","registerActivityState","document","ready","instance","Calendar_ActivityStateModal_Js","registerEvents"],"mappings":"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"}