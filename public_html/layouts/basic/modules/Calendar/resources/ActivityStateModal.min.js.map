{"version":3,"file":"ActivityStateModal.min.js","sources":["ActivityStateModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\"Calendar_ActivityStateModal_Js\", {}, {\n\tregisterActivityState() {\n\t\tconst self = this;\n\t\t$('.js-activity-buttons button:not(.close)').on('click', function (e) {\n\t\t\tlet currentTarget = $(e.currentTarget),\n\t\t\t\tviewName = app.getViewName();\n\t\t\tapp.hideModalWindow();\n\t\t\tif (1 === currentTarget.data('type')) {\n\t\t\t\tself.updateActivityState(currentTarget);\n\t\t\t} else {\n\t\t\t\tlet isReminder = currentTarget.closest('#calendar-reminder-modal').length;\n\t\t\t\tif (app.getModuleName() === 'Calendar' && viewName === 'CalendarExtended' && !isReminder) {\n\t\t\t\t\tlet calendarInstance = new Calendar_CalendarExtended_Js;\n\t\t\t\t\tcalendarInstance.getCalendarSidebarData({\n\t\t\t\t\t\tmodule: 'Calendar',\n\t\t\t\t\t\tview: 'EventForm',\n\t\t\t\t\t\trecord: currentTarget.data('id'),\n\t\t\t\t\t\tisDuplicate: true,\n\t\t\t\t\t\taddRelation: true,\n\t\t\t\t\t\tsourceModule: 'Calendar',\n\t\t\t\t\t\tsourceRecord: currentTarget.data('id')\n\t\t\t\t\t});\n\t\t\t\t} else if (currentTarget.hasClass('showQuickCreate') || isReminder) {\n\t\t\t\t\tlet progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\t\t\t'position': 'html',\n\t\t\t\t\t\t\t'blockInfo': {\n\t\t\t\t\t\t\t\t'enabled': true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\turl = 'index.php?module=Calendar&view=QuickCreateAjax&addRelation=true&sourceModule=Calendar&sourceRecord=' + currentTarget.data('id'),\n\t\t\t\t\t\tparams = {},\n\t\t\t\t\t\tsubject = currentTarget.closest('.modalEditStatus').find('.modalSummaryValues .fieldVal').data('subject'),\n\t\t\t\t\t\theaderInstance = Vtiger_Header_Js.getInstance();\n\t\t\t\t\tparams.noCache = true;\n\t\t\t\t\theaderInstance.getQuickCreateForm(url, 'Calendar', params).done(function (data) {\n\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t\t\t\tif (currentTarget.data('type') == '0' && typeof subject !== \"undefined\" && subject.length > 0) {\n\t\t\t\t\t\t\tdata = $(data);\n\t\t\t\t\t\t\tlet element = data.find('[name=\"subject\"]');\n\t\t\t\t\t\t\tif (element.length) {\n\t\t\t\t\t\t\t\telement.val(subject);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\theaderInstance.handleQuickCreateData(data, {\n\t\t\t\t\t\t\tcallbackFunction: function (data) {\n\t\t\t\t\t\t\t\tif (data && data.success && data.result.followup.value == currentTarget.data('id')) {\n\t\t\t\t\t\t\t\t\tself.updateActivityState(currentTarget);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tupdateActivityState: function (currentTarget) {\n\t\tlet params = {\n\t\t\tmodule: 'Calendar',\n\t\t\taction: \"ActivityStateAjax\",\n\t\t\trecord: currentTarget.data('id'),\n\t\t\tstate: currentTarget.data('state')\n\t\t};\n\t\tapp.hideModalWindow();\n\t\tlet progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tif (data.success) {\n\t\t\t\tlet viewName = app.getViewName();\n\t\t\t\tif (viewName === 'Detail') {\n\t\t\t\t\tconst thisInstance = Vtiger_Detail_Js.getInstance();\n\t\t\t\t\tlet widget = $('.activityWidgetContainer .widgetContentBlock');\n\t\t\t\t\tif (widget.length) {\n\t\t\t\t\t\tthisInstance.loadWidget(widget);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet recentActivitiesTab = thisInstance.getTabByLabel(thisInstance.detailViewRecentActivitiesTabLabel);\n\t\t\t\t\t\tif (recentActivitiesTab) {\n\t\t\t\t\t\t\trecentActivitiesTab.trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (app.getModuleName() === 'Calendar') {\n\t\t\t\t\t\t\trecentActivitiesTab = ((!thisInstance.getSelectedTab().length || thisInstance.getSelectedTab().data('linkKey') == thisInstance.detailViewDetailsTabLabel) ? thisInstance.getTabContainer().find('[data-link-key=\"' + thisInstance.detailViewDetailsTabLabel + '\"]:not(.d-none)') : $('<div></div>'));\n\t\t\t\t\t\t\t$('.showModal.closeCalendarRekord').addClass('d-none');\n\t\t\t\t\t\t\trecentActivitiesTab.trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (viewName === 'List') {\n\t\t\t\t\tlet listinstance = new Vtiger_List_Js();\n\t\t\t\t\tlistinstance.getListViewRecords();\n\t\t\t\t}\n\t\t\t\tif (viewName === 'DashBoard') {\n\t\t\t\t\t(new Vtiger_DashBoard_Js()).getContainer().find('a[name=\"drefresh\"]').trigger('click');\n\t\t\t\t}\n\t\t\t\tif (app.getModuleName() === 'Calendar' && (viewName === 'Calendar' || viewName === 'CalendarExtended')) {\n\t\t\t\t\tconst calendarInstance = new window[`Calendar_${viewName}_Js`];\n\t\t\t\t\tcalendarInstance.loadCalendarData();\n\t\t\t\t\tcalendarInstance.getCalendarCreateView();\n\t\t\t\t}\n\t\t\t\t//updates the Calendar Reminder popup's status\n\t\t\t\tVtiger_Index_Js.requestReminder();\n\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t},\n\tregisterEvents: function () {\n\t\tthis.registerActivityState();\n\t}\n\n});\n\njQuery(document).ready(function (e) {\n\tvar instance = new Calendar_ActivityStateModal_Js();\n\tinstance.registerEvents();\n});\n"],"names":["jQuery","Class","self","this","on","e","currentTarget","$","viewName","app","getViewName","hideModalWindow","data","updateActivityState","isReminder","closest","length","getModuleName","hasClass","progressIndicatorElement","progressIndicator","url","params","subject","find","headerInstance","Vtiger_Header_Js","getInstance","noCache","getQuickCreateForm","done","mode","element","val","handleQuickCreateData","success","result","followup","value","Calendar_CalendarExtended_Js","getCalendarSidebarData","request","thisInstance","Vtiger_Detail_Js","widget","loadWidget","recentActivitiesTab","getTabByLabel","detailViewRecentActivitiesTabLabel","trigger","getSelectedTab","detailViewDetailsTabLabel","getTabContainer","addClass","Vtiger_List_Js","getListViewRecords","Vtiger_DashBoard_Js","getContainer","calendarInstance","window","loadCalendarData","getCalendarCreateView","requestReminder","registerActivityState","document","ready","Calendar_ActivityStateModal_Js","registerEvents"],"mappings":"aAGAA,OAAOC,MAAM,iCAAkC,GAAI,sCAE3CC,KAAOC,OACX,2CAA2CC,GAAG,SAAS,SAAUC,OAC9DC,cAAgBC,EAAEF,EAAEC,eACvBE,SAAWC,IAAIC,qBACZC,kBACA,IAAML,cAAcM,KAAK,aACvBC,oBAAoBP,mBACnB,KACFQ,WAAaR,cAAcS,QAAQ,4BAA4BC,UACvC,aAAxBP,IAAIQ,iBAA+C,qBAAbT,UAAoCM,YAWvE,GAAIR,cAAcY,SAAS,oBAAsBJ,WAAY,KAC/DK,yBAA2BZ,EAAEa,kBAAkB,UACrC,iBACC,UACD,KAGbC,IAAM,sGAAwGf,cAAcM,KAAK,MACjIU,OAAS,GACTC,QAAUjB,cAAcS,QAAQ,oBAAoBS,KAAK,iCAAiCZ,KAAK,WAC/Fa,eAAiBC,iBAAiBC,qBAC5BC,SAAU,iBACFC,mBAAmBR,IAAK,WAAYC,QAAQQ,MAAK,SAAUlB,kCAChDQ,kBAAkB,CAACW,KAAQ,SAClB,KAA9BzB,cAAcM,KAAK,cAAqC,IAAZW,SAA2BA,QAAQP,OAAS,EAAG,KAE1FgB,cADGzB,EAAEK,OACUY,KAAK,oBACpBQ,QAAQhB,gBACHiB,IAAIV,wBAGCW,sBAAsBtB,KAAM,kBACxB,SAAUA,MACvBA,MAAQA,KAAKuB,SAAWvB,KAAKwB,OAAOC,SAASC,OAAShC,cAAcM,KAAK,YACvEC,oBAAoBP,2BAlCN,IAAIiC,8BACVC,uBAAuB,QAC/B,gBACF,mBACElC,cAAcM,KAAK,mBACd,eACA,eACC,wBACAN,cAAcM,KAAK,iCAmCjB,SAAUN,mBAC1BgB,OAAS,QACJ,kBACA,2BACAhB,cAAcM,KAAK,YACpBN,cAAcM,KAAK,cAEvBD,sBACAQ,yBAA2BnB,OAAOoB,kBAAkB,UAC3C,iBACC,UACD,kBAGAqB,QAAQnB,QAAQQ,MAAK,SAAUlB,UACvCA,KAAKuB,eAmCD,MAlCH3B,SAAWC,IAAIC,iBACF,WAAbF,SAAuB,KACpBkC,aAAeC,iBAAiBhB,cAClCiB,OAASrC,EAAE,mDACXqC,OAAO5B,oBACG6B,WAAWD,YAClB,KACFE,oBAAsBJ,aAAaK,cAAcL,aAAaM,oCAC9DF,yCACiBG,QAAQ,SAED,aAAxBxC,IAAIQ,sCACkByB,aAAaQ,iBAAiBlC,QAAU0B,aAAaQ,iBAAiBtC,KAAK,YAAc8B,aAAaS,0BAAoJ5C,EAAE,eAAzHmC,aAAaU,kBAAkB5B,KAAK,mBAAqBkB,aAAaS,0BAA4B,qBAC5P,kCAAkCE,SAAS,8BACzBJ,QAAQ,cAId,SAAbzC,WACgB,IAAI8C,gBACVC,qBAEG,cAAb/C,eACEgD,qBAAuBC,eAAejC,KAAK,sBAAsByB,QAAQ,SAEnD,aAAxBxC,IAAIQ,kBAAgD,aAAbT,UAAwC,qBAAbA,UAAkC,KACjGkD,iBAAmB,IAAIC,mBAAmBnD,iCAC/BoD,oCACAC,wCAGFC,2CACS1C,kBAAkB,CAACW,KAAQ,4BAMvC,gBACVgC,2BAKP/D,OAAOgE,UAAUC,OAAM,SAAU5D,IACjB,IAAI6D,gCACVC"}