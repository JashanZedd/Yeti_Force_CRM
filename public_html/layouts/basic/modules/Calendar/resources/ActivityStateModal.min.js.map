{"version":3,"file":"ActivityStateModal.min.js","sources":["ActivityStateModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\"Calendar_ActivityStateModal_Js\", {}, {\n\tregisterActivityState() {\n\t\tconst self = this;\n\t\t$('.js-activity-state button:not(.close)').on('click', function (e) {\n\t\t\tlet currentTarget = $(e.currentTarget),\n\t\t\t\tviewName = app.getViewName();\n\t\t\tcurrentTarget.closest('.modal').addClass('d-none');\n\t\t\tif (1 === currentTarget.data('type')) {\n\t\t\t\tself.updateActivityState(currentTarget);\n\t\t\t} else {\n\t\t\t\tif (app.getModuleName() === 'Calendar' && viewName === 'CalendarExtended') {\n\t\t\t\t\t(Calendar_Calendar_Js.getInstanceByView()).getCalendarEditView(currentTarget.data('id'), {\n\t\t\t\t\t\tisDuplicate: true,\n\t\t\t\t\t\taddRelation: true,\n\t\t\t\t\t\tsourceModule: 'Calendar',\n\t\t\t\t\t\tsourceRecord: currentTarget.data('id')\n\t\t\t\t\t})\n\t\t\t\t} else if (currentTarget.hasClass('showQuickCreate')) {\n\t\t\t\t\tlet progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\t\t\t'position': 'html',\n\t\t\t\t\t\t\t'blockInfo': {\n\t\t\t\t\t\t\t\t'enabled': true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\turl = 'index.php?module=Calendar&view=QuickCreateAjax&addRelation=true&sourceModule=Calendar&sourceRecord=' + currentTarget.data('id'),\n\t\t\t\t\t\tparams = {},\n\t\t\t\t\t\tsubject = currentTarget.closest('.modalEditStatus').find('.modalSummaryValues .fieldVal').data('subject'),\n\t\t\t\t\t\theaderInstance = Vtiger_Header_Js.getInstance();\n\t\t\t\t\tparams.noCache = true;\n\t\t\t\t\theaderInstance.getQuickCreateForm(url, 'Calendar', params).done(function (data) {\n\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t\t\t\tif (currentTarget.data('type') == '0' && typeof subject !== \"undefined\" && subject.length > 0) {\n\t\t\t\t\t\t\tdata = $(data);\n\t\t\t\t\t\t\tlet element = data.find('[name=\"subject\"]');\n\t\t\t\t\t\t\tif (element.length) {\n\t\t\t\t\t\t\t\telement.val(subject);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\theaderInstance.handleQuickCreateData(data, {\n\t\t\t\t\t\t\tcallbackFunction: function (data) {\n\t\t\t\t\t\t\t\tif (data && data.success && data.result.followup.value == currentTarget.data('id')) {\n\t\t\t\t\t\t\t\t\tself.updateActivityState(currentTarget);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tupdateActivityState: function (currentTarget) {\n\t\tvar thisInstance = this;\n\t\tvar params = {\n\t\t\tmodule: 'Calendar',\n\t\t\taction: \"ActivityStateAjax\",\n\t\t\trecord: currentTarget.data('id'),\n\t\t\tstate: currentTarget.data('state')\n\t\t};\n\t\tapp.hideModalWindow();\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tif (data.success) {\n\t\t\t\tlet viewName = app.getViewName();\n\t\t\t\tif (viewName === 'Detail') {\n\t\t\t\t\tconst thisInstance = Vtiger_Detail_Js.getInstance();\n\t\t\t\t\tlet widget = $('.activityWidgetContainer .widgetContentBlock');\n\t\t\t\t\tif (widget.length) {\n\t\t\t\t\t\tthisInstance.loadWidget(widget);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet recentActivitiesTab = thisInstance.getTabByLabel(thisInstance.detailViewRecentActivitiesTabLabel);\n\t\t\t\t\t\tif (recentActivitiesTab) {\n\t\t\t\t\t\t\trecentActivitiesTab.trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (app.getModuleName() === 'Calendar') {\n\t\t\t\t\t\t\trecentActivitiesTab = ((!thisInstance.getSelectedTab().length || thisInstance.getSelectedTab().data('linkKey') == thisInstance.detailViewDetailsTabLabel) ? thisInstance.getTabContainer().find('[data-link-key=\"' + thisInstance.detailViewDetailsTabLabel + '\"]:not(.d-none)') : $('<div></div>'));\n\t\t\t\t\t\t\t$('.showModal.closeCalendarRekord').addClass('d-none');\n\t\t\t\t\t\t\trecentActivitiesTab.trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (viewName === 'List') {\n\t\t\t\t\tlet listinstance = new Vtiger_List_Js();\n\t\t\t\t\tlistinstance.getListViewRecords();\n\t\t\t\t}\n\t\t\t\tif (viewName === 'DashBoard') {\n\t\t\t\t\t(new Vtiger_DashBoard_Js()).getContainer().find('a[name=\"drefresh\"]').trigger('click');\n\t\t\t\t}\n\t\t\t\tif (app.getModuleName() === 'Calendar' && (viewName === 'Calendar' || viewName === 'CalendarExtended')) {\n\t\t\t\t\tconst calendarInstance = Calendar_Calendar_Js.getInstanceByView();\n\t\t\t\t\tcalendarInstance.loadCalendarData();\n\t\t\t\t\tcalendarInstance.getCalendarCreateView();\n\t\t\t\t}\n\t\t\t\t//updates the Calendar Reminder popup's status\n\t\t\t\tVtiger_Index_Js.requestReminder();\n\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t},\n\tregisterEvents: function () {\n\t\tthis.registerActivityState();\n\t}\n\n});\n\njQuery(document).ready(function (e) {\n\tvar instance = new Calendar_ActivityStateModal_Js();\n\tinstance.registerEvents();\n});\n"],"names":["jQuery","Class","registerActivityState","$","on","e","currentTarget","viewName","app","getViewName","closest","addClass","data","self","updateActivityState","getModuleName","Calendar_Calendar_Js","getInstanceByView","getCalendarEditView","isDuplicate","addRelation","sourceModule","sourceRecord","hasClass","progressIndicator","url","params","subject","find","headerInstance","Vtiger_Header_Js","getInstance","noCache","getQuickCreateForm","done","progressIndicatorElement","length","element","val","handleQuickCreateData","callbackFunction","success","result","followup","value","thisInstance","module","action","record","state","hideModalWindow","AppConnector","request","Vtiger_Detail_Js","widget","loadWidget","getTabByLabel","detailViewRecentActivitiesTabLabel","recentActivitiesTab","trigger","getSelectedTab","detailViewDetailsTabLabel","getTabContainer","listinstance","getListViewRecords","getContainer","calendarInstance","loadCalendarData","getCalendarCreateView","Vtiger_Index_Js","requestReminder","registerEvents","document","ready","instance"],"mappings":"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"}