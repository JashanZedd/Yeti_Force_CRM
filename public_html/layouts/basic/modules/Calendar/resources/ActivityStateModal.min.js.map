{"version":3,"file":"ActivityStateModal.min.js","sources":["ActivityStateModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\n\t'Calendar_ActivityStateModal_Js',\n\t{},\n\t{\n\t\tregisterActivityState() {\n\t\t\tconst self = this;\n\t\t\t$('.js-activity-buttons').on('click', 'button:not(.close, .js-postpone), .js-postpone-time', function (e) {\n\t\t\t\tlet currentTarget = $(e.currentTarget);\n\t\t\t\tapp.hideModalWindow();\n\t\t\t\tif (1 === currentTarget.data('type')) {\n\t\t\t\t\tself.updateActivityState(currentTarget);\n\t\t\t\t} else {\n\t\t\t\t\tlet isReminder = currentTarget.closest('#calendar-reminder-modal').length;\n\t\t\t\t\tif (currentTarget.hasClass('showQuickCreate') || isReminder) {\n\t\t\t\t\t\tlet progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\t\t\t\tposition: 'html',\n\t\t\t\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\t\t\t\tenabled: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\turl =\n\t\t\t\t\t\t\t\t'index.php?module=Calendar&view=QuickCreateAjax&addRelation=true&sourceModule=Calendar&sourceRecord=' +\n\t\t\t\t\t\t\t\tcurrentTarget.data('id') +\n\t\t\t\t\t\t\t\t'&fillFields=all',\n\t\t\t\t\t\t\tparams = {};\n\t\t\t\t\t\tif (currentTarget.data('postpone-time')) {\n\t\t\t\t\t\t\turl = url + '&postponeTime=' + encodeURIComponent(currentTarget.data('postpone-time'));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparams.noCache = true;\n\t\t\t\t\t\tApp.Components.QuickCreate.getForm(url, 'Calendar', params).done(function (data) {\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\tApp.Components.QuickCreate.showModal(data, {\n\t\t\t\t\t\t\t\tcallbackFunction: function (data) {\n\t\t\t\t\t\t\t\t\tif (data && data.success && data.result.followup.value == currentTarget.data('id')) {\n\t\t\t\t\t\t\t\t\t\tself.updateActivityState(currentTarget);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tupdateActivityState: function (currentTarget) {\n\t\t\tlet params = {\n\t\t\t\tmodule: 'Calendar',\n\t\t\t\taction: 'ActivityStateAjax',\n\t\t\t\trecord: currentTarget.data('id'),\n\t\t\t\tstate: currentTarget.data('state')\n\t\t\t};\n\t\t\tapp.hideModalWindow();\n\t\t\tlet progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\tif (data.success) {\n\t\t\t\t\tlet viewName = app.getViewName();\n\t\t\t\t\tif (viewName === 'Detail') {\n\t\t\t\t\t\tconst thisInstance = Vtiger_Detail_Js.getInstance();\n\t\t\t\t\t\tlet widget = $('.activityWidgetContainer .widgetContentBlock');\n\t\t\t\t\t\tif (widget.length) {\n\t\t\t\t\t\t\tthisInstance.loadWidget(widget);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet recentActivitiesTab = thisInstance.getTabByLabel(thisInstance.detailViewRecentActivitiesTabLabel);\n\t\t\t\t\t\t\tif (recentActivitiesTab) {\n\t\t\t\t\t\t\t\trecentActivitiesTab.trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (app.getModuleName() === 'Calendar') {\n\t\t\t\t\t\t\t\trecentActivitiesTab =\n\t\t\t\t\t\t\t\t\t!thisInstance.getSelectedTab().length ||\n\t\t\t\t\t\t\t\t\tthisInstance.getSelectedTab().data('linkKey') == thisInstance.detailViewDetailsTabLabel\n\t\t\t\t\t\t\t\t\t\t? thisInstance\n\t\t\t\t\t\t\t\t\t\t\t\t.getTabContainer()\n\t\t\t\t\t\t\t\t\t\t\t\t.find('[data-link-key=\"' + thisInstance.detailViewDetailsTabLabel + '\"]:not(.d-none)')\n\t\t\t\t\t\t\t\t\t\t: $('<div></div>');\n\t\t\t\t\t\t\t\t$('.showModal.closeCalendarRekord').addClass('d-none');\n\t\t\t\t\t\t\t\trecentActivitiesTab.trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (viewName === 'List') {\n\t\t\t\t\t\tlet listinstance = new Vtiger_List_Js();\n\t\t\t\t\t\tlistinstance.getListViewRecords();\n\t\t\t\t\t}\n\t\t\t\t\tif (viewName === 'DashBoard') {\n\t\t\t\t\t\tnew Vtiger_DashBoard_Js().getContainer().find('.js-widget-refresh').trigger('click');\n\t\t\t\t\t}\n\t\t\t\t\tif (app.getModuleName() === 'Calendar' && viewName === 'Calendar') {\n\t\t\t\t\t\tapp.pageController.loadCalendarData();\n\t\t\t\t\t\tapp.pageController.getCalendarCreateView();\n\t\t\t\t\t}\n\t\t\t\t\t//updates the Calendar Reminder popup's status\n\t\t\t\t\tVtiger_Index_Js.requestReminder();\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterEvents: function () {\n\t\t\tthis.registerActivityState();\n\t\t}\n\t}\n);\n\njQuery(document).ready(function (e) {\n\tvar instance = new Calendar_ActivityStateModal_Js();\n\tinstance.registerEvents();\n});\n"],"names":["jQuery","Class","registerActivityState","self","$","on","e","currentTarget","app","hideModalWindow","data","updateActivityState","isReminder","closest","length","hasClass","progressIndicator","position","blockInfo","enabled","url","params","encodeURIComponent","noCache","App","Components","QuickCreate","getForm","done","progressIndicatorElement","mode","showModal","callbackFunction","success","result","followup","value","module","action","record","state","AppConnector","request","getViewName","viewName","thisInstance","Vtiger_Detail_Js","getInstance","widget","loadWidget","recentActivitiesTab","getTabByLabel","detailViewRecentActivitiesTabLabel","trigger","getModuleName","getSelectedTab","detailViewDetailsTabLabel","getTabContainer","find","addClass","listinstance","getListViewRecords","getContainer","pageController","loadCalendarData","getCalendarCreateView","Vtiger_Index_Js","requestReminder","registerEvents","document","ready","instance"],"mappings":"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"}