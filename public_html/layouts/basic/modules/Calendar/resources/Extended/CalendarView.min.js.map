{"version":3,"file":"CalendarView.min.js","sources":["CalendarView.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n/**\n *  Class representing an extended calendar.\n * @extends Calendar_Calendar_Js\n */\nwindow.calendarLoaded = false; //Global calendar flag needed for correct loading data from history browser in year view\nwindow.Calendar_CalendarExtended_Js = class extends Calendar_Calendar_Js {\n\tconstructor(container, readonly) {\n\t\tsuper(container, readonly);\n\t\tthis.sidebarView = {\n\t\t\tlength: 0\n\t\t};\n\t\tthis.calendarContainer = false;\n\t\tthis.addCommonMethodsToYearView();\n\t\tthis.calendar = this.getCalendarView();\n\t}\n\n\t/**\n\t * Function extends FC.views.year with current class methods\n\t */\n\taddCommonMethodsToYearView() {\n\t\tconst self = this;\n\t\tFC.views.year = FC.views.year.extend({\n\t\t\tselectDays: self.selectDays,\n\t\t\tgetCalendarCreateView: self.getCalendarCreateView,\n\t\t\tgetSidebarView: self.getSidebarView,\n\t\t\tgetCurrentCvId: self.getCurrentCvId,\n\t\t\tgetCalendarView: self.getCalendarView,\n\t\t\tshowRightPanelForm: self.showRightPanelForm,\n\t\t\tgetSelectedUsersCalendar: self.getSelectedUsersCalendar,\n\t\t\tregisterClearFilterButton: self.registerClearFilterButton,\n\t\t\tclearFilterButton: self.clearFilterButton,\n\t\t\tregisterFilterTabChange: self.registerFilterTabChange,\n\t\t\tsidebarView: self.sidebarView,\n\t\t\tregisterAfterSubmitForm: self.registerAfterSubmitForm,\n\t\t\tregisterViewRenderEvents: self.registerViewRenderEvents,\n\t\t\tappendSubDateRow: self.appendSubDateRow,\n\t\t\trefreshDatesRowView: self.refreshDatesRowView,\n\t\t\tgenerateYearList: self.generateYearList,\n\t\t\tupdateCountTaskCalendar: self.updateCountTaskCalendar,\n\t\t\tregisterDatesChange: self.registerDatesChange,\n\t\t\taddHeaderButtons: self.addHeaderButtons,\n\t\t\tbrowserHistoryConfig: self.browserHistoryConfig,\n\t\t\treadonly: self.readonly,\n\t\t\tcontainer: self.container,\n\t\t\tmodule: self.module,\n\t\t\tshowChangeDateButtons: self.showChangeDateButtons,\n\t\t\tshowTodayButtonCheckbox: self.showTodayButtonCheckbox\n\t\t});\n\t}\n\n\t/**\n\t * Render calendar\n\t */\n\trenderCalendar() {\n\t\tlet self = this,\n\t\t\tbasicOptions = this.setCalendarOptions(),\n\t\t\toptions = {\n\t\t\t\theader: {\n\t\t\t\t\tleft: 'year,month,' + app.getMainParams('weekView') + ',' + app.getMainParams('dayView'),\n\t\t\t\t\tcenter: 'prevYear,prev,title,next,nextYear',\n\t\t\t\t\tright: 'today'\n\t\t\t\t},\n\t\t\t\tviews: {\n\t\t\t\t\tbasic: {\n\t\t\t\t\t\teventLimit: false\n\t\t\t\t\t},\n\t\t\t\t\tyear: {\n\t\t\t\t\t\teventLimit: 10,\n\t\t\t\t\t\teventLimitText: app.vtranslate('JS_COUNT_RECORDS'),\n\t\t\t\t\t\ttitleFormat: 'YYYY',\n\t\t\t\t\t\tselect: function(start, end) {},\n\t\t\t\t\t\tloadView: function() {\n\t\t\t\t\t\t\tself.getCalendarView()\n\t\t\t\t\t\t\t\t.fullCalendar('getCalendar')\n\t\t\t\t\t\t\t\t.view.render();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tmonth: {\n\t\t\t\t\t\ttitleFormat: this.parseDateFormat('month'),\n\t\t\t\t\t\tloadView: function() {\n\t\t\t\t\t\t\tself.loadCalendarData();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tweek: {\n\t\t\t\t\t\ttitleFormat: this.parseDateFormat('week'),\n\t\t\t\t\t\tloadView: function() {\n\t\t\t\t\t\t\tself.loadCalendarData();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tday: {\n\t\t\t\t\t\ttitleFormat: this.parseDateFormat('day'),\n\t\t\t\t\t\tloadView: function() {\n\t\t\t\t\t\t\tself.loadCalendarData();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tbasicDay: {\n\t\t\t\t\t\ttype: 'agendaDay',\n\t\t\t\t\t\tloadView: function() {\n\t\t\t\t\t\t\tself.loadCalendarData();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tselect: function(start, end) {\n\t\t\t\t\tself.selectDays(start, end);\n\t\t\t\t\tself.getCalendarView().fullCalendar('unselect');\n\t\t\t\t},\n\t\t\t\teventRender: function(event, element) {\n\t\t\t\t\tself.eventRenderer(event, element);\n\t\t\t\t},\n\t\t\t\tviewRender: function(view, element) {\n\t\t\t\t\tif (view.type !== 'year') {\n\t\t\t\t\t\tself.loadCalendarData(view);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\taddCalendarEvent(calendarDetails) {\n\t\t\t\t\tself.getCalendarView().fullCalendar('renderEvent', self.getEventData(calendarDetails));\n\t\t\t\t}\n\t\t\t};\n\t\toptions = Object.assign(basicOptions, options);\n\t\tif (!this.readonly && self.eventEdit) {\n\t\t\toptions.eventClick = function(calEvent, jsEvent) {\n\t\t\t\tjsEvent.preventDefault();\n\t\t\t\tself.getCalendarSidebarData($(this).attr('href'));\n\t\t\t};\n\t\t} else {\n\t\t\toptions.eventClick = function(calEvent, jsEvent) {\n\t\t\t\tjsEvent.preventDefault();\n\t\t\t\tconst link = new URL($(this)[0].href);\n\t\t\t\twindow.location.assign(\n\t\t\t\t\t`index.php?module=${this.module}&view=Detail&record=${link.searchParams.get('record')}`\n\t\t\t\t);\n\t\t\t};\n\t\t}\n\t\tthis.calendar.fullCalendar(options);\n\t}\n\n\tregisterChangeView() {}\n\n\taddHeaderButtons() {\n\t\tif (this.calendarContainer.find('.js-calendar__view-btn').length) {\n\t\t\treturn;\n\t\t}\n\t\tlet buttonsContainer = this.calendarContainer.prev('.js-calendar__header-buttons'),\n\t\t\tviewBtn = buttonsContainer.find('.js-calendar__view-btn').clone(),\n\t\t\tfilters = buttonsContainer.find('.js-calendar__filter-container').clone();\n\t\tthis.calendarContainer.find('.fc-left').prepend(viewBtn);\n\t\tthis.calendarContainer.find('.fc-center').after(filters);\n\t\tthis.registerClearFilterButton();\n\t\tthis.registerFilterTabChange();\n\t}\n\n\tregisterSwitchEvents() {\n\t\tconst calendarView = this.getCalendarView();\n\t\tlet isWorkDays,\n\t\t\tswitchShowTypeVal,\n\t\t\tswitchContainer = $('.js-calendar__tab--filters'),\n\t\t\tswitchShowType = switchContainer.find('.js-switch--showType'),\n\t\t\tswitchSwitchingDays = switchContainer.find('.js-switch--switchingDays');\n\t\tlet historyParams = app.getMainParams('historyParams', true);\n\t\tif (historyParams === '') {\n\t\t\t(isWorkDays =\n\t\t\t\tapp.getMainParams('switchingDays') === 'workDays' &&\n\t\t\t\tapp.moduleCacheGet('defaultSwitchingDays') !== 'all'),\n\t\t\t\t(switchShowTypeVal =\n\t\t\t\t\tapp.getMainParams('showType') === 'current' && app.moduleCacheGet('defaultShowType') !== 'history');\n\t\t\tif (!switchShowTypeVal) {\n\t\t\t\tswitchShowType.find('.js-switch--label-off').button('toggle');\n\t\t\t}\n\t\t} else {\n\t\t\tapp.setMainParams('showType', historyParams.time);\n\t\t\tapp.setMainParams('switchingDays', historyParams.hiddenDays === '' ? 'all' : 'workDays');\n\t\t}\n\t\tswitchShowType.on('change', 'input', e => {\n\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\tif (typeof currentTarget.data('on-text') !== 'undefined') {\n\t\t\t\tapp.setMainParams('showType', 'current');\n\t\t\t\tapp.moduleCacheSet('defaultShowType', 'current');\n\t\t\t} else if (typeof currentTarget.data('off-text') !== 'undefined') {\n\t\t\t\tapp.setMainParams('showType', 'history');\n\t\t\t\tapp.moduleCacheSet('defaultShowType', 'history');\n\t\t\t}\n\t\t\tcalendarView.fullCalendar('getCalendar').view.options.loadView();\n\t\t});\n\t\t$('label.active', switchShowType)\n\t\t\t.find('input')\n\t\t\t.filter(':first')\n\t\t\t.change();\n\t\tif (switchSwitchingDays.length) {\n\t\t\tif (typeof isWorkDays !== 'undefined' && !isWorkDays) {\n\t\t\t\tswitchSwitchingDays.find('.js-switch--label-off').button('toggle');\n\t\t\t}\n\t\t\tswitchSwitchingDays.on('change', 'input', e => {\n\t\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\t\tlet hiddenDays = [];\n\t\t\t\tif (typeof currentTarget.data('on-text') !== 'undefined') {\n\t\t\t\t\tapp.setMainParams('switchingDays', 'workDays');\n\t\t\t\t\tapp.moduleCacheSet('defaultSwitchingDays', 'workDays');\n\t\t\t\t\thiddenDays = app.getMainParams('hiddenDays', true);\n\t\t\t\t} else if (typeof currentTarget.data('off-text') !== 'undefined') {\n\t\t\t\t\tapp.setMainParams('switchingDays', 'all');\n\t\t\t\t\tapp.moduleCacheSet('defaultSwitchingDays', 'all');\n\t\t\t\t}\n\t\t\t\tcalendarView.fullCalendar('option', 'hiddenDays', hiddenDays);\n\t\t\t\tcalendarView.fullCalendar('option', 'height', this.setCalendarHeight());\n\t\t\t\tif (calendarView.fullCalendar('getView').type === 'year') {\n\t\t\t\t\tthis.registerViewRenderEvents(calendarView.fullCalendar('getView'));\n\t\t\t\t}\n\t\t\t});\n\t\t\t$('label.active', switchSwitchingDays)\n\t\t\t\t.find('input')\n\t\t\t\t.filter(':first')\n\t\t\t\t.change();\n\t\t}\n\t}\n\n\t/**\n\t * Appends subdate row to calendar header and register its scroll\n\t * @param toolbar\n\t */\n\tappendSubDateRow(toolbar) {\n\t\tif (!this.calendarContainer.find('.js-dates-row').length) {\n\t\t\tthis.subDateRow = $(`\n\t\t\t\t\t\t\t\t<div class=\"js-scroll js-dates-row u-overflow-auto-lg-down order-4 flex-grow-1 position-relative my-1 w-100\" data-js=\"perfectScrollbar | container\">\n\t\t\t\t\t\t\t\t\t<div class=\"d-flex flex-nowrap w-100\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"js-sub-date-list w-100 sub-date-list row no-gutters flex-nowrap nav nav-tabs\" data-js=\"data-type\"></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`);\n\t\t\ttoolbar.append(this.subDateRow);\n\t\t\tif ($(window).width() > app.breakpoints.lg) {\n\t\t\t\tapp.showNewScrollbar(this.subDateRow);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Function toggles next year/month and general arrows on view render\n\t * @param view\n\t * @param element\n\t */\n\tregisterViewRenderEvents(view) {\n\t\tthis.calendarContainer = this.getCalendarView();\n\t\tlet toolbar = this.calendarContainer.find('.fc-toolbar.fc-header-toolbar');\n\t\tthis.showChangeDateButtons(view, toolbar);\n\t\tthis.appendSubDateRow(toolbar);\n\t\tthis.refreshDatesRowView(view);\n\t\tthis.addHeaderButtons();\n\t\tthis.showTodayButtonCheckbox(toolbar);\n\t}\n\n\t/**\n\t * Function appends and shows today button's checkbox\n\t * @param {jQuery} toolbar\n\t */\n\tshowTodayButtonCheckbox(toolbar) {\n\t\tlet todayButton = toolbar.find('.fc-today-button'),\n\t\t\ttodyButtonIcon = todayButton.hasClass('fc-state-disabled') ? 'fa-calendar-check' : 'fa-calendar',\n\t\t\tpopoverContent = `${app.vtranslate('JS_CURRENT')} ${toolbar\n\t\t\t\t.find('.fc-state-active')\n\t\t\t\t.text()\n\t\t\t\t.toLowerCase()}`;\n\t\ttodayButton.removeClass('.fc-button');\n\t\ttodayButton.html(\n\t\t\t`<div class=\"js-popover-tooltip--day-btn\" data-toggle=\"popover\"><span class=\"far fa-lg ${todyButtonIcon}\"></span></div>`\n\t\t);\n\t\tapp.showPopoverElementView(todayButton.find('.js-popover-tooltip--day-btn'), {\n\t\t\tcontent: popoverContent,\n\t\t\tcontainer: '.fc-today-button .js-popover-tooltip--day-btn'\n\t\t});\n\t}\n\n\t/**\n\t * Function shows change date buttons in calendar's header for specific view\n\t * @param view\n\t * @param toolbar\n\t */\n\tshowChangeDateButtons(view, toolbar) {\n\t\tlet viewType = view.type.replace(/basic|agenda/g, '').toLowerCase(),\n\t\t\tnextPrevButtons = toolbar.find('.fc-prev-button, .fc-next-button'),\n\t\t\tyearButtons = toolbar.find('.fc-prevYear-button, .fc-nextYear-button');\n\t\tif (!window.calendarLoaded) {\n\t\t\tyearButtons.first().html(`<span class=\"fas fa-xs fa-minus mr-1\"></span>${view.options.buttonText['year']}`);\n\t\t\tyearButtons.last().html(`${view.options.buttonText['year']}<span class=\"fas fa-xs fa-plus ml-1\"></span>`);\n\t\t}\n\t\tif (view.type !== 'year') {\n\t\t\tnextPrevButtons\n\t\t\t\t.first()\n\t\t\t\t.html(`<span class=\"fas fa-xs fa-minus mr-1\"></span>${view.options.buttonText[viewType]}`);\n\t\t\tnextPrevButtons\n\t\t\t\t.last()\n\t\t\t\t.html(`${view.options.buttonText[viewType]}<span class=\"fas fa-xs fa-plus ml-1\"></span>`);\n\t\t}\n\t\tif (view.type === 'year') {\n\t\t\tnextPrevButtons.hide();\n\t\t\tyearButtons.show();\n\t\t} else if (view.type === 'month') {\n\t\t\tnextPrevButtons.show();\n\t\t\tyearButtons.show();\n\t\t} else {\n\t\t\tnextPrevButtons.show();\n\t\t\tyearButtons.hide();\n\t\t}\n\t}\n\n\t/**\n\t * Date bar with counts\n\t * @param object calendarView\n\t */\n\trefreshDatesRowView(calendarView) {\n\t\tconst self = this;\n\t\tswitch (calendarView.type) {\n\t\t\tcase 'year':\n\t\t\t\tself.generateYearList(calendarView.intervalStart, calendarView.intervalEnd);\n\t\t\t\tbreak;\n\t\t\tcase 'month':\n\t\t\t\tself.generateSubMonthList(calendarView.intervalStart, calendarView.intervalEnd);\n\t\t\t\tbreak;\n\t\t\tcase 'week':\n\t\t\tcase 'agendaWeek':\n\t\t\t\tself.generateSubWeekList(calendarView.start, calendarView.end);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tself.generateSubDaysList(calendarView.start, calendarView.end);\n\t\t}\n\t\tself.updateCountTaskCalendar();\n\t\tself.registerDatesChange();\n\t}\n\n\tregisterDatesChange() {\n\t\tthis.container.find('.js-dates-row .js-sub-record').on('click', e => {\n\t\t\tlet currentTarget = $(e.currentTarget);\n\t\t\tcurrentTarget.addClass('active');\n\t\t\tthis.getCalendarView().fullCalendar('gotoDate', moment(currentTarget.data('date'), 'YYYY-MM-DD'));\n\t\t});\n\t}\n\n\tgetCurrentCvId() {\n\t\treturn $('.js-calendar__extended-filter-tab .active')\n\t\t\t.parent('.js-filter-tab')\n\t\t\t.data('cvid');\n\t}\n\n\tregisterFilterTabChange() {\n\t\tconst thisInstance = this;\n\t\tthis.getCalendarView()\n\t\t\t.find('.js-calendar__extended-filter-tab')\n\t\t\t.on('shown.bs.tab', function() {\n\t\t\t\tthisInstance\n\t\t\t\t\t.getCalendarView()\n\t\t\t\t\t.fullCalendar('getCalendar')\n\t\t\t\t\t.view.options.loadView();\n\t\t\t});\n\t}\n\n\tgetSelectedUsersCalendar() {\n\t\tconst sidebar = this.getSidebarView();\n\t\tlet selectedUsers = sidebar.find('.js-input-user-owner-id:checked'),\n\t\t\tselectedUsersAjax = sidebar.find('.js-input-user-owner-id-ajax'),\n\t\t\tselectedRolesAjax = sidebar.find('.js-input-role-owner-id-ajax'),\n\t\t\tusers = [];\n\t\tif (selectedUsers.length > 0) {\n\t\t\tselectedUsers.each(function() {\n\t\t\t\tusers.push($(this).val());\n\t\t\t});\n\t\t} else if (selectedUsersAjax.length > 0) {\n\t\t\tusers = selectedUsersAjax.val().concat(selectedRolesAjax.val());\n\t\t}\n\t\treturn users;\n\t}\n\n\tgetSidebarView() {\n\t\tif (!this.sidebarView.length) {\n\t\t\tthis.sidebarView = this.container.find('.js-calendar-right-panel');\n\t\t}\n\t\treturn this.sidebarView;\n\t}\n\n\tupdateCountTaskCalendar() {\n\t\tlet datesView = this.container.find('.js-dates-row'),\n\t\t\tsubDatesElements = datesView.find('.js-sub-record'),\n\t\t\tdateArray = {},\n\t\t\tuserDateFormat = CONFIG.dateFormat.toUpperCase(),\n\t\t\tuser = this.getSelectedUsersCalendar();\n\t\tif (user.length === 0) {\n\t\t\tuser = app.getMainParams('usersId');\n\t\t}\n\t\tif (user === undefined) {\n\t\t\tuser = [app.getMainParams('userId')];\n\t\t}\n\t\tsubDatesElements.each(function(key, element) {\n\t\t\tlet data = $(this).data('date'),\n\t\t\t\ttype = $(this).data('type');\n\t\t\tif (type === 'years') {\n\t\t\t\tdateArray[key] = [\n\t\t\t\t\tmoment(data + '-01').format(userDateFormat) + ' 00:00:00',\n\t\t\t\t\tmoment(data + '-01')\n\t\t\t\t\t\t.endOf('year')\n\t\t\t\t\t\t.format(userDateFormat) + ' 23:59:59'\n\t\t\t\t];\n\t\t\t} else if (type === 'months') {\n\t\t\t\tdateArray[key] = [\n\t\t\t\t\tmoment(data).format(userDateFormat) + ' 00:00:00',\n\t\t\t\t\tmoment(data)\n\t\t\t\t\t\t.endOf('month')\n\t\t\t\t\t\t.format(userDateFormat) + ' 23:59:59'\n\t\t\t\t];\n\t\t\t} else if (type === 'weeks') {\n\t\t\t\tdateArray[key] = [\n\t\t\t\t\tmoment(data).format(userDateFormat) + ' 00:00:00',\n\t\t\t\t\tmoment(data)\n\t\t\t\t\t\t.add(6, 'day')\n\t\t\t\t\t\t.format(userDateFormat) + ' 23:59:59'\n\t\t\t\t];\n\t\t\t} else if (type === 'days') {\n\t\t\t\tdateArray[key] = [\n\t\t\t\t\tmoment(data).format(userDateFormat) + ' 00:00:00',\n\t\t\t\t\tmoment(data).format(userDateFormat) + ' 23:59:59'\n\t\t\t\t];\n\t\t\t}\n\t\t});\n\t\tAppConnector.request({\n\t\t\tmodule: this.module,\n\t\t\taction: 'Calendar',\n\t\t\tmode: 'getCountEventsGroup',\n\t\t\tdates: dateArray,\n\t\t\tuser: user,\n\t\t\ttime: app.getMainParams('showType'),\n\t\t\tcvid: this.getCurrentCvId()\n\t\t}).done(function(events) {\n\t\t\tsubDatesElements.each(function(key, element) {\n\t\t\t\t$(this)\n\t\t\t\t\t.find('.js-count-events')\n\t\t\t\t\t.removeClass('hide')\n\t\t\t\t\t.html(events.result[key]);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Register events to EditView\n\t * @param {jQuery} sideBar\n\t */\n\tregisterEditForm(sideBar) {\n\t\tlet editViewInstance = Vtiger_Edit_Js.getInstanceByModuleName(sideBar.find('[name=\"module\"]').val()),\n\t\t\theaderInstance = new Vtiger_Header_Js(),\n\t\t\tparams = [];\n\t\tlet rightFormCreate = sideBar.find('form[name=\"QuickCreate\"]');\n\t\teditViewInstance.registerBasicEvents(rightFormCreate);\n\t\trightFormCreate.validationEngine(app.validationEngineOptions);\n\t\theaderInstance.registerHelpInfo(rightFormCreate);\n\t\tApp.Fields.Picklist.showSelect2ElementView(sideBar.find('select'));\n\t\tsideBar.find('.js-summary-close-edit').on('click', () => {\n\t\t\tthis.getCalendarCreateView();\n\t\t});\n\t\tparams.callbackFunction = this.registerAfterSubmitForm(this, rightFormCreate);\n\t\theaderInstance.registerQuickCreatePostLoadEvents(rightFormCreate, params);\n\t\tnew App.Fields.Text.Editor(sideBar.find('.js-editor'), { height: '5em', toolbar: 'Min' });\n\t}\n\n\t/**\n\t * EditView\n\t * @param {Object}|{number} params\n\t */\n\tgetCalendarSidebarData(params) {\n\t\tconst thisInstance = this,\n\t\t\taDeferred = $.Deferred();\n\t\tconst progressInstance = $.progressIndicator({ blockInfo: { enabled: true } });\n\t\tif ($.isNumeric(params)) {\n\t\t\tparams = {\n\t\t\t\tmodule: this.module,\n\t\t\t\tview: 'EventForm',\n\t\t\t\trecord: params\n\t\t\t};\n\t\t}\n\t\tAppConnector.request(params)\n\t\t\t.done(data => {\n\t\t\t\tthisInstance.openRightPanel();\n\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\tlet sidebar = thisInstance.getSidebarView();\n\t\t\t\tthis.updateSidebar(sidebar, data);\n\t\t\t\tif (sidebar.find('form').length) {\n\t\t\t\t\tthisInstance.registerEditForm(sidebar);\n\t\t\t\t} else {\n\t\t\t\t\tapp.showNewScrollbar(sidebar.find('.js-calendar__form__wrapper'), { suppressScrollX: true });\n\t\t\t\t\tsidebar.find('.js-activity-state .js-summary-close-edit').on('click', function() {\n\t\t\t\t\t\tthisInstance.getCalendarCreateView();\n\t\t\t\t\t});\n\t\t\t\t\tsidebar.find('.js-activity-state .editRecord').on('click', function() {\n\t\t\t\t\t\tthisInstance.getCalendarSidebarData($(this).data('id'));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\taDeferred.resolve(sidebar.find('.js-qc-form'));\n\t\t\t})\n\t\t\t.fail(error => {\n\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\tapp.errorLog(error);\n\t\t\t});\n\t\treturn aDeferred.promise();\n\t}\n\n\t/**\n\t * Update sidebar\n\t * @param {jQuery} sidebar\n\t * @param {html} data\n\t */\n\tupdateSidebar(sidebar, data) {\n\t\tsidebar.find('.js-qc-form').html(data);\n\t\tthis.showRightPanelForm();\n\t}\n\tloadCalendarData(view = this.getCalendarView().fullCalendar('getView')) {\n\t\tconst self = this;\n\t\tlet formatDate = CONFIG.dateFormat.toUpperCase(),\n\t\t\tcvid = self.getCurrentCvId(),\n\t\t\tcalendarInstance = this.getCalendarView();\n\t\tcalendarInstance.fullCalendar('removeEvents');\n\t\tlet progressInstance = $.progressIndicator({ blockInfo: { enabled: true } }),\n\t\t\tuser = self.getSelectedUsersCalendar();\n\t\tif (0 === user.length) {\n\t\t\tuser = app.getMainParams('usersId');\n\t\t}\n\t\tif (user === undefined) {\n\t\t\tuser = [app.getMainParams('userId')];\n\t\t}\n\t\tself.clearFilterButton(user, cvid);\n\t\tif (view.type === 'agendaDay') {\n\t\t\tself.selectDays(view.start, view.end);\n\t\t\tview.end = view.end.add(1, 'day');\n\t\t}\n\t\tlet options = {\n\t\t\tmodule: this.module,\n\t\t\taction: 'Calendar',\n\t\t\tmode: 'getEvents',\n\t\t\tstart: view.start.format(formatDate),\n\t\t\tend: view.end.format(formatDate),\n\t\t\tuser: user,\n\t\t\ttime: app.getMainParams('showType'),\n\t\t\tcvid: cvid,\n\t\t\thistoryUrl: `index.php?module=${this.module}&view=CalendarExtended&history=true&viewType=${\n\t\t\t\tview.type\n\t\t\t}&start=${view.start.format(formatDate)}&end=${view.end.format(\n\t\t\t\tformatDate\n\t\t\t)}&user=${user}&time=${app.getMainParams('showType')}&cvid=${cvid}&hiddenDays=${view.options.hiddenDays}`\n\t\t};\n\t\tlet connectorMethod = window['AppConnector']['request'];\n\t\tif (this.browserHistory && window.calendarLoaded) {\n\t\t\tconnectorMethod = window['AppConnector']['requestPjax'];\n\t\t}\n\t\tif (this.browserHistoryConfig && Object.keys(this.browserHistoryConfig).length && !window.calendarLoaded) {\n\t\t\toptions = Object.assign(options, {\n\t\t\t\tstart: this.browserHistoryConfig.start,\n\t\t\t\tend: this.browserHistoryConfig.end,\n\t\t\t\tuser: this.browserHistoryConfig.user,\n\t\t\t\ttime: this.browserHistoryConfig.time,\n\t\t\t\tcvid: this.browserHistoryConfig.cvid\n\t\t\t});\n\t\t\tconnectorMethod = window['AppConnector']['request'];\n\t\t\tapp.setMainParams('showType', this.browserHistoryConfig.time);\n\t\t\tapp.setMainParams('usersId', this.browserHistoryConfig.user);\n\t\t}\n\t\tconnectorMethod(options).done(events => {\n\t\t\tcalendarInstance.fullCalendar('removeEvents');\n\t\t\tcalendarInstance.fullCalendar('addEventSource', events.result);\n\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t});\n\t\tself.registerViewRenderEvents(view);\n\t\twindow.calendarLoaded = true;\n\t}\n\n\tclearFilterButton(user, cvid) {\n\t\tlet currentUser = parseInt(app.getMainParams('userId')),\n\t\t\ttime = app.getMainParams('showType'),\n\t\t\tstatement =\n\t\t\t\t(user.length === 0 || (user.length === 1 && parseInt(user) === currentUser)) &&\n\t\t\t\tcvid === undefined &&\n\t\t\t\ttime === 'current';\n\t\t$('.js-calendar__clear-filters').toggleClass('d-none', statement);\n\t}\n\n\tregisterClearFilterButton() {\n\t\tconst sidebar = this.getSidebarView(),\n\t\t\tcalendarView = this.getCalendarView();\n\t\tlet clearBtn = calendarView.find('.js-calendar__clear-filters');\n\t\tapp.showPopoverElementView(clearBtn);\n\t\tclearBtn.on('click', () => {\n\t\t\t$('.js-calendar__extended-filter-tab a').removeClass('active');\n\t\t\tapp.setMainParams('showType', 'current');\n\t\t\tapp.moduleCacheSet('defaultShowType', 'current');\n\t\t\tsidebar.find('input:checkbox').prop('checked', false);\n\t\t\tsidebar.find('option:selected').prop('selected', false);\n\t\t\tlet calendarSwitch = sidebar.find('.js-switch--showType [class*=\"js-switch--label\"]'),\n\t\t\t\tactualUserCheckbox = sidebar.find('.js-input-user-owner-id[value=' + app.getMainParams('userId') + ']');\n\t\t\tcalendarSwitch.last().removeClass('active');\n\t\t\tcalendarSwitch.first().addClass('active');\n\t\t\tif (actualUserCheckbox.length) {\n\t\t\t\tactualUserCheckbox.prop('checked', true);\n\t\t\t} else {\n\t\t\t\tapp.setMainParams('usersId', undefined);\n\t\t\t}\n\t\t\tcalendarView.fullCalendar('getCalendar').view.options.loadView();\n\t\t});\n\t}\n\n\tgenerateYearList(dateStart, dateEnd) {\n\t\tconst datesView = this.container.find('.js-dates-row');\n\t\tlet prevYear = moment(dateStart).subtract(1, 'year'),\n\t\t\tactualYear = moment(dateStart),\n\t\t\tnextYear = moment(dateStart).add(1, 'year'),\n\t\t\thtml = '',\n\t\t\tactive = '';\n\t\twhile (prevYear <= nextYear) {\n\t\t\tif (prevYear.format('YYYY') === actualYear.format('YYYY')) {\n\t\t\t\tactive = 'active';\n\t\t\t} else {\n\t\t\t\tactive = '';\n\t\t\t}\n\t\t\thtml += `<div class=\"js-sub-record sub-record col-4 nav-item\" data-date=\"${prevYear.format(\n\t\t\t\t'YYYY'\n\t\t\t)}\" data-type=\"years\" data-js=\"click | class: active\">\n\t\t\t\t\t<div class=\"sub-record-content nav-link ${active}\">\n\t\t\t\t\t\t<div class=\"sub-date-name\">\n\t\t\t\t\t\t\t${prevYear.format('YYYY')}\n\t\t\t\t\t\t\t<div class=\"js-count-events count badge c-badge--md ml-1\" data-js=\"html\">0</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;\n\t\t\tprevYear = moment(prevYear).add(1, 'year');\n\t\t}\n\t\tdatesView.find('.js-sub-date-list').html(html);\n\t}\n\n\tgenerateSubMonthList(dateStart, dateEnd) {\n\t\tlet datesView = this.container.find('.js-dates-row'),\n\t\t\tactiveMonth =\n\t\t\t\tparseInt(\n\t\t\t\t\tmoment(dateStart)\n\t\t\t\t\t\t.locale('en')\n\t\t\t\t\t\t.format('M')\n\t\t\t\t) - 1,\n\t\t\thtml = '',\n\t\t\tactive = '';\n\t\tfor (let month = 0; 12 > month; ++month) {\n\t\t\tif (month === activeMonth) {\n\t\t\t\tactive = 'active';\n\t\t\t} else {\n\t\t\t\tactive = '';\n\t\t\t}\n\t\t\thtml += `<div class=\"js-sub-record sub-record nav-item col-1 px-0\" data-type=\"months\" data-date=\"${moment(\n\t\t\t\tdateStart\n\t\t\t)\n\t\t\t\t.month(month)\n\t\t\t\t.format('YYYY-MM')}\" data-js=\"click | class: active\">\n\t\t\t\t\t<div class=\"sub-record-content nav-link ${active}\">\n\t\t\t\t\t\t<div class=\"sub-date-name\">${app\n\t\t\t\t\t\t\t.vtranslate(\n\t\t\t\t\t\t\t\t'JS_' +\n\t\t\t\t\t\t\t\t\tmoment()\n\t\t\t\t\t\t\t\t\t\t.month(month)\n\t\t\t\t\t\t\t\t\t\t.format('MMM')\n\t\t\t\t\t\t\t\t\t\t.toUpperCase()\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.toUpperCase()}\n\t\t\t\t\t\t\t<div class=\"js-count-events count badge c-badge--md ml-1\" data-js=\"html\">0</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;\n\t\t}\n\t\tdatesView.find('.js-sub-date-list').html(html);\n\t}\n\n\tgenerateSubWeekList(dateStart, dateEnd) {\n\t\tlet datesView = this.container.find('.js-dates-row'),\n\t\t\tprevWeeks = moment(dateStart).subtract(5, 'weeks'),\n\t\t\tactualWeek = moment(dateStart).format('WW'),\n\t\t\tnextWeeks = moment(dateStart).add(6, 'weeks'),\n\t\t\thtml = '';\n\t\twhile (prevWeeks <= nextWeeks) {\n\t\t\tlet active = '';\n\t\t\tif (prevWeeks.format('WW') === actualWeek) {\n\t\t\t\tactive = ' active';\n\t\t\t}\n\t\t\thtml +=\n\t\t\t\t'<div class=\"js-sub-record sub-record nav-item col-1 px-0\" data-type=\"weeks\" data-date=\"' +\n\t\t\t\tprevWeeks.format('YYYY-MM-DD') +\n\t\t\t\t'\" data-js=\"click | class: active\">' +\n\t\t\t\t'<div class=\"sub-record-content nav-link' +\n\t\t\t\tactive +\n\t\t\t\t'\">' +\n\t\t\t\t'<div class=\"sub-date-name\">' +\n\t\t\t\tapp.vtranslate('JS_WEEK_SHORT') +\n\t\t\t\t' ' +\n\t\t\t\tprevWeeks.format('WW') +\n\t\t\t\t'<div class=\"js-count-events count badge c-badge--md ml-1\" data-js=\"html\">0</div>' +\n\t\t\t\t'</div>' +\n\t\t\t\t'</div>' +\n\t\t\t\t'</div>';\n\t\t\tprevWeeks = moment(prevWeeks).add(1, 'weeks');\n\t\t}\n\t\tdatesView.find('.js-sub-date-list').html(html);\n\t}\n\n\tgenerateSubDaysList(dateStart, dateEnd) {\n\t\tlet datesView = this.container.find('.js-dates-row'),\n\t\t\tprevDays = moment(dateStart).subtract(5, 'days'),\n\t\t\tactualDay = moment(dateStart).format('DDD'),\n\t\t\tnextDays = moment(dateStart).add(7, 'days'),\n\t\t\tdaysToShow = nextDays.diff(prevDays, 'days'),\n\t\t\thtml = '';\n\t\tfor (let day = 0; day < daysToShow; ++day) {\n\t\t\tlet active = '';\n\t\t\tif (\n\t\t\t\tapp.getMainParams('switchingDays') === 'workDays' &&\n\t\t\t\tapp.moduleCacheGet('defaultSwitchingDays') !== 'all'\n\t\t\t) {\n\t\t\t\tif ($.inArray(prevDays.day(), app.getMainParams('hiddenDays', true)) !== -1) {\n\t\t\t\t\tprevDays = moment(prevDays).add(1, 'days');\n\t\t\t\t\tdaysToShow++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (prevDays.format('DDD') === actualDay) {\n\t\t\t\tactive = ' active';\n\t\t\t}\n\t\t\thtml +=\n\t\t\t\t'<div class=\"js-sub-record sub-record nav-item col-1 px-0\" data-type=\"days\" data-date=\"' +\n\t\t\t\tprevDays.format('YYYY-MM-DD') +\n\t\t\t\t'\" data-js=\"click | class: active\">' +\n\t\t\t\t'<div class=\"sub-record-content nav-link' +\n\t\t\t\tactive +\n\t\t\t\t'\">' +\n\t\t\t\t'<div class=\"sub-date-name\">' +\n\t\t\t\tapp.vtranslate('JS_DAY_SHORT') +\n\t\t\t\t' ' +\n\t\t\t\tprevDays.format('DD') +\n\t\t\t\t'<div class=\"js-count-events count badge c-badge--md ml-1\" data-js=\"html\">0</div>' +\n\t\t\t\t'</div>' +\n\t\t\t\t'</div>' +\n\t\t\t\t'</div>';\n\t\t\tprevDays = moment(prevDays).add(1, 'days');\n\t\t}\n\t\tdatesView.find('.js-sub-date-list').html(html);\n\t}\n\n\tselectDays(startDate, endDate) {\n\t\tthis.container.find('.js-right-panel-event-link').tab('show');\n\t\tlet start_hour = app.getMainParams('startHour'),\n\t\t\tend_hour = app.getMainParams('endHour'),\n\t\t\tview = this.getCalendarView().fullCalendar('getView');\n\t\tif (endDate.hasTime() == false) {\n\t\t\tendDate.add(-1, 'days');\n\t\t}\n\t\tstartDate = startDate.format();\n\t\tendDate = endDate.format();\n\t\tif (start_hour == '') {\n\t\t\tstart_hour = '00';\n\t\t}\n\t\tif (end_hour == '') {\n\t\t\tend_hour = '00';\n\t\t}\n\t\tthis.getCalendarCreateView().done(function(data) {\n\t\t\tif (data.length <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (view.name != 'agendaDay' && view.name != 'agendaWeek') {\n\t\t\t\tstartDate = startDate + 'T' + start_hour + ':00';\n\t\t\t\tendDate = endDate + 'T' + end_hour + ':00';\n\t\t\t\tif (startDate == endDate) {\n\t\t\t\t\tlet activityType = data.find('[name=\"activitytype\"]').val();\n\t\t\t\t\tlet activityDurations = JSON.parse(data.find('[name=\"defaultOtherEventDuration\"]').val());\n\t\t\t\t\tlet minutes = 0;\n\t\t\t\t\tfor (let i in activityDurations) {\n\t\t\t\t\t\tif (activityDurations[i].activitytype === activityType) {\n\t\t\t\t\t\t\tminutes = parseInt(activityDurations[i].duration);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tendDate = moment(endDate)\n\t\t\t\t\t\t.add(minutes, 'minutes')\n\t\t\t\t\t\t.toISOString();\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet dateFormat = data\n\t\t\t\t\t.find('[name=\"date_start\"]')\n\t\t\t\t\t.data('dateFormat')\n\t\t\t\t\t.toUpperCase(),\n\t\t\t\ttimeFormat = data.find('[name=\"time_start\"]').data('format'),\n\t\t\t\tdefaultTimeFormat = '';\n\t\t\tif (timeFormat == 24) {\n\t\t\t\tdefaultTimeFormat = 'HH:mm';\n\t\t\t} else {\n\t\t\t\tdefaultTimeFormat = 'hh:mm A';\n\t\t\t}\n\t\t\tdata.find('[name=\"date_start\"]').val(moment(startDate).format(dateFormat));\n\t\t\tdata.find('[name=\"due_date\"]').val(moment(endDate).format(dateFormat));\n\t\t\tif (data.find('.js-autofill').prop('checked') === true) {\n\t\t\t\tCalendar_Edit_Js.getInstance().getFreeTime(data);\n\t\t\t} else {\n\t\t\t\tdata.find('[name=\"time_start\"]').val(moment(startDate).format(defaultTimeFormat));\n\t\t\t\tdata.find('[name=\"time_end\"]').val(moment(endDate).format(defaultTimeFormat));\n\t\t\t}\n\t\t});\n\t}\n\n\tregisterUsersChange(formContainer) {\n\t\tformContainer.find('.js-input-user-owner-id-ajax, .js-input-user-owner-id').on('change', () => {\n\t\t\tthis.getCalendarView()\n\t\t\t\t.fullCalendar('getCalendar')\n\t\t\t\t.view.options.loadView();\n\t\t});\n\t\tthis.registerPinUser();\n\t}\n\n\t/**\n\t * Register actions to do after save record\n\t * @param instance\n\t * @param data\n\t * @returns {function}\n\t */\n\tregisterAfterSubmitForm(self, data) {\n\t\tconst calendarView = this.getCalendarView();\n\t\tlet returnFunction = function(data) {\n\t\t\tif (data.success) {\n\t\t\t\tlet recordActivityStatus = data.result.activitystatus.value,\n\t\t\t\t\thistoryStatus = app.getMainParams('activityStateLabels', true).history,\n\t\t\t\t\tinHistoryStatus = $.inArray(recordActivityStatus, historyStatus),\n\t\t\t\t\tshowType = app.getMainParams('showType');\n\t\t\t\tif (\n\t\t\t\t\t(-1 !== inHistoryStatus && 'history' === showType) ||\n\t\t\t\t\t(-1 === inHistoryStatus && 'history' !== showType)\n\t\t\t\t) {\n\t\t\t\t\tif (calendarView.fullCalendar('clientEvents', data.result._recordId)[0]) {\n\t\t\t\t\t\tself.updateCalendarEvent(data.result._recordId, data.result);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst calendarInstance = calendarView.fullCalendar('getCalendar');\n\t\t\t\t\t\tif (calendarInstance.view.type !== 'year') {\n\t\t\t\t\t\t\tcalendarInstance.view.options.addCalendarEvent(data.result);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcalendarInstance.view.render();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.result.followup.value !== undefined) {\n\t\t\t\t\t\t\tcalendarView.fullCalendar('removeEvents', data.result.followup.value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tself.refreshDatesRowView(calendarView.fullCalendar('getView'));\n\t\t\t\tself.getSidebarView()\n\t\t\t\t\t.find('.js-qc-form')\n\t\t\t\t\t.html('');\n\t\t\t\tself.getCalendarCreateView();\n\t\t\t\twindow.popoverCache = {};\n\t\t\t}\n\t\t};\n\t\treturn returnFunction;\n\t}\n\n\topenRightPanel() {\n\t\tlet calendarRightPanel = $('.js-calendar-right-panel');\n\t\tif (calendarRightPanel.hasClass('hideSiteBar')) {\n\t\t\tcalendarRightPanel.find('.js-toggle-site-bar-right-button').trigger('click');\n\t\t}\n\t}\n\n\tshowRightPanelForm() {\n\t\tlet calendarRightPanel = $('.js-calendar-right-panel');\n\t\tif (!calendarRightPanel.find('.js-right-panel-event').hasClass('active')) {\n\t\t\tcalendarRightPanel.find('.js-right-panel-event-link').trigger('click');\n\t\t}\n\t\tapp.showNewScrollbar(calendarRightPanel.find('.js-calendar__form__wrapper'), {\n\t\t\tsuppressScrollX: true\n\t\t});\n\t}\n\n\tregisterSiteBarEvents() {\n\t\tlet calendarRightPanel = $('.js-calendar-right-panel');\n\t\tcalendarRightPanel.find('.js-show-sitebar').on('click', () => {\n\t\t\tif (calendarRightPanel.hasClass('hideSiteBar')) {\n\t\t\t\tcalendarRightPanel.find('.js-toggle-site-bar-right-button').trigger('click');\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Parse calendar data\n\t * @param {Object} calendarDetails\n\t * @returns {{id: *, title: *, start: *, end: *, module: string, url: string, className: string[], start_display: *, end_display: *}}\n\t */\n\tgetEventData(calendarDetails) {\n\t\tlet calendar = this.getCalendarView(),\n\t\t\tstartDate = calendar.fullCalendar(\n\t\t\t\t'moment',\n\t\t\t\tcalendarDetails.date_start.value + ' ' + calendarDetails.time_start.value\n\t\t\t),\n\t\t\tendDate = calendar.fullCalendar(\n\t\t\t\t'moment',\n\t\t\t\tcalendarDetails.due_date.value + ' ' + calendarDetails.time_end.value\n\t\t\t),\n\t\t\teventObject = {\n\t\t\t\tid: calendarDetails._recordId,\n\t\t\t\ttitle: calendarDetails.subject.display_value,\n\t\t\t\tstart: startDate.format(),\n\t\t\t\tend: endDate.format(),\n\t\t\t\tmodule: this.module,\n\t\t\t\turl: `index.php?module=${this.module}&view=ActivityState&record=${calendarDetails._recordId}`,\n\t\t\t\tclassName: [\n\t\t\t\t\t'ownerCBg_' + calendarDetails.assigned_user_id.value,\n\t\t\t\t\t' picklistCBr_Calendar_activitytype_' + calendarDetails.activitytype.value,\n\t\t\t\t\t'js-popover-tooltip--record'\n\t\t\t\t],\n\t\t\t\tstart_display: calendarDetails.date_start.display_value,\n\t\t\t\tend_display: calendarDetails.due_date.display_value\n\t\t\t};\n\t\tif (calendarDetails.isEditable && app.getMainParams('showEditForm')) {\n\t\t\teventObject.url = `index.php?module=${this.module}&view=EventForm&record=${eventObject.id}`;\n\t\t}\n\t\treturn eventObject;\n\t}\n\n\t/**\n\t * Update Event\n\t * @param {Number} calendarEventId\n\t * @param {Object} calendarDetails\n\t */\n\tupdateCalendarEvent(calendarEventId, calendarDetails) {\n\t\tconst calendar = this.getCalendarView();\n\t\tlet recordToUpdate = calendar.fullCalendar('clientEvents', calendarEventId)[0];\n\t\t$.extend(recordToUpdate, this.getEventData(calendarDetails));\n\t\tcalendar.fullCalendar('updateEvent', recordToUpdate);\n\t}\n\n\tgetCalendarCreateView() {\n\t\tlet aDeferred = $.Deferred();\n\t\tif (this.eventCreate) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet sideBar = thisInstance.getSidebarView(),\n\t\t\t\tqcForm = sideBar.find('.js-qc-form');\n\t\t\tif (qcForm.find('form').length > 0 && qcForm.find('input[name=record]').length === 0) {\n\t\t\t\taDeferred.resolve(qcForm);\n\t\t\t} else {\n\t\t\t\tlet progressInstance = $.progressIndicator({ blockInfo: { enabled: true } });\n\t\t\t\tthis.getCalendarSidebarData({ module: this.module, view: 'EventForm' })\n\t\t\t\t\t.done(() => {\n\t\t\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\tthisInstance.registerAutofillTime();\n\t\t\t\t\t\taDeferred.resolve(qcForm);\n\t\t\t\t\t})\n\t\t\t\t\t.fail(error => {\n\t\t\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\tapp.errorLog(error);\n\t\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\taDeferred.reject();\n\t\t}\n\t\treturn aDeferred.promise();\n\t}\n\n\t/**\n\t * Autoselect date in create view in extended calendar\n\t */\n\tregisterAutofillTime() {\n\t\tif (app.getMainParams('autofillTime')) {\n\t\t\tthis.container\n\t\t\t\t.find('.js-autofill')\n\t\t\t\t.prop('checked', 'checked')\n\t\t\t\t.trigger('change');\n\t\t}\n\t}\n\n\tregisterPinUser() {\n\t\t$('.js-pin-user')\n\t\t\t.off('click')\n\t\t\t.on('click', function() {\n\t\t\t\tconst thisInstance = $(this);\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: this.module,\n\t\t\t\t\taction: 'Calendar',\n\t\t\t\t\tmode: 'pinOrUnpinUser',\n\t\t\t\t\telement_id: thisInstance.data('elementid')\n\t\t\t\t}).done(data => {\n\t\t\t\t\tlet response = data.result;\n\t\t\t\t\tif (response === 'unpin') {\n\t\t\t\t\t\tthisInstance\n\t\t\t\t\t\t\t.find('.js-pin-icon')\n\t\t\t\t\t\t\t.removeClass('fas')\n\t\t\t\t\t\t\t.addClass('far');\n\t\t\t\t\t} else if (response === 'pin') {\n\t\t\t\t\t\tthisInstance\n\t\t\t\t\t\t\t.find('.js-pin-icon')\n\t\t\t\t\t\t\t.removeClass('far')\n\t\t\t\t\t\t\t.addClass('fas');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify(app.vtranslate('JS_ERROR'));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tregisterAddForm() {\n\t\tconst thisInstance = this;\n\t\tlet sideBar = thisInstance.getSidebarView();\n\t\tthisInstance.getCalendarCreateView();\n\t\tlet user = app.getMainParams('usersId');\n\t\tif (user === undefined) {\n\t\t\tuser = [app.getMainParams('userId')];\n\t\t}\n\t\tAppConnector.request(\n\t\t\t`index.php?module=${this.module}&view=RightPanelExtended&mode=getUsersList&user=${user}`\n\t\t).done(function(data) {\n\t\t\tif (data) {\n\t\t\t\tlet formContainer = sideBar.find('.js-users-form');\n\t\t\t\tformContainer.html(data);\n\t\t\t\tthisInstance.registerUsersChange(formContainer);\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(formContainer.find('select'));\n\t\t\t\tapp.showNewScrollbar(formContainer, {\n\t\t\t\t\tsuppressScrollX: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tAppConnector.request(\n\t\t\t`index.php?module=${this.module}&view=RightPanelExtended&mode=getGroupsList&user=${user}`\n\t\t).done(function(data) {\n\t\t\tif (data) {\n\t\t\t\tlet formContainer = sideBar.find('.js-group-form');\n\t\t\t\tformContainer.html(data);\n\t\t\t\tthisInstance.registerUsersChange(formContainer);\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(formContainer.find('select'));\n\t\t\t\tformContainer.addClass('u-min-h-30per');\n\t\t\t\tapp.showNewScrollbar(formContainer, {\n\t\t\t\t\tsuppressScrollX: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Find element on list (user, group)\n\t * @param {jQuery.Event} e\n\t */\n\tfindElementOnList(e) {\n\t\tlet target = $(e.target),\n\t\t\tvalue = target.val().toLowerCase(),\n\t\t\tcontainer = target.closest('.js-filter__container');\n\t\tcontainer.find('.js-filter__item__value').filter(function() {\n\t\t\tlet item = $(this).closest('.js-filter__item__container');\n\t\t\tif (\n\t\t\t\t$(this)\n\t\t\t\t\t.text()\n\t\t\t\t\t.trim()\n\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t.indexOf(value) > -1\n\t\t\t) {\n\t\t\t\titem.removeClass('d-none');\n\t\t\t} else {\n\t\t\t\titem.addClass('d-none');\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Register filter for users and groups\n\t */\n\tregisterFilterForm() {\n\t\tconst self = this;\n\t\tthis.getSidebarView()\n\t\t\t.find('a[data-toggle=\"tab\"]')\n\t\t\t.one('shown.bs.tab', function(e) {\n\t\t\t\t$('.js-filter__search').on('keyup', self.findElementOnList.bind(self));\n\t\t\t});\n\t}\n\n\t/**\n\t * Register popover buttons' click\n\t */\n\tregisterPopoverButtonsClickEvent() {\n\t\t$(document).on('click', '.js-calendar-popover__button', this.showCalendarPopoverLinkInSidebar.bind(this));\n\t}\n\n\t/**\n\t * Show popover link in sidebar\n\t *\n\t * @param   {Object}  e  click event\n\t */\n\tshowCalendarPopoverLinkInSidebar(e) {\n\t\tlet href = e.currentTarget.href;\n\t\tconst hrefObject = app.convertUrlToObject(href);\n\t\tif (hrefObject.module !== 'Calendar' || (hrefObject.view !== 'Edit' && hrefObject.view !== 'Detail')) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\te.preventDefault();\n\t\t\tconst sidebarView = hrefObject.view === 'Edit' ? 'EventForm' : 'ActivityState';\n\t\t\thref = href.replace(hrefObject.view, sidebarView);\n\t\t\tthis.getCalendarSidebarData(href);\n\t\t}\n\t}\n\n\t/**\n\t * Register events\n\t */\n\tregisterEvents() {\n\t\tsuper.registerEvents();\n\t\tthis.registerAddForm();\n\t\tthis.registerSiteBarEvents();\n\t\tthis.registerFilterForm();\n\t\tthis.registerPopoverButtonsClickEvent();\n\t\tElementQueries.listen();\n\t}\n};\n"],"names":["window","calendarLoaded","Calendar_CalendarExtended_Js","container","readonly","sidebarView","calendarContainer","addCommonMethodsToYearView","calendar","_this","getCalendarView","views","year","FC","extend","this","selectDays","getCalendarCreateView","getSidebarView","getCurrentCvId","showRightPanelForm","getSelectedUsersCalendar","registerClearFilterButton","clearFilterButton","registerFilterTabChange","registerAfterSubmitForm","registerViewRenderEvents","appendSubDateRow","refreshDatesRowView","generateYearList","updateCountTaskCalendar","registerDatesChange","addHeaderButtons","browserHistoryConfig","module","showChangeDateButtons","showTodayButtonCheckbox","self","basicOptions","setCalendarOptions","options","app","getMainParams","vtranslate","start","end","fullCalendar","view","render","parseDateFormat","loadCalendarData","event","element","eventRenderer","type","calendarDetails","getEventData","Object","assign","eventEdit","eventClick","calEvent","jsEvent","preventDefault","getCalendarSidebarData","$","attr","link","URL","href","location","searchParams","get","find","length","buttonsContainer","prev","viewBtn","clone","filters","prepend","after","calendarView","isWorkDays","switchContainer","switchShowType","switchSwitchingDays","historyParams","moduleCacheGet","button","setMainParams","time","hiddenDays","on","currentTarget","e","data","moduleCacheSet","loadView","filter","change","_this2","setCalendarHeight","toolbar","subDateRow","append","width","breakpoints","lg","showNewScrollbar","todayButton","todyButtonIcon","hasClass","popoverContent","text","toLowerCase","removeClass","html","showPopoverElementView","viewType","replace","nextPrevButtons","yearButtons","first","buttonText","last","hide","show","intervalStart","intervalEnd","generateSubMonthList","generateSubWeekList","generateSubDaysList","addClass","moment","parent","thisInstance","sidebar","selectedUsers","selectedUsersAjax","selectedRolesAjax","users","each","push","val","concat","subDatesElements","dateArray","userDateFormat","CONFIG","dateFormat","toUpperCase","user","undefined","key","format","endOf","add","request","done","events","result","sideBar","editViewInstance","Vtiger_Edit_Js","getInstanceByModuleName","headerInstance","Vtiger_Header_Js","params","rightFormCreate","registerBasicEvents","validationEngine","validationEngineOptions","registerHelpInfo","Fields","Picklist","showSelect2ElementView","callbackFunction","registerQuickCreatePostLoadEvents","App","Text","Editor","height","aDeferred","Deferred","progressInstance","progressIndicator","blockInfo","enabled","isNumeric","openRightPanel","mode","updateSidebar","registerEditForm","suppressScrollX","resolve","fail","errorLog","error","promise","formatDate","cvid","calendarInstance","connectorMethod","browserHistory","keys","currentUser","parseInt","statement","toggleClass","clearBtn","prop","calendarSwitch","actualUserCheckbox","dateStart","dateEnd","datesView","prevYear","subtract","actualYear","nextYear","active","activeMonth","locale","month","prevWeeks","actualWeek","nextWeeks","prevDays","actualDay","daysToShow","diff","day","inArray","startDate","endDate","tab","start_hour","end_hour","hasTime","name","activityType","activityDurations","JSON","parse","minutes","i","activitytype","duration","toISOString","defaultTimeFormat","getInstance","getFreeTime","formContainer","registerPinUser","success","recordActivityStatus","activitystatus","value","historyStatus","history","inHistoryStatus","showType","_recordId","updateCalendarEvent","addCalendarEvent","followup","popoverCache","calendarRightPanel","trigger","date_start","time_start","due_date","time_end","eventObject","subject","display_value","assigned_user_id","isEditable","url","id","calendarEventId","recordToUpdate","eventCreate","qcForm","registerAutofillTime","reject","off","response","showPnotify","registerUsersChange","target","closest","item","trim","indexOf","one","findElementOnList","bind","document","showCalendarPopoverLinkInSidebar","hrefObject","convertUrlToObject","registerAddForm","registerSiteBarEvents","registerFilterForm","registerPopoverButtonsClickEvent","listen","Calendar_Calendar_Js"],"mappings":"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"}