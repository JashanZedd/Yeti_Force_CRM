{"version":3,"file":"CalendarView.min.js","sources":["CalendarView.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n/**\n *  Class representing an extended calendar.\n * @extends Calendar_Calendar_Js\n */\nwindow.calendarLoaded = false; //Global calendar flag needed for correct loading data from history browser in year view\nwindow.Calendar_CalendarExtended_Js = class extends Calendar_Calendar_Js {\n\tconstructor(container, readonly) {\n\t\tsuper(container, readonly);\n\t\tthis.sidebarView = {\n\t\t\tlength: 0\n\t\t};\n\t\tthis.calendarContainer = false;\n\t\tthis.addCommonMethodsToYearView();\n\t\tthis.calendar = this.getCalendarView();\n\t}\n\n\t/**\n\t * Function extends FC.views.year with current class methods\n\t */\n\taddCommonMethodsToYearView() {\n\t\tconst self = this;\n\t\tFC.views.year = FC.views.year.extend({\n\t\t\tselectDays: self.selectDays,\n\t\t\tgetCalendarCreateView: self.getCalendarCreateView,\n\t\t\tgetSidebarView: self.getSidebarView,\n\t\t\tgetCurrentCvId: self.getCurrentCvId,\n\t\t\tgetCalendarView: self.getCalendarView,\n\t\t\tshowRightPanelForm: self.showRightPanelForm,\n\t\t\tgetSelectedUsersCalendar: self.getSelectedUsersCalendar,\n\t\t\tregisterClearFilterButton: self.registerClearFilterButton,\n\t\t\tclearFilterButton: self.clearFilterButton,\n\t\t\tregisterFilterTabChange: self.registerFilterTabChange,\n\t\t\tsidebarView: self.sidebarView,\n\t\t\tregisterAfterSubmitForm: self.registerAfterSubmitForm,\n\t\t\tregisterViewRenderEvents: self.registerViewRenderEvents,\n\t\t\tappendSubDateRow: self.appendSubDateRow,\n\t\t\trefreshDatesRowView: self.refreshDatesRowView,\n\t\t\tgenerateYearList: self.generateYearList,\n\t\t\tupdateCountTaskCalendar: self.updateCountTaskCalendar,\n\t\t\tregisterDatesChange: self.registerDatesChange,\n\t\t\taddHeaderButtons: self.addHeaderButtons,\n\t\t\tbrowserHistoryConfig: self.browserHistoryConfig,\n\t\t\treadonly: self.readonly,\n\t\t\tcontainer: self.container,\n\t\t\tmodule: self.module,\n\t\t\tshowChangeDateButtons: self.showChangeDateButtons,\n\t\t\tshowTodayButtonCheckbox: self.showTodayButtonCheckbox\n\t\t});\n\t}\n\n\t/**\n\t * Render calendar\n\t */\n\trenderCalendar() {\n\t\tlet self = this,\n\t\t\tbasicOptions = this.setCalendarOptions(),\n\t\t\toptions = {\n\t\t\t\theader: {\n\t\t\t\t\tleft: 'year,month,' + app.getMainParams('weekView') + ',' + app.getMainParams('dayView'),\n\t\t\t\t\tcenter: 'prevYear,prev,title,next,nextYear',\n\t\t\t\t\tright: 'today'\n\t\t\t\t},\n\t\t\t\tviews: {\n\t\t\t\t\tbasic: {\n\t\t\t\t\t\teventLimit: false\n\t\t\t\t\t},\n\t\t\t\t\tyear: {\n\t\t\t\t\t\teventLimit: 10,\n\t\t\t\t\t\teventLimitText: app.vtranslate('JS_COUNT_RECORDS'),\n\t\t\t\t\t\ttitleFormat: 'YYYY',\n\t\t\t\t\t\tselect: function(start, end) {},\n\t\t\t\t\t\tloadView: function() {\n\t\t\t\t\t\t\tself.getCalendarView()\n\t\t\t\t\t\t\t\t.fullCalendar('getCalendar')\n\t\t\t\t\t\t\t\t.view.render();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tmonth: {\n\t\t\t\t\t\ttitleFormat: this.parseDateFormat('month'),\n\t\t\t\t\t\tloadView: function() {\n\t\t\t\t\t\t\tself.loadCalendarData();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tweek: {\n\t\t\t\t\t\ttitleFormat: this.parseDateFormat('week'),\n\t\t\t\t\t\tloadView: function() {\n\t\t\t\t\t\t\tself.loadCalendarData();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tday: {\n\t\t\t\t\t\ttitleFormat: this.parseDateFormat('day'),\n\t\t\t\t\t\tloadView: function() {\n\t\t\t\t\t\t\tself.loadCalendarData();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tbasicDay: {\n\t\t\t\t\t\ttype: 'agendaDay',\n\t\t\t\t\t\tloadView: function() {\n\t\t\t\t\t\t\tself.loadCalendarData();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tselect: function(start, end) {\n\t\t\t\t\tself.selectDays(start, end);\n\t\t\t\t\tself.getCalendarView().fullCalendar('unselect');\n\t\t\t\t},\n\t\t\t\teventRender: function(event, element) {\n\t\t\t\t\tself.eventRenderer(event, element);\n\t\t\t\t},\n\t\t\t\tviewRender: function(view, element) {\n\t\t\t\t\tif (view.type !== 'year') {\n\t\t\t\t\t\tself.loadCalendarData(view);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\taddCalendarEvent(calendarDetails) {\n\t\t\t\t\tself.getCalendarView().fullCalendar('renderEvent', self.getEventData(calendarDetails));\n\t\t\t\t}\n\t\t\t};\n\t\toptions = Object.assign(basicOptions, options);\n\t\tif (!this.readonly && self.eventEdit) {\n\t\t\toptions.eventClick = function(calEvent, jsEvent) {\n\t\t\t\tjsEvent.preventDefault();\n\t\t\t\tself.getCalendarSidebarData($(this).attr('href'));\n\t\t\t};\n\t\t} else {\n\t\t\toptions.eventClick = function(calEvent, jsEvent) {\n\t\t\t\tjsEvent.preventDefault();\n\t\t\t\tconst link = new URL($(this)[0].href);\n\t\t\t\twindow.location.assign(\n\t\t\t\t\t`index.php?module=${this.module}&view=Detail&record=${link.searchParams.get('record')}`\n\t\t\t\t);\n\t\t\t};\n\t\t}\n\t\tthis.calendar.fullCalendar(options);\n\t}\n\n\tregisterChangeView() {}\n\n\taddHeaderButtons() {\n\t\tif (this.calendarContainer.find('.js-calendar__view-btn').length) {\n\t\t\treturn;\n\t\t}\n\t\tlet buttonsContainer = this.calendarContainer.prev('.js-calendar__header-buttons'),\n\t\t\tviewBtn = buttonsContainer.find('.js-calendar__view-btn').clone(),\n\t\t\tfilters = buttonsContainer.find('.js-calendar__filter-container').clone();\n\t\tthis.calendarContainer.find('.fc-left').prepend(viewBtn);\n\t\tthis.calendarContainer.find('.fc-center').after(filters);\n\t\tthis.registerClearFilterButton();\n\t\tthis.registerFilterTabChange();\n\t}\n\n\tregisterSwitchEvents() {\n\t\tconst calendarView = this.getCalendarView();\n\t\tlet isWorkDays,\n\t\t\tswitchShowTypeVal,\n\t\t\tswitchContainer = $('.js-calendar__tab--filters'),\n\t\t\tswitchShowType = switchContainer.find('.js-switch--showType'),\n\t\t\tswitchSwitchingDays = switchContainer.find('.js-switch--switchingDays');\n\t\tlet historyParams = app.getMainParams('historyParams', true);\n\t\tif (historyParams === '') {\n\t\t\t(isWorkDays =\n\t\t\t\tapp.getMainParams('switchingDays') === 'workDays' &&\n\t\t\t\tapp.moduleCacheGet('defaultSwitchingDays') !== 'all'),\n\t\t\t\t(switchShowTypeVal =\n\t\t\t\t\tapp.getMainParams('showType') === 'current' && app.moduleCacheGet('defaultShowType') !== 'history');\n\t\t\tif (!switchShowTypeVal) {\n\t\t\t\tswitchShowType.find('.js-switch--label-off').button('toggle');\n\t\t\t}\n\t\t} else {\n\t\t\tapp.setMainParams('showType', historyParams.time);\n\t\t\tapp.setMainParams('switchingDays', historyParams.hiddenDays === '' ? 'all' : 'workDays');\n\t\t}\n\t\tswitchShowType.on('change', 'input', e => {\n\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\tif (typeof currentTarget.data('on-text') !== 'undefined') {\n\t\t\t\tapp.setMainParams('showType', 'current');\n\t\t\t\tapp.moduleCacheSet('defaultShowType', 'current');\n\t\t\t} else if (typeof currentTarget.data('off-text') !== 'undefined') {\n\t\t\t\tapp.setMainParams('showType', 'history');\n\t\t\t\tapp.moduleCacheSet('defaultShowType', 'history');\n\t\t\t}\n\t\t\tcalendarView.fullCalendar('getCalendar').view.options.loadView();\n\t\t});\n\t\t$('label.active', switchShowType)\n\t\t\t.find('input')\n\t\t\t.filter(':first')\n\t\t\t.change();\n\t\tif (switchSwitchingDays.length) {\n\t\t\tif (typeof isWorkDays !== 'undefined' && !isWorkDays) {\n\t\t\t\tswitchSwitchingDays.find('.js-switch--label-off').button('toggle');\n\t\t\t}\n\t\t\tswitchSwitchingDays.on('change', 'input', e => {\n\t\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\t\tlet hiddenDays = [];\n\t\t\t\tif (typeof currentTarget.data('on-text') !== 'undefined') {\n\t\t\t\t\tapp.setMainParams('switchingDays', 'workDays');\n\t\t\t\t\tapp.moduleCacheSet('defaultSwitchingDays', 'workDays');\n\t\t\t\t\thiddenDays = app.getMainParams('hiddenDays', true);\n\t\t\t\t} else if (typeof currentTarget.data('off-text') !== 'undefined') {\n\t\t\t\t\tapp.setMainParams('switchingDays', 'all');\n\t\t\t\t\tapp.moduleCacheSet('defaultSwitchingDays', 'all');\n\t\t\t\t}\n\t\t\t\tcalendarView.fullCalendar('option', 'hiddenDays', hiddenDays);\n\t\t\t\tcalendarView.fullCalendar('option', 'height', this.setCalendarHeight());\n\t\t\t\tif (calendarView.fullCalendar('getView').type === 'year') {\n\t\t\t\t\tthis.registerViewRenderEvents(calendarView.fullCalendar('getView'));\n\t\t\t\t}\n\t\t\t});\n\t\t\t$('label.active', switchSwitchingDays)\n\t\t\t\t.find('input')\n\t\t\t\t.filter(':first')\n\t\t\t\t.change();\n\t\t}\n\t}\n\n\t/**\n\t * Appends subdate row to calendar header and register its scroll\n\t * @param toolbar\n\t */\n\tappendSubDateRow(toolbar) {\n\t\tif (!this.calendarContainer.find('.js-dates-row').length) {\n\t\t\tthis.subDateRow = $(`\n\t\t\t\t\t\t\t\t<div class=\"js-scroll js-dates-row u-overflow-auto-lg-down order-4 flex-grow-1 position-relative my-1 w-100\" data-js=\"perfectScrollbar | container\">\n\t\t\t\t\t\t\t\t\t<div class=\"d-flex flex-nowrap w-100\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"js-sub-date-list w-100 sub-date-list row no-gutters flex-nowrap nav nav-tabs\" data-js=\"data-type\"></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`);\n\t\t\ttoolbar.append(this.subDateRow);\n\t\t\tif ($(window).width() > app.breakpoints.lg) {\n\t\t\t\tapp.showNewScrollbar(this.subDateRow);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Function toggles next year/month and general arrows on view render\n\t * @param view\n\t * @param element\n\t */\n\tregisterViewRenderEvents(view) {\n\t\tthis.calendarContainer = this.getCalendarView();\n\t\tlet toolbar = this.calendarContainer.find('.fc-toolbar.fc-header-toolbar');\n\t\tthis.showChangeDateButtons(view, toolbar);\n\t\tthis.appendSubDateRow(toolbar);\n\t\tthis.refreshDatesRowView(view);\n\t\tthis.addHeaderButtons();\n\t\tthis.showTodayButtonCheckbox(toolbar);\n\t}\n\n\t/**\n\t * Function appends and shows today button's checkbox\n\t * @param {jQuery} toolbar\n\t */\n\tshowTodayButtonCheckbox(toolbar) {\n\t\tlet todayButton = toolbar.find('.fc-today-button'),\n\t\t\ttodyButtonIcon = todayButton.hasClass('fc-state-disabled') ? 'fa-calendar-check' : 'fa-calendar',\n\t\t\tpopoverContent = `${app.vtranslate('JS_CURRENT')} ${toolbar\n\t\t\t\t.find('.fc-state-active')\n\t\t\t\t.text()\n\t\t\t\t.toLowerCase()}`;\n\t\ttodayButton.removeClass('.fc-button');\n\t\ttodayButton.html(\n\t\t\t`<div class=\"js-popover-tooltip--day-btn\" data-toggle=\"popover\"><span class=\"far fa-lg ${todyButtonIcon}\"></span></div>`\n\t\t);\n\t\tapp.showPopoverElementView(todayButton.find('.js-popover-tooltip--day-btn'), {\n\t\t\tcontent: popoverContent,\n\t\t\tcontainer: '.fc-today-button .js-popover-tooltip--day-btn'\n\t\t});\n\t}\n\n\t/**\n\t * Function shows change date buttons in calendar's header for specific view\n\t * @param view\n\t * @param toolbar\n\t */\n\tshowChangeDateButtons(view, toolbar) {\n\t\tlet viewType = view.type.replace(/basic|agenda/g, '').toLowerCase(),\n\t\t\tnextPrevButtons = toolbar.find('.fc-prev-button, .fc-next-button'),\n\t\t\tyearButtons = toolbar.find('.fc-prevYear-button, .fc-nextYear-button');\n\t\tif (!window.calendarLoaded) {\n\t\t\tyearButtons.first().html(`<span class=\"fas fa-xs fa-minus mr-1\"></span>${view.options.buttonText['year']}`);\n\t\t\tyearButtons.last().html(`${view.options.buttonText['year']}<span class=\"fas fa-xs fa-plus ml-1\"></span>`);\n\t\t}\n\t\tif (view.type !== 'year') {\n\t\t\tnextPrevButtons\n\t\t\t\t.first()\n\t\t\t\t.html(`<span class=\"fas fa-xs fa-minus mr-1\"></span>${view.options.buttonText[viewType]}`);\n\t\t\tnextPrevButtons\n\t\t\t\t.last()\n\t\t\t\t.html(`${view.options.buttonText[viewType]}<span class=\"fas fa-xs fa-plus ml-1\"></span>`);\n\t\t}\n\t\tif (view.type === 'year') {\n\t\t\tnextPrevButtons.hide();\n\t\t\tyearButtons.show();\n\t\t} else if (view.type === 'month') {\n\t\t\tnextPrevButtons.show();\n\t\t\tyearButtons.show();\n\t\t} else {\n\t\t\tnextPrevButtons.show();\n\t\t\tyearButtons.hide();\n\t\t}\n\t}\n\n\t/**\n\t * Date bar with counts\n\t * @param object calendarView\n\t */\n\trefreshDatesRowView(calendarView) {\n\t\tconst self = this;\n\t\tswitch (calendarView.type) {\n\t\t\tcase 'year':\n\t\t\t\tself.generateYearList(calendarView.intervalStart, calendarView.intervalEnd);\n\t\t\t\tbreak;\n\t\t\tcase 'month':\n\t\t\t\tself.generateSubMonthList(calendarView.intervalStart, calendarView.intervalEnd);\n\t\t\t\tbreak;\n\t\t\tcase 'week':\n\t\t\tcase 'agendaWeek':\n\t\t\t\tself.generateSubWeekList(calendarView.start, calendarView.end);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tself.generateSubDaysList(calendarView.start, calendarView.end);\n\t\t}\n\t\tself.updateCountTaskCalendar();\n\t\tself.registerDatesChange();\n\t}\n\n\tregisterDatesChange() {\n\t\tthis.container.find('.js-dates-row .js-sub-record').on('click', e => {\n\t\t\tlet currentTarget = $(e.currentTarget);\n\t\t\tcurrentTarget.addClass('active');\n\t\t\tthis.getCalendarView().fullCalendar('gotoDate', moment(currentTarget.data('date'), 'YYYY-MM-DD'));\n\t\t});\n\t}\n\n\tgetCurrentCvId() {\n\t\treturn $('.js-calendar__extended-filter-tab .active')\n\t\t\t.parent('.js-filter-tab')\n\t\t\t.data('cvid');\n\t}\n\n\tregisterFilterTabChange() {\n\t\tconst thisInstance = this;\n\t\tthis.getCalendarView()\n\t\t\t.find('.js-calendar__extended-filter-tab')\n\t\t\t.on('shown.bs.tab', function() {\n\t\t\t\tthisInstance\n\t\t\t\t\t.getCalendarView()\n\t\t\t\t\t.fullCalendar('getCalendar')\n\t\t\t\t\t.view.options.loadView();\n\t\t\t});\n\t}\n\n\tgetSelectedUsersCalendar() {\n\t\tconst sidebar = this.getSidebarView();\n\t\tlet selectedUsers = sidebar.find('.js-input-user-owner-id:checked'),\n\t\t\tselectedUsersAjax = sidebar.find('.js-input-user-owner-id-ajax'),\n\t\t\tselectedRolesAjax = sidebar.find('.js-input-role-owner-id-ajax'),\n\t\t\tusers = [];\n\t\tif (selectedUsers.length > 0) {\n\t\t\tselectedUsers.each(function() {\n\t\t\t\tusers.push($(this).val());\n\t\t\t});\n\t\t} else if (selectedUsersAjax.length > 0) {\n\t\t\tusers = selectedUsersAjax.val().concat(selectedRolesAjax.val());\n\t\t}\n\t\treturn users;\n\t}\n\n\tgetSidebarView() {\n\t\tif (!this.sidebarView.length) {\n\t\t\tthis.sidebarView = this.container.find('.js-calendar-right-panel');\n\t\t}\n\t\treturn this.sidebarView;\n\t}\n\n\tupdateCountTaskCalendar() {\n\t\tlet datesView = this.container.find('.js-dates-row'),\n\t\t\tsubDatesElements = datesView.find('.js-sub-record'),\n\t\t\tdateArray = {},\n\t\t\tuserDateFormat = CONFIG.dateFormat.toUpperCase(),\n\t\t\tuser = this.getSelectedUsersCalendar();\n\t\tif (user.length === 0) {\n\t\t\tuser = app.getMainParams('usersId');\n\t\t}\n\t\tif (user === undefined) {\n\t\t\tuser = [app.getMainParams('userId')];\n\t\t}\n\t\tsubDatesElements.each(function(key, element) {\n\t\t\tlet data = $(this).data('date'),\n\t\t\t\ttype = $(this).data('type');\n\t\t\tif (type === 'years') {\n\t\t\t\tdateArray[key] = [\n\t\t\t\t\tmoment(data + '-01').format(userDateFormat) + ' 00:00:00',\n\t\t\t\t\tmoment(data + '-01')\n\t\t\t\t\t\t.endOf('year')\n\t\t\t\t\t\t.format(userDateFormat) + ' 23:59:59'\n\t\t\t\t];\n\t\t\t} else if (type === 'months') {\n\t\t\t\tdateArray[key] = [\n\t\t\t\t\tmoment(data).format(userDateFormat) + ' 00:00:00',\n\t\t\t\t\tmoment(data)\n\t\t\t\t\t\t.endOf('month')\n\t\t\t\t\t\t.format(userDateFormat) + ' 23:59:59'\n\t\t\t\t];\n\t\t\t} else if (type === 'weeks') {\n\t\t\t\tdateArray[key] = [\n\t\t\t\t\tmoment(data).format(userDateFormat) + ' 00:00:00',\n\t\t\t\t\tmoment(data)\n\t\t\t\t\t\t.add(6, 'day')\n\t\t\t\t\t\t.format(userDateFormat) + ' 23:59:59'\n\t\t\t\t];\n\t\t\t} else if (type === 'days') {\n\t\t\t\tdateArray[key] = [\n\t\t\t\t\tmoment(data).format(userDateFormat) + ' 00:00:00',\n\t\t\t\t\tmoment(data).format(userDateFormat) + ' 23:59:59'\n\t\t\t\t];\n\t\t\t}\n\t\t});\n\t\tAppConnector.request({\n\t\t\tmodule: this.module,\n\t\t\taction: 'Calendar',\n\t\t\tmode: 'getCountEventsGroup',\n\t\t\tdates: dateArray,\n\t\t\tuser: user,\n\t\t\ttime: app.getMainParams('showType'),\n\t\t\tcvid: this.getCurrentCvId()\n\t\t}).done(function(events) {\n\t\t\tsubDatesElements.each(function(key, element) {\n\t\t\t\t$(this)\n\t\t\t\t\t.find('.js-count-events')\n\t\t\t\t\t.removeClass('hide')\n\t\t\t\t\t.html(events.result[key]);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Register events to EditView\n\t * @param {jQuery} sideBar\n\t */\n\tregisterEditForm(sideBar) {\n\t\tlet editViewInstance = Vtiger_Edit_Js.getInstanceByModuleName(sideBar.find('[name=\"module\"]').val()),\n\t\t\theaderInstance = new Vtiger_Header_Js(),\n\t\t\tparams = [];\n\t\tlet rightFormCreate = sideBar.find('form[name=\"QuickCreate\"]');\n\t\teditViewInstance.registerBasicEvents(rightFormCreate);\n\t\trightFormCreate.validationEngine(app.validationEngineOptions);\n\t\theaderInstance.registerHelpInfo(rightFormCreate);\n\t\tApp.Fields.Picklist.showSelect2ElementView(sideBar.find('select'));\n\t\tsideBar.find('.js-summary-close-edit').on('click', () => {\n\t\t\tthis.getCalendarCreateView();\n\t\t});\n\t\tparams.callbackFunction = this.registerAfterSubmitForm(this, rightFormCreate);\n\t\theaderInstance.registerQuickCreatePostLoadEvents(rightFormCreate, params);\n\t\tnew App.Fields.Text.Editor(sideBar.find('.js-editor'), { height: '5em', toolbar: 'Min' });\n\t}\n\n\t/**\n\t * EditView\n\t * @param {Object}|{number} params\n\t */\n\tgetCalendarSidebarData(params) {\n\t\tconst thisInstance = this,\n\t\t\taDeferred = $.Deferred();\n\t\tconst progressInstance = $.progressIndicator({ blockInfo: { enabled: true } });\n\t\tif ($.isNumeric(params)) {\n\t\t\tparams = {\n\t\t\t\tmodule: this.module,\n\t\t\t\tview: 'EventForm',\n\t\t\t\trecord: params\n\t\t\t};\n\t\t}\n\t\tAppConnector.request(params)\n\t\t\t.done(data => {\n\t\t\t\tthisInstance.openRightPanel();\n\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\tlet sidebar = thisInstance.getSidebarView();\n\t\t\t\tthis.updateSidebar(sidebar, data);\n\t\t\t\tif (sidebar.find('form').length) {\n\t\t\t\t\tthisInstance.registerEditForm(sidebar);\n\t\t\t\t} else {\n\t\t\t\t\tapp.showNewScrollbar(sidebar.find('.js-calendar__form__wrapper'), { suppressScrollX: true });\n\t\t\t\t\tsidebar.find('.js-activity-state .js-summary-close-edit').on('click', function() {\n\t\t\t\t\t\tthisInstance.getCalendarCreateView();\n\t\t\t\t\t});\n\t\t\t\t\tsidebar.find('.js-activity-state .editRecord').on('click', function() {\n\t\t\t\t\t\tthisInstance.getCalendarSidebarData($(this).data('id'));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\taDeferred.resolve(sidebar.find('.js-qc-form'));\n\t\t\t})\n\t\t\t.fail(error => {\n\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\tapp.errorLog(error);\n\t\t\t});\n\t\treturn aDeferred.promise();\n\t}\n\n\t/**\n\t * Update sidebar\n\t * @param {jQuery} sidebar\n\t * @param {html} data\n\t */\n\tupdateSidebar(sidebar, data) {\n\t\tsidebar.find('.js-qc-form').html(data);\n\t\tthis.showRightPanelForm();\n\t}\n\tloadCalendarData(view = this.getCalendarView().fullCalendar('getView')) {\n\t\tconst self = this;\n\t\tlet formatDate = CONFIG.dateFormat.toUpperCase(),\n\t\t\tcvid = self.getCurrentCvId(),\n\t\t\tcalendarInstance = this.getCalendarView();\n\t\tcalendarInstance.fullCalendar('removeEvents');\n\t\tlet progressInstance = $.progressIndicator({ blockInfo: { enabled: true } }),\n\t\t\tuser = self.getSelectedUsersCalendar();\n\t\tif (0 === user.length) {\n\t\t\tuser = app.getMainParams('usersId');\n\t\t}\n\t\tif (user === undefined) {\n\t\t\tuser = [app.getMainParams('userId')];\n\t\t}\n\t\tself.clearFilterButton(user, cvid);\n\t\tif (view.type === 'agendaDay') {\n\t\t\tself.selectDays(view.start, view.end);\n\t\t\tview.end = view.end.add(1, 'day');\n\t\t}\n\t\tlet options = {\n\t\t\tmodule: this.module,\n\t\t\taction: 'Calendar',\n\t\t\tmode: 'getEvents',\n\t\t\tstart: view.start.format(formatDate),\n\t\t\tend: view.end.format(formatDate),\n\t\t\tuser: user,\n\t\t\ttime: app.getMainParams('showType'),\n\t\t\tcvid: cvid,\n\t\t\thistoryUrl: `index.php?module=${this.module}&view=CalendarExtended&history=true&viewType=${\n\t\t\t\tview.type\n\t\t\t}&start=${view.start.format(formatDate)}&end=${view.end.format(\n\t\t\t\tformatDate\n\t\t\t)}&user=${user}&time=${app.getMainParams('showType')}&cvid=${cvid}&hiddenDays=${view.options.hiddenDays}`\n\t\t};\n\t\tlet connectorMethod = window['AppConnector']['request'];\n\t\tif (this.browserHistory && window.calendarLoaded) {\n\t\t\tconnectorMethod = window['AppConnector']['requestPjax'];\n\t\t}\n\t\tif (this.browserHistoryConfig && Object.keys(this.browserHistoryConfig).length && !window.calendarLoaded) {\n\t\t\toptions = Object.assign(options, {\n\t\t\t\tstart: this.browserHistoryConfig.start,\n\t\t\t\tend: this.browserHistoryConfig.end,\n\t\t\t\tuser: this.browserHistoryConfig.user,\n\t\t\t\ttime: this.browserHistoryConfig.time,\n\t\t\t\tcvid: this.browserHistoryConfig.cvid\n\t\t\t});\n\t\t\tconnectorMethod = window['AppConnector']['request'];\n\t\t\tapp.setMainParams('showType', this.browserHistoryConfig.time);\n\t\t\tapp.setMainParams('usersId', this.browserHistoryConfig.user);\n\t\t}\n\t\tconnectorMethod(options).done(events => {\n\t\t\tcalendarInstance.fullCalendar('removeEvents');\n\t\t\tcalendarInstance.fullCalendar('addEventSource', events.result);\n\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t});\n\t\tself.registerViewRenderEvents(view);\n\t\twindow.calendarLoaded = true;\n\t}\n\n\tclearFilterButton(user, cvid) {\n\t\tlet currentUser = parseInt(app.getMainParams('userId')),\n\t\t\ttime = app.getMainParams('showType'),\n\t\t\tstatement =\n\t\t\t\t(user.length === 0 || (user.length === 1 && parseInt(user) === currentUser)) &&\n\t\t\t\tcvid === undefined &&\n\t\t\t\ttime === 'current';\n\t\t$('.js-calendar__clear-filters').toggleClass('d-none', statement);\n\t}\n\n\tregisterClearFilterButton() {\n\t\tconst sidebar = this.getSidebarView(),\n\t\t\tcalendarView = this.getCalendarView();\n\t\tlet clearBtn = calendarView.find('.js-calendar__clear-filters');\n\t\tapp.showPopoverElementView(clearBtn);\n\t\tclearBtn.on('click', () => {\n\t\t\t$('.js-calendar__extended-filter-tab a').removeClass('active');\n\t\t\tapp.setMainParams('showType', 'current');\n\t\t\tapp.moduleCacheSet('defaultShowType', 'current');\n\t\t\tsidebar.find('input:checkbox').prop('checked', false);\n\t\t\tsidebar.find('option:selected').prop('selected', false);\n\t\t\tlet calendarSwitch = sidebar.find('.js-switch--showType [class*=\"js-switch--label\"]'),\n\t\t\t\tactualUserCheckbox = sidebar.find('.js-input-user-owner-id[value=' + app.getMainParams('userId') + ']');\n\t\t\tcalendarSwitch.last().removeClass('active');\n\t\t\tcalendarSwitch.first().addClass('active');\n\t\t\tif (actualUserCheckbox.length) {\n\t\t\t\tactualUserCheckbox.prop('checked', true);\n\t\t\t} else {\n\t\t\t\tapp.setMainParams('usersId', undefined);\n\t\t\t}\n\t\t\tcalendarView.fullCalendar('getCalendar').view.options.loadView();\n\t\t});\n\t}\n\n\tgenerateYearList(dateStart, dateEnd) {\n\t\tconst datesView = this.container.find('.js-dates-row');\n\t\tlet prevYear = moment(dateStart).subtract(1, 'year'),\n\t\t\tactualYear = moment(dateStart),\n\t\t\tnextYear = moment(dateStart).add(1, 'year'),\n\t\t\thtml = '',\n\t\t\tactive = '';\n\t\twhile (prevYear <= nextYear) {\n\t\t\tif (prevYear.format('YYYY') === actualYear.format('YYYY')) {\n\t\t\t\tactive = 'active';\n\t\t\t} else {\n\t\t\t\tactive = '';\n\t\t\t}\n\t\t\thtml += `<div class=\"js-sub-record sub-record col-4 nav-item\" data-date=\"${prevYear.format(\n\t\t\t\t'YYYY'\n\t\t\t)}\" data-type=\"years\" data-js=\"click | class: active\">\n\t\t\t\t\t<div class=\"sub-record-content nav-link ${active}\">\n\t\t\t\t\t\t<div class=\"sub-date-name\">\n\t\t\t\t\t\t\t${prevYear.format('YYYY')}\n\t\t\t\t\t\t\t<div class=\"js-count-events count badge c-badge--md ml-1\" data-js=\"html\">0</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;\n\t\t\tprevYear = moment(prevYear).add(1, 'year');\n\t\t}\n\t\tdatesView.find('.js-sub-date-list').html(html);\n\t}\n\n\tgenerateSubMonthList(dateStart, dateEnd) {\n\t\tlet datesView = this.container.find('.js-dates-row'),\n\t\t\tactiveMonth =\n\t\t\t\tparseInt(\n\t\t\t\t\tmoment(dateStart)\n\t\t\t\t\t\t.locale('en')\n\t\t\t\t\t\t.format('M')\n\t\t\t\t) - 1,\n\t\t\thtml = '',\n\t\t\tactive = '';\n\t\tfor (let month = 0; 12 > month; ++month) {\n\t\t\tif (month === activeMonth) {\n\t\t\t\tactive = 'active';\n\t\t\t} else {\n\t\t\t\tactive = '';\n\t\t\t}\n\t\t\thtml += `<div class=\"js-sub-record sub-record nav-item col-1 px-0\" data-type=\"months\" data-date=\"${moment(\n\t\t\t\tdateStart\n\t\t\t)\n\t\t\t\t.month(month)\n\t\t\t\t.format('YYYY-MM')}\" data-js=\"click | class: active\">\n\t\t\t\t\t<div class=\"sub-record-content nav-link ${active}\">\n\t\t\t\t\t\t<div class=\"sub-date-name\">${app\n\t\t\t\t\t\t\t.vtranslate(\n\t\t\t\t\t\t\t\t'JS_' +\n\t\t\t\t\t\t\t\t\tmoment()\n\t\t\t\t\t\t\t\t\t\t.month(month)\n\t\t\t\t\t\t\t\t\t\t.format('MMM')\n\t\t\t\t\t\t\t\t\t\t.toUpperCase()\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.toUpperCase()}\n\t\t\t\t\t\t\t<div class=\"js-count-events count badge c-badge--md ml-1\" data-js=\"html\">0</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;\n\t\t}\n\t\tdatesView.find('.js-sub-date-list').html(html);\n\t}\n\n\tgenerateSubWeekList(dateStart, dateEnd) {\n\t\tlet datesView = this.container.find('.js-dates-row'),\n\t\t\tprevWeeks = moment(dateStart).subtract(5, 'weeks'),\n\t\t\tactualWeek = moment(dateStart).format('WW'),\n\t\t\tnextWeeks = moment(dateStart).add(6, 'weeks'),\n\t\t\thtml = '';\n\t\twhile (prevWeeks <= nextWeeks) {\n\t\t\tlet active = '';\n\t\t\tif (prevWeeks.format('WW') === actualWeek) {\n\t\t\t\tactive = ' active';\n\t\t\t}\n\t\t\thtml +=\n\t\t\t\t'<div class=\"js-sub-record sub-record nav-item col-1 px-0\" data-type=\"weeks\" data-date=\"' +\n\t\t\t\tprevWeeks.format('YYYY-MM-DD') +\n\t\t\t\t'\" data-js=\"click | class: active\">' +\n\t\t\t\t'<div class=\"sub-record-content nav-link' +\n\t\t\t\tactive +\n\t\t\t\t'\">' +\n\t\t\t\t'<div class=\"sub-date-name\">' +\n\t\t\t\tapp.vtranslate('JS_WEEK_SHORT') +\n\t\t\t\t' ' +\n\t\t\t\tprevWeeks.format('WW') +\n\t\t\t\t'<div class=\"js-count-events count badge c-badge--md ml-1\" data-js=\"html\">0</div>' +\n\t\t\t\t'</div>' +\n\t\t\t\t'</div>' +\n\t\t\t\t'</div>';\n\t\t\tprevWeeks = moment(prevWeeks).add(1, 'weeks');\n\t\t}\n\t\tdatesView.find('.js-sub-date-list').html(html);\n\t}\n\n\tgenerateSubDaysList(dateStart, dateEnd) {\n\t\tlet datesView = this.container.find('.js-dates-row'),\n\t\t\tprevDays = moment(dateStart).subtract(5, 'days'),\n\t\t\tactualDay = moment(dateStart).format('DDD'),\n\t\t\tnextDays = moment(dateStart).add(7, 'days'),\n\t\t\tdaysToShow = nextDays.diff(prevDays, 'days'),\n\t\t\thtml = '';\n\t\tfor (let day = 0; day < daysToShow; ++day) {\n\t\t\tlet active = '';\n\t\t\tif (\n\t\t\t\tapp.getMainParams('switchingDays') === 'workDays' &&\n\t\t\t\tapp.moduleCacheGet('defaultSwitchingDays') !== 'all'\n\t\t\t) {\n\t\t\t\tif ($.inArray(prevDays.day(), app.getMainParams('hiddenDays', true)) !== -1) {\n\t\t\t\t\tprevDays = moment(prevDays).add(1, 'days');\n\t\t\t\t\tdaysToShow++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (prevDays.format('DDD') === actualDay) {\n\t\t\t\tactive = ' active';\n\t\t\t}\n\t\t\thtml +=\n\t\t\t\t'<div class=\"js-sub-record sub-record nav-item col-1 px-0\" data-type=\"days\" data-date=\"' +\n\t\t\t\tprevDays.format('YYYY-MM-DD') +\n\t\t\t\t'\" data-js=\"click | class: active\">' +\n\t\t\t\t'<div class=\"sub-record-content nav-link' +\n\t\t\t\tactive +\n\t\t\t\t'\">' +\n\t\t\t\t'<div class=\"sub-date-name\">' +\n\t\t\t\tapp.vtranslate('JS_DAY_SHORT') +\n\t\t\t\t' ' +\n\t\t\t\tprevDays.format('DD') +\n\t\t\t\t'<div class=\"js-count-events count badge c-badge--md ml-1\" data-js=\"html\">0</div>' +\n\t\t\t\t'</div>' +\n\t\t\t\t'</div>' +\n\t\t\t\t'</div>';\n\t\t\tprevDays = moment(prevDays).add(1, 'days');\n\t\t}\n\t\tdatesView.find('.js-sub-date-list').html(html);\n\t}\n\n\tselectDays(startDate, endDate) {\n\t\tthis.container.find('.js-right-panel-event-link').tab('show');\n\t\tlet start_hour = app.getMainParams('startHour'),\n\t\t\tend_hour = app.getMainParams('endHour'),\n\t\t\tview = this.getCalendarView().fullCalendar('getView');\n\t\tif (endDate.hasTime() == false) {\n\t\t\tendDate.add(-1, 'days');\n\t\t}\n\t\tstartDate = startDate.format();\n\t\tendDate = endDate.format();\n\t\tif (start_hour == '') {\n\t\t\tstart_hour = '00';\n\t\t}\n\t\tif (end_hour == '') {\n\t\t\tend_hour = '00';\n\t\t}\n\t\tthis.getCalendarCreateView().done(function(data) {\n\t\t\tif (data.length <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (view.name != 'agendaDay' && view.name != 'agendaWeek') {\n\t\t\t\tstartDate = startDate + 'T' + start_hour + ':00';\n\t\t\t\tendDate = endDate + 'T' + end_hour + ':00';\n\t\t\t\tif (startDate == endDate) {\n\t\t\t\t\tlet activityType = data.find('[name=\"activitytype\"]').val();\n\t\t\t\t\tlet activityDurations = JSON.parse(data.find('[name=\"defaultOtherEventDuration\"]').val());\n\t\t\t\t\tlet minutes = 0;\n\t\t\t\t\tfor (let i in activityDurations) {\n\t\t\t\t\t\tif (activityDurations[i].activitytype === activityType) {\n\t\t\t\t\t\t\tminutes = parseInt(activityDurations[i].duration);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tendDate = moment(endDate)\n\t\t\t\t\t\t.add(minutes, 'minutes')\n\t\t\t\t\t\t.toISOString();\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet dateFormat = data\n\t\t\t\t\t.find('[name=\"date_start\"]')\n\t\t\t\t\t.data('dateFormat')\n\t\t\t\t\t.toUpperCase(),\n\t\t\t\ttimeFormat = data.find('[name=\"time_start\"]').data('format'),\n\t\t\t\tdefaultTimeFormat = '';\n\t\t\tif (timeFormat == 24) {\n\t\t\t\tdefaultTimeFormat = 'HH:mm';\n\t\t\t} else {\n\t\t\t\tdefaultTimeFormat = 'hh:mm A';\n\t\t\t}\n\t\t\tdata.find('[name=\"date_start\"]').val(moment(startDate).format(dateFormat));\n\t\t\tdata.find('[name=\"due_date\"]').val(moment(endDate).format(dateFormat));\n\t\t\tif (data.find('.js-autofill').prop('checked') === true) {\n\t\t\t\tCalendar_Edit_Js.getInstance().getFreeTime(data);\n\t\t\t} else {\n\t\t\t\tdata.find('[name=\"time_start\"]').val(moment(startDate).format(defaultTimeFormat));\n\t\t\t\tdata.find('[name=\"time_end\"]').val(moment(endDate).format(defaultTimeFormat));\n\t\t\t}\n\t\t});\n\t}\n\n\tregisterUsersChange(formContainer) {\n\t\tformContainer.find('.js-input-user-owner-id-ajax, .js-input-user-owner-id').on('change', () => {\n\t\t\tthis.getCalendarView()\n\t\t\t\t.fullCalendar('getCalendar')\n\t\t\t\t.view.options.loadView();\n\t\t});\n\t\tthis.registerPinUser();\n\t}\n\n\t/**\n\t * Register actions to do after save record\n\t * @param instance\n\t * @param data\n\t * @returns {function}\n\t */\n\tregisterAfterSubmitForm(self, data) {\n\t\tconst calendarView = this.getCalendarView();\n\t\tlet returnFunction = function(data) {\n\t\t\tif (data.success) {\n\t\t\t\tlet recordActivityStatus = data.result.activitystatus.value,\n\t\t\t\t\thistoryStatus = app.getMainParams('activityStateLabels', true).history,\n\t\t\t\t\tinHistoryStatus = $.inArray(recordActivityStatus, historyStatus),\n\t\t\t\t\tshowType = app.getMainParams('showType');\n\t\t\t\tif (\n\t\t\t\t\t(-1 !== inHistoryStatus && 'history' === showType) ||\n\t\t\t\t\t(-1 === inHistoryStatus && 'history' !== showType)\n\t\t\t\t) {\n\t\t\t\t\tif (calendarView.fullCalendar('clientEvents', data.result._recordId)[0]) {\n\t\t\t\t\t\tself.updateCalendarEvent(data.result._recordId, data.result);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst calendarInstance = calendarView.fullCalendar('getCalendar');\n\t\t\t\t\t\tif (calendarInstance.view.type !== 'year') {\n\t\t\t\t\t\t\tcalendarInstance.view.options.addCalendarEvent(data.result);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcalendarInstance.view.render();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.result.followup.value !== undefined) {\n\t\t\t\t\t\t\tcalendarView.fullCalendar('removeEvents', data.result.followup.value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tself.refreshDatesRowView(calendarView.fullCalendar('getView'));\n\t\t\t\tself.getSidebarView()\n\t\t\t\t\t.find('.js-qc-form')\n\t\t\t\t\t.html('');\n\t\t\t\tself.getCalendarCreateView();\n\t\t\t\twindow.popoverCache = {};\n\t\t\t}\n\t\t};\n\t\treturn returnFunction;\n\t}\n\n\topenRightPanel() {\n\t\tlet calendarRightPanel = $('.js-calendar-right-panel');\n\t\tif (calendarRightPanel.hasClass('hideSiteBar')) {\n\t\t\tcalendarRightPanel.find('.js-toggle-site-bar-right-button').trigger('click');\n\t\t}\n\t}\n\n\tshowRightPanelForm() {\n\t\tlet calendarRightPanel = $('.js-calendar-right-panel');\n\t\tif (!calendarRightPanel.find('.js-right-panel-event').hasClass('active')) {\n\t\t\tcalendarRightPanel.find('.js-right-panel-event-link').trigger('click');\n\t\t}\n\t\tapp.showNewScrollbar(calendarRightPanel.find('.js-calendar__form__wrapper'), {\n\t\t\tsuppressScrollX: true\n\t\t});\n\t}\n\n\tregisterSiteBarEvents() {\n\t\tlet calendarRightPanel = $('.js-calendar-right-panel');\n\t\tcalendarRightPanel.find('.js-show-sitebar').on('click', () => {\n\t\t\tif (calendarRightPanel.hasClass('hideSiteBar')) {\n\t\t\t\tcalendarRightPanel.find('.js-toggle-site-bar-right-button').trigger('click');\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Parse calendar data\n\t * @param {Object} calendarDetails\n\t * @returns {{id: *, title: *, start: *, end: *, module: string, url: string, className: string[], start_display: *, end_display: *}}\n\t */\n\tgetEventData(calendarDetails) {\n\t\tlet calendar = this.getCalendarView(),\n\t\t\tstartDate = calendar.fullCalendar(\n\t\t\t\t'moment',\n\t\t\t\tcalendarDetails.date_start.value + ' ' + calendarDetails.time_start.value\n\t\t\t),\n\t\t\tendDate = calendar.fullCalendar(\n\t\t\t\t'moment',\n\t\t\t\tcalendarDetails.due_date.value + ' ' + calendarDetails.time_end.value\n\t\t\t),\n\t\t\teventObject = {\n\t\t\t\tid: calendarDetails._recordId,\n\t\t\t\ttitle: calendarDetails.subject.display_value,\n\t\t\t\tstart: startDate.format(),\n\t\t\t\tend: endDate.format(),\n\t\t\t\tmodule: this.module,\n\t\t\t\turl: `index.php?module=${this.module}&view=ActivityState&record=${calendarDetails._recordId}`,\n\t\t\t\tclassName: [\n\t\t\t\t\t'ownerCBg_' + calendarDetails.assigned_user_id.value,\n\t\t\t\t\t' picklistCBr_Calendar_activitytype_' + calendarDetails.activitytype.value,\n\t\t\t\t\t'js-popover-tooltip--record'\n\t\t\t\t],\n\t\t\t\tstart_display: calendarDetails.date_start.display_value,\n\t\t\t\tend_display: calendarDetails.due_date.display_value\n\t\t\t};\n\t\tif (calendarDetails.isEditable && app.getMainParams('showEditForm')) {\n\t\t\teventObject.url = `index.php?module=${this.module}&view=EventForm&record=${eventObject.id}`;\n\t\t}\n\t\treturn eventObject;\n\t}\n\n\t/**\n\t * Update Event\n\t * @param {Number} calendarEventId\n\t * @param {Object} calendarDetails\n\t */\n\tupdateCalendarEvent(calendarEventId, calendarDetails) {\n\t\tconst calendar = this.getCalendarView();\n\t\tlet recordToUpdate = calendar.fullCalendar('clientEvents', calendarEventId)[0];\n\t\t$.extend(recordToUpdate, this.getEventData(calendarDetails));\n\t\tcalendar.fullCalendar('updateEvent', recordToUpdate);\n\t}\n\n\tgetCalendarCreateView() {\n\t\tlet aDeferred = $.Deferred();\n\t\tif (this.eventCreate) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet sideBar = thisInstance.getSidebarView(),\n\t\t\t\tqcForm = sideBar.find('.js-qc-form');\n\t\t\tif (qcForm.find('form').length > 0 && qcForm.find('input[name=record]').length === 0) {\n\t\t\t\taDeferred.resolve(qcForm);\n\t\t\t} else {\n\t\t\t\tlet progressInstance = $.progressIndicator({ blockInfo: { enabled: true } });\n\t\t\t\tthis.getCalendarSidebarData({ module: this.module, view: 'EventForm' })\n\t\t\t\t\t.done(() => {\n\t\t\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\tthisInstance.registerAutofillTime();\n\t\t\t\t\t\taDeferred.resolve(qcForm);\n\t\t\t\t\t})\n\t\t\t\t\t.fail(error => {\n\t\t\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\tapp.errorLog(error);\n\t\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\taDeferred.reject();\n\t\t}\n\t\treturn aDeferred.promise();\n\t}\n\n\t/**\n\t * Autoselect date in create view in extended calendar\n\t */\n\tregisterAutofillTime() {\n\t\tif (app.getMainParams('autofillTime')) {\n\t\t\tthis.container\n\t\t\t\t.find('.js-autofill')\n\t\t\t\t.prop('checked', 'checked')\n\t\t\t\t.trigger('change');\n\t\t}\n\t}\n\n\tregisterPinUser() {\n\t\t$('.js-pin-user')\n\t\t\t.off('click')\n\t\t\t.on('click', function() {\n\t\t\t\tconst thisInstance = $(this);\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: this.module,\n\t\t\t\t\taction: 'Calendar',\n\t\t\t\t\tmode: 'pinOrUnpinUser',\n\t\t\t\t\telement_id: thisInstance.data('elementid')\n\t\t\t\t}).done(data => {\n\t\t\t\t\tlet response = data.result;\n\t\t\t\t\tif (response === 'unpin') {\n\t\t\t\t\t\tthisInstance\n\t\t\t\t\t\t\t.find('.js-pin-icon')\n\t\t\t\t\t\t\t.removeClass('fas')\n\t\t\t\t\t\t\t.addClass('far');\n\t\t\t\t\t} else if (response === 'pin') {\n\t\t\t\t\t\tthisInstance\n\t\t\t\t\t\t\t.find('.js-pin-icon')\n\t\t\t\t\t\t\t.removeClass('far')\n\t\t\t\t\t\t\t.addClass('fas');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify(app.vtranslate('JS_ERROR'));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tregisterAddForm() {\n\t\tconst thisInstance = this;\n\t\tlet sideBar = thisInstance.getSidebarView();\n\t\tthisInstance.getCalendarCreateView();\n\t\tlet user = app.getMainParams('usersId');\n\t\tif (user === undefined) {\n\t\t\tuser = [app.getMainParams('userId')];\n\t\t}\n\t\tAppConnector.request(\n\t\t\t`index.php?module=${this.module}&view=RightPanelExtended&mode=getUsersList&user=${user}`\n\t\t).done(function(data) {\n\t\t\tif (data) {\n\t\t\t\tlet formContainer = sideBar.find('.js-users-form');\n\t\t\t\tformContainer.html(data);\n\t\t\t\tthisInstance.registerUsersChange(formContainer);\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(formContainer.find('select'));\n\t\t\t\tapp.showNewScrollbar(formContainer, {\n\t\t\t\t\tsuppressScrollX: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tAppConnector.request(\n\t\t\t`index.php?module=${this.module}&view=RightPanelExtended&mode=getGroupsList&user=${user}`\n\t\t).done(function(data) {\n\t\t\tif (data) {\n\t\t\t\tlet formContainer = sideBar.find('.js-group-form');\n\t\t\t\tformContainer.html(data);\n\t\t\t\tthisInstance.registerUsersChange(formContainer);\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(formContainer.find('select'));\n\t\t\t\tformContainer.addClass('u-min-h-30per');\n\t\t\t\tapp.showNewScrollbar(formContainer, {\n\t\t\t\t\tsuppressScrollX: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Find element on list (user, group)\n\t * @param {jQuery.Event} e\n\t */\n\tfindElementOnList(e) {\n\t\tlet target = $(e.target),\n\t\t\tvalue = target.val().toLowerCase(),\n\t\t\tcontainer = target.closest('.js-filter__container');\n\t\tcontainer.find('.js-filter__item__value').filter(function() {\n\t\t\tlet item = $(this).closest('.js-filter__item__container');\n\t\t\tif (\n\t\t\t\t$(this)\n\t\t\t\t\t.text()\n\t\t\t\t\t.trim()\n\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t.indexOf(value) > -1\n\t\t\t) {\n\t\t\t\titem.removeClass('d-none');\n\t\t\t} else {\n\t\t\t\titem.addClass('d-none');\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Register filter for users and groups\n\t */\n\tregisterFilterForm() {\n\t\tconst self = this;\n\t\tthis.getSidebarView()\n\t\t\t.find('a[data-toggle=\"tab\"]')\n\t\t\t.one('shown.bs.tab', function(e) {\n\t\t\t\t$('.js-filter__search').on('keyup', self.findElementOnList.bind(self));\n\t\t\t});\n\t}\n\n\t/**\n\t * Register popover buttons' click\n\t */\n\tregisterPopoverButtonsClickEvent() {\n\t\t$(document).on('click', '.js-calendar-popover__button', this.showCalendarPopoverLinkInSidebar.bind(this));\n\t}\n\n\t/**\n\t * Show popover link in sidebar\n\t *\n\t * @param   {Object}  e  click event\n\t */\n\tshowCalendarPopoverLinkInSidebar(e) {\n\t\tlet href = e.currentTarget.href;\n\t\tconst hrefObject = app.convertUrlToObject(href);\n\t\tif (hrefObject.module !== 'Calendar' || (hrefObject.view !== 'Edit' && hrefObject.view !== 'Detail')) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\te.preventDefault();\n\t\t\tconst sidebarView = hrefObject.view === 'Edit' ? 'EventForm' : 'ActivityState';\n\t\t\thref = href.replace(hrefObject.view, sidebarView);\n\t\t\tthis.getCalendarSidebarData(href);\n\t\t}\n\t}\n\n\t/**\n\t * Register events\n\t */\n\tregisterEvents() {\n\t\tsuper.registerEvents();\n\t\tthis.registerAddForm();\n\t\tthis.registerSiteBarEvents();\n\t\tthis.registerFilterForm();\n\t\tthis.registerPopoverButtonsClickEvent();\n\t\tElementQueries.listen();\n\t}\n};\n"],"names":["window","calendarLoaded","Calendar_CalendarExtended_Js","container","readonly","sidebarView","calendarContainer","addCommonMethodsToYearView","calendar","getCalendarView","self","views","year","FC","extend","selectDays","getCalendarCreateView","getSidebarView","getCurrentCvId","showRightPanelForm","getSelectedUsersCalendar","registerClearFilterButton","clearFilterButton","registerFilterTabChange","registerAfterSubmitForm","registerViewRenderEvents","appendSubDateRow","refreshDatesRowView","generateYearList","updateCountTaskCalendar","registerDatesChange","addHeaderButtons","browserHistoryConfig","module","showChangeDateButtons","showTodayButtonCheckbox","basicOptions","setCalendarOptions","options","app","getMainParams","vtranslate","start","end","fullCalendar","view","render","parseDateFormat","loadCalendarData","event","element","eventRenderer","type","calendarDetails","getEventData","Object","assign","eventEdit","eventClick","calEvent","jsEvent","preventDefault","getCalendarSidebarData","$","attr","link","URL","href","location","searchParams","get","find","length","buttonsContainer","prev","viewBtn","clone","filters","prepend","after","calendarView","isWorkDays","switchShowTypeVal","switchContainer","switchShowType","switchSwitchingDays","historyParams","moduleCacheGet","button","setMainParams","time","hiddenDays","on","currentTarget","e","data","moduleCacheSet","loadView","filter","change","setCalendarHeight","toolbar","subDateRow","append","width","breakpoints","lg","showNewScrollbar","todayButton","todyButtonIcon","hasClass","popoverContent","text","toLowerCase","removeClass","html","showPopoverElementView","viewType","replace","nextPrevButtons","yearButtons","first","buttonText","last","hide","show","intervalStart","intervalEnd","generateSubMonthList","generateSubWeekList","generateSubDaysList","addClass","moment","parent","thisInstance","sidebar","selectedUsers","selectedUsersAjax","selectedRolesAjax","users","each","push","val","concat","datesView","subDatesElements","dateArray","userDateFormat","CONFIG","dateFormat","toUpperCase","user","undefined","key","format","endOf","add","request","done","events","result","sideBar","editViewInstance","Vtiger_Edit_Js","getInstanceByModuleName","headerInstance","Vtiger_Header_Js","params","rightFormCreate","registerBasicEvents","validationEngine","validationEngineOptions","registerHelpInfo","Fields","Picklist","showSelect2ElementView","callbackFunction","registerQuickCreatePostLoadEvents","App","Text","Editor","height","aDeferred","Deferred","progressInstance","progressIndicator","blockInfo","enabled","isNumeric","openRightPanel","mode","updateSidebar","registerEditForm","suppressScrollX","resolve","fail","errorLog","error","promise","formatDate","cvid","calendarInstance","connectorMethod","browserHistory","keys","currentUser","parseInt","statement","toggleClass","clearBtn","prop","calendarSwitch","actualUserCheckbox","dateStart","dateEnd","prevYear","subtract","actualYear","nextYear","active","activeMonth","locale","month","prevWeeks","actualWeek","nextWeeks","prevDays","actualDay","nextDays","daysToShow","diff","day","inArray","startDate","endDate","tab","start_hour","end_hour","hasTime","name","activityType","activityDurations","JSON","parse","minutes","i","activitytype","duration","toISOString","timeFormat","defaultTimeFormat","getInstance","getFreeTime","formContainer","registerPinUser","returnFunction","success","recordActivityStatus","activitystatus","value","historyStatus","history","inHistoryStatus","showType","_recordId","updateCalendarEvent","addCalendarEvent","followup","popoverCache","calendarRightPanel","trigger","date_start","time_start","due_date","time_end","eventObject","subject","display_value","assigned_user_id","isEditable","url","id","calendarEventId","recordToUpdate","eventCreate","qcForm","registerAutofillTime","reject","off","response","showPnotify","registerUsersChange","target","closest","item","trim","indexOf","one","findElementOnList","bind","document","showCalendarPopoverLinkInSidebar","hrefObject","convertUrlToObject","registerAddForm","registerSiteBarEvents","registerFilterForm","registerPopoverButtonsClickEvent","listen","Calendar_Calendar_Js"],"mappings":"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"}