{"version":3,"file":"YearView.min.js","sources":["YearView.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\nvar FC = $.fullCalendar, // a reference to FullCalendar's root namespace\n\tView = FC.View; // the class that all views must inherit from\n\n/**\n * Creates fullcalendar's View year subclass\n */\nFC.views.year = View.extend({\n\tcalendarView: false,\n\trenderHtml: function(year) {\n\t\tlet col2Breakpoint = 'col-xxl-2';\n\t\tif ($('#switchingDays').val() === 'all') {\n\t\t\tcol2Breakpoint = 'col-xxxl-2';\n\t\t}\n\t\treturn `\n\t\t\t<div class=\"h-100 fc-year\">\n\t\t\t\t<div class=\"fc-year__container row no-gutters\">\n\t\t\t\t\t<div class=\"fc-january fc-year__month col-sm-6 col-lg-4 col-xl-3 ${col2Breakpoint}\" data-date=\"${year}-01-01\"></div>\n\t\t\t\t\t<div class=\"fc-february fc-year__month col-sm-6 col-lg-4 col-xl-3 ${col2Breakpoint}\" data-date=\"${year}-02-01\"></div>\n\t\t\t\t\t<div class=\"fc-march fc-year__month col-sm-6 col-lg-4 col-xl-3 ${col2Breakpoint}\" data-date=\"${year}-03-01\"></div>\n\t\t\t\t\t<div class=\"fc-april fc-year__month col-sm-6 col-lg-4 col-xl-3 ${col2Breakpoint}\" data-date=\"${year}-04-01\"></div>\n\t\t\t\t\t<div class=\"fc-may fc-year__month col-sm-6 col-lg-4 col-xl-3 ${col2Breakpoint}\" data-date=\"${year}-05-01\"></div>\n\t\t\t\t\t<div class=\"fc-june fc-year__month col-sm-6 col-lg-4 col-xl-3 ${col2Breakpoint}\" data-date=\"${year}-06-01\"></div>\n\t\t\t\t\t<div class=\"fc-july fc-year__month col-sm-6 col-lg-4 col-xl-3 ${col2Breakpoint}\" data-date=\"${year}-07-01\"></div>\n\t\t\t\t\t<div class=\"fc-august fc-year__month col-sm-6 col-lg-4 col-xl-3 ${col2Breakpoint}\" data-date=\"${year}-08-01\"></div>\n\t\t\t\t\t<div class=\"fc-september fc-year__month col-sm-6 col-lg-4 col-xl-3 ${col2Breakpoint}\" data-date=\"${year}-09-01\"></div>\n\t\t\t\t\t<div class=\"fc-october fc-year__month col-sm-6 col-lg-4 col-xl-3 ${col2Breakpoint}\" data-date=\"${year}-10-01\"></div>\n\t\t\t\t\t<div class=\"fc-november fc-year__month col-sm-6 col-lg-4 col-xl-3 ${col2Breakpoint}\" data-date=\"${year}-11-01\"></div>\n\t\t\t\t\t<div class=\"fc-december fc-year__month col-sm-6 col-lg-4 col-xl-3 ${col2Breakpoint}\" data-date=\"${year}-12-01\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t},\n\tloadMonthData: function(calendar, events) {\n\t\tconst thisInstance = this;\n\t\tlet height = calendar.find('.fc-bg :first').height() - calendar.find('.fc-day-number').height() - 10,\n\t\t\twidth = calendar.find('.fc-day-number').width() / 2 - 10,\n\t\t\ti;\n\t\tfor (i in events.result) {\n\t\t\tevents.result[i]['width'] = width;\n\t\t\tevents.result[i]['height'] = height;\n\t\t}\n\t\tcalendar.fullCalendar('addEventSource', events.result);\n\t\tcalendar.find('.js-show-day').on('click', function() {\n\t\t\tlet date = moment($(this).data('date')).format(CONFIG.dateFormat.toUpperCase());\n\t\t\tthisInstance.getCalendarView().fullCalendar('changeView', 'agendaDay', date);\n\t\t\t$('.js-sub-record .active').click();\n\t\t});\n\t\tcalendar.find('.fc-center').on('click', function() {\n\t\t\tlet date = moment(\n\t\t\t\t$(this)\n\t\t\t\t\t.closest('[data-date]')\n\t\t\t\t\t.data('date')\n\t\t\t).format(CONFIG.dateFormat.toUpperCase());\n\t\t\tthisInstance.getCalendarView().fullCalendar('changeView', 'month', date);\n\t\t\t$('.js-sub-record .active').click();\n\t\t});\n\t},\n\tappendWeekButton() {\n\t\t$('.fc-row.fc-week.fc-widget-content').each(function() {\n\t\t\tlet date = $(this)\n\t\t\t\t.find('.fc-day-top')\n\t\t\t\t.first()\n\t\t\t\t.data('date');\n\t\t\tlet actualWeek = moment(date).format('WW');\n\t\t\t$(this).prepend(\n\t\t\t\t`<div class=\"js-show-week js-popover-tooltip fc-year__show-week-btn\" data-toggle=\"popover\" data-date=\"${date}\" data-content=\"${app.vtranslate(\n\t\t\t\t\t'JS_WEEK'\n\t\t\t\t)} ${actualWeek}\" role=\"tooltip\" data-js=\"click | popover\">${actualWeek}</div>`\n\t\t\t);\n\t\t});\n\t\tthis.getCalendarView()\n\t\t\t.find('.js-show-week')\n\t\t\t.on('click', e => {\n\t\t\t\t$(e.currentTarget).popover('hide');\n\t\t\t\tlet date = moment($(e.currentTarget).data('date')).format(CONFIG.dateFormat.toUpperCase());\n\t\t\t\tthis.getCalendarView().fullCalendar('changeView', 'agendaWeek', date);\n\t\t\t\t$('.js-sub-record .active').click();\n\t\t\t});\n\t},\n\trender: function() {\n\t\tconst self = this;\n\t\tlet calendar = self.getCalendarView().fullCalendar('getCalendar'),\n\t\t\tdate = calendar.getDate().year(),\n\t\t\tyearView = this.el.html(this.renderHtml(date)),\n\t\t\tuser = this.getSelectedUsersCalendar(),\n\t\t\tprogressInstance = $.progressIndicator({ blockInfo: { enabled: true } }),\n\t\t\tcvid = this.getCurrentCvId();\n\t\tif (user.length === 0) {\n\t\t\tuser = [app.getMainParams('userId')];\n\t\t}\n\t\tlet dateFormat = CONFIG.dateFormat.toUpperCase();\n\t\tthis.clearFilterButton(user, cvid);\n\t\tlet options = {\n\t\t\tmodule: this.module,\n\t\t\taction: 'Calendar',\n\t\t\tmode: 'getEventsYear',\n\t\t\tstart: moment(date + '-01-01').format(dateFormat),\n\t\t\tend: moment(date + '-12-31').format(dateFormat),\n\t\t\tuser: user,\n\t\t\tyearView: true,\n\t\t\ttime: app.getMainParams('showType'),\n\t\t\tcvid: cvid,\n\t\t\thistoryUrl: `index.php?module=${this.module}&view=CalendarExtended&history=true&viewType=${\n\t\t\t\tcalendar.view.type\n\t\t\t}&start=${moment(date + '-01-01').format(dateFormat)}&end=${moment(date + '-12-31').format(\n\t\t\t\tdateFormat\n\t\t\t)}&user=${user}&time=${app.getMainParams('showType')}&cvid=${cvid}&hiddenDays=${\n\t\t\t\tcalendar.view.options.hiddenDays\n\t\t\t}`\n\t\t};\n\t\tlet connectorMethod = window['AppConnector']['request'];\n\t\tif (this.browserHistory && window.calendarLoaded) {\n\t\t\tconnectorMethod = window['AppConnector']['requestPjax'];\n\t\t}\n\t\tif (this.browserHistoryConfig && Object.keys(this.browserHistoryConfig).length && window.calendarLoaded) {\n\t\t\toptions = Object.assign(options, {\n\t\t\t\tstart: moment(this.browserHistoryConfig.start).format(dateFormat),\n\t\t\t\tend: moment(this.browserHistoryConfig.end).format(dateFormat),\n\t\t\t\tuser: this.browserHistoryConfig.user,\n\t\t\t\ttime: this.browserHistoryConfig.time,\n\t\t\t\tcvid: this.browserHistoryConfig.cvid\n\t\t\t});\n\t\t\tconnectorMethod = window['AppConnector']['request'];\n\t\t\tapp.setMainParams('showType', this.browserHistoryConfig.time);\n\t\t\tapp.setMainParams('usersId', this.browserHistoryConfig.user);\n\t\t}\n\t\tconnectorMethod(options).done(function(events) {\n\t\t\tyearView.find('.fc-year__month').each(function(i) {\n\t\t\t\tlet calendarInstance = new Calendar_Calendar_Js(self.container, self.readonly);\n\t\t\t\tlet basicOptions = calendarInstance.setCalendarMinimalOptions(),\n\t\t\t\t\tmonthOptions = {\n\t\t\t\t\t\tdefaultView: 'month',\n\t\t\t\t\t\ttitleFormat: 'MMMM',\n\t\t\t\t\t\theader: { center: 'title', left: false, right: false },\n\t\t\t\t\t\theight: 'auto',\n\t\t\t\t\t\tselect: function(start, end) {\n\t\t\t\t\t\t\tself.selectDays(start, end);\n\t\t\t\t\t\t},\n\t\t\t\t\t\thiddenDays: calendar.view.options.hiddenDays,\n\t\t\t\t\t\tshowNonCurrentDates: false,\n\t\t\t\t\t\tdefaultDate: moment(calendar.getDate().year() + '-' + (i + 1), 'YYYY-MM-DD'),\n\t\t\t\t\t\teventRender: function(event, element) {\n\t\t\t\t\t\t\tif (event.rendering === 'background') {\n\t\t\t\t\t\t\t\telement.append(\n\t\t\t\t\t\t\t\t\t`<span class=\"js-popover-tooltip\" data-content=\"${event.title}\" data-toggle=\"popover\"><span class=\"${event.icon}\"></span></span>`\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\treturn element;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tevent.countShow = '99+';\n\t\t\t\t\t\t\tif (event.count < 100) {\n\t\t\t\t\t\t\t\tevent.countShow = event.count;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telement = `<div class=\"js-show-day cell-calendar u-cursor-pointer d-flex\" data-date=\"${event.date}\" data-js=\"click\">\n\t\t\t\t\t\t\t<a class=\"u-z-index-100 fc-year__show-day-btn mx-auto\" href=\"#\" data-date=\"${event.date}\" title=\"${event.count}\">\n\t\t\t\t\t\t\t\t  <span class=\"fc-year__show-day-btn__container\">\n\t\t\t\t\t\t\t\t\t<span class=\"fas fa-calendar fa-lg\"></span>\n\t\t\t\t\t\t\t\t\t<span class=\"fc-year__show-day-btn__text fa-inverse u-font-weight-700\">${event.countShow}</span>\n\t\t\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>`;\n\t\t\t\t\t\t\treturn element;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\tself.loadMonthData($(this).fullCalendar($.extend(basicOptions, monthOptions)), events);\n\t\t\t});\n\t\t\tif (app.getMainParams('weekCount') === '1') {\n\t\t\t\tself.appendWeekButton();\n\t\t\t}\n\t\t\tlet yearViewContainer = self.container.find('.fc-view-container').first();\n\t\t\tyearViewContainer\n\t\t\t\t.height($(window).height() - yearViewContainer.offset().top - $('.js-footer').height())\n\t\t\t\t.addClass('u-overflow-y-auto u-overflow-x-hidden');\n\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t});\n\t\tthis.registerTodayButtonYearChange(calendar);\n\t\tthis.registerViewRenderEvents(calendar.view);\n\t\twindow.calendarLoaded = true;\n\t},\n\n\t/**\n\t * Function extends today button functionality for year view\n\t * @param {jQuery} calendar\n\t */\n\tregisterTodayButtonYearChange(calendar) {\n\t\tif (calendar.currentDate.format('YYYY') === moment().format('YYYY')) {\n\t\t\tcalendar.el.find('.fc-today-button').addClass('fc-state-disabled');\n\t\t} else {\n\t\t\tcalendar.el.find('.fc-today-button').removeClass('fc-state-disabled');\n\t\t}\n\t}\n});\n"],"names":["FC","$","fullCalendar","View","views","year","extend","col2Breakpoint","val","calendar","events","thisInstance","this","height","find","width","i","result","on","date","moment","data","format","CONFIG","dateFormat","toUpperCase","getCalendarView","click","closest","each","first","actualWeek","prepend","app","vtranslate","e","currentTarget","popover","self","getDate","yearView","el","html","renderHtml","user","getSelectedUsersCalendar","progressInstance","progressIndicator","blockInfo","enabled","cvid","getCurrentCvId","length","getMainParams","clearFilterButton","options","module","view","type","hiddenDays","connectorMethod","window","browserHistory","calendarLoaded","browserHistoryConfig","Object","keys","assign","start","end","time","setMainParams","done","basicOptions","Calendar_Calendar_Js","container","readonly","setCalendarMinimalOptions","monthOptions","center","left","right","selectDays","event","element","rendering","append","title","icon","countShow","count","loadMonthData","appendWeekButton","yearViewContainer","offset","top","addClass","mode","registerTodayButtonYearChange","registerViewRenderEvents","currentDate","removeClass"],"mappings":"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"}