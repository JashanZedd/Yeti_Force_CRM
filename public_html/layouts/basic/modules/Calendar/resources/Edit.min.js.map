{"version":3,"file":"Edit.min.js","sources":["Edit.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n * Contributor(s): YetiForce Sp. z o.o\n *************************************************************************************/\n'use strict';\n\nVtiger_Edit_Js(\"Calendar_Edit_Js\", {\n\tcurrencyInstance: false,\n\tcheckEmail(field, rules, i, options) {\n\t\tif(Calendar_Edit_Js.currencyInstance.emailExists(field.val())){\n\t\t\treturn app.vtranslate('JS_DUPLICATE_RECORD') + ': ' + field.val();\n\t\t}\n\t\treturn true;\n\t}\n}, {\n\tinit(){\n\t\tCalendar_Edit_Js.currencyInstance = this;\n\t},\n\tregisterReminderFieldCheckBox: function () {\n\t\tlet element = this.getForm().find('.js-reminder-field-checkbox');\n\t\telement.on('change', function (e) {\n\t\t\tlet rowElement = element.closest('.js-reminder-field-element').find('.js-reminder-field-row');\n\t\t\tif (element.is(':checked')) {\n\t\t\t\trowElement.removeClass('d-none');\n\t\t\t} else {\n\t\t\t\trowElement.addClass('d-none');\n\t\t\t}\n\t\t});\n\t\telement.change();\n\t},\n\t/**\n\t * Function which will register change event on recurrence field checkbox\n\t */\n\tregisterRecurrenceFieldCheckBox: function () {\n\t\tconst form = this.getForm(),\n\t\t\telement = form.find('input[name=\"reapeat\"]');\n\t\telement.on('change', function (e) {\n\t\t\tlet repeatUI = form.find('.js-repeat-ui'),\n\t\t\t\tcontainer = form.find('[name=\"followup\"]').closest('.fieldValue');\n\t\t\tif ($(e.currentTarget).is(':checked')) {\n\t\t\t\trepeatUI.closest('.fieldRow').removeClass('d-none');\n\t\t\t\tcontainer.find('[name=\"followup_display\"]').attr('disabled', 'disabled');\n\t\t\t\tcontainer.find('button').attr('disabled', 'disabled');\n\t\t\t} else {\n\t\t\t\tcontainer.find('[name=\"followup_display\"]').removeAttr('disabled');\n\t\t\t\tcontainer.find('button').removeAttr('disabled');\n\t\t\t\trepeatUI.closest('.fieldRow').addClass('d-none');\n\t\t\t}\n\t\t});\n\t\telement.change();\n\t},\n\t/**\n\t * Function which will register the change event for recurring type\n\t */\n\tregisterRecurringTypeChangeEvent: function () {\n\t\tvar container = this.getForm();\n\t\tvar thisInstance = this;\n\t\tcontainer.find('.recurringType').on('change', function (e) {\n\t\t\tthisInstance.changeRecurringTypesUIStyles(jQuery(e.currentTarget).val());\n\t\t});\n\t\tcontainer.find('.js-repeat-ui [name=\"calendarEndType\"]').on('change', function (e) {\n\t\t\tvar currentTarget = $(e.currentTarget);\n\t\t\tvar value = currentTarget.val();\n\t\t\tif (value === 'never') {\n\t\t\t\tcontainer.find('.countEvents').attr('disabled', 'disabled');\n\t\t\t\tcontainer.find('.calendarUntil').attr('disabled', 'disabled');\n\t\t\t} else if (value === 'count') {\n\t\t\t\tcontainer.find('.countEvents').removeAttr('disabled');\n\t\t\t\tcontainer.find('.calendarUntil').attr('disabled', 'disabled');\n\t\t\t} else if (value === 'until') {\n\t\t\t\tcontainer.find('.countEvents').attr('disabled', 'disabled');\n\t\t\t\tcontainer.find('.calendarUntil').removeAttr('disabled');\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Function which will change the UI styles based on recurring type\n\t * @params - recurringType - which recurringtype is selected\n\t */\n\tchangeRecurringTypesUIStyles: function (recurringType) {\n\t\tvar container = this.getForm();\n\t\tif (recurringType == 'DAILY' || recurringType == 'YEARLY') {\n\t\t\tcontainer.find('.repeatWeekUI').removeClass('show').addClass('d-none');\n\t\t\tcontainer.find('.repeatMonthUI').removeClass('show').addClass('d-none');\n\t\t} else if (recurringType == 'WEEKLY') {\n\t\t\tcontainer.find('.repeatWeekUI').removeClass('d-none').addClass('show');\n\t\t\tcontainer.find('.repeatMonthUI').removeClass('show').addClass('d-none');\n\t\t} else if (recurringType == 'MONTHLY') {\n\t\t\tcontainer.find('.repeatWeekUI').removeClass('show').addClass('d-none');\n\t\t\tcontainer.find('.repeatMonthUI').removeClass('d-none').addClass('show');\n\t\t}\n\t},\n\tsetDefaultEndTime: function (container) {\n\t\tconst self = this;\n\t\tif (container.find('.js-autofill').is(':checked')) {\n\t\t\tself.getFreeTime(container);\n\t\t} else {\n\t\t\tif ('1' === $('[name=\"userChangedEndDateTime\"]').val()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet dateStartElement = container.find('[name=\"date_start\"]'),\n\t\t\t\tstartTimeElement = container.find('[name=\"time_start\"]'),\n\t\t\t\tendTimeElement = container.find('[name=\"time_end\"]'),\n\t\t\t\tendDateElement = container.find('[name=\"due_date\"]'),\n\t\t\t\tstartDate = dateStartElement.val(),\n\t\t\t\tstartTime = startTimeElement.val(),\n\t\t\t\tresult = Vtiger_Time_Validator_Js.invokeValidation(startTimeElement);\n\t\t\tif (true !== result) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet startDateTime = startDate + ' ' + startTime,\n\t\t\t\tdateFormat = container.find('[name=\"due_date\"]').data('dateFormat').toUpperCase(),\n\t\t\t\ttimeFormat = endTimeElement.data('format'),\n\t\t\t\tactivityType = container.find('[name=\"activitytype\"]').val(),\n\t\t\t\tactivityDurations = JSON.parse(container.find('[name=\"defaultOtherEventDuration\"]').val()),\n\t\t\t\tminutes = 0;\n\t\t\tfor (let i in activityDurations) {\n\t\t\t\tif (activityDurations[i].activitytype === activityType) {\n\t\t\t\t\tminutes = parseInt(activityDurations[i].duration);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet defaultTimeFormat = 'HH:mm';\n\t\t\tif (12 === timeFormat) {\n\t\t\t\tdefaultTimeFormat = 'hh:mm A';\n\t\t\t}\n\t\t\tlet endDate = moment(startDateTime, dateFormat + ' ' + defaultTimeFormat).add(minutes, 'minutes');\n\t\t\tendDateElement.val(endDate.format(dateFormat));\n\t\t\tendTimeElement.val(endDate.format(defaultTimeFormat));\n\t\t}\n\t},\n\t/**\n\t * Function to change the end time based on default call duration\n\t */\n\tregisterActivityTypeChangeEvent: function (container) {\n\t\tconst thisInstance = this;\n\t\tcontainer.on('change', '[name=\"activitytype\"]', function (e) {\n\t\t\tthisInstance.setDefaultEndTime(container);\n\t\t});\n\t},\n\t/**\n\t * Function to change the end time based on default call duration\n\t */\n\tregisterTimeStartChangeEvent(container) {\n\t\tconst thisInstance = this;\n\t\tcontainer.find('input[name=\"time_start\"]').on('change', function (e) {\n\t\t\tthisInstance.setDefaultEndTime(container);\n\t\t});\n\t\tcontainer.find('[name=\"date_start\"]').on('change', function (e) {\n\t\t\tlet endDateElement = container.find('[name=\"due_date\"]'),\n\t\t\t\tstart = thisInstance.getDateInstance(container, 'start'),\n\t\t\t\tend = thisInstance.getDateInstance(container, 'end'),\n\t\t\t\tdateFormat = CONFIG.dateFormat.toUpperCase();\n\t\t\tcontainer.find('.js-autofill').trigger('change');\n\t\t\tif (start > end) {\n\t\t\t\tend = start;\n\t\t\t\tendDateElement.val(moment(end).format(dateFormat));\n\t\t\t\tApp.Fields.Date.register(container);\n\t\t\t}\n\t\t});\n\t\tcontainer.find('input[name=\"time_start\"]').on('focus', function (e) {\n\t\t\tlet element = $(e.currentTarget);\n\t\t\telement.data('prevValue', element.val());\n\t\t});\n\t\tcontainer.find('input[name=\"time_start\"]').on('blur', function (e, data) {\n\t\t\tif (typeof data === \"undefined\") {\n\t\t\t\tdata = {};\n\t\t\t}\n\t\t\tif (typeof data.forceChange === \"undefined\") {\n\t\t\t\tdata.forceChange = false;\n\t\t\t}\n\t\t\tlet element = $(e.currentTarget);\n\t\t\tif (element.val() !== element.data('prevValue') || data.forceChange) {\n\t\t\t\te = $.Event(\"keydown\");\n\t\t\t\te.which = 13;\n\t\t\t\te.keyCode = 13;\n\t\t\t\telement.trigger(e);\n\t\t\t}\n\t\t});\n\t},\n\tregisterEndDateTimeChangeLogger: function (container) {\n\t\tcontainer.find('[name=\"time_end\"]').on('change', function (e) {\n\t\t\tlet timeElement = jQuery(e.currentTarget);\n\t\t\tlet result = Vtiger_Time_Validator_Js.invokeValidation(timeElement);\n\t\t\tif (result != true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet timeDateElement = timeElement.closest('.fieldValue').find('[name=\"due_date\"]');\n\t\t\tjQuery('[name=\"userChangedEndDateTime\"]').val('1');\n\t\t\ttimeDateElement.data('userChangedTime', true);\n\t\t});\n\n\t\tcontainer.find('[name=\"due_date\"]').on('change', function (e) {\n\t\t\tlet dueDateElement = jQuery(e.currentTarget);\n\t\t\tlet result = Vtiger_Date_Validator_Js.invokeValidation(dueDateElement);\n\t\t\tif (result != true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tjQuery('[name=\"userChangedEndDateTime\"]').val('1');\n\t\t\tdueDateElement.data('userChangedTime', true);\n\t\t});\n\t},\n\t/**\n\t *\n\t * @returns {String}\n\t */\n\tgetRule: function () {\n\t\tvar form = this.getForm();\n\t\tvar freq = form.find('.recurringType').val();\n\t\tvar rule = 'FREQ=' + freq;\n\t\trule += ';INTERVAL=' + form.find('.repeatFrequency').val();\n\t\tvar endValue = form.find('.js-repeat-ui [name=\"calendarEndType\"]:checked').val();\n\t\tif (endValue === 'count') {\n\t\t\trule += ';COUNT=' + form.find('.countEvents').val();\n\t\t} else if (endValue === 'until') {\n\t\t\tvar date = form.find('.calendarUntil').val();\n\t\t\tdate = app.getDateInDBInsertFormat(CONFIG.dateFormat, date);\n\t\t\trule += ';UNTIL=' + date.replace(/-/gi, '') + 'T235959';\n\t\t}\n\t\tif (freq === 'WEEKLY') {\n\t\t\tvar checkedElements = [];\n\t\t\tform.find('.repeatWeekUI [type=\"checkbox\"]').each(function () {\n\t\t\t\tvar currentTarget = $(this);\n\t\t\t\tif (currentTarget.is(':checked')) {\n\t\t\t\t\tcheckedElements.push(currentTarget.val());\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (checkedElements.length > 0) {\n\t\t\t\trule += ';BYDAY=' + checkedElements.join(',');\n\t\t\t}\n\t\t}\n\t\tif (freq === 'MONTHLY') {\n\t\t\tvar dayOfWeek = Vtiger_Helper_Js.getDay(form.find('[name=\"date_start\"]').val());\n\t\t\tvar dateInstance = Vtiger_Helper_Js.getDateInstance(form.find('[name=\"date_start\"]').val(), CONFIG.dateFormat);\n\t\t\tvar dayOfMonth = dateInstance.getDate();\n\t\t\tvar option = form.find('.calendarMontlyType:checked').val();\n\t\t\tif (option == 'DAY') {\n\t\t\t\tvar dayOfWeekLabel = '';\n\t\t\t\tswitch (dayOfWeek) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tdayOfWeekLabel = 'SU';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tdayOfWeekLabel = 'MO';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tdayOfWeekLabel = 'TU';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tdayOfWeekLabel = 'WE';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\tdayOfWeekLabel = 'TU';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 5:\n\t\t\t\t\t\tdayOfWeekLabel = 'FR';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 6:\n\t\t\t\t\t\tdayOfWeekLabel = 'SA';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\trule += ';BYDAY=' + (parseInt((dayOfMonth - 1) / 7) + 1) + dayOfWeekLabel;\n\t\t\t} else {\n\t\t\t\trule += ';BYMONTHDAY=' + dayOfMonth;\n\t\t\t}\n\t\t}\n\t\treturn rule;\n\t},\n\t/**\n\t * This function will register the submit event on form\n\t */\n\tregisterFormSubmitEvent: function () {\n\t\tvar thisInstance = this;\n\t\tvar form = this.getForm();\n\t\tvar lockSave = true;\n\t\tif (app.getRecordId()) {\n\t\t\tform.on(Vtiger_Edit_Js.recordPreSave, function (e) {\n\t\t\t\tif (lockSave && form.find('input[name=\"reapeat\"]').is(':checked')) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tapp.showModalWindow(form.find('.typeSavingModal').clone(), function (container) {\n\t\t\t\t\t\tcontainer.find('.typeSavingBtn').on('click', function (e) {\n\t\t\t\t\t\t\tvar currentTarget = $(e.currentTarget);\n\t\t\t\t\t\t\tform.find('[name=\"typeSaving\"]').val(currentTarget.data('value'));\n\t\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t\t\tlockSave = false;\n\t\t\t\t\t\t\tform.submit();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tform.on('submit', function (e) {\n\t\t\tconst recurringCheck = form.find('input[name=\"reapeat\"]').is(':checked');\n\t\t\tif (recurringCheck) {\n\t\t\t\tif (app.getRecordId() && lockSave) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t\tform.find('[name=\"recurrence\"]').val(thisInstance.getRule());\n\t\t\t}\n\t\t\tlet rows = form.find(\".js-participants-content .js-participant-row\");\n\t\t\tlet invitees = [];\n\t\t\trows.each(function (index, domElement) {\n\t\t\t\tlet row = $(domElement);\n\t\t\t\tif (row.data('email')) {\n\t\t\t\t\tinvitees.push([row.data('email'), row.data('crmid'), row.data('ivid'), row.data('name')]);\n\t\t\t\t}\n\t\t\t});\n\t\t\t$('<input type=\"hidden\" name=\"inviteesid\" />').appendTo(form).val(JSON.stringify(invitees));\n\t\t});\n\t},\n\tgetFreeTime: function (container) {\n\t\tvar timeStart = container.find('[name=\"time_start\"], [data-element-name=\"time_start\"]');\n\t\tvar timeEnd = container.find('[name=\"time_end\"], [data-element-name=\"time_end\"]');\n\t\tvar dateStart = container.find('[name=\"date_start\"], [data-element-name=\"date_start\"]');\n\t\tvar ownerId = container.find('[name=\"assigned_user_id\"], [data-element-name=\"assigned_user_id\"]');\n\t\tvar params = {\n\t\t\tmodule: 'Calendar',\n\t\t\taction: 'GetFreeTime',\n\t\t\tdateStart: dateStart.val(),\n\t\t\townerId: ownerId.val(),\n\t\t\tactivitytype: container.find('[name=\"activitytype\"]').val()\n\t\t};\n\t\tlet progress = $.progressIndicator({position: 'html', blockInfo: {enabled: true}});\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tprogress.progressIndicator({mode: 'hide'});\n\t\t\tif (data.result.date_start !== null) {\n\t\t\t\ttimeStart.val(data.result.time_start);\n\t\t\t\ttimeEnd.val(data.result.time_end);\n\t\t\t\tdateStart.val(data.result.date_start);\n\t\t\t\tcontainer.find('[name=\"due_date\"]').val(data.result.date_start);\n\t\t\t} else {\n\t\t\t\tVtiger_Helper_Js.showPnotify(app.vtranslate('JS_ERROR_MAX_VALUE'));\n\t\t\t\tcontainer.find('.js-autofill').prop('checked', false).trigger('change');\n\t\t\t}\n\t\t});\n\t},\n\tregisterAutoFillHours: function (container) {\n\t\tconst thisInstance = this;\n\t\tlet allDay = container.find('[name=\"allday\"]'),\n\t\t\ttimeStart = container.find('[name=\"time_start\"]'),\n\t\t\ttimeEnd = container.find('[name=\"time_end\"]'),\n\t\t\tdateEnd = container.find('[name=\"due_date\"]'),\n\t\t\tautoFill = container.find('.js-autofill');\n\t\tcontainer.find('.js-autofill__icon').on('click', function (e) {\n\t\t\tif (autoFill.is(':checked')) {\n\t\t\t\t$(e.currentTarget).closest('.input-group-text').removeClass('bg-color-blue-700').removeClass('text-white');\n\t\t\t\tautoFill.prop('checked', false).trigger('change');\n\t\t\t} else {\n\t\t\t\t$(e.currentTarget).closest('.input-group-text').addClass('bg-color-blue-700').addClass('text-white');\n\t\t\t\tautoFill.prop('checked', true).trigger('change');\n\t\t\t}\n\t\t});\n\t\tcontainer.find('.js-autofill').on('change', function (e) {\n\t\t\tlet currentTarget = $(e.currentTarget);\n\t\t\tif (currentTarget.is(':checked')) {\n\t\t\t\tcontainer.find('.js-autofill').prop('checked', true);\n\t\t\t\tthisInstance.getFreeTime(container);\n\t\t\t\ttimeStart.attr('readonly', 'readonly');\n\t\t\t\ttimeEnd.attr('readonly', 'readonly');\n\t\t\t\ttimeStart.clockpicker('remove');\n\t\t\t\ttimeEnd.clockpicker('remove');\n\t\t\t\tallDay.attr('disabled', 'disabled');\n\t\t\t\tallDay.prop('checked', false);\n\t\t\t\tallDay.trigger('change');\n\t\t\t\tdateEnd.attr('readonly', 'readonly');\n\t\t\t} else {\n\t\t\t\tcontainer.find('.js-autofill').prop('checked', false);\n\t\t\t\tallDay.removeAttr('disabled');\n\t\t\t\ttimeStart.removeAttr('readonly');\n\t\t\t\ttimeEnd.removeAttr('readonly');\n\t\t\t\tdateEnd.removeAttr('readonly');\n\t\t\t\tapp.registerEventForClockPicker(timeStart);\n\t\t\t\tapp.registerEventForClockPicker(timeEnd);\n\t\t\t}\n\t\t});\n\t},\n\tregisterMarkAsCompletedBtn: function (container) {\n\t\tcontainer.find('.js-btn--mark-as-completed').on('click', function () {\n\t\t\tconst self = $(this);\n\t\t\tif (self.hasClass('active')) {\n\t\t\t\tcontainer.find('.js-completed').remove();\n\t\t\t} else {\n\t\t\t\tcontainer.append('<input class=\"js-completed\" type=hidden name=\"activitystatus\" value=\"PLL_COMPLETED\" data-js=\"remove\">');\n\t\t\t}\n\t\t});\n\t},\n\tregisterBasicEvents: function (container) {\n\t\tthis._super(container);\n\t\tthis.toggleTimesInputs(container);\n\t\tthis.registerTimesInputs(container);\n\t\tthis.registerTimeStartChangeEvent(container);\n\t\tthis.registerActivityTypeChangeEvent(container);\n\t\tthis.registerEndDateTimeChangeLogger(container);\n\t\tthis.registerAutoFillHours(container);\n\t\tthis.registerMarkAsCompletedBtn(container);\n\t},\n\ttoggleTimesInputs: function (container) {\n\t\tcontainer.find(':checkbox').on('change', function () {\n\t\t\tvar checkboxName = $(this).attr('name');\n\t\t\tif ('allday' == checkboxName) {\n\t\t\t\tvar checkboxIsChecked = $(this).is(':checked');\n\t\t\t\tif (!container.find('#quickCreate').length) {\n\t\t\t\t\tif (checkboxIsChecked) {\n\t\t\t\t\t\tcontainer.find('.time').hide();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontainer.find('.time').show();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tregisterTimesInputs: function (container) {\n\t\tvar allday = container.find('[name=\"allday\"]:checkbox');\n\t\tif (allday.prop('checked')) {\n\t\t\tcontainer.find('.time').hide();\n\t\t}\n\n\t},\n\tgetDateInstance: function (container, type) {\n\t\tvar startDateElement = container.find('[name=\"date_start\"]');\n\t\tvar endDateElement = container.find('[name=\"due_date\"]');\n\t\tvar endTimeElement = container.find('[name=\"time_end\"]');\n\t\tvar startTimeElement = container.find('[name=\"time_start\"]');\n\t\tvar startDate = startDateElement.val();\n\t\tvar startTime = startTimeElement.val();\n\t\tvar endTime = endTimeElement.val();\n\t\tvar endDate = endDateElement.val();\n\t\tvar dateFormat = CONFIG.dateFormat;\n\t\tif (type == 'start') {\n\t\t\treturn Vtiger_Helper_Js.getDateInstance(startDate + ' ' + startTime, dateFormat);\n\t\t}\n\t\tif (type == 'end') {\n\t\t\treturn Vtiger_Helper_Js.getDateInstance(endDate + ' ' + endTime, dateFormat);\n\t\t}\n\t},\n\temailExists(email){\n\t\temail = email.toLowerCase();\n\t\tlet recordExist = false;\n\t\tthis.getForm().find('.js-participants-content').find('.js-participant-row').each((index, element) => {\n\t\t\tif ($(element).data('email').toLowerCase() === email) {\n\t\t\t\trecordExist = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn recordExist;\n\t},\n\tregisterAddInvitation(){\n\t\tthis.getForm().find('.js-btn-add-invitation').on('click', (e)=>{\n\t\t\tlet progressIndicatorElement = $.progressIndicator();\n\t\t\tapp.showModalWindow(null, 'index.php?module=Calendar&view=InviteEmail', (data) => {\n\t\t\t\tdata.find('.js-modal__save').on('click', (e)=>{\n\t\t\t\t\tlet email = data.find('.js-invite-email-input').val();\n\t\t\t\t\tlet nameAttendee = data.find('.js-invite-name-input').val();\n\t\t\t\t\tlet participantsContent = this.getForm().find('.js-participants-content');\n\t\t\t\t\tlet formEmail = data.find('.js-form');\n\t\t\t\t\tformEmail.validationEngine(app.validationEngineOptions);\n\t\t\t\t\tif( formEmail.validationEngine('validate') ){\n\t\t\t\t\t\tlet participantRow = participantsContent.find('.d-none .js-participant-row').clone(true, true);\n\t\t\t\t\t\tparticipantRow.data('crmid', 0);\n\t\t\t\t\t\tparticipantRow.data('email', email);\n\t\t\t\t\t\tif( nameAttendee ){\n\t\t\t\t\t\t\tparticipantRow.find('.js-participant-name').data('content', nameAttendee).text(nameAttendee);\n\t\t\t\t\t\t\tparticipantRow.data('name', nameAttendee);\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tparticipantRow.find('.js-participant-name').data('content', email).text(email);\n\t\t\t\t\t\t\tparticipantRow.data('name', '');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparticipantsContent.append(participantRow);\n\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t});\n\t\t});\n\t},\n\tregisterInviteEvent: function (editViewForm) {\n\t\tthis.registerRow(editViewForm);\n\t\tlet participantsContent = editViewForm.find('.js-participants-content');\n\t\tlet participantsSearch = editViewForm.find('.js-participants-search');\n\t\t$.widget(\"custom.ivAutocomplete\", $.ui.autocomplete, {\n\t\t\t_create: function () {\n\t\t\t\tthis._super();\n\t\t\t\tthis.widget().menu(\"option\", \"items\", \"> :not(.ui-autocomplete-category)\");\n\t\t\t},\n\t\t\t_renderMenu: function (ul, items) {\n\t\t\t\tlet that = this, currentCategory = \"\";\n\t\t\t\t$.each(items, function (index, item) {\n\t\t\t\t\tif (item.category != currentCategory) {\n\t\t\t\t\t\tul.append(\"<li class='ui-autocomplete-category'>\" + item.category + \"</li>\");\n\t\t\t\t\t\tcurrentCategory = item.category;\n\t\t\t\t\t}\n\t\t\t\t\tthat._renderItemData(ul, item);\n\t\t\t\t});\n\t\t\t},\n\t\t\t_renderItemData: function (ul, item) {\n\t\t\t\treturn this._renderItem(ul, item).data(\"ui-autocomplete-item\", item);\n\t\t\t},\n\t\t\t_renderItem: function (ul, item) {\n\t\t\t\treturn $(\"<li>\")\n\t\t\t\t\t.data(\"item.autocomplete\", item)\n\t\t\t\t\t.append($(\"<a></a>\").html(item.label))\n\t\t\t\t\t.appendTo(ul);\n\t\t\t},\n\t\t});\n\t\tparticipantsSearch.ivAutocomplete({\n\t\t\tdelay: '600',\n\t\t\tminLength: '3',\n\t\t\tsource: (request, response) => {\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: 'Calendar',\n\t\t\t\t\taction: 'Invitees',\n\t\t\t\t\tmode: 'find',\n\t\t\t\t\tvalue: request.term\n\t\t\t\t}).done((result) => {\n\t\t\t\t\tlet reponseDataList = result.result;\n\t\t\t\t\tif (reponseDataList.length <= 0) {\n\t\t\t\t\t\treponseDataList.push({\n\t\t\t\t\t\t\tlabel: app.vtranslate('JS_NO_RESULTS_FOUND'),\n\t\t\t\t\t\t\ttype: 'no results',\n\t\t\t\t\t\t\tcategory: ''\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tresponse(reponseDataList);\n\t\t\t\t});\n\t\t\t},\n\t\t\tselect: (event, ui) => {\n\t\t\t\tlet selected = ui.item;\n\t\t\t\t//To stop selection if no results is selected\n\t\t\t\tif (typeof selected.type !== \"undefined\" && selected.type == \"no results\") {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tlet recordExist = true;\n\t\t\t\tparticipantsContent.find('.js-participant-row').each(function (index) {\n\t\t\t\t\tif ($(this).data('crmid') == selected.id) {\n\t\t\t\t\t\trecordExist = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (recordExist) {\n\t\t\t\t\tlet participantRow = participantsContent.find('.d-none .js-participant-row').clone(true, true);\n\t\t\t\t\tVtiger_Index_Js.getEmailFromRecord(selected.id, selected.module).done((email) => {\n\t\t\t\t\t\tparticipantRow.data('crmid', selected.id);\n\t\t\t\t\t\tparticipantRow.data('email', email);\n\t\t\t\t\t\tparticipantRow.find('.js-participant-name').data('content', selected.fullLabel + email).text(selected.label);\n\t\t\t\t\t\tparticipantRow.find('.js-participant-icon .c-badge__icon').removeClass('fas fa-envelope').addClass('userIcon-' + selected.module);\n\t\t\t\t\t\tparticipantsContent.append(participantRow);\n\t\t\t\t\t});\n\t\t\t\t}else{\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\ttext: app.vtranslate('JS_DUPLICATE_RECORD') + ': ' + selected.fullLabel,\n\t\t\t\t\t\ttype: 'info'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tclose: (event, ui) => {\n\t\t\t\tparticipantsSearch.val('');\n\t\t\t}\n\n\t\t});\n\t},\n\t/**\n\t * Function validate is holiday day\n\t * @param {jQuery} form\n\t * @returns {boolean}\n\t */\n\tvalidateHolidayDate(form) {\n\t\tlet fields = form.find('[name=\"date_start\"], [name=\"due_date\"]'),\n\t\t\tisHoliday = false,\n\t\t\tfieldHolidayArray = [],\n\t\t\taDeferred = $.Deferred();\n\t\t$.each(fields, function (index, fieldObj) {\n\t\t\tfieldHolidayArray.push(fieldObj.value);\n\t\t});\n\t\tAppConnector.request({\n\t\t\tasync: false,\n\t\t\tdata: {\n\t\t\t\tmodule: form.find('[name=\"module\"]').length ? form.find('[name=\"module\"]').val() : app.getModuleName(),\n\t\t\t\taction: 'Fields',\n\t\t\t\tmode: 'verifyIsHolidayDate',\n\t\t\t\tfieldName: 'date_start',\n\t\t\t\tdate: fieldHolidayArray\n\t\t\t}\n\t\t}).done(function (data) {\n\t\t\tif (true === data.success && true === data.result.isHolidayDate) {\n\t\t\t\tisHoliday = true;\n\t\t\t}\n\t\t\taDeferred.resolve(isHoliday);\n\t\t}).fail(function (error) {\n\t\t\taDeferred.reject(false);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\t/**\n\t * Register pre save event\n\t * @param {jQuery} form\n\t */\n\tregisterRecordPreSaveEventEvent: function (form) {\n\t\tconst self = this;\n\t\tlet lockSave = true;\n\t\tform.on(Vtiger_Edit_Js.recordPreSave, function (e, data) {\n\t\t\tself.validateHolidayDate(form).done(function (isHoliday) {\n\t\t\t\tif (lockSave && isHoliday) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tapp.showConfirmModal(app.vtranslate(\"JS_DATES_SELECTED_HOLIDAYS\"), function () {\n\t\t\t\t\t\tlockSave = false;\n\t\t\t\t\t\tform.submit();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\tregisterRow(row) {\n\t\trow.on(\"click\", '.js-participant-remove', (e) => {\n\t\t\t$(e.target).closest('.js-participant-row').remove();\n\t\t});\n\t},\n\tregisterEvents() {\n\t\tif (!this.proceedRegisterEvents()) {\n\t\t\treturn;\n\t\t}\n\t\tthis.registerReminderFieldCheckBox();\n\t\tthis.registerRecurrenceFieldCheckBox();\n\t\tthis.registerFormSubmitEvent();\n\t\tthis.registerRecurringTypeChangeEvent();\n\t\tthis.registerInviteEvent(this.getForm());\n\t\tthis.registerAddInvitation();\n\t\tthis._super();\n\t}\n});\n"],"names":["Vtiger_Edit_Js","field","rules","i","options","Calendar_Edit_Js","currencyInstance","emailExists","val","app","vtranslate","this","element","getForm","find","on","e","rowElement","closest","is","removeClass","addClass","change","form","repeatUI","container","$","currentTarget","attr","removeAttr","thisInstance","changeRecurringTypesUIStyles","jQuery","value","recurringType","getFreeTime","dateStartElement","startTimeElement","endTimeElement","endDateElement","startDate","startTime","Vtiger_Time_Validator_Js","invokeValidation","startDateTime","dateFormat","data","toUpperCase","timeFormat","activityType","activityDurations","JSON","parse","minutes","activitytype","parseInt","duration","defaultTimeFormat","endDate","moment","add","format","setDefaultEndTime","start","getDateInstance","end","CONFIG","trigger","Fields","Date","register","forceChange","Event","which","keyCode","timeElement","timeDateElement","dueDateElement","Vtiger_Date_Validator_Js","freq","rule","endValue","date","getDateInDBInsertFormat","replace","checkedElements","each","push","length","join","dayOfWeek","Vtiger_Helper_Js","getDay","dayOfMonth","getDate","dayOfWeekLabel","lockSave","getRecordId","recordPreSave","preventDefault","showModalWindow","clone","hideModalWindow","submit","getRule","rows","invitees","index","domElement","row","appendTo","stringify","timeStart","timeEnd","dateStart","ownerId","params","progress","progressIndicator","position","blockInfo","enabled","request","done","mode","result","date_start","time_start","time_end","showPnotify","prop","allDay","dateEnd","autoFill","clockpicker","registerEventForClockPicker","hasClass","remove","append","_super","toggleTimesInputs","registerTimesInputs","registerTimeStartChangeEvent","registerActivityTypeChangeEvent","registerEndDateTimeChangeLogger","registerAutoFillHours","registerMarkAsCompletedBtn","checkboxIsChecked","hide","show","type","startDateElement","endTime","email","toLowerCase","recordExist","progressIndicatorElement","nameAttendee","participantsContent","_this","formEmail","validationEngine","validationEngineOptions","participantRow","text","editViewForm","registerRow","participantsSearch","widget","ui","autocomplete","menu","ul","items","that","currentCategory","item","category","_renderItemData","_renderItem","html","label","ivAutocomplete","response","term","reponseDataList","event","selected","id","getEmailFromRecord","module","fullLabel","fields","isHoliday","fieldHolidayArray","aDeferred","Deferred","fieldObj","getModuleName","success","isHolidayDate","resolve","fail","error","reject","promise","self","validateHolidayDate","showConfirmModal","target","proceedRegisterEvents","registerReminderFieldCheckBox","registerRecurrenceFieldCheckBox","registerFormSubmitEvent","registerRecurringTypeChangeEvent","registerInviteEvent","registerAddInvitation"],"mappings":"aAWAA,eAAe,mBAAoB,mBAChB,sBACPC,MAAOC,MAAOC,EAAGC,gBACxBC,iBAAiBC,iBAAiBC,YAAYN,MAAMO,QAC/CC,IAAIC,WAAW,uBAAyB,KAAOT,MAAMO,QAI5D,kCAEgBF,iBAAmBK,oCAEN,eAC1BC,QAAUD,KAAKE,UAAUC,KAAK,uCAC1BC,GAAG,UAAU,SAAUC,OAC1BC,WAAaL,QAAQM,QAAQ,8BAA8BJ,KAAK,0BAChEF,QAAQO,GAAG,uBACHC,YAAY,qBAEZC,SAAS,qBAGdC,0CAKwB,eAC1BC,KAAOZ,KAAKE,UACjBD,QAAUW,KAAKT,KAAK,iCACbC,GAAG,UAAU,SAAUC,OAC1BQ,SAAWD,KAAKT,KAAK,iBACxBW,UAAYF,KAAKT,KAAK,qBAAqBI,QAAQ,eAChDQ,EAAEV,EAAEW,eAAeR,GAAG,sBAChBD,QAAQ,aAAaE,YAAY,oBAChCN,KAAK,6BAA6Bc,KAAK,WAAY,sBACnDd,KAAK,UAAUc,KAAK,WAAY,wBAEhCd,KAAK,6BAA6Be,WAAW,sBAC7Cf,KAAK,UAAUe,WAAW,qBAC3BX,QAAQ,aAAaG,SAAS,sBAGjCC,2CAKyB,eAC7BG,UAAYd,KAAKE,UACjBiB,aAAenB,eACTG,KAAK,kBAAkBC,GAAG,UAAU,SAAUC,gBAC1Ce,6BAA6BC,OAAOhB,EAAEW,eAAenB,oBAEzDM,KAAK,0CAA0CC,GAAG,UAAU,SAAUC,OAE3EiB,MADgBP,EAAEV,EAAEW,eACEnB,MACZ,UAAVyB,iBACOnB,KAAK,gBAAgBc,KAAK,WAAY,sBACtCd,KAAK,kBAAkBc,KAAK,WAAY,aAC9B,UAAVK,iBACAnB,KAAK,gBAAgBe,WAAW,sBAChCf,KAAK,kBAAkBc,KAAK,WAAY,aAC9B,UAAVK,kBACAnB,KAAK,gBAAgBc,KAAK,WAAY,sBACtCd,KAAK,kBAAkBe,WAAW,8CAQjB,SAAUK,mBACnCT,UAAYd,KAAKE,UACA,SAAjBqB,eAA6C,UAAjBA,yBACrBpB,KAAK,iBAAiBM,YAAY,QAAQC,SAAS,oBACnDP,KAAK,kBAAkBM,YAAY,QAAQC,SAAS,WACnC,UAAjBa,yBACApB,KAAK,iBAAiBM,YAAY,UAAUC,SAAS,kBACrDP,KAAK,kBAAkBM,YAAY,QAAQC,SAAS,WACnC,WAAjBa,0BACApB,KAAK,iBAAiBM,YAAY,QAAQC,SAAS,oBACnDP,KAAK,kBAAkBM,YAAY,UAAUC,SAAS,4BAG/C,SAAUI,cAExBA,UAAUX,KAAK,gBAAgBK,GAAG,YADzBR,KAEPwB,YAAYV,eACX,IACF,MAAQC,EAAE,mCAAmClB,iBAG7C4B,iBAAmBX,UAAUX,KAAK,uBACrCuB,iBAAmBZ,UAAUX,KAAK,uBAClCwB,eAAiBb,UAAUX,KAAK,qBAChCyB,eAAiBd,UAAUX,KAAK,qBAChC0B,UAAYJ,iBAAiB5B,MAC7BiC,UAAYJ,iBAAiB7B,UAE1B,IADMkC,yBAAyBC,iBAAiBN,6BAIhDO,cAAgBJ,UAAY,IAAMC,UACrCI,WAAapB,UAAUX,KAAK,qBAAqBgC,KAAK,cAAcC,cACpEC,WAAaV,eAAeQ,KAAK,UACjCG,aAAexB,UAAUX,KAAK,yBAAyBN,MACvD0C,kBAAoBC,KAAKC,MAAM3B,UAAUX,KAAK,sCAAsCN,OACpF6C,QAAU,MACN,IAAIlD,KAAK+C,qBACTA,kBAAkB/C,GAAGmD,eAAiBL,aAAc,SAC7CM,SAASL,kBAAkB/C,GAAGqD,oBAItCC,kBAAoB,QACpB,KAAOT,+BACU,eAEjBU,QAAUC,OAAOf,cAAeC,WAAa,IAAMY,mBAAmBG,IAAIP,QAAS,0BACxE7C,IAAIkD,QAAQG,OAAOhB,4BACnBrC,IAAIkD,QAAQG,OAAOJ,sDAMH,SAAUhC,eACpCK,aAAenB,eACXI,GAAG,SAAU,yBAAyB,SAAUC,gBAC5C8C,kBAAkBrC,qDAMJA,eACtBK,aAAenB,eACXG,KAAK,4BAA4BC,GAAG,UAAU,SAAUC,gBACpD8C,kBAAkBrC,wBAEtBX,KAAK,uBAAuBC,GAAG,UAAU,SAAUC,OACxDuB,eAAiBd,UAAUX,KAAK,qBACnCiD,MAAQjC,aAAakC,gBAAgBvC,UAAW,SAChDwC,IAAMnC,aAAakC,gBAAgBvC,UAAW,OAC9CoB,WAAaqB,OAAOrB,WAAWE,wBACtBjC,KAAK,gBAAgBqD,QAAQ,UACnCJ,MAAQE,UACLF,qBACSvD,IAAImD,OAAOM,KAAKJ,OAAOhB,iBAClCuB,OAAOC,KAAKC,SAAS7C,yBAGjBX,KAAK,4BAA4BC,GAAG,SAAS,SAAUC,OAC5DJ,QAAUc,EAAEV,EAAEW,uBACVmB,KAAK,YAAalC,QAAQJ,oBAEzBM,KAAK,4BAA4BC,GAAG,QAAQ,SAAUC,EAAG8B,WAC9C,IAATA,YACH,SAEwB,IAArBA,KAAKyB,mBACVA,aAAc,OAEhB3D,QAAUc,EAAEV,EAAEW,gBACdf,QAAQJ,QAAUI,QAAQkC,KAAK,cAAgBA,KAAKyB,kBACnD7C,EAAE8C,MAAM,YACVC,MAAQ,KACRC,QAAU,WACJP,QAAQnD,wCAIc,SAAUS,qBAChCX,KAAK,qBAAqBC,GAAG,UAAU,SAAUC,OACtD2D,YAAc3C,OAAOhB,EAAEW,kBAEb,GADDe,yBAAyBC,iBAAiBgC,kBAInDC,gBAAkBD,YAAYzD,QAAQ,eAAeJ,KAAK,4BACvD,mCAAmCN,IAAI,qBAC9BsC,KAAK,mBAAmB,iBAG/BhC,KAAK,qBAAqBC,GAAG,UAAU,SAAUC,OACtD6D,eAAiB7C,OAAOhB,EAAEW,eAEhB,GADDmD,yBAAyBnC,iBAAiBkC,yBAIhD,mCAAmCrE,IAAI,oBAC/BsC,KAAK,mBAAmB,gBAOhC,eACJvB,KAAOZ,KAAKE,UACZkE,KAAOxD,KAAKT,KAAK,kBAAkBN,MACnCwE,KAAO,QAAUD,WACb,aAAexD,KAAKT,KAAK,oBAAoBN,UACjDyE,SAAW1D,KAAKT,KAAK,kDAAkDN,SAC1D,UAAbyE,eACK,UAAY1D,KAAKT,KAAK,gBAAgBN,WACxC,GAAiB,UAAbyE,SAAsB,KAC5BC,KAAO3D,KAAKT,KAAK,kBAAkBN,YAE/B,gBADDC,IAAI0E,wBAAwBjB,OAAOrB,WAAYqC,OAC7BE,QAAQ,MAAO,IAAM,aAElC,WAATL,KAAmB,KAClBM,gBAAkB,QACjBvE,KAAK,mCAAmCwE,MAAK,eAC7C3D,cAAgBD,EAAEf,MAClBgB,cAAcR,GAAG,6BACJoE,KAAK5D,cAAcnB,UAGjC6E,gBAAgBG,OAAS,UACpB,UAAYH,gBAAgBI,KAAK,SAG9B,YAATV,KAAoB,KACnBW,UAAYC,iBAAiBC,OAAOrE,KAAKT,KAAK,uBAAuBN,OAErEqF,WADeF,iBAAiB3B,gBAAgBzC,KAAKT,KAAK,uBAAuBN,MAAO0D,OAAOrB,YACrEiD,aAEhB,OADDvE,KAAKT,KAAK,+BAA+BN,MACjC,KAChBuF,eAAiB,UACbL,gBACF,iBACa,gBAEb,iBACa,gBAEb,iBACa,gBAEb,iBACa,gBAEb,iBACa,gBAEb,iBACa,gBAEb,iBACa,WAGX,WAAanC,UAAUsC,WAAa,GAAK,GAAK,GAAKE,0BAEnD,eAAiBF,kBAGpBb,8BAKiB,eACpBlD,aAAenB,KACfY,KAAOZ,KAAKE,UACZmF,UAAW,EACXvF,IAAIwF,oBACFlF,GAAGf,eAAekG,eAAe,SAAUlF,GAC3CgF,UAAYzE,KAAKT,KAAK,yBAAyBK,GAAG,gBACnDgF,qBACEC,gBAAgB7E,KAAKT,KAAK,oBAAoBuF,SAAS,SAAU5E,qBAC1DX,KAAK,kBAAkBC,GAAG,SAAS,SAAUC,OAClDW,cAAgBD,EAAEV,EAAEW,oBACnBb,KAAK,uBAAuBN,IAAImB,cAAcmB,KAAK,cACpDwD,4BACO,OACNC,wBAMLxF,GAAG,UAAU,SAAUC,GACJO,KAAKT,KAAK,yBAAyBK,GAAG,cAExDV,IAAIwF,eAAiBD,YACtBG,sBAEErF,KAAK,uBAAuBN,IAAIsB,aAAa0E,gBAE/CC,KAAOlF,KAAKT,KAAK,gDACjB4F,SAAW,QACVpB,MAAK,SAAUqB,MAAOC,gBACtBC,IAAMnF,EAAEkF,YACRC,IAAI/D,KAAK,mBACHyC,KAAK,CAACsB,IAAI/D,KAAK,SAAU+D,IAAI/D,KAAK,SAAU+D,IAAI/D,KAAK,QAAS+D,IAAI/D,KAAK,eAGhF,6CAA6CgE,SAASvF,MAAMf,IAAI2C,KAAK4D,UAAUL,2BAGtE,SAAUjF,eAClBuF,UAAYvF,UAAUX,KAAK,yDAC3BmG,QAAUxF,UAAUX,KAAK,qDACzBoG,UAAYzF,UAAUX,KAAK,yDAC3BqG,QAAU1F,UAAUX,KAAK,qEACzBsG,OAAS,QACJ,kBACA,wBACGF,UAAU1G,cACZ2G,QAAQ3G,mBACHiB,UAAUX,KAAK,yBAAyBN,OAEnD6G,SAAW3F,EAAE4F,kBAAkB,CAACC,SAAU,OAAQC,UAAW,CAACC,SAAS,kBAC9DC,QAAQN,QAAQO,MAAK,SAAU7E,eAClCwE,kBAAkB,CAACM,KAAM,SACH,OAA3B9E,KAAK+E,OAAOC,sBACLtH,IAAIsC,KAAK+E,OAAOE,oBAClBvH,IAAIsC,KAAK+E,OAAOG,oBACdxH,IAAIsC,KAAK+E,OAAOC,sBAChBhH,KAAK,qBAAqBN,IAAIsC,KAAK+E,OAAOC,+BAEnCG,YAAYxH,IAAIC,WAAW,iCAClCI,KAAK,gBAAgBoH,KAAK,WAAW,GAAO/D,QAAQ,qCAI1C,SAAU1C,eAC1BK,aAAenB,KACjBwH,OAAS1G,UAAUX,KAAK,mBAC3BkG,UAAYvF,UAAUX,KAAK,uBAC3BmG,QAAUxF,UAAUX,KAAK,qBACzBsH,QAAU3G,UAAUX,KAAK,qBACzBuH,SAAW5G,UAAUX,KAAK,0BACjBA,KAAK,sBAAsBC,GAAG,SAAS,SAAUC,GACtDqH,SAASlH,GAAG,eACbH,EAAEW,eAAeT,QAAQ,qBAAqBE,YAAY,qBAAqBA,YAAY,uBACpF8G,KAAK,WAAW,GAAO/D,QAAQ,cAEtCnD,EAAEW,eAAeT,QAAQ,qBAAqBG,SAAS,qBAAqBA,SAAS,uBAC9E6G,KAAK,WAAW,GAAM/D,QAAQ,wBAG/BrD,KAAK,gBAAgBC,GAAG,UAAU,SAAUC,GACjCU,EAAEV,EAAEW,eACNR,GAAG,uBACVL,KAAK,gBAAgBoH,KAAK,WAAW,gBAClC/F,YAAYV,qBACfG,KAAK,WAAY,oBACnBA,KAAK,WAAY,sBACf0G,YAAY,kBACdA,YAAY,iBACb1G,KAAK,WAAY,mBACjBsG,KAAK,WAAW,UAChB/D,QAAQ,kBACPvC,KAAK,WAAY,wBAEfd,KAAK,gBAAgBoH,KAAK,WAAW,UACxCrG,WAAW,sBACRA,WAAW,oBACbA,WAAW,oBACXA,WAAW,gBACf0G,4BAA4BvB,eAC5BuB,4BAA4BtB,yCAIP,SAAUxF,qBAC3BX,KAAK,8BAA8BC,GAAG,SAAS,WAC3CW,EAAEf,MACN6H,SAAS,oBACP1H,KAAK,iBAAiB2H,mBAEtBC,OAAO,iIAIC,SAAUjH,gBACzBkH,OAAOlH,gBACPmH,kBAAkBnH,gBAClBoH,oBAAoBpH,gBACpBqH,6BAA6BrH,gBAC7BsH,gCAAgCtH,gBAChCuH,gCAAgCvH,gBAChCwH,sBAAsBxH,gBACtByH,2BAA2BzH,8BAEd,SAAUA,qBAClBX,KAAK,aAAaC,GAAG,UAAU,cAEpC,UADeW,EAAEf,MAAMiB,KAAK,QACF,KACzBuH,kBAAoBzH,EAAEf,MAAMQ,GAAG,YAC9BM,UAAUX,KAAK,gBAAgB0E,SAC/B2D,4BACOrI,KAAK,SAASsI,iBAEdtI,KAAK,SAASuI,iCAMR,SAAU5H,WACjBA,UAAUX,KAAK,4BACjBoH,KAAK,sBACLpH,KAAK,SAASsI,wBAIT,SAAU3H,UAAW6H,UACjCC,iBAAmB9H,UAAUX,KAAK,uBAClCyB,eAAiBd,UAAUX,KAAK,qBAChCwB,eAAiBb,UAAUX,KAAK,qBAChCuB,iBAAmBZ,UAAUX,KAAK,uBAClC0B,UAAY+G,iBAAiB/I,MAC7BiC,UAAYJ,iBAAiB7B,MAC7BgJ,QAAUlH,eAAe9B,MACzBkD,QAAUnB,eAAe/B,MACzBqC,WAAaqB,OAAOrB,iBACZ,SAARyG,KACI3D,iBAAiB3B,gBAAgBxB,UAAY,IAAMC,UAAWI,YAE1D,OAARyG,KACI3D,iBAAiB3B,gBAAgBN,QAAU,IAAM8F,QAAS3G,yCAGvD4G,aACHA,MAAMC,kBACVC,aAAc,cACb9I,UAAUC,KAAK,4BAA4BA,KAAK,uBAAuBwE,MAAK,SAACqB,MAAO/F,YACpFc,EAAEd,SAASkC,KAAK,SAAS4G,gBAAkBD,0BAChC,GACP,KAGFE,kEAGF9I,UAAUC,KAAK,0BAA0BC,GAAG,SAAS,SAACC,OACtD4I,yBAA2BlI,EAAE4F,wBAC7BlB,gBAAgB,KAAM,8CAA8C,SAACtD,WACnEhC,KAAK,mBAAmBC,GAAG,SAAS,SAACC,OACrCyI,MAAQ3G,KAAKhC,KAAK,0BAA0BN,MAC5CqJ,aAAe/G,KAAKhC,KAAK,yBAAyBN,MAClDsJ,oBAAsBC,MAAKlJ,UAAUC,KAAK,4BAC1CkJ,UAAYlH,KAAKhC,KAAK,yBAChBmJ,iBAAiBxJ,IAAIyJ,yBAC3BF,UAAUC,iBAAiB,YAAa,KACvCE,eAAiBL,oBAAoBhJ,KAAK,+BAA+BuF,OAAM,GAAM,kBAC1EvD,KAAK,QAAS,kBACdA,KAAK,QAAS2G,OACzBI,6BACY/I,KAAK,wBAAwBgC,KAAK,UAAW+G,cAAcO,KAAKP,6BAChE/G,KAAK,OAAQ+G,+BAEb/I,KAAK,wBAAwBgC,KAAK,UAAW2G,OAAOW,KAAKX,sBACzD3G,KAAK,OAAQ,yBAET4F,OAAOyB,oBACvB7D,+CAGmBgB,kBAAkB,CAACM,KAAQ,oCAIlC,SAAUyC,mBACzBC,YAAYD,kBACbP,oBAAsBO,aAAavJ,KAAK,4BACxCyJ,mBAAqBF,aAAavJ,KAAK,6BACzC0J,OAAO,wBAAyB9I,EAAE+I,GAAGC,aAAc,SAC3C,gBACH/B,cACA6B,SAASG,KAAK,SAAU,QAAS,kDAE1B,SAAUC,GAAIC,WACtBC,KAAOnK,KAAMoK,gBAAkB,KACjCzF,KAAKuF,OAAO,SAAUlE,MAAOqE,MAC1BA,KAAKC,UAAYF,qBACjBrC,OAAO,wCAA0CsC,KAAKC,SAAW,yBAClDD,KAAKC,eAEnBC,gBAAgBN,GAAII,0BAGV,SAAUJ,GAAII,aACvBrK,KAAKwK,YAAYP,GAAII,MAAMlI,KAAK,uBAAwBkI,mBAEnD,SAAUJ,GAAII,aACnBtJ,EAAE,QACPoB,KAAK,oBAAqBkI,MAC1BtC,OAAOhH,EAAE,WAAW0J,KAAKJ,KAAKK,QAC9BvE,SAAS8D,0BAGMU,eAAe,OAC1B,gBACI,WACH,SAAC5D,QAAS6D,uBACJ7D,QAAQ,QACZ,kBACA,gBACF,aACCA,QAAQ8D,OACb7D,MAAK,SAACE,YACJ4D,gBAAkB5D,OAAOA,OACzB4D,gBAAgBjG,QAAU,mBACbD,KAAK,OACb9E,IAAIC,WAAW,4BAChB,sBACI,cAGH+K,4BAGH,SAACC,MAAOjB,QACXkB,SAAWlB,GAAGO,aAEW,IAAlBW,SAASrC,MAAyC,cAAjBqC,SAASrC,YAC7C,MAEJK,aAAc,yBACE7I,KAAK,uBAAuBwE,MAAK,SAAUqB,OAC1DjF,EAAEf,MAAMmC,KAAK,UAAY6I,SAASC,kBACvB,MAGZjC,YAAa,KACZQ,eAAiBL,oBAAoBhJ,KAAK,+BAA+BuF,OAAM,GAAM,mBACzEwF,mBAAmBF,SAASC,GAAID,SAASG,QAAQnE,MAAK,SAAC8B,sBACvD3G,KAAK,QAAS6I,SAASC,mBACvB9I,KAAK,QAAS2G,sBACd3I,KAAK,wBAAwBgC,KAAK,UAAW6I,SAASI,UAAYtC,OAAOW,KAAKuB,SAASN,sBACvFvK,KAAK,uCAAuCM,YAAY,mBAAmBC,SAAS,YAAcsK,SAASG,4BACtGpD,OAAOyB,yCAGXlC,YAAY,MACtBxH,IAAIC,WAAW,uBAAyB,KAAOiL,SAASI,eACxD,gBAIF,SAACL,MAAOjB,uBACKjK,IAAI,qCAUNe,UACfyK,OAASzK,KAAKT,KAAK,0CACtBmL,WAAY,EACZC,kBAAoB,GACpBC,UAAYzK,EAAE0K,oBACb9G,KAAK0G,QAAQ,SAAUrF,MAAO0F,4BACb9G,KAAK8G,SAASpK,uBAEpByF,QAAQ,QACb,OACD,QACGnG,KAAKT,KAAK,mBAAmB0E,OAASjE,KAAKT,KAAK,mBAAmBN,MAAQC,IAAI6L,uBAC/E,cACF,gCACK,kBACLJ,qBAELvE,MAAK,SAAU7E,OACb,IAASA,KAAKyJ,UAAW,IAASzJ,KAAK+E,OAAO2E,2BACrC,aAEHC,QAAQR,cAChBS,MAAK,SAAUC,iBACPC,QAAO,MAEXT,UAAUU,2CAMe,SAAUtL,UACpCuL,KAAOnM,KACTqF,UAAW,OACVjF,GAAGf,eAAekG,eAAe,SAAUlF,EAAG8B,WAC7CiK,oBAAoBxL,MAAMoG,MAAK,SAAUsE,WACzCjG,UAAYiG,cACb9F,qBACE6G,iBAAiBvM,IAAIC,WAAW,+BAA+B,qBACvD,OACN6F,yCAMEM,SACP9F,GAAG,QAAS,0BAA0B,SAACC,KACxCA,EAAEiM,QAAQ/L,QAAQ,uBAAuBuH,uCAIvC9H,KAAKuM,+BAGLC,qCACAC,uCACAC,+BACAC,wCACAC,oBAAoB5M,KAAKE,gBACzB2M,6BACA7E"}