{"version":3,"file":"CalendarQuickCreate.min.js","sources":["CalendarQuickCreate.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n/**\n *  Class representing a modal calendar.\n * @extends Calendar_Calendar_Js\n */\nwindow.Calendar_CalendarQuickCreate_Js = class Calendar_CalendarQuickCreate_Js extends Calendar_Calendar_Js {\n\tconstructor(container, readonly) {\n\t\tsuper(container, readonly);\n\t\tthis.isSwitchAllDays = false;\n\t\tthis.sidebarName = 'add'; //available: add, status, edit\n\t\tthis.eventCreate = false;\n\t\tthis.module = 'Calendar';\n\t\tthis.renderCalendar();\n\t\tthis.registerEvents();\n\t}\n\t/**\n\t * Function sets calendar module's options\n\t * @returns {{eventClick: function, headerToolbar: object, selectable: boolean}}\n\t */\n\tsetCalendarModuleOptions() {\n\t\tlet options = super.setCalendarModuleOptions();\n\t\toptions.selectable = true;\n\t\toptions.headerToolbar = {\n\t\t\tleft: `dayGridMonth,${app.getMainParams('weekView')},${app.getMainParams('dayView')},today`,\n\t\t\tcenter: 'prevYear,prev,title,next,nextYear',\n\t\t\tright: ''\n\t\t};\n\t\toptions.eventClick = function (info) {\n\t\t\tinfo.jsEvent.preventDefault();\n\t\t};\n\t\treturn options;\n\t}\n\t/**\n\t * Get selected users\n\t * @returns {{ selectedIds: array, excludedIds: array }}\n\t */\n\tgetSelectedUsersCalendar() {\n\t\treturn { selectedIds: [this.container.find('.assigned_user_id').val()], excludedIds: [] };\n\t}\n\t/**\n\t * Function registers calendar events\n\t */\n\tregisterEvents() {\n\t\tconst calendarView = this.getCalendarView();\n\t\tthis.switchContainer = $(`<div class=\"js-calendar-switch-container\"></div>`).insertAfter(\n\t\t\tcalendarView.find('.fc-center')\n\t\t);\n\t\tthis.registerSwitchEvents();\n\t\tthis.registerUsersChange();\n\t\tthis.registerAutofillTime();\n\t\tthis.registerPopoverButtonsClickEvent();\n\t}\n\t/**\n\t * Function registers calendar switch event\n\t */\n\tregisterSwitchEvents() {\n\t\tif (app.getMainParams('hiddenDays', true) !== false) {\n\t\t\tthis.switchContainer.html(this.createSwitch());\n\t\t\tthis.switchContainer.find('input').on('change', (e) => {\n\t\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\t\tlet hiddenDays = [];\n\t\t\t\tif (typeof currentTarget.data('on-text') !== 'undefined') {\n\t\t\t\t\thiddenDays = app.getMainParams('hiddenDays', true);\n\t\t\t\t\tthis.isSwitchAllDays = false;\n\t\t\t\t} else {\n\t\t\t\t\tthis.isSwitchAllDays = true;\n\t\t\t\t}\n\t\t\t\tthis.fullCalendar.setOption('hiddenDays', hiddenDays);\n\t\t\t\tthis.registerSwitchEvents();\n\t\t\t});\n\t\t}\n\t}\n\t/**\n\t * Generate filter buttons\n\t * @returns {string}\n\t */\n\tcreateSwitch() {\n\t\tlet on = app.vtranslate('JS_WORK_DAYS'),\n\t\t\toff = app.vtranslate('JS_ALL'),\n\t\t\tstate = this.isSwitchAllDays;\n\t\treturn `<div class=\"btn-group btn-group-toggle js-switch c-calendar-switch\" data-toggle=\"buttons\">\n\t\t\t\t\t<label class=\"btn btn-outline-primary c-calendar-switch__button js-switch--label-on ${state ? '' : 'active'}\">\n\t\t\t\t\t\t<input type=\"radio\" name=\"options\" data-on-text=\"${on}\" autocomplete=\"off\" ${state ? '' : 'checked'}>${on}\n\t\t\t\t\t</label>\n\t\t\t\t\t<label class=\"btn btn-outline-primary c-calendar-switch__button ${state ? 'active' : ''}\">\n\t\t\t\t\t\t<input type=\"radio\" name=\"options\" data-off-text=\"${off}\" autocomplete=\"off\" ${state ? 'checked' : ''}>${off}\n\t\t\t\t\t</label>\n\t\t\t\t</div>`;\n\t}\n\t/**\n\t * Function registers select's user change event\n\t */\n\tregisterUsersChange() {\n\t\tthis.container.find('.assigned_user_id').on('change', () => {\n\t\t\tthis.reloadCalendarData();\n\t\t});\n\t}\n\t/**\n\t * Function invokes by FullCalendar, sets selected days in form\n\t * @param {Object} info\n\t * @returns\n\t */\n\tselectDays(info) {\n\t\tif (this.sidebarName === 'status') {\n\t\t\tthis.sidebarName = 'add';\n\t\t\tthis.getCalendarCreateView().done(() => {\n\t\t\t\tthis.selectDays(info);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tthis.selectCallbackCreateModal(this.container, info);\n\t}\n\n\t/** @inheritdoc */\n\tregisterEditForm(sideBar) {\n\t\tlet editViewInstance = Vtiger_Edit_Js.getInstanceByModuleName(sideBar.find('[name=\"module\"]').val()),\n\t\t\tparams = [];\n\t\tlet rightFormCreate = sideBar.find('form.js-form');\n\t\teditViewInstance.registerBasicEvents(rightFormCreate);\n\t\trightFormCreate.validationEngine(app.validationEngineOptions);\n\t\tApp.Fields.Picklist.showSelect2ElementView(sideBar.find('select'));\n\t\tsideBar.find('.js-summary-close-edit').on('click', () => {\n\t\t\tthis.getCalendarCreateView();\n\t\t});\n\t\tApp.Components.QuickCreate.registerPostLoadEvents(rightFormCreate, params);\n\t\tApp.Fields.Text.Editor.register(sideBar.find('.js-editor'), { height: '5em', toolbar: 'Min' });\n\t}\n\n\t/** @inheritdoc */\n\tupdateSidebar(sidebar, data) {\n\t\tconst modalTitleContainer = $('.js-modal-title__container'),\n\t\t\tmodalTitles = modalTitleContainer.find('[class*=\"js-modal-title\"]');\n\t\tdata = $(data);\n\n\t\tmodalTitles.addClass('d-none');\n\t\tif (data.hasClass('js-edit-form')) {\n\t\t\tlet title = data.find('.js-sidebar-title ').data('title');\n\t\t\tmodalTitles.filter(`.js-modal-title--${title}`).removeClass('d-none');\n\t\t\tthis.sidebarName = title;\n\t\t} else if (data.hasClass('js-activity-state')) {\n\t\t\tmodalTitles.filter('.js-modal-title--status').removeClass('d-none');\n\t\t\tthis.sidebarName = 'status';\n\t\t}\n\t\tsidebar.find('.js-qc-form').html(data);\n\t}\n};\n\njQuery.Class(\n\t'Calendar_QuickCreate_Js',\n\t{},\n\t{\n\t\tregisterEvents: function (container) {\n\t\t\tnew Calendar_CalendarQuickCreate_Js(container.closest('.js-modal-container'), true);\n\t\t\tcontainer.find('.js-activity-buttons button').on('click', function (e) {\n\t\t\t\tlet form = container.find('form');\n\t\t\t\tlet currentTarget = $(e.currentTarget);\n\t\t\t\tif (1 === currentTarget.data('type')) {\n\t\t\t\t\tform.append('<input type=hidden name=\"activitystatus\" value=\"' + currentTarget.data('state') + '\">');\n\t\t\t\t\tform.submit();\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.find('.js-activity-buttons').remove();\n\t\t\t\t\tform.find('[name=\"record\"]').val('');\n\t\t\t\t\tform.append('<input type=hidden name=\"postponed\" value=\"true\">');\n\t\t\t\t\tform.append('<input type=hidden name=\"followup\" value=\"' + currentTarget.data('id') + '\">');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n);\n"],"names":["window","Calendar_CalendarQuickCreate_Js","container","readonly","isSwitchAllDays","sidebarName","eventCreate","module","renderCalendar","registerEvents","selectable","options","headerToolbar","left","app","getMainParams","center","right","eventClick","info","jsEvent","preventDefault","selectedIds","find","val","excludedIds","getCalendarView","switchContainer","$","insertAfter","calendarView","registerSwitchEvents","registerUsersChange","registerAutofillTime","registerPopoverButtonsClickEvent","html","createSwitch","on","e","currentTarget","hiddenDays","data","fullCalendar","setOption","vtranslate","off","state","reloadCalendarData","getCalendarCreateView","done","selectDays","selectCallbackCreateModal","sideBar","editViewInstance","Vtiger_Edit_Js","getInstanceByModuleName","rightFormCreate","registerBasicEvents","validationEngine","validationEngineOptions","App","Fields","Picklist","showSelect2ElementView","Components","QuickCreate","registerPostLoadEvents","Text","Editor","register","height","toolbar","sidebar","modalTitles","modalTitleContainer","addClass","hasClass","filter","title","removeClass","Calendar_Calendar_Js","jQuery","Class","closest","form","append","submit","remove"],"mappings":";;AAAA,kKACA,YAAY,CAEZ;AACA;AACA;AACA,GAHA,usGAIAA,MAAM,CAACC,+BAA+B,cACrC,SAAA,qBAAA,CAAA,CAAA,SAAA,+BAAA,CAAYC,SAAS,CAAEC,QAAQ,CAAE,CAAA,IAAA,KAAA,CAAA,OAAA,eAAA,CAAA,IAAA,CAAA,+BAAA,CAAA,CAAA,KAAA,CAAA,MAAA,CAAA,IAAA,CAAA,IAAA,CAC1BD,SAAS,CAAEC,QAAQ,EACzB,KAAKC,CAAAA,eAAe,GAAQ,CAC5B,KAAA,CAAKC,WAAW,CAAG,KAAK,CACxB,KAAA,CAAKC,WAAW,CAAQ,CAAA,CAAA,CACxB,MAAKC,MAAM,CAAG,UAAU,CACxB,KAAA,CAAKC,cAAc,EAAE,CACrB,MAAKC,cAAc,EAAE,MACtB,CACA;AACD;AACA;AACA,IAHC,SAIA,CAAA,+BAAA,CAAA,qBAAA,CAAA,CAAA,IAAA,MAAA,CAAA,YAAA,CAAA,+BAAA,CAAA,CAAA,OAAA,YAAA,CAAA,+BAAA,CAAA,CAAA,CAAA,GAAA,CAAA,0BAAA,CAAA,KAAA,CAAA,SAAA,wBAAA,EAA2B,CAC1B,IAAW,OAAA,CAAA,IAAA,CAAA,eAAA,CAAA,+BAAA,CAAA,SAAA,CAAA,CAAA,0BAAA,CAAA,IAAA,CAAA,CAAA,IAAA,CAAA,IAAA,CAAmC,CAU9C,OATO,OAAA,CAACC,UAAU,CAAA,CAAA,CAAO,CACzBC,OAAO,CAACC,aAAa,CAAG,CACvBC,IAAI,CAAA,eAAA,CAAA,MAAA,CAAkBC,GAAG,CAACC,aAAa,CAAC,UAAU,CAAC,CAAID,GAAAA,CAAAA,CAAAA,MAAAA,CAAAA,GAAG,CAACC,aAAa,CAAC,SAAS,CAAC,CAAA,QAAA,CAAQ,CAC3FC,MAAM,CAAE,mCAAmC,CAC3CC,KAAK,CAAE,EACR,CAAC,CACDN,OAAO,CAACO,UAAU,CAAG,SAAUC,IAAI,CAAE,CACpCA,IAAI,CAACC,OAAO,CAACC,cAAc,GAC5B,CAAC,CACMV,OACR,CACA;AACD;AACA;AACA,KAHC,CAAA,CAAA,GAAA,CAAA,0BAAA,CAAA,KAAA,CAIA,SAA2B,wBAAA,EAAA,CAC1B,OAAO,CAAEW,WAAW,CAAE,CAAC,IAAI,CAACpB,SAAS,CAACqB,IAAI,CAAC,mBAAmB,CAAC,CAACC,GAAG,EAAE,CAAC,CAAEC,WAAW,CAAE,EAAG,CACzF,CACA;AACD;AACA,KAFC,CAAA,CAAA,GAAA,CAAA,gBAAA,CAAA,KAAA,CAGA,yBAAiB,CAChB,gBAAkB,CAAG,IAAI,CAACC,eAAe,EAAE,CAC3C,IAAI,CAACC,eAAe,CAAGC,CAAC,sDAAoD,CAACC,WAAW,CACvFC,YAAY,CAACP,IAAI,CAAC,YAAY,CAAC,CAC/B,CACD,IAAI,CAACQ,oBAAoB,EAAE,CAC3B,IAAI,CAACC,mBAAmB,EAAE,CAC1B,IAAI,CAACC,oBAAoB,EAAE,CAC3B,IAAI,CAACC,gCAAgC,GACtC,CACA;AACD;AACA,KAFC,CAAA,CAAA,GAAA,CAAA,sBAAA,CAAA,KAAA,CAGA,+BAAuB,CAClB,IAAA,MAAA,CAAA,IAAA,CAAA,CAAA,CAAA,GAAApB,GAAG,CAACC,aAAa,CAAC,YAAY,CAAiB,CAAA,CAAA,CAAA,GAClD,IAAI,CAACY,eAAe,CAACQ,IAAI,CAAC,IAAI,CAACC,YAAY,EAAE,CAAC,CAC9C,IAAI,CAACT,eAAe,CAACJ,IAAI,CAAC,OAAO,CAAC,CAACc,EAAE,CAAC,QAAQ,CAAE,SAACC,CAAC,CAAK,CAAA,iBACnC,CAAGV,CAAC,CAACU,CAAC,CAACC,aAAa,CAAC,CACpCC,UAAU,CAAG,EAAE,CAC0B,WAAW,EAApD,oBAAoB,CAACC,IAAI,CAAC,SAAS,CAAiB,CAIvD,MAAI,CAACrC,eAAe,GAAO,EAH3BoC,UAAU,CAAG1B,GAAG,CAACC,aAAa,CAAC,YAAY,CAAA,CAAA,CAAA,CAAO,CAClD,MAAI,CAACX,eAAe,CAAQ,CAAA,CAAA,CAAA,CAI7B,MAAI,CAACsC,YAAY,CAACC,SAAS,CAAC,YAAY,CAAEH,UAAU,CAAC,CACrD,MAAI,CAACT,oBAAoB,GAC1B,CAAC,CAAC,EAEJ,CACA;AACD;AACA;AACA,KACC,CAAA,CAAA,GAAA,CAAA,cAAA,CAAA,KAAA,CAAA,SAAA,YAAA,EAAe,CACd,IAAM,EAAA,CAAGjB,GAAG,CAAC8B,UAAU,CAAC,cAAc,CAAC,CACtCC,GAAG,CAAG/B,GAAG,CAAC8B,UAAU,CAAC,QAAQ,CAAC,CAC9BE,KAAK,CAAG,IAAI,CAAC1C,eAAe,CAC7B,OACyF0C,iMAAAA,CAAAA,MAAAA,CAAAA,KAAK,CAAG,EAAE,CAAG,QAAQ,CACvDT,yEAAAA,CAAAA,CAAAA,MAAAA,CAAAA,EAAE,CAAwBS,0BAAAA,CAAAA,CAAAA,MAAAA,CAAAA,KAAK,CAAG,EAAE,CAAG,SAAS,CAAIT,GAAAA,CAAAA,CAAAA,MAAAA,CAAAA,EAAE,CAExCS,mGAAAA,CAAAA,CAAAA,MAAAA,CAAAA,KAAK,CAAG,QAAQ,CAAG,EAAE,CAClCD,0EAAAA,CAAAA,CAAAA,MAAAA,CAAAA,GAAG,CAAwBC,0BAAAA,CAAAA,CAAAA,MAAAA,CAAAA,KAAK,CAAG,SAAS,CAAG,EAAE,CAAID,GAAAA,CAAAA,CAAAA,MAAAA,CAAAA,GAAG,wCAGjH,CACA;AACD;AACA,KAFC,CAAA,CAAA,GAAA,CAAA,qBAAA,CAAA,KAAA,CAGA,SAAsB,mBAAA,EAAA,CAAA,IAAA,MAAA,CAAA,IAAA,CACrB,IAAI,CAAC3C,SAAS,CAACqB,IAAI,CAAC,mBAAmB,CAAC,CAACc,EAAE,CAAC,QAAQ,CAAE,UAAM,CAC3D,MAAI,CAACU,kBAAkB,GACxB,CAAC,EACF,CACA;AACD;AACA;AACA;AACA,KAJC,CAAA,CAAA,GAAA,CAAA,YAAA,CAAA,KAAA,CAKA,oBAAW5B,IAAI,CAAE,wBACS,QAAQ,GAA7B,IAAI,CAACd,WAAwB,EAChC,IAAI,CAACA,WAAW,CAAG,KAAK,CACxB,KAAA,IAAI,CAAC2C,qBAAqB,EAAE,CAACC,IAAI,CAAC,UAAM,CACvC,MAAI,CAACC,UAAU,CAAC/B,IAAI,EACrB,CAAC,CAAC,EAGH,KAAA,IAAI,CAACgC,yBAAyB,CAAC,IAAI,CAACjD,SAAS,CAAEiB,IAAI,CACpD,CAEA,mBACA,CAAA,CAAA,GAAA,CAAA,kBAAA,CAAA,KAAA,CAAA,SAAA,gBAAA,CAAiBiC,OAAO,CAAE,CACrBC,IAAAA,MAAAA,CAAAA,IAAAA,CAAAA,gBAAgB,CAAGC,cAAc,CAACC,uBAAuB,CAACH,OAAO,CAAC7B,IAAI,CAAC,mBAAiB,CAAC,CAACC,GAAG,EAAE,CAAC,CAEhGgC,eAAe,CAAGJ,OAAO,CAAC7B,IAAI,CAAC,cAAc,CAAC,CAClD8B,gBAAgB,CAACI,mBAAmB,CAACD,eAAe,CAAC,CACrDA,eAAe,CAACE,gBAAgB,CAAC5C,GAAG,CAAC6C,uBAAuB,CAAC,CAC7DC,GAAG,CAACC,MAAM,CAACC,QAAQ,CAACC,sBAAsB,CAACX,OAAO,CAAC7B,IAAI,CAAC,QAAQ,CAAC,CAAC,CAClE6B,OAAO,CAAC7B,IAAI,CAAC,wBAAwB,CAAC,CAACc,EAAE,CAAC,OAAO,CAAE,UAAM,CACxD,MAAI,CAACW,qBAAqB,GAC3B,CAAC,CAAC,CACFY,GAAG,CAACI,UAAU,CAACC,WAAW,CAACC,sBAAsB,CAACV,eAAe,CARvD,EAAE,CAQ8D,CAC1EI,GAAG,CAACC,MAAM,CAACM,IAAI,CAACC,MAAM,CAACC,QAAQ,CAACjB,OAAO,CAAC7B,IAAI,CAAC,YAAY,CAAC,CAAE,CAAE+C,MAAM,CAAE,KAAK,CAAEC,OAAO,CAAE,KAAM,CAAC,EAC9F,CAEA,mBAAA,CAAA,CAAA,GAAA,CAAA,eAAA,CAAA,KAAA,CACA,SAAcC,aAAAA,CAAAA,OAAO,CAAE/B,IAAI,CAAE,CAC5B,IAAyB,mBAAA,CAAGb,CAAC,CAAC,4BAA4B,CAAC,CAC1D6C,WAAW,CAAGC,mBAAmB,CAACnD,IAAI,CAAC,6BAA2B,CAAC,CAIpE,GAHAkB,IAAI,CAAGb,CAAC,CAACa,IAAI,CAAC,CAEdgC,WAAW,CAACE,QAAQ,CAAC,QAAQ,CAAC,CAC1BlC,IAAI,CAACmC,QAAQ,CAAC,cAAc,CAAC,CAAE,CAClC,SAAS,CAAGnC,IAAI,CAAClB,IAAI,CAAC,oBAAoB,CAAC,CAACkB,IAAI,CAAC,OAAO,CAAC,CACzDgC,WAAW,CAACI,MAAM,4BAAqBC,KAAK,CAAA,CAAG,CAACC,WAAW,CAAC,QAAQ,CAAC,CACrE,IAAI,CAAC1E,WAAW,CAAGyE,MACpB,CAAC,KAAc,IAAA,CAACF,QAAQ,CAAC,mBAAmB,CAAC,GAC5CH,WAAW,CAACI,MAAM,CAAC,yBAAyB,CAAC,CAACE,WAAW,CAAC,QAAQ,CAAC,CACnE,IAAI,CAAC1E,WAAW,CAAG,QAAQ,EAE5BmE,OAAO,CAACjD,IAAI,CAAC,aAAa,CAAC,CAACY,IAAI,CAACM,IAAI,EACtC,CAAC,CAAA,CAAA,CAAA,CAAA,+BAAA,CAAA,CA3IqFuC,oBAAoB,CA4I1G,CAEDC,MAAM,CAACC,KAAK,CACX,yBAAyB,CACzB,EAAE,CACF,CACCzE,cAAc,CAAE,SAAUP,cAAAA,CAAAA,SAAS,CAAE,CACpC,IAAID,+BAA+B,CAACC,SAAS,CAACiF,OAAO,CAAC,qBAAqB,CAAC,IAAO,CACnFjF,SAAS,CAACqB,IAAI,CAAC,6BAA6B,CAAC,CAACc,EAAE,CAAC,OAAO,CAAE,SAAUC,CAAC,CAAE,CAClE8C,IAAAA,IAAI,CAAGlF,SAAS,CAACqB,IAAI,CAAC,MAAM,CAAC,CAC7BgB,aAAa,CAAGX,CAAC,CAACU,CAAC,CAACC,aAAa,CAAC,CAClC,CAAC,GAAKA,aAAa,CAACE,IAAI,CAAC,MAAM,CAAC,EACnC2C,IAAI,CAACC,MAAM,CAAC,qDAAkD,CAAG9C,aAAa,CAACE,IAAI,CAAC,OAAO,CAAC,CAAG,KAAI,CAAC,CACpG2C,IAAI,CAACE,MAAM,EAAE,GAEbpF,SAAS,CAACqB,IAAI,CAAC,sBAAsB,CAAC,CAACgE,MAAM,EAAE,CAC/CH,IAAI,CAAC7D,IAAI,CAAC,mBAAiB,CAAC,CAACC,GAAG,CAAC,EAAE,CAAC,CACpC4D,IAAI,CAACC,MAAM,CAAC,uDAAmD,CAAC,CAChED,IAAI,CAACC,MAAM,CAAC,+CAA4C,CAAG9C,aAAa,CAACE,IAAI,CAAC,IAAI,CAAC,CAAG,KAAI,CAAC,EAE7F,CAAC,EACF,CACD,CAAC,CACD;;"}