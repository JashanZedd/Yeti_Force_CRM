Vtiger_RelatedList_Js("PriceBooks_RelatedList_Js",{},{getPopupParams:function(){var a=this._super();if(this.moduleName==="Products"){a.view="PriceBookProductPopup";a.src_field="priceBookRelatedList"}return a},showSelectRelationPopup:function(a){var b=jQuery.Deferred();var d=this;var e=Vtiger_Popup_Js.getInstance();var c=this.getPopupParams();$.extend(c,a);e.show(c,function(h){var g=JSON.parse(h);if(d.moduleName==="PriceBooks"||d.moduleName==="Products"){var i="addListPrice";var f=g}else{var f=Object.keys(g);var i="addRelations"}d[i](f).then(function(l){var k=Vtiger_Detail_Js.getInstance();d.loadRelatedList().then(function(m){b.resolve(m);k.registerRelatedModulesRecordCount()});var j=d.getSelectedTabElement();if(j.data("link-key")=="LBL_RECORD_SUMMARY"){k.loadWidgets();k.registerRelatedModulesRecordCount()}})});return b.promise()},addListPrice:function(b){var a=jQuery.Deferred();AppConnector.request({module:this.parentModuleName,action:"RelationAjax",mode:"addListPrice",related_module:this.moduleName,src_record:this.parentRecordId,relinfo:$.isArray(b)?JSON.stringify(b):b}).then(function(c){a.resolve(c)},function(d,c){a.reject(d,c)});return a.promise()},showListPriceUpdate:function(c){var b=this;var a=Vtiger_Detail_Js.getInstance();app.showModalWindow(c,function(e){e.find("#listPriceUpdate").validationEngine(app.validationEngineOptions);var d=jQuery("#listPriceUpdate");d.on("submit",function(i){i.preventDefault();var h=d.data("jqv").InvalidFields;if(h.length==0){var f=d.find('input[name="relid"]').val();var g=d.find('input[name="currentPrice"]').val();b.addListPrice([{id:f,price:g}]).then(function(j){b.loadRelatedList().then(function(k){a.registerRelatedModulesRecordCount()})});app.hideModalWindow()}})})},listPriceUpdateContainer:false,getListPriceUpdateContainer:function(){return this.listPriceUpdateContainer},getListPriceEditForm:function(b){var a=jQuery.Deferred();var c=this;var d=this.getListPriceUpdateContainer();if(d!=false){a.resolve(d)}else{AppConnector.request(b).then(function(e){c.listPriceUpdateContainer=e;a.resolve(e)},function(f,e){a.reject(f,e)})}return a.promise()},registerEventForEditListPrice:function(){var a=this;this.content.on("click","button.editListPrice",function(d){d.stopPropagation();var c=jQuery(d.currentTarget);var b=c.data("url");a.getListPriceEditForm(b).then(function(f){var e=jQuery(f);e.find('input[name="relid"]').val(c.data("relatedRecordid"));e.find('input[name="currentPrice"]').val(c.data("listPrice"));a.showListPriceUpdate(e)})})},registerPostLoadEvents:function(){this._super();this.registerEventForEditListPrice()},});