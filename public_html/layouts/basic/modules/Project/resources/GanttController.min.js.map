{"version":3,"file":"GanttController.min.js","sources":["GanttController.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class(\n\t'Project_Gantt_Js',\n\t{},\n\t{\n\t\tfilterSelectElement: false,\n\t\tgetFilterSelectElement: function () {\n\t\t\tif (this.filterSelectElement == false) {\n\t\t\t\tthis.filterSelectElement = jQuery('#customFilter');\n\t\t\t}\n\t\t\treturn this.filterSelectElement;\n\t\t},\n\t\tgetDefaultParams: function () {\n\t\t\tvar params = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'GanttData'\n\t\t\t};\n\t\t\tif (app.getParentModuleName()) {\n\t\t\t\tparams.parent = app.getParentModuleName();\n\t\t\t}\n\t\t\treturn params;\n\t\t},\n\t\tgetCurrentCvId: function () {\n\t\t\treturn jQuery('#customFilter').find('option:selected').data('id');\n\t\t},\n\t\tgetGanttData(urlParams) {\n\t\t\tlet aDeferred = $.Deferred();\n\t\t\tif (typeof urlParams === 'undefined') {\n\t\t\t\turlParams = {};\n\t\t\t}\n\t\t\tlet defaultParams = this.getDefaultParams();\n\t\t\turlParams = $.extend(defaultParams, urlParams);\n\t\t\tconst progressInstance = jQuery.progressIndicator({\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true,\n\t\t\t\t\tonBlock: () => {\n\t\t\t\t\t\tAppConnector.request(urlParams)\n\t\t\t\t\t\t\t.done(function (data) {\n\t\t\t\t\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t\t\t\t\tapp.notifyPostAjaxReady();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.fail(function (textStatus, errorThrown) {\n\t\t\t\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\t/**\n\t\t * load gantt\n\t\t */\n\t\tloadGantt(container = '.js-gantt__container', ganttData = false) {\n\t\t\tcontainer = $(container);\n\t\t\tthis.gantt = new Gantt(container);\n\t\t\tconst projectId = container.parent().find('input[name=\"projectId\"]').val();\n\t\t\tif (!ganttData) {\n\t\t\t\tthis.gantt.loadProjectFromAjax({\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: 'GanttData',\n\t\t\t\t\tprojectId: projectId\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * reload gantt with new data\n\t\t * @param data\n\t\t */\n\t\treloadData(data) {\n\t\t\tthis.gantt.reloadData(data);\n\t\t},\n\t\t/*\n\t\t * Function to register the event for changing the custom Filter\n\t\t */\n\t\tregisterChangeCustomFilterEvent: function () {\n\t\t\tvar thisInstance = this;\n\t\t\tthis.getFilterSelectElement().on('change', function (event) {\n\t\t\t\t$(`.nav-item[data-cvid='${thisInstance.getCurrentCvId()}'] .nav-link`).tab('show');\n\t\t\t\tvar currentTarget = jQuery(event.currentTarget);\n\t\t\t\tvar selectOption = currentTarget.find(':selected');\n\t\t\t\tapp.setMainParams('pageNumber', '1');\n\t\t\t\tapp.setMainParams('pageToJump', '1');\n\t\t\t\tapp.setMainParams('orderBy', selectOption.data('orderby'));\n\t\t\t\tapp.setMainParams('sortOrder', selectOption.data('sortorder'));\n\t\t\t\tthisInstance\n\t\t\t\t\t.getGanttData({\n\t\t\t\t\t\tviewname: jQuery(this).val()\n\t\t\t\t\t})\n\t\t\t\t\t.done(function (data) {\n\t\t\t\t\t\tthisInstance.reloadData(data.result);\n\t\t\t\t\t});\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\t\t},\n\t\tgetSelectOptionFromChosenOption: function (liElement) {\n\t\t\tvar id = liElement.attr('id');\n\t\t\tvar idArr = id.split('-');\n\t\t\tvar currentOptionId = '';\n\t\t\tif (idArr.length > 0) {\n\t\t\t\tcurrentOptionId = idArr[idArr.length - 1];\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn jQuery('#filterOptionId_' + currentOptionId);\n\t\t},\n\t\tchangeCustomFilterElementView: function () {\n\t\t\tconst self = this,\n\t\t\t\tfilterSelectElement = this.getFilterSelectElement();\n\t\t\tif (filterSelectElement.length > 0 && filterSelectElement.is('select')) {\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(filterSelectElement, {\n\t\t\t\t\ttemplateSelection: function (data) {\n\t\t\t\t\t\tconst resultContainer = document.createElement('span'),\n\t\t\t\t\t\t\tspan = document.createElement('span'),\n\t\t\t\t\t\t\timage = $('.filterImage').clone();\n\t\t\t\t\t\timage.removeAttr('style');\n\t\t\t\t\t\tspan.innerText = data.text;\n\t\t\t\t\t\tresultContainer.appendChild(image.get(0));\n\t\t\t\t\t\tresultContainer.appendChild(span);\n\t\t\t\t\t\treturn resultContainer;\n\t\t\t\t\t},\n\t\t\t\t\tcustomSortOptGroup: true,\n\t\t\t\t\tcloseOnSelect: true\n\t\t\t\t});\n\t\t\t\tconst select2Instance = filterSelectElement.data('select2');\n\t\t\t\tjQuery('.filterActionsDiv')\n\t\t\t\t\t.appendTo(select2Instance.$dropdown.find('.select2-dropdown:last'))\n\t\t\t\t\t.removeClass('d-none')\n\t\t\t\t\t.on('click', function (e) {\n\t\t\t\t\t\tself.registerCreateFilterClickEvent(e);\n\t\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tregisterEvents: function () {\n\t\t\tthis.changeCustomFilterElementView();\n\t\t\tthis.registerChangeCustomFilterEvent();\n\t\t\tVtiger_Helper_Js.showHorizontalTopScrollBar();\n\t\t\tthis.loadGantt();\n\t\t}\n\t}\n);\n"],"names":["$","Class","filterSelectElement","getFilterSelectElement","jQuery","getDefaultParams","module","app","getModuleName","action","getParentModuleName","params","parent","getCurrentCvId","find","data","getGanttData","urlParams","aDeferred","Deferred","defaultParams","extend","progressIndicator","blockInfo","enabled","onBlock","AppConnector","request","done","progressInstance","mode","resolve","notifyPostAjaxReady","fail","textStatus","errorThrown","reject","promise","loadGantt","container","ganttData","gantt","Gantt","val","loadProjectFromAjax","projectId","reloadData","registerChangeCustomFilterEvent","on","event","thisInstance","tab","currentTarget","selectOption","setMainParams","viewname","result","stopPropagation","getSelectOptionFromChosenOption","liElement","id","attr","idArr","split","currentOptionId","length","changeCustomFilterElementView","is","App","Fields","Picklist","showSelect2ElementView","templateSelection","document","createElement","span","image","clone","removeAttr","innerText","text","resultContainer","appendChild","get","customSortOptGroup","closeOnSelect","appendTo","select2Instance","$dropdown","removeClass","e","self","registerCreateFilterClickEvent","registerEvents","Vtiger_Helper_Js","showHorizontalTopScrollBar"],"mappings":"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"}