{"version":3,"file":"GanttController.min.js","sources":["GanttController.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class(\"Project_Gantt_Js\", {}, {\n\tfilterSelectElement: false,\n\tgetFilterSelectElement: function () {\n\t\tif (this.filterSelectElement == false) {\n\t\t\tthis.filterSelectElement = jQuery('#customFilter');\n\t\t}\n\t\treturn this.filterSelectElement;\n\t},\n\tgetDefaultParams: function () {\n\t\tvar params = {\n\t\t\tmodule: app.getModuleName(),\n\t\t\taction: 'GanttData',\n\t\t};\n\t\tif (app.getParentModuleName()) {\n\t\t\tparams.parent = app.getParentModuleName();\n\t\t}\n\t\treturn params;\n\t},\n\tgetCurrentCvId: function () {\n\t\treturn jQuery('#customFilter').find('option:selected').data('id');\n\t},\n\tgetGanttData(urlParams) {\n\t\tlet aDeferred = $.Deferred();\n\t\tif (typeof urlParams === \"undefined\") {\n\t\t\turlParams = {};\n\t\t}\n\t\tlet defaultParams = this.getDefaultParams();\n\t\turlParams = $.extend(defaultParams, urlParams);\n\t\tconst progressInstance = jQuery.progressIndicator({\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true,\n\t\t\t\tonBlock: () => {\n\t\t\t\t\tAppConnector.request(urlParams).done(function (data) {\n\t\t\t\t\t\tprogressInstance.progressIndicator({mode: 'hide'});\n\t\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t\t\tapp.notifyPostAjaxReady();\n\t\t\t\t\t}).fail(function (textStatus, errorThrown) {\n\t\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\t/**\n\t * load gantt\n\t */\n\tloadGantt(container = '.js-gantt__container', ganttData = false) {\n\t\tcontainer = $(container);\n\t\tthis.gantt = new Gantt(container);\n\t\tconst projectId = container.parent().find('input[name=\"projectId\"]').val();\n\t\tif (!ganttData) {\n\t\t\tthis.gantt.loadProjectFromAjax({\n\t\t\t\tmodule: 'Project',\n\t\t\t\taction: 'GanttData',\n\t\t\t\tprojectId: projectId\n\t\t\t});\n\t\t}\n\t},\n\t/**\n\t * reload gantt with new data\n\t * @param data\n\t */\n\treloadData(data) {\n\t\tthis.gantt.reloadData(data);\n\t},\n\t/*\n\t * Function to register the event for changing the custom Filter\n\t */\n\tregisterChangeCustomFilterEvent: function () {\n\t\tvar thisInstance = this;\n\t\tthis.getFilterSelectElement().on('change', function (event) {\n\t\t\t$(`.nav-item[data-cvid='${thisInstance.getCurrentCvId()}'] .nav-link`).tab('show');\n\t\t\tvar currentTarget = jQuery(event.currentTarget);\n\t\t\tvar selectOption = currentTarget.find(':selected');\n\t\t\tapp.setMainParams('pageNumber', '1');\n\t\t\tapp.setMainParams('pageToJump', '1');\n\t\t\tapp.setMainParams('orderBy', selectOption.data('orderby'));\n\t\t\tapp.setMainParams('sortOrder', selectOption.data('sortorder'));\n\t\t\tthisInstance.getGanttData({\n\t\t\t\t\"viewname\": jQuery(this).val(),\n\t\t\t}).done(function (data) {\n\t\t\t\tthisInstance.reloadData(data.result);\n\t\t\t});\n\t\t\tevent.stopPropagation();\n\t\t});\n\t},\n\tgetSelectOptionFromChosenOption: function (liElement) {\n\t\tvar id = liElement.attr(\"id\");\n\t\tvar idArr = id.split(\"-\");\n\t\tvar currentOptionId = '';\n\t\tif (idArr.length > 0) {\n\t\t\tcurrentOptionId = idArr[idArr.length - 1];\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t\treturn jQuery('#filterOptionId_' + currentOptionId);\n\t},\n\tchangeCustomFilterElementView: function () {\n\t\tvar thisInstance = this;\n\t\tvar filterSelectElement = this.getFilterSelectElement();\n\t\tif (filterSelectElement.length > 0 && filterSelectElement.is(\"select\")) {\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(filterSelectElement, {\n\t\t\t\ttemplateSelection: function (data) {\n\t\t\t\t\tvar resultContainer = jQuery('<span></span>');\n\t\t\t\t\tresultContainer.append(jQuery(jQuery('.filterImage').clone().get(0)).show());\n\t\t\t\t\tresultContainer.append(data.text);\n\t\t\t\t\treturn resultContainer;\n\t\t\t\t},\n\t\t\t\tcustomSortOptGroup: true,\n\t\t\t\tcloseOnSelect: true\n\t\t\t});\n\n\t\t\tvar select2Instance = filterSelectElement.data('select2');\n\t\t\tjQuery('.filterActionsDiv').appendTo(select2Instance.$dropdown.find('.select2-dropdown:last')).removeClass('d-none').on('click', function (e) {\n\t\t\t\tthisInstance.registerCreateFilterClickEvent(e);\n\t\t\t});\n\t\t}\n\t},\n\tregisterEvents: function () {\n\t\tthis.changeCustomFilterElementView();\n\t\tthis.registerChangeCustomFilterEvent();\n\t\tVtiger_Helper_Js.showHorizontalTopScrollBar();\n\t\tthis.loadGantt();\n\t},\n});\n\n"],"names":["$","Class","filterSelectElement","jQuery","params","app","getModuleName","getParentModuleName","parent","find","data","urlParams","aDeferred","Deferred","defaultParams","getDefaultParams","extend","progressInstance","progressIndicator","request","done","mode","resolve","notifyPostAjaxReady","fail","textStatus","errorThrown","reject","promise","container","ganttData","gantt","Gantt","projectId","val","loadProjectFromAjax","reloadData","thisInstance","getFilterSelectElement","on","event","getCurrentCvId","tab","currentTarget","selectOption","setMainParams","getGanttData","result","stopPropagation","liElement","id","attr","idArr","split","currentOptionId","length","is","Fields","Picklist","showSelect2ElementView","resultContainer","append","clone","get","show","text","select2Instance","appendTo","$dropdown","removeClass","e","registerCreateFilterClickEvent","changeCustomFilterElementView","registerChangeCustomFilterEvent","showHorizontalTopScrollBar","loadGantt"],"mappings":";;AAAA;AACA;AAEAA,EAAEC,KAAF,CAAQ,kBAAR,EAA4B,EAA5B,EAAgC;sBACV,KADU;yBAEP,kCAAY;MAC/B,KAAKC,mBAAL,IAA4B,KAAhC,EAAuC;QACjCA,mBAAL,GAA2BC,OAAO,eAAP,CAA3B;;SAEM,KAAKD,mBAAZ;EAN8B;mBAQb,4BAAY;MACzBE,SAAS;WACJC,IAAIC,aAAJ,EADI;WAEJ;GAFT;MAIID,IAAIE,mBAAJ,EAAJ,EAA+B;UACvBC,MAAP,GAAgBH,IAAIE,mBAAJ,EAAhB;;SAEMH,MAAP;EAhB8B;iBAkBf,0BAAY;SACpBD,OAAO,eAAP,EAAwBM,IAAxB,CAA6B,iBAA7B,EAAgDC,IAAhD,CAAqD,IAArD,CAAP;EAnB8B;aAAA,wBAqBlBC,SArBkB,EAqBP;MACnBC,YAAYZ,EAAEa,QAAF,EAAhB;MACI,OAAOF,SAAP,KAAqB,WAAzB,EAAsC;eACzB,EAAZ;;MAEGG,gBAAgB,KAAKC,gBAAL,EAApB;cACYf,EAAEgB,MAAF,CAASF,aAAT,EAAwBH,SAAxB,CAAZ;MACMM,mBAAmBd,OAAOe,iBAAP,CAAyB;cACtC;aACD,IADC;aAED,mBAAM;kBACDC,OAAb,CAAqBR,SAArB,EAAgCS,IAAhC,CAAqC,UAAUV,IAAV,EAAgB;uBACnCQ,iBAAjB,CAAmC,EAACG,MAAM,MAAP,EAAnC;gBACUC,OAAV,CAAkBZ,IAAlB;UACIa,mBAAJ;MAHD,EAIGC,IAJH,CAIQ,UAAUC,UAAV,EAAsBC,WAAtB,EAAmC;gBAChCC,MAAV,CAAiBF,UAAjB,EAA6BC,WAA7B;MALD;;;GAJsB,CAAzB;SAcOd,UAAUgB,OAAV,EAAP;EA1C8B;;;;;UAAA,uBA+CkC;MAAvDC,SAAuD,uEAA3C,sBAA2C;MAAnBC,SAAmB,uEAAP,KAAO;;cACpD9B,EAAE6B,SAAF,CAAZ;OACKE,KAAL,GAAa,IAAIC,KAAJ,CAAUH,SAAV,CAAb;MACMI,YAAYJ,UAAUrB,MAAV,GAAmBC,IAAnB,CAAwB,yBAAxB,EAAmDyB,GAAnD,EAAlB;MACI,CAACJ,SAAL,EAAgB;QACVC,KAAL,CAAWI,mBAAX,CAA+B;YACtB,SADsB;YAEtB,WAFsB;eAGnBF;IAHZ;;EApD6B;;;;;;WAAA,sBA+DpBvB,IA/DoB,EA+Dd;OACXqB,KAAL,CAAWK,UAAX,CAAsB1B,IAAtB;EAhE8B;;;;;kCAqEE,2CAAY;MACxC2B,eAAe,IAAnB;OACKC,sBAAL,GAA8BC,EAA9B,CAAiC,QAAjC,EAA2C,UAAUC,KAAV,EAAiB;gCACjCH,aAAaI,cAAb,EAA1B,oBAAuEC,GAAvE,CAA2E,MAA3E;OACIC,gBAAgBxC,OAAOqC,MAAMG,aAAb,CAApB;OACIC,eAAeD,cAAclC,IAAd,CAAmB,WAAnB,CAAnB;OACIoC,aAAJ,CAAkB,YAAlB,EAAgC,GAAhC;OACIA,aAAJ,CAAkB,YAAlB,EAAgC,GAAhC;OACIA,aAAJ,CAAkB,SAAlB,EAA6BD,aAAalC,IAAb,CAAkB,SAAlB,CAA7B;OACImC,aAAJ,CAAkB,WAAlB,EAA+BD,aAAalC,IAAb,CAAkB,WAAlB,CAA/B;gBACaoC,YAAb,CAA0B;gBACb3C,OAAO,IAAP,EAAa+B,GAAb;IADb,EAEGd,IAFH,CAEQ,UAAUV,IAAV,EAAgB;iBACV0B,UAAb,CAAwB1B,KAAKqC,MAA7B;IAHD;SAKMC,eAAN;GAbD;EAvE8B;kCAuFE,yCAAUC,SAAV,EAAqB;MACjDC,KAAKD,UAAUE,IAAV,CAAe,IAAf,CAAT;MACIC,QAAQF,GAAGG,KAAH,CAAS,GAAT,CAAZ;MACIC,kBAAkB,EAAtB;MACIF,MAAMG,MAAN,GAAe,CAAnB,EAAsB;qBACHH,MAAMA,MAAMG,MAAN,GAAe,CAArB,CAAlB;GADD,MAEO;UACC,KAAP;;SAEMpD,OAAO,qBAAqBmD,eAA5B,CAAP;EAhG8B;gCAkGA,yCAAY;MACtCjB,eAAe,IAAnB;MACInC,sBAAsB,KAAKoC,sBAAL,EAA1B;MACIpC,oBAAoBqD,MAApB,GAA6B,CAA7B,IAAkCrD,oBAAoBsD,EAApB,CAAuB,QAAvB,CAAtC,EAAwE;OACnEC,MAAJ,CAAWC,QAAX,CAAoBC,sBAApB,CAA2CzD,mBAA3C,EAAgE;uBAC5C,2BAAUQ,IAAV,EAAgB;SAC9BkD,kBAAkBzD,OAAO,eAAP,CAAtB;qBACgB0D,MAAhB,CAAuB1D,OAAOA,OAAO,cAAP,EAAuB2D,KAAvB,GAA+BC,GAA/B,CAAmC,CAAnC,CAAP,EAA8CC,IAA9C,EAAvB;qBACgBH,MAAhB,CAAuBnD,KAAKuD,IAA5B;YACOL,eAAP;KAL8D;wBAO3C,IAP2C;mBAQhD;IARhB;;OAWIM,kBAAkBhE,oBAAoBQ,IAApB,CAAyB,SAAzB,CAAtB;UACO,mBAAP,EAA4ByD,QAA5B,CAAqCD,gBAAgBE,SAAhB,CAA0B3D,IAA1B,CAA+B,wBAA/B,CAArC,EAA+F4D,WAA/F,CAA2G,QAA3G,EAAqH9B,EAArH,CAAwH,OAAxH,EAAiI,UAAU+B,CAAV,EAAa;iBAChIC,8BAAb,CAA4CD,CAA5C;IADD;;EAlH6B;iBAuHf,0BAAY;OACtBE,6BAAL;OACKC,+BAAL;mBACiBC,0BAAjB;OACKC,SAAL;;CA3HF"}