'use strict';

var classCallCheck = function (instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
};

var createClass = function () {
  function defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  return function (Constructor, protoProps, staticProps) {
    if (protoProps) defineProperties(Constructor.prototype, protoProps);
    if (staticProps) defineProperties(Constructor, staticProps);
    return Constructor;
  };
}();

var _extends = Object.assign || function (target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i];

    for (var key in source) {
      if (Object.prototype.hasOwnProperty.call(source, key)) {
        target[key] = source[key];
      }
    }
  }

  return target;
};

var Gantt=function(){function Gantt(container,projectData){classCallCheck(this,Gantt),this.container=$(container),this.registerLanguage(),this.registerTemplates(),'undefined'!=typeof projectData&&this.loadProject(projectData);}return createClass(Gantt,[{key:'registerLanguage',value:function registerLanguage(){GanttMaster.messages.GANTT_ERROR_LOADING_DATA_TASK_REMOVED=app.vtranslate('JS_GANTT_ERROR_LOADING_DATA_TASK_REMOVED','Project'),GanttMaster.messages.INVALID_DATE_FORMAT=app.vtranslate('JS_INVALID_DATE_FORMAT','Project'),GanttMaster.messages.GANTT_SEMESTER_SHORT=app.vtranslate('JS_GANTT_SEMESTER_SHORT','Project'),GanttMaster.messages.GANTT_SEMESTER=app.vtranslate('JS_GANTT_SEMESTER','Project'),GanttMaster.messages.GANTT_QUARTER_SHORT=app.vtranslate('JS_GANTT_QUARTER_SHORT','Project'),GanttMaster.messages.GANTT_QUARTER=app.vtranslate('JS_GANTT_QUARTER','Project'),GanttMaster.messages.GANTT_WEEK=app.vtranslate('JS_GANTT_WEEK','Project'),GanttMaster.messages.GANTT_WEEK_SHORT=app.vtranslate('JS_GANTT_WEEK_SHORT','Project'),Gantt_i18n.YES=app.vtranslate('JS_YES','Project'),Gantt_i18n.NO=app.vtranslate('JS_NO','Project'),Gantt_i18n.INVALID_DATA=app.vtranslate('JS_INVALID_DATA','Project'),Gantt_i18n.ERROR_ON_FIELD=app.vtranslate('JS_ERROR_ON_FIELD','Project'),Gantt_i18n.OUT_OF_BOUDARIES=app.vtranslate('JS_OUT_OF_BOUDARIES','Project'),Gantt_i18n.ERR_FIELD_MAX_SIZE_EXCEEDED=app.vtranslate('JS_ERR_FIELD_MAX_SIZE_EXCEEDED','Project'),Gantt_i18n.WEEK_SHORT=app.vtranslate('JS_WEEK_SHORT','Project'),Gantt_i18n.PROCEED=app.vtranslate('JS_PROCEED','Project'),Gantt_i18n.PREV=app.vtranslate('JS_PREV','Project'),Gantt_i18n.NEXT=app.vtranslate('JS_NEXT','Project'),Gantt_i18n.HINT_SKIP=app.vtranslate('JS_HINT_SKIP','Project'),Date.monthNames=App.Fields.Date.fullMonthsTranslated.map(function(month){return month}),Date.monthAbbreviations=App.Fields.Date.monthsTranslated.map(function(month){return month}),Date.dayAbbreviations=App.Fields.Date.daysTranslated.map(function(day){return day}),Date.dayNames=App.Fields.Date.fullDaysTranslated.map(function(day){return day}),Date.firstDayOfWeek=CONFIG.firstDayOfWeekNo,Date.defaultFormat=CONFIG.dateFormat,Date.today=app.vtranslate('JS_TODAY'),Number.decimalSeparator=CONFIG.currencyDecimalSeparator,Number.groupingSeparator=CONFIG.currencyGroupingSeparator,Number.currencyFormat='###,##0.00';}},{key:'registerTemplates',value:function registerTemplates(){this.ganttTemplateFunctions=[],this.ganttTemplateFunctions.push({type:'GANTBUTTONS',render:function render(){return '<div class="ganttButtonBar noprint">\n\t\t\t\t<div class="buttons">\n\t\t\t\t\t<button class="js-gantt__expand-all-btn button textual icon " title="'+app.vtranslate('JS_GANTT_EXPAND_ALL')+'"><span class="teamworkIcon">6</span></button>\n\t\t\t\t\t<button class="js-gantt__collapse-all-btn button textual icon " title="'+app.vtranslate('JS_GANTT_COLLAPSE_ALL')+'"><span class="teamworkIcon">5</span></button>\n\t\t\t\t\t<span class="ganttButtonSeparator"></span>\n\t\t\t\t\t<button class="js-gantt__zoom-out-btn button textual icon " title="'+app.vtranslate('JS_GANTT_ZOOM_OUT')+'"><span class="teamworkIcon">)</span></button>\n\t\t\t\t\t<button class="js-gantt__zoom-in-btn button textual icon " title="'+app.vtranslate('JS_GANTT_ZOOM_IN')+'"><span class="teamworkIcon">(</span></button>\n\t\t\t\t\t<span class="ganttButtonSeparator"></span>\n\t\t\t\t\t<button class="js-gantt__resize-0-btn button textual icon" title="'+app.vtranslate('JS_GANTT_RESIZE_0')+'"><span class="teamworkIcon">F</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button class="js-gantt__resize-50-btn button textual icon" title="'+app.vtranslate('JS_GANTT_RESIZE_50')+'"><span class="teamworkIcon">O</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button class="js-gantt__resize-100-btn button textual icon" title="'+app.vtranslate('JS_GANTT_RESIZE_100')+'"><span class="teamworkIcon">R</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<span class="ganttButtonSeparator"></span>\n\t\t\t\t\t<button class="js-gantt__front-filter button textual icon" title="'+app.vtranslate('JS_GANTT_FILTER')+'"><span class="teamworkIcon">f</span></button>\n\t\t\t\t</div>\n\t\t\t</div>'}}),this.ganttTemplateFunctions.push({type:'TASKSEDITHEAD',render:function render(){return '<table class="gdfTable" cellspacing="0" cellpadding="0">\n\t\t\t\t<thead>\n\t\t\t\t<tr style="height:40px">\n      \t\t\t\t<th class="gdfColHeader gdfResizable" style="width:80px">'+app.vtranslate('JS_NO.','Project')+'</th>\n\t\t\t\t\t<th class="gdfColHeader gdfResizable" style="width:300px">'+app.vtranslate('JS_NAME')+'</th>\n\t\t\t\t\t<th class="gdfColHeader gdfResizable" style="width:60px">'+app.vtranslate('JS_PRIORITY')+'</th>\n\t\t\t\t\t<th class="gdfColHeader gdfResizable" style="width:100px">'+app.vtranslate('JS_STATUS')+'</th>\n\t\t\t\t\t<th class="gdfColHeader gdfResizable" style="width:70px">'+app.vtranslate('JS_DURATION_SHORT','Project')+'</th>\n\t\t\t\t\t<th class="gdfColHeader gdfResizable" style="width:50px">%</th>\n\t\t\t\t\t<th class="gdfColHeader gdfResizable" style="width:200px">'+app.vtranslate('JS_ASSIGNED','Project')+'</th>\n\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t</table>'}}),this.ganttTemplateFunctions.push({type:'TASKROW',render:function render(obj){return '<tr id="tid_'+obj.id+'" taskId="'+obj.id+'" class="taskEditRow '+(obj.isParent()?'isParent':'')+' '+(obj.collapsed?'collapsed':'')+'" level="'+obj.level+'">\n\t   \t\t\t<td class="gdfCell text-center">'+obj.no+'</td>\n\t\t\t\t<td class="gdfCell indentCell" style="padding-left:'+(10*obj.level+18)+'px;" title="'+obj.name+'" data-toggle="tooltip">\n\t\t\t\t\t<div class="exp-controller" align="center"></div>\n\t\t\t\t\t'+('project'===obj.type?'<span class="fas fa-briefcase"></span>':'milestone'===obj.type?'<i class="fas fa-folder"></i>':'<i class="fas fa-file"></i>')+'\n\t\t\t\t\t<input type="text" name="name" value="'+obj.name+'" placeholder="name" '+(obj.canWrite?'canWrite':'disabled')+'>\n\t\t\t\t</td>\n\t\t\t\t<td class="gdfCell"><input type="text" name="priority" class="text-center" autocomplete="off" value="'+(obj.priority_label?obj.priority_label:'')+'"></td>\n\t\t\t\t<td class="gdfCell"><input type="text" name="status" class="text-center" autocomplete="off" value="'+(obj.status_label?obj.status_label:'')+'"></td>\n\t\t\t\t<td class="gdfCell"><input type="text" name="duration" class="text-center" autocomplete="off" value="'+obj.duration+'"></td>\n\t\t\t\t<td class="gdfCell"><input type="text" name="progress" class="validated text-center" entrytype="PERCENTILE" autocomplete="off" value="'+(obj.progress?obj.progress:'')+'" '+(obj.progressByWorklog?'readOnly':'')+'></td>\n\t\t\t\t<td class="gdfCell"><input type="text" name="assigned" class="text-center" autocomplete="off" value="'+obj.assigned_user_name+'"></td>\n\t\t\t</tr>'}}),this.ganttTemplateFunctions.push({type:'TASKEMPTYROW',render:function render(){return '<tr class="taskEditRow emptyRow">\n\t\t\t\t<td class="gdfCell"></td>\n\t\t\t\t<td class="gdfCell"></td>\n\t\t\t\t<td class="gdfCell"></td>\n\t\t\t\t<td class="gdfCell"></td>\n\t\t\t\t<td class="gdfCell"></td>\n\t\t\t\t<td class="gdfCell"></td>\n\t\t\t\t<td class="gdfCell"></td>\n\t\t\t</tr>'}}),this.ganttTemplateFunctions.push({type:'TASKBAR',render:function render(obj){return '<div class="taskBox taskBoxDiv" taskId="'+obj.id+'">\n\t\t\t\t<div class="layout '+(obj.hasExternalDep?'extDep':'')+'">\n\t\t\t\t\t<div class="taskProgress"\n\t\t\t\t\t\t style="width:'+(100<obj.progress?100:obj.progress)+'%; background-color:'+(100<obj.progress?'red':'rgb(153,255,51);')+';"></div>\n\t\t\t\t\t<div class="milestone '+(obj.startIsMilestone?'active':'')+'"></div>\n\t\t\t\t\t<div class="taskLabel"></div>\n\t\t\t\t\t<div class="milestone end '+(obj.endIsMilestone?'active':'')+'"></div>\n\t\t\t\t</div>\n\t\t\t</div>'}}),this.ganttTemplateFunctions.push({type:'CHANGE_STATUS',render:function render(){return '<div class="taskStatusBox">\n\t\t\t\t<div class="taskStatus cvcColorSquare" status="STATUS_ACTIVE" title="Active"></div>\n\t\t\t\t<div class="taskStatus cvcColorSquare" status="STATUS_DONE" title="Completed"></div>\n\t\t\t\t<div class="taskStatus cvcColorSquare" status="STATUS_FAILED" title="Failed"></div>\n\t\t\t\t<div class="taskStatus cvcColorSquare" status="STATUS_SUSPENDED" title="Suspended"></div>\n\t\t\t\t<div class="taskStatus cvcColorSquare" status="STATUS_WAITING" title="Waiting" style="display: none;"></div>\n\t\t\t\t<div class="taskStatus cvcColorSquare" status="STATUS_UNDEFINED" title="Undefined"></div>\n\t\t\t</div>'}}),this.ganttTemplateFunctions.push({type:'ASSIGNMENT_ROW',render:function render(obj){return '<tr taskId="'+obj.task.id+'" assId="'+obj.assig.id+'" class="assigEditRow">\n\t\t\t\t<td><select name="resourceId" class="formElements" '+(0==obj.assig.id.indexOf('tmp_')?'':'disabled')+'></select></td>\n\t\t\t\t<td><select type="select" name="roleId" class="formElements"></select></td>\n\t\t\t\t<td><input type="text" name="effort" value="'+getMillisInHoursMinutes(obj.assig.effort)+'" size="5" class="formElements"></td>\n\t\t\t\t<td align="center"><span class="teamworkIcon delAssig del" style="cursor: pointer">d</span></td>\n\t\t\t</tr>'}}),this.ganttTemplateFunctions.push({type:'RESOURCE_ROW',render:function render(obj){return '<tr resId="'+obj.id+'" class="resRow">\n\t\t\t\t<td><input type="text" name="name" value="'+obj.name+'" style="width:100%;" class="formElements"></td>\n\t\t\t\t<td align="center"><span class="teamworkIcon delRes del" style="cursor: pointer">d</span></td>\n\t\t\t</tr>'}}),this.ganttTemplateFunctions.push({type:'TASKEDITHEAD',render:function render(){return ''}}),this.ganttTemplateFunctions.push({type:'TASK_EDITOR',render:function render(){return ''}}),this.ganttTemplateFunctions.push({type:'RESOURCE_EDITOR',render:function render(){return ''}}),this.ganttTemplateFunctions.push({type:'RESOURCE_EDITOR',render:function render(){return ''}});}},{key:'makeTree',value:function makeTree(tasks){var parent=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{id:0};parent=_extends({},parent),'undefined'==typeof parent.children&&(parent.children=[]);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,child,_iterator=tasks[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)child=_step.value,child=_extends({},child),'undefined'==typeof child.parent&&(child.parent=0),child.parent===parent.id&&(child=this.makeTree(tasks,child),parent.children.push(child));}catch(err){_didIteratorError=!0,_iteratorError=err;}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return();}finally{if(_didIteratorError)throw _iteratorError}}return parent}},{key:'flattenTree',value:function flattenTree(tree){var flat=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,child,_iterator2=tree.children[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0)child=_step2.value,flat.push(child),flat=this.flattenTree(child,flat);}catch(err){_didIteratorError2=!0,_iteratorError2=err;}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return();}finally{if(_didIteratorError2)throw _iteratorError2}}return flat}},{key:'getBranchesWithStatus',value:function getBranchesWithStatus(moduleName,statuses,current){current=_extends({},current);var children=[];current.children=current.children.map(function(task){return task});var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,task,_iterator3=current.children[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0)task=_step3.value,children.push(this.getBranchesWithStatus(moduleName,statuses,task));}catch(err){_didIteratorError3=!0,_iteratorError3=err;}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return();}finally{if(_didIteratorError3)throw _iteratorError3}}return current.children=children,current}},{key:'filterProjectData',value:function filterProjectData(projectData){var newProjectData=Object.assign({},projectData),tree=this.makeTree(newProjectData.tasks);for(var moduleName in this.filter.status)this.filter.status.hasOwnProperty(moduleName)&&(tree=this.getBranchesWithStatus(moduleName,this.filter.status[moduleName],tree));return newProjectData.tasks=this.flattenTree(tree),newProjectData}},{key:'loadProject',value:function loadProject(projectData){return this.projectData=projectData,this.allTasks=this.projectData.tasks,'undefined'==typeof this.allTasks?($('.js-hide-filter').addClass('d-none'),void $('.js-show-add-record').removeClass('d-none')):void(this.statuses=this.projectData.statuses,this.filter={status:this.projectData.activeStatuses},this.gantt=new GanttMaster(this.ganttTemplateFunctions),this.gantt.resourceUrl='/libraries/jquery-gantt-editor/res/',this.gantt.init(this.container),0<this.allTasks.length&&(this.gantt.loadProject($.extend(!0,{},this.filterProjectData(this.projectData))),this.registerEvents()))}},{key:'loadProjectFromAjax',value:function loadProjectFromAjax(params){var _this=this,progressInstance=jQuery.progressIndicator({blockInfo:{enabled:!0}});AppConnector.request(params).done(function(response){_this.loadProject(response.result),progressInstance.progressIndicator({mode:'hide'});});}},{key:'reloadData',value:function reloadData(data){this.gantt.loadProject(data);}},{key:'saveFilter',value:function saveFilter(filterOptions){this.filter=filterOptions,this.reloadData(this.filterProjectData(this.projectData));}},{key:'getStatusFromValue',value:function getStatusFromValue(value,moduleName){var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,status,_iterator4=this.statuses[moduleName][Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0)if(status=_step4.value,status.value===value)return Object.assign({},status)}catch(err){_didIteratorError4=!0,_iteratorError4=err;}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return();}finally{if(_didIteratorError4)throw _iteratorError4}}app.errorLog('Status not found ['+value+']');}},{key:'showFiltersModal',value:function showFiltersModal(){var _this2=this,self=this,box=bootbox.dialog({show:'false',message:'<div class="js-gantt__filter-modal form" data-js="container">\n\t\t\t\t<div class="form-group">\n\t\t\t\t\t<label>'+app.vtranslate('JS_PROJECT_STATUSES','Project')+':</label>\n\t\t\t\t\t<select class="select2 form-control" id="js-gantt__filter-project" multiple>\n\t\t\t\t\t\t'+self.statuses.Project.map(function(status){return '<option value="'+status.value+'" '+(0<=_this2.filter.status.Project.map(function(status){return status.value}).indexOf(status.value)?'selected':'')+'>'+status.label+'</option>'})+'\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="form-group">\n\t\t\t\t<label>'+app.vtranslate('JS_MILESTONE_STATUSES','Project')+':</label>\n\t\t\t\t\t<select class="select2 form-control" id="js-gantt__filter-milestone" multiple>\n\t\t\t\t\t\t'+self.statuses.ProjectMilestone.map(function(status){return '<option value="'+status.value+'" '+(0<=_this2.filter.status.ProjectMilestone.map(function(status){return status.value}).indexOf(status.value)?'selected':'')+'>'+status.label+'</option>'})+'\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="form-group">\n\t\t\t\t<label>'+app.vtranslate('JS_TASK_STATUSES','Project')+':</label>\n\t\t\t\t\t<select class="select2 form-control" id="js-gantt__filter-task" multiple>\n\t\t\t\t\t\t'+self.statuses.ProjectTask.map(function(status){return '<option value="'+status.value+'" '+(0<=_this2.filter.status.ProjectTask.map(function(status){return status.value}).indexOf(status.value)?'selected':'')+'>'+status.label+'</option>'})+'\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t</div>',title:'<span class="fas fa-filter"></span> '+app.vtranslate('JS_FILTER_BY_STATUSES','Project'),buttons:{success:{label:'<span class="fas fa-check mr-1"></span>'+app.vtranslate('JS_UPDATE_GANTT','Project'),className:'btn-success',callback:function callback(){self.saveFilter({status:{Project:$('#js-gantt__filter-project',this).val().map(function(status){return self.getStatusFromValue(status,'Project')}),ProjectMilestone:$('#js-gantt__filter-milestone',this).val().map(function(status){return self.getStatusFromValue(status,'ProjectMilestone')}),ProjectTask:$('#js-gantt__filter-task',this).val().map(function(status){return self.getStatusFromValue(status,'ProjectTask')})}});}},danger:{label:'<span class="fas fa-times mr-1"></span>'+app.vtranslate('JS_CANCEL'),className:'btn-danger',callback:function callback(){}}}});App.Fields.Picklist.showSelect2ElementView($(box).find('.select2')),box.show();}},{key:'registerEvents',value:function registerEvents(){var container=this.container,self=this;container.find('.js-gantt__expand-all-btn',container).on('click',function(e){e.preventDefault(),container.trigger('expandAll.gantt');}),container.find('.js-gantt__collapse-all-btn',container).on('click',function(e){e.preventDefault(),container.trigger('collapseAll.gantt');}),container.find('.js-gantt__zoom-in-btn',container).on('click',function(e){e.preventDefault(),container.trigger('zoomPlus.gantt');}),container.find('.js-gantt__zoom-out-btn').on('click',function(e){e.preventDefault(),container.trigger('zoomMinus.gantt');}),container.find('.js-gantt__print-btn').on('click',function(e){e.preventDefault(),container.trigger('print.gantt');}),container.find('.js-gantt__show-critical-path-btn').on('click',function(e){e.preventDefault(),this.gantt.gantt.showCriticalPath=!gantt.gantt.showCriticalPath,this.gantt.redraw();}.bind(this)),container.find('.js-gantt__resize-0-btn').on('click',function(e){e.preventDefault(),this.gantt.splitter.resize(.1);}.bind(this)),container.find('.js-gantt__resize-50-btn').on('click',function(e){e.preventDefault(),this.gantt.splitter.resize(50);}.bind(this)),container.find('.js-gantt__resize-100-btn').on('click',function(e){e.preventDefault(),this.gantt.splitter.resize(100);}.bind(this)),container.find('.js-gantt__fullscreen-btn').on('click',function(e){e.preventDefault(),container.trigger('fullScreen.gantt');}.bind(this)),container.find('.js-gantt__front-filter').on('click',function(e){e.preventDefault(),self.showFiltersModal();}),container.find('[data-toggle="tooltip"]').tooltip();}}]),Gantt}();
//# sourceMappingURL=Gantt.min.js.map
