"use strict";Vtiger_List_Js("Settings_Users_List_Js",{deleteRecord:function(deleteRecordActionUrl){var message=app.vtranslate("LBL_DELETE_USER_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:message}).done((function(data){AppConnector.request(deleteRecordActionUrl).done((function(data){if(data){var callback=function(data){app.validationEngineOptions.onValidationComplete=function(form,valid){return valid&&Settings_Users_List_Js.deleteUser(form),!1},jQuery("#deleteUser").validationEngine(app.validationEngineOptions)};app.showModalWindow(data,(function(data){callback()}))}}))})).fail((function(error,err){console.error(error,err)}))},deleteUser:function(form){var listInstance=Vtiger_List_Js.getInstance(),userid=form.find('[name="userid"]').val(),transferUserId=form.find('[name="tranfer_owner_id"]').val(),progressInstance=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}}),params={module:app.getModuleName(),action:"DeleteAjax",transfer_user_id:transferUserId,userid:userid,permanent:jQuery('[name="deleteUserPermanent"]:checked',form).val()};AppConnector.request(params).done((function(data){if(data.success){app.hideModalWindow(),progressInstance.progressIndicator({mode:"hide"});var orderBy=jQuery("#orderBy").val(),sortOrder=jQuery("#sortOrder").val(),urlParams={viewname:data.result.viewname,orderby:orderBy,sortorder:sortOrder};jQuery("#recordsCount").val(""),jQuery("#totalPageCount").text(""),listInstance.getListViewRecords(urlParams).done((function(){listInstance.updatePagination()})),params={title:app.vtranslate("JS_MESSAGE"),text:data.result.message,type:"success"},Vtiger_Helper_Js.showPnotify(params)}}))},deleteUserPermanently:function(userId,e){e.stopPropagation();var message=app.vtranslate("LBL_DELETE_USER_PERMANENT_CONFIRMATION"),deleteRecordActionUrl="index.php?module="+app.getModuleName()+"&parent="+app.getParentModuleName()+"&view=DeleteUser&mode=permanent&record="+userId;Vtiger_Helper_Js.showConfirmationBox({message:message}).done((function(data){AppConnector.request(deleteRecordActionUrl).done((function(data){if(data){var callback=function(data){app.validationEngineOptions.onValidationComplete=function(form,valid){if(valid){var progressInstance=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}}),params={module:app.getModuleName(),action:"DeleteAjax",userid:userId,transfer_user_id:form.find('[name="tranfer_owner_id"]').val(),mode:"permanent"};app.hideModalWindow(),AppConnector.request(params).done((function(response){response.success&&(progressInstance.progressIndicator({mode:"hide"}),params={title:app.vtranslate("JS_MESSAGE"),text:response.result.message,type:"error"},Vtiger_Helper_Js.showPnotify(params),jQuery("[data-id="+userId+"]").hide())}))}return!1},jQuery("#deleteUser").validationEngine(app.validationEngineOptions)};app.showModalWindow(data,(function(data){callback()}))}}))}))},restoreUser:function(userId,e){e.stopPropagation(),Vtiger_Helper_Js.showConfirmationBox({message:app.vtranslate("LBL_RESTORE_CONFIRMATION")}).done((function(){var progressInstance=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}}),params={module:app.getModuleName(),action:"SaveAjax",userid:userId,mode:"restoreUser"};AppConnector.request(params).done((function(response){if(response.success){progressInstance.progressIndicator({mode:"hide"}),Vtiger_Helper_Js.showPnotify(response.result.message);var url=response.result.listViewUrl;window.location.href=url}}))}))},triggerMassOff2FA:function(){var url=window.location.href,listInstance=Settings_Vtiger_List_Js.getInstance();!0!==listInstance.checkListRecordSelected()?Vtiger_Helper_Js.showConfirmationBox({message:app.vtranslate("JS_2FA_OFF_CONFIRMATION")}).done((function(){var progressIndicatorElement=jQuery.progressIndicator({message:app.vtranslate("JS_2FA_OFF_IN_PROGRESS"),position:"html",blockInfo:{enabled:!0}});AppConnector.request({module:"Users",action:"TwoFactorAuthentication",selected_ids:listInstance.readSelectedIds(!0),excluded_ids:listInstance.readExcludedIds(!0),mode:"massOff"}).done((function(data){progressIndicatorElement.progressIndicator({mode:"hide"}),data.error&&Vtiger_Helper_Js.showPnotify({text:app.vtranslate(data.error.message),title:app.vtranslate("JS_LBL_PERMISSION")}),window.location.href=url}))})).fail((function(error,err){Vtiger_List_Js.clearList()})):listInstance.noRecordSelectedAlert()}},{getPageJumpParams:function(){return{module:app.getModuleName(),view:"ListAjax",mode:"getPageCount",search_params:jQuery("#usersFilter").val()}},registerDeleteRecordClickEvent:function(){this.getListViewContentContainer().on("click",".deleteRecordButton",(function(e){var rowElement=jQuery(e.currentTarget).closest("tr"),deleteActionUrl=jQuery('[name="deleteActionUrl"]',rowElement).val();Settings_Users_List_Js.deleteRecord(deleteActionUrl),e.stopPropagation()}))},usersFilter:function(){var _this=this;$("#usersFilter").on("change",(function(){var progressInstance=$.progressIndicator({position:"html",blockInfo:{enabled:!0}});AppConnector.request({module:app.getModuleName(),view:"List",parent:app.getParentModuleName(),search_params:$("#usersFilter").val()}).done((function(data){progressInstance.progressIndicator({mode:"hide"}),$(".js-fixed-thead").floatThead("destroy"),$("#listViewContents").html(data),_this.updatePaginationFilter();var listSearchInstance=_this.getListSearchInstance();!1!==listSearchInstance?listSearchInstance.registerEvents():App.Fields.Picklist.showSelect2ElementView($("#listViewContents").find("select.select2"))}))}))},updatePaginationFilter:function(){var self=this,container=this.getListViewContainer();AppConnector.request({page:1,module:app.getModuleName(),parent:app.getParentModuleName(),view:"Pagination",mode:"getPagination",search_params:container.find("#usersFilter").val(),noOfEntries:container.find("#noOfEntries").val()}).done((function(data){container.find(".paginationDiv").html(data),self.registerPageNavigationEvents()}))},updatePagination:function(pageNumber){pageNumber=void 0!==pageNumber?pageNumber:1;var thisInstance=this,params={};params.module=app.getModuleName(),params.parent=app.getParentModuleName(),params.view="Pagination",params.page=pageNumber,params.mode="getPagination",params.search_key=this.getAlphabetSearchField(),params.search_value=this.getAlphabetSearchValue(),params.operator="s",params.search_params=JSON.stringify(this.getListSearchInstance().getListSearchParams()),params.noOfEntries=jQuery("#noOfEntries").val(),AppConnector.request(params).done((function(data){jQuery(".paginationDiv").html(data),thisInstance.registerPageNavigationEvents()}))},registerEvents:function(){this._super(),this.usersFilter(),this.registerDeleteRecordClickEvent()}});
//# sourceMappingURL=List.min.js.map
