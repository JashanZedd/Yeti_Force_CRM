{"version":3,"file":"Currency.min.js","sources":["Currency.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\njQuery.Class('Settings_Currency_Js', {\n\n\t//holds the currency instance\n\tcurrencyInstance: false,\n\n\t/**\n\t * This function used to triggerAdd Currency\n\t */\n\ttriggerAdd: function (event) {\n\t\tevent.stopPropagation();\n\t\tvar instance = Settings_Currency_Js.currencyInstance;\n\t\tinstance.showEditView();\n\t},\n\n\t/**\n\t * This function used to trigger Edit Currency\n\t */\n\ttriggerEdit: function (event, id) {\n\t\tevent.stopPropagation();\n\t\tvar instance = Settings_Currency_Js.currencyInstance;\n\t\tinstance.showEditView(id);\n\t},\n\n\t/**\n\t * This function used to trigger default currency\n\t * @param {object} event\n\t * @param {int} id\n\t */\n\ttriggerDefault: function (event, id) {\n\t\tevent.stopPropagation();\n\t\tVtiger_Helper_Js.showConfirmationBox({message: app.vtranslate('JS_CURRENCY_DEFAULT_CONFIRMED')}).done(function (data) {\n\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({position: 'html', blockInfo: {enabled: true}});\n\t\t\tapp.saveAjax('setDefault', null, {record: id}).done(function (data) {\n\t\t\t\tprogressIndicatorElement.progressIndicator({mode: 'hide'});\n\t\t\t\tSettings_Vtiger_Index_Js.showMessage({text: app.vtranslate('JS_CURRENCY_DETAILS_SAVED')});\n\t\t\t\tSettings_Currency_Js.currencyInstance.loadListViewContents();\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * This function used to trigger Delete Currency\n\t */\n\ttriggerDelete: function (event, id) {\n\t\tevent.stopPropagation();\n\t\tvar currentTarget = jQuery(event.currentTarget);\n\t\tvar currentTrEle = currentTarget.closest('tr');\n\t\tvar instance = Settings_Currency_Js.currencyInstance;\n\t\tinstance.transformEdit(id).done(function (data) {\n\t\t\tvar callBackFunction = function (data) {\n\t\t\t\tvar form = jQuery('#transformCurrency');\n\n\t\t\t\t//register all select2 Elements\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(form.find('select.select2'));\n\n\t\t\t\tform.on('submit', function (e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tvar transferCurrencyEle = form.find('select[name=\"transform_to_id\"]');\n\t\t\t\t\tinstance.deleteCurrency(id, transferCurrencyEle, currentTrEle);\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tapp.showModalWindow(data, function (data) {\n\t\t\t\tif (typeof callBackFunction == 'function') {\n\t\t\t\t\tcallBackFunction(data);\n\t\t\t\t}\n\t\t\t}, {'width': '500px'});\n\t\t});\n\t}\n\n}, {\n\n\t//constructor\n\tinit: function () {\n\t\tSettings_Currency_Js.currencyInstance = this;\n\t},\n\n\t/*\n\t * function to show editView for Add/Edit Currency\n\t * @params: id - currencyId\n\t */\n\tshowEditView: function (id) {\n\t\tvar thisInstance = this;\n\t\tvar aDeferred = jQuery.Deferred();\n\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tvar params = {};\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['view'] = 'EditAjax';\n\t\tparams['record'] = id;\n\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tvar callBackFunction = function (data) {\n\t\t\t\tvar form = jQuery('#editCurrency');\n\t\t\t\tvar record = form.find('[name=\"record\"]').val();\n\n\t\t\t\t//register all select2 Elements\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(form.find('select.select2'));\n\t\t\t\tvar currencyStatus = form.find('[name=\"currency_status\"]').is(':checked');\n\t\t\t\tif (record != '' && currencyStatus) {\n\t\t\t\t\t//While editing currency, register the status change event\n\t\t\t\t\tthisInstance.registerCurrencyStatusChangeEvent(form);\n\t\t\t\t}\n\t\t\t\t//If we change the currency name, change the code and symbol for that currency\n\t\t\t\tthisInstance.registerCurrencyNameChangeEvent(form);\n\n\t\t\t\tvar params = app.validationEngineOptions;\n\t\t\t\tparams.onValidationComplete = function (form, valid) {\n\t\t\t\t\tif (valid) {\n\t\t\t\t\t\tthisInstance.saveCurrencyDetails(form);\n\t\t\t\t\t\treturn valid;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tform.validationEngine(params);\n\n\t\t\t\tform.on('submit', function (e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\tapp.showModalWindow(data, function (data) {\n\t\t\t\tif (typeof callBackFunction == 'function') {\n\t\t\t\t\tcallBackFunction(data);\n\t\t\t\t}\n\t\t\t}, {'width': '600px'});\n\t\t}).fail(function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.reject(error);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\n\t/**\n\t * Register Change event for currency status\n\t */\n\tregisterCurrencyStatusChangeEvent: function (form) {\n\t\t/*If the status changed to Inactive while editing currency,\n\t\t currency should transfer to other existing currencies */\n\t\tform.find('[name=\"currency_status\"]').on('change', function (e) {\n\t\t\tvar currentTarget = jQuery(e.currentTarget);\n\t\t\tif (currentTarget.is(':checked')) {\n\t\t\t\tform.find('div.transferCurrency').addClass('d-none');\n\t\t\t} else {\n\t\t\t\tform.find('div.transferCurrency').removeClass('d-none');\n\t\t\t}\n\t\t})\n\t},\n\n\t/**\n\t * Register Change event for currency Name\n\t */\n\tregisterCurrencyNameChangeEvent: function (form) {\n\t\tvar currencyNameEle = form.find('select[name=\"currency_name\"]');\n\t\t//on change of currencyName, update the currency code & symbol\n\t\tcurrencyNameEle.on('change', function () {\n\t\t\tvar selectedCurrencyOption = currencyNameEle.find('option:selected');\n\t\t\tform.find('[name=\"currency_code\"]').val(selectedCurrencyOption.data('code'));\n\t\t\tform.find('[name=\"currency_symbol\"]').val(selectedCurrencyOption.data('symbol'));\n\t\t})\n\t},\n\n\t/**\n\t * This function will save the currency details\n\t */\n\tsaveCurrencyDetails: function (form) {\n\t\tvar thisInstance = this;\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tvar data = form.serializeFormData();\n\t\tdata['module'] = app.getModuleName();\n\t\tdata['parent'] = app.getParentModuleName();\n\t\tdata['action'] = 'SaveAjax';\n\t\tdata['mode'] = 'save';\n\n\t\tAppConnector.request(data).done(function (data) {\n\t\t\tif (data['success']) {\n\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t\tapp.hideModalWindow();\n\t\t\t\tvar params = {};\n\t\t\t\tparams.text = app.vtranslate('JS_CURRENCY_DETAILS_SAVED');\n\t\t\t\tSettings_Vtiger_Index_Js.showMessage(params);\n\t\t\t\tthisInstance.loadListViewContents();\n\t\t\t}\n\t\t}).fail(function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t});\n\t},\n\n\t/**\n\t * This function will load the listView contents after Add/Edit currency\n\t */\n\tloadListViewContents: function () {\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tvar params = {};\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['view'] = 'List';\n\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t//replace the new list view contents\n\t\t\tjQuery('#listViewContents').html(data);\n\t\t\t//thisInstance.triggerDisplayTypeEvent();\n\t\t}).fail(function (error, err) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t});\n\t},\n\n\t/**\n\t * This function will show the Transform Currency view while delete the currency\n\t */\n\ttransformEdit: function (id) {\n\t\tvar aDeferred = jQuery.Deferred();\n\n\t\tvar params = {};\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['view'] = 'TransformEditAjax';\n\t\tparams['record'] = id;\n\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error, err) {\n\t\t\taDeferred.reject(error, err);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\n\t/**\n\t * This function will delete the currency and save the transferCurrency details\n\t */\n\tdeleteCurrency: function (id, transferCurrencyEle, currentTrEle) {\n\t\tvar transferCurrencyId = transferCurrencyEle.find('option:selected').val();\n\t\tvar params = {};\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['action'] = 'DeleteAjax';\n\t\tparams['record'] = id;\n\t\tparams['transform_to_id'] = transferCurrencyId;\n\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tapp.hideModalWindow();\n\t\t\tvar params = {};\n\t\t\tparams.text = app.vtranslate('JS_CURRENCY_DELETED_SUCCESSFULLY');\n\t\t\tSettings_Vtiger_Index_Js.showMessage(params);\n\t\t\tcurrentTrEle.fadeOut('slow').remove();\n\t\t});\n\t},\n\n\ttriggerDisplayTypeEvent: function () {\n\t\tvar widthType = app.cacheGet('widthType', 'narrowWidthType');\n\t\tif (widthType) {\n\t\t\tvar elements = jQuery('.listViewEntriesTable').find('td,th');\n\t\t\telements.attr('class', widthType);\n\t\t}\n\t},\n\n\tregisterRowClick: function () {\n\t\tvar thisInstance = this;\n\t\tjQuery('#listViewContents').on('click', '.listViewEntries', function (e) {\n\t\t\tvar currentRow = jQuery(e.currentTarget);\n\t\t\tif (currentRow.find('.fas fa-edit ').length <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthisInstance.showEditView(currentRow.data('id'));\n\t\t})\n\t},\n\n\tregisterEvents: function () {\n\t\tthis.registerRowClick();\n\t}\n\n});\n\njQuery(document).ready(function () {\n\tvar currencyInstance = new Settings_Currency_Js();\n\tcurrencyInstance.registerEvents();\n})\n"],"names":["jQuery","Class","event","stopPropagation","Settings_Currency_Js","currencyInstance","showEditView","id","showConfirmationBox","message","app","vtranslate","done","data","progressIndicatorElement","progressIndicator","position","blockInfo","enabled","saveAjax","record","mode","showMessage","text","loadListViewContents","currentTrEle","currentTarget","closest","instance","transformEdit","callBackFunction","form","Fields","Picklist","showSelect2ElementView","find","on","e","preventDefault","transferCurrencyEle","deleteCurrency","showModalWindow","width","this","thisInstance","aDeferred","Deferred","params","getModuleName","getParentModuleName","request","val","currencyStatus","is","registerCurrencyStatusChangeEvent","registerCurrencyNameChangeEvent","validationEngineOptions","onValidationComplete","valid","saveCurrencyDetails","validationEngine","fail","error","reject","promise","addClass","removeClass","currencyNameEle","selectedCurrencyOption","serializeFormData","hideModalWindow","html","err","resolve","transferCurrencyId","fadeOut","remove","widthType","cacheGet","attr","currentRow","length","registerRowClick","document","ready","registerEvents"],"mappings":"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"}