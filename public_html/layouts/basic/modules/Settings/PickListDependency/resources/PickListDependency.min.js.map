{"version":3,"file":"PickListDependency.min.js","sources":["PickListDependency.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\njQuery.Class('Settings_PickListDependency_Js', {\n\t//holds the picklist dependency instance\n\tpickListDependencyInstance: false,\n\t/**\n\t * Function used to triggerAdd new Dependency for the picklists\n\t */\n\ttriggerAdd: function (event) {\n\t\tevent.stopPropagation();\n\t\tvar instance = Settings_PickListDependency_Js.pickListDependencyInstance;\n\t\tinstance.updatedSourceValues = [];\n\t\tinstance.showEditView(instance.listViewForModule).done(function (data) {\n\t\t\tinstance.registerAddViewEvents();\n\t\t});\n\t},\n\t/**\n\t * This function used to trigger Edit picklist dependency\n\t */\n\ttriggerEdit: function (event, module, sourceField, targetField) {\n\t\tevent.stopPropagation();\n\t\tvar instance = Settings_PickListDependency_Js.pickListDependencyInstance;\n\t\tinstance.updatedSourceValues = [];\n\t\tinstance.showEditView(module, sourceField, targetField).done(\n\t\t\tfunction (data) {\n\t\t\t\tvar form = jQuery('#pickListDependencyForm');\n\t\t\t\tform.find('select[name=\"sourceModule\"],select[name=\"sourceField\"],select[name=\"targetField\"]').prop(\"disabled\", true);\n\t\t\t\tinstance.registerDependencyGraphEvents();\n\t\t\t\tinstance.registerSubmitEvent();\n\t\t\t}\n\t\t);\n\t},\n\t/**\n\t * This function used to trigger Delete picklist dependency\n\t */\n\ttriggerDelete: function (event, module, sourceField, targetField) {\n\t\tevent.stopPropagation();\n\t\tvar currentTarget = jQuery(event.currentTarget);\n\t\tvar currentTrEle = currentTarget.closest('tr');\n\t\tvar instance = Settings_PickListDependency_Js.pickListDependencyInstance;\n\n\t\tvar message = app.vtranslate('JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE');\n\t\tVtiger_Helper_Js.showConfirmationBox({'message': message}).done(function (e) {\n\t\t\tinstance.deleteDependency(module, sourceField, targetField).done(function (data) {\n\t\t\t\tvar params = {};\n\t\t\t\tparams.text = app.vtranslate('JS_DEPENDENCY_DELETED_SUEESSFULLY');\n\t\t\t\tSettings_Vtiger_Index_Js.showMessage(params);\n\t\t\t\tcurrentTrEle.fadeOut('slow').remove();\n\t\t\t});\n\t\t});\n\t}\n\n}, {\n\t//constructor\n\tinit: function () {\n\t\tSettings_PickListDependency_Js.pickListDependencyInstance = this;\n\t},\n\t//holds the listview forModule\n\tlistViewForModule: '',\n\t//holds the updated sourceValues while editing dependency\n\tupdatedSourceValues: [],\n\t//holds the new mapping of source values and target values\n\tvalueMapping: [],\n\t//holds the list of selected source values for dependency\n\tselectedSourceValues: [],\n\t/*\n\t * function to show editView for Add/Edit Dependency\n\t * @params: module - selected module\n\t *\t\t\tsourceField - source picklist\n\t *\t\t\ttargetField - target picklist\n\t */\n\tshowEditView: function (module, sourceField, targetField) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tvar params = {};\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['view'] = 'Edit';\n\t\tparams['sourceModule'] = module;\n\t\tparams['sourcefield'] = sourceField;\n\t\tparams['targetfield'] = targetField;\n\n\t\tAppConnector.requestPjax(params).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\tvar container = jQuery('.contentsDiv');\n\t\t\tcontainer.html(data);\n\t\t\t//register all select2 Elements\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(container.find('select.select2'), {dropdownCss: {'z-index': 0}});\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.reject(error);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\t/**\n\t * Function to get the Dependency graph based on selected module\n\t */\n\tgetModuleDependencyGraph: function (form) {\n\t\tvar thisInstance = this;\n\t\tform.find('[name=\"sourceModule\"]').on('change', function () {\n\t\t\tvar forModule = form.find('[name=\"sourceModule\"]').val();\n\t\t\tthisInstance.showEditView(forModule).done(function (data) {\n\t\t\t\tthisInstance.registerAddViewEvents();\n\t\t\t});\n\t\t});\n\t},\n\t/**\n\t * Register change event for picklist fields in add/edit picklist dependency\n\t */\n\tregisterPicklistFieldsChangeEvent: function (form) {\n\t\tvar thisInstance = this;\n\t\tform.find('[name=\"sourceField\"],[name=\"targetField\"]').on('change', function () {\n\t\t\tthisInstance.checkValuesForDependencyGraph(form);\n\t\t});\n\t},\n\t/**\n\t * Function used to check the selected picklist fields are valid before showing dependency graph\n\t */\n\tcheckValuesForDependencyGraph: function (form) {\n\t\tvar thisInstance = this;\n\t\tvar sourceField = form.find('[name=\"sourceField\"]');\n\t\tvar targetField = form.find('[name=\"targetField\"]');\n\t\tvar select2SourceField = app.getSelect2ElementFromSelect(sourceField);\n\t\tvar select2TargetField = app.getSelect2ElementFromSelect(targetField);\n\t\tvar sourceFieldValue = sourceField.val();\n\t\tvar targetFieldValue = targetField.val();\n\t\tvar dependencyGraph = jQuery('#dependencyGraph');\n\t\tif (sourceFieldValue != '' && targetFieldValue != '') {\n\t\t\tvar resultMessage = app.vtranslate('JS_SOURCE_AND_TARGET_FIELDS_SHOULD_NOT_BE_SAME');\n\t\t\tform.find('.errorMessage').addClass('d-none');\n\t\t\tif (sourceFieldValue == targetFieldValue) {\n\t\t\t\tselect2TargetField.validationEngine('showPrompt', resultMessage, 'error', 'topLeft', true);\n\t\t\t\tdependencyGraph.html('');\n\t\t\t} else {\n\t\t\t\tselect2SourceField.validationEngine('hide');\n\t\t\t\tselect2TargetField.validationEngine('hide');\n\t\t\t\tvar sourceModule = form.find('[name=\"sourceModule\"]').val();\n\t\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t\t'position': 'html',\n\t\t\t\t\t'blockInfo': {\n\t\t\t\t\t\t'enabled': true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthisInstance.checkCyclicDependency(sourceModule, sourceFieldValue, targetFieldValue).done(function (data) {\n\t\t\t\t\tvar result = data['result'];\n\t\t\t\t\tif (!result['result']) {\n\t\t\t\t\t\tthisInstance.addNewDependencyPickList(sourceModule, sourceFieldValue, targetFieldValue);\n\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t\t\t\tform.find('.errorMessage').removeClass('d-none');\n\t\t\t\t\t\tform.find('.cancelAddView').removeClass('d-none');\n\t\t\t\t\t\tdependencyGraph.html('');\n\t\t\t\t\t}\n\t\t\t\t}).fail(function (error, err) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tform.find('.errorMessage').addClass('d-none');\n\t\t\tvar result = app.vtranslate('JS_SELECT_SOME_VALUE');\n\t\t\tif (sourceFieldValue == '') {\n\t\t\t\tselect2SourceField.validationEngine('showPrompt', result, 'error', 'topLeft', true);\n\t\t\t} else if (targetFieldValue == '') {\n\t\t\t\tselect2TargetField.validationEngine('showPrompt', result, 'error', 'topLeft', true);\n\t\t\t}\n\t\t}\n\t},\n\t/**\n\t * Function used to check the cyclic dependency of the selected picklist fields\n\t * @params: sourceModule - selected module\n\t *            sourceFieldValue - source picklist value\n\t *            targetFieldValue - target picklist value\n\t */\n\tcheckCyclicDependency: function (sourceModule, sourceFieldValue, targetFieldValue) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar params = {};\n\t\tparams['mode'] = 'checkCyclicDependency';\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['action'] = 'Index';\n\t\tparams['sourceModule'] = sourceModule;\n\t\tparams['sourcefield'] = sourceFieldValue;\n\t\tparams['targetfield'] = targetFieldValue;\n\n\t\tAppConnector.request(params).done(\n\t\t\tfunction (data) {\n\t\t\t\taDeferred.resolve(data);\n\t\t\t}, function (error, err) {\n\t\t\t\taDeferred.reject();\n\t\t\t}\n\t\t);\n\t\treturn aDeferred.promise();\n\t},\n\t/**\n\t * Function used to show the new picklist dependency graph\n\t * @params: sourceModule - selected module\n\t *            sourceFieldValue - source picklist value\n\t *            targetFieldValue - target picklist value\n\t */\n\taddNewDependencyPickList: function (sourceModule, sourceFieldValue, targetFieldValue) {\n\t\tvar thisInstance = this;\n\t\tvar dependencyGraph = $('#dependencyGraph');\n\t\tthisInstance.updatedSourceValues = [];\n\t\tAppConnector.request({\n\t\t\tmode: 'getDependencyGraph',\n\t\t\tmodule: app.getModuleName(),\n\t\t\tparent: app.getParentModuleName(),\n\t\t\tview: 'IndexAjax',\n\t\t\tsourceModule: sourceModule,\n\t\t\tsourcefield: sourceFieldValue,\n\t\t\ttargetfield: targetFieldValue\n\t\t}).done(function (data) {\n\t\t\tdependencyGraph.html(data).css({'padding': '10px', 'border': '1px solid #ddd', 'background': '#fff'});\n\t\t\tthisInstance.registerDependencyGraphEvents();\n\t\t});\n\t},\n\t/**\n\t * This function will delete the pickList Dependency\n\t * @params: module - selected module\n\t *            sourceField - source picklist value\n\t *            targetField - target picklist value\n\t */\n\tdeleteDependency: function (module, sourceField, targetField) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar params = {};\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['action'] = 'DeleteAjax';\n\t\tparams['sourceModule'] = module;\n\t\tparams['sourcefield'] = sourceField;\n\t\tparams['targetfield'] = targetField;\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error, err) {\n\t\t\t\taDeferred.reject(error, err);\n\t\t\t}\n\t\t);\n\t\treturn aDeferred.promise();\n\t},\n\t/**\n\t * Function used to show cancel link in add view and register click event for cancel\n\t */\n\tregisterCancelAddView: function (form) {\n\t\tvar thisInstance = this;\n\t\tvar cancelDiv = form.find('.cancelAddView');\n\t\tcancelDiv.removeClass('d-none');\n\t\tcancelDiv.find('.cancelLink').on('click', function () {\n\t\t\tthisInstance.loadListViewContents(thisInstance.listViewForModule);\n\t\t})\n\t},\n\t/**\n\t * Register all the events related to addView of picklist dependency\n\t */\n\tregisterAddViewEvents: function () {\n\t\tvar thisInstance = this;\n\t\tvar form = jQuery('#pickListDependencyForm');\n\t\tthisInstance.registerCancelAddView(form);\n\t\tthisInstance.getModuleDependencyGraph(form);\n\t\tthisInstance.registerPicklistFieldsChangeEvent(form);\n\t\tthisInstance.registerSubmitEvent();\n\t},\n\t/**\n\t * Register all the events in editView of picklist dependency\n\t */\n\tregisterDependencyGraphEvents: function () {\n\t\tvar thisInstance = this;\n\t\tvar form = jQuery('#pickListDependencyForm');\n\t\tvar dependencyGraph = jQuery('#dependencyGraph');\n\t\tform.find('.cancelAddView').addClass('d-none');\n\t\tthisInstance.registerTargetFieldsClickEvent(dependencyGraph);\n\t\tthisInstance.registerTargetFieldsUnmarkAll(dependencyGraph);\n\t\tthisInstance.registerSelectSourceValuesClick(dependencyGraph);\n\t\tthisInstance.registerCancelDependency(form);\n\t},\n\t/**\n\t * Register all the events related to listView of picklist dependency\n\t */\n\tregisterListViewEvents: function () {\n\t\tvar thisInstance = this;\n\t\tvar forModule = jQuery('.contentsDiv').find('.pickListSupportedModules').val();\n\t\tthisInstance.listViewForModule = forModule;\n\t\t//thisInstance.triggerDisplayTypeEvent();\n\t\tthisInstance.registerSourceModuleChangeEvent();\n\t},\n\t/**\n\t * Register the click event for cancel picklist dependency changes\n\t */\n\tregisterCancelDependency: function (form) {\n\t\tvar thisInstance = this;\n\t\t//Register click event for cancel link\n\t\tvar cancelDependencyLink = form.find('.cancelDependency');\n\t\tcancelDependencyLink.on('click', function () {\n\t\t\tthisInstance.loadListViewContents(thisInstance.listViewForModule);\n\t\t})\n\t},\n\t/**\n\t * Register the click event for target fields in dependency graph\n\t */\n\tregisterTargetFieldsClickEvent: function (dependencyGraph) {\n\t\tvar thisInstance = this;\n\t\tthisInstance.updatedSourceValues = [];\n\t\tdependencyGraph.find('td.picklistValueMapping').on('click', function (e) {\n\t\t\tvar currentTarget = jQuery(e.currentTarget);\n\t\t\tvar sourceValue = currentTarget.data('sourceValue');\n\t\t\tif (jQuery.inArray(sourceValue, thisInstance.updatedSourceValues) == -1) {\n\t\t\t\tthisInstance.updatedSourceValues.push(sourceValue);\n\t\t\t}\n\t\t\tif (currentTarget.hasClass('selectedCell')) {\n\t\t\t\tcurrentTarget.addClass('unselectedCell').removeClass('selectedCell');\n\t\t\t} else {\n\t\t\t\tcurrentTarget.addClass('selectedCell').removeClass('unselectedCell');\n\t\t\t}\n\t\t});\n\t},\n\tregisterTargetFieldsUnmarkAll: function (dependencyGraph) {\n\t\tvar thisInstance = this;\n\t\tthisInstance.updatedSourceValues = [];\n\t\tdependencyGraph.find('.unmarkAll').on('click', function (e) {\n\t\t\tdependencyGraph.find('td.picklistValueMapping').each(function (index) {\n\t\t\t\tvar currentTarget = jQuery(this);\n\t\t\t\tvar sourceValue = currentTarget.data('sourceValue');\n\t\t\t\tif (jQuery.inArray(sourceValue, thisInstance.updatedSourceValues) == -1) {\n\t\t\t\t\tthisInstance.updatedSourceValues.push(sourceValue);\n\t\t\t\t}\n\t\t\t\tcurrentTarget.addClass('unselectedCell').removeClass('selectedCell');\n\t\t\t});\n\t\t});\n\t},\n\t/**\n\t * Function used to update the value mapping to save the picklist dependency\n\t */\n\tupdateValueMapping: function (dependencyGraph) {\n\t\tvar thisInstance = this;\n\t\tthisInstance.valueMapping = [];\n\t\tvar sourceValuesArray = thisInstance.updatedSourceValues;\n\t\tvar dependencyTable = dependencyGraph.find('.pickListDependencyTable');\n\t\tfor (var key in sourceValuesArray) {\n\t\t\tlet encodedSourceValue;\n\t\t\tif (typeof sourceValuesArray[key] == 'string') {\n\t\t\t\tencodedSourceValue = sourceValuesArray[key].replace(/\"/g, '\\\\\"');\n\t\t\t} else {\n\t\t\t\tencodedSourceValue = sourceValuesArray[key];\n\t\t\t}\n\t\t\tvar selectedTargetValues = dependencyTable.find('td[data-source-value=\"' + encodedSourceValue + '\"]').filter('.selectedCell');\n\t\t\tvar targetValues = [];\n\t\t\tif (selectedTargetValues.length > 0) {\n\t\t\t\tjQuery.each(selectedTargetValues, function (index, element) {\n\t\t\t\t\ttargetValues.push(jQuery(element).data('targetValue'));\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\ttargetValues.push('');\n\t\t\t}\n\t\t\tthisInstance.valueMapping.push({'sourcevalue': sourceValuesArray[key], 'targetvalues': targetValues});\n\t\t}\n\t},\n\t/**\n\t * Register click event for select source values button in add/edit view\n\t */\n\tregisterSelectSourceValuesClick(dependencyGraph) {\n\t\tdependencyGraph.find('button.sourceValues').on('click', () => {\n\t\t\tconst selectSourceValues = dependencyGraph.find('.modalCloneCopy');\n\t\t\tconst clonedContainer = selectSourceValues.clone(true, true).removeClass('modalCloneCopy');\n\t\t\tapp.showModalWindow(clonedContainer, (data) => {\n\t\t\t\tdata.find('.sourcePicklistValuesModal').removeClass('d-none');\n\t\t\t\tdata.find('[name=\"saveButton\"]').on('click', (e) => {\n\t\t\t\t\tthis.selectedSourceValues = [];\n\t\t\t\t\tconst sourceValues = data.find('.sourceValue');\n\t\t\t\t\t$.each(sourceValues, (index, ele) => {\n\t\t\t\t\t\tconst element = $(ele);\n\t\t\t\t\t\tconst elementId = element.attr('id');\n\t\t\t\t\t\tconst hiddenElement = selectSourceValues.find('#' + elementId);\n\t\t\t\t\t\tif (element.is(':checked')) {\n\t\t\t\t\t\t\tthis.selectedSourceValues.push(element.val());\n\t\t\t\t\t\t\thiddenElement.prop('checked', true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\thiddenElement.prop('checked', false);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\tthis.loadMappingForSelectedValues(dependencyGraph);\n\t\t\t\t});\n\t\t\t}, {'width': '1000px'});\n\t\t});\n\t},\n\t/**\n\t * Function used to load mapping for selected picklist fields\n\t */\n\tloadMappingForSelectedValues: function (dependencyGraph) {\n\t\tvar thisInstance = this;\n\t\tvar allSourcePickListValues = JSON.parse(dependencyGraph.find('.allSourceValues').val());\n\t\tvar dependencyTable = dependencyGraph.find('.pickListDependencyTable');\n\t\tfor (var key in allSourcePickListValues) {\n\t\t\tif (typeof allSourcePickListValues[key] == 'string') {\n\t\t\t\tvar encodedSourcePickListValue = allSourcePickListValues[key].replace(/\"/g, '\\\\\"');\n\t\t\t} else {\n\t\t\t\tencodedSourcePickListValue = allSourcePickListValues[key];\n\t\t\t}\n\t\t\tvar mappingCells = dependencyTable.find('[data-source-value=\"' + encodedSourcePickListValue + '\"]');\n\t\t\tif (jQuery.inArray(allSourcePickListValues[key], thisInstance.selectedSourceValues) == -1) {\n\t\t\t\tmappingCells.hide();\n\t\t\t} else {\n\t\t\t\tmappingCells.show();\n\t\t\t}\n\t\t}\n\t},\n\t/**\n\t * This function will save the picklist dependency details\n\t */\n\tsavePickListDependency: function(form) {\n\t\tconst self = this;\n\t\tlet progressIndicatorElement = $.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t}),\n\t\t\tparams = form.serializeFormData();\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['action'] = 'SaveAjax';\n\t\tparams['mapping'] = JSON.stringify(self.valueMapping);\n\t\tAppConnector.request(params).done(function(data) {\n\t\t\tif (data['success']) {\n\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\ttext: app.vtranslate('JS_PICKLIST_DEPENDENCY_SAVED'),\n\t\t\t\t\ttype: 'success'\n\t\t\t\t});\n\t\t\t\tself.loadListViewContents(params['sourceModule']);\n\t\t\t}\n\t\t}).fail(function(error) {\n\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t});\n\t},\n\t/**\n\t * This function will load the listView contents after Add/Edit picklist dependency\n\t */\n\tloadListViewContents: function (forModule) {\n\t\tvar thisInstance = this;\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tvar params = {};\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['view'] = 'List';\n\t\tparams['formodule'] = forModule;\n\n\t\tAppConnector.requestPjax(params).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t//replace the new list view contents\n\t\t\tjQuery('.contentsDiv').html(data);\n\t\t\tApp.Fields.Picklist.changeSelectElementView(jQuery('.contentsDiv'));\n\t\t\tthisInstance.registerListViewEvents();\n\t\t}).fail(function (error, err) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t});\n\t},\n\t/**\n\t * trigger the display type event to show the width\n\t */\n\ttriggerDisplayTypeEvent: function () {\n\t\tvar widthType = app.cacheGet('widthType', 'narrowWidthType');\n\t\tif (widthType) {\n\t\t\tvar elements = jQuery('.listViewEntriesTable').find('td,th');\n\t\t\telements.attr('class', widthType);\n\t\t}\n\t},\n\t/**\n\t * register change event for source module in add/edit picklist dependency\n\t */\n\tregisterSourceModuleChangeEvent: function () {\n\t\tvar thisInstance = this;\n\t\tvar container = jQuery('.contentsDiv');\n\t\tcontainer.find('.pickListSupportedModules').on('change', function (e) {\n\t\t\tvar currentTarget = jQuery(e.currentTarget);\n\t\t\tvar forModule = currentTarget.val();\n\t\t\tthisInstance.loadListViewContents(forModule);\n\t\t});\n\t},\n\t/**\n\t * register the form submit event\n\t */\n\tregisterSubmitEvent: function () {\n\t\tvar thisInstance = this;\n\t\tvar form = jQuery('#pickListDependencyForm');\n\t\tvar dependencyGraph = jQuery('#dependencyGraph');\n\t\tform.on('submit', function (e) {\n\t\t\te.preventDefault();\n\t\t\ttry {\n\t\t\t\tthisInstance.updateValueMapping(dependencyGraph);\n\t\t\t} catch (e) {\n\t\t\t\tbootbox.alert(e.message);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (form.find('.editDependency').val() != \"true\" && thisInstance.valueMapping.length < 1) {\n\t\t\t\tvar params = {};\n\t\t\t\tparams.text = app.vtranslate('JS_PICKLIST_DEPENDENCY_NO_SAVED');\n\t\t\t\tparams.type = 'info';\n\t\t\t\tSettings_Vtiger_Index_Js.showMessage(params);\n\t\t\t} else {\n\t\t\t\tthisInstance.savePickListDependency(form);\n\t\t\t}\n\n\t\t});\n\t},\n\t/**\n\t * register events for picklist dependency\n\t */\n\tregisterEvents: function () {\n\t\tvar thisInstance = this;\n\t\tvar form = jQuery('#pickListDependencyForm');\n\t\tif (form.length > 0) {\n\t\t\tif (form.find('.editDependency').val() == \"true\") {\n\t\t\t\tform.find('select[name=\"sourceModule\"],select[name=\"sourceField\"],select[name=\"targetField\"]').prop(\"disabled\", true);\n\t\t\t\tthisInstance.registerDependencyGraphEvents();\n\t\t\t\tthisInstance.registerSubmitEvent();\n\t\t\t} else {\n\t\t\t\tthisInstance.registerAddViewEvents();\n\t\t\t}\n\t\t} else {\n\t\t\tthisInstance.registerListViewEvents();\n\t\t}\n\t}\n\n});\n\njQuery(document).ready(function () {\n\tvar instance = new Settings_PickListDependency_Js();\n\tinstance.registerEvents();\n})\n"],"names":["jQuery","Class","event","stopPropagation","instance","Settings_PickListDependency_Js","pickListDependencyInstance","updatedSourceValues","showEditView","listViewForModule","done","data","registerAddViewEvents","module","sourceField","targetField","find","prop","registerDependencyGraphEvents","registerSubmitEvent","currentTrEle","currentTarget","closest","message","app","vtranslate","showConfirmationBox","e","deleteDependency","params","text","showMessage","fadeOut","remove","this","aDeferred","Deferred","progressIndicatorElement","progressIndicator","getModuleName","getParentModuleName","requestPjax","mode","container","html","Fields","Picklist","showSelect2ElementView","dropdownCss","z-index","resolve","fail","error","reject","promise","form","thisInstance","on","forModule","val","checkValuesForDependencyGraph","select2SourceField","getSelect2ElementFromSelect","select2TargetField","sourceFieldValue","targetFieldValue","dependencyGraph","resultMessage","addClass","validationEngine","sourceModule","checkCyclicDependency","removeClass","addNewDependencyPickList","err","result","request","$","css","padding","border","background","cancelDiv","loadListViewContents","registerCancelAddView","getModuleDependencyGraph","registerPicklistFieldsChangeEvent","registerTargetFieldsClickEvent","registerTargetFieldsUnmarkAll","registerSelectSourceValuesClick","registerCancelDependency","registerSourceModuleChangeEvent","sourceValue","inArray","push","hasClass","each","index","valueMapping","sourceValuesArray","dependencyTable","key","encodedSourceValue","replace","selectedTargetValues","filter","targetValues","length","element","sourcevalue","targetvalues","selectSourceValues","clonedContainer","clone","showModalWindow","selectedSourceValues","sourceValues","ele","elementId","attr","hiddenElement","is","hideModalWindow","loadMappingForSelectedValues","width","allSourcePickListValues","JSON","parse","encodedSourcePickListValue","mappingCells","hide","show","self","serializeFormData","stringify","changeSelectElementView","registerListViewEvents","widthType","cacheGet","preventDefault","updateValueMapping","alert","type","savePickListDependency","document","ready","registerEvents"],"mappings":"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"}