"use strict";Settings_Vtiger_Edit_Js("Settings_Workflows_Edit_Js",{instance:{}},{currentInstance:!1,workFlowsContainer:!1,init:function(){this.initiate()},getContainer:function(){return this.workFlowsContainer},setContainer:function(element){return this.workFlowsContainer=element,this},getInstance:function(step){if(step in Settings_Workflows_Edit_Js.instance)return Settings_Workflows_Edit_Js.instance[step];var moduleClassName="Settings_Workflows_Edit"+step+"_Js";return Settings_Workflows_Edit_Js.instance[step]=new window[moduleClassName],Settings_Workflows_Edit_Js.instance[step]},getStepValue:function(){var container=this.currentInstance.getContainer();return jQuery(".step",container).val()},initiate:function(container){void 0===container&&(container=jQuery(".workFlowContents")),container.is(".workFlowContents")?this.setContainer(container):this.setContainer(jQuery(".workFlowContents",container)),this.initiateStep("1"),this.currentInstance.registerEvents()},initiateStep:function(stepVal){var step="step"+stepVal;this.activateHeader(step);var currentInstance=this.getInstance(stepVal);this.currentInstance=currentInstance},activateHeader:function(step){var headersContainer=jQuery(".crumbs ");headersContainer.find(".active").removeClass("active"),jQuery("#"+step,headersContainer).addClass("active")},registerFormSubmitEvent:function(form){var thisInstance=this;jQuery.isFunction(thisInstance.currentInstance.submit)&&form.on("submit",(function(e){var specialValidation=!0;jQuery.isFunction(thisInstance.currentInstance.isFormValidate)&&(specialValidation=thisInstance.currentInstance.isFormValidate()),jQuery(e.currentTarget).validationEngine("validate")&&specialValidation&&thisInstance.currentInstance.submit().done((function(data){thisInstance.getContainer().append(data),thisInstance.initiateStep(parseInt(thisInstance.getStepValue())+1),thisInstance.currentInstance.initialize(),thisInstance.registerFormSubmitEvent(thisInstance.currentInstance.getContainer()),thisInstance.currentInstance.registerEvents()})),e.preventDefault()}))},back:function(){var step=this.getStepValue(),prevStep=parseInt(step)-1;this.currentInstance.initialize();var container=this.currentInstance.getContainer(),workFlowId=jQuery('[name="record"]',container).val();container.remove(),this.initiateStep(prevStep);var currentContainer=this.currentInstance.getContainer();currentContainer.show(),jQuery('[name="record"]',currentContainer).val(workFlowId);var modulesList=jQuery("#moduleName",currentContainer);modulesList.length>0&&""!=workFlowId&&modulesList.attr("disabled","disabled").trigger("change")},getPopUp:function(container){var _this=this;void 0===container&&(container=this.getContainer()),container.on("click",".getPopupUi",(function(e){if(6==container.find('[name="execution_condition"]').val())return!1;var fieldValueElement=jQuery(e.currentTarget),fieldValue=fieldValueElement.val(),fieldUiHolder=fieldValueElement.closest(".fieldUiHolder"),valueType=fieldUiHolder.find('[name="valuetype"]').val();""===valueType&&(valueType="rawtext");var conditionsContainer=fieldValueElement.closest(".js-conditions-container"),conditionRow=fieldValueElement.closest(".js-conditions-row"),clonedPopupUi=conditionsContainer.find(".popupUi").clone(!0,!0).removeClass("popupUi").addClass("clonedPopupUi");clonedPopupUi.find("select").addClass("select2"),clonedPopupUi.find(".fieldValue").val(fieldValue);var value=void 0;if(fieldValueElement.hasClass("date")){clonedPopupUi.find(".textType").find('option[value="rawtext"]').attr("data-ui","input");var dataFormat=fieldValueElement.data("date-format"),clonedDateElement='<input type="text" class="dateField fieldValue col-md-4 form-control" value="'+(value="rawtext"===valueType?fieldValueElement.val():"")+'" data-date-format="'+dataFormat+'" data-input="true" >';clonedPopupUi.find(".fieldValueContainer").prepend(clonedDateElement)}else if(fieldValueElement.hasClass("time")){clonedPopupUi.find(".textType").find('option[value="rawtext"]').attr("data-ui","input");var clonedTimeElement='<input type="text" class="timepicker-default fieldValue col-md-4 form-control" value="'+(value="rawtext"===valueType?fieldValueElement.val():"")+'" data-input="true" >';clonedPopupUi.find(".fieldValueContainer").prepend(clonedTimeElement)}else if(fieldValueElement.hasClass("boolean")){clonedPopupUi.find(".textType").find('option[value="rawtext"]').attr("data-ui","input");var clonedBooleanElement='<input type="checkbox" class="fieldValue col-md-4 form-control" value="'+(value="rawtext"===valueType?fieldValueElement.val():"")+'" data-input="true" >';clonedPopupUi.find(".fieldValueContainer").prepend(clonedBooleanElement),"true:boolean"===value||""===value?clonedPopupUi.find(".fieldValueContainer input").attr("checked","checked"):clonedPopupUi.find(".fieldValueContainer input").removeAttr("checked")}conditionsContainer.find(".clonedPopUp").html(clonedPopupUi);var clonedPopupElement=$(".clonedPopUp",conditionsContainer).find(".clonedPopupUi");$(".clonedPopupUi",conditionsContainer).on("shown.bs.modal",(function(){var data=$(".clonedPopupUi",conditionsContainer);data.find(".clonedPopupUi").removeClass("d-none");var moduleNameElement=conditionRow.find('[name="modulename"]');if(moduleNameElement.length>0){var moduleName=moduleNameElement.val();data.find(".useFieldElement").addClass("d-none"),data.find('[name="'+moduleName+'"]').removeClass("d-none")}App.Fields.Picklist.changeSelectElementView(data),App.Fields.Date.register(data),app.registerEventForClockPicker(data),_this.postShowModalAction(data,valueType),_this.registerChangeFieldEvent(data),_this.registerSelectOptionEvent(data),_this.registerPopUpSaveEvent(data,fieldUiHolder),data.find(".fieldValue").filter(":visible").trigger("focus"),clonedPopupElement.find('[data-close-modal="modal"], [data-dismiss="modal"]').off("click").on("click",(function(e){e.preventDefault(),e.stopPropagation(),$(this).closest(".modal").removeClass("in").css("display","none")}))})),clonedPopupElement.modal()}))},registerRemoveModalEvent:function(data){data.on("click",".closeModal",(function(e){data.modal("hide")}))},registerPopUpSaveEvent:function(data,fieldUiHolder){jQuery('[name="saveButton"]',data).on("click",(function(e){var valueType=jQuery(".textType",data).val();fieldUiHolder.find('[name="valuetype"]').val(valueType);var fieldValueElement=fieldUiHolder.find(".getPopupUi");"rawtext"!=valueType?(fieldValueElement.removeAttr("data-validation-engine"),fieldValueElement.removeClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]")):(fieldValueElement.addClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]"),fieldValueElement.attr("data-validation-engine","validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]"));var fieldType=data.find(".fieldValue").filter(":visible").attr("type"),fieldValue=data.find(".fieldValue").filter(":visible").val();"checkbox"==fieldType&&(fieldValue=data.find(".fieldValue").filter(":visible").is(":checked")?"true:boolean":"false:boolean"),fieldValueElement.val(fieldValue),fieldValueElement.validationEngine("hide"),data.remove()}))},registerSelectOptionEvent:function(data){$(".useField,.useFunction",data).on("change",(function(e){var currentElement=$(e.currentTarget),newValue=currentElement.val(),oldValue=data.find(".fieldValue").filter(":visible").val(),concatenatedValue=void 0;concatenatedValue=currentElement.hasClass("useField")?""!=oldValue?oldValue+" "+newValue:newValue:oldValue+newValue,data.find(".fieldValue").val(concatenatedValue),currentElement.val("").trigger("change.select2")}))},registerChangeFieldEvent:function(data){jQuery(".textType",data).on("change",(function(e){var valueType=jQuery(e.currentTarget).val(),useFieldContainer=jQuery(".useFieldContainer",data),useFunctionContainer=jQuery(".useFunctionContainer",data),uiType=jQuery(e.currentTarget).find("option:selected").data("ui");jQuery(".fieldValue",data).hide(),jQuery("[data-"+uiType+"]",data).show(),"fieldname"==valueType?(useFieldContainer.removeClass("d-none"),useFunctionContainer.addClass("d-none")):"expression"==valueType?(useFieldContainer.removeClass("d-none"),useFunctionContainer.removeClass("d-none")):(useFieldContainer.addClass("d-none"),useFunctionContainer.addClass("d-none")),jQuery(".helpmessagebox",data).addClass("d-none"),jQuery("#"+valueType+"_help",data).removeClass("d-none"),data.find(".fieldValue").val("")}))},postShowModalAction:function(data,valueType){"fieldname"==valueType?(jQuery(".useFieldContainer",data).removeClass("d-none"),jQuery(".textType",data).val(valueType).trigger("change")):"expression"==valueType&&(jQuery(".useFieldContainer",data).removeClass("d-none"),jQuery(".useFunctionContainer",data).removeClass("d-none"),jQuery(".textType",data).val(valueType).trigger("change")),jQuery("#"+valueType+"_help",data).removeClass("d-none");var uiType=jQuery(".textType",data).find("option:selected").data("ui");jQuery(".fieldValue",data).hide(),jQuery("[data-"+uiType+"]",data).show()},registerBackStepClickEvent:function(){var thisInstance=this;this.getContainer().on("click",".backStep",(function(e){thisInstance.back()}))},registerEvents:function(){var form=this.currentInstance.getContainer();this.registerFormSubmitEvent(form),this.registerBackStepClickEvent()}});
//# sourceMappingURL=Edit.min.js.map
