"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Settings_Roles_Js={newPriviliges:!1,initDeleteView:function(){jQuery("#roleDeleteForm").validationEngine(app.validationEngineOptions),jQuery('[data-action="popup"]').on("click",(function(e){e.preventDefault();var target=$(e.currentTarget),field=target.data("field"),popupInstance=Vtiger_Popup_Js.getInstance();popupInstance.show(target.data("url")),popupInstance.retrieveSelectedRecords((function(data){try{data=JSON.parse(data)}catch(e){}"object"==(void 0===data?"undefined":_typeof(data))&&(jQuery('[name="'+field+'_display"]').val(data.label),data=data.value),jQuery('[name="'+field+'"]').val(data)}))})),jQuery("#clearRole").on("click",(function(e){jQuery('[name="transfer_record_display"]').val(""),jQuery('[name="transfer_record"]').val("")}))},initPopupView:function(){jQuery(".roleEle").on("click",(function(e){var target=$(e.currentTarget);jQuery.triggerParentEvent("postSelection",JSON.stringify({value:target.closest("li").data("roleid"),label:target.text()})),self.close()}))},initEditView:function(){jQuery('[rel="tooltip"]').tooltip(),jQuery('[data-action="modal"]').on("click",(function(event){var target=$(event.currentTarget);app.showModalWindow(null,target.data("url"),(function(data){Settings_Roles_Js.initDeleteView()}))})),jQuery(".toolbar").hide(),jQuery(".toolbar-handle").on("mouseover",(function(e){var target=$(e.currentTarget);jQuery(".toolbar",target).css({display:"inline"})})),jQuery(".toolbar-handle").on("mouseout",(function(e){var target=$(e.currentTarget);jQuery(".toolbar",target).hide()})),jQuery(".draggable").draggable({containment:".treeView",start:function(event,ui){var referenceid=jQuery(ui.helper).data("refid"),sourceRoleId=jQuery('[data-grouprefid="'+referenceid+'"]').data("roleid");if("H5"==sourceRoleId||"H2"==sourceRoleId){var params={};params.title=app.vtranslate("JS_PERMISSION_DENIED"),params.text=app.vtranslate("JS_NO_PERMISSIONS_TO_MOVE"),params.type="error",Settings_Vtiger_Index_Js.showMessage(params)}},helper:function(event){var targetGroup=$(event.currentTarget).closest("li"),timestamp=+new Date,container=$("<div/>");return container.data("refid",timestamp),container.html(targetGroup.clone()),targetGroup.attr("data-grouprefid",timestamp),container}}),jQuery(".droppable").droppable({hoverClass:"btn-primary",tolerance:"pointer",drop:function(event,ui){var params,referenceid=$(ui.helper).data("refid"),sourceGroup=$('[data-grouprefid="'+referenceid+'"]'),thisWrapper=$(this).closest("div"),targetRole=thisWrapper.closest("li").data("role"),targetRoleId=thisWrapper.closest("li").data("roleid"),sourceRole=sourceGroup.data("role"),sourceRoleId=sourceGroup.data("roleid");0!=targetRole.indexOf(sourceRole+"::")&&("H5"!=sourceRoleId&&"H2"!=sourceRoleId&&(sourceGroup.appendTo(thisWrapper.next("ul")),params={module:"Roles",action:"MoveAjax",parent:"Settings",record:sourceRoleId,parent_roleid:targetRoleId},AppConnector.request(params).done((function(res){res.success||(app.showAlert(app.vtranslate("JS_FAILED_TO_SAVE")),window.location.reload())}))))}})},registerSubmitEvent:function(){var thisInstance=this,form=jQuery("#EditView");form.on("submit",(function(e){if("true"==form.data("submit")&&"true"==form.data("performCheck"))return!0;var selectElement=jQuery("#profilesList"),select2Element=app.getSelect2ElementFromSelect(selectElement),result=Vtiger_MultiSelect_Validator_Js.invokeValidation(selectElement);if(1!=result)return select2Element.validationEngine("showPrompt",result,"error","bottomLeft",!0),void e.preventDefault();if(select2Element.validationEngine("hide"),form.data("jqv").InvalidFields.length<=0){var formData=form.serializeFormData();thisInstance.checkDuplicateName({rolename:formData.rolename,record:formData.record}).done((function(data){form.data("submit","true"),form.data("performCheck","true"),form.submit(),jQuery.progressIndicator({blockInfo:{enabled:!0}})})).fail((function(data,err){var params={};return params.text=data.message,params.type="error",Settings_Vtiger_Index_Js.showMessage(params),!1}))}else form.removeData("submit"),app.formAlignmentAfterValidation(form);e.preventDefault()}))},checkDuplicateName:function(details){var aDeferred=jQuery.Deferred(),params={module:app.getModuleName(),parent:app.getParentModuleName(),action:"EditAjax",mode:"checkDuplicate",rolename:details.rolename,record:details.record};return AppConnector.request(params).done((function(data){var response=data.result;1==response.success?aDeferred.reject(response):aDeferred.resolve(response)})).fail((function(error,err){aDeferred.reject(error,err)})),aDeferred.promise()},registerModalUploadButton:function(){var thisInstance=this;$(".js-upload-logo").on("click",(function(){app.showModalWindow(null,$(this).data("url"),(function(data){thisInstance.registerUploadButton(data.find("form"))}))}))},registerUploadButton:function(form){form.on("submit",(function(e){if(e.preventDefault(),!0===form.validationEngine("validate")){app.removeEmptyFilesInput(form[0]);var formData=new FormData(form[0]),progressIndicatorElement=jQuery.progressIndicator({blockInfo:{enabled:!0}}),notifyType="";AppConnector.request({url:"index.php",type:"POST",data:formData,processData:!1,contentType:!1}).done((function(data){progressIndicatorElement.progressIndicator({mode:"hide"}),notifyType=!0===data.result.success?"success":"error",Vtiger_Helper_Js.showPnotify({title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate(data.result.message),type:notifyType}),app.hideModalWindow()}))}}))},registerEvents:function(){Settings_Roles_Js.registerModalUploadButton(),Settings_Roles_Js.initEditView(),Settings_Roles_Js.registerSubmitEvent()}};jQuery(document).ready((function(){Settings_Roles_Js.registerEvents()}));
//# sourceMappingURL=Roles.min.js.map
