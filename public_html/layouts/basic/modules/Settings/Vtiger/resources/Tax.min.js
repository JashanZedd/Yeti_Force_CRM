"use strict";jQuery.Class("Settings_Vtiger_Tax_Js",{},{duplicateCheckCache:{},editTax:function(url,currentTrElement){var aDeferred=jQuery.Deferred(),thisInstance=this,progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}});return AppConnector.request(url).done((function(data){var callBackFunction=function(data){thisInstance.duplicateCheckCache={};var form=jQuery("#editTax"),params=app.validationEngineOptions;params.onValidationComplete=function(form,valid){if(valid)return thisInstance.saveTaxDetails(form,currentTrElement),valid},form.validationEngine(params),form.on("submit",(function(e){e.preventDefault()}))};progressIndicatorElement.progressIndicator({mode:"hide"}),app.showModalWindow(data,(function(data){callBackFunction()}),{width:"500px"})})).fail((function(error){aDeferred.reject(error)})),aDeferred.promise()},saveTaxDetails:function(form,currentTrElement){var thisInstance=this,params=form.serializeFormData();void 0===params&&(params={}),thisInstance.validateTaxName(params).done((function(data){var progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}});params.module=app.getModuleName(),params.parent=app.getParentModuleName(),params.action="TaxAjax",AppConnector.request(params).done((function(data){progressIndicatorElement.progressIndicator({mode:"hide"}),app.hideModalWindow(),"true"==form.find(".addTaxView").val()?thisInstance.addTaxDetails(data.result):thisInstance.updateTaxDetails(data.result,currentTrElement);var params={text:app.vtranslate("JS_TAX_SAVED_SUCCESSFULLY")};Settings_Vtiger_Index_Js.showMessage(params)}))}))},addTaxDetails:function(details){var container=jQuery("#TaxCalculationsContainer"),taxTable=void 0;taxTable="0"===details.type?jQuery(".inventoryTaxTable",container):jQuery(".shippingTaxTable",container);var trElementForTax=jQuery('<tr class="opacity" data-taxid="'+details.taxid+'" data-taxtype="'+details.type+'"><td style="border-left: none;" class="textAlignCenter '+details.row_type+'"><label class="taxLabel">'+details.taxlabel+'</label></td><td style="border-left: none;" class="textAlignCenter '+details.row_type+'"><span class="taxPercentage">'+details.percentage+'%</span></td><td style="border-left: none;" class="textAlignCenter '+details.row_type+'"><input class="editTaxStatus" type="checkbox" checked><div class="pull-right actions"><a class="editTax u-cursor-pointer" data-url="'+details._editurl+'"><i class="fas fa-edit alignBottom" title="'+app.vtranslate("JS_EDIT")+'"></i></a></div></td></tr>');taxTable.append(trElementForTax)},updateTaxDetails:function(data,currentTrElement){currentTrElement.find(".taxLabel").text(data.taxlabel),currentTrElement.find(".taxPercentage").text(data.percentage+"%"),"0"==data.deleted?currentTrElement.find(".editTaxStatus").attr("checked","true"):currentTrElement.find(".editTaxStatus").removeAttr("checked")},validateTaxName:function(data){var thisInstance=this,aDeferred=jQuery.Deferred(),taxName=data.taxlabel,taxLabelElement=jQuery("#editTax").find('[name="taxlabel"]');if(taxName in thisInstance.duplicateCheckCache)if(1==thisInstance.duplicateCheckCache[taxName]){var result=thisInstance.duplicateCheckCache.message;taxLabelElement.validationEngine("showPrompt",result,"error","bottomLeft",!0),aDeferred.reject()}else aDeferred.resolve();else thisInstance.checkDuplicateName(data).done((function(data){thisInstance.duplicateCheckCache[taxName]=data.success,aDeferred.resolve()})).fail((function(data,err){thisInstance.duplicateCheckCache[taxName]=data.success,thisInstance.duplicateCheckCache.message=data.message,taxLabelElement.validationEngine("showPrompt",data.message,"error","bottomLeft",!0),aDeferred.reject(data)}));return aDeferred.promise()},checkDuplicateName:function(details){var aDeferred=jQuery.Deferred(),taxName=details.taxlabel,taxId=details.taxid,params={module:app.getModuleName(),parent:app.getParentModuleName(),action:"TaxAjax",mode:"checkDuplicateName",taxlabel:taxName,taxid:taxId,type:details.type};return AppConnector.request(params).done((function(data){var response=data.result;1==response.success?aDeferred.reject(response):aDeferred.resolve(response)})).fail((function(error,err){aDeferred.reject(error,err)})),aDeferred.promise()},updateTaxStatus:function(currentTarget){var aDeferred=jQuery.Deferred(),currentTrElement=currentTarget.closest("tr"),taxId=currentTrElement.data("taxid"),taxType=currentTrElement.data("taxtype"),deleted=currentTarget.is(":checked")?0:1,progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}}),params={module:app.getModuleName(),parent:app.getParentModuleName(),action:"TaxAjax",taxid:taxId,type:taxType,deleted:deleted};return AppConnector.request(params).done((function(data){progressIndicatorElement.progressIndicator({mode:"hide"}),aDeferred.resolve(data)})).fail((function(error,err){progressIndicatorElement.progressIndicator({mode:"hide"}),aDeferred.reject(error)})),aDeferred.promise()},registerActions:function(){var thisInstance=this,container=jQuery("#TaxCalculationsContainer");container.find(".addTax").on("click",(function(e){var addTaxButton=jQuery(e.currentTarget),createTaxUrl=addTaxButton.data("url")+"&type="+addTaxButton.data("type");thisInstance.editTax(createTaxUrl)})),container.on("click",".editTax",(function(e){var editTaxButton=jQuery(e.currentTarget),currentTrElement=editTaxButton.closest("tr");thisInstance.editTax(editTaxButton.data("url"),currentTrElement)})),container.on("click",".editTaxStatus",(function(e){var currentTarget=jQuery(e.currentTarget);thisInstance.updateTaxStatus(currentTarget).done((function(data){var params={};currentTarget.is(":checked")?params.text=app.vtranslate("JS_TAX_ENABLED"):params.text=app.vtranslate("JS_TAX_DISABLED"),Settings_Vtiger_Index_Js.showMessage(params)}))}))},registerEvents:function(){this.registerActions()}}),jQuery(document).ready((function(e){(new Settings_Vtiger_Tax_Js).registerEvents()}));
//# sourceMappingURL=Tax.min.js.map
