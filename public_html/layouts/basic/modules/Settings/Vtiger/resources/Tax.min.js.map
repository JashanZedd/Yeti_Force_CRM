{"version":3,"file":"Tax.min.js","sources":["Tax.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\njQuery.Class(\"Settings_Vtiger_Tax_Js\", {}, {\n\n\t//Stored history of TaxName and duplicate check result\n\tduplicateCheckCache: {},\n\n\t/**\n\t * This function will show the model for Add/Edit tax\n\t */\n\teditTax: function (url, currentTrElement) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar thisInstance = this;\n\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tAppConnector.request(url).done(function (data) {\n\t\t\tvar callBackFunction = function (data) {\n\t\t\t\t//cache should be empty when modal opened\n\t\t\t\tthisInstance.duplicateCheckCache = {};\n\t\t\t\tvar form = jQuery('#editTax');\n\n\t\t\t\tvar params = app.validationEngineOptions;\n\t\t\t\tparams.onValidationComplete = function (form, valid) {\n\t\t\t\t\tif (valid) {\n\t\t\t\t\t\tthisInstance.saveTaxDetails(form, currentTrElement);\n\t\t\t\t\t\treturn valid;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tform.validationEngine(params);\n\n\t\t\t\tform.on('submit', function (e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\tapp.showModalWindow(data, function (data) {\n\t\t\t\tif (typeof callBackFunction == 'function') {\n\t\t\t\t\tcallBackFunction(data);\n\t\t\t\t}\n\t\t\t}, {'width': '500px'});\n\t\t}).fail(function (error) {\n\t\t\taDeferred.reject(error);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\n\t/*\n\t * Function to Save the Tax Details\n\t */\n\tsaveTaxDetails: function (form, currentTrElement) {\n\t\tvar thisInstance = this;\n\t\tvar params = form.serializeFormData();\n\n\t\tif (typeof params === \"undefined\") {\n\t\t\tparams = {};\n\t\t}\n\t\tthisInstance.validateTaxName(params).done(function (data) {\n\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t'position': 'html',\n\t\t\t\t'blockInfo': {\n\t\t\t\t\t'enabled': true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tparams.module = app.getModuleName();\n\t\t\tparams.parent = app.getParentModuleName();\n\t\t\tparams.action = 'TaxAjax';\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t\tapp.hideModalWindow();\n\t\t\t\t//Adding or update the tax details in the list\n\t\t\t\tif (form.find('.addTaxView').val() == \"true\") {\n\t\t\t\t\tthisInstance.addTaxDetails(data['result']);\n\t\t\t\t} else {\n\t\t\t\t\tthisInstance.updateTaxDetails(data['result'], currentTrElement);\n\t\t\t\t}\n\t\t\t\t//show notification after tax details saved\n\t\t\t\tvar params = {\n\t\t\t\t\ttext: app.vtranslate('JS_TAX_SAVED_SUCCESSFULLY')\n\t\t\t\t};\n\t\t\t\tSettings_Vtiger_Index_Js.showMessage(params);\n\t\t\t});\n\t\t});\n\t},\n\n\t/*\n\t * Function to add the Tax Details in the list after saving\n\t */\n\taddTaxDetails: function (details) {\n\t\tlet container = jQuery('#TaxCalculationsContainer'),\n\t\t\ttaxTable;\n\n\t\t//Based on tax type, we will add the tax details row\n\t\tif (details.type === '0') {\n\t\t\ttaxTable = jQuery('.inventoryTaxTable', container);\n\t\t} else {\n\t\t\ttaxTable = jQuery('.shippingTaxTable', container);\n\t\t}\n\n\t\tlet trElementForTax =\n\t\t\tjQuery('<tr class=\"opacity\" data-taxid=\"' + details.taxid + '\" data-taxtype=\"' +\n\t\t\t\tdetails.type + '\"><td style=\"border-left: none;\" class=\"textAlignCenter ' +\n\t\t\t\tdetails.row_type + '\"><label class=\"taxLabel\">' + details.taxlabel +\n\t\t\t\t'</label></td><td style=\"border-left: none;\" class=\"textAlignCenter ' +\n\t\t\t\tdetails.row_type + '\"><span class=\"taxPercentage\">' + details.percentage +\n\t\t\t\t'%</span></td><td style=\"border-left: none;\" class=\"textAlignCenter ' +\n\t\t\t\tdetails.row_type + '\"><input class=\"editTaxStatus\" type=\"checkbox\" checked>' +\n\t\t\t\t'<div class=\"pull-right actions\"><a class=\"editTax u-cursor-pointer\" data-url=\"' +\n\t\t\t\tdetails._editurl + '\"><i class=\"fas fa-edit alignBottom\" title=\"' +\n\t\t\t\tapp.vtranslate('JS_EDIT') + '\"></i></a></div></td></tr>');\n\t\ttaxTable.append(trElementForTax);\n\t},\n\n\t/*\n\t * Function to update the tax details in the list after edit\n\t */\n\tupdateTaxDetails: function (data, currentTrElement) {\n\t\tcurrentTrElement.find('.taxLabel').text(data['taxlabel']);\n\t\tcurrentTrElement.find('.taxPercentage').text(data['percentage'] + '%');\n\t\tif (data['deleted'] == '0') {\n\t\t\tcurrentTrElement.find('.editTaxStatus').attr('checked', 'true');\n\t\t} else {\n\t\t\tcurrentTrElement.find('.editTaxStatus').removeAttr('checked');\n\t\t}\n\t},\n\n\t/*\n\t * Function to validate the TaxName to avoid duplicates\n\t */\n\tvalidateTaxName: function (data) {\n\t\tvar thisInstance = this;\n\t\tvar aDeferred = jQuery.Deferred();\n\n\t\tvar taxName = data.taxlabel;\n\t\tvar form = jQuery('#editTax');\n\t\tvar taxLabelElement = form.find('[name=\"taxlabel\"]');\n\n\t\tif (!(taxName in thisInstance.duplicateCheckCache)) {\n\t\t\tthisInstance.checkDuplicateName(data).done(function (data) {\n\t\t\t\tthisInstance.duplicateCheckCache[taxName] = data['success'];\n\t\t\t\taDeferred.resolve();\n\t\t\t}).fail(function (data, err) {\n\t\t\t\tthisInstance.duplicateCheckCache[taxName] = data['success'];\n\t\t\t\tthisInstance.duplicateCheckCache['message'] = data['message'];\n\t\t\t\ttaxLabelElement.validationEngine('showPrompt', data['message'], 'error', 'bottomLeft', true);\n\t\t\t\taDeferred.reject(data);\n\t\t\t});\n\t\t} else {\n\t\t\tif (thisInstance.duplicateCheckCache[taxName] == true) {\n\t\t\t\tvar result = thisInstance.duplicateCheckCache['message'];\n\t\t\t\ttaxLabelElement.validationEngine('showPrompt', result, 'error', 'bottomLeft', true);\n\t\t\t\taDeferred.reject();\n\t\t\t} else {\n\t\t\t\taDeferred.resolve();\n\t\t\t}\n\t\t}\n\t\treturn aDeferred.promise();\n\t},\n\n\t/*\n\t * Function to check Duplication of Tax Name\n\t */\n\tcheckDuplicateName: function (details) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar taxName = details.taxlabel;\n\t\tvar taxId = details.taxid;\n\t\tvar moduleName = app.getModuleName();\n\t\tvar params = {\n\t\t\t'module': moduleName,\n\t\t\t'parent': app.getParentModuleName(),\n\t\t\t'action': 'TaxAjax',\n\t\t\t'mode': 'checkDuplicateName',\n\t\t\t'taxlabel': taxName,\n\t\t\t'taxid': taxId,\n\t\t\t'type': details.type\n\t\t}\n\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tvar response = data['result'];\n\t\t\tvar result = response['success'];\n\t\t\tif (result == true) {\n\t\t\t\taDeferred.reject(response);\n\t\t\t} else {\n\t\t\t\taDeferred.resolve(response);\n\t\t\t}\n\t\t}).fail(function (error, err) {\n\t\t\taDeferred.reject(error, err);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\n\t/*\n\t * Function to update tax status as enabled or disabled\n\t */\n\tupdateTaxStatus: function (currentTarget) {\n\t\tvar aDeferred = jQuery.Deferred();\n\n\t\tvar currentTrElement = currentTarget.closest('tr');\n\t\tvar taxId = currentTrElement.data('taxid');\n\t\tvar taxType = currentTrElement.data('taxtype');\n\t\tvar deleted = currentTarget.is(':checked') ? 0 : 1;\n\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tvar params = {\n\t\t\t'module': app.getModuleName(),\n\t\t\t'parent': app.getParentModuleName(),\n\t\t\t'action': 'TaxAjax',\n\t\t\t'taxid': taxId,\n\t\t\t'type': taxType,\n\t\t\t'deleted': deleted\n\t\t}\n\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error, err) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.reject(error);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\n\t/*\n\t * Function to register all actions in the Tax List\n\t */\n\tregisterActions: function () {\n\t\tvar thisInstance = this;\n\t\tvar container = jQuery('#TaxCalculationsContainer');\n\n\t\t//register click event for Add New Tax button\n\t\tcontainer.find('.addTax').on('click', function (e) {\n\t\t\tvar addTaxButton = jQuery(e.currentTarget);\n\t\t\tvar createTaxUrl = addTaxButton.data('url') + '&type=' + addTaxButton.data('type');\n\t\t\tthisInstance.editTax(createTaxUrl);\n\t\t});\n\n\t\t//register event for edit tax icon\n\t\tcontainer.on('click', '.editTax', function (e) {\n\t\t\tvar editTaxButton = jQuery(e.currentTarget);\n\t\t\tvar currentTrElement = editTaxButton.closest('tr');\n\t\t\tthisInstance.editTax(editTaxButton.data('url'), currentTrElement);\n\t\t});\n\n\t\t//register event for checkbox to change the tax Status\n\t\tcontainer.on('click', '.editTaxStatus', function (e) {\n\t\t\tvar currentTarget = jQuery(e.currentTarget);\n\n\t\t\tthisInstance.updateTaxStatus(currentTarget).done(function (data) {\n\t\t\t\tvar params = {};\n\t\t\t\tif (currentTarget.is(':checked')) {\n\t\t\t\t\tparams.text = app.vtranslate('JS_TAX_ENABLED');\n\t\t\t\t} else {\n\t\t\t\t\tparams.text = app.vtranslate('JS_TAX_DISABLED');\n\t\t\t\t}\n\t\t\t\tSettings_Vtiger_Index_Js.showMessage(params);\n\t\t\t});\n\t\t});\n\n\t},\n\n\tregisterEvents: function () {\n\t\tthis.registerActions();\n\t}\n\n});\n\njQuery(document).ready(function (e) {\n\tvar taxInstance = new Settings_Vtiger_Tax_Js();\n\ttaxInstance.registerEvents();\n})\n"],"names":["jQuery","Class","url","currentTrElement","aDeferred","Deferred","thisInstance","this","progressIndicatorElement","progressIndicator","request","done","data","callBackFunction","duplicateCheckCache","form","params","app","validationEngineOptions","onValidationComplete","valid","saveTaxDetails","validationEngine","on","e","preventDefault","mode","showModalWindow","width","fail","error","reject","promise","serializeFormData","validateTaxName","module","getModuleName","parent","getParentModuleName","action","hideModalWindow","find","val","addTaxDetails","updateTaxDetails","vtranslate","showMessage","details","container","taxTable","type","trElementForTax","taxid","row_type","taxlabel","percentage","_editurl","append","text","attr","removeAttr","taxName","taxLabelElement","result","resolve","checkDuplicateName","err","taxId","response","currentTarget","closest","taxType","deleted","is","addTaxButton","createTaxUrl","editTax","editTaxButton","updateTaxStatus","registerActions","document","ready","Settings_Vtiger_Tax_Js","registerEvents"],"mappings":"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"}