{"version":3,"file":"ConfigEditor.min.js","sources":["ConfigEditor.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\njQuery.Class(\"Settings_Vtiger_ConfigEditor_Js\", {}, {\n\n\t/*\n\t * Function to save the Configuration Editor content\n\t */\n\tsaveConfigEditor: function (form) {\n\t\tvar aDeferred = jQuery.Deferred();\n\n\t\tlet params = form.serializeFormData();\n\t\tparams.module = app.getModuleName();\n\t\tparams.parent = app.getParentModuleName();\n\t\tparams.action = 'ConfigEditorSaveAjax';\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error, err) {\n\t\t\taDeferred.reject(error, err);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\n\t/*\n\t * Function to load the contents from the url through pjax\n\t */\n\tloadContents: function (url) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tAppConnector.requestPjax(url).done(function (data) {\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error, err) {\n\t\t\taDeferred.reject();\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\n\t/*\n\t * function to register the events in editView\n\t */\n\tregisterEditViewEvents: function () {\n\t\tvar thisInstance = this;\n\t\tvar form = jQuery('#ConfigEditorForm');\n\t\tvar detailUrl = form.data('detailUrl');\n\n\t\t//register all select2 Elements\n\t\tApp.Fields.Picklist.showSelect2ElementView(form.find('select.select2'), {dropdownCss: {'z-index': 0}});\n\n\t\t//register validation engine\n\t\tvar params = app.validationEngineOptions;\n\t\tparams.onValidationComplete = function (form, valid) {\n\t\t\tif (valid) {\n\t\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t\t'position': 'html',\n\t\t\t\t\t'blockInfo': {\n\t\t\t\t\t\t'enabled': true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthisInstance.saveConfigEditor(form).done(function (data) {\n\t\t\t\t\tvar params = {};\n\t\t\t\t\tif (data['success']) {\n\t\t\t\t\t\tparams['text'] = app.vtranslate('JS_CONFIGURATION_DETAILS_SAVED');\n\t\t\t\t\t\tthisInstance.loadContents(detailUrl).done(function (data) {\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t\t\t\t\tjQuery('.contentsDiv').html(data);\n\t\t\t\t\t\t\tthisInstance.registerDetailViewEvents();\n\t\t\t\t\t\t});\n\t\t\t\t\t\tSettings_Vtiger_Index_Js.showMessage(params);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t\t\t}\n\t\t\t\t}).fail(function (error, err) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t\t});\n\t\t\t\treturn valid;\n\t\t\t}\n\t\t}\n\t\tform.validationEngine(params);\n\n\t\tform.on('submit', function (e) {\n\t\t\te.preventDefault();\n\t\t})\n\n\t\t//Register click event for cancel link\n\t\tvar cancelLink = form.find('.cancelLink');\n\t\tcancelLink.on('click', function () {\n\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t'position': 'html',\n\t\t\t\t'blockInfo': {\n\t\t\t\t\t'enabled': true\n\t\t\t\t}\n\t\t\t});\n\t\t\tthisInstance.loadContents(detailUrl).done(function (data) {\n\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'})\n\t\t\t\tjQuery('.contentsDiv').html(data);\n\t\t\t\tthisInstance.registerDetailViewEvents();\n\t\t\t});\n\t\t});\n\t},\n\n\t/*\n\t * function to register the events in DetailView\n\t */\n\tregisterDetailViewEvents: function () {\n\t\tvar thisInstance = this;\n\t\tvar container = jQuery('#ConfigEditorDetails');\n\t\tvar editButton = container.find('.editButton');\n\n\t\t//Register click event for edit button\n\t\teditButton.on('click', function () {\n\t\t\tvar url = editButton.data('url');\n\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t'position': 'html',\n\t\t\t\t'blockInfo': {\n\t\t\t\t\t'enabled': true\n\t\t\t\t}\n\t\t\t});\n\t\t\tthisInstance.loadContents(url).done(function (data) {\n\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t\tjQuery('.contentsDiv').html(data);\n\t\t\t\tthisInstance.registerEditViewEvents();\n\t\t\t}).fail(function (error, err) {\n\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t});\n\t\t});\n\t},\n\n\tregisterEvents: function () {\n\t\tif (jQuery('#ConfigEditorDetails').length > 0) {\n\t\t\tthis.registerDetailViewEvents();\n\t\t} else {\n\t\t\tthis.registerEditViewEvents();\n\t\t}\n\t}\n\n});\n\njQuery(document).ready(function (e) {\n\tvar tacInstance = new Settings_Vtiger_ConfigEditor_Js();\n\ttacInstance.registerEvents();\n})\nVtiger_WholeNumberGreaterThanZero_Validator_Js(\"Vtiger_NumberRange100_Validator_Js\", {\n\n\t/**\n\t *Function which invokes field validation\n\t *@param accepts field element as parameter\n\t * @return error if validation fails true on success\n\t */\n\tinvokeValidation: function (field, rules, i, options) {\n\t\tvar rangeInstance = new Vtiger_NumberRange100_Validator_Js();\n\t\trangeInstance.setElement(field);\n\t\tvar response = rangeInstance.validate();\n\t\tif (response != true) {\n\t\t\treturn rangeInstance.getError();\n\t\t}\n\t}\n\n}, {\n\t/**\n\t * Function to validate the percentage field data\n\t * @return true if validation is successfull\n\t * @return false if validation error occurs\n\t */\n\tvalidate: function () {\n\t\tvar response = this._super();\n\t\tif (response != true) {\n\t\t\treturn response;\n\t\t} else {\n\t\t\tvar fieldValue = this.getFieldValue();\n\t\t\tif (fieldValue < 1 || fieldValue > 100) {\n\t\t\t\tvar errorInfo = app.vtranslate('JS_PLEASE_ENTER_NUMBER_IN_RANGE_1TO100');\n\t\t\t\tthis.setError(errorInfo);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t}\n\n})\n"],"names":["jQuery","Class","form","aDeferred","Deferred","params","serializeFormData","module","app","getModuleName","parent","getParentModuleName","action","request","done","data","resolve","fail","error","err","reject","promise","url","requestPjax","thisInstance","this","detailUrl","Fields","Picklist","showSelect2ElementView","find","dropdownCss","z-index","validationEngineOptions","onValidationComplete","valid","progressIndicatorElement","progressIndicator","saveConfigEditor","vtranslate","loadContents","mode","html","registerDetailViewEvents","showMessage","validationEngine","on","e","preventDefault","editButton","registerEditViewEvents","length","document","ready","Settings_Vtiger_ConfigEditor_Js","registerEvents","Vtiger_WholeNumberGreaterThanZero_Validator_Js","field","rules","i","options","rangeInstance","Vtiger_NumberRange100_Validator_Js","setElement","validate","getError","response","_super","fieldValue","getFieldValue","errorInfo","setError"],"mappings":"aAUAA,OAAOC,MAAM,kCAAmC,GAAI,kBAKjC,SAAUC,UACvBC,UAAYH,OAAOI,WAEnBC,OAASH,KAAKI,kCACXC,OAASC,IAAIC,uBACbC,OAASF,IAAIG,6BACbC,OAAS,oCACHC,QAAQR,QAAQS,MAAK,SAAUC,gBACjCC,QAAQD,SAChBE,MAAK,SAAUC,MAAOC,eACdC,OAAOF,MAAOC,QAElBhB,UAAUkB,wBAMJ,SAAUC,SACnBnB,UAAYH,OAAOI,+BACVmB,YAAYD,KAAKR,MAAK,SAAUC,gBAClCC,QAAQD,SAChBE,MAAK,SAAUC,MAAOC,eACdC,YAEJjB,UAAUkB,kCAMM,eACnBG,aAAeC,KACfvB,KAAOF,OAAO,qBACd0B,UAAYxB,KAAKa,KAAK,iBAGtBY,OAAOC,SAASC,uBAAuB3B,KAAK4B,KAAK,kBAAmB,CAACC,YAAa,CAACC,UAAW,SAG9F3B,OAASG,IAAIyB,+BACVC,qBAAuB,SAAUhC,KAAMiC,UACzCA,MAAO,KACNC,yBAA2BpC,OAAOqC,kBAAkB,UAC3C,iBACC,UACD,yBAGAC,iBAAiBpC,MAAMY,MAAK,SAAUC,UAC9CV,OAAS,GACTU,KAAA,gBACH,KAAiBP,IAAI+B,WAAW,+CACnBC,aAAad,WAAWZ,MAAK,SAAUC,+BAC1BsB,kBAAkB,CAACI,KAAQ,gBAC7C,gBAAgBC,KAAK3B,mBACf4B,uDAEWC,YAAYvC,kCAEZgC,kBAAkB,CAACI,KAAQ,YAEnDxB,MAAK,SAAUC,MAAOC,8BACCkB,kBAAkB,CAACI,KAAQ,YAE9CN,aAGJU,iBAAiBxC,aAEjByC,GAAG,UAAU,SAAUC,KACzBC,oBAIc9C,KAAK4B,KAAK,eAChBgB,GAAG,SAAS,eAClBV,yBAA2BpC,OAAOqC,kBAAkB,UAC3C,iBACC,UACD,kBAGAG,aAAad,WAAWZ,MAAK,SAAUC,+BAC1BsB,kBAAkB,CAACI,KAAQ,gBAC7C,gBAAgBC,KAAK3B,mBACf4B,2DAQU,eACrBnB,aAAeC,KAEfwB,WADYjD,OAAO,wBACI8B,KAAK,0BAGrBgB,GAAG,SAAS,eAClBxB,IAAM2B,WAAWlC,KAAK,OACtBqB,yBAA2BpC,OAAOqC,kBAAkB,UAC3C,iBACC,UACD,kBAGAG,aAAalB,KAAKR,MAAK,SAAUC,+BACpBsB,kBAAkB,CAACI,KAAQ,gBAC7C,gBAAgBC,KAAK3B,mBACfmC,4BACXjC,MAAK,SAAUC,MAAOC,8BACCkB,kBAAkB,CAACI,KAAQ,+BAKvC,WACXzC,OAAO,wBAAwBmD,OAAS,OACtCR,gCAEAO,4BAMRlD,OAAOoD,UAAUC,OAAM,SAAUN,IACd,IAAIO,iCACVC,oBAEbC,+CAA+C,qCAAsC,kBAOlE,SAAUC,MAAOC,MAAOC,EAAGC,aACxCC,cAAgB,IAAIC,oDACVC,WAAWN,OAET,GADDI,cAAcG,kBAErBH,cAAcI,aAIrB,UAMQ,eACLC,SAAWzC,KAAK0C,YACJ,GAAZD,gBACIA,aAEHE,WAAa3C,KAAK4C,mBAClBD,WAAa,GAAKA,WAAa,IAAK,KACnCE,UAAY9D,IAAI+B,WAAW,sDAC1BgC,SAASD,YACP,SAED"}