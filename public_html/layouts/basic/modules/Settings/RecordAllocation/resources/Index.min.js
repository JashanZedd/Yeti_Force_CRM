"use strict";jQuery.Class("Settings_RecordAllocation_Index_Js",{},{container:!1,registerDataTables:function(contentData){$.extend($.fn.dataTable.defaults,{language:{sLengthMenu:app.vtranslate("JS_S_LENGTH_MENU"),sZeroRecords:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfo:app.vtranslate("JS_S_INFO"),sInfoEmpty:app.vtranslate("JS_S_INFO_EMPTY"),sSearch:app.vtranslate("JS_SEARCH"),sEmptyTable:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfoFiltered:app.vtranslate("JS_S_INFO_FILTERED"),sLoadingRecords:app.vtranslate("JS_LOADING_OF_RECORDS"),sProcessing:app.vtranslate("JS_LOADING_OF_RECORDS"),oAria:{sSortAscending:app.vtranslate("JS_S_SORT_ASCENDING"),sSortDescending:app.vtranslate("JS_S_SORT_DESCENDING")}}}),null==contentData&&(contentData=this.getContainer()),contentData.find(".js-data-table").dataTable({scrollY:200,deferRender:!0,scroller:!0,paging:!1,info:!1})},registerDragDropEvent:function(contentData){if(null!=contentData){var thisInstance=this,index=contentData.closest(".js-panel").data("index"),width=void 0;contentData.find(".js-drag-drop-"+index).draggable({appendTo:"body",helper:"clone",start:function(e,ui){width=$(ui.helper.context).width(),$(ui.helper).css("width",width).addClass("dataTableDragDrop bg-primary")},zIndex:9999999999}),contentData.find(".dataTables_scrollBody .js-data-table").droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",accept:".js-drag-drop-"+index,drop:function(event,ui){var tableBase=$(ui.draggable).closest(".js-data-table"),table=$(this);tableBase.data("mode")!=table.data("mode")&&(tableBase.DataTable().row(ui.draggable).remove().draw(),table.DataTable().row.add(ui.draggable[0]).draw(),table="active"==table.data("mode")?table:tableBase,thisInstance.save(table.closest(".js-panel")))}})}},save:function(container){var data={module:container.data("modulename"),userid:container.find(".js-base-user").val(),type:app.getMainParams("fieldType")},userData=[];container.find(".dataTables_scrollBody:first tbody tr").each((function(e){var id=$(this).data("id"),mode=$(this).data("type");id&&mode&&(userData[mode]||(userData[mode]=[]),userData[mode].push(id))})),data.ids=jQuery.extend({},userData),app.saveAjax("save",jQuery.extend({},data))},registerModalButton:function(){var thisInstance=this,container=this.getContainer();container.find("button.js-add-panel").on("click",(function(){var modalWindow=container.find(".js-modal-add-panel").clone(!0,!0),inUseModules=thisInstance.getModules();modalWindow.find("select option").each((function(){-1!=$.inArray($(this).val(),inUseModules)&&$(this).remove()})),app.showModalWindow(modalWindow,(function(data){var selectElement=data.find("select"),form=data.find("form");App.Fields.Picklist.showSelect2ElementView(selectElement),form.on("submit",(function(e){var module=$(e.currentTarget).find(".js-modules-list");module.length&&module.val()&&thisInstance.addPanel(module.val()),e.preventDefault()}))}))}))},getModules:function(){var modules=[];return this.getContainer().find(".js-panel").each((function(){modules.push(jQuery(this).data("modulename"))})),modules},addPanel:function(module){var thisInstance=this,aDeferred=jQuery.Deferred(),progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}}),lastPanel=this.getContainer().find(".js-panel:last");return AppConnector.request({index:lastPanel.data("index"),module:app.getModuleName(),parent:app.getParentModuleName(),sourceModule:module,view:"Index",mode:"getPanel",type:app.getMainParams("fieldType")}).done((function(data){var elements=thisInstance.getContainer().find(".js-panels-container").append(data);App.Fields.Picklist.showSelect2ElementView(elements.find(".select2")),app.hideModalWindow(),progressIndicatorElement.progressIndicator({mode:"hide"}),aDeferred.resolve(data)}),(function(error){progressIndicatorElement.progressIndicator({mode:"hide"}),aDeferred.reject(error)})),aDeferred.promise()},registerLoadData:function(){var thisInstance=this;this.getContainer().on("change",".js-base-user",(function(e){var selectElement=jQuery(e.currentTarget),panel=selectElement.closest(".js-panel-item"),dataJson=panel.find(".js-module-allocation-data").val(),data=[];dataJson&&"null"!=dataJson&&(data=JSON.parse(dataJson));var userData=data[selectElement.val()],bodyContainer=panel.find(".js-active-panel");bodyContainer.length&&bodyContainer.remove();var bodyContainerTable=panel.find(".js-clear-tables").clone(!0,!0);if(null!=userData){var activeData=bodyContainerTable.find(".js-data-table .dropContainer:first");bodyContainerTable.find(".js-data-table .dropContainer:last").find("tr").each((function(){var mode=jQuery(this).data("type"),id=jQuery(this).data("id");-1==$.inArray(id,userData[mode])&&-1==$.inArray(id.toString(),userData[mode])||activeData.append(jQuery(this))}))}panel.find(".js-panel-body").removeClass("d-none").append(bodyContainerTable.removeClass("js-clear-tables d-none").addClass("js-active-panel")),thisInstance.registerDataTables(bodyContainerTable),thisInstance.registerDragDropEvent(bodyContainerTable)}))},registerHeaderElements:function(){this.getContainer().on("click",".js-remove-panel",(function(e){var panel=jQuery(e.currentTarget).closest(".js-panel");Vtiger_Helper_Js.showConfirmationBox({message:app.vtranslate("JS_ARE_YOU_SURE_YOU_WANT_TO_DELETE_PANEL")}).done((function(e){app.saveAjax("removePanel",{module:panel.data("modulename"),type:app.getMainParams("fieldType")}).done((function(){panel.fadeOut(300,(function(){$(this).remove()}))}))}))})),this.registerLoadData()},getContainer:function(){return 0==this.container&&(this.container=jQuery("div.contentsDiv")),this.container},registerEvents:function(){this.registerModalButton(),this.registerHeaderElements()}});
//# sourceMappingURL=Index.min.js.map
