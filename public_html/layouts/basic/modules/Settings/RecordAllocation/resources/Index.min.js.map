{"version":3,"file":"Index.min.js","sources":["Index.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class('Settings_RecordAllocation_Index_Js', {}, {\n\tcontainer: false,\n\t/**\n\t * Register tables\n\t * @param {jQuery} contentData\n\t */\n\tregisterDataTables: function (contentData) {\n\t\tconst thisInstance = this;\n\t\t$.extend($.fn.dataTable.defaults, {\n\t\t\tlanguage: {\n\t\t\t\tsLengthMenu: app.vtranslate('JS_S_LENGTH_MENU'),\n\t\t\t\tsZeroRecords: app.vtranslate('JS_NO_RESULTS_FOUND'),\n\t\t\t\tsInfo: app.vtranslate('JS_S_INFO'),\n\t\t\t\tsInfoEmpty: app.vtranslate('JS_S_INFO_EMPTY'),\n\t\t\t\tsSearch: app.vtranslate('JS_SEARCH'),\n\t\t\t\tsEmptyTable: app.vtranslate('JS_NO_RESULTS_FOUND'),\n\t\t\t\tsInfoFiltered: app.vtranslate('JS_S_INFO_FILTERED'),\n\t\t\t\tsLoadingRecords: app.vtranslate('JS_LOADING_OF_RECORDS'),\n\t\t\t\tsProcessing: app.vtranslate('JS_LOADING_OF_RECORDS'),\n\t\t\t\toAria: {\n\t\t\t\t\tsSortAscending: app.vtranslate('JS_S_SORT_ASCENDING'),\n\t\t\t\t\tsSortDescending: app.vtranslate('JS_S_SORT_DESCENDING')\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (contentData == undefined) {\n\t\t\tcontentData = thisInstance.getContainer();\n\t\t}\n\t\tcontentData.find('.js-data-table').dataTable({\n\t\t\tscrollY: 200,\n\t\t\tdeferRender: true,\n\t\t\tscroller: true,\n\t\t\tpaging: false,\n\t\t\tinfo: false\n\t\t});\n\t},\n\t/**\n\t * Register event drag and drop\n\t * @param {jQuery} contentData\n\t */\n\tregisterDragDropEvent: function (contentData) {\n\t\tif (contentData == undefined) {\n\t\t\treturn;\n\t\t}\n\t\tconst thisInstance = this;\n\t\tlet panel = contentData.closest('.js-panel'),\n\t\t\tindex = panel.data('index'),\n\t\t\twidth;\n\t\tcontentData.find('.js-drag-drop-' + index).draggable({\n\t\t\tappendTo: 'body',\n\t\t\thelper: 'clone',\n\t\t\tstart: function (e, ui) {\n\t\t\t\twidth = $(ui.helper.context).width();\n\t\t\t\t$(ui.helper).css('width', width).addClass('dataTableDragDrop bg-primary');\n\t\t\t},\n\t\t\tzIndex: 9999999999\n\t\t});\n\t\tcontentData.find('.dataTables_scrollBody .js-data-table').droppable({\n\t\t\tactiveClass: 'ui-state-default',\n\t\t\thoverClass: 'ui-state-hover',\n\t\t\taccept: '.js-drag-drop-' + index,\n\t\t\tdrop: function (event, ui) {\n\t\t\t\tlet tableBase = $(ui.draggable).closest('.js-data-table'),\n\t\t\t\t\ttable = $(this);\n\t\t\t\tif (tableBase.data('mode') != table.data('mode')) {\n\t\t\t\t\ttableBase.DataTable().row(ui.draggable).remove().draw();\n\t\t\t\t\ttable.DataTable().row.add(ui.draggable[0]).draw();\n\t\t\t\t\ttable = table.data('mode') == 'active' ? table : tableBase;\n\t\t\t\t\tthisInstance.save(table.closest('.js-panel'));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Save users for module\n\t * @param {jQuery} container\n\t */\n\tsave: function (container) {\n\t\tlet data = {\n\t\t\t\tmodule: container.data('modulename'),\n\t\t\t\tuserid: container.find('.js-base-user').val(),\n\t\t\t\ttype: app.getMainParams('fieldType')\n\t\t\t},\n\t\t\tuserData = [],\n\t\t\tdataContainer = container.find('.dataTables_scrollBody:first tbody tr');\n\t\tdataContainer.each(function (e) {\n\t\t\tlet id = $(this).data('id'),\n\t\t\t\tmode = $(this).data('type');\n\t\t\tif (id && mode) {\n\t\t\t\tif (!userData[mode]) {\n\t\t\t\t\tuserData[mode] = [];\n\t\t\t\t}\n\t\t\t\tuserData[mode].push(id);\n\t\t\t}\n\t\t});\n\t\tdata['ids'] = jQuery.extend({}, userData);\n\t\tapp.saveAjax('save', jQuery.extend({}, data));\n\t},\n\t/**\n\t * Register event to show form\n\t */\n\tregisterModalButton: function () {\n\t\tconst thisInstance = this,\n\t\t\tcontainer = this.getContainer();\n\t\tcontainer.find('button.js-add-panel').on('click', function () {\n\t\t\tlet modalWindow = container.find('.js-modal-add-panel').clone(true, true),\n\t\t\t\tinUseModules = thisInstance.getModules();\n\t\t\tmodalWindow.find('select option').each(function () {\n\t\t\t\tif ($.inArray($(this).val(), inUseModules) != -1) {\n\t\t\t\t\t$(this).remove();\n\t\t\t\t}\n\t\t\t});\n\t\t\tapp.showModalWindow(modalWindow, function (data) {\n\t\t\t\t//register all select2 Elements\n\t\t\t\tlet selectElement = data.find('select'),\n\t\t\t\t\tform = data.find('form');\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(selectElement);\n\t\t\t\tform.on('submit', function (e) {\n\t\t\t\t\tlet currentTarget = $(e.currentTarget),\n\t\t\t\t\t\tmodule = currentTarget.find('.js-modules-list');\n\t\t\t\t\tif (module.length && module.val()) {\n\t\t\t\t\t\tthisInstance.addPanel(module.val());\n\t\t\t\t\t}\n\t\t\t\t\te.preventDefault();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\t/**\n\t * Returns list of modules which are visible\n\t * @returns {Array}\n\t */\n\tgetModules: function () {\n\t\tvar modules = [];\n\t\tthis.getContainer().find('.js-panel').each(function () {\n\t\t\tmodules.push(jQuery(this).data('modulename'));\n\t\t});\n\t\treturn modules;\n\t},\n\t/**\n\t * Load users form modules\n\t * @param {string} module\n\t * @returns {jQuery.Deferred}\n\t */\n\taddPanel: function (module) {\n\t\tconst thisInstance = this;\n\t\tlet aDeferred = jQuery.Deferred(),\n\t\t\tprogressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t}),\n\t\t\tlastPanel = this.getContainer().find('.js-panel:last');\n\t\tAppConnector.request({\n\t\t\tindex: lastPanel.data('index'),\n\t\t\tmodule: app.getModuleName(),\n\t\t\tparent: app.getParentModuleName(),\n\t\t\tsourceModule: module,\n\t\t\tview: 'Index',\n\t\t\tmode: 'getPanel',\n\t\t\ttype: app.getMainParams('fieldType')\n\t\t}).done(function (data) {\n\t\t\tlet elements = thisInstance.getContainer().find('.js-panels-container').append(data);\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(elements.find('.select2'));\n\t\t\tapp.hideModalWindow();\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.resolve(data);\n\t\t}, function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.reject(error);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\t/**\n\t * Register event to load users\n\t */\n\tregisterLoadData: function () {\n\t\tconst thisInstance = this;\n\t\tthis.getContainer().on('change', '.js-base-user', function (e) {\n\t\t\tlet selectElement = jQuery(e.currentTarget),\n\t\t\t\tpanel = selectElement.closest('.js-panel-item'),\n\t\t\t\tdataJson = panel.find('.js-module-allocation-data').val(),\n\t\t\t\tdata = [];\n\t\t\tif (dataJson && dataJson != 'null') {\n\t\t\t\tdata = JSON.parse(dataJson);\n\t\t\t}\n\t\t\tlet userData = data[selectElement.val()],\n\t\t\t\tbodyContainer = panel.find('.js-active-panel');\n\t\t\tif (bodyContainer.length) {\n\t\t\t\tbodyContainer.remove();\n\t\t\t}\n\t\t\tlet bodyContainerTable = panel.find('.js-clear-tables').clone(true, true);\n\t\t\tif (userData != undefined) {\n\t\t\t\tlet activeData = bodyContainerTable.find('.js-data-table .dropContainer:first'),\n\t\t\t\t\tbaseData = bodyContainerTable.find('.js-data-table .dropContainer:last');\n\t\t\t\tbaseData.find('tr').each(function () {\n\t\t\t\t\tlet mode = jQuery(this).data('type'),\n\t\t\t\t\t\tid = jQuery(this).data('id');\n\t\t\t\t\tif ($.inArray(id, userData[mode]) != -1 || $.inArray(id.toString(), userData[mode]) != -1) {\n\t\t\t\t\t\tactiveData.append(jQuery(this));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tpanel.find('.js-panel-body').removeClass('d-none').append(bodyContainerTable.removeClass('js-clear-tables d-none').addClass('js-active-panel'));\n\t\t\tthisInstance.registerDataTables(bodyContainerTable);\n\t\t\tthisInstance.registerDragDropEvent(bodyContainerTable);\n\t\t});\n\t},\n\t/**\n\t * Register basic events\n\t */\n\tregisterHeaderElements: function () {\n\t\tthis.getContainer().on('click', '.js-remove-panel', function (e) {\n\t\t\tlet currentTarget = jQuery(e.currentTarget),\n\t\t\t\tpanel = currentTarget.closest('.js-panel');\n\t\t\tVtiger_Helper_Js.showConfirmationBox({'message': app.vtranslate('JS_ARE_YOU_SURE_YOU_WANT_TO_DELETE_PANEL')}).done(function (e) {\n\t\t\t\tapp.saveAjax('removePanel', {\n\t\t\t\t\tmodule: panel.data('modulename'),\n\t\t\t\t\ttype: app.getMainParams('fieldType')\n\t\t\t\t}).done(function () {\n\t\t\t\t\tpanel.fadeOut(300, function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\tthis.registerLoadData();\n\t},\n\t/**\n\t * Returns container\n\t * @returns {jQuery}\n\t */\n\tgetContainer: function () {\n\t\tif (this.container == false) {\n\t\t\tthis.container = jQuery('div.contentsDiv');\n\t\t}\n\t\treturn this.container;\n\t},\n\t/**\n\t * Main function\n\t */\n\tregisterEvents: function () {\n\t\tthis.registerModalButton();\n\t\tthis.registerHeaderElements();\n\t}\n});\n"],"names":["jQuery","Class","contentData","extend","$","fn","dataTable","defaults","app","vtranslate","undefined","this","getContainer","find","thisInstance","index","closest","data","width","draggable","e","ui","helper","context","css","addClass","droppable","event","tableBase","table","DataTable","row","remove","draw","add","save","container","val","getMainParams","userData","each","id","mode","push","saveAjax","on","modalWindow","clone","inUseModules","getModules","inArray","showModalWindow","selectElement","form","Fields","Picklist","showSelect2ElementView","module","currentTarget","length","addPanel","preventDefault","modules","aDeferred","Deferred","progressIndicatorElement","progressIndicator","lastPanel","request","getModuleName","getParentModuleName","done","elements","append","hideModalWindow","resolve","error","reject","promise","panel","dataJson","JSON","parse","bodyContainer","bodyContainerTable","activeData","toString","removeClass","registerDataTables","registerDragDropEvent","showConfirmationBox","message","fadeOut","registerLoadData","registerModalButton","registerHeaderElements"],"mappings":"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"}