{"version":3,"file":"Index.min.js","sources":["Index.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class('Settings_CustomView_Index_Js', {}, {\n\tcontainer: false,\n\tcontents: false,\n\t/**\n\t * Register events\n\t * @param {jQuery} container\n\t */\n\tinitEvents: function (container) {\n\t\tcontainer.on('click', '.js-delete-filter', (e) => {\n\t\t\tthis.deleteFilter(e);\n\t\t});\n\t\tcontainer.on('change', '.js-update-field', (e) => {\n\t\t\tthis.updateField(e);\n\t\t});\n\t\tcontainer.on('click', '.js-update,.js-create-filter', (e) => {\n\t\t\tthis.update(e);\n\t\t});\n\t\tcontainer.on('change', '.js-module-filter', (e) => {\n\t\t\tthis.registerFilterChange(e);\n\t\t});\n\t},\n\t/**\n\t * Load form to edit filter\n\t * @param {jQuery.Event} e\n\t */\n\tupdate: function (e) {\n\t\tvar target = $(e.currentTarget);\n\t\tvar editUrl = target.data('editurl');\n\t\tnew CustomView(editUrl);\n\t},\n\t/**\n\t * Update parameter\n\t * @param {jQuery.Event} e\n\t */\n\tupdateField: function (e) {\n\t\tconst thisInstance = this,\n\t\t\ttarget = $(e.currentTarget),\n\t\t\tclosestTrElement = target.closest('.js-filter-row');\n\t\t$.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tconst params = {\n\t\t\tcvid: closestTrElement.data('cvid'),\n\t\t\tmod: closestTrElement.data('mod'),\n\t\t\tname: target.attr('name'),\n\t\t\tvalue: target.val(),\n\t\t};\n\t\tapp.saveAjax('updateField', {}, params).done(function (data) {\n\t\t\tthisInstance.getContainer().find('.js-module-filter').trigger('change');\n\t\t});\n\t},\n\t/**\n\t * Delete filter\n\t * @param {jQuery.Event} e\n\t */\n\tdeleteFilter: function (e) {\n\t\tvar thisInstance = this;\n\t\tvar target = $(e.currentTarget);\n\t\tvar closestTrElement = target.closest('.js-filter-row');\n\t\t$.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tapp.saveAjax('delete', {}, {\n\t\t\tcvid: closestTrElement.data('cvid'),\n\t\t}).done(function () {\n\t\t\tthisInstance.getContainer().find('.js-module-filter').trigger('change');\n\t\t});\n\t},\n\t/**\n\t * Function to regiser the event to make the filters sortable\n\t */\n\tmakeFilterListSortable: function (container) {\n\t\tvar thisInstance = this;\n\t\tvar tbody = container.find('tbody');\n\n\t\tif (tbody.children().length > 1) {\n\t\t\ttbody.each(function () {\n\t\t\t\tjQuery(this).sortable({\n\t\t\t\t\tcontainment: 'tbody',\n\t\t\t\t\trevert: true,\n\t\t\t\t\ttolerance: 'pointer',\n\t\t\t\t\tcursor: 'move',\n\t\t\t\t\thelper: function (e, ui) {\n\t\t\t\t\t\t//while dragging helper elements td element will take width as contents width\n\t\t\t\t\t\t//so we are explicitly saying that it has to be same width so that element will not\n\t\t\t\t\t\t//look like disturbed\n\t\t\t\t\t\tui.children().each(function (index, element) {\n\t\t\t\t\t\t\telement = jQuery(element);\n\t\t\t\t\t\t\telement.width(element.width());\n\t\t\t\t\t\t})\n\t\t\t\t\t\treturn ui;\n\t\t\t\t\t},\n\t\t\t\t\tupdate: function (e, ui) {\n\t\t\t\t\t\tthisInstance.updateSequence();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\t/**\n\t * Update sequences\n\t */\n\tupdateSequence: function () {\n\t\tvar sequences = [];\n\t\tthis.getContents().find('.js-filter-row').each(function (n, row) {\n\t\t\tvar cvId = $(row).data('cvid');\n\t\t\tsequences.push(cvId);\n\t\t});\n\t\tapp.saveAjax('upadteSequences', sequences).done(function (data) {\n\t\t\tif (data.success) {\n\t\t\t\tVtiger_Helper_Js.showPnotify({text: data.result.message, type: 'success'});\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Load list of filter for module\n\t * @param {jQuery.Event} e\n\t */\n\tregisterFilterChange: function (e) {\n\t\tvar thisInstance = this;\n\t\tvar aDeferred = $.Deferred();\n\t\tvar progress = $.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_LOADING_PLEASE_WAIT'),\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tvar params = {\n\t\t\tmodule: app.getModuleName(),\n\t\t\tview: app.getViewName(),\n\t\t\tparent: app.getParentModuleName(),\n\t\t\tsourceModule: $(e.currentTarget).val()\n\t\t}\n\t\tAppConnector.requestPjax(params).done(function (data) {\n\t\t\tvar contents = thisInstance.getContents().html(data);\n\t\t\tthisInstance.makeFilterListSortable(contents);\n\t\t\tthisInstance.getContainer().find('.js-create-filter').data('editurl', contents.find('#js-add-filter-url').val());\n\t\t\tprogress.progressIndicator({mode: 'hide'});\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error) {\n\t\t\taDeferred.reject();\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\tgetContainer: function () {\n\t\tif (this.container == false) {\n\t\t\tthis.container = jQuery('div.contentsDiv');\n\t\t}\n\t\treturn this.container;\n\t},\n\tgetContents: function () {\n\t\tif (this.contents == false) {\n\t\t\tthis.contents = this.getContainer().find('.indexContents');\n\t\t}\n\t\treturn this.contents;\n\t},\n\t/**\n\t * Main function\n\t */\n\tregisterEvents: function () {\n\t\tvar container = this.getContainer();\n\t\tthis.initEvents(container);\n\t\tthis.makeFilterListSortable(container);\n\t}\n\n});\n"],"names":["jQuery","Class","container","on","e","deleteFilter","updateField","update","registerFilterChange","editUrl","$","currentTarget","data","CustomView","thisInstance","this","target","closestTrElement","closest","progressIndicator","app","vtranslate","params","attr","val","saveAjax","done","getContainer","find","trigger","tbody","children","length","each","sortable","ui","index","element","width","updateSequence","sequences","getContents","n","row","cvId","push","success","showPnotify","text","result","message","type","aDeferred","Deferred","progress","getModuleName","getViewName","getParentModuleName","requestPjax","contents","html","makeFilterListSortable","mode","resolve","fail","error","reject","promise","initEvents"],"mappings":"aAGAA,OAAOC,MAAM,+BAAgC,GAAI,YACrC,YACD,aAKE,SAAUC,oCACXC,GAAG,QAAS,qBAAqB,SAACC,SACtCC,aAAaD,gBAETD,GAAG,SAAU,oBAAoB,SAACC,SACtCE,YAAYF,gBAERD,GAAG,QAAS,gCAAgC,SAACC,SACjDG,OAAOH,gBAEHD,GAAG,SAAU,qBAAqB,SAACC,SACvCI,qBAAqBJ,cAOpB,SAAUA,OAEbK,QADSC,EAAEN,EAAEO,eACIC,KAAK,eACtBC,WAAWJ,sBAMH,SAAUL,OAChBU,aAAeC,KACpBC,OAASN,EAAEN,EAAEO,eACbM,iBAAmBD,OAAOE,QAAQ,oBACjCC,kBAAkB,SACVC,IAAIC,WAAW,iCACb,UACD,SAGLC,OAAS,MACRL,iBAAiBL,KAAK,YACvBK,iBAAiBL,KAAK,YACrBI,OAAOO,KAAK,cACXP,OAAOQ,WAEXC,SAAS,cAAe,GAAIH,QAAQI,MAAK,SAAUd,mBACzCe,eAAeC,KAAK,qBAAqBC,QAAQ,2BAOlD,SAAUzB,OACnBU,aAAeC,KAEfE,iBADSP,EAAEN,EAAEO,eACaO,QAAQ,oBACpCC,kBAAkB,SACVC,IAAIC,WAAW,iCACb,UACD,SAGPI,SAAS,SAAU,GAAI,MACpBR,iBAAiBL,KAAK,UAC1Bc,MAAK,wBACMC,eAAeC,KAAK,qBAAqBC,QAAQ,qCAMxC,SAAU3B,eAC7BY,aAAeC,KACfe,MAAQ5B,UAAU0B,KAAK,SAEvBE,MAAMC,WAAWC,OAAS,SACvBC,MAAK,kBACHlB,MAAMmB,SAAS,aACR,gBACL,YACG,iBACH,cACA,SAAU9B,EAAG+B,cAIjBJ,WAAWE,MAAK,SAAUG,MAAOC,kBACzBrC,OAAOqC,UACTC,MAAMD,QAAQC,YAEhBH,WAEA,SAAU/B,EAAG+B,iBACPI,uCASF,eACXC,UAAY,QACXC,cAAcb,KAAK,kBAAkBK,MAAK,SAAUS,EAAGC,SACvDC,KAAOlC,EAAEiC,KAAK/B,KAAK,kBACbiC,KAAKD,aAEZnB,SAAS,kBAAmBe,WAAWd,MAAK,SAAUd,MACrDA,KAAKkC,0BACSC,YAAY,CAACC,KAAMpC,KAAKqC,OAAOC,QAASC,KAAM,qCAQ5C,SAAU/C,OAC3BU,aAAeC,KACfqC,UAAY1C,EAAE2C,WACdC,SAAW5C,EAAES,kBAAkB,SACzBC,IAAIC,WAAW,oCACb,UACD,KAGPC,OAAS,QACJF,IAAImC,qBACNnC,IAAIoC,qBACFpC,IAAIqC,mCACE/C,EAAEN,EAAEO,eAAea,2BAErBkC,YAAYpC,QAAQI,MAAK,SAAUd,UAC3C+C,SAAW7C,aAAa2B,cAAcmB,KAAKhD,mBAClCiD,uBAAuBF,uBACvBhC,eAAeC,KAAK,qBAAqBhB,KAAK,UAAW+C,SAAS/B,KAAK,sBAAsBJ,gBACjGL,kBAAkB,CAAC2C,KAAM,mBACxBC,QAAQnD,SAChBoD,MAAK,SAAUC,iBACPC,YAEJd,UAAUe,wBAEJ,kBACS,GAAlBpD,KAAKb,iBACHA,UAAYF,OAAO,oBAElBe,KAAKb,uBAEA,kBACS,GAAjBa,KAAK4C,gBACHA,SAAW5C,KAAKY,eAAeC,KAAK,mBAEnCb,KAAK4C,yBAKG,eACXzD,UAAYa,KAAKY,oBAChByC,WAAWlE,gBACX2D,uBAAuB3D"}