{"version":3,"file":"Index.min.js","sources":["Index.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class('Settings_CustomView_Index_Js', {}, {\n\tcontainer: false,\n\tcontents: false,\n\t/**\n\t * Register events\n\t * @param {jQuery} container\n\t */\n\tinitEvents: function (container) {\n\t\tcontainer.on('click', '.js-delete-filter', (e) => {\n\t\t\tthis.deleteFilter(e);\n\t\t});\n\t\tcontainer.on('change', '.js-update-field', (e) => {\n\t\t\tthis.updateField(e);\n\t\t});\n\t\tcontainer.on('click', '.js-update,.js-create-filter', (e) => {\n\t\t\tthis.update(e);\n\t\t});\n\t\tcontainer.on('change', '.js-module-filter', (e) => {\n\t\t\tthis.registerFilterChange(e);\n\t\t});\n\t},\n\t/**\n\t * Load form to edit filter\n\t * @param {jQuery.Event} e\n\t */\n\tupdate: function (e) {\n\t\tvar target = $(e.currentTarget);\n\t\tvar editUrl = target.data('editurl');\n\t\tnew CustomView(editUrl);\n\t},\n\t/**\n\t * Update parameter\n\t * @param {jQuery.Event} e\n\t */\n\tupdateField: function (e) {\n\t\tconst thisInstance = this,\n\t\t\ttarget = $(e.currentTarget),\n\t\t\tclosestTrElement = target.closest('.js-filter-row');\n\t\t$.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tconst params = {\n\t\t\tcvid: closestTrElement.data('cvid'),\n\t\t\tmod: closestTrElement.data('mod'),\n\t\t\tname: target.attr('name'),\n\t\t\tvalue: target.val(),\n\t\t};\n\t\tapp.saveAjax('updateField', {}, params).done(function (data) {\n\t\t\tthisInstance.getContainer().find('.js-module-filter').trigger('change');\n\t\t});\n\t},\n\t/**\n\t * Delete filter\n\t * @param {jQuery.Event} e\n\t */\n\tdeleteFilter: function (e) {\n\t\tvar thisInstance = this;\n\t\tvar target = $(e.currentTarget);\n\t\tvar closestTrElement = target.closest('.js-filter-row');\n\t\t$.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tapp.saveAjax('delete', {}, {\n\t\t\tcvid: closestTrElement.data('cvid'),\n\t\t}).done(function () {\n\t\t\tthisInstance.getContainer().find('.js-module-filter').trigger('change');\n\t\t});\n\t},\n\t/**\n\t * Function to regiser the event to make the filters sortable\n\t */\n\tmakeFilterListSortable: function (container) {\n\t\tvar thisInstance = this;\n\t\tvar tbody = container.find('tbody');\n\n\t\tif (tbody.children().length > 1) {\n\t\t\ttbody.each(function () {\n\t\t\t\tjQuery(this).sortable({\n\t\t\t\t\tcontainment: 'tbody',\n\t\t\t\t\trevert: true,\n\t\t\t\t\ttolerance: 'pointer',\n\t\t\t\t\tcursor: 'move',\n\t\t\t\t\thelper: function (e, ui) {\n\t\t\t\t\t\t//while dragging helper elements td element will take width as contents width\n\t\t\t\t\t\t//so we are explicitly saying that it has to be same width so that element will not\n\t\t\t\t\t\t//look like disturbed\n\t\t\t\t\t\tui.children().each(function (index, element) {\n\t\t\t\t\t\t\telement = jQuery(element);\n\t\t\t\t\t\t\telement.width(element.width());\n\t\t\t\t\t\t})\n\t\t\t\t\t\treturn ui;\n\t\t\t\t\t},\n\t\t\t\t\tupdate: function (e, ui) {\n\t\t\t\t\t\tthisInstance.updateSequence();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\t/**\n\t * Update sequences\n\t */\n\tupdateSequence: function () {\n\t\tvar sequences = [];\n\t\tthis.getContents().find('.js-filter-row').each(function (n, row) {\n\t\t\tvar cvId = $(row).data('cvid');\n\t\t\tsequences.push(cvId);\n\t\t});\n\t\tapp.saveAjax('upadteSequences', sequences).done(function (data) {\n\t\t\tif (data.success) {\n\t\t\t\tVtiger_Helper_Js.showPnotify({text: data.result.message, type: 'success'});\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Load list of filter for module\n\t * @param {jQuery.Event} e\n\t */\n\tregisterFilterChange: function (e) {\n\t\tvar thisInstance = this;\n\t\tvar aDeferred = $.Deferred();\n\t\tvar progress = $.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_LOADING_PLEASE_WAIT'),\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tvar params = {\n\t\t\tmodule: app.getModuleName(),\n\t\t\tview: app.getViewName(),\n\t\t\tparent: app.getParentModuleName(),\n\t\t\tsourceModule: $(e.currentTarget).val()\n\t\t}\n\t\tAppConnector.requestPjax(params).done(function (data) {\n\t\t\tvar contents = thisInstance.getContents().html(data);\n\t\t\tthisInstance.makeFilterListSortable(contents);\n\t\t\tthisInstance.getContainer().find('.js-create-filter').data('editurl', contents.find('#js-add-filter-url').val());\n\t\t\tprogress.progressIndicator({mode: 'hide'});\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error) {\n\t\t\taDeferred.reject();\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\tgetContainer: function () {\n\t\tif (this.container == false) {\n\t\t\tthis.container = jQuery('div.contentsDiv');\n\t\t}\n\t\treturn this.container;\n\t},\n\tgetContents: function () {\n\t\tif (this.contents == false) {\n\t\t\tthis.contents = this.getContainer().find('.indexContents');\n\t\t}\n\t\treturn this.contents;\n\t},\n\t/**\n\t * Main function\n\t */\n\tregisterEvents: function () {\n\t\tvar container = this.getContainer();\n\t\tthis.initEvents(container);\n\t\tthis.makeFilterListSortable(container);\n\t}\n\n});\n"],"names":["jQuery","Class","container","on","e","deleteFilter","updateField","update","registerFilterChange","target","$","currentTarget","editUrl","data","CustomView","thisInstance","closestTrElement","closest","progressIndicator","app","vtranslate","params","attr","val","saveAjax","done","getContainer","find","trigger","tbody","children","length","each","sortable","ui","index","element","width","updateSequence","sequences","getContents","n","row","cvId","push","success","showPnotify","text","result","message","type","aDeferred","Deferred","progress","getModuleName","getViewName","getParentModuleName","requestPjax","contents","html","makeFilterListSortable","mode","resolve","fail","error","reject","promise","initEvents"],"mappings":"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"}