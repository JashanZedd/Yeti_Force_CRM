{"version":3,"file":"FilterPermissions.min.js","sources":["FilterPermissions.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\"Settings_CustomView_FilterPermissions_Js\", {}, {\n\tformElement: false,\n\tregisterButtonsEvent: function () {\n\t\tvar thisInstance = this;\n\t\tvar container = this.getForm();\n\t\tcontainer.find('button.moveItem').on('click', function (e) {\n\t\t\tthisInstance.setDefaultPreferences(e);\n\t\t});\n\t},\n\tregisterDisabledButtons: function () {\n\t\tvar container = this.getForm();\n\t\tcontainer.find('button.moveItem').each(function (n, e) {\n\t\t\tvar currentTarget = jQuery(e);\n\t\t\tvar sourceClass = currentTarget.data('source');\n\t\t\tvar source = container.find('.' + sourceClass);\n\t\t\tif (source.find('option').length && !source.is(':disabled')) {\n\t\t\t\tcurrentTarget.prop('disabled', false);\n\t\t\t} else {\n\t\t\t\tcurrentTarget.prop('disabled', true);\n\t\t\t}\n\t\t});\n\t},\n\tmove: function (currentTarget) {\n\t\tvar container = this.getForm();\n\t\tvar sourceClass = currentTarget.data('source');\n\t\tvar targetClass = currentTarget.data('target');\n\t\tvar target = container.find('.' + targetClass);\n\t\tvar source = container.find('.' + sourceClass).find('option:selected');\n\n\t\tvar values = {};\n\t\tvalues.val = source.val();\n\t\tvalues.label = source.text();\n\t\tvalues.blockLabel = source.closest('optgroup').attr('label');\n\n\t\tvar targetOption = '<option value=\"' + values.val + '\">' + values.label + '</option>';\n\t\tvar targetOpt = target.find('optgroup[label=\"' + values.blockLabel + '\"]');\n\t\tif (targetOpt.length) {\n\t\t\ttargetOpt.append(targetOption);\n\t\t} else {\n\t\t\ttarget.append('<optgroup label=\"' + values.blockLabel + '\">' + targetOption + '</optgroup>');\n\t\t}\n\t\tsource.remove();\n\t\tApp.Fields.Picklist.showSelect2ElementView(container.find('.select2'));\n\t},\n\t/**\n\t * Saves permission for filter\n\t * @param {jQuery.Event} e\n\t */\n\tsetDefaultPreferences: function (e) {\n\t\tvar thisInstance = this;\n\t\tvar container = this.getForm();\n\t\tvar progressIndicatorElement = $.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\tposition: this.getForm(),\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tvar currentTarget = $(e.currentTarget);\n\t\tvar sourceClass = currentTarget.data('source');\n\t\tvar params = {\n\t\t\ttabid: container.find('#sourceModule').val(),\n\t\t\tuser: container.find('.' + sourceClass).val(),\n\t\t\tcvid: container.find('#cvid').val(),\n\t\t\toperator: currentTarget.data('operator'),\n\t\t\ttype: container.find('#type').val()\n\t\t};\n\t\tapp.saveAjax('setFilterPermissions', {}, params).done(function (data) {\n\t\t\tif (data.success) {\n\t\t\t\tif (data.result.success) {\n\t\t\t\t\tthisInstance.move(currentTarget);\n\t\t\t\t\tthisInstance.registerDisabledButtons();\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({mode: 'hide'});\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({text: data.result.message, type: 'success'});\n\t\t\t\t} else {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({mode: 'hide'});\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({text: data.result.message, type: 'error'});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tprogressIndicatorElement.progressIndicator({mode: 'hide'});\n\t\t\t}\n\t\t});\n\t},\n\tgetForm: function () {\n\t\tif (this.formElement == false) {\n\t\t\tthis.setForm(jQuery('#modalFilterPermissions'));\n\t\t}\n\t\treturn this.formElement;\n\t},\n\tsetForm: function (element) {\n\t\tthis.formElement = element;\n\t\treturn this;\n\t},\n\tregisterEvents: function () {\n\t\tthis.registerButtonsEvent();\n\t\tthis.registerDisabledButtons();\n\t}\n\n});\n\njQuery(document).ready(function (e) {\n\tvar instance = new Settings_CustomView_FilterPermissions_Js();\n\tinstance.registerEvents();\n})\n"],"names":["jQuery","Class","thisInstance","this","getForm","find","on","e","setDefaultPreferences","container","each","n","currentTarget","sourceClass","data","source","length","is","prop","targetClass","target","values","val","label","text","blockLabel","closest","attr","targetOption","targetOpt","append","remove","Fields","Picklist","showSelect2ElementView","progressIndicatorElement","$","progressIndicator","app","vtranslate","params","saveAjax","done","success","result","move","registerDisabledButtons","mode","showPnotify","message","type","formElement","setForm","element","registerButtonsEvent","document","ready","Settings_CustomView_FilterPermissions_Js","registerEvents"],"mappings":"aAGAA,OAAOC,MAAM,2CAA4C,GAAI,cAC/C,uBACS,eACjBC,aAAeC,KACHA,KAAKC,UACXC,KAAK,mBAAmBC,GAAG,SAAS,SAAUC,gBAC1CC,sBAAsBD,+BAGZ,eACpBE,UAAYN,KAAKC,oBACXC,KAAK,mBAAmBK,MAAK,SAAUC,EAAGJ,OAC/CK,cAAgBZ,OAAOO,GACvBM,YAAcD,cAAcE,KAAK,UACjCC,OAASN,UAAUJ,KAAK,IAAMQ,aAC9BE,OAAOV,KAAK,UAAUW,SAAWD,OAAOE,GAAG,2BAChCC,KAAK,YAAY,iBAEjBA,KAAK,YAAY,YAI5B,SAAUN,mBACXH,UAAYN,KAAKC,UACjBS,YAAcD,cAAcE,KAAK,UACjCK,YAAcP,cAAcE,KAAK,UACjCM,OAASX,UAAUJ,KAAK,IAAMc,aAC9BJ,OAASN,UAAUJ,KAAK,IAAMQ,aAAaR,KAAK,mBAEhDgB,OAAS,UACNC,IAAMP,OAAOO,aACbC,MAAQR,OAAOS,cACfC,WAAaV,OAAOW,QAAQ,YAAYC,KAAK,aAEhDC,aAAe,kBAAoBP,OAAOC,IAAM,KAAOD,OAAOE,MAAQ,YACtEM,UAAYT,OAAOf,KAAK,mBAAqBgB,OAAOI,WAAa,MACjEI,UAAUb,iBACHc,OAAOF,qBAEVE,OAAO,oBAAsBT,OAAOI,WAAa,KAAOG,aAAe,sBAExEG,aACHC,OAAOC,SAASC,uBAAuBzB,UAAUJ,KAAK,oCAMpC,SAAUE,OAC5BL,aAAeC,KACfM,UAAYN,KAAKC,UACjB+B,yBAA2BC,EAAEC,kBAAkB,SACzCC,IAAIC,WAAW,gCACdpC,KAAKC,oBACJ,UACD,KAGPQ,cAAgBwB,EAAE7B,EAAEK,eACpBC,YAAcD,cAAcE,KAAK,UACjC0B,OAAS,OACL/B,UAAUJ,KAAK,iBAAiBiB,WACjCb,UAAUJ,KAAK,IAAMQ,aAAaS,WAClCb,UAAUJ,KAAK,SAASiB,eACpBV,cAAcE,KAAK,iBACvBL,UAAUJ,KAAK,SAASiB,WAE3BmB,SAAS,uBAAwB,GAAID,QAAQE,MAAK,SAAU5B,MAC3DA,KAAK6B,QACJ7B,KAAK8B,OAAOD,sBACFE,KAAKjC,4BACLkC,mDACYT,kBAAkB,CAACU,KAAM,0BACjCC,YAAY,CAACxB,KAAMV,KAAK8B,OAAOK,QAASC,KAAM,uCAEtCb,kBAAkB,CAACU,KAAM,0BACjCC,YAAY,CAACxB,KAAMV,KAAK8B,OAAOK,QAASC,KAAM,oCAGvCb,kBAAkB,CAACU,KAAM,qBAI5C,kBACgB,GAApB5C,KAAKgD,kBACHC,QAAQpD,OAAO,4BAEdG,KAAKgD,qBAEJ,SAAUE,qBACbF,YAAcE,QACZlD,qBAEQ,gBACVmD,4BACAR,6BAKP9C,OAAOuD,UAAUC,OAAM,SAAUjD,IACjB,IAAIkD,0CACVC"}