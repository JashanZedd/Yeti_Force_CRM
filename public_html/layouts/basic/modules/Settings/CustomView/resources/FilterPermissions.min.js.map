{"version":3,"file":"FilterPermissions.min.js","sources":["FilterPermissions.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\"Settings_CustomView_FilterPermissions_Js\", {}, {\n\tformElement: false,\n\tregisterButtonsEvent: function () {\n\t\tvar thisInstance = this;\n\t\tvar container = this.getForm();\n\t\tcontainer.find('button.moveItem').on('click', function (e) {\n\t\t\tthisInstance.setDefaultPreferences(e);\n\t\t});\n\t},\n\tregisterDisabledButtons: function () {\n\t\tvar container = this.getForm();\n\t\tcontainer.find('button.moveItem').each(function (n, e) {\n\t\t\tvar currentTarget = jQuery(e);\n\t\t\tvar sourceClass = currentTarget.data('source');\n\t\t\tvar source = container.find('.' + sourceClass);\n\t\t\tif (source.find('option').length && !source.is(':disabled')) {\n\t\t\t\tcurrentTarget.prop('disabled', false);\n\t\t\t} else {\n\t\t\t\tcurrentTarget.prop('disabled', true);\n\t\t\t}\n\t\t});\n\t},\n\tmove: function (currentTarget) {\n\t\tvar container = this.getForm();\n\t\tvar sourceClass = currentTarget.data('source');\n\t\tvar targetClass = currentTarget.data('target');\n\t\tvar target = container.find('.' + targetClass);\n\t\tvar source = container.find('.' + sourceClass).find('option:selected');\n\n\t\tvar values = {};\n\t\tvalues.val = source.val();\n\t\tvalues.label = source.text();\n\t\tvalues.blockLabel = source.closest('optgroup').attr('label');\n\n\t\tvar targetOption = '<option value=\"' + values.val + '\">' + values.label + '</option>';\n\t\tvar targetOpt = target.find('optgroup[label=\"' + values.blockLabel + '\"]');\n\t\tif (targetOpt.length) {\n\t\t\ttargetOpt.append(targetOption);\n\t\t} else {\n\t\t\ttarget.append('<optgroup label=\"' + values.blockLabel + '\">' + targetOption + '</optgroup>');\n\t\t}\n\t\tsource.remove();\n\t\tApp.Fields.Picklist.showSelect2ElementView(container.find('.select2'));\n\t},\n\t/**\n\t * Saves permission for filter\n\t * @param {jQuery.Event} e\n\t */\n\tsetDefaultPreferences: function (e) {\n\t\tvar thisInstance = this;\n\t\tvar container = this.getForm();\n\t\tvar progressIndicatorElement = $.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\tposition: this.getForm(),\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tvar currentTarget = $(e.currentTarget);\n\t\tvar sourceClass = currentTarget.data('source');\n\t\tvar params = {\n\t\t\ttabid: container.find('#sourceModule').val(),\n\t\t\tuser: container.find('.' + sourceClass).val(),\n\t\t\tcvid: container.find('#cvid').val(),\n\t\t\toperator: currentTarget.data('operator'),\n\t\t\ttype: container.find('#type').val()\n\t\t};\n\t\tapp.saveAjax('setFilterPermissions', {}, params).done(function (data) {\n\t\t\tif (data.success) {\n\t\t\t\tif (data.result.success) {\n\t\t\t\t\tthisInstance.move(currentTarget);\n\t\t\t\t\tthisInstance.registerDisabledButtons();\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({mode: 'hide'});\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({text: data.result.message, type: 'success'});\n\t\t\t\t} else {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({mode: 'hide'});\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({text: data.result.message, type: 'error'});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tprogressIndicatorElement.progressIndicator({mode: 'hide'});\n\t\t\t}\n\t\t});\n\t},\n\tgetForm: function () {\n\t\tif (this.formElement == false) {\n\t\t\tthis.setForm(jQuery('#modalFilterPermissions'));\n\t\t}\n\t\treturn this.formElement;\n\t},\n\tsetForm: function (element) {\n\t\tthis.formElement = element;\n\t\treturn this;\n\t},\n\tregisterEvents: function () {\n\t\tthis.registerButtonsEvent();\n\t\tthis.registerDisabledButtons();\n\t}\n\n});\n\njQuery(document).ready(function (e) {\n\tvar instance = new Settings_CustomView_FilterPermissions_Js();\n\tinstance.registerEvents();\n})\n"],"names":["jQuery","Class","thisInstance","container","getForm","find","on","e","setDefaultPreferences","each","n","currentTarget","sourceClass","data","source","length","is","prop","targetClass","target","values","val","label","text","blockLabel","closest","attr","targetOption","targetOpt","append","remove","Fields","Picklist","showSelect2ElementView","progressIndicatorElement","$","progressIndicator","app","vtranslate","params","saveAjax","done","success","result","move","registerDisabledButtons","mode","showPnotify","message","type","formElement","setForm","element","registerButtonsEvent","document","ready","instance","Settings_CustomView_FilterPermissions_Js","registerEvents"],"mappings":"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"}