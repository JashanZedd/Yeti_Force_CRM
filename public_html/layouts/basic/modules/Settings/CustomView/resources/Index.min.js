"use strict";jQuery.Class("Settings_CustomView_Index_Js",{},{container:!1,contents:!1,initEvents:function(container){var _this=this;container.on("click",".js-delete-filter",(function(e){_this.deleteFilter(e)})),container.on("change",".js-update-field",(function(e){_this.updateField(e)})),container.on("click",".js-update,.js-create-filter",(function(e){_this.update(e)})),container.on("change",".js-module-filter",(function(e){_this.registerFilterChange(e)}))},update:function(e){var editUrl=$(e.currentTarget).data("editurl");new CustomView(editUrl)},updateField:function(e){var thisInstance=this,target=$(e.currentTarget),closestTrElement=target.closest(".js-filter-row");$.progressIndicator({message:app.vtranslate("JS_SAVE_LOADER_INFO"),blockInfo:{enabled:!0}});var params={cvid:closestTrElement.data("cvid"),mod:closestTrElement.data("mod"),name:target.attr("name"),value:target.val()};app.saveAjax("updateField",{},params).done((function(data){thisInstance.getContainer().find(".js-module-filter").trigger("change")}))},deleteFilter:function(e){var thisInstance=this,closestTrElement=$(e.currentTarget).closest(".js-filter-row");$.progressIndicator({message:app.vtranslate("JS_SAVE_LOADER_INFO"),blockInfo:{enabled:!0}}),app.saveAjax("delete",{},{cvid:closestTrElement.data("cvid")}).done((function(){thisInstance.getContainer().find(".js-module-filter").trigger("change")}))},makeFilterListSortable:function(container){var thisInstance=this,tbody=container.find("tbody");tbody.children().length>1&&tbody.each((function(){jQuery(this).sortable({containment:"tbody",revert:!0,tolerance:"pointer",cursor:"move",helper:function(e,ui){return ui.children().each((function(index,element){(element=jQuery(element)).width(element.width())})),ui},update:function(e,ui){thisInstance.updateSequence()}})}))},updateSequence:function(){var sequences=[];this.getContents().find(".js-filter-row").each((function(n,row){var cvId=$(row).data("cvid");sequences.push(cvId)})),app.saveAjax("upadteSequences",sequences).done((function(data){data.success&&Vtiger_Helper_Js.showPnotify({text:data.result.message,type:"success"})}))},registerFilterChange:function(e){var thisInstance=this,aDeferred=$.Deferred(),progress=$.progressIndicator({message:app.vtranslate("JS_LOADING_PLEASE_WAIT"),blockInfo:{enabled:!0}}),params={module:app.getModuleName(),view:app.getViewName(),parent:app.getParentModuleName(),sourceModule:$(e.currentTarget).val()};return AppConnector.requestPjax(params).done((function(data){var contents=thisInstance.getContents().html(data);thisInstance.makeFilterListSortable(contents),thisInstance.getContainer().find(".js-create-filter").data("editurl",contents.find("#js-add-filter-url").val()),progress.progressIndicator({mode:"hide"}),aDeferred.resolve(data)})).fail((function(error){aDeferred.reject()})),aDeferred.promise()},getContainer:function(){return 0==this.container&&(this.container=jQuery("div.contentsDiv")),this.container},getContents:function(){return 0==this.contents&&(this.contents=this.getContainer().find(".indexContents")),this.contents},registerEvents:function(){var container=this.getContainer();this.initEvents(container),this.makeFilterListSortable(container)}});
//# sourceMappingURL=Index.min.js.map
