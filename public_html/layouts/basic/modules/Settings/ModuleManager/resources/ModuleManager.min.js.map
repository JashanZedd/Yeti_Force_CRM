{"version":3,"file":"ModuleManager.min.js","sources":["ModuleManager.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n * Contributor(s): YetiForce.com\n *************************************************************************************/\n'use strict';\n\njQuery.Class('Settings_Module_Manager_Js', {\n\tvalidateField(field, rules, i, options) {\n\t\tconst specialChars = /[&\\<\\>\\:\\'\\\"\\,]/;\n\t\tif (specialChars.test(field.val())) {\n\t\t\treturn app.vtranslate('JS_SPECIAL_CHARACTERS_NOT_ALLOWED');\n\t\t}\n\t\treturn true;\n\t},\n\tvalidateModuleName(field, rules, i, options) {\n\t\tlet returnVal = false;\n\t\tconst progressIndicatorElement = jQuery.progressIndicator();\n\t\tAppConnector.request({\n\t\t\tasync: false,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'Basic',\n\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\tmode: 'checkModuleName',\n\t\t\t\tmoduleName: field.val()\n\t\t\t}\n\t\t}).done((data) => {\n\t\t\tconst result = data.result;\n\t\t\tif (result.success) {\n\t\t\t\treturnVal = true;\n\t\t\t} else {\n\t\t\t\treturnVal = result.text;\n\t\t\t}\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t}).fail((data, error) => {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\treturnVal = app.vtranslate('JS_NOT_ALLOWED_VALUE');\n\t\t});\n\t\treturn returnVal;\n\t},\n\tsendForm(form) {\n\t\tconst formData = form.serializeFormData();\n\t\tconst progress = $.progressIndicator({\n\t\t\t'message': app.vtranslate('Adding a Key'),\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tAppConnector.request({\n\t\t\tmodule: app.getModuleName(),\n\t\t\tparent: app.getParentModuleName(),\n\t\t\taction: 'Basic',\n\t\t\tmode: 'createModule',\n\t\t\tformData: formData\n\t\t}).done(function (data) {\n\t\t\tprogress.progressIndicator({'mode': 'hide'});\n\t\t\tconst result = data.result;\n\t\t\tif (!result.success) {\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttext: result.text,\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\twindow.location.href = 'index.php?parent=Settings&module=LayoutEditor&sourceModule=' + result.text;\n\t\t\t}\n\t\t});\n\t},\n\tregisterModalCreateModule(data) {\n\t\tconst form = data.find('form');\n\t\tform.validationEngine(app.validationEngineOptions);\n\t\tdata.find('[name=\"saveButton\"]').on('click', (e) => {\n\t\t\tif (form.validationEngine('validate')) {\n\t\t\t\tthis.sendForm(form);\n\t\t\t}\n\t\t});\n\t}\n}, {\n\t/*\n\t * function to update the module status for the module\n\t * @params: currentTarget - checkbox related to module.\n\t */\n\tupdateModuleStatus: function (currentTarget) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar forModule = currentTarget.data('module');\n\t\tvar status = currentTarget.is(':checked');\n\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tvar params = {}\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['updateStatus'] = status;\n\t\tparams['forModule'] = forModule;\n\t\tparams['action'] = 'Basic';\n\t\tparams['mode'] = 'updateModuleStatus';\n\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.reject(error);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\tcreateModule: function (currentTarget) {\n\t\tvar progressIndicatorElement = jQuery.progressIndicator();\n\t\tapp.showModalWindow(null, \"index.php?module=ModuleManager&parent=Settings&view=CreateModule\", function (wizardContainer) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\tSettings_Module_Manager_Js.registerModalCreateModule(wizardContainer);\n\t\t});\n\t},\n\t//This will show the notification message using pnotify\n\tshowNotify: function (customParams) {\n\t\tvar params = {\n\t\t\ttitle: app.vtranslate('JS_MESSAGE'),\n\t\t\ttext: '',\n\t\t\ttype: 'info'\n\t\t};\n\t\t$.extend(params, customParams);\n\t\tVtiger_Helper_Js.showPnotify(params);\n\t},\n\tframeProgress: false,\n\tdeleteModule: function(container) {\n\t\tconst self = this;\n\t\tcontainer.on('click', '.deleteModule', function() {\n\t\t\tlet forModule = $(this).attr(\"name\");\n\t\t\tVtiger_Helper_Js.showConfirmationBox({\n\t\t\t\tmessage: app.vtranslate(\"JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE\")\n\t\t\t}).done(function(e) {\n\t\t\t\tself.frameProgress = $.progressIndicator({\n\t\t\t\t\tposition: \"html\",\n\t\t\t\t\tmessage: app.vtranslate(\"JS_FRAME_IN_PROGRESS\"),\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: \"Basic\",\n\t\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\t\tmode: \"deleteModule\",\n\t\t\t\t\tforModule: forModule\n\t\t\t\t}).done(function(data) {\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\ttitle: app.vtranslate(\"JS_REMOVED_MODULE\"),\n\t\t\t\t\t\ttype: \"info\"\n\t\t\t\t\t});\n\t\t\t\t\tapp.openUrl(\"index.php?module=ModuleManager&parent=Settings&view=List\");\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\tregisterEvents: function (e) {\n\t\tvar thisInstance = this;\n\t\tvar container = jQuery('#moduleManagerContents');\n\t\tcontainer.find('.createModule').on('click', thisInstance.createModule);\n\t\tvar scrollbar = container.find('.js-scrollbar');\n\t\tapp.showNewScrollbarTopBottom(scrollbar);\n\t\tthisInstance.deleteModule(container);\n\t\t//register click event for check box to update the module status\n\t\tcontainer.on('click', '[name=\"moduleStatus\"]', function (e) {\n\t\t\tvar currentTarget = jQuery(e.currentTarget);\n\t\t\tvar moduleBlock = currentTarget.closest('.moduleManagerBlock');\n\t\t\tvar actionButtons = moduleBlock.find('.actions');\n\t\t\tvar forModule = currentTarget.data('moduleTranslation');\n\t\t\tvar moduleDetails = moduleBlock.find('.moduleImage, .moduleName');\n\n\t\t\tif (currentTarget.is(':checked')) {\n\t\t\t\t//show the settings button for the module.\n\t\t\t\tactionButtons.removeClass('d-none');\n\n\t\t\t\t//changing opacity of the block if the module is enabled\n\t\t\t\tmoduleDetails.removeClass('dull');\n\n\t\t\t\t//update the module status as enabled\n\t\t\t\tthisInstance.updateModuleStatus(currentTarget).done(function (data) {\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\ttext: forModule + ' ' + app.vtranslate('JS_MODULE_ENABLED'),\n\t\t\t\t\t}\n\t\t\t\t\tif (data.success == false) {\n\t\t\t\t\t\tparams.type = 'error';\n\t\t\t\t\t\tparams.text = data.error.message;\n\n\t\t\t\t\t}\n\t\t\t\t\tthisInstance.showNotify(params);\n\t\t\t\t});\n\n\t\t\t} else {\n\t\t\t\t//hide the settings button for the module.\n\t\t\t\tactionButtons.addClass('d-none');\n\n\t\t\t\t//changing opacity of the block if the module is disabled\n\t\t\t\tmoduleDetails.addClass('dull');\n\n\t\t\t\t//update the module status as disabled\n\t\t\t\tthisInstance.updateModuleStatus(currentTarget).done(function (data) {\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\ttext: forModule + ' ' + app.vtranslate('JS_MODULE_DISABLED')\n\t\t\t\t\t}\n\t\t\t\t\tthisInstance.showNotify(params);\n\t\t\t\t});\n\t\t\t}\n\n\t\t});\n\t}\n});\njQuery(document).ready(function () {\n\tvar settingModuleManagerInstance = new Settings_Module_Manager_Js();\n\tsettingModuleManagerInstance.registerEvents();\n})\n"],"names":["jQuery","Class","field","rules","i","options","specialChars","test","val","app","vtranslate","returnVal","progressIndicatorElement","progressIndicator","request","getModuleName","getParentModuleName","done","data","result","success","text","fail","error","form","formData","serializeFormData","progress","$","showPnotify","location","href","find","validationEngine","validationEngineOptions","on","e","sendForm","currentTarget","aDeferred","Deferred","forModule","status","is","params","resolve","reject","promise","showModalWindow","wizardContainer","registerModalCreateModule","customParams","extend","container","self","attr","showConfirmationBox","frameProgress","openUrl","thisInstance","createModule","scrollbar","showNewScrollbarTopBottom","deleteModule","moduleBlock","closest","actionButtons","moduleDetails","removeClass","updateModuleStatus","type","message","showNotify","addClass","document","ready","settingModuleManagerInstance","Settings_Module_Manager_Js","registerEvents"],"mappings":"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"}