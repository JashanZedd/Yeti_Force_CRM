{"version":3,"file":"ModuleManager.min.js","sources":["ModuleManager.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n * Contributor(s): YetiForce.com\n *************************************************************************************/\n'use strict';\n\njQuery.Class('Settings_Module_Manager_Js', {\n\tvalidateField(field, rules, i, options) {\n\t\tconst specialChars = /[&\\<\\>\\:\\'\\\"\\,]/;\n\t\tif (specialChars.test(field.val())) {\n\t\t\treturn app.vtranslate('JS_SPECIAL_CHARACTERS_NOT_ALLOWED');\n\t\t}\n\t\treturn true;\n\t},\n\tvalidateModuleName(field, rules, i, options) {\n\t\tlet returnVal = false;\n\t\tconst progressIndicatorElement = jQuery.progressIndicator();\n\t\tAppConnector.request({\n\t\t\tasync: false,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'Basic',\n\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\tmode: 'checkModuleName',\n\t\t\t\tmoduleName: field.val()\n\t\t\t}\n\t\t}).done((data) => {\n\t\t\tconst result = data.result;\n\t\t\tif (result.success) {\n\t\t\t\treturnVal = true;\n\t\t\t} else {\n\t\t\t\treturnVal = result.text;\n\t\t\t}\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t}).fail((data, error) => {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\treturnVal = app.vtranslate('JS_NOT_ALLOWED_VALUE');\n\t\t});\n\t\treturn returnVal;\n\t},\n\tsendForm(form) {\n\t\tconst formData = form.serializeFormData();\n\t\tconst progress = $.progressIndicator({\n\t\t\t'message': app.vtranslate('Adding a Key'),\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tAppConnector.request({\n\t\t\tmodule: app.getModuleName(),\n\t\t\tparent: app.getParentModuleName(),\n\t\t\taction: 'Basic',\n\t\t\tmode: 'createModule',\n\t\t\tformData: formData\n\t\t}).done(function (data) {\n\t\t\tprogress.progressIndicator({'mode': 'hide'});\n\t\t\tconst result = data.result;\n\t\t\tif (!result.success) {\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttext: result.text,\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\twindow.location.href = 'index.php?parent=Settings&module=LayoutEditor&sourceModule=' + result.text;\n\t\t\t}\n\t\t});\n\t},\n\tregisterModalCreateModule(data) {\n\t\tconst form = data.find('form');\n\t\tform.validationEngine(app.validationEngineOptions);\n\t\tdata.find('[name=\"saveButton\"]').on('click', (e) => {\n\t\t\tif (form.validationEngine('validate')) {\n\t\t\t\tthis.sendForm(form);\n\t\t\t}\n\t\t});\n\t}\n}, {\n\t/*\n\t * function to update the module status for the module\n\t * @params: currentTarget - checkbox related to module.\n\t */\n\tupdateModuleStatus: function (currentTarget) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar forModule = currentTarget.data('module');\n\t\tvar status = currentTarget.is(':checked');\n\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tvar params = {}\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['updateStatus'] = status;\n\t\tparams['forModule'] = forModule;\n\t\tparams['action'] = 'Basic';\n\t\tparams['mode'] = 'updateModuleStatus';\n\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.reject(error);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\tcreateModule: function (currentTarget) {\n\t\tvar progressIndicatorElement = jQuery.progressIndicator();\n\t\tapp.showModalWindow(null, \"index.php?module=ModuleManager&parent=Settings&view=CreateModule\", function (wizardContainer) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\tSettings_Module_Manager_Js.registerModalCreateModule(wizardContainer);\n\t\t});\n\t},\n\t//This will show the notification message using pnotify\n\tshowNotify: function (customParams) {\n\t\tvar params = {\n\t\t\ttitle: app.vtranslate('JS_MESSAGE'),\n\t\t\ttext: '',\n\t\t\ttype: 'info'\n\t\t};\n\t\t$.extend(params, customParams);\n\t\tVtiger_Helper_Js.showPnotify(params);\n\t},\n\tframeProgress: false,\n\tdeleteModule: function(container) {\n\t\tconst self = this;\n\t\tcontainer.on('click', '.deleteModule', function() {\n\t\t\tlet forModule = $(this).attr(\"name\");\n\t\t\tVtiger_Helper_Js.showConfirmationBox({\n\t\t\t\tmessage: app.vtranslate(\"JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE\")\n\t\t\t}).done(function(e) {\n\t\t\t\tself.frameProgress = $.progressIndicator({\n\t\t\t\t\tposition: \"html\",\n\t\t\t\t\tmessage: app.vtranslate(\"JS_FRAME_IN_PROGRESS\"),\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: \"Basic\",\n\t\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\t\tmode: \"deleteModule\",\n\t\t\t\t\tforModule: forModule\n\t\t\t\t}).done(function(data) {\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\ttitle: app.vtranslate(\"JS_REMOVED_MODULE\"),\n\t\t\t\t\t\ttype: \"info\"\n\t\t\t\t\t});\n\t\t\t\t\tapp.openUrl(\"index.php?module=ModuleManager&parent=Settings&view=List\");\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\tregisterEvents: function (e) {\n\t\tvar thisInstance = this;\n\t\tvar container = jQuery('#moduleManagerContents');\n\t\tcontainer.find('.createModule').on('click', thisInstance.createModule);\n\t\tvar scrollbar = container.find('.js-scrollbar');\n\t\tapp.showNewScrollbarTopBottom(scrollbar);\n\t\tthisInstance.deleteModule(container);\n\t\t//register click event for check box to update the module status\n\t\tcontainer.on('click', '[name=\"moduleStatus\"]', function (e) {\n\t\t\tvar currentTarget = jQuery(e.currentTarget);\n\t\t\tvar moduleBlock = currentTarget.closest('.moduleManagerBlock');\n\t\t\tvar actionButtons = moduleBlock.find('.actions');\n\t\t\tvar forModule = currentTarget.data('moduleTranslation');\n\t\t\tvar moduleDetails = moduleBlock.find('.moduleImage, .moduleName');\n\n\t\t\tif (currentTarget.is(':checked')) {\n\t\t\t\t//show the settings button for the module.\n\t\t\t\tactionButtons.removeClass('d-none');\n\n\t\t\t\t//changing opacity of the block if the module is enabled\n\t\t\t\tmoduleDetails.removeClass('dull');\n\n\t\t\t\t//update the module status as enabled\n\t\t\t\tthisInstance.updateModuleStatus(currentTarget).done(function (data) {\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\ttext: forModule + ' ' + app.vtranslate('JS_MODULE_ENABLED'),\n\t\t\t\t\t}\n\t\t\t\t\tif (data.success == false) {\n\t\t\t\t\t\tparams.type = 'error';\n\t\t\t\t\t\tparams.text = data.error.message;\n\n\t\t\t\t\t}\n\t\t\t\t\tthisInstance.showNotify(params);\n\t\t\t\t});\n\n\t\t\t} else {\n\t\t\t\t//hide the settings button for the module.\n\t\t\t\tactionButtons.addClass('d-none');\n\n\t\t\t\t//changing opacity of the block if the module is disabled\n\t\t\t\tmoduleDetails.addClass('dull');\n\n\t\t\t\t//update the module status as disabled\n\t\t\t\tthisInstance.updateModuleStatus(currentTarget).done(function (data) {\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\ttext: forModule + ' ' + app.vtranslate('JS_MODULE_DISABLED')\n\t\t\t\t\t}\n\t\t\t\t\tthisInstance.showNotify(params);\n\t\t\t\t});\n\t\t\t}\n\n\t\t});\n\t}\n});\njQuery(document).ready(function () {\n\tvar settingModuleManagerInstance = new Settings_Module_Manager_Js();\n\tsettingModuleManagerInstance.registerEvents();\n})\n"],"names":["jQuery","Class","field","rules","i","options","test","val","app","vtranslate","returnVal","progressIndicatorElement","progressIndicator","request","getModuleName","getParentModuleName","done","data","result","success","text","mode","fail","error","form","formData","serializeFormData","progress","$","location","href","showPnotify","find","validationEngine","validationEngineOptions","on","e","sendForm","currentTarget","aDeferred","Deferred","forModule","status","is","params","resolve","reject","promise","showModalWindow","wizardContainer","registerModalCreateModule","customParams","extend","container","self","this","attr","showConfirmationBox","frameProgress","openUrl","thisInstance","createModule","scrollbar","showNewScrollbarTopBottom","deleteModule","moduleBlock","closest","actionButtons","moduleDetails","removeClass","updateModuleStatus","type","message","showNotify","addClass","document","ready","Settings_Module_Manager_Js","registerEvents"],"mappings":"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"}