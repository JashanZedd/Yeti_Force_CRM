"use strict";jQuery.Class("Settings_Module_Import_Js",{},{getImportModuleStep1Params:function(){return{module:app.getModuleName(),parent:app.getParentModuleName(),view:"ModuleImport"}},getImportModuleStepView:function(params){var aDeferred=jQuery.Deferred(),progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}});return AppConnector.request(params).done((function(data){progressIndicatorElement.progressIndicator({mode:"hide"}),aDeferred.resolve(data)})).fail((function(error){progressIndicatorElement.progressIndicator({mode:"hide"}),aDeferred.reject(error)})),aDeferred.promise()},registerEventForStep1:function(){var form=$(".js-validation-engine");form.validationEngine(),this.validationFileZipPath(form);var detailContentsHolder=jQuery(".contentsDiv");app.showScrollBar(jQuery(".extensionDescription"),{height:"120px",width:"100%",railVisible:!0}),this.registerEventsForImportModuleStep1(detailContentsHolder)},validationFileZipPath:function(form){form.on("submit",(function(e){if(void 0!==form.data("submit"))return!1;var fileParts=form.find(".js-validation-zip").val().toLowerCase().split("."),fileType=fileParts[fileParts.length-1];if(""==fileType){var params={text:app.vtranslate("JS_IMPORT_FILE_CAN_NOT_BE_EMPTY"),type:"error"};return Vtiger_Helper_Js.showMessage(params),!1}if("zip"!=fileType){var _params={text:app.vtranslate("JS_SELECT_FILE_EXTENSION")+"\n.zip",type:"error"};return Vtiger_Helper_Js.showMessage(_params),!1}}))},registerEventsForImportModuleStep1:function(container){var thisInstance=this;jQuery(container).find(".installExtension").on("click",(function(e){var extensionContainer=jQuery(e.currentTarget).closest(".extension_container"),extensionId=extensionContainer.find('[name="extensionId"]').val(),moduleAction=extensionContainer.find('[name="moduleAction"]').val(),extensionName=extensionContainer.find('[name="extensionName"]').val(),params={module:app.getModuleName(),parent:app.getParentModuleName(),view:"ModuleImport",mode:"step2",extensionId:extensionId,moduleAction:moduleAction,extensionName:extensionName};thisInstance.getImportModuleStepView(params).done((function(data){var detailContentsHolder=jQuery(".contentsDiv");detailContentsHolder.html(data),app.showScrollBar(jQuery("#extensionLicense"),{height:"auto"}),thisInstance.registerEventsForImportModuleStep2(detailContentsHolder)}))}))},registerEventsForImportModuleStep2:function(container){container=jQuery(container);var thisInstance=this;container.find("#installExtension").on("click",(function(){var extensionId=jQuery('[name="extensionId"]').val(),targetModule=jQuery('[name="targetModule"]').val(),moduleType=jQuery('[name="moduleType"]').val(),moduleAction=jQuery('[name="moduleAction"]').val(),fileName=jQuery('[name="fileName"]').val(),params={module:app.getModuleName(),parent:app.getParentModuleName(),view:"ModuleImport",mode:"step3",extensionId:extensionId,moduleAction:moduleAction,targetModule:targetModule,moduleType:moduleType,fileName:fileName};thisInstance.getImportModuleStepView(params).done((function(step3Data){var modalData={data:step3Data,unblockcb:function(){container.find("#declineExtension").trigger("click")},css:{width:"60%",height:"40%"},cb:function(data){"success"==jQuery(data).find('[name="installationStatus"]').val()&&jQuery("#installExtension").remove(),app.showScrollBar(jQuery("#installationLog"),{height:"150px"}),jQuery(data).find("#importCompleted").on("click",(function(e){container.find("#declineExtension").trigger("click")}))}};app.showModalWindow(modalData)}))})),container.find("#declineExtension").on("click",(function(){var params=thisInstance.getImportModuleStep1Params();thisInstance.getImportModuleStepView(params).done((function(data){jQuery(".contentsDiv").html(data),thisInstance.registerEventForStep1()}))}))},registerEvents:function(){this.registerEventForStep1(),$(".js-form-import-module").on("submit",(function(){$(".js-save-button").attr("disabled",!0)}))}}),jQuery(document).ready((function(){(new Settings_Module_Import_Js).registerEvents()}));
//# sourceMappingURL=ModuleImport.min.js.map
