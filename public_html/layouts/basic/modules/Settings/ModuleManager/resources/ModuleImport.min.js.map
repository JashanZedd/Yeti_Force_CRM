{"version":3,"file":"ModuleImport.min.js","sources":["ModuleImport.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\njQuery.Class('Settings_Module_Import_Js', {}, {\n\t/**\n\t * Function to get import module step1 params\n\t */\n\tgetImportModuleStep1Params: function () {\n\t\tvar params = {\n\t\t\t'module': app.getModuleName(),\n\t\t\t'parent': app.getParentModuleName(),\n\t\t\t'view': 'ModuleImport'\n\t\t}\n\t\treturn params;\n\t},\n\n\t/**\n\t * Function to get import module with respect to view\n\t */\n\tgetImportModuleStepView: function (params) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.reject(error);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\n\t/**\n\t * Function to register event for step1 of import module\n\t */\n\tregisterEventForStep1: function () {\n\t\tlet form = $('.js-validation-engine');\n\t\tform.validationEngine();\n\t\tthis.validationFileZipPath(form);\n\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\tapp.showScrollBar(jQuery('.extensionDescription'), {'height': '120px', 'width': '100%', 'railVisible': true});\n\t\tthis.registerEventsForImportModuleStep1(detailContentsHolder);\n\t},\n\n\t/**\n\t * Function to validation file zip\n\t */\n\tvalidationFileZipPath: function (form) {\n\t\tform.on('submit', function (e) {\n\t\t\tif (typeof form.data('submit') !== \"undefined\") {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tlet filePath = form.find('.js-validation-zip').val()\n\t\t\t\tlet fileParts = filePath.toLowerCase().split('.');\n\t\t\t\tlet fileType = fileParts[fileParts.length - 1];\n\t\t\t\tif (fileType == '') {\n\t\t\t\t\tlet errorMessage = app.vtranslate('JS_IMPORT_FILE_CAN_NOT_BE_EMPTY');\n\t\t\t\t\tlet params = {\n\t\t\t\t\t\ttext: errorMessage,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (fileType != 'zip') {\n\t\t\t\t\tlet errorMessage = app.vtranslate('JS_SELECT_FILE_EXTENSION') + '\\n' + '.zip';\n\t\t\t\t\tlet params = {\n\t\t\t\t\t\ttext: errorMessage,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Function to register event related to Import extrension Modules in step1\n\t */\n\tregisterEventsForImportModuleStep1: function (container) {\n\t\tvar thisInstance = this;\n\t\tjQuery(container).find('.installExtension').on('click', function (e) {\n\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\tvar extensionContainer = element.closest('.extension_container');\n\t\t\tvar extensionId = extensionContainer.find('[name=\"extensionId\"]').val();\n\t\t\tvar moduleAction = extensionContainer.find('[name=\"moduleAction\"]').val();\n\t\t\tvar extensionName = extensionContainer.find('[name=\"extensionName\"]').val();\n\t\t\tvar params = {\n\t\t\t\t'module': app.getModuleName(),\n\t\t\t\t'parent': app.getParentModuleName(),\n\t\t\t\t'view': 'ModuleImport',\n\t\t\t\t'mode': 'step2',\n\t\t\t\t'extensionId': extensionId,\n\t\t\t\t'moduleAction': moduleAction,\n\t\t\t\t'extensionName': extensionName\n\t\t\t}\n\n\t\t\tthisInstance.getImportModuleStepView(params).done(function (data) {\n\t\t\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\t\t\tdetailContentsHolder.html(data);\n\t\t\t\tapp.showScrollBar(jQuery('#extensionLicense'), {'height': 'auto'});\n\t\t\t\tthisInstance.registerEventsForImportModuleStep2(detailContentsHolder);\n\t\t\t});\n\t\t})\n\t},\n\n\t/**\n\t * Function to register event related to Import extrension Modules in step2\n\t */\n\tregisterEventsForImportModuleStep2: function (container) {\n\t\tcontainer = jQuery(container);\n\t\tvar thisInstance = this;\n\n\t\tcontainer.find('#installExtension').on('click', function () {\n\t\t\tvar extensionId = jQuery('[name=\"extensionId\"]').val();\n\t\t\tvar targetModule = jQuery('[name=\"targetModule\"]').val();\n\t\t\tvar moduleType = jQuery('[name=\"moduleType\"]').val();\n\t\t\tvar moduleAction = jQuery('[name=\"moduleAction\"]').val();\n\t\t\tvar fileName = jQuery('[name=\"fileName\"]').val();\n\n\t\t\tvar params = {\n\t\t\t\t'module': app.getModuleName(),\n\t\t\t\t'parent': app.getParentModuleName(),\n\t\t\t\t'view': 'ModuleImport',\n\t\t\t\t'mode': 'step3',\n\t\t\t\t'extensionId': extensionId,\n\t\t\t\t'moduleAction': moduleAction,\n\t\t\t\t'targetModule': targetModule,\n\t\t\t\t'moduleType': moduleType,\n\t\t\t\t'fileName': fileName\n\t\t\t}\n\n\t\t\tthisInstance.getImportModuleStepView(params).done(function (step3Data) {\n\t\t\t\tvar callBackFunction = function (data) {\n\t\t\t\t\tvar installationStatus = jQuery(data).find('[name=\"installationStatus\"]').val();\n\t\t\t\t\tif (installationStatus == \"success\") {\n\t\t\t\t\t\tjQuery('#installExtension').remove();\n\t\t\t\t\t}\n\t\t\t\t\tapp.showScrollBar(jQuery('#installationLog'), {'height': '150px'});\n\t\t\t\t\tjQuery(data).find('#importCompleted').on('click', function (e) {\n\t\t\t\t\t\tcontainer.find('#declineExtension').trigger('click');\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tvar modalData = {\n\t\t\t\t\tdata: step3Data,\n\t\t\t\t\tunblockcb: function () {\n\t\t\t\t\t\tcontainer.find('#declineExtension').trigger('click');\n\t\t\t\t\t},\n\t\t\t\t\tcss: {'width': '60%', 'height': '40%'},\n\t\t\t\t\tcb: callBackFunction\n\t\t\t\t};\n\t\t\t\tapp.showModalWindow(modalData);\n\t\t\t});\n\t\t})\n\n\t\tcontainer.find('#declineExtension').on('click', function () {\n\t\t\tvar params = thisInstance.getImportModuleStep1Params();\n\t\t\tthisInstance.getImportModuleStepView(params).done(function (data) {\n\t\t\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\t\t\tdetailContentsHolder.html(data);\n\t\t\t\tthisInstance.registerEventForStep1();\n\t\t\t});\n\t\t})\n\t},\n\n\tregisterEvents: function () {\n\t\tthis.registerEventForStep1();\n\t\t$('.js-form-import-module').on('submit', function() {\n\t\t\t$('.js-save-button').attr('disabled', true);\n\t\t});\n\t}\n});\n\n\njQuery(document).ready(function () {\n\tvar settingModuleImportInstance = new Settings_Module_Import_Js();\n\tsettingModuleImportInstance.registerEvents();\n})\n"],"names":["jQuery","Class","params","app","getModuleName","getParentModuleName","aDeferred","Deferred","progressIndicatorElement","progressIndicator","request","done","data","resolve","fail","error","reject","promise","form","$","validationEngine","validationFileZipPath","detailContentsHolder","showScrollBar","registerEventsForImportModuleStep1","on","e","filePath","find","val","fileParts","toLowerCase","split","fileType","length","errorMessage","vtranslate","showMessage","container","thisInstance","element","currentTarget","extensionContainer","closest","extensionId","moduleAction","extensionName","getImportModuleStepView","html","registerEventsForImportModuleStep2","targetModule","moduleType","fileName","step3Data","callBackFunction","installationStatus","remove","trigger","modalData","showModalWindow","getImportModuleStep1Params","registerEventForStep1","attr","document","ready","settingModuleImportInstance","Settings_Module_Import_Js","registerEvents"],"mappings":"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"}