{"version":3,"file":"ModuleImport.min.js","sources":["ModuleImport.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\njQuery.Class(\n\t'Settings_Module_Import_Js',\n\t{},\n\t{\n\t\t/**\n\t\t * Function to get import module step1 params\n\t\t */\n\t\tgetImportModuleStep1Params: function () {\n\t\t\tvar params = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\tview: 'ModuleImport'\n\t\t\t};\n\t\t\treturn params;\n\t\t},\n\n\t\t/**\n\t\t * Function to get import module with respect to view\n\t\t */\n\t\tgetImportModuleStepView: function (params) {\n\t\t\tvar aDeferred = jQuery.Deferred();\n\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function (data) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t})\n\t\t\t\t.fail(function (error) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\taDeferred.reject(error);\n\t\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\n\t\t/**\n\t\t * Function to register event for step1 of import module\n\t\t */\n\t\tregisterEventForStep1: function () {\n\t\t\tlet form = $('.js-validation-engine');\n\t\t\tform.validationEngine();\n\t\t\tthis.validationFileZipPath(form);\n\t\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\t\tapp.showScrollBar(jQuery('.extensionDescription'), {\n\t\t\t\theight: '120px',\n\t\t\t\twidth: '100%',\n\t\t\t\trailVisible: true\n\t\t\t});\n\t\t\tthis.registerEventsForImportModuleStep1(detailContentsHolder);\n\t\t},\n\n\t\t/**\n\t\t * Function to validation file zip\n\t\t */\n\t\tvalidationFileZipPath: function (form) {\n\t\t\tform.on('submit', function (e) {\n\t\t\t\tif (typeof form.data('submit') !== 'undefined') {\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\tlet filePath = form.find('.js-validation-zip').val();\n\t\t\t\t\tlet fileParts = filePath.toLowerCase().split('.');\n\t\t\t\t\tlet fileType = fileParts[fileParts.length - 1];\n\t\t\t\t\tif (fileType == '') {\n\t\t\t\t\t\tlet errorMessage = app.vtranslate('JS_IMPORT_FILE_CAN_NOT_BE_EMPTY');\n\t\t\t\t\t\tlet params = {\n\t\t\t\t\t\t\ttext: errorMessage,\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t};\n\t\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (fileType != 'zip') {\n\t\t\t\t\t\tlet errorMessage = app.vtranslate('JS_SELECT_FILE_EXTENSION') + '\\n' + '.zip';\n\t\t\t\t\t\tlet params = {\n\t\t\t\t\t\t\ttext: errorMessage,\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t};\n\t\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Function to register event related to Import extrension Modules in step1\n\t\t */\n\t\tregisterEventsForImportModuleStep1: function (container) {\n\t\t\tvar thisInstance = this;\n\t\t\tjQuery(container)\n\t\t\t\t.find('.installExtension')\n\t\t\t\t.on('click', function (e) {\n\t\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\t\tvar extensionContainer = element.closest('.extension_container');\n\t\t\t\t\tvar extensionId = extensionContainer.find('[name=\"extensionId\"]').val();\n\t\t\t\t\tvar moduleAction = extensionContainer.find('[name=\"moduleAction\"]').val();\n\t\t\t\t\tvar extensionName = extensionContainer.find('[name=\"extensionName\"]').val();\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\t\t\tview: 'ModuleImport',\n\t\t\t\t\t\tmode: 'step2',\n\t\t\t\t\t\textensionId: extensionId,\n\t\t\t\t\t\tmoduleAction: moduleAction,\n\t\t\t\t\t\textensionName: extensionName\n\t\t\t\t\t};\n\n\t\t\t\t\tthisInstance.getImportModuleStepView(params).done(function (data) {\n\t\t\t\t\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\t\t\t\t\tdetailContentsHolder.html(data);\n\t\t\t\t\t\tapp.showScrollBar(jQuery('#extensionLicense'), { height: 'auto' });\n\t\t\t\t\t\tthisInstance.registerEventsForImportModuleStep2(detailContentsHolder);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Function to register event related to Import extrension Modules in step2\n\t\t */\n\t\tregisterEventsForImportModuleStep2: function (container) {\n\t\t\tcontainer = jQuery(container);\n\t\t\tvar thisInstance = this;\n\n\t\t\tcontainer.find('#installExtension').on('click', function () {\n\t\t\t\tvar extensionId = jQuery('[name=\"extensionId\"]').val();\n\t\t\t\tvar targetModule = jQuery('[name=\"targetModule\"]').val();\n\t\t\t\tvar moduleType = jQuery('[name=\"moduleType\"]').val();\n\t\t\t\tvar moduleAction = jQuery('[name=\"moduleAction\"]').val();\n\t\t\t\tvar fileName = jQuery('[name=\"fileName\"]').val();\n\n\t\t\t\tvar params = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\t\tview: 'ModuleImport',\n\t\t\t\t\tmode: 'step3',\n\t\t\t\t\textensionId: extensionId,\n\t\t\t\t\tmoduleAction: moduleAction,\n\t\t\t\t\ttargetModule: targetModule,\n\t\t\t\t\tmoduleType: moduleType,\n\t\t\t\t\tfileName: fileName\n\t\t\t\t};\n\n\t\t\t\tthisInstance.getImportModuleStepView(params).done(function (step3Data) {\n\t\t\t\t\tvar callBackFunction = function (data) {\n\t\t\t\t\t\tvar installationStatus = jQuery(data).find('[name=\"installationStatus\"]').val();\n\t\t\t\t\t\tif (installationStatus == 'success') {\n\t\t\t\t\t\t\tjQuery('#installExtension').remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tapp.showScrollBar(jQuery('#installationLog'), { height: '150px' });\n\t\t\t\t\t\tjQuery(data)\n\t\t\t\t\t\t\t.find('#importCompleted')\n\t\t\t\t\t\t\t.on('click', function (e) {\n\t\t\t\t\t\t\t\tcontainer.find('#declineExtension').trigger('click');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t};\n\t\t\t\t\tvar modalData = {\n\t\t\t\t\t\tdata: step3Data,\n\t\t\t\t\t\tunblockcb: function () {\n\t\t\t\t\t\t\tcontainer.find('#declineExtension').trigger('click');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcss: { width: '60%', height: '40%' },\n\t\t\t\t\t\tcb: callBackFunction\n\t\t\t\t\t};\n\t\t\t\t\tapp.showModalWindow(modalData);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tcontainer.find('#declineExtension').on('click', function () {\n\t\t\t\tvar params = thisInstance.getImportModuleStep1Params();\n\t\t\t\tthisInstance.getImportModuleStepView(params).done(function (data) {\n\t\t\t\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\t\t\t\tdetailContentsHolder.html(data);\n\t\t\t\t\tthisInstance.registerEventForStep1();\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tregisterEvents: function () {\n\t\t\tthis.registerEventForStep1();\n\t\t\t$('.js-form-import-module').on('submit', function () {\n\t\t\t\t$('.js-save-button').attr('disabled', true);\n\t\t\t});\n\t\t}\n\t}\n);\n\njQuery(document).ready(function () {\n\tvar settingModuleImportInstance = new Settings_Module_Import_Js();\n\tsettingModuleImportInstance.registerEvents();\n});\n"],"names":["jQuery","Class","getImportModuleStep1Params","params","module","app","getModuleName","parent","getParentModuleName","view","getImportModuleStepView","aDeferred","Deferred","progressIndicatorElement","progressIndicator","position","blockInfo","enabled","request","done","data","mode","resolve","fail","error","reject","promise","registerEventForStep1","form","$","validationEngine","validationFileZipPath","detailContentsHolder","showScrollBar","height","width","railVisible","registerEventsForImportModuleStep1","on","filePath","find","val","fileParts","toLowerCase","split","fileType","length","errorMessage","vtranslate","Vtiger_Helper_Js","showMessage","text","type","container","e","currentTarget","extensionContainer","element","closest","extensionId","moduleAction","extensionName","thisInstance","html","registerEventsForImportModuleStep2","targetModule","moduleType","fileName","step3Data","showModalWindow","unblockcb","trigger","css","cb","installationStatus","remove","registerEvents","attr","document","ready","settingModuleImportInstance"],"mappings":"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"}