{"version":3,"file":"ModuleImport.min.js","sources":["ModuleImport.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\njQuery.Class('Settings_Module_Import_Js', {}, {\n\t/**\n\t * Function to get import module step1 params\n\t */\n\tgetImportModuleStep1Params: function () {\n\t\tvar params = {\n\t\t\t'module': app.getModuleName(),\n\t\t\t'parent': app.getParentModuleName(),\n\t\t\t'view': 'ModuleImport'\n\t\t}\n\t\treturn params;\n\t},\n\n\t/**\n\t * Function to get import module with respect to view\n\t */\n\tgetImportModuleStepView: function (params) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.reject(error);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\n\t/**\n\t * Function to register event for step1 of import module\n\t */\n\tregisterEventForStep1: function () {\n\t\tlet form = $('.js-validation-engine');\n\t\tform.validationEngine();\n\t\tthis.validationFileZipPath(form);\n\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\tapp.showScrollBar(jQuery('.extensionDescription'), {'height': '120px', 'width': '100%', 'railVisible': true});\n\t\tthis.registerEventsForImportModuleStep1(detailContentsHolder);\n\t},\n\n\t/**\n\t * Function to validation file zip\n\t */\n\tvalidationFileZipPath: function (form) {\n\t\tform.on('submit', function (e) {\n\t\t\tif (typeof form.data('submit') !== \"undefined\") {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tlet filePath = form.find('.js-validation-zip').val()\n\t\t\t\tlet fileParts = filePath.toLowerCase().split('.');\n\t\t\t\tlet fileType = fileParts[fileParts.length - 1];\n\t\t\t\tif (fileType == '') {\n\t\t\t\t\tlet errorMessage = app.vtranslate('JS_IMPORT_FILE_CAN_NOT_BE_EMPTY');\n\t\t\t\t\tlet params = {\n\t\t\t\t\t\ttext: errorMessage,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (fileType != 'zip') {\n\t\t\t\t\tlet errorMessage = app.vtranslate('JS_SELECT_FILE_EXTENSION') + '\\n' + '.zip';\n\t\t\t\t\tlet params = {\n\t\t\t\t\t\ttext: errorMessage,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Function to register event related to Import extrension Modules in step1\n\t */\n\tregisterEventsForImportModuleStep1: function (container) {\n\t\tvar thisInstance = this;\n\t\tjQuery(container).find('.installExtension').on('click', function (e) {\n\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\tvar extensionContainer = element.closest('.extension_container');\n\t\t\tvar extensionId = extensionContainer.find('[name=\"extensionId\"]').val();\n\t\t\tvar moduleAction = extensionContainer.find('[name=\"moduleAction\"]').val();\n\t\t\tvar extensionName = extensionContainer.find('[name=\"extensionName\"]').val();\n\t\t\tvar params = {\n\t\t\t\t'module': app.getModuleName(),\n\t\t\t\t'parent': app.getParentModuleName(),\n\t\t\t\t'view': 'ModuleImport',\n\t\t\t\t'mode': 'step2',\n\t\t\t\t'extensionId': extensionId,\n\t\t\t\t'moduleAction': moduleAction,\n\t\t\t\t'extensionName': extensionName\n\t\t\t}\n\n\t\t\tthisInstance.getImportModuleStepView(params).done(function (data) {\n\t\t\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\t\t\tdetailContentsHolder.html(data);\n\t\t\t\tapp.showScrollBar(jQuery('#extensionLicense'), {'height': 'auto'});\n\t\t\t\tthisInstance.registerEventsForImportModuleStep2(detailContentsHolder);\n\t\t\t});\n\t\t})\n\t},\n\n\t/**\n\t * Function to register event related to Import extrension Modules in step2\n\t */\n\tregisterEventsForImportModuleStep2: function (container) {\n\t\tcontainer = jQuery(container);\n\t\tvar thisInstance = this;\n\n\t\tcontainer.find('#installExtension').on('click', function () {\n\t\t\tvar extensionId = jQuery('[name=\"extensionId\"]').val();\n\t\t\tvar targetModule = jQuery('[name=\"targetModule\"]').val();\n\t\t\tvar moduleType = jQuery('[name=\"moduleType\"]').val();\n\t\t\tvar moduleAction = jQuery('[name=\"moduleAction\"]').val();\n\t\t\tvar fileName = jQuery('[name=\"fileName\"]').val();\n\n\t\t\tvar params = {\n\t\t\t\t'module': app.getModuleName(),\n\t\t\t\t'parent': app.getParentModuleName(),\n\t\t\t\t'view': 'ModuleImport',\n\t\t\t\t'mode': 'step3',\n\t\t\t\t'extensionId': extensionId,\n\t\t\t\t'moduleAction': moduleAction,\n\t\t\t\t'targetModule': targetModule,\n\t\t\t\t'moduleType': moduleType,\n\t\t\t\t'fileName': fileName\n\t\t\t}\n\n\t\t\tthisInstance.getImportModuleStepView(params).done(function (step3Data) {\n\t\t\t\tvar callBackFunction = function (data) {\n\t\t\t\t\tvar installationStatus = jQuery(data).find('[name=\"installationStatus\"]').val();\n\t\t\t\t\tif (installationStatus == \"success\") {\n\t\t\t\t\t\tjQuery('#installExtension').remove();\n\t\t\t\t\t}\n\t\t\t\t\tapp.showScrollBar(jQuery('#installationLog'), {'height': '150px'});\n\t\t\t\t\tjQuery(data).find('#importCompleted').on('click', function (e) {\n\t\t\t\t\t\tcontainer.find('#declineExtension').trigger('click');\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tvar modalData = {\n\t\t\t\t\tdata: step3Data,\n\t\t\t\t\tunblockcb: function () {\n\t\t\t\t\t\tcontainer.find('#declineExtension').trigger('click');\n\t\t\t\t\t},\n\t\t\t\t\tcss: {'width': '60%', 'height': '40%'},\n\t\t\t\t\tcb: callBackFunction\n\t\t\t\t};\n\t\t\t\tapp.showModalWindow(modalData);\n\t\t\t});\n\t\t})\n\n\t\tcontainer.find('#declineExtension').on('click', function () {\n\t\t\tvar params = thisInstance.getImportModuleStep1Params();\n\t\t\tthisInstance.getImportModuleStepView(params).done(function (data) {\n\t\t\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\t\t\tdetailContentsHolder.html(data);\n\t\t\t\tthisInstance.registerEventForStep1();\n\t\t\t});\n\t\t})\n\t},\n\n\tregisterEvents: function () {\n\t\tthis.registerEventForStep1();\n\t\t$('.js-form-import-module').on('submit', function() {\n\t\t\t$('.js-save-button').attr('disabled', true);\n\t\t});\n\t}\n});\n\n\njQuery(document).ready(function () {\n\tvar settingModuleImportInstance = new Settings_Module_Import_Js();\n\tsettingModuleImportInstance.registerEvents();\n})\n"],"names":["jQuery","Class","app","getModuleName","getParentModuleName","params","aDeferred","Deferred","progressIndicatorElement","progressIndicator","request","done","data","mode","resolve","fail","error","reject","promise","form","$","validationEngine","validationFileZipPath","detailContentsHolder","showScrollBar","height","width","railVisible","registerEventsForImportModuleStep1","on","e","fileParts","find","val","toLowerCase","split","fileType","length","vtranslate","showMessage","container","thisInstance","this","extensionContainer","currentTarget","closest","extensionId","moduleAction","extensionName","getImportModuleStepView","html","registerEventsForImportModuleStep2","targetModule","moduleType","fileName","step3Data","modalData","trigger","remove","showModalWindow","getImportModuleStep1Params","registerEventForStep1","attr","document","ready","Settings_Module_Import_Js","registerEvents"],"mappings":"aAUAA,OAAOC,MAAM,4BAA6B,GAAI,4BAIjB,iBACd,QACFC,IAAIC,uBACJD,IAAIE,2BACN,yCAQe,SAAUC,YAC9BC,UAAYN,OAAOO,WACnBC,yBAA2BR,OAAOS,kBAAkB,UAC3C,iBACC,UACD,yBAIAC,QAAQL,QAAQM,MAAK,SAAUC,+BAClBH,kBAAkB,CAACI,KAAQ,mBAC1CC,QAAQF,SAChBG,MAAK,SAAUC,gCACQP,kBAAkB,CAACI,KAAQ,mBAC1CI,OAAOD,UAEXV,UAAUY,iCAMK,eAClBC,KAAOC,EAAE,8BACRC,wBACAC,sBAAsBH,UACvBI,qBAAuBvB,OAAO,oBAC9BwB,cAAcxB,OAAO,yBAA0B,CAACyB,OAAU,QAASC,MAAS,OAAQC,aAAe,SAClGC,mCAAmCL,6CAMlB,SAAUJ,WAC3BU,GAAG,UAAU,SAAUC,WACQ,IAAxBX,KAAKP,KAAK,iBACb,MAGHmB,UADWZ,KAAKa,KAAK,sBAAsBC,MACtBC,cAAcC,MAAM,KACzCC,SAAWL,UAAUA,UAAUM,OAAS,MAC5B,IAAZD,SAAgB,KAEf/B,OAAS,MADMH,IAAIoC,WAAW,wCAG3B,iCAEUC,YAAYlC,SACtB,KAEQ,OAAZ+B,SAAmB,KAElB/B,QAAS,MADMH,IAAIoC,WAAW,4BAA8B,cAGzD,iCAEUC,YAAYlC,UACtB,0CASyB,SAAUmC,eACzCC,aAAeC,YACZF,WAAWR,KAAK,qBAAqBH,GAAG,SAAS,SAAUC,OAE7Da,mBADU3C,OAAO8B,EAAEc,eACUC,QAAQ,wBACrCC,YAAcH,mBAAmBX,KAAK,wBAAwBC,MAC9Dc,aAAeJ,mBAAmBX,KAAK,yBAAyBC,MAChEe,cAAgBL,mBAAmBX,KAAK,0BAA0BC,MAClE5B,OAAS,QACFH,IAAIC,uBACJD,IAAIE,2BACN,oBACA,oBACO0C,yBACCC,2BACCC,4BAGLC,wBAAwB5C,QAAQM,MAAK,SAAUC,UACvDW,qBAAuBvB,OAAO,qCACbkD,KAAKtC,UACtBY,cAAcxB,OAAO,qBAAsB,CAACyB,OAAU,sBAC7C0B,mCAAmC5B,gEAQf,SAAUiB,qBACjCxC,OAAOwC,eACfC,aAAeC,eAETV,KAAK,qBAAqBH,GAAG,SAAS,eAC3CiB,YAAc9C,OAAO,wBAAwBiC,MAC7CmB,aAAepD,OAAO,yBAAyBiC,MAC/CoB,WAAarD,OAAO,uBAAuBiC,MAC3Cc,aAAe/C,OAAO,yBAAyBiC,MAC/CqB,SAAWtD,OAAO,qBAAqBiC,MAEvC5B,OAAS,QACFH,IAAIC,uBACJD,IAAIE,2BACN,oBACA,oBACO0C,yBACCC,0BACAK,wBACFC,oBACFC,uBAGAL,wBAAwB5C,QAAQM,MAAK,SAAU4C,eAWvDC,UAAY,MACTD,oBACK,qBACAvB,KAAK,qBAAqByB,QAAQ,cAExC,CAAC/B,MAAS,MAAOD,OAAU,UAfV,SAAUb,MAEN,WADDZ,OAAOY,MAAMoB,KAAK,+BAA+BC,cAElE,qBAAqByB,aAEzBlC,cAAcxB,OAAO,oBAAqB,CAACyB,OAAU,iBAClDb,MAAMoB,KAAK,oBAAoBH,GAAG,SAAS,SAAUC,aACjDE,KAAK,qBAAqByB,QAAQ,kBAW1CE,gBAAgBH,2BAIZxB,KAAK,qBAAqBH,GAAG,SAAS,eAC3CxB,OAASoC,aAAamB,0CACbX,wBAAwB5C,QAAQM,MAAK,SAAUC,MAChCZ,OAAO,gBACbkD,KAAKtC,mBACbiD,8CAKA,gBACVA,0BACH,0BAA0BhC,GAAG,UAAU,aACtC,mBAAmBiC,KAAK,YAAY,SAMzC9D,OAAO+D,UAAUC,OAAM,YACY,IAAIC,2BACVC"}