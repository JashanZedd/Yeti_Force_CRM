{"version":3,"file":"Edit.min.js","sources":["Edit.js"],"sourcesContent":["/**\n * SlaPolicy Edit Js class\n *\n * @package     Edit\n *\n * @description SlaPolicy Edit View scripts\n * @license     YetiForce Public License 3.0\n * @author      Rafal Pospiech <r.pospiech@yetiforce.com>\n */\n'use strict';\n\n$.Class(\n\t'Settings_SlaPolicy_Edit_Js',\n\t{},\n\t{\n\t\t/**\n\t\t * Register submit event\n\t\t */\n\t\tregisterSubmitEvent() {\n\t\t\tthis.container.off('submit').on('submit', e => {\n\t\t\t\tif ($(e.currentTarget).validationEngine('validate')) {\n\t\t\t\t\t$('input[name=\"conditions\"]').val(JSON.stringify(this.conditionBuilder.getConditions()));\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\treturn false;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Load condition builder\n\t\t *\n\t\t * @param   {String}  sourceModuleName\n\t\t */\n\t\tloadConditionBuilderView(sourceModuleName) {\n\t\t\tthis.conditionBuilderView = this.container.find('.js-condition-builder-view').eq(0);\n\t\t\tlet progress = $.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tAppConnector.request({\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\tview: 'Conditions',\n\t\t\t\trecord: sourceModuleName === this.sourceModuleName ? this.record : 0,\n\t\t\t\tsourceModuleName: sourceModuleName\n\t\t\t}).done(data => {\n\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\tthis.conditionBuilderView.html(data);\n\t\t\t\tthis.conditionBuilder = new Vtiger_ConditionBuilder_Js(\n\t\t\t\t\tthis.conditionBuilderView.find('.js-condition-builder'),\n\t\t\t\t\tsourceModuleName\n\t\t\t\t);\n\t\t\t\tthis.conditionBuilder.registerEvents();\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Register source module change\n\t\t */\n\t\tregisterSourceModuleChange() {\n\t\t\tthis.sourceModuleSelect = this.container.find('select[name=\"source_module\"]');\n\t\t\tthis.sourceModuleSelect.on('change', e => {\n\t\t\t\tthis.sourceModuleName = this.sourceModuleSelect.val();\n\t\t\t\tthis.loadConditionBuilderView(this.sourceModuleName);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Render business hours\n\t\t *\n\t\t * @param {Array} rows\n\t\t * @returns {String} html\n\t\t */\n\t\trenderBusinessHours(rows) {\n\t\t\tlet html = `<table class=\"table table-sm js-business-hours-table\" data-js=\"container\">`;\n\t\t\thtml += `<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th colspan=\"6\" class=\"text-center\">${app.vtranslate('JS_BUSINESS_HOURS')}</th>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<th></th>\n\t\t\t\t\t<th>${app.vtranslate('JS_BUSINESS_HOURS_NAME')}</th>\n\t\t\t\t\t<th>${app.vtranslate('JS_BUSINESS_HOURS_DAYS')}</th>\n\t\t\t\t\t<th>${app.vtranslate('JS_BUSINESS_HOURS_FROM')}</th>\n\t\t\t\t\t<th>${app.vtranslate('JS_BUSINESS_HOURS_TO')}</th>\n\t\t\t\t</tr>\n\t\t\t</thead><tbody>`;\n\t\t\trows.forEach(row => {\n\t\t\t\thtml += `<tr class=\"js-business-hours-row\" data-id=\"${row.id}\" data-js=\"click\">\n\t\t\t\t\t<td class=\"js-business-hours-table-id\"><input type=\"checkbox\" class=\"checkbox js-business-hours-checkbox\"${\n\t\t\t\t\t\tthis.businessHours.indexOf(Number(row.id)) !== -1 ? ' checked=\"checked\"' : ''\n\t\t\t\t\t}></td>\n\t\t\t\t\t<td class=\"js-business-hours-table-name\">${row.name}</td>\n\t\t\t\t\t<td class=\"js-business-hours-table-days\">${row.working_days}${\n\t\t\t\t\trow.holidays ? ', ' + app.vtranslate('JS_HOLIDAYS') : ''\n\t\t\t\t}</td>\n\t\t\t\t\t<td class=\"js-business-hours-table-from\">${row.working_hours_from}</td>\n\t\t\t\t\t<td class=\"js-business-hours-table-to\">${row.working_hours_to}</td>\n\t\t\t\t</tr>`;\n\t\t\t});\n\t\t\treturn html + '</tbody></table>';\n\t\t},\n\n\t\t/**\n\t\t * Update business hours value inside hidden form input\n\t\t */\n\t\tupdateBusinessHoursValue() {\n\t\t\tthis.container.find('[name=\"business_hours\"]').val(this.businessHours.join(','));\n\t\t},\n\n\t\t/**\n\t\t * Remove business hours\n\t\t *\n\t\t * @param {Number} businessHoursId\n\t\t */\n\t\tremoveBusinessHours(businessHoursId = 0) {\n\t\t\tif (this.businessHours.indexOf(businessHoursId) !== -1) {\n\t\t\t\tthis.businessHours = this.businessHours.filter(id => id !== businessHoursId);\n\t\t\t}\n\t\t\tthis.updateBusinessHoursValue();\n\t\t},\n\n\t\t/**\n\t\t * Add business hours\n\t\t *\n\t\t * @param {Number} businessHoursId\n\t\t */\n\t\taddBusinessHours(businessHoursId) {\n\t\t\tif (this.businessHours.indexOf(businessHoursId) === -1) {\n\t\t\t\tthis.businessHours.push(businessHoursId);\n\t\t\t}\n\t\t\tthis.updateBusinessHoursValue();\n\t\t},\n\n\t\t/**\n\t\t * On business hours row click event handler\n\t\t */\n\t\tonBusinessHoursRowClick(e) {\n\t\t\te.stopPropagation();\n\t\t\tconst target = $(e.target);\n\t\t\tconst isCheckbox = target.hasClass('js-business-hours-checkbox');\n\t\t\tconst row = target.closest('tr');\n\t\t\tconst id = Number(row.data('id'));\n\t\t\tconst checkbox = row.find('input[type=\"checkbox\"]');\n\t\t\tif (checkbox.prop('checked')) {\n\t\t\t\tif (!isCheckbox) {\n\t\t\t\t\tcheckbox.prop('checked', false);\n\t\t\t\t\tthis.removeBusinessHours(id);\n\t\t\t\t} else {\n\t\t\t\t\tthis.addBusinessHours(id);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!isCheckbox) {\n\t\t\t\t\tcheckbox.prop('checked', true);\n\t\t\t\t\tthis.addBusinessHours(id);\n\t\t\t\t} else {\n\t\t\t\t\tthis.removeBusinessHours(id);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Register business hours table events\n\t\t */\n\t\tregisterBusinessHoursTableEvents() {\n\t\t\tconst table = this.container.find('.js-business-hours-table').eq(0);\n\t\t\ttable.find('.js-business-hours-row').on('click', this.onBusinessHoursRowClick.bind(this));\n\t\t},\n\n\t\t/**\n\t\t * Change operational hours view\n\t\t */\n\t\tchangeOperationalHoursView() {\n\t\t\tif (this.operationalHours === 1) {\n\t\t\t\tlet progress = $.progressIndicator({\n\t\t\t\t\tposition: 'html',\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tmodule: 'BusinessHours',\n\t\t\t\t\t\tparent: 'Settings',\n\t\t\t\t\t\tview: 'List'\n\t\t\t\t\t},\n\t\t\t\t\tdataType: 'json'\n\t\t\t\t}).done(data => {\n\t\t\t\t\tif (!data.success) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst rows = JSON.parse(data.result);\n\t\t\t\t\tthis.container.find('.js-business-hours-container-content').html(this.renderBusinessHours(rows));\n\t\t\t\t\tthis.registerBusinessHoursTableEvents();\n\t\t\t\t\tthis.container.find('.js-business-hours-container').removeClass('d-none');\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.container.find('.js-business-hours-container').addClass('d-none');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Register operational hours change\n\t\t */\n\t\tregisterOperationalHoursChange() {\n\t\t\tconst operationalHoursElem = this.container.find('[name=\"operational_hours\"]').eq(0);\n\t\t\toperationalHoursElem.on('change', e => {\n\t\t\t\tthis.operationalHours = Number(operationalHoursElem.val());\n\t\t\t\tthis.changeOperationalHoursView();\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Register events\n\t\t */\n\t\tregisterEvents() {\n\t\t\tthis.container = $('#EditView');\n\t\t\tthis.sourceModuleName = this.container.find('[name=\"source_module\"]').val();\n\t\t\tthis.operationalHours = Number(this.container.find('[name=\"operational_hours\"]').val());\n\t\t\tthis.businessHours = [];\n\t\t\tconst hoursFromInput = this.container.find('[name=\"business_hours\"]').val();\n\t\t\tif (hoursFromInput) {\n\t\t\t\tthis.businessHours = hoursFromInput.split(',').map(id => Number(id));\n\t\t\t}\n\t\t\tthis.record = this.container.find('input[name=\"record\"]').val();\n\t\t\tthis.registerSourceModuleChange();\n\t\t\tthis.loadConditionBuilderView(this.sourceModuleName);\n\t\t\tApp.Fields.TimePeriod.register(this.container);\n\t\t\tthis.changeOperationalHoursView();\n\t\t\tthis.registerOperationalHoursChange();\n\t\t\tthis.registerSubmitEvent();\n\t\t\tthis.container.validationEngine(app.validationEngineOptions);\n\t\t}\n\t}\n);\n"],"names":["$","Class","container","off","on","e","currentTarget","validationEngine","val","JSON","stringify","conditionBuilder","getConditions","preventDefault","stopPropagation","sourceModuleName","conditionBuilderView","find","eq","progress","progressIndicator","request","app","getModuleName","getParentModuleName","record","done","mode","html","data","Vtiger_ConditionBuilder_Js","registerEvents","sourceModuleSelect","loadConditionBuilderView","rows","vtranslate","forEach","row","id","businessHours","indexOf","Number","name","working_days","holidays","working_hours_from","working_hours_to","join","businessHoursId","filter","updateBusinessHoursValue","push","target","isCheckbox","hasClass","closest","checkbox","prop","removeBusinessHours","addBusinessHours","table","onBusinessHoursRowClick","bind","operationalHours","success","parse","result","renderBusinessHours","registerBusinessHoursTableEvents","removeClass","addClass","operationalHoursElem","changeOperationalHoursView","hoursFromInput","split","map","registerSourceModuleChange","Fields","TimePeriod","register","registerOperationalHoursChange","registerSubmitEvent","validationEngineOptions"],"mappings":"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"}