var Colors_Js={initEvants:function(){$(".UserColors .updateColor").click(Colors_Js.updateColor);$(".UserColors .generateColor").click(Colors_Js.generateColor);$(".UserColors .activeColor").click(Colors_Js.activeColor);$(".UserColors .addPicklistColorColumn").click(Colors_Js.addPicklistColorColumn);$(".UserColors .updatePicklistValueColor").click(Colors_Js.updatePicklistValueColor);$(".UserColors .generatePicklistValueColor").click(Colors_Js.generatePicklistValueColor)},updateColor:function(f){var g=$(f.currentTarget);var a=g.closest("tr");var c=g.closest("table");var j=jQuery(".UserColors .editColorContainer");var h=j.clone(true,true);var d=g.data("metod");var i=$("#calendarColorPreview"+g.data("type")+g.data("id"));var b=function(e){e.find(".editColorContainer").removeClass("hide").show();var l=e.find(".selectedColor");l.val(i.data("color"));var k={flat:true,color:i.data("color"),onChange:function(m,o,n){l.val("#"+o);i.data("color","#"+o)}};if(typeof customParams!="undefined"){k=jQuery.extend(k,customParams)}e.find(".calendarColorPicker").ColorPicker(k);e.find('[name="saveButton"]').click(function(n){var m=$.progressIndicator({message:app.vtranslate("Update labels"),blockInfo:{enabled:true}});Colors_Js.registerSaveEvent(d,{color:l.val(),id:g.data("id"),picklistId:g.data("picklistid"),picklistValueId:g.data("picklistvalueid"),table:a.data("table"),field:c.data("fieldname")});i.css("background",l.val());g.data("color",l.val());m.progressIndicator({mode:"hide"});app.hideModalWindow()})};app.showModalWindow(h,function(e){if(typeof b=="function"){b(e)}},{width:"1000px"})},generateColor:function(f){var d=$(f.currentTarget);var b=d.closest("table");var c=d.data("metod");var a=$("#calendarColorPreview"+d.data("type")+d.data("id"));var g={module:app.getModuleName(),action:"SaveAjax",mode:"generateColor",params:{id:d.data("id"),picklistId:d.data("picklistid"),picklistValueId:d.data("picklistvalueid"),color:a.data("color"),table:d.data("table"),field:b.data("fieldname"),mode:c}};AppConnector.request(g).then(function(h){var e=h.result;var i={text:e.message,animation:"show",type:"success"};a.css("background",e.color);a.data("color",e.color);Vtiger_Helper_Js.showPnotify(i)},function(h,e){})},registerSaveEvent:function(c,a){var b={};b.data={module:app.getModuleName(),action:"SaveAjax",mode:c,params:a};b.async=false;b.dataType="json";AppConnector.request(b).done(function(e){var d=e.result;var f={text:d.message,animation:"show",type:"success"};Vtiger_Helper_Js.showPnotify(f);return d},function(e,d){})},activeColor:function(c){var b=$(c.currentTarget);var a=$("#calendarColorPreview"+b.data("type")+b.data("id"));var d={};d.data={module:app.getModuleName(),action:"SaveAjax",mode:"activeColor",params:{status:b.is(":checked"),color:a.data("color"),id:b.data("id")}};d.async=false;d.dataType="json";AppConnector.request(d).done(function(f){var e=f.result;var g={text:e.message,animation:"show",type:"success"};Vtiger_Helper_Js.showPnotify(g);a.css("background",e.color);a.data("color",e.color)})},registerModuleTabEvent:function(){jQuery("#picklistsColorsTab").on("click",function(b){var c={module:"Users",parent:app.getParentModuleName(),view:"ColorsAjax",mode:"getPickListView"};var a=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(c).then(function(d){jQuery("#PicklistViewContentDiv").html(d);a.progressIndicator({mode:"hide"});app.changeSelectElementView(jQuery(".pickListModulesSelectContainer"));Colors_Js.registerModuleChangeEvent();jQuery("#modulePickList").trigger("change")})})},registerModuleChangeEvent:function(){jQuery("#pickListModules").on("change",function(c){var a=jQuery(c.currentTarget).val();if(a.length<=0){Settings_Vtiger_Index_Js.showMessage({type:"error",text:app.vtranslate("JS_PLEASE_SELECT_MODULE")})}var d={module:"Users",parent:app.getParentModuleName(),source_module:a,view:"ColorsAjax",mode:"getPickListView"};var b=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(d).then(function(e){jQuery("#PicklistViewContentDiv").html(e);b.progressIndicator({mode:"hide"});app.changeSelectElementView(jQuery(".pickListModulesSelectContainer"));app.changeSelectElementView(jQuery(".pickListModulesPicklistSelectContainer"));Colors_Js.registerModuleChangeEvent();Colors_Js.registerModulePickListChangeEvent();jQuery("#modulePickList").trigger("change")})})},registerModulePickListChangeEvent:function(){jQuery("#modulePickList").on("change",function(b){var c={module:"Users",parent:app.getParentModuleName(),source_module:jQuery("#pickListModules").val(),view:"ColorsAjax",mode:"getPickListView",pickListFieldId:jQuery(b.currentTarget).val()};var a=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(c).then(function(d){jQuery("#PicklistViewContentDiv").html(d);app.changeSelectElementView(jQuery(".pickListModulesSelectContainer"));app.changeSelectElementView(jQuery(".pickListModulesPicklistSelectContainer"));Colors_Js.registerModuleChangeEvent();Colors_Js.registerModulePickListChangeEvent();Colors_Js.initEvants();a.progressIndicator({mode:"hide"})})})},registerEvents:function(){Colors_Js.registerModuleTabEvent();Colors_Js.registerModuleChangeEvent();Colors_Js.registerModulePickListChangeEvent();Colors_Js.initEvants()},addPicklistColorColumn:function(b){var a=$(b.currentTarget);var c={};c.data={module:"Picklist",parent:"Settings",action:"SaveAjax",mode:"addPicklistColorColumn",picklistModule:a.data("picklistmodule"),picklistId:a.data("picklistid")};c.async=false;c.dataType="json";AppConnector.request(c).done(function(e){var d=e.result;var f={text:d.message,animation:"show",type:"success"};Vtiger_Helper_Js.showPnotify(f);jQuery("#modulePickList").trigger("change")})},updatePicklistValueColor:function(g){var f=$(g.currentTarget);var a=jQuery(".UserColors .editColorContainer");var b=a.clone(true,true);var d=$("#calendarColorPreviewPicklistValue"+f.data("picklistvalueid"));var c=function(e){e.find(".editColorContainer").removeClass("hide").show();var i=e.find(".selectedColor");i.val(d.data("color"));var h={flat:true,color:d.data("color"),onChange:function(j,l,k){i.val("#"+l);d.data("color","#"+l)}};if(typeof customParams!="undefined"){h=jQuery.extend(h,customParams)}e.find(".calendarColorPicker").ColorPicker(h);e.find('[name="saveButton"]').click(function(l){var j=$.progressIndicator({message:app.vtranslate("Update labels"),blockInfo:{enabled:true}});var k={};k.data={module:"Picklist",parent:"Settings",action:"SaveAjax",mode:"updatePicklistValueColor",color:i.val(),picklistId:f.data("picklistid"),picklistValueId:f.data("picklistvalueid")};k.async=false;k.dataType="json";AppConnector.request(k).done(function(n){var m=n.result;var o={text:m.message,animation:"show",type:"success"};Vtiger_Helper_Js.showPnotify(o);return m},function(n,m){});d.css("background",i.val());f.data("color",i.val());j.progressIndicator({mode:"hide"});app.hideModalWindow()})};app.showModalWindow(b,function(e){if(typeof c=="function"){c(e)}},{width:"1000px"})},generatePicklistValueColor:function(f){var d=$(f.currentTarget);var b=$("#calendarColorPreviewPicklistValue"+d.data("picklistvalueid"));var a=$.progressIndicator({message:app.vtranslate("Update labels"),blockInfo:{enabled:true}});var c={};c.data={module:"Picklist",parent:"Settings",action:"SaveAjax",mode:"updatePicklistValueColor",picklistId:d.data("picklistid"),picklistValueId:d.data("picklistvalueid")};c.async=false;c.dataType="json";AppConnector.request(c).then(function(g){var e=g.result;var h={text:e.message,animation:"show",type:"success"};b.css("background",e.color);b.data("color",e.color);Vtiger_Helper_Js.showPnotify(h)},function(g,e){});a.progressIndicator({mode:"hide"});app.hideModalWindow()}};$(document).ready(function(){Colors_Js.registerEvents()});