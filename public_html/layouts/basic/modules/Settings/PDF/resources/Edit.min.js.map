{"version":3,"file":"Edit.min.js","sources":["Edit.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nSettings_Vtiger_Edit_Js(\"Settings_PDF_Edit_Js\", {\n\tinstance: {}\n\n}, {\n\tcurrentInstance: false,\n\teditContainer: false,\n\tinit: function () {\n\t\tthis.initiate();\n\t},\n\t/**\n\t * Function to get the container which holds all the workflow elements\n\t * @return jQuery object\n\t */\n\tgetContainer: function () {\n\t\treturn this.editContainer;\n\t},\n\t/**\n\t * Function to set the reports container\n\t * @params : element - which represents the workflow container\n\t * @return : current instance\n\t */\n\tsetContainer: function (element) {\n\t\tthis.editContainer = element;\n\t\treturn this;\n\t},\n\t/*\n\t * Function to return the instance based on the step of the Workflow\n\t */\n\tgetInstance: function (step) {\n\t\tif (step in Settings_PDF_Edit_Js.instance) {\n\t\t\treturn Settings_PDF_Edit_Js.instance[step];\n\t\t} else {\n\t\t\tvar moduleClassName = 'Settings_PDF_Edit' + step + '_Js';\n\t\t\tSettings_PDF_Edit_Js.instance[step] = new window[moduleClassName]();\n\t\t\treturn Settings_PDF_Edit_Js.instance[step]\n\t\t}\n\t},\n\t/*\n\t * Function to get the value of the step\n\t * returns 1 or 2 or 3\n\t */\n\tgetStepValue: function () {\n\t\tvar container = this.currentInstance.getContainer();\n\t\treturn jQuery('.step', container).val();\n\t},\n\t/*\n\t * Function to initiate the step 1 instance\n\t */\n\tinitiate: function (container) {\n\t\tif (typeof container === \"undefined\") {\n\t\t\tcontainer = jQuery('.pdfTemplateContents');\n\t\t}\n\t\tif (container.is('.pdfTemplateContents')) {\n\t\t\tthis.setContainer(container);\n\t\t} else {\n\t\t\tthis.setContainer(jQuery('.pdfTemplateContents', container));\n\t\t}\n\t\tthis.initiateStep('1');\n\t\tthis.currentInstance.registerEvents();\n\t},\n\t/*\n\t * Function to initiate all the operations for a step\n\t * @params step value\n\t */\n\tinitiateStep: function (stepVal) {\n\t\tvar step = 'step' + stepVal;\n\t\tthis.activateHeader(step);\n\t\tthis.currentInstance = this.getInstance(stepVal);\n\t},\n\t/*\n\t * Function to activate the header based on the class\n\t * @params class name\n\t */\n\tactivateHeader: function (step) {\n\t\tvar headersContainer = jQuery('.crumbs ');\n\t\theadersContainer.find('.active').removeClass('active');\n\t\tjQuery('#' + step, headersContainer).addClass('active');\n\t},\n\t/*\n\t * Function to register the click event for next button\n\t */\n\tregisterFormSubmitEvent: function (form) {\n\t\tvar thisInstance = this;\n\t\tif (jQuery.isFunction(thisInstance.currentInstance.submit)) {\n\t\t\tform.on('submit', function (e) {\n\t\t\t\tvar form = jQuery(e.currentTarget);\n\t\t\t\tvar specialValidation = true;\n\t\t\t\tif (jQuery.isFunction(thisInstance.currentInstance.isFormValidate)) {\n\t\t\t\t\tspecialValidation = thisInstance.currentInstance.isFormValidate();\n\t\t\t\t}\n\t\t\t\tif (form.validationEngine('validate') && specialValidation) {\n\t\t\t\t\tthisInstance.currentInstance.submit().done(function (data) {\n\t\t\t\t\t\tthisInstance.getContainer().prepend(data);\n\t\t\t\t\t\tvar stepVal = thisInstance.getStepValue();\n\t\t\t\t\t\tvar nextStepVal = parseInt(stepVal) + 1;\n\t\t\t\t\t\tthisInstance.initiateStep(nextStepVal);\n\t\t\t\t\t\tthisInstance.currentInstance.initialize();\n\t\t\t\t\t\tvar container = thisInstance.currentInstance.getContainer();\n\t\t\t\t\t\tthisInstance.registerFormSubmitEvent(container);\n\t\t\t\t\t\tthisInstance.currentInstance.registerEvents();\n\t\t\t\t\t\tthisInstance.registerEditors(container);\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t\te.preventDefault();\n\t\t\t})\n\t\t}\n\t},\n\tback: function () {\n\t\tvar step = this.getStepValue();\n\t\tvar prevStep = parseInt(step) - 1;\n\t\tthis.currentInstance.initialize();\n\t\tvar container = this.currentInstance.getContainer();\n\t\tvar pdfRecordElement = jQuery('[name=\"record\"]', container);\n\t\tvar pdfId = pdfRecordElement.val();\n\t\tcontainer.remove();\n\t\tthis.initiateStep(prevStep);\n\t\tvar currentContainer = this.currentInstance.getContainer();\n\t\tcurrentContainer.show();\n\t\tjQuery('[name=\"record\"]', currentContainer).val(pdfId);\n\t},\n\tregisterCancelStepClickEvent: function (form) {\n\t\tjQuery('button.cancelLink', form).on('click', function () {\n\t\t\twindow.history.back();\n\t\t});\n\t},\n\t/*\n\t * Function to register the click event for back step\n\t */\n\tregisterBackStepClickEvent: function () {\n\t\tvar thisInstance = this;\n\t\tvar container = this.getContainer();\n\t\tcontainer.on('click', '.backStep', function (e) {\n\t\t\tthisInstance.back();\n\t\t});\n\t},\n\tregisterMetatagsClickEvent: function (form) {\n\t\tvar metaTagsStatus = form.find('#metatags_status');\n\t\tif (!metaTagsStatus.is(':checked')) {\n\t\t\tform.find('.metatags').addClass('d-none');\n\t\t} else {\n\t\t\tform.find('.metatags').removeClass('d-none');\n\t\t}\n\n\t\tmetaTagsStatus.on('change', function () {\n\t\t\tconst status = $(this).is(':checked');\n\t\t\tif (!status) {\n\t\t\t\t$('.metatags', form).addClass('d-none');\n\t\t\t} else {\n\t\t\t\t$('#set_subject', form).val($('#secondary_name', form).val());\n\t\t\t\t$('#set_title', form).val($('#primary_name', form).val());\n\t\t\t\t$('.metatags', form).removeClass('d-none');\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Register wysiwyg editors\n\t * @param {jQuery} container\n\t * @param {array} fonts\n\t */\n\tregisterEditors(container, fonts = ['DejaVu Sans']) {\n\t\tcontainer.find('.js-editor').each(function () {\n\t\t\tconst editor = $(this);\n\t\t\tif (typeof CONFIG.fonts !== 'undefined' && fonts.length === 1) {\n\t\t\t\tfonts = CONFIG.fonts.map(font => font);\n\t\t\t\tfonts.unshift('DejaVu Sans');\n\t\t\t}\n\t\t\tnew App.Fields.Text.Editor(editor, {\n\t\t\t\tentities_latin: false,\n\t\t\t\ttoolbar: 'PDF',\n\t\t\t\tfont_defaultLabel: 'DejaVu Sans',\n\t\t\t\tfontSize_defaultLabel: '10px',\n\t\t\t\tfont_names: fonts.join(';'),\n\t\t\t\tcontentsCss: CONFIG.siteUrl + 'layouts/resources/fonts/fonts.css',\n\t\t\t\theight: editor.attr('id') === 'body_content' ? '800px' : '80px',\n\t\t\t\tstylesSet: [{\n\t\t\t\t\tname: 'Komorka 14',\n\t\t\t\t\telement: 'td',\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\tstyle: 'font-size:14px'\n\t\t\t\t\t}\n\t\t\t\t}],\n\t\t\t\ttoolbar_PDF: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'clipboard',\n\t\t\t\t\t\titems: ['Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo']\n\t\t\t\t\t},\n\t\t\t\t\t{name: 'editing', items: ['Find', 'Replace', '-', 'SelectAll', '-', 'Scayt']},\n\t\t\t\t\t{name: 'links', items: ['Link', 'Unlink']},\n\t\t\t\t\t{name: 'insert', items: ['Image', 'Table', 'HorizontalRule']},\n\t\t\t\t\t{name: 'tools', items: ['Maximize', 'ShowBlocks']},\n\t\t\t\t\t{name: 'document', items: ['Source']},\n\t\t\t\t\t'/',\n\t\t\t\t\t{name: 'styles', items: ['Styles', 'Format', 'Font', 'FontSize']},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'basicstyles',\n\t\t\t\t\t\titems: ['Bold', 'Italic', 'Underline', 'Strike']\n\t\t\t\t\t},\n\t\t\t\t\t{name: 'colors', items: ['TextColor', 'BGColor']},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'paragraph',\n\t\t\t\t\t\titems: ['JustifyLeft', 'JustifyCenter', 'JustifyRight']\n\t\t\t\t\t},\n\t\t\t\t\t{name: 'basicstyles', items: ['CopyFormatting', 'RemoveFormat']},\n\t\t\t\t],\n\t\t\t\tallowedContent: {\n\t\t\t\t\t'$1': {\n\t\t\t\t\t\telements: CKEDITOR.dtd,\n\t\t\t\t\t\tattributes: true,\n\t\t\t\t\t\tclasses: true,\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\t'display': true,\n\t\t\t\t\t\t\t'color': true,\n\t\t\t\t\t\t\t'background-color': true,\n\t\t\t\t\t\t\t'background-image': true,\n\t\t\t\t\t\t\t'font-size': true,\n\t\t\t\t\t\t\t'font-weight': true,\n\t\t\t\t\t\t\t'font-family': true,\n\t\t\t\t\t\t\t'text-align': true,\n\t\t\t\t\t\t\t'text-transform': true,\n\t\t\t\t\t\t\t'width': true,\n\t\t\t\t\t\t\t'height': true,\n\t\t\t\t\t\t\t'border': true,\n\t\t\t\t\t\t\t'border-collapse': true,\n\t\t\t\t\t\t\t'cell-spacing': true,\n\t\t\t\t\t\t\t'vertical-align': true,\n\t\t\t\t\t\t\t'margin-top': true,\n\t\t\t\t\t\t\t'margin-bottom': true,\n\t\t\t\t\t\t\t'margin-left': true,\n\t\t\t\t\t\t\t'margin-right': true,\n\t\t\t\t\t\t\t'padding-top': true,\n\t\t\t\t\t\t\t'padding-bottom': true,\n\t\t\t\t\t\t\t'padding-left': true,\n\t\t\t\t\t\t\t'padding-right': true,\n\t\t\t\t\t\t\t'margin': true,\n\t\t\t\t\t\t\t'padding': true,\n\t\t\t\t\t\t\t'border-color': true,\n\t\t\t\t\t\t\t'border-width': true,\n\t\t\t\t\t\t\t'border-style': true,\n\t\t\t\t\t\t\t'border-top-color': true,\n\t\t\t\t\t\t\t'border-top-width': true,\n\t\t\t\t\t\t\t'border-top-style': true,\n\t\t\t\t\t\t\t'border-right-color': true,\n\t\t\t\t\t\t\t'border-right-width': true,\n\t\t\t\t\t\t\t'border-right-style': true,\n\t\t\t\t\t\t\t'border-bottom-color': true,\n\t\t\t\t\t\t\t'border-bottom-width': true,\n\t\t\t\t\t\t\t'border-bottom-style': true,\n\t\t\t\t\t\t\t'border-left-color': true,\n\t\t\t\t\t\t\t'border-left-width': true,\n\t\t\t\t\t\t\t'border-left-style': true,\n\t\t\t\t\t\t\t'line-height': true,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\t/**\n\t * Register wysiwyg editors with fonts\n\t * @param form\n\t */\n\tregisterEditorsWithFonts(form) {\n\t\t$.ajax({\n\t\t\turl: CONFIG.siteUrl + 'layouts/resources/fonts/fonts.json',\n\t\t\tmethod: 'GET',\n\t\t\tdataType: 'json'\n\t\t}).done((response) => {\n\t\t\tif (response.length === 0) {\n\t\t\t\treturn this.registerEditors(form);\n\t\t\t}\n\t\t\tconst fonts = response.map(font => font.family).filter((val, index, self) => self.indexOf(val) === index);\n\t\t\tCONFIG.fonts = fonts;\n\t\t\tthis.registerEditors(form, fonts);\n\t\t}).fail(() => {\n\t\t\tthis.registerEditors(form);\n\t\t\tapp.errorLog(\"Could not load fonts.\");\n\t\t});\n\t},\n\t/**\n\t * Register events\n\t */\n\tregisterEvents() {\n\t\tconst form = this.currentInstance.getContainer();\n\t\tthis.registerFormSubmitEvent(form);\n\t\tthis.registerBackStepClickEvent();\n\t\tthis.registerCancelStepClickEvent(form);\n\t\tthis.registerMetatagsClickEvent(form);\n\t\tthis.registerEditorsWithFonts(form);\n\t}\n});\n"],"names":["Settings_Vtiger_Edit_Js","initiate","this","editContainer","element","step","Settings_PDF_Edit_Js","instance","moduleClassName","window","container","currentInstance","getContainer","jQuery","val","is","setContainer","initiateStep","registerEvents","stepVal","activateHeader","getInstance","headersContainer","find","removeClass","addClass","form","thisInstance","isFunction","submit","on","e","currentTarget","specialValidation","isFormValidate","validationEngine","done","data","prepend","getStepValue","nextStepVal","parseInt","initialize","registerFormSubmitEvent","registerEditors","preventDefault","prevStep","pdfId","remove","currentContainer","show","history","back","metaTagsStatus","$","fonts","each","editor","CONFIG","length","map","font","unshift","App","Fields","Text","Editor","join","siteUrl","attr","name","items","CKEDITOR","dtd","ajax","response","_this","family","filter","index","self","indexOf","fail","errorLog","registerBackStepClickEvent","registerCancelStepClickEvent","registerMetatagsClickEvent","registerEditorsWithFonts"],"mappings":"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cAAe,gBAAiB,iBAEzC,CAACD,KAAM,cAAeC,MAAO,CAAC,iBAAkB,iCAEjC,IACT,UACKC,SAASC,gBACP,WACH,SACD,UACI,SACF,sBACW,sBACA,eACP,iBACE,iBACA,gBACD,oBACI,SACT,UACC,UACA,qBACS,kBACH,oBACE,gBACJ,mBACG,iBACF,kBACC,iBACD,oBACG,kBACF,mBACC,UACP,WACC,kBACK,kBACA,kBACA,sBACI,sBACA,sBACA,wBACE,wBACA,wBACA,yBACC,yBACA,yBACA,uBACF,uBACA,uBACA,iBACN,6CAWI/C,uBACtBgD,KAAK,KACDhB,OAAOU,QAAU,4CACd,eACE,SACRhC,MAAK,SAACuC,aACgB,IAApBA,SAAShB,cACLiB,MAAKhC,gBAAgBlB,UAEvB6B,MAAQoB,SAASf,KAAI,sBAAQC,KAAKgB,UAAQC,QAAO,SAAChE,IAAKiE,MAAOC,aAASA,KAAKC,QAAQnE,OAASiE,gBAC5FxB,MAAQA,YACVX,gBAAgBlB,KAAM6B,UACzB2B,MAAK,iBACFtC,gBAAgBlB,UACjByD,SAAS,2DAORzD,KAAOxB,KAAKS,gBAAgBC,oBAC7B+B,wBAAwBjB,WACxB0D,kCACAC,6BAA6B3D,WAC7B4D,2BAA2B5D,WAC3B6D,yBAAyB7D"}