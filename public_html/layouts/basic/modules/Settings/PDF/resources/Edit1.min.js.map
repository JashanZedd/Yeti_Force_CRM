{"version":3,"file":"Edit1.min.js","sources":["Edit1.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nSettings_PDF_Edit_Js(\"Settings_PDF_Edit1_Js\", {}, {\n\tinit: function () {\n\t\tthis.initialize();\n\t},\n\t/**\n\t * Function to get the container which holds all the reports step1 elements\n\t * @return jQuery object\n\t */\n\tgetContainer: function () {\n\t\treturn this.step1Container;\n\t},\n\t/**\n\t * Function to set the reports step1 container\n\t * @params : element - which represents the reports step1 container\n\t * @return : current instance\n\t */\n\tsetContainer: function (element) {\n\t\tthis.step1Container = element;\n\t\treturn this;\n\t},\n\t/**\n\t * Function  to intialize the reports step1\n\t */\n\tinitialize: function (container) {\n\t\tif (typeof container === \"undefined\") {\n\t\t\tcontainer = jQuery('#pdf_step1');\n\t\t}\n\t\tif (container.is('#pdf_step1')) {\n\t\t\tthis.setContainer(container);\n\t\t} else {\n\t\t\tthis.setContainer(jQuery('#pdf_step1'));\n\t\t}\n\t},\n\t/**\n\t * Submit step 1\n\t * @returns {Promise}\n\t */\n\tsubmit() {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar form = this.getContainer();\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tconst formData = new FormData();\n\t\tconst saveData = form.serializeFormData();\n\t\tformData.append('action', 'Save');\n\t\tformData.append('step', 1);\n\t\tformData.append('template_id', form.find('[name=\"record\"]').val());\n\t\tsaveData['async'] = false;\n\t\tif (typeof saveData['metatags_status'] === 'undefined') {\n\t\t\tsaveData['metatags_status'] = 0;\n\t\t}\n\t\tfor (let key in saveData) {\n\t\t\tformData.append(key, saveData[key]);\n\t\t}\n\t\tconst fileSelect = form.find('#watermark_image');\n\t\tif (typeof fileSelect[0].files[0] !== 'undefined') {\n\t\t\tconst file = fileSelect[0].files[0];\n\t\t\tif (file.type.match('image.*')) {\n\t\t\t\tformData.append('watermark_image_file', file, file.name);\n\t\t\t}\n\t\t}\n\t\tAppConnector.request({\n\t\t\tmethod: 'POST',\n\t\t\tdata: formData,\n\t\t\tprocessData: false,\n\t\t\tcontentType: false,\n\t\t}).done(function (data) {\n\t\t\tif (data.success === true) {\n\t\t\t\tSettings_Vtiger_Index_Js.showMessage({text: app.vtranslate('JS_PDF_SAVED_SUCCESSFULLY')});\n\t\t\t\tvar pdfRecordElement = jQuery('[name=\"record\"]', form);\n\t\t\t\tif (pdfRecordElement.val() === '') {\n\t\t\t\t\tpdfRecordElement.val(data.result.id);\n\t\t\t\t\tsaveData['record'] = data.result.id;\n\t\t\t\t}\n\t\t\t\tsaveData['record'] = data.result.id;\n\t\t\t\tAppConnector.request(saveData).done(function (data) {\n\t\t\t\t\tform.hide();\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({\n\t\t\t\t\t\t'mode': 'hide'\n\t\t\t\t\t});\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t}).fail(function (error, err) {\n\t\t\t\t\tapp.errorLog(error, err);\n\t\t\t\t});\n\t\t\t}\n\t\t}).fail(function (error, err) {\n\t\t\tapp.errorLog(error, err);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\tregisterCancelStepClickEvent: function (form) {\n\t\tjQuery('button.cancelLink', form).on('click', function () {\n\t\t\twindow.history.back();\n\t\t});\n\t},\n\tregisterMarginCheckboxClickEvent: function (container) {\n\t\tcontainer.find('#margin_chkbox').on('change', function () {\n\t\t\tvar status = jQuery(this).is(':checked');\n\n\t\t\tif (status) {\n\t\t\t\tcontainer.find('.margin_inputs').addClass('d-none');\n\t\t\t} else {\n\t\t\t\tcontainer.find('.margin_inputs').removeClass('d-none');\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Register module change event - load proper variable panel for specified module\n\t * @param {jQuery} container\n\t */\n\tregisterModuleChangeEvent(container) {\n\t\tcontainer.find('[name=\"module_name\"]').on('change', function () {\n\t\t\tconst progressIndicator = jQuery.progressIndicator({\n\t\t\t\t'position': 'html',\n\t\t\t\t'blockInfo': {'enabled': true}\n\t\t\t});\n\t\t\tAppConnector.request({\n\t\t\t\tmodule: 'PDF',\n\t\t\t\tparent: 'Settings',\n\t\t\t\tview: 'VariablePanel',\n\t\t\t\trecord: container.find('[name=\"record\"]').val(),\n\t\t\t\ttype: 'pdf',\n\t\t\t\tselectedModule: $(this).val()\n\t\t\t}).done((response) => {\n\t\t\t\tcontainer.find('.js-variable-panel').html(response);\n\t\t\t\tApp.Tools.VariablesPanel.registerRefreshCompanyVariables(container);\n\t\t\t\tApp.Fields.Text.registerCopyClipboard(container);\n\t\t\t\tprogressIndicator.progressIndicator({'mode': 'hide'});\n\t\t\t}).fail((error, err) => {\n\t\t\t\tprogressIndicator.progressIndicator({'mode': 'hide'});\n\t\t\t\tapp.errorLog(error, err);\n\t\t\t});\n\t\t});\n\t},\n\tregisterWatermarkTypeChange: function (container) {\n\t\tvar watermarkType = container.find('#watermark_type');\n\n\t\twatermarkType.on('change', function () {\n\t\t\tcontainer.find('.watertext').toggleClass('d-none')\n\t\t\tcontainer.find('.waterimage').toggleClass('d-none')\n\t\t});\n\t},\n\tregisterDeleteUploadButton: function (form) {\n\t\tform.find('#deleteWM').on('click', function (e) {\n\t\t\te.preventDefault();\n\t\t\tvar params = {};\n\t\t\tparams.data = {\n\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'Watermark',\n\t\t\t\tmode: 'delete',\n\t\t\t\tid: form.find('[name=\"record\"]').val()\n\t\t\t};\n\t\t\tparams.dataType = 'json';\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\tvar response = data['result'];\n\t\t\t\tif (response) {\n\t\t\t\t\tform.find('#watermark').html('');\n\t\t\t\t\tform.find('[name=\"watermark_image\"]').val('');\n\t\t\t\t\tform.find('#deleteWM').addClass('d-none');\n\t\t\t\t}\n\t\t\t}).fail(function (data, err) {\n\t\t\t\tapp.errorLog(data, err);\n\t\t\t});\n\t\t});\n\t},\n\t/**\n\t * Register events\n\t */\n\tregisterEvents() {\n\t\tconst container = this.getContainer();\n\t\t//After loading 1st step only, we will enable the Next button\n\t\tcontainer.find('[type=\"submit\"]').removeAttr('disabled');\n\t\tconst opts = app.validationEngineOptions;\n\t\t// to prevent the page reload after the validation has completed\n\t\topts['onValidationComplete'] = function (form, valid) {\n\t\t\t//returns the valid status\n\t\t\treturn valid;\n\t\t};\n\t\topts['promptPosition'] = \"bottomRight\";\n\t\tcontainer.validationEngine(opts);\n\t\tthis.registerCancelStepClickEvent(container);\n\t\tthis.registerMarginCheckboxClickEvent(container);\n\t\tthis.registerModuleChangeEvent(container);\n\t\tthis.registerWatermarkTypeChange(container);\n\t\tthis.registerDeleteUploadButton(container);\n\t\tApp.Tools.VariablesPanel.registerRefreshCompanyVariables(container);\n\t\tApp.Fields.Text.registerCopyClipboard(container);\n\t\tApp.Tools.VariablesPanel.refreshCompanyVariables(container);\n\t}\n});\n"],"names":["Settings_PDF_Edit_Js","initialize","this","step1Container","element","container","jQuery","is","setContainer","aDeferred","Deferred","form","getContainer","progressIndicatorElement","progressIndicator","formData","FormData","saveData","serializeFormData","key","append","find","val","fileSelect","files","file","type","match","name","request","done","data","success","showMessage","text","app","vtranslate","pdfRecordElement","result","id","hide","resolve","fail","error","err","errorLog","promise","on","history","back","addClass","removeClass","enabled","$","response","html","Tools","VariablesPanel","registerRefreshCompanyVariables","Fields","Text","registerCopyClipboard","mode","toggleClass","e","preventDefault","params","getParentModuleName","getModuleName","dataType","removeAttr","opts","validationEngineOptions","valid","validationEngine","registerCancelStepClickEvent","registerMarginCheckboxClickEvent","registerModuleChangeEvent","registerWatermarkTypeChange","registerDeleteUploadButton","refreshCompanyVariables"],"mappings":"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"}