{"version":3,"file":"Edit1.min.js","sources":["Edit1.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nSettings_PDF_Edit_Js(\"Settings_PDF_Edit1_Js\", {}, {\n\tinit: function () {\n\t\tthis.initialize();\n\t},\n\t/**\n\t * Function to get the container which holds all the reports step1 elements\n\t * @return jQuery object\n\t */\n\tgetContainer: function () {\n\t\treturn this.step1Container;\n\t},\n\t/**\n\t * Function to set the reports step1 container\n\t * @params : element - which represents the reports step1 container\n\t * @return : current instance\n\t */\n\tsetContainer: function (element) {\n\t\tthis.step1Container = element;\n\t\treturn this;\n\t},\n\t/**\n\t * Function  to intialize the reports step1\n\t */\n\tinitialize: function (container) {\n\t\tif (typeof container === \"undefined\") {\n\t\t\tcontainer = jQuery('#pdf_step1');\n\t\t}\n\t\tif (container.is('#pdf_step1')) {\n\t\t\tthis.setContainer(container);\n\t\t} else {\n\t\t\tthis.setContainer(jQuery('#pdf_step1'));\n\t\t}\n\t},\n\t/**\n\t * Submit step 1\n\t * @returns {Promise}\n\t */\n\tsubmit() {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar form = this.getContainer();\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tconst formData = new FormData();\n\t\tconst saveData = form.serializeFormData();\n\t\tformData.append('action', 'Save');\n\t\tformData.append('step', 1);\n\t\tformData.append('template_id', form.find('[name=\"record\"]').val());\n\t\tsaveData['async'] = false;\n\t\tif (typeof saveData['metatags_status'] === 'undefined') {\n\t\t\tsaveData['metatags_status'] = 0;\n\t\t}\n\t\tfor (let key in saveData) {\n\t\t\tformData.append(key, saveData[key]);\n\t\t}\n\t\tconst fileSelect = form.find('#watermark_image');\n\t\tif (typeof fileSelect[0].files[0] !== 'undefined') {\n\t\t\tconst file = fileSelect[0].files[0];\n\t\t\tif (file.type.match('image.*')) {\n\t\t\t\tformData.append('watermark_image_file', file, file.name);\n\t\t\t}\n\t\t}\n\t\tAppConnector.request({\n\t\t\tmethod: 'POST',\n\t\t\tdata: formData,\n\t\t\tprocessData: false,\n\t\t\tcontentType: false,\n\t\t}).done(function (data) {\n\t\t\tif (data.success === true) {\n\t\t\t\tSettings_Vtiger_Index_Js.showMessage({text: app.vtranslate('JS_PDF_SAVED_SUCCESSFULLY')});\n\t\t\t\tvar pdfRecordElement = jQuery('[name=\"record\"]', form);\n\t\t\t\tif (pdfRecordElement.val() === '') {\n\t\t\t\t\tpdfRecordElement.val(data.result.id);\n\t\t\t\t\tsaveData['record'] = data.result.id;\n\t\t\t\t}\n\t\t\t\tsaveData['record'] = data.result.id;\n\t\t\t\tAppConnector.request(saveData).done(function (data) {\n\t\t\t\t\tform.hide();\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({\n\t\t\t\t\t\t'mode': 'hide'\n\t\t\t\t\t});\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t}).fail(function (error, err) {\n\t\t\t\t\tapp.errorLog(error, err);\n\t\t\t\t});\n\t\t\t}\n\t\t}).fail(function (error, err) {\n\t\t\tapp.errorLog(error, err);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\tregisterCancelStepClickEvent: function (form) {\n\t\tjQuery('button.cancelLink', form).on('click', function () {\n\t\t\twindow.history.back();\n\t\t});\n\t},\n\tregisterMarginCheckboxClickEvent: function (container) {\n\t\tcontainer.find('#margin_chkbox').on('change', function () {\n\t\t\tvar status = jQuery(this).is(':checked');\n\n\t\t\tif (status) {\n\t\t\t\tcontainer.find('.margin_inputs').addClass('d-none');\n\t\t\t} else {\n\t\t\t\tcontainer.find('.margin_inputs').removeClass('d-none');\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Register module change event - load proper variable panel for specified module\n\t * @param {jQuery} container\n\t */\n\tregisterModuleChangeEvent(container) {\n\t\tcontainer.find('[name=\"module_name\"]').on('change', function () {\n\t\t\tconst progressIndicator = jQuery.progressIndicator({\n\t\t\t\t'position': 'html',\n\t\t\t\t'blockInfo': {'enabled': true}\n\t\t\t});\n\t\t\tAppConnector.request({\n\t\t\t\tmodule: 'PDF',\n\t\t\t\tparent: 'Settings',\n\t\t\t\tview: 'VariablePanel',\n\t\t\t\trecord: container.find('[name=\"record\"]').val(),\n\t\t\t\ttype: 'pdf',\n\t\t\t\tselectedModule: $(this).val()\n\t\t\t}).done((response) => {\n\t\t\t\tcontainer.find('.js-variable-panel').html(response);\n\t\t\t\tApp.Tools.VariablesPanel.registerRefreshCompanyVariables(container);\n\t\t\t\tApp.Fields.Text.registerCopyClipboard(container);\n\t\t\t\tprogressIndicator.progressIndicator({'mode': 'hide'});\n\t\t\t}).fail((error, err) => {\n\t\t\t\tprogressIndicator.progressIndicator({'mode': 'hide'});\n\t\t\t\tapp.errorLog(error, err);\n\t\t\t});\n\t\t});\n\t},\n\tregisterWatermarkTypeChange: function (container) {\n\t\tvar watermarkType = container.find('#watermark_type');\n\n\t\twatermarkType.on('change', function () {\n\t\t\tcontainer.find('.watertext').toggleClass('d-none')\n\t\t\tcontainer.find('.waterimage').toggleClass('d-none')\n\t\t});\n\t},\n\tregisterDeleteUploadButton: function (form) {\n\t\tform.find('#deleteWM').on('click', function (e) {\n\t\t\te.preventDefault();\n\t\t\tvar params = {};\n\t\t\tparams.data = {\n\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'Watermark',\n\t\t\t\tmode: 'delete',\n\t\t\t\tid: form.find('[name=\"record\"]').val()\n\t\t\t};\n\t\t\tparams.dataType = 'json';\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\tvar response = data['result'];\n\t\t\t\tif (response) {\n\t\t\t\t\tform.find('#watermark').html('');\n\t\t\t\t\tform.find('[name=\"watermark_image\"]').val('');\n\t\t\t\t\tform.find('#deleteWM').addClass('d-none');\n\t\t\t\t}\n\t\t\t}).fail(function (data, err) {\n\t\t\t\tapp.errorLog(data, err);\n\t\t\t});\n\t\t});\n\t},\n\t/**\n\t * Register events\n\t */\n\tregisterEvents() {\n\t\tconst container = this.getContainer();\n\t\t//After loading 1st step only, we will enable the Next button\n\t\tcontainer.find('[type=\"submit\"]').removeAttr('disabled');\n\t\tconst opts = app.validationEngineOptions;\n\t\t// to prevent the page reload after the validation has completed\n\t\topts['onValidationComplete'] = function (form, valid) {\n\t\t\t//returns the valid status\n\t\t\treturn valid;\n\t\t};\n\t\topts['promptPosition'] = \"bottomRight\";\n\t\tcontainer.validationEngine(opts);\n\t\tthis.registerCancelStepClickEvent(container);\n\t\tthis.registerMarginCheckboxClickEvent(container);\n\t\tthis.registerModuleChangeEvent(container);\n\t\tthis.registerWatermarkTypeChange(container);\n\t\tthis.registerDeleteUploadButton(container);\n\t\tApp.Tools.VariablesPanel.registerRefreshCompanyVariables(container);\n\t\tApp.Fields.Text.registerCopyClipboard(container);\n\t\tApp.Tools.VariablesPanel.refreshCompanyVariables(container);\n\t}\n});\n"],"names":["Settings_PDF_Edit_Js","initialize","step1Container","element","container","jQuery","is","setContainer","aDeferred","Deferred","form","getContainer","progressIndicatorElement","progressIndicator","formData","FormData","saveData","serializeFormData","append","find","val","key","fileSelect","files","file","type","match","name","request","done","data","success","showMessage","text","app","vtranslate","pdfRecordElement","result","id","hide","resolve","fail","error","err","errorLog","promise","on","history","back","status","addClass","removeClass","$","response","html","Tools","VariablesPanel","registerRefreshCompanyVariables","Fields","Text","registerCopyClipboard","watermarkType","toggleClass","e","preventDefault","params","getParentModuleName","getModuleName","dataType","removeAttr","opts","validationEngineOptions","valid","validationEngine","registerCancelStepClickEvent","registerMarginCheckboxClickEvent","registerModuleChangeEvent","registerWatermarkTypeChange","registerDeleteUploadButton","refreshCompanyVariables"],"mappings":"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"}