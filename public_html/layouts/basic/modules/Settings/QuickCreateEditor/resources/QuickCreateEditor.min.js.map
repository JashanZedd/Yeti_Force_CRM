{"version":3,"file":"QuickCreateEditor.min.js","sources":["QuickCreateEditor.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class('Settings_QuickCreateEditor_Js', {}, {\n\tupdatedBlockSequence: {},\n\n\tupdatedBlockFieldsList: [],\n\n\t/**\n\t * Function which will enable the save button in realted tabs list\n\t */\n\tshowSaveButton: function () {\n\t\tvar relatedList = jQuery('#relatedTabOrder');\n\t\tvar saveButton = relatedList.find('.saveRelatedList');\n\t\tif (saveButton.attr('disabled') == 'disabled') {\n\t\t\tsaveButton.removeAttr('disabled');\n\t\t}\n\t},\n\n\t/**\n\t * Function to regiser the event to make the fields sortable\n\t */\n\tmakeFieldsListSortable: function () {\n\t\tvar thisInstance = this;\n\t\tvar contents = jQuery('#quickCreateEditorContainer').find('.contents');\n\t\tjQuery('#quickCreateEditorContainer .contents .editFieldsTable').each(function () {\n\t\t\tjQuery(this).find('ul[name=sortable1], ul[name=sortable2]').sortable({\n\t\t\t\t'containment': '#moduleBlocks',\n\t\t\t\t'revert': true,\n\t\t\t\t'tolerance': 'pointer',\n\t\t\t\t'cursor': 'move',\n\t\t\t\t'connectWith': jQuery(this).find('.connectedSortable'),\n\t\t\t\t'update': function (e, ui) {\n\t\t\t\t\tthisInstance.showSaveFieldSequenceButton();\n\t\t\t\t\t// rearrange the older block fields\n\t\t\t\t\tif (ui.sender) {\n\t\t\t\t\t\tvar olderBlock = ui.sender.closest('.editFieldsTable');\n\t\t\t\t\t\tthisInstance.reArrangeBlockFields(olderBlock);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Function to show the save button of fieldSequence\n\t */\n\tshowSaveFieldSequenceButton: function () {\n\t\tvar thisInstance = this;\n\t\tvar layout = jQuery('#detailViewLayout');\n\t\tvar saveButton = layout.find('.saveFieldSequence');\n\t\tthisInstance.updatedBlockFieldsList = [];\n\t\tsaveButton.removeClass('visibility');\n\t},\n\n\t/**\n\t * Function which will hide the saveFieldSequence button\n\t */\n\thideSaveFieldSequenceButton: function () {\n\t\tvar layout = jQuery('#detailViewLayout');\n\t\tvar saveButton = layout.find('.saveFieldSequence');\n\t\tsaveButton.addClass('visibility');\n\t},\n\n\t/**\n\t * Function that rearranges fields in the block when the fields are moved\n\t * @param <jQuery object> block\n\t */\n\treArrangeBlockFields: function (block) {\n\t\t// 1.get the containers, 2.compare the length, 3.if uneven then move the last element\n\t\tvar leftSideContainer = block.find('ul[name=sortable1]');\n\t\tvar rightSideContainer = block.find('ul[name=sortable2]');\n\t\tif (leftSideContainer.children().length < rightSideContainer.children().length) {\n\t\t\tvar lastElementInRightContainer = rightSideContainer.children(':last');\n\t\t\tleftSideContainer.append(lastElementInRightContainer);\n\t\t} else if (leftSideContainer.children().length > rightSideContainer.children().length + 1) {\t//greater than 1\n\t\t\tvar lastElementInLeftContainer = leftSideContainer.children(':last');\n\t\t\trightSideContainer.append(lastElementInLeftContainer);\n\t\t}\n\t},\n\t/**\n\t * Function to create the list of updated blocks with all the fields and their sequences\n\t */\n\tcreateUpdatedBlockFieldsList: function () {\n\t\tvar thisInstance = this;\n\t\tvar contents = jQuery('#quickCreateEditorContainer').find('.contents');\n\n\t\tvar updatedBlock = contents.find('.block');\n\t\tvar firstBlockSortFields = updatedBlock.find('ul[name=sortable1]');\n\t\tvar tmpArray = []\n\t\tfirstBlockSortFields.each(function (i, domElement) {\n\t\t\tvar fieldEle = jQuery(domElement);\n\t\t\tvar eleAmount = fieldEle.find('.editFields').length;\n\t\t\ttmpArray.push(eleAmount)\n\t\t});\n\t\tvar editFields = firstBlockSortFields.find('.editFields');\n\t\tvar expectedFieldSequence = 1;\n\t\teditFields.each(function (i, domElement) {\n\t\t\tvar fieldEle = jQuery(domElement);\n\t\t\tvar fieldId = fieldEle.data('fieldId');\n\t\t\tthisInstance.updatedBlockFieldsList.push({'fieldid': fieldId, 'sequence': expectedFieldSequence});\n\t\t\texpectedFieldSequence = expectedFieldSequence + 2;\n\t\t\tif (i == tmpArray[0] - 1) {\n\t\t\t\texpectedFieldSequence = 1;\n\t\t\t}\n\t\t});\n\t\tvar secondBlockSortFields = updatedBlock.find('ul[name=sortable2]');\n\t\tvar secondEditFields = secondBlockSortFields.find('.editFields');\n\t\tvar sequenceValue = 2;\n\t\ttmpArray = []\n\t\tsecondBlockSortFields.each(function (i, domElement) {\n\t\t\tvar fieldEle = jQuery(domElement);\n\t\t\tvar eleAmount = fieldEle.find('.editFields').length;\n\t\t\ttmpArray.push(eleAmount)\n\t\t});\n\t\tsecondEditFields.each(function (i, domElement) {\n\t\t\tvar fieldEle = jQuery(domElement);\n\t\t\tvar fieldId = fieldEle.data('fieldId');\n\t\t\tthisInstance.updatedBlockFieldsList.push({'fieldid': fieldId, 'sequence': sequenceValue});\n\t\t\tsequenceValue = sequenceValue + 2;\n\t\t\tif (i == tmpArray[0] - 1) {\n\t\t\t\tsequenceValue = 2;\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Function to register click event for save button of fields sequence\n\t */\n\tregisterFieldSequenceSaveClick: function () {\n\t\tvar thisInstance = this;\n\t\tvar layout = jQuery('#detailViewLayout');\n\t\tlayout.on('click', '.saveFieldSequence', function () {\n\t\t\tthisInstance.hideSaveFieldSequenceButton();\n\t\t\tthisInstance.createUpdatedBlockFieldsList();\n\t\t\tthisInstance.updateFieldSequence();\n\t\t});\n\t},\n\n\t/**\n\t * Function will save the field sequences\n\t */\n\tupdateFieldSequence: function () {\n\t\tvar thisInstance = this;\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tvar params = {};\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['action'] = 'SaveSequenceNumber';\n\t\tparams['mode'] = 'move';\n\t\tparams['updatedFields'] = thisInstance.updatedBlockFieldsList;\n\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t//window.location.reload();\n\t\t\tSettings_Vtiger_Index_Js.showMessage({text: app.vtranslate('JS_FIELD_SEQUENCE_UPDATED')});\n\t\t}).fail(function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t});\n\t},\n\n\t/**\n\t * Function to register click event for drop-downs in fields list\n\t */\n\tavoidDropDownClick: function (dropDownContainer) {\n\t\tdropDownContainer.find('.dropdown-menu').on('click', function (e) {\n\t\t\te.stopPropagation();\n\t\t});\n\t},\n\n\t/*\n\t * Function to add clickoutside event on the element - By using outside events plugin\n\t * @params element---On which element you want to apply the click outside event\n\t * @params callbackFunction---This function will contain the actions triggered after clickoutside event\n\t */\n\taddClickOutSideEvent: function (element, callbackFunction) {\n\t\telement.one('clickoutside', callbackFunction);\n\t},\n\t/**\n\t * Function to register the change event for layout editor modules list\n\t */\n\tregisterModulesChangeEvent: function () {\n\t\tvar thisInstance = this;\n\t\tvar container = jQuery('#quickCreateEditorContainer');\n\t\tvar contentsDiv = container.closest('.contentsDiv');\n\n\t\tApp.Fields.Picklist.showSelect2ElementView(container.find('[name=\"quickCreateEditorModules\"]'), {dropdownCss: {'z-index': 0}});\n\n\t\tcontainer.on('change', '[name=\"quickCreateEditorModules\"]', function (e) {\n\t\t\tvar currentTarget = jQuery(e.currentTarget);\n\t\t\tvar selectedModule = currentTarget.val();\n\t\t\tthisInstance.getModuleQuickCreateEditor(selectedModule).done(function (data) {\n\t\t\t\tcontentsDiv.html(data);\n\t\t\t\tthisInstance.registerEvents();\n\t\t\t});\n\t\t});\n\n\t},\n\t/**\n\t * Function to get the respective module layout editor through pjax\n\t */\n\tgetModuleQuickCreateEditor: function (selectedModule) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tvar params = {};\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['view'] = 'Index';\n\t\tparams['sourceModule'] = selectedModule;\n\n\t\tAppConnector.requestPjax(params).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.reject();\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\n\t/**\n\t * register events for layout editor\n\t */\n\tregisterEvents: function () {\n\t\tvar thisInstance = this;\n\n\t\tthisInstance.registerModulesChangeEvent();\n\t\tthisInstance.makeFieldsListSortable();\n\t\tthisInstance.registerFieldSequenceSaveClick();\n\n\t}\n\n});\n\njQuery(document).ready(function () {\n\tvar instance = new Settings_QuickCreateEditor_Js();\n\tinstance.registerEvents();\n})\n"],"names":["jQuery","Class","saveButton","find","attr","removeAttr","thisInstance","this","each","sortable","e","ui","showSaveFieldSequenceButton","sender","olderBlock","closest","reArrangeBlockFields","updatedBlockFieldsList","removeClass","addClass","block","leftSideContainer","rightSideContainer","children","length","lastElementInRightContainer","append","lastElementInLeftContainer","updatedBlock","firstBlockSortFields","tmpArray","i","domElement","eleAmount","push","editFields","expectedFieldSequence","fieldId","data","fieldid","sequence","secondBlockSortFields","secondEditFields","sequenceValue","on","hideSaveFieldSequenceButton","createUpdatedBlockFieldsList","updateFieldSequence","progressIndicatorElement","progressIndicator","params","app","getModuleName","getParentModuleName","request","done","mode","showMessage","text","vtranslate","fail","error","dropDownContainer","stopPropagation","element","callbackFunction","one","container","contentsDiv","Fields","Picklist","showSelect2ElementView","dropdownCss","z-index","selectedModule","currentTarget","val","getModuleQuickCreateEditor","html","registerEvents","aDeferred","Deferred","requestPjax","resolve","reject","promise","registerModulesChangeEvent","makeFieldsListSortable","registerFieldSequenceSaveClick","document","ready","Settings_QuickCreateEditor_Js"],"mappings":"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"}