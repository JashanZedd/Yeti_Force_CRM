{"version":3,"file":"QuickCreateEditor.min.js","sources":["QuickCreateEditor.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class('Settings_QuickCreateEditor_Js', {}, {\n\tupdatedBlockSequence: {},\n\n\tupdatedBlockFieldsList: [],\n\n\t/**\n\t * Function which will enable the save button in realted tabs list\n\t */\n\tshowSaveButton: function () {\n\t\tvar relatedList = jQuery('#relatedTabOrder');\n\t\tvar saveButton = relatedList.find('.saveRelatedList');\n\t\tif (saveButton.attr('disabled') == 'disabled') {\n\t\t\tsaveButton.removeAttr('disabled');\n\t\t}\n\t},\n\n\t/**\n\t * Function to regiser the event to make the fields sortable\n\t */\n\tmakeFieldsListSortable: function () {\n\t\tvar thisInstance = this;\n\t\tvar contents = jQuery('#quickCreateEditorContainer').find('.contents');\n\t\tjQuery('#quickCreateEditorContainer .contents .editFieldsTable').each(function () {\n\t\t\tjQuery(this).find('ul[name=sortable1], ul[name=sortable2]').sortable({\n\t\t\t\t'containment': '#moduleBlocks',\n\t\t\t\t'revert': true,\n\t\t\t\t'tolerance': 'pointer',\n\t\t\t\t'cursor': 'move',\n\t\t\t\t'connectWith': jQuery(this).find('.connectedSortable'),\n\t\t\t\t'update': function (e, ui) {\n\t\t\t\t\tthisInstance.showSaveFieldSequenceButton();\n\t\t\t\t\t// rearrange the older block fields\n\t\t\t\t\tif (ui.sender) {\n\t\t\t\t\t\tvar olderBlock = ui.sender.closest('.editFieldsTable');\n\t\t\t\t\t\tthisInstance.reArrangeBlockFields(olderBlock);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Function to show the save button of fieldSequence\n\t */\n\tshowSaveFieldSequenceButton: function () {\n\t\tvar thisInstance = this;\n\t\tvar layout = jQuery('#detailViewLayout');\n\t\tvar saveButton = layout.find('.saveFieldSequence');\n\t\tthisInstance.updatedBlockFieldsList = [];\n\t\tsaveButton.removeClass('visibility');\n\t},\n\n\t/**\n\t * Function which will hide the saveFieldSequence button\n\t */\n\thideSaveFieldSequenceButton: function () {\n\t\tvar layout = jQuery('#detailViewLayout');\n\t\tvar saveButton = layout.find('.saveFieldSequence');\n\t\tsaveButton.addClass('visibility');\n\t},\n\n\t/**\n\t * Function that rearranges fields in the block when the fields are moved\n\t * @param <jQuery object> block\n\t */\n\treArrangeBlockFields: function (block) {\n\t\t// 1.get the containers, 2.compare the length, 3.if uneven then move the last element\n\t\tvar leftSideContainer = block.find('ul[name=sortable1]');\n\t\tvar rightSideContainer = block.find('ul[name=sortable2]');\n\t\tif (leftSideContainer.children().length < rightSideContainer.children().length) {\n\t\t\tvar lastElementInRightContainer = rightSideContainer.children(':last');\n\t\t\tleftSideContainer.append(lastElementInRightContainer);\n\t\t} else if (leftSideContainer.children().length > rightSideContainer.children().length + 1) {\t//greater than 1\n\t\t\tvar lastElementInLeftContainer = leftSideContainer.children(':last');\n\t\t\trightSideContainer.append(lastElementInLeftContainer);\n\t\t}\n\t},\n\t/**\n\t * Function to create the list of updated blocks with all the fields and their sequences\n\t */\n\tcreateUpdatedBlockFieldsList: function () {\n\t\tvar thisInstance = this;\n\t\tvar contents = jQuery('#quickCreateEditorContainer').find('.contents');\n\n\t\tvar updatedBlock = contents.find('.block');\n\t\tvar firstBlockSortFields = updatedBlock.find('ul[name=sortable1]');\n\t\tvar tmpArray = []\n\t\tfirstBlockSortFields.each(function (i, domElement) {\n\t\t\tvar fieldEle = jQuery(domElement);\n\t\t\tvar eleAmount = fieldEle.find('.editFields').length;\n\t\t\ttmpArray.push(eleAmount)\n\t\t});\n\t\tvar editFields = firstBlockSortFields.find('.editFields');\n\t\tvar expectedFieldSequence = 1;\n\t\teditFields.each(function (i, domElement) {\n\t\t\tvar fieldEle = jQuery(domElement);\n\t\t\tvar fieldId = fieldEle.data('fieldId');\n\t\t\tthisInstance.updatedBlockFieldsList.push({'fieldid': fieldId, 'sequence': expectedFieldSequence});\n\t\t\texpectedFieldSequence = expectedFieldSequence + 2;\n\t\t\tif (i == tmpArray[0] - 1) {\n\t\t\t\texpectedFieldSequence = 1;\n\t\t\t}\n\t\t});\n\t\tvar secondBlockSortFields = updatedBlock.find('ul[name=sortable2]');\n\t\tvar secondEditFields = secondBlockSortFields.find('.editFields');\n\t\tvar sequenceValue = 2;\n\t\ttmpArray = []\n\t\tsecondBlockSortFields.each(function (i, domElement) {\n\t\t\tvar fieldEle = jQuery(domElement);\n\t\t\tvar eleAmount = fieldEle.find('.editFields').length;\n\t\t\ttmpArray.push(eleAmount)\n\t\t});\n\t\tsecondEditFields.each(function (i, domElement) {\n\t\t\tvar fieldEle = jQuery(domElement);\n\t\t\tvar fieldId = fieldEle.data('fieldId');\n\t\t\tthisInstance.updatedBlockFieldsList.push({'fieldid': fieldId, 'sequence': sequenceValue});\n\t\t\tsequenceValue = sequenceValue + 2;\n\t\t\tif (i == tmpArray[0] - 1) {\n\t\t\t\tsequenceValue = 2;\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Function to register click event for save button of fields sequence\n\t */\n\tregisterFieldSequenceSaveClick: function () {\n\t\tvar thisInstance = this;\n\t\tvar layout = jQuery('#detailViewLayout');\n\t\tlayout.on('click', '.saveFieldSequence', function () {\n\t\t\tthisInstance.hideSaveFieldSequenceButton();\n\t\t\tthisInstance.createUpdatedBlockFieldsList();\n\t\t\tthisInstance.updateFieldSequence();\n\t\t});\n\t},\n\n\t/**\n\t * Function will save the field sequences\n\t */\n\tupdateFieldSequence: function () {\n\t\tvar thisInstance = this;\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tvar params = {};\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['action'] = 'SaveSequenceNumber';\n\t\tparams['mode'] = 'move';\n\t\tparams['updatedFields'] = thisInstance.updatedBlockFieldsList;\n\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t//window.location.reload();\n\t\t\tSettings_Vtiger_Index_Js.showMessage({text: app.vtranslate('JS_FIELD_SEQUENCE_UPDATED')});\n\t\t}).fail(function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t});\n\t},\n\n\t/**\n\t * Function to register click event for drop-downs in fields list\n\t */\n\tavoidDropDownClick: function (dropDownContainer) {\n\t\tdropDownContainer.find('.dropdown-menu').on('click', function (e) {\n\t\t\te.stopPropagation();\n\t\t});\n\t},\n\n\t/*\n\t * Function to add clickoutside event on the element - By using outside events plugin\n\t * @params element---On which element you want to apply the click outside event\n\t * @params callbackFunction---This function will contain the actions triggered after clickoutside event\n\t */\n\taddClickOutSideEvent: function (element, callbackFunction) {\n\t\telement.one('clickoutside', callbackFunction);\n\t},\n\t/**\n\t * Function to register the change event for layout editor modules list\n\t */\n\tregisterModulesChangeEvent: function () {\n\t\tvar thisInstance = this;\n\t\tvar container = jQuery('#quickCreateEditorContainer');\n\t\tvar contentsDiv = container.closest('.contentsDiv');\n\n\t\tApp.Fields.Picklist.showSelect2ElementView(container.find('[name=\"quickCreateEditorModules\"]'), {dropdownCss: {'z-index': 0}});\n\n\t\tcontainer.on('change', '[name=\"quickCreateEditorModules\"]', function (e) {\n\t\t\tvar currentTarget = jQuery(e.currentTarget);\n\t\t\tvar selectedModule = currentTarget.val();\n\t\t\tthisInstance.getModuleQuickCreateEditor(selectedModule).done(function (data) {\n\t\t\t\tcontentsDiv.html(data);\n\t\t\t\tthisInstance.registerEvents();\n\t\t\t});\n\t\t});\n\n\t},\n\t/**\n\t * Function to get the respective module layout editor through pjax\n\t */\n\tgetModuleQuickCreateEditor: function (selectedModule) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tvar params = {};\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['view'] = 'Index';\n\t\tparams['sourceModule'] = selectedModule;\n\n\t\tAppConnector.requestPjax(params).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.reject();\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\n\t/**\n\t * register events for layout editor\n\t */\n\tregisterEvents: function () {\n\t\tvar thisInstance = this;\n\n\t\tthisInstance.registerModulesChangeEvent();\n\t\tthisInstance.makeFieldsListSortable();\n\t\tthisInstance.registerFieldSequenceSaveClick();\n\n\t}\n\n});\n\njQuery(document).ready(function () {\n\tvar instance = new Settings_QuickCreateEditor_Js();\n\tinstance.registerEvents();\n})\n"],"names":["jQuery","Class","relatedList","saveButton","find","attr","removeAttr","thisInstance","contents","each","sortable","e","ui","showSaveFieldSequenceButton","sender","olderBlock","closest","reArrangeBlockFields","layout","updatedBlockFieldsList","removeClass","addClass","block","leftSideContainer","rightSideContainer","children","length","lastElementInRightContainer","append","lastElementInLeftContainer","updatedBlock","firstBlockSortFields","tmpArray","i","domElement","fieldEle","eleAmount","push","editFields","expectedFieldSequence","fieldId","data","secondBlockSortFields","secondEditFields","sequenceValue","on","hideSaveFieldSequenceButton","createUpdatedBlockFieldsList","updateFieldSequence","progressIndicatorElement","progressIndicator","params","app","getModuleName","getParentModuleName","request","done","showMessage","text","vtranslate","fail","error","dropDownContainer","stopPropagation","element","callbackFunction","one","container","contentsDiv","Fields","Picklist","showSelect2ElementView","dropdownCss","currentTarget","selectedModule","val","getModuleQuickCreateEditor","html","registerEvents","aDeferred","Deferred","requestPjax","resolve","reject","promise","registerModulesChangeEvent","makeFieldsListSortable","registerFieldSequenceSaveClick","document","ready","instance","Settings_QuickCreateEditor_Js"],"mappings":"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"}