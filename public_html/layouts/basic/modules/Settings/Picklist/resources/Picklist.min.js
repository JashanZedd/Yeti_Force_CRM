"use strict";var Settings_Picklist_Js={registerModuleChangeEvent:function(){jQuery("#pickListModules").on("change",(function(e){var selectedModule=jQuery(e.currentTarget).val();if(selectedModule.length<=0)Settings_Vtiger_Index_Js.showMessage({type:"error",text:app.vtranslate("JS_PLEASE_SELECT_MODULE")});else{var params={module:app.getModuleName(),parent:app.getParentModuleName(),source_module:selectedModule,view:"IndexAjax",mode:"getPickListDetailsForModule"},progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}});AppConnector.request(params).done((function(data){jQuery("#modulePickListContainer").html(data),progressIndicatorElement.progressIndicator({mode:"hide"}),App.Fields.Picklist.changeSelectElementView(jQuery("#modulePickListContainer")),Settings_Picklist_Js.registerModulePickListChangeEvent(),jQuery("#modulePickList").trigger("change")}))}}))},registerModulePickListChangeEvent:function(){jQuery("#modulePickList").on("change",(function(e){var params={module:app.getModuleName(),parent:app.getParentModuleName(),source_module:jQuery("#pickListModules").val(),view:"IndexAjax",mode:"getPickListValueForField",pickListFieldId:jQuery(e.currentTarget).val()},progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}});AppConnector.request(params).done((function(data){jQuery("#modulePickListValuesContainer").html(data),App.Fields.Picklist.showSelect2ElementView(jQuery("#rolesList")),Settings_Picklist_Js.registerItemActions(),progressIndicatorElement.progressIndicator({mode:"hide"})}))}))},registerAddItemEvent:function(){jQuery("#addItem").on("click",(function(e){var clonedCreateView=jQuery("#createViewContents").find(".modal").clone(!0,!0).removeClass("basicCreateView").addClass("createView");clonedCreateView.find(".rolesList").addClass("select2"),clonedCreateView.find(".automation-list").addClass("select2");var callBackFunction=function(data){jQuery('[name="addItemForm"]',data).validationEngine(),Settings_Picklist_Js.registerAddItemSaveEvent(data),Settings_Picklist_Js.regiserSelectRolesEvent(data)};app.showModalWindow(clonedCreateView,(function(data){callBackFunction(data)}))}))},registerAssingValueToRuleEvent:function(){jQuery("#assignValue").on("click",(function(){var pickListValuesTable=jQuery("#pickListValuesTable"),selectedListItem=jQuery(".selectedListItem",pickListValuesTable);if(selectedListItem.length>0){var selectedValues=[];jQuery.each(selectedListItem,(function(i,element){selectedValues.push(jQuery(element).closest("tr").data("key"))}))}var params={module:app.getModuleName(),parent:app.getParentModuleName(),source_module:jQuery("#pickListModules").val(),view:"IndexAjax",mode:"showAssignValueToRoleView",pickListFieldId:jQuery("#modulePickList").val()};AppConnector.request(params).done((function(data){app.showModalWindow(data),jQuery('[name="addItemForm"]',jQuery(data)).validationEngine(),Settings_Picklist_Js.registerAssignValueToRoleSaveEvent(jQuery(data)),selectedListItem.length>0&&jQuery('[name="assign_values[]"]',jQuery("#assignValueToRoleForm")).select2("val",selectedValues)}))}))},registerAssignValueToRoleSaveEvent:function(data){jQuery("#assignValueToRoleForm").on("submit",(function(e){var form=jQuery(e.currentTarget),assignValuesSelectElement=jQuery('[name="assign_values[]"]',form),assignValuesSelect2Element=app.getSelect2ElementFromSelect(assignValuesSelectElement),assignValueResult=Vtiger_MultiSelect_Validator_Js.invokeValidation(assignValuesSelectElement);1!=assignValueResult?assignValuesSelect2Element.validationEngine("showPrompt",assignValueResult,"error","topLeft",!0):assignValuesSelect2Element.validationEngine("hide");var rolesSelectElement=jQuery('[name="rolesSelected[]"]',form),select2Element=app.getSelect2ElementFromSelect(rolesSelectElement),result=Vtiger_MultiSelect_Validator_Js.invokeValidation(rolesSelectElement);if(1!=result?select2Element.validationEngine("showPrompt",result,"error","bottomLeft",!0):select2Element.validationEngine("hide"),1==assignValueResult&&1==result){form.find('[name="saveButton"]').attr("disabled","disabled");var params=jQuery(e.currentTarget).serializeFormData();AppConnector.request(params).done((function(data){void 0!==data.result&&(app.hideModalWindow(),Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate("JS_VALUE_ASSIGNED_SUCCESSFULLY"),type:"success"}))})),e.preventDefault()}else e.preventDefault()}))},registerEnablePickListValueClickEvent:function(){jQuery("#listViewContents").on("click",".assignToRolePickListValue",(function(e){jQuery("#saveOrder").removeAttr("disabled");var pickListVaue=jQuery(e.currentTarget);pickListVaue.hasClass("selectedCell")?(pickListVaue.removeClass("selectedCell").addClass("unselectedCell"),pickListVaue.find(".fas").remove()):(pickListVaue.removeClass("unselectedCell").addClass("selectedCell"),pickListVaue.prepend('<i class="fas fa-check float-left"></span>'))}))},registerenableOrDisableListSaveEvent:function(){jQuery("#saveOrder").on("click",(function(e){var progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0,elementToBlock:jQuery(".tab-content")}}),pickListValues=jQuery(".assignToRolePickListValue"),disabledValues=[],enabledValues=[];jQuery.each(pickListValues,(function(i,element){var currentValue=jQuery(element);currentValue.hasClass("selectedCell")?enabledValues.push(currentValue.data("id")):disabledValues.push(currentValue.data("id"))}));var params={module:app.getModuleName(),parent:app.getParentModuleName(),action:"SaveAjax",mode:"enableOrDisable",enabled_values:enabledValues,disabled_values:disabledValues,picklistName:jQuery('[name="picklistName"]').val(),rolesSelected:jQuery("#rolesList").val()};AppConnector.request(params).done((function(data){void 0!==data.result&&(jQuery(e.currentTarget).attr("disabled","disabled"),progressIndicatorElement.progressIndicator({mode:"hide"}),Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate("JS_LIST_UPDATED_SUCCESSFULLY"),type:"success"}))}))}))},regiserSelectRolesEvent:function(data){data.find('[name="rolesSelected[]"]').on("change",(function(e){var rolesSelectElement=jQuery(e.currentTarget),selectedValue=rolesSelectElement.val();-1!=jQuery.inArray("all",selectedValue)?(rolesSelectElement.select2("val",""),rolesSelectElement.select2("val","all"),rolesSelectElement.select2("close"),rolesSelectElement.find("option").not(":first").attr("disabled","disabled"),data.find(jQuery(".modal-body")).append('<div class="alert alert-info textAlignCenter">'+app.vtranslate("JS_ALL_ROLES_SELECTED")+"</div>")):(rolesSelectElement.find("option").removeAttr("disabled","disabled"),data.find(".modal-body").find(".alert").remove())}))},registerRenameItemEvent:function(){var _this=this;$("#renameItem").on("click",(function(e){var selectedListItems=_this.getSelectedItems();return selectedListItems.length<1?(Vtiger_Helper_Js.showPnotify({title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_NO_ITEM_SELECTED"),type:"error"}),!1):selectedListItems.length>1?(Vtiger_Helper_Js.showPnotify({title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_MORE_THAN_ONE_ITEM_SELECTED"),type:"error"}),!1):void AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),source_module:$("#pickListModules").val(),view:"IndexAjax",mode:"showEditView",pickListFieldId:$("#modulePickList").val(),fieldValueId:selectedListItems[0].keyId}).done((function(data){app.showModalWindow(data);var form=$("#renameItemForm");_this.registerScrollForNonEditablePicklistValues(form),form.validationEngine(),Settings_Picklist_Js.registerRenameItemSaveEvent()}))}))},registerScrollForNonEditablePicklistValues:function(container){jQuery(container).find(".nonEditablePicklistValues").slimScroll({height:"70px",size:"6px"})},getSelectedItems:function(){var pickListValuesTable=$("#pickListValuesTable"),selectedListItem=$(".selectedListItem",pickListValuesTable),selectedListItemsArray=[];return $.each(selectedListItem,(function(index,element){selectedListItemsArray.push({key:$(element).closest("tr").data("key"),keyId:$(element).closest("tr").data("key-id")})})),selectedListItemsArray},registerDeleteItemEvent:function(){var _this2=this;$("#deleteItem").on("click",(function(e){var selectedListItems=_this2.getSelectedItems();$(".pickListValue",pickListValuesTable).length!==selectedListItems.length?_this2.showDeleteItemForm({module:app.getModuleName(),parent:app.getParentModuleName(),source_module:jQuery("#pickListModules").val(),view:"IndexAjax",mode:"showDeleteView",pickListFieldId:$("#modulePickList").val(),fieldValue:JSON.stringify(selectedListItems.map((function(item){return item.key})))}):Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate("JS_YOU_CANNOT_DELETE_ALL_THE_VALUES"),type:"error"})}))},registerDeleteOptionEvent:function(){var replaceValueElement=jQuery("#replaceValue");jQuery('[name="delete_value[]"]').on("select2:unselect",(function(e){var id=e.params.data.id,text=e.params.data.text;replaceValueElement.append('<option value="'+id+'">'+text+"</option>").trigger("change")})),jQuery('[name="delete_value[]"]').on("select2:select",(function(e){var id=e.params.data.id;jQuery('#replaceValue option[value="'+id+'"]').remove(),replaceValueElement.trigger("change")}))},registerChangeRoleEvent:function(){jQuery("#rolesList").on("change",(function(e){var progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0,elementToBlock:jQuery(".tab-content")}}),rolesList=jQuery(e.currentTarget),params={module:app.getModuleName(),parent:app.getParentModuleName(),view:"IndexAjax",mode:"getPickListValueByRole",rolesSelected:rolesList.val(),pickListFieldId:jQuery("#modulePickList").val(),sourceModule:jQuery('input[name="source_module"]').val()};AppConnector.request(params).done((function(data){jQuery("#pickListValeByRoleContainer").html(data),Settings_Picklist_Js.registerenableOrDisableListSaveEvent(),progressIndicatorElement.progressIndicator({mode:"hide"})}))}))},registerProcessStatusItemSaveEvent:function(form){form.on("submit",(function(e){e.preventDefault();var form=$(e.currentTarget);if(form.validationEngine("validate")){var newValue=void 0,params=form.serializeFormData();form.find('[name="newValue"]').length>0&&(newValue=$.trim(form.find('[name="newValue"]').val()),params.newValue=newValue),0===form.data("jqv").InvalidFields.length&&form.find('[name="saveButton"]').attr("disabled","disabled");var progress=$.progressIndicator({position:"html",blockInfo:{enabled:!0}});AppConnector.request(params).done((function(data){progress.progressIndicator({mode:"hide"}),void 0!==data.result&&!0===data.result?(app.hideModalWindow(),Vtiger_Helper_Js.showPnotify({title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_ITEM_SAVED_SUCCESSFULLY"),type:"success"})):form.find('[name="saveButton"]').attr("disabled",!1)})).fail((function(data,err){app.errorLog(data,err),progress.progressIndicator({mode:"hide"})}))}}))},registerProcessStatusItemEvent:function(){var _this3=this;$("#processStatusItem").on("click",(function(e){var selectedListItems=_this3.getSelectedItems();return 0===selectedListItems.length?(Vtiger_Helper_Js.showPnotify({title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_NO_ITEM_SELECTED"),type:"error"}),!1):selectedListItems.length>1?(Vtiger_Helper_Js.showPnotify({title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_MORE_THAN_ONE_ITEM_SELECTED"),type:"error"}),!1):void AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),source_module:$("#pickListModules").val(),view:"IndexAjax",mode:"showProcessStatusView",pickListFieldId:$("#modulePickList").val(),fieldValueId:selectedListItems[0].keyId}).done((function(data){app.showModalWindow(data);var form=$("#processStatusItemForm");_this3.registerScrollForNonEditablePicklistValues(form),form.validationEngine(),Settings_Picklist_Js.registerProcessStatusItemSaveEvent(form)}))}))},registerAddItemSaveEvent:function(container){container.find('[name="addItemForm"]').on("submit",(function(e){var form=jQuery(e.currentTarget);if(1==form.validationEngine("validate")){0==form.data("jqv").InvalidFields.length&&form.find('[name="saveButton"]').attr("disabled","disabled");var params=jQuery(e.currentTarget).serializeFormData(),newValue=params.newValue;params.newValue=jQuery.trim(newValue),AppConnector.request(params).done((function(data){if(data=data.result){var newValue=jQuery.trim(jQuery('[name="newValue"]',container).val()),dragImagePath=jQuery("#dragImagePath").val(),newPickListValueRow=jQuery('<tr class="pickListValue u-cursor-pointer"><td class="u-text-ellipsis"><img class="alignMiddle" src="'+dragImagePath+'" />&nbsp;&nbsp;'+newValue+"</td></tr>").appendTo(jQuery("#pickListValuesTable").find("tbody"));newPickListValueRow.attr("data-key",newValue),newPickListValueRow.attr("data-key-id",data.id),app.hideModalWindow();var params={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_ITEM_ADDED_SUCCESSFULLY"),type:"success"};Vtiger_Helper_Js.showPnotify(params);var pickListValuesEle=jQuery('[name="pickListValues"]'),pickListValuesArray=JSON.parse(pickListValuesEle.val());pickListValuesArray[data.id]=newValue,pickListValuesEle.val(JSON.stringify(pickListValuesArray))}else form.find('[name="saveButton"]').attr("disabled",!1)}))}e.preventDefault()}))},registerRenameItemSaveEvent:function(){$("#renameItemForm").on("submit",(function(e){e.preventDefault();var form=$(e.currentTarget);if(form.validationEngine("validate")){var newValue=void 0,oldValue=form.find('[name="oldValue"]').val(),id=form.find('[name="primaryKeyId"]').val(),params=$(e.currentTarget).serializeFormData();form.find('[name="newValue"]').length>0&&(newValue=$.trim(form.find('[name="newValue"]').val()),params.newValue=newValue),0===form.data("jqv").InvalidFields.length&&form.find('[name="saveButton"]').attr("disabled","disabled");var progress=$.progressIndicator({position:"html",blockInfo:{enabled:!0}});AppConnector.request(params).done((function(data){if(progress.progressIndicator({mode:"hide"}),void 0!==data.result){if(app.hideModalWindow(),Vtiger_Helper_Js.showPnotify({title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_ITEM_RENAMED_SUCCESSFULLY"),type:"success"}),""!==newValue){var encodedOldValue=oldValue.replace(/"/g,'\\"'),renamedElement='<tr class="pickListValue u-cursor-pointer"><td class="u-text-ellipsis"><img class="alignMiddle" src="'+$("#dragImagePath").val()+'" />&nbsp;&nbsp;'+data.result.newValue+"</td></tr>";$('[data-key="'+encodedOldValue+'"]').replaceWith($(renamedElement).attr("data-key",newValue).attr("data-key-id",id));var pickListValuesEle=$('[name="pickListValues"]'),pickListValuesArray=JSON.parse(pickListValuesEle.val());pickListValuesArray[id]=newValue,pickListValuesEle.val(JSON.stringify(pickListValuesArray))}}else form.find('[name="saveButton"]').attr("disabled",!1)})).fail((function(data,err){app.errorLog(data,err),progress.progressIndicator({mode:"hide"})}))}}))},showDeleteItemForm:function(params){var thisInstance=this;AppConnector.request(params).done((function(data){app.showModalWindow(data,(function(data){"function"==typeof callBackFunction&&callBackFunction(data)}))}));var callBackFunction=function(data){var form=data.find("#deleteItemForm");thisInstance.registerScrollForNonEditablePicklistValues(form);var maximumSelectionSize=jQuery("#pickListValuesCount").val()-1;App.Fields.Picklist.changeSelectElementView(jQuery('[name="delete_value[]"]'),"select2",{maximumSelectionLength:maximumSelectionSize,dropdownCss:{"z-index":100001}}),Settings_Picklist_Js.registerDeleteOptionEvent();var validationParams=app.getvalidationEngineOptions(!0);validationParams.onValidationComplete=function(form,valid){if(valid){var selectElement=jQuery('[name="delete_value[]"]'),select2Element=app.getSelect2ElementFromSelect(selectElement),result=Vtiger_MultiSelect_Validator_Js.invokeValidation(selectElement);if(!0!==result)return void select2Element.validationEngine("showPrompt",result,"error","topLeft",!0);select2Element.validationEngine("hide"),form.find('[name="saveButton"]').attr("disabled","disabled");var deleteValues=jQuery('[name="delete_value[]"]').val();AppConnector.request(form.serializeFormData()).done((function(data){if(void 0!==data.result){app.hideModalWindow();var pickListValuesEle=jQuery('[name="pickListValues"]'),pickListValuesArray=JSON.parse(pickListValuesEle.val());jQuery.each(deleteValues,(function(i,e){var encodedOldValue=e.replace(/"/g,'\\"');jQuery('[data-key-id="'+encodedOldValue+'"]').remove(),delete pickListValuesArray[e]})),pickListValuesEle.val(JSON.stringify(pickListValuesArray)),Vtiger_Helper_Js.showPnotify({title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_ITEMS_DELETED_SUCCESSFULLY"),type:"success"})}}))}return!1},form.validationEngine(validationParams)}},registerSelectPickListValueEvent:function(){jQuery("#pickListValuesTable").on("click",".pickListValue",(function(event){var currentRowTd=jQuery(event.currentTarget).find("td");event.preventDefault(),event.ctrlKey?currentRowTd.toggleClass("selectedListItem"):(jQuery(".pickListValue").find("td").not(currentRowTd).removeClass("selectedListItem"),currentRowTd.toggleClass("selectedListItem"))}))},registerPickListValuesSortableEvent:function(){var tbody=jQuery("tbody",jQuery("#pickListValuesTable"));tbody.sortable({helper:function(e,ui){return ui.children().each((function(index,element){(element=jQuery(element)).width(element.width())})),ui},containment:tbody,revert:!0,update:function(e,ui){jQuery("#saveSequence").removeAttr("disabled")}})},registerSaveSequenceClickEvent:function(){jQuery("#saveSequence").on("click",(function(e){var progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0,elementToBlock:jQuery(".tab-content")}}),pickListValuesSequenceArray={},pickListValues=jQuery("#pickListValuesTable").find(".pickListValue");jQuery.each(pickListValues,(function(i,element){pickListValuesSequenceArray[jQuery(element).data("key-id")]=++i}));var params={module:app.getModuleName(),parent:app.getParentModuleName(),action:"SaveAjax",mode:"saveOrder",picklistValues:pickListValuesSequenceArray,picklistName:jQuery('[name="picklistName"]').val()};AppConnector.request(params).done((function(data){void 0!==data.result&&(jQuery("#saveSequence").attr("disabled","disabled"),progressIndicatorElement.progressIndicator({mode:"hide"}),Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate("JS_SEQUENCE_UPDATED_SUCCESSFULLY"),type:"success"}))}))}))},registerAssingValueToRoleTabClickEvent:function(){jQuery("#assignedToRoleTab").on("click",(function(e){jQuery("#rolesList").trigger("change")}))},registerItemActions:function(){Settings_Picklist_Js.registerAddItemEvent(),Settings_Picklist_Js.registerRenameItemEvent(),Settings_Picklist_Js.registerDeleteItemEvent(),Settings_Picklist_Js.registerSelectPickListValueEvent(),Settings_Picklist_Js.registerAssingValueToRuleEvent(),Settings_Picklist_Js.registerChangeRoleEvent(),Settings_Picklist_Js.registerAssingValueToRoleTabClickEvent(),Settings_Picklist_Js.registerPickListValuesSortableEvent(),Settings_Picklist_Js.registerSaveSequenceClickEvent(),Settings_Picklist_Js.registerProcessStatusItemEvent()},registerEvents:function(){Settings_Picklist_Js.registerModuleChangeEvent(),Settings_Picklist_Js.registerModulePickListChangeEvent(),Settings_Picklist_Js.registerItemActions(),Settings_Picklist_Js.registerEnablePickListValueClickEvent()}};jQuery(document).ready((function(){Settings_Picklist_Js.registerEvents()})),Vtiger_Base_Validator_Js("Vtiger_FieldLabel_Validator_Js",{invokeValidation:function(field,rules,i,options){var instance=new Vtiger_FieldLabel_Validator_Js;if(instance.setElement(field),1!=instance.validate())return instance.getError()}},{validate:function(){var fieldValue=this.getFieldValue();return this.validateValue(fieldValue)},validateValue:function(fieldValue){return!/[\<\>\"\,\#]/.test(fieldValue)||(this.setError(app.vtranslate("JS_SPECIAL_CHARACTERS")+' < > " , # '+app.vtranslate("JS_NOT_ALLOWED")),!1)}});
//# sourceMappingURL=Picklist.min.js.map
