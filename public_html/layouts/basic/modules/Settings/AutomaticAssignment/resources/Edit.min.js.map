{"version":3,"file":"Edit.min.js","sources":["Edit.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class('Settings_AutomaticAssignment_Edit_Js', {}, {\n\tcontainer: false,\n\tadvanceFilterInstance: false,\n\tgetContainer: function () {\n\t\tif (this.container == false) {\n\t\t\tthis.container = jQuery('div.contentsDiv');\n\t\t}\n\t\treturn this.container;\n\t},\n\tregisterBasicEvents: function (container) {\n\t\tvar thisInstance = this;\n\n\t\tvar advanceFilterContainer = container.find('.filterContainer');\n\t\tif (advanceFilterContainer.length) {\n\t\t\tthis.advanceFilterInstance = Vtiger_AdvanceFilter_Js.getInstance(advanceFilterContainer);\n\t\t}\n\t\tvar form = container.find('form');\n\t\tif (form.length) {\n\t\t\tform.validationEngine(app.validationEngineOptions);\n\t\t\tform.find(\"[data-inputmask]\").inputmask();\n\t\t}\n\t\tcontainer.find('.select2noactive').each(function (index, domElement) {\n\t\t\tvar select = $(domElement);\n\t\t\tif (!select.data('select2')) {\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(select, {placeholder: app.vtranslate('JS_SELECT_AN_OPTION')});\n\t\t\t}\n\t\t});\n\t\tvar table = app.registerDataTables(container.find('.dataTable'));\n\t\tif (table) {\n\t\t\ttable.$('.changeRoleType').on('click', function (e) {\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\tvar dataElement = element.closest('tr');\n\t\t\t\tapp.saveAjax('changeRoleType', dataElement.data('value'), {'record': app.getMainParams('record')}).done(function (data) {\n\t\t\t\t\tthisInstance.refreshTab();\n\t\t\t\t});\n\t\t\t});\n\t\t\ttable.$('.delete').on('click', function (e) {\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\tvar dataElement = element.closest('tr');\n\t\t\t\tvar params = {\n\t\t\t\t\trecord: app.getMainParams('record'),\n\t\t\t\t\tvalue: dataElement.data('value'),\n\t\t\t\t\tname: dataElement.data('name')\n\t\t\t\t};\n\t\t\t\tapp.saveAjax('deleteElement', null, params).done(function (data) {\n\t\t\t\t\tthisInstance.refreshTab();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\tcontainer.find('.fieldContainer').on('click', function (e) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t});\n\n\t\tcontainer.find('.saveValue').on('click', function (e) {\n\t\t\tlet button = jQuery(e.currentTarget),\n\t\t\t\tfieldContainer = button.closest('.fieldContainer'),\n\t\t\t\tbaseFieldName = fieldContainer.data('dbname'),\n\t\t\t\tvalue = '';\n\t\t\tif (baseFieldName === 'conditions') {\n\t\t\t\tlet advfilterlist = thisInstance.advanceFilterInstance.getValues();\n\t\t\t\tvalue = JSON.stringify(advfilterlist);\n\t\t\t} else {\n\t\t\t\tlet fieldName = fieldContainer.data('name'),\n\t\t\t\t\tfieldElement = fieldContainer.find('[name=\"' + fieldName + '\"]');\n\t\t\t\tif (fieldElement.validationEngine('validate')) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tvalue = fieldElement.val();\n\t\t\t}\n\n\t\t\tlet params = [];\n\t\t\tparams[baseFieldName] = value;\n\t\t\tapp.saveAjax('save', jQuery.extend({}, params), {'record': app.getMainParams('record')}).done(function () {\n\t\t\t\tthisInstance.refreshTab();\n\t\t\t});\n\t\t});\n\t\tcontainer.find('.js-switch').on('change', (e) => {\n\t\t\tconst currentTarget = $(e.currentTarget),\n\t\t\t\tstate = currentTarget.val();\n\t\t\tlet params = [];\n\t\t\tif (currentTarget.hasClass('noField')) {\n\t\t\t\tif (state === '1') {\n\t\t\t\t\tcurrentTarget.closest('form').find('.fieldToShowHide').removeClass('d-none');\n\t\t\t\t\treturn false;\n\t\t\t\t} else if (state === '0') {\n\t\t\t\t\tcurrentTarget.closest('form').find('.fieldToShowHide').addClass('d-none');\n\t\t\t\t}\n\t\t\t}\n\t\t\tparams[currentTarget.attr('name')] = Number(state)\n\t\t\tapp.saveAjax('save', jQuery.extend({}, params), {'record': app.getMainParams('record')}).done(function (respons) {\n\t\t\t\tthisInstance.refreshTab();\n\t\t\t});\n\t\t});\n\t},\n\trefreshTab: function () {\n\t\tvar thisInstance = this;\n\t\tSettings_Vtiger_Index_Js.showMessage({text: app.vtranslate('JS_SAVE_SUCCESS')});\n\t\tvar tabContainer = this.getContainer().find('.tab-pane.active');\n\t\tif (tabContainer.hasClass('noRefresh')) {\n\t\t\treturn false;\n\t\t}\n\t\tAppConnector.request(tabContainer.data('url')).done(function (data) {\n\t\t\ttabContainer.html(data);\n\t\t\tthisInstance.registerBasicEvents(tabContainer);\n\t\t}).fail(function (textStatus, errorThrown) {\n\t\t\tapp.errorLog(textStatus, errorThrown);\n\t\t});\n\t},\n\tregisterEvents: function () {\n\t\tthis.registerBasicEvents(this.getContainer());\n\t}\n})\n"],"names":["jQuery","Class","container","thisInstance","advanceFilterContainer","find","length","advanceFilterInstance","Vtiger_AdvanceFilter_Js","getInstance","form","validationEngine","app","validationEngineOptions","inputmask","each","index","domElement","select","$","data","Fields","Picklist","showSelect2ElementView","placeholder","vtranslate","table","registerDataTables","on","e","stopPropagation","preventDefault","element","currentTarget","dataElement","closest","saveAjax","getMainParams","done","refreshTab","params","button","fieldContainer","baseFieldName","value","advfilterlist","getValues","JSON","stringify","fieldName","fieldElement","val","extend","state","hasClass","removeClass","addClass","attr","Number","respons","showMessage","text","tabContainer","getContainer","request","html","registerBasicEvents","fail","textStatus","errorThrown","errorLog"],"mappings":"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"}