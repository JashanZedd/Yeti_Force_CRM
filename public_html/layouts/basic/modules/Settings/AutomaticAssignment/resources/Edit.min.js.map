{"version":3,"file":"Edit.min.js","sources":["Edit.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class('Settings_AutomaticAssignment_Edit_Js', {}, {\n\tcontainer: false,\n\tadvanceFilterInstance: false,\n\tgetContainer: function () {\n\t\tif (this.container == false) {\n\t\t\tthis.container = jQuery('div.contentsDiv');\n\t\t}\n\t\treturn this.container;\n\t},\n\tregisterBasicEvents: function (container) {\n\t\tvar thisInstance = this;\n\n\t\tvar advanceFilterContainer = container.find('.filterContainer');\n\t\tif (advanceFilterContainer.length) {\n\t\t\tthis.advanceFilterInstance = Vtiger_AdvanceFilter_Js.getInstance(advanceFilterContainer);\n\t\t}\n\t\tvar form = container.find('form');\n\t\tif (form.length) {\n\t\t\tform.validationEngine(app.validationEngineOptions);\n\t\t\tform.find(\"[data-inputmask]\").inputmask();\n\t\t}\n\t\tcontainer.find('.select2noactive').each(function (index, domElement) {\n\t\t\tvar select = $(domElement);\n\t\t\tif (!select.data('select2')) {\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(select, {placeholder: app.vtranslate('JS_SELECT_AN_OPTION')});\n\t\t\t}\n\t\t});\n\t\tvar table = app.registerDataTables(container.find('.dataTable'));\n\t\tif (table) {\n\t\t\ttable.$('.changeRoleType').on('click', function (e) {\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\tvar dataElement = element.closest('tr');\n\t\t\t\tapp.saveAjax('changeRoleType', dataElement.data('value'), {'record': app.getMainParams('record')}).done(function (data) {\n\t\t\t\t\tthisInstance.refreshTab();\n\t\t\t\t});\n\t\t\t});\n\t\t\ttable.$('.delete').on('click', function (e) {\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\tvar dataElement = element.closest('tr');\n\t\t\t\tvar params = {\n\t\t\t\t\trecord: app.getMainParams('record'),\n\t\t\t\t\tvalue: dataElement.data('value'),\n\t\t\t\t\tname: dataElement.data('name')\n\t\t\t\t};\n\t\t\t\tapp.saveAjax('deleteElement', null, params).done(function (data) {\n\t\t\t\t\tthisInstance.refreshTab();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\tcontainer.find('.fieldContainer').on('click', function (e) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t});\n\n\t\tcontainer.find('.saveValue').on('click', function (e) {\n\t\t\tlet button = jQuery(e.currentTarget),\n\t\t\t\tfieldContainer = button.closest('.fieldContainer'),\n\t\t\t\tbaseFieldName = fieldContainer.data('dbname'),\n\t\t\t\tvalue = '';\n\t\t\tif (baseFieldName === 'conditions') {\n\t\t\t\tlet advfilterlist = thisInstance.advanceFilterInstance.getValues();\n\t\t\t\tvalue = JSON.stringify(advfilterlist);\n\t\t\t} else {\n\t\t\t\tlet fieldName = fieldContainer.data('name'),\n\t\t\t\t\tfieldElement = fieldContainer.find('[name=\"' + fieldName + '\"]');\n\t\t\t\tif (fieldElement.validationEngine('validate')) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tvalue = fieldElement.val();\n\t\t\t}\n\n\t\t\tlet params = [];\n\t\t\tparams[baseFieldName] = value;\n\t\t\tapp.saveAjax('save', jQuery.extend({}, params), {'record': app.getMainParams('record')}).done(function () {\n\t\t\t\tthisInstance.refreshTab();\n\t\t\t});\n\t\t});\n\t\tcontainer.find('.js-switch').on('change', (e) => {\n\t\t\tconst currentTarget = $(e.currentTarget),\n\t\t\t\tstate = currentTarget.val();\n\t\t\tlet params = [];\n\t\t\tif (currentTarget.hasClass('noField')) {\n\t\t\t\tif (state === '1') {\n\t\t\t\t\tcurrentTarget.closest('form').find('.fieldToShowHide').removeClass('d-none');\n\t\t\t\t\treturn false;\n\t\t\t\t} else if (state === '0') {\n\t\t\t\t\tcurrentTarget.closest('form').find('.fieldToShowHide').addClass('d-none');\n\t\t\t\t}\n\t\t\t}\n\t\t\tparams[currentTarget.attr('name')] = Number(state)\n\t\t\tapp.saveAjax('save', jQuery.extend({}, params), {'record': app.getMainParams('record')}).done(function (respons) {\n\t\t\t\tthisInstance.refreshTab();\n\t\t\t});\n\t\t});\n\t},\n\trefreshTab: function () {\n\t\tvar thisInstance = this;\n\t\tSettings_Vtiger_Index_Js.showMessage({text: app.vtranslate('JS_SAVE_SUCCESS')});\n\t\tvar tabContainer = this.getContainer().find('.tab-pane.active');\n\t\tif (tabContainer.hasClass('noRefresh')) {\n\t\t\treturn false;\n\t\t}\n\t\tAppConnector.request(tabContainer.data('url')).done(function (data) {\n\t\t\ttabContainer.html(data);\n\t\t\tthisInstance.registerBasicEvents(tabContainer);\n\t\t}).fail(function (textStatus, errorThrown) {\n\t\t\tapp.errorLog(textStatus, errorThrown);\n\t\t});\n\t},\n\tregisterEvents: function () {\n\t\tthis.registerBasicEvents(this.getContainer());\n\t}\n})\n"],"names":["jQuery","Class","this","container","thisInstance","advanceFilterContainer","find","length","advanceFilterInstance","Vtiger_AdvanceFilter_Js","getInstance","form","validationEngine","app","validationEngineOptions","inputmask","each","index","domElement","select","$","data","Fields","Picklist","showSelect2ElementView","placeholder","vtranslate","table","registerDataTables","on","e","stopPropagation","preventDefault","dataElement","currentTarget","closest","saveAjax","record","getMainParams","done","refreshTab","params","fieldContainer","baseFieldName","value","advfilterlist","getValues","JSON","stringify","fieldName","fieldElement","val","extend","state","hasClass","removeClass","addClass","attr","Number","respons","showMessage","text","tabContainer","getContainer","request","html","registerBasicEvents","fail","textStatus","errorThrown","errorLog"],"mappings":"aAGAA,OAAOC,MAAM,uCAAwC,GAAI,YAC7C,yBACY,eACT,kBACS,GAAlBC,KAAKC,iBACHA,UAAYH,OAAO,oBAElBE,KAAKC,+BAEQ,SAAUA,eAC1BC,aAAeF,KAEfG,uBAAyBF,UAAUG,KAAK,oBACxCD,uBAAuBE,cACrBC,sBAAwBC,wBAAwBC,YAAYL,6BAE9DM,KAAOR,UAAUG,KAAK,QACtBK,KAAKJ,cACHK,iBAAiBC,IAAIC,8BACrBR,KAAK,oBAAoBS,uBAErBT,KAAK,oBAAoBU,MAAK,SAAUC,MAAOC,gBACpDC,OAASC,EAAEF,YACVC,OAAOE,KAAK,gBACZC,OAAOC,SAASC,uBAAuBL,OAAQ,CAACM,YAAaZ,IAAIa,WAAW,gCAG9EC,MAAQd,IAAIe,mBAAmBzB,UAAUG,KAAK,eAC9CqB,cACGP,EAAE,mBAAmBS,GAAG,SAAS,SAAUC,KAC9CC,oBACAC,qBAEEC,YADUjC,OAAO8B,EAAEI,eACGC,QAAQ,UAC9BC,SAAS,iBAAkBH,YAAYZ,KAAK,SAAU,CAACgB,OAAUxB,IAAIyB,cAAc,YAAYC,MAAK,SAAUlB,mBACpGmB,yBAGTpB,EAAE,WAAWS,GAAG,SAAS,SAAUC,KACtCC,oBACAC,qBAEEC,YADUjC,OAAO8B,EAAEI,eACGC,QAAQ,MAC9BM,OAAS,QACJ5B,IAAIyB,cAAc,gBACnBL,YAAYZ,KAAK,cAClBY,YAAYZ,KAAK,aAEpBe,SAAS,gBAAiB,KAAMK,QAAQF,MAAK,SAAUlB,mBAC7CmB,8BAINlC,KAAK,mBAAmBuB,GAAG,SAAS,SAAUC,KACrDC,oBACAC,8BAGO1B,KAAK,cAAcuB,GAAG,SAAS,SAAUC,OAEjDY,eADY1C,OAAO8B,EAAEI,eACGC,QAAQ,mBAChCQ,cAAgBD,eAAerB,KAAK,UACpCuB,MAAQ,MACa,eAAlBD,cAAgC,KAC/BE,cAAgBzC,aAAaI,sBAAsBsC,kBAC/CC,KAAKC,UAAUH,mBACjB,KACFI,UAAYP,eAAerB,KAAK,QACnC6B,aAAeR,eAAepC,KAAK,UAAY2C,UAAY,SACxDC,aAAatC,iBAAiB,mBAC1B,QAEAsC,aAAaC,UAGlBV,OAAS,UACNE,eAAiBC,UACpBR,SAAS,OAAQpC,OAAOoD,OAAO,GAAIX,QAAS,CAACJ,OAAUxB,IAAIyB,cAAc,YAAYC,MAAK,wBAChFC,6BAGLlC,KAAK,cAAcuB,GAAG,UAAU,SAACC,OACpCI,cAAgBd,EAAEU,EAAEI,eACzBmB,MAAQnB,cAAciB,MACnBV,OAAS,MACTP,cAAcoB,SAAS,WAAY,IACxB,MAAVD,2BACWlB,QAAQ,QAAQ7B,KAAK,oBAAoBiD,YAAY,WAC5D,EACa,MAAVF,qBACIlB,QAAQ,QAAQ7B,KAAK,oBAAoBkD,SAAS,iBAG3DtB,cAAcuB,KAAK,SAAWC,OAAOL,WACxCjB,SAAS,OAAQpC,OAAOoD,OAAO,GAAIX,QAAS,CAACJ,OAAUxB,IAAIyB,cAAc,YAAYC,MAAK,SAAUoB,sBAC1FnB,+BAIJ,eACPpC,aAAeF,8BACM0D,YAAY,CAACC,KAAMhD,IAAIa,WAAW,yBACvDoC,aAAe5D,KAAK6D,eAAezD,KAAK,uBACxCwD,aAAaR,SAAS,oBAClB,eAEKU,QAAQF,aAAazC,KAAK,QAAQkB,MAAK,SAAUlB,mBAChD4C,KAAK5C,mBACL6C,oBAAoBJ,iBAC/BK,MAAK,SAAUC,WAAYC,iBACzBC,SAASF,WAAYC,gCAGX,gBACVH,oBAAoBhE,KAAK6D"}