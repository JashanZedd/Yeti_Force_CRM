{"version":3,"file":"Shop.min.js","sources":["Shop.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n/**\n * Class Settings_YetiForce_Shop_Js.\n * @type {window.Settings_YetiForce_Shop_Js}\n */\nwindow.Settings_YetiForce_Shop_Js = class Settings_YetiForce_Shop_Js {\n\t/**\n\t * Constructor.\n\t */\n\tconstructor() {\n\t\tthis.container = $('.js-products-container');\n\t}\n\t/**\n\t * Register events.\n\t */\n\tregisterEvents() {\n\t\tthis.registerProductModalClick();\n\t\tthis.registerBuyModalClick();\n\t}\n\t/**\n\t * Register product modal click.\n\t *\n\t */\n\tregisterProductModalClick() {\n\t\tthis.container.find('.js-product').on('click', e => {\n\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\tthis.showProductModal(currentTarget.data('product'), this.getDepartment(currentTarget));\n\t\t});\n\t}\n\t/**\n\t * Show product modal action.\n\t *\n\t * @param   {string}  productName\n\t * @param   {string}  department\n\t */\n\tshowProductModal(productName, department) {\n\t\tapp.showModalWindow(\n\t\t\tnull,\n\t\t\t`index.php?module=YetiForce&parent=Settings&view=ProductModal&product=${productName}&department=${department}`,\n\t\t\tmodalContainer => {\n\t\t\t\tmodalContainer.find('.js-modal__save').on('click', _ => {\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\tthis.showBuyModal(productName, department);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t}\n\t/**\n\t * Register buy modal click.\n\t *\n\t */\n\tregisterBuyModalClick() {\n\t\tthis.container.find('.js-buy-modal').on('click', e => {\n\t\t\te.stopPropagation();\n\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\tthis.showBuyModal(currentTarget.data('product'), this.getDepartment(currentTarget));\n\t\t});\n\t}\n\t/**\n\t * Show buy modal action.\n\t *\n\t * @param   {string}  productName\n\t * @param   {string}  department\n\t */\n\tshowBuyModal(productName, department) {\n\t\tapp.showModalWindow(\n\t\t\tnull,\n\t\t\t`index.php?module=YetiForce&parent=Settings&view=BuyModal&product=${productName}${\n\t\t\t\tdepartment ? '&department=' + department : ''\n\t\t\t}`,\n\t\t\tthis.registerBuyModalEvents.bind(this)\n\t\t);\n\t}\n\n\tregisterBuyModalEvents(modalContainer) {\n\t\tconst companyForm = modalContainer.find('.js-update-company-form');\n\t\tconst buyForm = modalContainer.find('.js-buy-form');\n\t\tmodalContainer.find('.js-modal__save').on('click', _ => {\n\t\t\tthis.registerBuyModalForms(companyForm, buyForm);\n\t\t});\n\t\tif (companyForm.length) {\n\t\t\tcompanyForm.validationEngine(app.validationEngineOptions);\n\t\t\tcompanyForm.find('[data-inputmask]').inputmask();\n\t\t}\n\t}\n\tregisterBuyModalForms(companyForm, buyForm) {\n\t\tif (companyForm.length) {\n\t\t\tif (companyForm.validationEngine('validate') === true) {\n\t\t\t\tapp.removeEmptyFilesInput(companyForm[0]);\n\t\t\t\tconst formData = new FormData(companyForm[0]);\n\t\t\t\tconst params = {\n\t\t\t\t\turl: 'index.php',\n\t\t\t\t\ttype: 'POST',\n\t\t\t\t\tdata: formData,\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tcontentType: false\n\t\t\t\t};\n\t\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\tblockInfo: { enabled: true }\n\t\t\t\t});\n\t\t\t\tAppConnector.request(params).done(data => {\n\t\t\t\t\tif (data.success) {\n\t\t\t\t\t\tbuyForm.submit();\n\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t}\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tapp.formAlignmentAfterValidation(companyForm);\n\t\t\t}\n\t\t} else {\n\t\t\tbuyForm.submit();\n\t\t\tapp.hideModalWindow();\n\t\t}\n\t}\n\t/**\n\t * Get department.\n\t *\n\t * @param   {object}  element  jQuery\n\t *\n\t * @return  {string}\n\t */\n\tgetDepartment(element) {\n\t\tlet department = element.closest('.js-department');\n\t\treturn department.length ? department.data('department') : '';\n\t}\n};\n"],"names":["window","Settings_YetiForce_Shop_Js","container","$","registerProductModalClick","registerBuyModalClick","find","on","e","currentTarget","showProductModal","data","getDepartment","productName","department","app","showModalWindow","modalContainer","hideModalWindow","showBuyModal","stopPropagation","registerBuyModalEvents","bind","companyForm","buyForm","registerBuyModalForms","length","validationEngine","validationEngineOptions","inputmask","submit","removeEmptyFilesInput","progressIndicatorElement","progressIndicator","blockInfo","enabled","AppConnector","request","url","type","formData","processData","contentType","done","success","mode","formAlignmentAfterValidation","element","closest"],"mappings":"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"}