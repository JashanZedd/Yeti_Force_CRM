{"version":3,"file":"Shop.min.js","sources":["Shop.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n/**\n * Class Settings_YetiForce_Shop_Js.\n * @type {window.Settings_YetiForce_Shop_Js}\n */\nwindow.Settings_YetiForce_Shop_Js = class Settings_YetiForce_Shop_Js {\n\t/**\n\t * Constructor.\n\t */\n\tconstructor(modalUrl = 'index.php?module=YetiForce&parent=Settings') {\n\t\tthis.container = $('.js-products-container');\n\t\tthis.modalUrl = modalUrl;\n\t}\n\t/**\n\t * Register events.\n\t */\n\tregisterEvents() {\n\t\tthis.registerProductModalClick();\n\t\tthis.registerBuyModalClick();\n\t\tthis.registerShopSearch();\n\t\tthis.showInitialModal();\n\t}\n\tshowInitialModal() {\n\t\tconst request = app.convertUrlToObject(window.location.href);\n\t\tif (request.mode) {\n\t\t\tif (request.showBuyModal === 'buy') {\n\t\t\t\tthis.showBuyModal(request.product, request.department);\n\t\t\t} else if (request.mode === 'showProductModal') {\n\t\t\t\tthis.showProductModal(request.product, request.department);\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Register events.\n\t */\n\tregisterShopSearch() {\n\t\tlet searchField = this.container.find('.js-shop-search');\n\t\tsearchField = searchField.length ? searchField : $('.js-shop-search');\n\t\tsearchField\n\t\t\t.on('keyup', e => {\n\t\t\t\tlet value = $(e.currentTarget)\n\t\t\t\t\t.val()\n\t\t\t\t\t.toLowerCase();\n\t\t\t\tthis.container.find('.js-product .js-text-search').filter(function() {\n\t\t\t\t\tlet item = $(this).closest('.js-product');\n\t\t\t\t\tif (\n\t\t\t\t\t\t$(this)\n\t\t\t\t\t\t\t.text()\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.indexOf(value) > -1\n\t\t\t\t\t) {\n\t\t\t\t\t\titem.removeClass('d-none');\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem.addClass('d-none');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t\t.on('click', e => {\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t}\n\t/**\n\t * Register product modal click.\n\t *\n\t */\n\tregisterProductModalClick() {\n\t\tthis.container.find('.js-product').on('click', e => {\n\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\tthis.showProductModal(currentTarget.data('product'), this.getDepartment(currentTarget));\n\t\t});\n\t}\n\t/**\n\t * Show product modal action.\n\t *\n\t * @param   {string}  productName\n\t * @param   {string}  department\n\t */\n\tshowProductModal(productName, department) {\n\t\tapp.showModalWindow(\n\t\t\tnull,\n\t\t\t`${this.modalUrl}&view=ProductModal&product=${productName}${department ? '&department=' + department : ''}`,\n\t\t\tmodalContainer => {\n\t\t\t\tmodalContainer.find('.js-modal__save').on('click', _ => {\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\tthis.showBuyModal(productName, department);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t}\n\t/**\n\t * Register buy modal click.\n\t *\n\t */\n\tregisterBuyModalClick() {\n\t\tthis.container.find('.js-buy-modal').on('click', e => {\n\t\t\te.stopPropagation();\n\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\tthis.showBuyModal(currentTarget.data('product'), this.getDepartment(currentTarget));\n\t\t});\n\t}\n\t/**\n\t * Show buy modal action.\n\t *\n\t * @param   {string}  productName\n\t * @param   {string}  department\n\t */\n\tshowBuyModal(productName, department) {\n\t\tapp.showModalWindow(\n\t\t\tnull,\n\t\t\t`${this.modalUrl}&view=BuyModal&product=${productName}${department ? '&department=' + department : ''}`,\n\t\t\tthis.registerBuyModalEvents.bind(this)\n\t\t);\n\t}\n\n\tregisterBuyModalEvents(modalContainer) {\n\t\tconst companyForm = modalContainer.find('.js-update-company-form');\n\t\tconst buyForm = modalContainer.find('.js-buy-form');\n\t\tmodalContainer.find('.js-modal__save').on('click', _ => {\n\t\t\tthis.registerBuyModalForms(companyForm, buyForm);\n\t\t});\n\t\tif (companyForm.length) {\n\t\t\tcompanyForm.validationEngine(app.validationEngineOptions);\n\t\t\tcompanyForm.find('[data-inputmask]').inputmask();\n\t\t}\n\t\tif (buyForm.length) {\n\t\t\tbuyForm.validationEngine(app.validationEngineOptions);\n\t\t}\n\t}\n\tregisterBuyModalForms(companyForm, buyForm) {\n\t\tif (companyForm.length) {\n\t\t\tif (companyForm.validationEngine('validate') === true) {\n\t\t\t\tapp.removeEmptyFilesInput(companyForm[0]);\n\t\t\t\tconst formData = new FormData(companyForm[0]);\n\t\t\t\tconst params = {\n\t\t\t\t\turl: 'index.php',\n\t\t\t\t\ttype: 'POST',\n\t\t\t\t\tdata: formData,\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tcontentType: false\n\t\t\t\t};\n\t\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\tblockInfo: { enabled: true }\n\t\t\t\t});\n\t\t\t\tAppConnector.request(params).done(data => {\n\t\t\t\t\tif (data.success) {\n\t\t\t\t\t\tbuyForm.submit();\n\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t}\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tapp.formAlignmentAfterValidation(companyForm);\n\t\t\t}\n\t\t} else {\n\t\t\tif (buyForm.validationEngine('validate') === true) {\n\t\t\t\tthis.updateCustomData(buyForm);\n\t\t\t\tbuyForm.submit();\n\t\t\t\tapp.hideModalWindow();\n\t\t\t} else {\n\t\t\t\tapp.formAlignmentAfterValidation(buyForm);\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Update custom data.\n\t */\n\tupdateCustomData(buyForm) {\n\t\tlet customField = buyForm.find('.js-custom-data');\n\t\tlet priceBySize = buyForm.find('.js-price-by-size');\n\t\tif (customField.length) {\n\t\t\tlet customFields = buyForm.find('.js-custom-field');\n\t\t\tcustomFields.each((i, el) => {\n\t\t\t\tlet field = $(el);\n\t\t\t\tcustomField.val(\n\t\t\t\t\t`${customField.val()}${field.data('name')}::${field.val()}${customFields.length - 1 !== i ? '|' : ''}`\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t\tif (priceBySize.length) {\n\t\t\tpriceBySize\n\t\t\t\t.siblings('.js-price-by-size-input')\n\t\t\t\t.val(priceBySize.find(`option[value=\"${priceBySize.val()}\"]`).data('os0'));\n\t\t}\n\t}\n\t/**\n\t * Get department.\n\t *\n\t * @param   {object}  element  jQuery\n\t *\n\t * @return  {string}\n\t */\n\tgetDepartment(element) {\n\t\tlet department = element.closest('.js-department');\n\t\treturn department.length ? department.data('department') : '';\n\t}\n};\n"],"names":["window","Settings_YetiForce_Shop_Js","modalUrl","container","$","registerProductModalClick","registerBuyModalClick","registerShopSearch","showInitialModal","request","app","convertUrlToObject","location","href","mode","showBuyModal","product","department","showProductModal","searchField","this","find","length","on","value","e","currentTarget","val","toLowerCase","filter","item","closest","text","indexOf","removeClass","addClass","stopPropagation","data","_this2","getDepartment","productName","showModalWindow","hideModalWindow","_this4","registerBuyModalEvents","bind","modalContainer","companyForm","buyForm","registerBuyModalForms","validationEngine","validationEngineOptions","inputmask","removeEmptyFilesInput","params","FormData","progressIndicatorElement","progressIndicator","enabled","done","success","submit","formAlignmentAfterValidation","updateCustomData","customField","priceBySize","customFields","each","i","el","field","siblings","element"],"mappings":"0oBAOAA,OAAOC,gFAIMC,gEAAW,kGACjBC,UAAYC,EAAE,+BACdF,SAAWA,oGAMXG,iCACAC,6BACAC,0BACAC,kEAGCC,QAAUC,IAAIC,mBAAmBX,OAAOY,SAASC,MACnDJ,QAAQK,OACkB,QAAzBL,QAAQM,kBACNA,aAAaN,QAAQO,QAASP,QAAQQ,YAChB,qBAAjBR,QAAQK,WACbI,iBAAiBT,QAAQO,QAASP,QAAQQ,yEAQ7CE,YAAcC,KAAKjB,UAAUkB,KAAK,gCACxBF,YAAYG,OAASH,YAAcf,EAAE,oBAEjDmB,GAAG,SAAS,gBACRC,MAAQpB,EAAEqB,EAAEC,eACdC,MACAC,oBACGzB,UAAUkB,KAAK,+BAA+BQ,QAAO,eACrDC,KAAO1B,EAAEgB,MAAMW,QAAQ,eAE1B3B,EAAEgB,MACAY,OACAJ,cACAK,QAAQT,QAAU,OAEfU,YAAY,eAEZC,SAAS,gBAIhBZ,GAAG,SAAS,cACVa,8FAQCjC,UAAUkB,KAAK,eAAeE,GAAG,SAAS,gBACxCG,cAAgBtB,EAAEqB,EAAEC,sBACrBR,iBAAiBQ,cAAcW,KAAK,WAAYC,OAAKC,cAAcb,4DASzDc,YAAavB,gCACzBwB,gBACH,KACGrB,KAAKlB,uCAAsCsC,aAAcvB,WAAa,eAAiBA,WAAa,KACvG,wCACgBI,KAAK,mBAAmBE,GAAG,SAAS,gBAC9CmB,yBACC3B,aAAayB,YAAavB,uFAU7Bd,UAAUkB,KAAK,iBAAiBE,GAAG,SAAS,cAC9Ca,sBACIV,cAAgBtB,EAAEqB,EAAEC,sBACrBX,aAAaW,cAAcW,KAAK,WAAYM,OAAKJ,cAAcb,wDASzDc,YAAavB,gBACrBwB,gBACH,KACGrB,KAAKlB,mCAAkCsC,aAAcvB,WAAa,eAAiBA,WAAa,IACnGG,KAAKwB,uBAAuBC,KAAKzB,sDAIZ0B,gCAChBC,YAAcD,eAAezB,KAAK,2BAClC2B,QAAUF,eAAezB,KAAK,+BACrBA,KAAK,mBAAmBE,GAAG,SAAS,mBAC7C0B,sBAAsBF,YAAaC,YAErCD,YAAYzB,qBACH4B,iBAAiBxC,IAAIyC,qCACrB9B,KAAK,oBAAoB+B,aAElCJ,QAAQ1B,gBACH4B,iBAAiBxC,IAAIyC,uEAGTJ,YAAaC,YAC9BD,YAAYzB,WACkC,IAA7CyB,YAAYG,iBAAiB,YAAsB,KAClDG,sBAAsBN,YAAY,QAEhCO,OAAS,KACT,iBACC,YAHU,IAAIC,SAASR,YAAY,iBAK5B,eACA,GAERS,yBAA2BpD,EAAEqD,kBAAkB,WACzC,CAAEC,SAAS,kBAEVjD,QAAQ6C,QAAQK,MAAK,eAC7BtB,KAAKuB,kBACAC,aACJnB,4CAEoBe,kBAAkB,CAAE3C,KAAM,qBAGhDgD,6BAA6Bf,kBAGW,IAAzCC,QAAQE,iBAAiB,kBACvBa,iBAAiBf,iBACda,aACJnB,uBAEAoB,6BAA6Bd,kDAOnBA,aACZgB,YAAchB,QAAQ3B,KAAK,mBAC3B4C,YAAcjB,QAAQ3B,KAAK,wBAC3B2C,YAAY1C,OAAQ,KACnB4C,aAAelB,QAAQ3B,KAAK,iCACnB8C,MAAK,SAACC,EAAGC,QACjBC,MAAQlE,EAAEiE,gBACF1C,OACRqC,YAAYrC,MAAQ2C,MAAMjC,KAAK,aAAYiC,MAAM3C,OAAQuC,aAAa5C,OAAS,IAAM8C,EAAI,IAAM,QAIjGH,YAAY3C,oBAEbiD,SAAS,2BACT5C,IAAIsC,YAAY5C,sBAAsB4C,YAAYtC,YAAWU,KAAK,8CAUxDmC,aACTvD,WAAauD,QAAQzC,QAAQ,yBAC1Bd,WAAWK,OAASL,WAAWoB,KAAK,cAAgB"}