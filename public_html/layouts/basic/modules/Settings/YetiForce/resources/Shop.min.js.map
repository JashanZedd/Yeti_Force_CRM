{"version":3,"file":"Shop.min.js","sources":["Shop.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n/**\n * Class Settings_YetiForce_Shop_Js.\n * @type {window.Settings_YetiForce_Shop_Js}\n */\nwindow.Settings_YetiForce_Shop_Js = class Settings_YetiForce_Shop_Js {\n\t/**\n\t * Constructor.\n\t */\n\tconstructor(modalUrl = 'index.php?module=YetiForce&parent=Settings') {\n\t\tthis.container = $('.js-products-container');\n\t\tthis.modalUrl = modalUrl;\n\t}\n\t/**\n\t * Register events.\n\t */\n\tregisterEvents() {\n\t\tthis.registerProductModalClick();\n\t\tthis.registerBuyModalClick();\n\t\tthis.registerShopSearch();\n\t\tthis.showInitialModal();\n\t}\n\tshowInitialModal() {\n\t\tconst request = app.convertUrlToObject(window.location.href);\n\t\tif (request.mode) {\n\t\t\tif (request.showBuyModal === 'buy') {\n\t\t\t\tthis.showBuyModal(request.product, request.department);\n\t\t\t} else if (request.mode === 'showProductModal') {\n\t\t\t\tthis.showProductModal(request.product, request.department);\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Register events.\n\t */\n\tregisterShopSearch() {\n\t\tlet searchField = this.container.find('.js-shop-search');\n\t\tsearchField = searchField.length ? searchField : $('.js-shop-search');\n\t\tsearchField\n\t\t\t.on('keyup', e => {\n\t\t\t\tlet value = $(e.currentTarget)\n\t\t\t\t\t.val()\n\t\t\t\t\t.toLowerCase();\n\t\t\t\tthis.container.find('.js-product .js-text-search').filter(function() {\n\t\t\t\t\tlet item = $(this).closest('.js-product');\n\t\t\t\t\tif (\n\t\t\t\t\t\t$(this)\n\t\t\t\t\t\t\t.text()\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.indexOf(value) > -1\n\t\t\t\t\t) {\n\t\t\t\t\t\titem.removeClass('d-none');\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem.addClass('d-none');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t\t.on('click', e => {\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t}\n\t/**\n\t * Register product modal click.\n\t *\n\t */\n\tregisterProductModalClick() {\n\t\tthis.container.find('.js-product').on('click', e => {\n\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\tthis.showProductModal(currentTarget.data('product'), this.getDepartment(currentTarget));\n\t\t});\n\t}\n\t/**\n\t * Show product modal action.\n\t *\n\t * @param   {string}  productName\n\t * @param   {string}  department\n\t */\n\tshowProductModal(productName, department) {\n\t\tapp.showModalWindow(\n\t\t\tnull,\n\t\t\t`${this.modalUrl}&view=ProductModal&product=${productName}${department ? '&department=' + department : ''}`,\n\t\t\tmodalContainer => {\n\t\t\t\tmodalContainer.find('.js-modal__save').on('click', _ => {\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\tthis.showBuyModal(productName, department);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t}\n\t/**\n\t * Register buy modal click.\n\t *\n\t */\n\tregisterBuyModalClick() {\n\t\tthis.container.find('.js-buy-modal').on('click', e => {\n\t\t\te.stopPropagation();\n\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\tthis.showBuyModal(currentTarget.data('product'), this.getDepartment(currentTarget));\n\t\t});\n\t}\n\t/**\n\t * Show buy modal action.\n\t *\n\t * @param   {string}  productName\n\t * @param   {string}  department\n\t */\n\tshowBuyModal(productName, department) {\n\t\tapp.showModalWindow(\n\t\t\tnull,\n\t\t\t`${this.modalUrl}&view=BuyModal&product=${productName}${department ? '&department=' + department : ''}`,\n\t\t\tthis.registerBuyModalEvents.bind(this)\n\t\t);\n\t}\n\n\tregisterBuyModalEvents(modalContainer) {\n\t\tconst companyForm = modalContainer.find('.js-update-company-form');\n\t\tconst buyForm = modalContainer.find('.js-buy-form');\n\t\tmodalContainer.find('.js-modal__save').on('click', _ => {\n\t\t\tthis.registerBuyModalForms(companyForm, buyForm);\n\t\t});\n\t\tif (companyForm.length) {\n\t\t\tcompanyForm.validationEngine(app.validationEngineOptions);\n\t\t\tcompanyForm.find('[data-inputmask]').inputmask();\n\t\t}\n\t\tif (buyForm.length) {\n\t\t\tbuyForm.validationEngine(app.validationEngineOptions);\n\t\t}\n\t}\n\tregisterBuyModalForms(companyForm, buyForm) {\n\t\tif (companyForm.length) {\n\t\t\tif (companyForm.validationEngine('validate') === true) {\n\t\t\t\tapp.removeEmptyFilesInput(companyForm[0]);\n\t\t\t\tconst formData = new FormData(companyForm[0]);\n\t\t\t\tconst params = {\n\t\t\t\t\turl: 'index.php',\n\t\t\t\t\ttype: 'POST',\n\t\t\t\t\tdata: formData,\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tcontentType: false\n\t\t\t\t};\n\t\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\tblockInfo: { enabled: true }\n\t\t\t\t});\n\t\t\t\tAppConnector.request(params).done(data => {\n\t\t\t\t\tif (data.success) {\n\t\t\t\t\t\tbuyForm.submit();\n\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t}\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tapp.formAlignmentAfterValidation(companyForm);\n\t\t\t}\n\t\t} else {\n\t\t\tif (buyForm.validationEngine('validate') === true) {\n\t\t\t\tthis.updateCustomData(buyForm);\n\t\t\t\tbuyForm.submit();\n\t\t\t\tapp.hideModalWindow();\n\t\t\t} else {\n\t\t\t\tapp.formAlignmentAfterValidation(buyForm);\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Update custom data.\n\t */\n\tupdateCustomData(buyForm) {\n\t\tlet customField = buyForm.find('.js-custom-data');\n\t\tlet priceBySize = buyForm.find('.js-price-by-size');\n\t\tif (customField.length) {\n\t\t\tlet customFields = buyForm.find('.js-custom-field');\n\t\t\tcustomFields.each((i, el) => {\n\t\t\t\tlet field = $(el);\n\t\t\t\tcustomField.val(\n\t\t\t\t\t`${customField.val()}${field.data('name')}::${field.val()}${customFields.length - 1 !== i ? '|' : ''}`\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t\tif (priceBySize.length) {\n\t\t\tpriceBySize\n\t\t\t\t.siblings('.js-price-by-size-input')\n\t\t\t\t.val(priceBySize.find(`option[value=\"${priceBySize.val()}\"]`).data('os0'));\n\t\t}\n\t}\n\t/**\n\t * Get department.\n\t *\n\t * @param   {object}  element  jQuery\n\t *\n\t * @return  {string}\n\t */\n\tgetDepartment(element) {\n\t\tlet department = element.closest('.js-department');\n\t\treturn department.length ? department.data('department') : '';\n\t}\n};\n"],"names":["window","Settings_YetiForce_Shop_Js","modalUrl","container","$","registerProductModalClick","registerBuyModalClick","registerShopSearch","showInitialModal","request","app","convertUrlToObject","location","href","mode","showBuyModal","product","department","showProductModal","searchField","find","length","on","value","e","currentTarget","val","toLowerCase","filter","item","closest","text","indexOf","removeClass","addClass","stopPropagation","data","getDepartment","productName","showModalWindow","hideModalWindow","registerBuyModalEvents","bind","modalContainer","companyForm","buyForm","registerBuyModalForms","validationEngine","validationEngineOptions","inputmask","removeEmptyFilesInput","formData","FormData","params","progressIndicatorElement","progressIndicator","enabled","done","success","submit","formAlignmentAfterValidation","updateCustomData","customField","priceBySize","customFields","each","i","el","field","siblings","element"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;;;;;;AAMAA,OAAOC,0BAAP;;;;uCAIsE;MAAzDC,QAAyD,uEAA9C,4CAA8C;;;OAC/DC,SAAL,GAAiBC,EAAE,wBAAF,CAAjB;OACKF,QAAL,GAAgBA,QAAhB;;;;;;;;;mCAKgB;QACXG,yBAAL;QACKC,qBAAL;QACKC,kBAAL;QACKC,gBAAL;;;;qCAEkB;OACZC,UAAUC,IAAIC,kBAAJ,CAAuBX,OAAOY,QAAP,CAAgBC,IAAvC,CAAhB;OACIJ,QAAQK,IAAZ,EAAkB;QACbL,QAAQM,YAAR,KAAyB,KAA7B,EAAoC;UAC9BA,YAAL,CAAkBN,QAAQO,OAA1B,EAAmCP,QAAQQ,UAA3C;KADD,MAEO,IAAIR,QAAQK,IAAR,KAAiB,kBAArB,EAAyC;UAC1CI,gBAAL,CAAsBT,QAAQO,OAA9B,EAAuCP,QAAQQ,UAA/C;;;;;;;;;;uCAOkB;;;OAChBE,cAAc,KAAKhB,SAAL,CAAeiB,IAAf,CAAoB,iBAApB,CAAlB;iBACcD,YAAYE,MAAZ,GAAqBF,WAArB,GAAmCf,EAAE,iBAAF,CAAjD;eAEEkB,EADF,CACK,OADL,EACc,aAAK;QACbC,QAAQnB,EAAEoB,EAAEC,aAAJ,EACVC,GADU,GAEVC,WAFU,EAAZ;UAGKxB,SAAL,CAAeiB,IAAf,CAAoB,6BAApB,EAAmDQ,MAAnD,CAA0D,YAAW;SAChEC,OAAOzB,EAAE,IAAF,EAAQ0B,OAAR,CAAgB,aAAhB,CAAX;SAEC1B,EAAE,IAAF,EACE2B,IADF,GAEEJ,WAFF,GAGEK,OAHF,CAGUT,KAHV,IAGmB,CAAC,CAJrB,EAKE;WACIU,WAAL,CAAiB,QAAjB;MAND,MAOO;WACDC,QAAL,CAAc,QAAd;;KAVF;IALF,EAmBEZ,EAnBF,CAmBK,OAnBL,EAmBc,aAAK;MACfa,eAAF;IApBF;;;;;;;;;8CA2B2B;;;QACtBhC,SAAL,CAAeiB,IAAf,CAAoB,aAApB,EAAmCE,EAAnC,CAAsC,OAAtC,EAA+C,aAAK;QAC7CG,gBAAgBrB,EAAEoB,EAAEC,aAAJ,CAAtB;WACKP,gBAAL,CAAsBO,cAAcW,IAAd,CAAmB,SAAnB,CAAtB,EAAqD,OAAKC,aAAL,CAAmBZ,aAAnB,CAArD;IAFD;;;;;;;;;;;mCAWgBa,WAxElB,EAwE+BrB,UAxE/B,EAwE2C;;;OACrCsB,eAAJ,CACC,IADD,EAEI,KAAKrC,QAFT,mCAE+CoC,WAF/C,IAE6DrB,aAAa,iBAAiBA,UAA9B,GAA2C,EAFxG,GAGC,0BAAkB;mBACFG,IAAf,CAAoB,iBAApB,EAAuCE,EAAvC,CAA0C,OAA1C,EAAmD,aAAK;SACnDkB,eAAJ;YACKzB,YAAL,CAAkBuB,WAAlB,EAA+BrB,UAA/B;KAFD;IAJF;;;;;;;;;0CAeuB;;;QAClBd,SAAL,CAAeiB,IAAf,CAAoB,eAApB,EAAqCE,EAArC,CAAwC,OAAxC,EAAiD,aAAK;MACnDa,eAAF;QACMV,gBAAgBrB,EAAEoB,EAAEC,aAAJ,CAAtB;WACKV,YAAL,CAAkBU,cAAcW,IAAd,CAAmB,SAAnB,CAAlB,EAAiD,OAAKC,aAAL,CAAmBZ,aAAnB,CAAjD;IAHD;;;;;;;;;;;+BAYYa,WArGd,EAqG2BrB,UArG3B,EAqGuC;OACjCsB,eAAJ,CACC,IADD,EAEI,KAAKrC,QAFT,+BAE2CoC,WAF3C,IAEyDrB,aAAa,iBAAiBA,UAA9B,GAA2C,EAFpG,GAGC,KAAKwB,sBAAL,CAA4BC,IAA5B,CAAiC,IAAjC,CAHD;;;;yCAOsBC,cA7GxB,EA6GwC;;;OAChCC,cAAcD,eAAevB,IAAf,CAAoB,yBAApB,CAApB;OACMyB,UAAUF,eAAevB,IAAf,CAAoB,cAApB,CAAhB;kBACeA,IAAf,CAAoB,iBAApB,EAAuCE,EAAvC,CAA0C,OAA1C,EAAmD,aAAK;WAClDwB,qBAAL,CAA2BF,WAA3B,EAAwCC,OAAxC;IADD;OAGID,YAAYvB,MAAhB,EAAwB;gBACX0B,gBAAZ,CAA6BrC,IAAIsC,uBAAjC;gBACY5B,IAAZ,CAAiB,kBAAjB,EAAqC6B,SAArC;;OAEGJ,QAAQxB,MAAZ,EAAoB;YACX0B,gBAAR,CAAyBrC,IAAIsC,uBAA7B;;;;;wCAGoBJ,WA3HvB,EA2HoCC,OA3HpC,EA2H6C;OACvCD,YAAYvB,MAAhB,EAAwB;QACnBuB,YAAYG,gBAAZ,CAA6B,UAA7B,MAA6C,IAAjD,EAAuD;SAClDG,qBAAJ,CAA0BN,YAAY,CAAZ,CAA1B;SACMO,WAAW,IAAIC,QAAJ,CAAaR,YAAY,CAAZ,CAAb,CAAjB;SACMS,SAAS;WACT,WADS;YAER,MAFQ;YAGRF,QAHQ;mBAID,KAJC;mBAKD;MALd;SAOMG,2BAA2BlD,EAAEmD,iBAAF,CAAoB;iBACzC,EAAEC,SAAS,IAAX;MADqB,CAAjC;kBAGa/C,OAAb,CAAqB4C,MAArB,EAA6BI,IAA7B,CAAkC,gBAAQ;UACrCrB,KAAKsB,OAAT,EAAkB;eACTC,MAAR;WACInB,eAAJ;;+BAEwBe,iBAAzB,CAA2C,EAAEzC,MAAM,MAAR,EAA3C;MALD;KAbD,MAoBO;SACF8C,4BAAJ,CAAiChB,WAAjC;;IAtBF,MAwBO;QACFC,QAAQE,gBAAR,CAAyB,UAAzB,MAAyC,IAA7C,EAAmD;UAC7Cc,gBAAL,CAAsBhB,OAAtB;aACQc,MAAR;SACInB,eAAJ;KAHD,MAIO;SACFoB,4BAAJ,CAAiCf,OAAjC;;;;;;;;;;mCAOcA,OAjKlB,EAiK2B;OACrBiB,cAAcjB,QAAQzB,IAAR,CAAa,iBAAb,CAAlB;OACI2C,cAAclB,QAAQzB,IAAR,CAAa,mBAAb,CAAlB;OACI0C,YAAYzC,MAAhB,EAAwB;QACnB2C,eAAenB,QAAQzB,IAAR,CAAa,kBAAb,CAAnB;iBACa6C,IAAb,CAAkB,UAACC,CAAD,EAAIC,EAAJ,EAAW;SACxBC,QAAQhE,EAAE+D,EAAF,CAAZ;iBACYzC,GAAZ,MACIoC,YAAYpC,GAAZ,EADJ,GACwB0C,MAAMhC,IAAN,CAAW,MAAX,CADxB,UAC+CgC,MAAM1C,GAAN,EAD/C,IAC6DsC,aAAa3C,MAAb,GAAsB,CAAtB,KAA4B6C,CAA5B,GAAgC,GAAhC,GAAsC,EADnG;KAFD;;OAOGH,YAAY1C,MAAhB,EAAwB;gBAErBgD,QADF,CACW,yBADX,EAEE3C,GAFF,CAEMqC,YAAY3C,IAAZ,oBAAkC2C,YAAYrC,GAAZ,EAAlC,SAAyDU,IAAzD,CAA8D,KAA9D,CAFN;;;;;;;;;;;;;gCAYYkC,OA1Lf,EA0LwB;OAClBrD,aAAaqD,QAAQxC,OAAR,CAAgB,gBAAhB,CAAjB;UACOb,WAAWI,MAAX,GAAoBJ,WAAWmB,IAAX,CAAgB,YAAhB,CAApB,GAAoD,EAA3D;;;;"}