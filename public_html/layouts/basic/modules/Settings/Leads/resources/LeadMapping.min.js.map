{"version":3,"file":"LeadMapping.min.js","sources":["LeadMapping.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n * Contributor(s): YetiForce.com\n *************************************************************************************/\n'use strict';\n\njQuery.Class(\"Settings_LeadMapping_Js\", {\n\n\t/**\n\t * Function to register event to edit leads mapping\n\t */\n\ttriggerEdit: function (editUrl) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tAppConnector.request(editUrl).done(function (data) {\n\t\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\t\tdetailContentsHolder.html(data);\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\tvar leadMappingInstance = new Settings_LeadMapping_Js();\n\t\t\tleadMappingInstance.registerEventsForEditView();\n\t\t}).fail(function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\n\t/**\n\t * Function to register event for delete lead mapping\n\t */\n\ttriggerDelete: function (event, url) {\n\t\tvar element = jQuery(event.currentTarget);\n\t\tvar mappingContainer = element.closest('.listViewEntries');\n\t\tvar mappingId = mappingContainer.data('cfmid');\n\t\tvar deleteUrl = url + '&mappingId=' + mappingId;\n\t\tAppConnector.request(deleteUrl).done(function (data) {\n\t\t\tvar message = data.result[0];\n\t\t\tvar params = {\n\t\t\t\ttext: message\n\t\t\t};\n\t\t\tif (data.success) {\n\t\t\t\tmappingContainer.remove();\n\t\t\t} else {\n\t\t\t\tparams['type'] = 'error';\n\t\t\t}\n\t\t\tSettings_Vtiger_Index_Js.showMessage(params);\n\t\t});\n\t}\n}, {\n\t/**\n\t * Function to register events for edit view of leads mapping\n\t */\n\tregisterEventsForEditView: function () {\n\t\tvar form = jQuery('#leadsMapping');\n\t\tvar select2Elements = form.find('.select2');\n\t\tApp.Fields.Picklist.showSelect2ElementView(select2Elements);\n\t\tthis.registerEventForAddingNewMapping();\n\t\tthis.registerOnChangeEventForSourceModule();\n\t\tthis.registerEventToDeleteMapping();\n\t\tthis.registerEventForFormSubmit();\n\t\tthis.registerOnChangeEventOfTargetModule();\n\t\tjQuery('select.accountsFields.select2,select.contactFields.select2').trigger('change', false);\n\t},\n\n\t/**\n\t * Function to register event for adding new convert to lead mapping\n\t */\n\tregisterEventForAddingNewMapping: function () {\n\t\tjQuery('#addMapping').on('click', function (e) {\n\t\t\tvar convertLeadMappingTable = jQuery('#convertLeadMapping');\n\t\t\tvar lastSequenceNumber = convertLeadMappingTable.find('tr:not(.newMapping):last[sequence-number]').attr('sequence-number');\n\t\t\tvar newSequenceNumber = parseInt(lastSequenceNumber) + 1;\n\t\t\tvar newMapping = jQuery('.newMapping').clone(true, true);\n\t\t\tnewMapping.attr('sequence-number', newSequenceNumber);\n\t\t\tnewMapping.find('select.leadsFields.newSelect').attr(\"name\", 'mapping[' + newSequenceNumber + '][lead]');\n\t\t\tnewMapping.find('select.accountsFields.newSelect').attr(\"name\", 'mapping[' + newSequenceNumber + '][account]');\n\t\t\tnewMapping.find('select.contactFields.newSelect').attr(\"name\", 'mapping[' + newSequenceNumber + '][contact]');\n\t\t\tnewMapping.removeClass('d-none newMapping');\n\t\t\tnewMapping.appendTo(convertLeadMappingTable);\n\t\t\tnewMapping.find('.newSelect').removeClass('newSelect').addClass('select2');\n\t\t\tvar select2Elements = newMapping.find('.select2');\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(select2Elements);\n\t\t\tjQuery('select.accountsFields.select2,select.contactFields.select2', newMapping).trigger('change', false);\n\t\t})\n\t},\n\n\t/**\n\t * Function to register on change event for select2 element\n\t */\n\tregisterOnChangeEventForSourceModule: function () {\n\t\tvar form = jQuery('#leadsMapping');\n\t\tform.on('change', '.leadsFields', function (e) {\n\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\tvar container = jQuery(element.closest('tr'));\n\t\t\tvar selectedValue = element.val();\n\t\t\tvar selectedOption = element.find('option[value=\"' + selectedValue + '\"]');\n\t\t\tvar selectedDataType = selectedOption.data('type');\n\t\t\tvar accountFieldsSelectElement = container.find('select.accountsFields.select2');\n\t\t\tvar contactFieldsSelectElement = container.find('select.contactFields.select2');\n\n\t\t\tvar accountFieldsBasedOnType = form.find('.newMapping').find('.accountsFields').children().filter('[data-type=\"' + selectedDataType + '\"]').clone(true, true);\n\t\t\tvar contactFieldsBasedOnType = form.find('.newMapping').find('.contactFields').children().filter('option[data-type=\"' + selectedDataType + '\"]').clone(true, true);\n\t\t\tselectedDataType = app.vtranslate(\"JS_\" + selectedDataType);\n\t\t\tcontainer.find('.selectedFieldDataType').html(selectedDataType);\n\n\t\t\tvar noneValue = app.vtranslate('JS_NONE');\n\t\t\taccountFieldsSelectElement.html(accountFieldsBasedOnType);\n\t\t\tcontactFieldsSelectElement.html(contactFieldsBasedOnType);\n\n\t\t\tif (selectedDataType != \"None\") {\n\t\t\t\taccountFieldsSelectElement.prepend('<option data-type=\"' + noneValue + '\" label=\"' + noneValue + '\" value=\"0\" selected>' + noneValue + '</option>');\n\t\t\t\tcontactFieldsSelectElement.prepend('<option data-type=\"' + noneValue + '\" label=\"' + noneValue + '\" value=\"0\" selected>' + noneValue + '</option>');\n\t\t\t}\n\n\t\t\taccountFieldsSelectElement.trigger('change');\n\t\t\tcontactFieldsSelectElement.trigger('change');\n\n\t\t})\n\t},\n\n\t/**\n\t * Function to register event to delete mapping\n\t */\n\tregisterEventToDeleteMapping: function () {\n\t\tvar form = jQuery('#leadsMapping');\n\t\tform.on('click', '.deleteMapping', function (e) {\n\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\tvar mappingContainer = element.closest('tr');\n\t\t\tvar mappingContainerSequenceNumber = mappingContainer.attr('sequence-number');\n\t\t\tvar deletableName = 'mapping[' + mappingContainerSequenceNumber + '][deletable]';\n\t\t\tmappingContainer.prepend('<input type=\"hidden\" name=\"' + deletableName + '\" />')\n\t\t\tmappingContainer.data('deletable', true).hide('slow');\n\t\t\tvar params = {\n\t\t\t\ttext: app.vtranslate('JS_MAPPING_DELETED_SUCCESSFULLY')\n\t\t\t}\n\t\t\tSettings_Vtiger_Index_Js.showMessage(params);\n\t\t});\n\t},\n\n\t/**\n\t * Function to handle edit view convert lead form submit\n\t */\n\tregisterEventForFormSubmit: function () {\n\t\tjQuery('#leadsMapping').on('submit', function (e) {\n\t\t\te.preventDefault();\n\t\t\tvar mappingDetails = jQuery(this).serializeFormData();\n\t\t\tvar params = {\n\t\t\t\t'module': app.getModuleName(),\n\t\t\t\t'parent': app.getParentModuleName(),\n\t\t\t\t'action': 'MappingSave',\n\t\t\t\t'mapping': mappingDetails\n\t\t\t}\n\n\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t'position': 'html',\n\t\t\t\t'blockInfo': {\n\t\t\t\t\t'enabled': true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\tif (data.success) {\n\t\t\t\t\tvar detailViewParams = {\n\t\t\t\t\t\t'module': app.getModuleName(),\n\t\t\t\t\t\t'parent': app.getParentModuleName(),\n\t\t\t\t\t\t'view': 'MappingDetail'\n\t\t\t\t\t};\n\t\t\t\t\tAppConnector.request(detailViewParams).done(function (data) {\n\t\t\t\t\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\t\t\t\t\tdetailContentsHolder.html(data);\n\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tlet notifyParams;\n\t\t\t\tif (!data.result.status) {\n\t\t\t\t\tnotifyParams = {\n\t\t\t\t\t\ttitle: app.vtranslate('JS_INVALID_MAPPING'),\n\t\t\t\t\t\ttext: data.result,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tnotifyParams = {\n\t\t\t\t\t\ttitle: app.vtranslate('JS_MAPPING_SAVED_SUCCESSFULLY'),\n\t\t\t\t\t\ttype: 'info'\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tVtiger_Helper_Js.showPnotify(notifyParams);\n\t\t\t}).fail(function (error) {\n\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t});\n\t\t})\n\t},\n\n\t/**\n\t * Function to register on chnage event of target module\n\t */\n\tregisterOnChangeEventOfTargetModule: function () {\n\t\tvar form = jQuery('#leadsMapping');\n\t\tform.on('change', 'select.accountsFields.select2,select.contactFields.select2', function (e, executeChange) {\n\t\t\tif (typeof executeChange === \"undefined\") {\n\t\t\t\texecuteChange = true;\n\t\t\t}\n\t\t\tvar selectElement = jQuery(e.currentTarget);\n\t\t\tvar selectedValue = selectElement.children().filter('option:selected').text();\n\t\t\tvar selectedOptionId = selectElement.children().filter('option:selected').val();\n\t\t\tvar mappingContainer = selectElement.closest('tr');\n\n\t\t\tvar duplicateOption = false;\n\t\t\tvar existingIdElement;\n\t\t\tif (selectedOptionId == \"0\") {\n\t\t\t\tselectedOptionId = \"false\";\n\t\t\t}\n\n\t\t\tif ((!executeChange) || (selectedOptionId == \"false\")) {\n\t\t\t\tselectElement.attr('selectedId', selectedOptionId);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//check for source module field\n\t\t\tvar sourceModuleSelect = mappingContainer.find('select.leadsFields.select2');\n\t\t\tvar sourceModuleSelectedField = sourceModuleSelect.val();\n\t\t\tvar sourceModuleSelectedFieldLabel = sourceModuleSelect.find('option[value=\"' + sourceModuleSelectedField + '\"]').text();\n\t\t\tif (sourceModuleSelectedField == \"0\") {\n\t\t\t\tduplicateOption = true;\n\t\t\t\tvar errorParams = {\n\t\t\t\t\ttext: app.vtranslate('JS_CANT_MAP') + \" \" + selectedValue + \" \" + app.vtranslate('JS_WITH') + \" \" + sourceModuleSelectedFieldLabel,\n\t\t\t\t\t'type': 'error'\n\t\t\t\t}\n\t\t\t\tSettings_Vtiger_Index_Js.showMessage(errorParams);\n\t\t\t}\n\n\t\t\tif (selectElement.hasClass('accountsFields')) {\n\t\t\t\texistingIdElement = jQuery('select.accountsFields.select2[selectedid=\"' + selectedOptionId + '\"]')\n\t\t\t} else {\n\t\t\t\texistingIdElement = jQuery('select.contactFields.select2[selectedid=\"' + selectedOptionId + '\"]')\n\t\t\t}\n\n\t\t\tif (existingIdElement.length > 0) {\n\t\t\t\tduplicateOption = true;\n\t\t\t}\n\n\t\t\tif (duplicateOption) {\n\t\t\t\tvar selectedFieldId = selectElement.attr('selectedid');\n\t\t\t\tif (selectedFieldId == \"false\") {\n\t\t\t\t\tselectElement.attr('selectedId', \"false\");\n\t\t\t\t} else if (selectedFieldId != \"false\") {\n\t\t\t\t\tselectElement.attr('selectedId', selectedFieldId);\n\t\t\t\t}\n\t\t\t\tvar warningMessage = selectedValue + \" \" + app.vtranslate('JS_IS_ALREADY_BEEN_MAPPED');\n\t\t\t\tvar notificationParams = {\n\t\t\t\t\ttext: warningMessage,\n\t\t\t\t\t'type': 'error'\n\t\t\t\t};\n\t\t\t\tSettings_Vtiger_Index_Js.showMessage(notificationParams);\n\t\t\t\tselectElement.val(0).trigger('change');\n\t\t\t} else {\n\t\t\t\tselectElement.attr('selectedId', selectedOptionId);\n\t\t\t}\n\t\t});\n\t}\n});\n"],"names":["jQuery","Class","editUrl","aDeferred","Deferred","progressIndicatorElement","progressIndicator","request","done","data","html","mode","Settings_LeadMapping_Js","registerEventsForEditView","fail","error","promise","event","url","mappingContainer","currentTarget","closest","deleteUrl","params","result","success","remove","showMessage","select2Elements","find","Fields","Picklist","showSelect2ElementView","registerEventForAddingNewMapping","registerOnChangeEventForSourceModule","registerEventToDeleteMapping","registerEventForFormSubmit","registerOnChangeEventOfTargetModule","trigger","on","e","convertLeadMappingTable","lastSequenceNumber","attr","newSequenceNumber","parseInt","newMapping","clone","removeClass","appendTo","addClass","form","element","container","selectedValue","val","selectedDataType","accountFieldsSelectElement","contactFieldsSelectElement","accountFieldsBasedOnType","children","filter","contactFieldsBasedOnType","app","vtranslate","noneValue","prepend","deletableName","hide","preventDefault","mappingDetails","this","serializeFormData","getModuleName","getParentModuleName","detailViewParams","notifyParams","status","showPnotify","executeChange","selectElement","text","selectedOptionId","duplicateOption","sourceModuleSelect","sourceModuleSelectedField","sourceModuleSelectedFieldLabel","errorParams","hasClass","length","selectedFieldId","notificationParams"],"mappings":"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"}