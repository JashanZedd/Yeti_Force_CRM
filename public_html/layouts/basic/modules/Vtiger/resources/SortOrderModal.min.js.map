{"version":3,"file":"SortOrderModal.min.js","sources":["SortOrderModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n\"use strict\";\n\n$.Class(\n\t\"Base_SortOrderModal_JS\",\n\t{},\n\t{\n\t\t/**\n\t\t * Modal container\n\t\t */\n\t\tcontainer: false,\n\t\t/**\n\t\t * Source container\n\t\t */\n\t\tsourceContainer: false,\n\t\t/**\n\t\t * Modal ID\n\t\t */\n\t\tsource: false,\n\t\t/**\n\t\t * Load data\n\t\t */\n\t\tloadData: function() {\n\t\t\tlet orderBy = this.sourceContainer.find(\"#orderBy\").val();\n\t\t\torderBy = orderBy ? JSON.parse(orderBy) : [];\n\t\t\tif (orderBy && Object.keys(orderBy).length) {\n\t\t\t\tlet baseOrderBy = this.container.find(\".js-base-element\");\n\t\t\t\tfor (let field in orderBy) {\n\t\t\t\t\tif (!baseOrderBy.find(\"option[value='\" + field + \"']\").length) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tlet element = this.addRow();\n\t\t\t\t\telement\n\t\t\t\t\t\t.find(\"select.js-orderBy\")\n\t\t\t\t\t\t.val(field)\n\t\t\t\t\t\t.change();\n\t\t\t\t\tlet sortIcon = element.find(\".js-sort-icon-active\");\n\t\t\t\t\tif (orderBy[field] && sortIcon.data(\"val\") != orderBy[field]) {\n\t\t\t\t\t\tsortIcon.trigger(\"click\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.addRow();\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Add new row\n\t\t */\n\t\taddRow: function() {\n\t\t\tlet sortContainer = this.container\n\t\t\t\t.find(\".js-base-element\")\n\t\t\t\t.clone(true, true)\n\t\t\t\t.removeClass(\"js-base-element\");\n\t\t\tthis.container.find(\".js-sort-container\").append(sortContainer);\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(sortContainer.find(\"select\"));\n\t\t\treturn sortContainer.removeClass(\"d-none\");\n\t\t},\n\t\t/**\n\t\t * Register list events\n\t\t */\n\t\tregisterListEvents: function() {\n\t\t\tthis.container.find(\".js-add\").on(\"click\", e => {\n\t\t\t\tthis.addRow();\n\t\t\t});\n\t\t\tthis.container.find(\".js-clear\").on(\"click\", e => {\n\t\t\t\t$(e.currentTarget)\n\t\t\t\t\t.closest(\".js-sort-container_element\")\n\t\t\t\t\t.remove();\n\t\t\t});\n\t\t\tthis.container.find(\".js-sort-order-button\").on(\"click\", e => {\n\t\t\t\tlet element = $(e.currentTarget).closest(\".js-sort-container_element\");\n\t\t\t\telement.find(\".js-sort-icon\").toggleClass(\"d-none js-sort-icon-active\");\n\t\t\t\telement.find(\".js-sort-order\").val(element.find(\".js-sort-icon-active\").data(\"val\"));\n\t\t\t});\n\t\t\tthis.container.find(\".js-modal__save\").on(\"click\", e => {\n\t\t\t\te.preventDefault;\n\t\t\t\tlet sortData = {};\n\t\t\t\tthis.container.find(\".js-sort-container_element:not(.js-base-element)\").each(function() {\n\t\t\t\t\tlet orderBy = $(this)\n\t\t\t\t\t\t.find(\".js-orderBy\")\n\t\t\t\t\t\t.val();\n\t\t\t\t\tif (orderBy) {\n\t\t\t\t\t\tsortData[orderBy] = $(this)\n\t\t\t\t\t\t\t.find(\".js-sort-order\")\n\t\t\t\t\t\t\t.val();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.sourceContainer.find(\".js-list-reload\").trigger(\"click\", { orderby: sortData });\n\t\t\t\tapp.hideModalWindow(null, this.source);\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Register modal events\n\t\t * @param {jQuery} modalContainer\n\t\t */\n\t\tregisterEvents: function(modalContainer) {\n\t\t\tthis.container = modalContainer;\n\t\t\tthis.source = modalContainer.closest(\".js-modal-container\").attr(\"id\");\n\t\t\tthis.sourceContainer = $(\"[data-modalid=\" + this.source + \"]\").closest(\n\t\t\t\t\".listViewContentDiv,.relatedContainer\"\n\t\t\t);\n\t\t\tthis.registerListEvents();\n\t\t\tthis.loadData();\n\t\t}\n\t}\n);\n"],"names":["$","Class","orderBy","sourceContainer","find","val","JSON","parse","Object","keys","length","baseOrderBy","container","field","element","addRow","change","sortIcon","data","trigger","sortContainer","clone","removeClass","append","Fields","Picklist","showSelect2ElementView","on","e","currentTarget","closest","remove","toggleClass","preventDefault","sortData","each","orderby","hideModalWindow","source","modalContainer","attr","registerListEvents","loadData"],"mappings":"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"}