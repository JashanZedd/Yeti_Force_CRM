'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
  return typeof obj;
} : function (obj) {
  return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
};

$.Class('Vtiger_Edit_Js',{referenceSelectionEvent:'Vtiger.Reference.Selection',referenceDeSelectionEvent:'Vtiger.Reference.DeSelection',recordPreSave:'Vtiger.Record.PreSave',editInstance:!1,inventoryController:!1,getInstanceByModuleName:function f(a){'undefined'==typeof a&&(a=app.getModuleName());var b,c,d,e=app.getParentModuleName();return 'Settings'===e?(b=e+'_'+a+'_Edit_Js','undefined'==typeof window[b]&&(b=a+'_Edit_Js'),c=e+'_Vtiger_Edit_Js','undefined'==typeof window[c]&&(c='Vtiger_Edit_Js')):(b=a+'_Edit_Js',c='Vtiger_Edit_Js'),d='undefined'==typeof window[b]?new window[c]:new window[b],d.moduleName=a,d},getInstance:function b(){if(!1==Vtiger_Edit_Js.editInstance){var a=Vtiger_Edit_Js.getInstanceByModuleName();return Vtiger_Edit_Js.editInstance=a,a}return Vtiger_Edit_Js.editInstance}},{formElement:!1,relationOperation:'',moduleName:app.getModuleName(),getForm:function a(){return !1==this.formElement&&this.setForm($('#EditView')),this.formElement},setForm:function b(a){return this.formElement=a,this},getRecordsListParams:function n(a){var b=app.getModuleName(),c=$('input[name="popupReferenceModule"]',a).val(),d=$('input[class="sourceField"]',a),e=d.attr('name'),f=$('input[name="record"]'),g='';0<f.length&&(g=f.val());var h=!1;!0==d.data('multiple')&&(h=!0);var i={},j=a.closest('form'),k=j.find('input[name="mappingRelatedField"]').val(),l=k?JSON.parse(k):[];null!=l[e]&&null!=l[e][c]&&$.each(l[e][c],function(a){var b=j.find('[name="'+a+'"]');b.length&&''!=b.val()&&(i[a]=b.val());});var m={module:c,src_module:b,src_field:e,src_record:g,filterFields:i};return $.each(['link','process'],function(a,b){var c=j.find('[name="'+b+'"]');c.length&&''!=c.val()&&0!=c.val()&&(m[b]=c.val());}),h&&(m.multi_select=!0),m},showRecordsList:function e(a){var b=this,c=$(a.target).closest('.fieldValue');0>=c.length&&(c=$(a.target).closest('td'));var d=this.getRecordsListParams(c);app.showRecordsList(d,function(a,d){d.setSelectEvent(function(a){b.setReferenceFieldValue(c,a);});});},setReferenceFieldValue:function m(a,b){var c=this,d=a.find('input.sourceField'),e=d.attr('name'),f=a.find('input[name="'+e+'"]'),g=a.find('input[name="'+(e+'_display')+'"]'),h=a.find('input[name="popupReferenceModule"]').val(),i=b.name,j=b.id;if(a.find('.clearReferenceSelection').trigger('click'),f.val(j),g.val(app.decodeHTML(i)).attr('readonly',!0),f.trigger(Vtiger_Edit_Js.referenceSelectionEvent,{source_module:h,record:j,selectedName:i}),g.validationEngine('closePrompt',g),'inventory'==d.data('type'))return b;var k=a.closest('form'),l=this.getMappingRelatedField(e,h,k);if('undefined'!=typeof l){var n={source_module:h,record:j};this.getRecordDetails(n).done(function(a){var b=n.data=a.result.data;app.event.trigger('EditView.SelectReference',n,k),$.each(l,function(d,e){if(0!=b[e[0]]&&!c.getMappingValuesFromUrl(d)){var f=k.find('[name="'+d+'"]'),g=f.data('fieldinfo');f.is('select')?f.find('option[value="'+b[e[0]]+'"]').length&&f.val(b[e[0]]).trigger('change'):0==f.length?$('<input type=\'hidden\'/>').attr('name',d).attr('value',b[e[0]]).appendTo(k):f.val(b[e[0]]);var h=k.find('input[name="'+d+'_display"]');if(0<h.length&&(h.val(a.result.displayData[e[0]]).attr('readonly',!0),'tree'!==g.type)){var i=k.find('#'+c.moduleName+'_editView_fieldName_'+d+'_dropDown');0<i.length&&e[1]&&i.val(e[1]).trigger('change'),c.setReferenceFieldValue(h.closest('.fieldValue'),{name:a.result.displayData[e[0]],id:b[e[0]]});}}});});}},getRelationOperation:function b(){if(''===this.relationOperation){var a=$('[name="relationOperation"]');this.relationOperation=!!a.length&&a.val();}return this.relationOperation},getMappingValuesFromUrl:function c(a){var b=this.getRelationOperation();return !!b&&app.getUrlVar(a)},proceedRegisterEvents:function a(){return !!(0<$('.recordEditView').length)},treePopupRegisterEvent:function b(a){a.on('click','.js-tree-modal',function(a){var b=$(a.target),c=b.closest('.fieldValue'),d=$('input[class="sourceField"]',c),e=$('input[name="'+d.attr('name')+'_display"]',c);AppConnector.request({module:$('input[name="module"]',b.closest('form')).val(),view:'TreeModal',template:d.data('treetemplate'),fieldName:d.attr('name'),multiple:d.data('multiple'),value:d.val()}).done(function(a){app.modalEvents.treeModal=function(a,b){b.setSelectEvent(function(a){d.val(a.id),e.val(a.name).attr('readonly',!0);});},app.showModalWindow(a,{modalId:'treeModal'});});});},registerClearTreeSelectionEvent:function c(a){var b=this;a.find('.clearTreeSelection').on('click',function(a){b.clearFieldValue($(a.currentTarget)),a.preventDefault();});},registerTreeAutoCompleteFields:function b(a){a.find('input.treeAutoComplete').autocomplete({delay:'600',minLength:'3',source:function j(a,b){var c=$(this.element[0]),d=a.term.toLowerCase(),e=c.closest('.fieldValue'),f=$('input[class="sourceField"]',e),g=f.data('fieldinfo'),h=g.picklistvalues,i=[];for(var k in h)0<=h[k].toLowerCase().indexOf(d)&&i.push({label:h[k],value:k,id:k});0>=i.length&&($(c).val(''),i.push({label:app.vtranslate('JS_NO_RESULTS_FOUND'),type:'no results'})),b(i);},select:function i(a,b){var c=b.item;if('undefined'!=typeof c.type&&'no results'==c.type)return !1;c.name=c.value;var d=$(this),e=d.closest('.fieldValue'),f=e.find('input[class="sourceField"]'),g=f.attr('name')+'_display',h=$('input[name="'+g+'"]',e);return f.val(c.id),this.value=c.label,h.attr('readonly',!0),!1},change:function a(){$(this);},open:function a(){$(this).data('ui-autocomplete').menu.element.css('z-index','100001');}});},referenceModulePopupRegisterEvent:function d(a){var b=this;a.on('click','.relatedPopup',function(a){b.showRecordsList(a);});var c=a.find('.referenceModulesList');App.Fields.Picklist.showSelect2ElementView(a.find('.referenceModulesList:visible')),c.on('change',function(a){var b=$(a.currentTarget),c=b.closest('.fieldValue'),d=b.val(),e=$('input[name="popupReferenceModule"]',c),f=e.val();e.val(d),f!=d&&c.find('.clearReferenceSelection').trigger('click');});},getReferencedModuleName:function b(a){return $('input[name="popupReferenceModule"]',a).val()},searchModuleNames:function c(a){var b=$.Deferred();return 'undefined'==typeof a.module&&(a.module=app.getModuleName()),'undefined'==typeof a.action&&(a.action='BasicAjax'),AppConnector.request(a).done(function(a){b.resolve(a);}).fail(function(){b.reject();}),b.promise()},getReferenceSearchParams:function e(a){var b=$(a).closest('.fieldValue'),c={},d=this.getReferencedModuleName(b);return c.search_module=d,c},registerAutoCompleteFields:function c(a){var b=this;a.find('input.autoComplete').autocomplete({delay:'600',minLength:'3',source:function g(a,c){var d=$(this.element[0]),e=a.term,f=b.getReferenceSearchParams(d);f.search_value=e,b.searchModuleNames(f).done(function(a){var b=[],e=a.result;for(var f in 0>=e.length&&($(d).val(''),e=new Array({label:app.vtranslate('JS_NO_RESULTS_FOUND'),type:'no results'})),e){var g=e[f];b.push(g);}c(b);});},select:function g(a,c){var d=c.item;if('undefined'!=typeof d.type&&'no results'==d.type)return !1;d.name=d.value;var e=$(this),f=e.closest('.fieldValue');b.setReferenceFieldValue(f,d);},change:function b(){var a=$(this);a.attr('readonly')==null&&a.closest('.fieldValue').find('.clearReferenceSelection').trigger('click');},open:function a(){$(this).data('ui-autocomplete').menu.element.css('z-index','100001');}});},registerClearReferenceSelectionEvent:function c(a){var b=this;a.on('click','.clearReferenceSelection',function(a){var c=$(a.currentTarget);b.clearFieldValue(c),c.closest('.fieldValue').find('.sourceField').trigger(Vtiger_Edit_Js.referenceDeSelectionEvent),a.preventDefault();});},clearFieldValue:function i(a){var b=this,c=a.closest('.fieldValue'),d=c.find('.sourceField'),e=d.attr('name'),f=c.find('input[name="popupReferenceModule"]').val(),g=c.closest('form');d.val(''),c.find('#'+e+'_display').removeAttr('readonly').val(''),app.event.trigger('EditView.ClearField',{fieldName:e,referenceModule:f});var h=this.getMappingRelatedField(e,f,g);$.each(h,function(a,c){var d=g.find('[name="'+a+'"]');d.is('select')?d.val(d.find('option:first').val()).trigger('change'):d.val('');var e=g.find('input[name="'+a+'_display"]');if(0<e.length){e.val('').attr('readonly',!1);var f=g.find('#'+b.moduleName+'_editView_fieldName_'+a+'_dropDown');0<f.length&&c[1]&&f.val(f.find('option:first').val()).trigger('change');}});},registerPreventingEnterSubmitEvent:function b(a){a.on('keypress',function(a){var b=$(a.target);13!=a.which||b.is('textarea')||a.preventDefault();});},getRecordDetails:function d(a){var b=$.Deferred(),c='index.php?module='+a.source_module+'&action=GetData&record='+a.record;return 'Settings'==app.getParentModuleName()&&(c+='&parent=Settings'),AppConnector.request(c).done(function(a){a.success?b.resolve(a):b.reject(a.message);}).fail(function(){b.reject();}),b.promise()},registerTimeFields:function b(a){app.registerEventForClockPicker(),App.Fields.Date.register(a),App.Fields.DateTime.register(a);},referenceCreateHandler:function h(a){var b=this,c={callbackFunction:function d(c){b.setReferenceFieldValue(a,{name:c.result._recordLabel,id:c.result._recordId});}};if('Edit'===app.getViewName()&&!app.getRecordId()){var d=this.getForm(),e=d.serializeFormData();for(var f in e)e[f]&&-1==$.inArray(f,['__vtrftk','action'])||delete e[f];c.data={},c.data.sourceRecordData=e;}var g=this.getReferencedModuleName(a);Vtiger_Header_Js.getInstance().quickCreateModule(g,c);},registerReferenceCreate:function c(a){var b=this;a.on('click','.createReferenceRecord',function(a){var c=$(a.currentTarget),d=c.closest('.fieldValue');b.referenceCreateHandler(d);});},addressFieldsMapping:['buildingnumber','localnumber','addresslevel1','addresslevel2','addresslevel3','addresslevel4','addresslevel5','addresslevel6','addresslevel7','addresslevel8','pobox'],addressFieldsMappingBlockID:{LBL_ADDRESS_INFORMATION:'a',LBL_ADDRESS_MAILING_INFORMATION:'b',LBL_ADDRESS_DELIVERY_INFORMATION:'c'},addressFieldsData:!1,registerEventForCopyAddress:function g(){var a=this,b=this.getForm(),c=!1,d=!1,e=!1,f=!1;$('#EditView .js-toggle-panel:not(.inventoryHeader):not(.inventoryItems) .fieldValue, #EditView .js-toggle-panel:not(.inventoryHeader):not(.inventoryItems) .fieldLabel').each(function(){var a=$(this),b=!1,g=a.find('[name="popupReferenceModule"]').val();'Accounts'==g&&(c=a.find('.sourceField').attr('name')),'Contacts'==g&&(d=a.find('.sourceField').attr('name')),'Leads'==g&&(e=a.find('.sourceField').attr('name')),'Vendors'==g&&(f=a.find('.sourceField').attr('name')),b=a.find('.referenceModulesList'),0<b.length&&$.each(b.find('option'),function(b,g){'Accounts'==g.value&&(c=a.find('.sourceField').attr('name')),'Contacts'==g.value&&(d=a.find('.sourceField').attr('name')),'Leads'==g.value&&(e=a.find('.sourceField').attr('name')),'Vendors'==g.value&&(f=a.find('.sourceField').attr('name'));});}),!1==c?$('.copyAddressFromAccount').addClass('d-none'):$('.copyAddressFromAccount').on('click',function(){var b=$(this),d=b.closest('.js-toggle-panel'),e=b.data('label'),f=d.data('label'),g=$('[name="'+c+'"]').val();if(''==g||'0'==g)Vtiger_Helper_Js.showPnotify(app.vtranslate('JS_PLEASE_SELECT_AN_ACCOUNT_TO_COPY_ADDRESS'));else{var h=$('#'+c+'_display').val();a.copyAddressDetails(e,f,{record:g,selectedName:h,source_module:'Accounts'},b.closest('.js-toggle-panel')),b.attr('checked','checked');}}),!1==d?$('.copyAddressFromContact').addClass('d-none'):$('.copyAddressFromContact').on('click',function(){var b=$(this),c=b.closest('.js-toggle-panel'),e=b.data('label'),f=c.data('label'),g=$('[name="'+d+'"]').val();if(''==g||'0'==g)Vtiger_Helper_Js.showPnotify(app.vtranslate('JS_PLEASE_SELECT_AN_CONTACT_TO_COPY_ADDRESS'));else{var h=$('#'+d+'_display').val();a.copyAddressDetails(e,f,{record:g,selectedName:h,source_module:'Contacts'},b.closest('.js-toggle-panel')),b.attr('checked','checked');}}),!1==e?$('.copyAddressFromLead').addClass('d-none'):$('.copyAddressFromLead').on('click',function(){var b=$(this),c=b.closest('.js-toggle-panel'),d=b.data('label'),f=c.data('label'),g=$('[name="'+e+'"]').val();if(''==g||'0'==g)Vtiger_Helper_Js.showPnotify(app.vtranslate('JS_PLEASE_SELECT_AN_LEAD_TO_COPY_ADDRESS'));else{var h=$('#'+e+'_display').val();a.copyAddressDetails(d,f,{record:g,selectedName:h,source_module:'Leads'},b.closest('.js-toggle-panel')),b.attr('checked','checked');}}),!1==f?$('.copyAddressFromVendor').addClass('d-none'):$('.copyAddressFromVendor').on('click',function(){var b=$(this),c=b.closest('.js-toggle-panel'),d=b.data('label'),e=c.data('label'),g=$('[name="'+f+'"]').val();if(''==g||'0'==g)Vtiger_Helper_Js.showPnotify(app.vtranslate('JS_PLEASE_SELECT_AN_VENDOR_TO_COPY_ADDRESS'));else{var h=$('#'+f+'_display').val();a.copyAddressDetails(d,e,{record:g,selectedName:h,source_module:'Vendors'},b.closest('.js-toggle-panel')),b.attr('checked','checked');}}),$('#EditView .js-toggle-panel').each(function(){var a=!0;$(this).find('.adressAction button').each(function(){!1==$(this).hasClass('d-none')&&(a=!1);}),a&&$(this).find('.copyAddressLabel').addClass('d-none');}),$('.copyAddressFromMain').on('click',function(){var b=$(this),c=b.closest('.js-toggle-panel'),d=b.data('label'),e=c.data('label');a.copyAddress(d,e,!1,!1);}),$('.copyAddressFromMailing').on('click',function(){var b=$(this),c=b.closest('.js-toggle-panel'),d=b.data('label'),e=c.data('label');a.copyAddress(d,e,!1,!1);}),$('.copyAddressFromDelivery').on('click',function(){var b=$(this),c=b.closest('.js-toggle-panel'),d=b.data('label'),e=c.data('label');a.copyAddress(d,e,!1,!1);});},copyAddressDetails:function f(a,b,c){var d=this,e=c.source_module;d.getRecordDetails(c).done(function(c){var f=c.result;d.addressFieldsData=f,d.copyAddress(a,b,!0,e);});},copyAddress:function q(a,b,c,d){var e=this,f=this.getForm(),g=!1,h=this.addressFieldsMapping,i=this.addressFieldsMappingBlockID,j=i[a];(!1===c||!1===d)&&(j=i[a]);var k,l,m,n,o,p=i[b];for(k in h){n=h[k]+j,o=h[k]+p,c?(l=e.addressFieldsData.data[n],m=e.addressFieldsData.displayData[n]):(l=f.find('[name="'+n+'"]').val(),m=f.find('[name="'+n+'_display"]').val());var r=f.find('[name="'+o+'"]'),s=f.find('[name="'+o+'_display"]');''!==l&&'0'!==l&&l!==void 0?(0<s.length&&s.attr('readonly',!0),g=!0,r.val(l),s.val(m),r.is('[data-select2-id]')&&r.trigger('change')):r.attr('readonly',!1);}if(!1==g){var t;t='Accounts'===d?'JS_SELECTED_ACCOUNT_DOES_NOT_HAVE_AN_ADDRESS':'Contacts'===d?'JS_SELECTED_CONTACT_DOES_NOT_HAVE_AN_ADDRESS':'JS_DOES_NOT_HAVE_AN_ADDRESS',Vtiger_Helper_Js.showPnotify(app.vtranslate(t));}},registerReferenceSelectionEvent:function d(a){var b=this,c=a.find('input[name*=\'addresslevel\']');c.on(Vtiger_Edit_Js.referenceSelectionEvent,function(a,c){var d=$(a.currentTarget).closest('.js-toggle-panel');b.copyAddressDetailsRef(c,d);});},copyAddressDetailsRef:function d(a,b){var c=this;c.getRecordDetails(a).done(function(a){var d=a.result;c.mapAddressDetails(d,b);}).fail(function(){});},mapAddressDetails:function d(a,b){for(var c in a)-1!=c.indexOf('addresslevel')&&(0!=b.find('[name="'+c+'"]').length&&(b.find('[name="'+c+'"]').val(a.data[c]),b.find('[name="'+c+'"]').attr('readonly',!0),b.find('[name="'+c+'_display"]').val(a.displayData[c]),b.find('[name="'+c+'_display"]').attr('readonly',!0)),0!=b.find('[name="'+c+'a"]').length&&0==b.find('[name="'+c+'a"]').val()&&0!=a.data[c]&&(b.find('[name="'+c+'a"]').val(a.data[c]),b.find('[name="'+c+'a"]').attr('readonly',!0),b.find('[name="'+c+'a_display"]').val(a.displayData[c]),b.find('[name="'+c+'a_display"]').attr('readonly',!0)),0!=b.find('[name="'+c+'b"]').length&&0==b.find('[name="'+c+'b"]').val()&&0!=a.data[c]&&(b.find('[name="'+c+'b"]').val(a.data[c]),b.find('[name="'+c+'b"]').attr('readonly',!0),b.find('[name="'+c+'b_display"]').val(a.displayData[c]),b.find('[name="'+c+'b_display"]').attr('readonly',!0)),0!=b.find('[name="'+c+'c"]').length&&0==b.find('[name="'+c+'c"]').val()&&0!=a.data[c]&&(b.find('[name="'+c+'c"]').val(a.data[c]),b.find('[name="'+c+'c"]').attr('readonly',!0),b.find('[name="'+c+'c_display"]').val(a.displayData[c]),b.find('[name="'+c+'c_display"]').attr('readonly',!0)));},registerMaskFields:function b(a){a.find('[data-inputmask]').inputmask();},triggerDisplayTypeEvent:function c(){var a=app.cacheGet('widthType','narrowWidthType');if(a){var b=$('#EditView').find('.fieldValue,.fieldLabel');b.addClass(a);}},registerSubmitEvent:function b(){var a=this.getForm();a.on('submit',function(b){if('undefined'!=typeof a.data('submit'))return !1;document.progressLoader=$.progressIndicator({message:app.vtranslate('JS_SAVE_LOADER_INFO'),position:'html',blockInfo:{enabled:!0}}),a.find('.js-toggle-panel').find('.js-block-content').removeClass('d-none');$(b.currentTarget).find('[name="module"]').val();if(a.validationEngine('validate')){a.data('submit','true');var c=$.Event(Vtiger_Edit_Js.recordPreSave);a.trigger(c,{value:'edit'}),c.isDefaultPrevented()&&(document.progressLoader.progressIndicator({mode:'hide'}),a.removeData('submit'),b.preventDefault());}else document.progressLoader.progressIndicator({mode:'hide'}),a.removeData('submit'),app.formAlignmentAfterValidation(a);});},registerRecordPreSaveEventEvent:function b(a){a.on(Vtiger_Edit_Js.recordPreSave,function(){});},registerEventForPicklistDependencySetup:function h(a){var b=$('[name="picklistDependency"]',a);if(!(0>=b.length)){var c=JSON.parse(b.val()),d=Object.keys(c);if(!(0>=d.length)){var e,f=[];for(e=0;e<d.length;e++)f.push('[name="'+d[e]+'"]');f=f.join(',');var g=a.find(f);g.on('change',function(b){var d=$(b.currentTarget),f=c[d.attr('name')],g=f[d.val()],h=f.__DEFAULT__;'undefined'==typeof g&&(g=h),$.each(h,function(b,c){var d=g[b];'undefined'==typeof d&&(d=c);var f=$('[name="'+b+'"]',a);if(!(0>=f.length)){var h=f.data('availableOptions');'undefined'==typeof h&&(h=$('option',f),f.data('available-options',h));var j=new $,k=[];for(k.push(''),e=0;e<d.length;e++)k.push(d[e]);$.each(h,function(a,b){-1!==$.inArray($(b).val(),k)&&(j=j.add($(b)));}),f.html(j).val(j.filter('[selected]').val()).trigger('change');}});}),g.trigger('change');}}},registerLeavePageWithoutSubmit:function c(a){var b=a.serialize();window.onbeforeunload=function(){if(b!=a.serialize()&&'true'!=a.data('submit'))return app.vtranslate('JS_CHANGES_WILL_BE_LOST')};},stretchCKEditor:function c(){var a=$('.js-editor').parents('.fieldRow'),b=$('.js-editor').parent();$(a).find('.fieldLabel').remove(),$(b).removeClass('col-md-10'),$(b).addClass('col-md-12');},registerEventForEditor:function c(){var a=this.getForm(),b=this;$.each(a.find('.js-editor'),function(a,c){b.loadEditorElement($(c));});},loadEditorElement:function c(a){var b={};a.is(':visible')&&(a.hasClass('js-editor--basic')&&(b.toolbar='Min'),a.data('height')&&(b.height=a.data('height')),new App.Fields.Text.Editor(a,b));},registerHelpInfo:function b(){var a=this.getForm();app.showPopoverElementView(a.find('.js-help-info'));},registerBlockAnimationEvent:function c(){var a=this,b=this.getForm();b.on('click','.blockHeader',function(b){var c=$(b.target);if(c.is('input')||c.is('button')||c.parents().is('button')||c.hasClass('js-stop-propagation')||c.parents().hasClass('js-stop-propagation'))return !1;var d=$(b.currentTarget).find('.js-block-toggle').not('.d-none'),e=d.data('id'),f=d.closest('.js-toggle-panel'),g=f.find('.blockContent'),h=d.data(),i=app.getModuleName();'show'==h.mode?(function a(){g.addClass('d-none'),app.cacheSet(i+'.'+e,0);}(),d.addClass('d-none'),f.find('[data-mode="hide"]').removeClass('d-none')):(function b(){g.removeClass('d-none'),a.registerEventForEditor(g),app.cacheSet(i+'.'+e,1);}(),d.addClass('d-none'),f.find('[data-mode=\'show\']').removeClass('d-none'));});},registerBlockStatusCheckOnLoad:function c(){var a=this.getForm().find('.js-toggle-panel'),b=app.getModuleName();a.each(function(a,c){var d=$(c),e=d.attr('data-dynamic');if(('undefined'==typeof e?'undefined':_typeof(e))!=='undefined'&&!1!==e){var f=d.find('.js-block-toggle').not('.d-none'),g=d.find('.blockContent'),h=f.data('id'),i=app.cacheGet(b+'.'+h,null);null!=i&&(1==i?(f.addClass('d-none'),d.find('[data-mode=\'show\']').removeClass('d-none'),g.removeClass('d-none')):(f.addClass('d-none'),d.find('[data-mode=\'hide\']').removeClass('d-none'),g.addClass('d-none')));}});},registerAutoloadAddress:function a(){this.getForm().find('.js-search-address').each(function(a,b){var c=$(b),d=c.closest('.js-block-content'),e=c.find('.js-autoload-address');c.find('.js-select-operator').on('click',function(){e.data('type',$(this).data('type'));}),e.autocomplete({source:function c(a,b){AppConnector.request({module:app.getModuleName(),action:'Fields',mode:'findAddress',type:e.data('type'),value:a.term}).done(function(a){!1===a.result?Vtiger_Helper_Js.showPnotify(app.vtranslate('JS_ERROR')):a.result.length?b(a.result):b([{label:app.vtranslate('JS_NO_RESULTS_FOUND'),value:''}]);}).fail(function(){b([{label:app.vtranslate('JS_NO_RESULTS_FOUND'),value:''}]);});},minLength:e.data('min'),select:function c(a,b){$.each(b.item.address,function(a,b){var c=d.find('.fieldValue [name^='+a+']');c.length&&b?('object'!==('undefined'==typeof b?'undefined':_typeof(b))&&(b=[b]),$.each(b,function(a,b){var d=!1,e=!1;'SELECT'===c.prop('tagName')?'object'===('undefined'==typeof b?'undefined':_typeof(b))?$.each(b,function(a,b){e=c.find('option[data-'+a+'=\''+b+'\']'),b&&e.length&&(d=e.val());}):(e=c.find('option:contains('+b+')'),b&&e.length&&(d=e.val()),e=c.find('option[value="'+b+'"]'),b&&e.length&&(d=e.val())):d=b,d&&c.val(d).change();})):c.val('').change();}),b.item.value=e.val();}});});},setEnabledFields:function f(a){var b=a.closest('.fieldValue'),c=b.find('input.sourceField').attr('name'),d=b.find('#'+c+'_display');b.find('button').removeAttr('disabled'),''==d.val()&&b.find('input').removeAttr('readonly'),b.find('.referenceModulesListGroup').removeClass('d-none');var e=d.attr('placeholderDisabled');d.removeAttr('placeholderDisabled'),d.attr('placeholder',e),b.find('.referenceModulesList').attr('required','required');},setDisabledFields:function f(a){var b=a.closest('.fieldValue'),c=b.find('input.sourceField').attr('name'),d=b.find('#'+c+'_display');b.find('input').attr('readonly','readonly'),b.find('button').attr('disabled','disabled'),b.find('.referenceModulesListGroup').addClass('d-none');var e=d.attr('placeholder');d.removeAttr('placeholder'),d.attr('placeholderDisabled',e),b.find('.referenceModulesList').removeAttr('required');},getMappingRelatedField:function f(a,b,c){var d=c.find('input[name="mappingRelatedField"]').val(),e=d?JSON.parse(d):[];return 'undefined'!=typeof e[a]&&'undefined'!=typeof e[a][b]?e[a][b]:[]},registerValidationsFields:function d(a){var c=app.validationEngineOptionsForRecord;a.validationEngine(c);},checkReferencesField:function f(a,b){var c=this,d=!1,e=!1;return !!CONFIG.fieldsReferencesDependent&&void(a.find('input[data-fieldtype="referenceLink"]').each(function(a,b){b=$(b);var c=!0;0<b.closest('.tab-pane').length&&(c=!1,0<b.closest('.tab-pane.active').length&&(c=!0));var e=b.val();c&&''!=e&&'0'!=e&&(d=!0);}),a.find('input[data-fieldtype="referenceProcess"]').each(function(a,f){f=$(f),d?c.setEnabledFields(f):(b&&c.clearFieldValue(f),c.setDisabledFields(f));var g=!0;0<f.closest('.tab-pane').length&&(g=!1,0<f.closest('.tab-pane.active').length&&(g=!0));var h=f.val();g&&''!=h&&'0'!=h&&(e=!0);}),a.find('input[data-fieldtype="referenceSubProcess"]').each(function(a,d){d=$(d);var f=d.closest('.fieldValue'),g=f.find('.referenceModulesList option[disabled!="disabled"]').length;e&&0<g?c.setEnabledFields(d):(b&&c.clearFieldValue(d),c.setDisabledFields(d));}))},checkSubProcessModulesList:function c(a){var b=a.find('option:selected');1==b.data('is-quickcreate')?a.closest('.fieldValue').find('.createReferenceRecord').removeClass('d-none'):a.closest('.fieldValue').find('.createReferenceRecord').addClass('d-none');},checkReferenceModulesList:function g(a){var b=this,c=a.find('input[data-fieldtype="referenceProcess"]').closest('.fieldValue'),d=c.find('input[name="popupReferenceModule"]').val(),e=a.find('input[data-fieldtype="referenceSubProcess"]').closest('.fieldValue');Vtiger_Helper_Js.hideOptions(e.find('.referenceModulesList'),'parent',d);var f=e.find('.referenceModulesList').val();e.find('[name="popupReferenceModule"]').val(f),b.checkSubProcessModulesList(e.find('.referenceModulesList'));},registerReferenceFields:function c(a){var b=this;return !!CONFIG.fieldsReferencesDependent&&void(b.checkReferenceModulesList(a),b.checkReferencesField(a,!1),a.find('.sourceField').on(Vtiger_Edit_Js.referenceSelectionEvent,function(){b.checkReferencesField(a,!0);}),a.find('.sourceField').on(Vtiger_Edit_Js.referenceDeSelectionEvent,function(){b.checkReferencesField(a,!0);}),a.find('input[data-fieldtype="referenceProcess"]').closest('.fieldValue').find('.referenceModulesList').on('change',function(){b.checkReferenceModulesList(a);}),a.find('input[data-fieldtype="referenceSubProcess"]').closest('.fieldValue').find('.referenceModulesList').on('change',function(a){b.checkSubProcessModulesList($(a.currentTarget));}))},registerFocusFirstField:function b(a){a.find('.fieldValue input.form-control:not([type=hidden],[type=checkbox])').each(function(a,b){var c=$(b);if(!c.prop('readonly')&&!c.prop('disabled')){c=c.get(0);var d=c.value.length;return c.selectionStart=d,c.selectionEnd=d,c.focus(),!1}});},registerCopyValue:function b(a){a.find('.fieldValue [data-copy-to-field]').on('change',function(b){var c=$(b.currentTarget);a.find('[name="'+c.data('copyToField')+'"]').val(c.val());});},registerMultiImageFields:function b(a){return App.Fields.MultiImage.register(a)},registerInventoryController:function b(a){'undefined'!=typeof Vtiger_Inventory_Js&&(this.inventoryController=Vtiger_Inventory_Js.getInventoryInstance(a));},registerBasicEvents:function b(a){this.treePopupRegisterEvent(a),this.registerClearTreeSelectionEvent(a),this.registerTreeAutoCompleteFields(a),this.referenceModulePopupRegisterEvent(a),this.registerAutoCompleteFields(a),this.registerClearReferenceSelectionEvent(a),this.registerPreventingEnterSubmitEvent(a),this.registerTimeFields(a),this.registerEventForPicklistDependencySetup(a),this.registerRecordPreSaveEventEvent(a),this.registerReferenceSelectionEvent(a),this.registerMaskFields(a),this.registerHelpInfo(),this.registerReferenceFields(a),this.registerFocusFirstField(a),this.registerCopyValue(a),this.registerMultiImageFields(a),App.Fields.MultiEmail.register(a);},registerEvents:function c(){var a=this.getForm(),b=this.proceedRegisterEvents();b&&(this.registerInventoryController(a),this.registerBlockAnimationEvent(),this.registerBlockStatusCheckOnLoad(),this.registerEventForEditor(),this.stretchCKEditor(),this.registerBasicEvents(a),this.registerEventForCopyAddress(),this.registerSubmitEvent(),this.registerLeavePageWithoutSubmit(a),this.registerValidationsFields(a),this.registerReferenceCreate(a),this.registerAutoloadAddress());}});
//# sourceMappingURL=Edit.min.js.map
