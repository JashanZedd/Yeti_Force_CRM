{"version":3,"file":"PDF.min.js","sources":["PDF.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class('Vtiger_PDF_Js', {\n\t/**\n\t * Proceed form submission\n\t */\n\tproceedSubmit(mode) {\n\t\tconst loader = $.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_PDF_GENERATING'),\n\t\t\tposition: 'html',\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tswitch (mode) {\n\t\t\tcase 'generate_pdf':\n\t\t\t\tbreak;\n\t\t\tcase 'single_pdf':\n\t\t\t\tthis.container.find('[name=\"single_pdf\"]').val(1);\n\t\t\t\tthis.container.find('#pdfExportModal').submit();\n\t\t\t\tbreak;\n\t\t\tcase 'email_pdf':\n\t\t\t\tthis.container.find('[name=\"email_pdf\"]').val(1);\n\t\t\t\tthis.container.find('#pdfExportModal').submit();\n\t\t\t\tbreak;\n\t\t}\n\t\tloader.progressIndicator({ mode: 'hide' });\n\t\tapp.hideModalWindow();\n\t},\n\n\t/*\n\t * Function to register the click event for generate button\n\t */\n\tregisterPreSubmitEvent: function(container) {\n\t\tconst self = this;\n\t\tcontainer.find('#generate_pdf, #single_pdf, #email_pdf').on('click', e => {\n\t\t\tself.proceedSubmit.apply(self, [$(e.currentTarget).attr('id')]);\n\t\t});\n\t},\n\n\t/**\n\t * Register list view check records\n\t *\n\t * @param   {jQuery}  container\n\t */\n\tregisterListViewCheckRecords(container) {\n\t\tlet templateElements = container.find('[name=\"pdf_template[]\"]');\n\t\ttemplateElements.on('change', function() {\n\t\t\tdocument.progressLoader = $.progressIndicator({\n\t\t\t\tmessage: app.vtranslate('JS_PDF_RECALCULATING'),\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tlet templateContainer = $(this).closest('.js-pdf-template-content');\n\t\t\ttemplateContainer.find('.js-pdf-user-variable').toggleClass('d-none');\n\n\t\t\tlet templates = [];\n\t\t\ttemplateElements.filter(':checked').each(function() {\n\t\t\t\ttemplates.push($(this).val());\n\t\t\t});\n\n\t\t\tlet params = container.find('form').serializeFormData();\n\t\t\tparams.mode = 'validateRecords';\n\t\t\tparams.templates = templates;\n\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tvar response = data.result;\n\t\t\t\t\tif (data.success) {\n\t\t\t\t\t\tlet valid = response.valid;\n\t\t\t\t\t\tlet info = container\n\t\t\t\t\t\t\t.find('.js-records-info')\n\t\t\t\t\t\t\t.text(response.message)\n\t\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\t\tif (valid) {\n\t\t\t\t\t\t\tinfo.addClass('d-none');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tdocument.progressLoader.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t}, 500);\n\n\t\t\t\t\t\tcontainer.find('.js-submit-button').each(function() {\n\t\t\t\t\t\t\t$(this).attr('disabled', !valid);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fail(function(data, err) {\n\t\t\t\t\tapp.errorLog(data, err);\n\t\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Register select custom columns change\n\t */\n\tregisterSelectCustomColumnsChange() {\n\t\tthis.container.find('[name=\"isCustomMode\"]').on('change', ev => {\n\t\t\tif ($(ev.target).is(':checked')) {\n\t\t\t\tthis.container.find('[name=\"inventoryColumns[]\"]').prop('disabled', null);\n\t\t\t\tthis.container.find('.js-save-scheme').prop('disabled', null);\n\t\t\t} else {\n\t\t\t\tthis.container.find('[name=\"inventoryColumns[]\"]').prop('disabled', 'disabled');\n\t\t\t\tthis.container.find('.js-save-scheme').prop('disabled', 'disabled');\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Register save scheme button click\n\t */\n\tregisterSaveInventoryColumnSchemeClick() {\n\t\tthis.container.find('.js-save-scheme').on('click', e => {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tconst loader = $.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tlet params = this.container.find('form').serializeFormData();\n\t\t\tparams.mode = 'saveInventoryColumnScheme';\n\t\t\tparams.isCustomMode = this.container.find('[name=\"isCustomMode\"]').is(':checked');\n\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tconst response = data['result'];\n\t\t\t\t\tif (data['success']) {\n\t\t\t\t\t\tloader.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t}\n\t\t\t\t\tif (response['message'] && data['success']) {\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: response['message'],\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fail(function(data, err) {\n\t\t\t\t\tapp.errorLog(data, err);\n\t\t\t\t});\n\t\t});\n\t},\n\t/**\n\t * Register events\n\t */\n\tregisterEvents() {\n\t\tconst container = (this.container = $('#pdfExportModal').closest('.js-modal-container'));\n\t\tthis.dynamicTemplatesCount = 0;\n\t\tthis.recordId = parseInt(container.find('[name=\"record\"]').val());\n\t\tthis.registerPreSubmitEvent(container);\n\t\tthis.registerSaveInventoryColumnSchemeClick();\n\t\tthis.registerSelectCustomColumnsChange();\n\t\tthis.registerListViewCheckRecords(container);\n\t}\n});\n$(function() {\n\tnew Vtiger_PDF_Js().registerEvents();\n});\n"],"names":["$","Class","mode","loader","progressIndicator","app","vtranslate","container","find","val","submit","hideModalWindow","self","on","proceedSubmit","apply","e","currentTarget","attr","templateElements","progressLoader","templateContainer","closest","toggleClass","templates","filter","each","push","params","serializeFormData","request","done","data","response","result","success","valid","info","text","message","removeClass","addClass","fail","err","errorLog","ev","target","is","prop","preventDefault","stopPropagation","isCustomMode","showNotify","dynamicTemplatesCount","recordId","parseInt","registerPreSubmitEvent","registerSaveInventoryColumnSchemeClick","registerSelectCustomColumnsChange","registerListViewCheckRecords","Vtiger_PDF_Js","registerEvents"],"mappings":"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"}