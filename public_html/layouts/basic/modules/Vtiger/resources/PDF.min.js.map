{"version":3,"file":"PDF.min.js","sources":["PDF.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class('Vtiger_PDF_Js', {\n\t/**\n\t * Proceed form submission\n\t */\n\tproceedSubmit(mode) {\n\t\tconst loader = $.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_PDF_GENERATING'),\n\t\t\tposition: 'html',\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tswitch (mode) {\n\t\t\tcase 'generate_pdf':\n\t\t\t\tbreak;\n\t\t\tcase 'single_pdf':\n\t\t\t\tthis.container.find('[name=\"single_pdf\"]').val(1);\n\t\t\t\tthis.container.find('#pdfExportModal').submit();\n\t\t\t\tbreak;\n\t\t\tcase 'email_pdf':\n\t\t\t\tthis.container.find('[name=\"email_pdf\"]').val(1);\n\t\t\t\tthis.container.find('#pdfExportModal').submit();\n\t\t\t\tbreak;\n\t\t}\n\t\tloader.progressIndicator({ mode: 'hide' });\n\t\tapp.hideModalWindow();\n\t},\n\n\t/*\n\t * Function to register the click event for generate button\n\t */\n\tregisterPreSubmitEvent: function(container) {\n\t\tconst self = this;\n\t\tcontainer.find('#generate_pdf, #single_pdf, #email_pdf').on('click', e => {\n\t\t\tself.proceedSubmit.apply(self, [$(e.currentTarget).attr('id')]);\n\t\t});\n\t},\n\n\t/**\n\t * Register list view check records\n\t *\n\t * @param   {jQuery}  container\n\t */\n\tregisterListViewCheckRecords(container) {\n\t\tlet templateElements = container.find('[name=\"pdf_template[]\"]');\n\t\ttemplateElements.on('change', function() {\n\t\t\tdocument.progressLoader = $.progressIndicator({\n\t\t\t\tmessage: app.vtranslate('JS_PDF_RECALCULATING'),\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tlet templateContainer = $(this).closest('.js-pdf-template-content');\n\t\t\ttemplateContainer.find('.js-pdf-user-variable').toggleClass('d-none');\n\n\t\t\tlet templates = [];\n\t\t\ttemplateElements.filter(':checked').each(function() {\n\t\t\t\ttemplates.push($(this).val());\n\t\t\t});\n\n\t\t\tlet params = container.find('form').serializeFormData();\n\t\t\tparams.mode = 'validateRecords';\n\t\t\tparams.templates = templates;\n\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tvar response = data.result;\n\t\t\t\t\tif (data.success) {\n\t\t\t\t\t\tlet valid = response.valid;\n\t\t\t\t\t\tlet info = container\n\t\t\t\t\t\t\t.find('.js-records-info')\n\t\t\t\t\t\t\t.text(response.message)\n\t\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\t\tif (valid) {\n\t\t\t\t\t\t\tinfo.addClass('d-none');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tdocument.progressLoader.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t}, 500);\n\n\t\t\t\t\t\tcontainer.find('.js-submit-button').each(function() {\n\t\t\t\t\t\t\t$(this).attr('disabled', !valid);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fail(function(data, err) {\n\t\t\t\t\tapp.errorLog(data, err);\n\t\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Register select custom columns change\n\t */\n\tregisterSelectCustomColumnsChange() {\n\t\tthis.container.find('[name=\"isCustomMode\"]').on('change', ev => {\n\t\t\tif ($(ev.target).is(':checked')) {\n\t\t\t\tthis.container.find('[name=\"inventoryColumns[]\"]').prop('disabled', null);\n\t\t\t\tthis.container.find('.js-save-scheme').prop('disabled', null);\n\t\t\t} else {\n\t\t\t\tthis.container.find('[name=\"inventoryColumns[]\"]').prop('disabled', 'disabled');\n\t\t\t\tthis.container.find('.js-save-scheme').prop('disabled', 'disabled');\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Register save scheme button click\n\t */\n\tregisterSaveInventoryColumnSchemeClick() {\n\t\tthis.container.find('.js-save-scheme').on('click', e => {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tconst loader = $.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tlet params = this.container.find('form').serializeFormData();\n\t\t\tparams.mode = 'saveInventoryColumnScheme';\n\t\t\tparams.isCustomMode = this.container.find('[name=\"isCustomMode\"]').is(':checked');\n\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tconst response = data['result'];\n\t\t\t\t\tif (data['success']) {\n\t\t\t\t\t\tloader.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t}\n\t\t\t\t\tif (response['message'] && data['success']) {\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: response['message'],\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fail(function(data, err) {\n\t\t\t\t\tapp.errorLog(data, err);\n\t\t\t\t});\n\t\t});\n\t},\n\t/**\n\t * Register events\n\t */\n\tregisterEvents() {\n\t\tconst container = (this.container = $('#pdfExportModal').closest('.js-modal-container'));\n\t\tthis.dynamicTemplatesCount = 0;\n\t\tthis.recordId = parseInt(container.find('[name=\"record\"]').val());\n\t\tthis.registerPreSubmitEvent(container);\n\t\tthis.registerSaveInventoryColumnSchemeClick();\n\t\tthis.registerSelectCustomColumnsChange();\n\t\tthis.registerListViewCheckRecords(container);\n\t}\n});\n$(function() {\n\tnew Vtiger_PDF_Js().registerEvents();\n});\n"],"names":["$","Class","mode","loader","progressIndicator","app","vtranslate","container","find","val","submit","hideModalWindow","self","this","on","proceedSubmit","apply","e","currentTarget","attr","templateElements","progressLoader","closest","toggleClass","templates","filter","each","push","params","serializeFormData","request","done","data","response","result","success","valid","info","text","message","removeClass","addClass","fail","err","errorLog","ev","target","is","prop","preventDefault","stopPropagation","_this2","isCustomMode","showNotify","dynamicTemplatesCount","recordId","parseInt","registerPreSubmitEvent","registerSaveInventoryColumnSchemeClick","registerSelectCustomColumnsChange","registerListViewCheckRecords","Vtiger_PDF_Js","registerEvents"],"mappings":"aAGAA,EAAEC,MAAM,gBAAiB,wBAIVC,UACPC,OAASH,EAAEI,kBAAkB,SACzBC,IAAIC,WAAW,8BACd,iBACC,UACD,YAGHJ,UACF,yBAEA,kBACCK,UAAUC,KAAK,uBAAuBC,IAAI,QAC1CF,UAAUC,KAAK,mBAAmBE,mBAEnC,iBACCH,UAAUC,KAAK,sBAAsBC,IAAI,QACzCF,UAAUC,KAAK,mBAAmBE,gBAGlCN,kBAAkB,CAAEF,KAAM,aAC7BS,0CAMmB,SAASJ,eAC1BK,KAAOC,eACHL,KAAK,0CAA0CM,GAAG,SAAS,iBAC/DC,cAAcC,MAAMJ,KAAM,CAACZ,EAAEiB,EAAEC,eAAeC,KAAK,kDAS7BZ,eACxBa,iBAAmBb,UAAUC,KAAK,4CACrBM,GAAG,UAAU,oBACpBO,eAAiBrB,EAAEI,kBAAkB,SACpCC,IAAIC,WAAW,iCACd,iBACC,UACD,KAIaN,EAAEa,MAAMS,QAAQ,4BACtBd,KAAK,yBAAyBe,YAAY,cAExDC,UAAY,oBACCC,OAAO,YAAYC,MAAK,qBAC9BC,KAAK3B,EAAEa,MAAMJ,cAGpBmB,OAASrB,UAAUC,KAAK,QAAQqB,2BAC7B3B,KAAO,yBACPsB,UAAYA,uBAENM,QAAQF,QACnBG,MAAK,SAASC,UACVC,SAAWD,KAAKE,UAChBF,KAAKG,QAAS,KACbC,MAAQH,SAASG,MACjBC,KAAO9B,UACTC,KAAK,oBACL8B,KAAKL,SAASM,SACdC,YAAY,UACVJ,YACEK,SAAS,sBAEJ,oBACDpB,eAAejB,kBAAkB,CAAEF,KAAM,WAChD,eAEOM,KAAK,qBAAqBkB,MAAK,aACtCb,MAAMM,KAAK,YAAaiB,cAI5BM,MAAK,SAASV,KAAMW,SAChBC,SAASZ,KAAMW,6EASjBpC,UAAUC,KAAK,yBAAyBM,GAAG,UAAU,aACrDd,EAAE6C,GAAGC,QAAQC,GAAG,mBACdxC,UAAUC,KAAK,+BAA+BwC,KAAK,WAAY,YAC/DzC,UAAUC,KAAK,mBAAmBwC,KAAK,WAAY,cAEnDzC,UAAUC,KAAK,+BAA+BwC,KAAK,WAAY,kBAC/DzC,UAAUC,KAAK,mBAAmBwC,KAAK,WAAY,wFASrDzC,UAAUC,KAAK,mBAAmBM,GAAG,SAAS,cAChDmC,mBACAC,sBACI/C,OAASH,EAAEI,kBAAkB,UACxB,iBACC,UACD,KAIPwB,OAASuB,OAAK5C,UAAUC,KAAK,QAAQqB,2BAClC3B,KAAO,mCACPkD,aAAeD,OAAK5C,UAAUC,KAAK,yBAAyBuC,GAAG,yBAEzDjB,QAAQF,QACnBG,MAAK,SAASC,UACRC,SAAWD,KAAA,OACbA,KAAA,gBACI5B,kBAAkB,CAAEF,KAAM,SAE9B+B,SAAA,SAAuBD,KAAA,aACtBqB,WAAW,MACRpB,SAAA,aACA,eAIRS,MAAK,SAASV,KAAMW,SAChBC,SAASZ,KAAMW,0CAQhBpC,UAAaM,KAAKN,UAAYP,EAAE,mBAAmBsB,QAAQ,4BAC5DgC,sBAAwB,OACxBC,SAAWC,SAASjD,UAAUC,KAAK,mBAAmBC,YACtDgD,uBAAuBlD,gBACvBmD,8CACAC,yCACAC,6BAA6BrD,cAGpCP,GAAE,gBACG6D,eAAgBC"}