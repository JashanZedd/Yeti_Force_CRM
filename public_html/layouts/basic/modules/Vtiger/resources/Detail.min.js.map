{"version":3,"file":"Detail.min.js","sources":["Detail.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n * Contributor(s): YetiForce.com\n *************************************************************************************/\n'use strict';\n\njQuery.Class(\n\t'Vtiger_Detail_Js',\n\t{\n\t\tdetailInstance: false,\n\t\tgetInstance: function() {\n\t\t\tif (Vtiger_Detail_Js.detailInstance == false) {\n\t\t\t\tlet moduleClassName = app.getModuleName() + '_' + app.getViewName() + '_Js',\n\t\t\t\t\tinstance;\n\t\t\t\tif (typeof window[moduleClassName] !== 'undefined') {\n\t\t\t\t\tinstance = new window[moduleClassName]();\n\t\t\t\t} else {\n\t\t\t\t\tinstance = new Vtiger_Detail_Js();\n\t\t\t\t}\n\t\t\t\tVtiger_Detail_Js.detailInstance = instance;\n\t\t\t}\n\t\t\treturn Vtiger_Detail_Js.detailInstance;\n\t\t},\n\t\t/*\n\t\t * function to trigger Detail view actions\n\t\t * @params: Action url , callback function.\n\t\t */\n\t\ttriggerDetailViewAction: function(detailActionUrl, callBackFunction) {\n\t\t\tvar detailInstance = Vtiger_Detail_Js.getInstance();\n\t\t\tvar selectedIds = [];\n\t\t\tselectedIds.push(detailInstance.getRecordId());\n\t\t\tvar postData = {\n\t\t\t\tselected_ids: JSON.stringify(selectedIds)\n\t\t\t};\n\t\t\tvar actionParams = {\n\t\t\t\ttype: 'POST',\n\t\t\t\turl: detailActionUrl,\n\t\t\t\tdataType: 'html',\n\t\t\t\tdata: postData\n\t\t\t};\n\n\t\t\tAppConnector.request(actionParams)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\tapp.showModalWindow(data, { 'text-align': 'left' });\n\t\t\t\t\t\tif (typeof callBackFunction == 'function') {\n\t\t\t\t\t\t\tcallBackFunction(data);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fail(function(error, err) {});\n\t\t},\n\t\t/*\n\t\t * function to trigger send Sms\n\t\t * @params: send sms url , module name.\n\t\t */\n\t\ttriggerSendSms: function(detailActionUrl, module) {\n\t\t\tVtiger_Detail_Js.triggerDetailViewAction(detailActionUrl);\n\t\t},\n\t\ttriggerTransferOwnership: function(massActionUrl) {\n\t\t\tvar thisInstance = this;\n\t\t\tthisInstance.getRelatedModulesContainer = false;\n\t\t\tvar actionParams = {\n\t\t\t\ttype: 'POST',\n\t\t\t\turl: massActionUrl,\n\t\t\t\tdataType: 'html',\n\t\t\t\tdata: {}\n\t\t\t};\n\t\t\tAppConnector.request(actionParams).done(function(data) {\n\t\t\t\tif (data) {\n\t\t\t\t\tvar callback = function(data) {\n\t\t\t\t\t\tvar params = app.validationEngineOptions;\n\t\t\t\t\t\tparams.onValidationComplete = function(form, valid) {\n\t\t\t\t\t\t\tif (valid) {\n\t\t\t\t\t\t\t\tif (form.attr('name') == 'changeOwner') {\n\t\t\t\t\t\t\t\t\tthisInstance.transferOwnershipSave(form);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tjQuery('#changeOwner').validationEngine(app.validationEngineOptions);\n\t\t\t\t\t};\n\t\t\t\t\tapp.showModalWindow(data, function(data) {\n\t\t\t\t\t\tvar selectElement = thisInstance.getRelatedModuleContainer();\n\t\t\t\t\t\tApp.Fields.Picklist.changeSelectElementView(selectElement, 'select2');\n\t\t\t\t\t\tif (typeof callback == 'function') {\n\t\t\t\t\t\t\tcallback(data);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\ttransferOwnershipSave: function(form) {\n\t\t\tvar transferOwner = jQuery('#transferOwnerId').val();\n\t\t\tvar relatedModules = jQuery('#related_modules').val();\n\t\t\tvar recordId = jQuery('#recordId').val();\n\t\t\tvar params = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'TransferOwnership',\n\t\t\t\trecord: recordId,\n\t\t\t\ttransferOwnerId: transferOwner,\n\t\t\t\trelated_modules: relatedModules\n\t\t\t};\n\t\t\tAppConnector.request(params).done(function(data) {\n\t\t\t\tif (data.success) {\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\ttitle: app.vtranslate('JS_MESSAGE'),\n\t\t\t\t\t\ttext: app.vtranslate('JS_RECORDS_TRANSFERRED_SUCCESSFULLY'),\n\t\t\t\t\t\ttype: 'info'\n\t\t\t\t\t};\n\t\t\t\t\tvar oldvalue = jQuery('.assigned_user_id').val();\n\t\t\t\t\tvar element = jQuery('.assigned_user_id ');\n\n\t\t\t\t\telement.find('option[value=\"' + oldvalue + '\"]').removeAttr('selected');\n\t\t\t\t\telement.find('option[value=\"' + transferOwner + '\"]').attr('selected', 'selected');\n\t\t\t\t\telement.trigger('liszt:updated');\n\t\t\t\t\tvar Fieldname = element.find('option[value=\"' + transferOwner + '\"]').data('picklistvalue');\n\t\t\t\t\telement\n\t\t\t\t\t\t.closest('.row-fluid')\n\t\t\t\t\t\t.find('.value')\n\t\t\t\t\t\t.html(\n\t\t\t\t\t\t\t'<a href=\"index.php?module=Users&amp;parent=Settings&amp;view=Detail&amp;record=' +\n\t\t\t\t\t\t\t\ttransferOwner +\n\t\t\t\t\t\t\t\t'\">' +\n\t\t\t\t\t\t\t\tFieldname +\n\t\t\t\t\t\t\t\t'</a>'\n\t\t\t\t\t\t);\n\n\t\t\t\t\tVtiger_Helper_Js.showPnotify(params);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/*\n\t\t * Function to get the related module container\n\t\t */\n\t\tgetRelatedModuleContainer: function() {\n\t\t\tif (this.getRelatedModulesContainer == false) {\n\t\t\t\tthis.getRelatedModulesContainer = jQuery('#related_modules');\n\t\t\t}\n\t\t\treturn this.getRelatedModulesContainer;\n\t\t},\n\t\treloadRelatedList: function() {\n\t\t\tvar detailInstance = Vtiger_Detail_Js.getInstance();\n\t\t\tvar params = {};\n\t\t\tif (jQuery('[name=\"currentPageNum\"]').length > 0) {\n\t\t\t\tparams.page = jQuery('[name=\"currentPageNum\"]').val();\n\t\t\t}\n\t\t\tdetailInstance.loadRelatedList(params);\n\t\t},\n\t\tshowWorkflowTriggerView: function(instance) {\n\t\t\t$(instance).popover('hide');\n\t\t\tconst detailInstance = Vtiger_Detail_Js.getInstance(),\n\t\t\t\tcallback = function(data) {\n\t\t\t\t\tlet treeInstance = data.find('#treeWorkflowContents');\n\t\t\t\t\ttreeInstance.jstree({\n\t\t\t\t\t\tcore: {\n\t\t\t\t\t\t\tdata: JSON.parse(data.find('.js-tree-workflow-data').val()),\n\t\t\t\t\t\t\tthemes: {\n\t\t\t\t\t\t\t\tname: 'proton',\n\t\t\t\t\t\t\t\tresponsive: true,\n\t\t\t\t\t\t\t\ticons: false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcheckbox: {\n\t\t\t\t\t\t\tthree_state: false\n\t\t\t\t\t\t},\n\t\t\t\t\t\tplugins: ['search', 'category']\n\t\t\t\t\t});\n\t\t\t\t\tdata.find('[type=\"submit\"]').on('click', function() {\n\t\t\t\t\t\tlet tasks = {};\n\t\t\t\t\t\tlet selected = treeInstance.jstree('getCategory', true);\n\t\t\t\t\t\t$.each(selected, function(index, treeElement) {\n\t\t\t\t\t\t\tif (treeElement.attr === 'record') {\n\t\t\t\t\t\t\t\ttasks[treeElement.record_id] = [];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t$.each(selected, function(index, treeElement) {\n\t\t\t\t\t\t\tif (tasks[treeElement.parent] !== undefined && treeElement.attr === 'task') {\n\t\t\t\t\t\t\t\ttasks[treeElement.parent].push(treeElement.record_id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (Object.keys(tasks).length === 0) {\n\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\t\ttitle: app.vtranslate('JS_INFORMATION'),\n\t\t\t\t\t\t\t\ttext: app.vtranslate('JS_NOT_SELECTED_WORKFLOW_TRIGGER'),\n\t\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\t\ttitle: app.vtranslate('JS_MESSAGE'),\n\t\t\t\t\t\t\t\ttext: app.vtranslate('JS_STARTED_PERFORM_WORKFLOW'),\n\t\t\t\t\t\t\t\ttype: 'info'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\t\t\t\taction: 'Workflow',\n\t\t\t\t\t\t\t\tmode: 'execute',\n\t\t\t\t\t\t\t\tuser: data.find('[name=\"user\"]').val(),\n\t\t\t\t\t\t\t\trecord: detailInstance.getRecordId(),\n\t\t\t\t\t\t\t\ttasks: JSON.stringify(tasks)\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.done(function() {\n\t\t\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\t\t\t\ttitle: app.vtranslate('JS_MESSAGE'),\n\t\t\t\t\t\t\t\t\t\ttext: app.vtranslate('JS_COMPLETED_PERFORM_WORKFLOW'),\n\t\t\t\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t\t\t\t\tdetailInstance.loadWidgets();\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\t\t\t\ttitle: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\t\t\t\t\ttext: app.vtranslate('JS_ERROR_DURING_TRIGGER_OF_WORKFLOW'),\n\t\t\t\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\tAppConnector.request({\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\tview: 'WorkflowTrigger',\n\t\t\t\trecord: detailInstance.getRecordId()\n\t\t\t}).done(function(data) {\n\t\t\t\tif (data) {\n\t\t\t\t\tapp.showModalWindow(data, '', callback);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\t{\n\t\ttargetPicklistChange: false,\n\t\ttargetPicklist: false,\n\t\tdetailViewContentHolder: false,\n\t\tdetailViewForm: false,\n\t\tdetailViewDetailsTabLabel: 'LBL_RECORD_DETAILS',\n\t\tdetailViewSummaryTabLabel: 'LBL_RECORD_SUMMARY',\n\t\tdetailViewRecentCommentsTabLabel: 'ModComments',\n\t\tdetailViewRecentActivitiesTabLabel: 'Activities',\n\t\tdetailViewRecentUpdatesTabLabel: 'LBL_UPDATES',\n\t\tdetailViewRecentDocumentsTabLabel: 'Documents',\n\t\tfieldUpdatedEvent: 'Vtiger.Field.Updated',\n\t\t//Filels list on updation of which we need to upate the detailview header\n\t\tupdatedFields: ['company', 'designation', 'title'],\n\t\t//Event that will triggered before saving the ajax edit of fields\n\t\tfieldPreSave: 'Vtiger.Field.PreSave',\n\t\ttempData: [],\n\t\treferenceFieldNames: {\n\t\t\tCalendar: {\n\t\t\t\tAccounts: 'link',\n\t\t\t\tLeads: 'link',\n\t\t\t\tVendors: 'link',\n\t\t\t\tOSSEmployees: 'link',\n\t\t\t\tContacts: 'linkextend',\n\t\t\t\tCampaigns: 'process',\n\t\t\t\tHelpDesk: 'process',\n\t\t\t\tProjects: 'process',\n\t\t\t\tServiceContracts: 'process'\n\t\t\t},\n\t\t\tOutsourcedProducts: {\n\t\t\t\tLeads: 'parent_id',\n\t\t\t\tAccounts: 'parent_id',\n\t\t\t\tContacts: 'parent_id'\n\t\t\t},\n\t\t\tAssets: {\n\t\t\t\tAccounts: 'parent_id',\n\t\t\t\tContacts: 'parent_id'\n\t\t\t},\n\t\t\tOSSOutsourcedServices: {\n\t\t\t\tLeads: 'parent_id',\n\t\t\t\tAccounts: 'parent_id',\n\t\t\t\tContacts: 'parent_id'\n\t\t\t},\n\t\t\tOSSSoldServices: {\n\t\t\t\tAccounts: 'parent_id',\n\t\t\t\tContacts: 'parent_id'\n\t\t\t}\n\t\t},\n\t\t//constructor\n\t\tinit: function() {},\n\t\tloadWidgetsEvents: function() {\n\t\t\tconst thisInstance = this;\n\t\t\tapp.event.on('DetailView.Widget.AfterLoad', function(e, widgetContent, relatedModuleName, instance) {\n\t\t\t\tif (relatedModuleName === 'Calendar') {\n\t\t\t\t\tthisInstance.reloadWidgetActivitesStats(widgetContent.closest('.activityWidgetContainer'));\n\t\t\t\t}\n\t\t\t\tif (relatedModuleName === 'ModComments') {\n\t\t\t\t\tthisInstance.registerCommentEventsInDetail(widgetContent.closest('.updatesWidgetContainer'));\n\t\t\t\t}\n\t\t\t\tif (widgetContent.find('[name=\"relatedModule\"]').length) {\n\t\t\t\t\tthisInstance.registerShowSummary(widgetContent);\n\t\t\t\t}\n\t\t\t\tif (relatedModuleName === 'OSSMailView') {\n\t\t\t\t\tVtiger_Index_Js.registerMailButtons(widgetContent);\n\t\t\t\t\twidgetContent.find('.showMailModal').on('click', function(e) {\n\t\t\t\t\t\tlet progressIndicatorElement = jQuery.progressIndicator();\n\t\t\t\t\t\tapp.showModalWindow('', $(e.currentTarget).data('url') + '&noloadlibs=1', function(data) {\n\t\t\t\t\t\t\tVtiger_Index_Js.registerMailButtons(data);\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthisInstance.registerEmailEvents(widgetContent);\n\t\t\t\tif (relatedModuleName === 'DetailView') {\n\t\t\t\t\tthisInstance.registerBlockStatusCheckOnLoad();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tloadWidgets: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar widgetList = jQuery('[class^=\"widgetContainer_\"]');\n\t\t\twidgetList.each(function(index, widgetContainerELement) {\n\t\t\t\tvar widgetContainer = jQuery(widgetContainerELement);\n\t\t\t\tthisInstance.loadWidget(widgetContainer);\n\t\t\t});\n\t\t\tthisInstance.registerRelatedModulesRecordCount();\n\t\t},\n\t\tloadWidget: function(widgetContainer, params) {\n\t\t\tconst thisInstance = this,\n\t\t\t\tcontentContainer = $('.js-detail-widget-content', widgetContainer);\n\t\t\tlet relatedModuleName;\n\t\t\tthis.registerFilterForAddingModuleRelatedRecordFromSummaryWidget(widgetContainer);\n\t\t\tif (widgetContainer.find('[name=\"relatedModule\"]').length) {\n\t\t\t\trelatedModuleName = widgetContainer.find('[name=\"relatedModule\"]').val();\n\t\t\t} else {\n\t\t\t\trelatedModuleName = widgetContainer.data('name');\n\t\t\t}\n\t\t\tif (params === undefined) {\n\t\t\t\tlet urlParams = widgetContainer.data('url');\n\t\t\t\tif (urlParams == undefined) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet queryParameters = urlParams.split('&'),\n\t\t\t\t\tkeyValueMap = {},\n\t\t\t\t\tindex;\n\t\t\t\tfor (index = 0; index < queryParameters.length; index++) {\n\t\t\t\t\tlet queryParamComponents = queryParameters[index].split('=');\n\t\t\t\t\tkeyValueMap[queryParamComponents[0]] = queryParamComponents[1];\n\t\t\t\t}\n\t\t\t\tparams = keyValueMap;\n\t\t\t}\n\t\t\tlet aDeferred = $.Deferred();\n\t\t\tcontentContainer.progressIndicator({});\n\t\t\tAppConnector.request({\n\t\t\t\ttype: 'POST',\n\t\t\t\tasync: false,\n\t\t\t\tdataType: 'html',\n\t\t\t\tdata: params\n\t\t\t})\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tcontentContainer.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tcontentContainer.html(data);\n\t\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(widgetContainer.find('.select2'));\n\t\t\t\t\tapp.registerModal(contentContainer);\n\t\t\t\t\tif (relatedModuleName) {\n\t\t\t\t\t\tlet relatedController = Vtiger_RelatedList_Js.getInstance(\n\t\t\t\t\t\t\tthisInstance.getRecordId(),\n\t\t\t\t\t\t\tapp.getModuleName(),\n\t\t\t\t\t\t\tthisInstance.getSelectedTab(),\n\t\t\t\t\t\t\trelatedModuleName\n\t\t\t\t\t\t);\n\t\t\t\t\t\trelatedController.setRelatedContainer(contentContainer);\n\t\t\t\t\t\trelatedController.registerRelatedEvents();\n\t\t\t\t\t\tthisInstance.widgetRelatedRecordView(widgetContainer, true);\n\t\t\t\t\t}\n\t\t\t\t\tapp.event.trigger('DetailView.Widget.AfterLoad', contentContainer, relatedModuleName, thisInstance);\n\t\t\t\t\taDeferred.resolve(params);\n\t\t\t\t})\n\t\t\t\t.fail(function() {\n\t\t\t\t\tcontentContainer.progressIndicator({ mode: 'hide' });\n\t\t\t\t\taDeferred.reject();\n\t\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\twidgetRelatedRecordView: function(container, load) {\n\t\t\tvar cacheKey = this.getRecordId() + '_' + container.data('id');\n\t\t\tvar relatedRecordCacheID = app.moduleCacheGet(cacheKey);\n\t\t\tif (relatedRecordCacheID !== null) {\n\t\t\t\tvar newActive = container.find(\".js-carousel-item[data-id = '\" + relatedRecordCacheID + \"']\");\n\t\t\t\tif (newActive.length) {\n\t\t\t\t\tcontainer.find('.js-carousel-item.active').removeClass('active');\n\t\t\t\t\tcontainer.find(\".js-carousel-item[data-id = '\" + relatedRecordCacheID + \"']\").addClass('active');\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar controlBox = container.find('.control-widget');\n\t\t\tvar prev = controlBox.find('.prev');\n\t\t\tvar next = controlBox.find('.next');\n\t\t\tvar active = container.find('.js-carousel-item.active');\n\t\t\tif (container.find('.js-carousel-item').length <= 1 || !active.next().length) {\n\t\t\t\tnext.addClass('disabled');\n\t\t\t} else {\n\t\t\t\tnext.removeClass('disabled');\n\t\t\t}\n\t\t\tif (container.find('.js-carousel-item').length <= 1 || !active.prev().length) {\n\t\t\t\tprev.addClass('disabled');\n\t\t\t} else {\n\t\t\t\tprev.removeClass('disabled');\n\t\t\t}\n\t\t\tif (load) {\n\t\t\t\tnext.on('click', function() {\n\t\t\t\t\tif ($(this).hasClass('disabled')) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar active = container.find('.js-carousel-item.active');\n\t\t\t\t\tactive.removeClass('active');\n\t\t\t\t\tvar nextElement = active.next();\n\t\t\t\t\tnextElement.addClass('active');\n\t\t\t\t\tif (!nextElement.next().length) {\n\t\t\t\t\t\tnext.addClass('disabled');\n\t\t\t\t\t}\n\t\t\t\t\tif (active.prev()) {\n\t\t\t\t\t\tprev.removeClass('disabled');\n\t\t\t\t\t}\n\t\t\t\t\tapp.moduleCacheSet(cacheKey, nextElement.data('id'));\n\t\t\t\t});\n\t\t\t\tprev.on('click', function() {\n\t\t\t\t\tif ($(this).hasClass('disabled')) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar active = container.find('.js-carousel-item.active');\n\t\t\t\t\tactive.removeClass('active');\n\t\t\t\t\tvar prevElement = active.prev();\n\t\t\t\t\tprevElement.addClass('active');\n\t\t\t\t\tif (!prevElement.prev().length) {\n\t\t\t\t\t\tprev.addClass('disabled');\n\t\t\t\t\t}\n\t\t\t\t\tif (active.next()) {\n\t\t\t\t\t\tnext.removeClass('disabled');\n\t\t\t\t\t}\n\t\t\t\t\tapp.moduleCacheSet(cacheKey, prevElement.data('id'));\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tloadContents: function(url, data) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar aDeferred = jQuery.Deferred();\n\n\t\t\tvar detailContentsHolder = this.getContentHolder();\n\t\t\tvar params = url;\n\t\t\tif (typeof data !== 'undefined') {\n\t\t\t\tparams = {};\n\t\t\t\tparams.url = url;\n\t\t\t\tparams.data = data;\n\t\t\t}\n\t\t\tAppConnector.requestPjax(params).done(function(responseData) {\n\t\t\t\tdetailContentsHolder.html(responseData);\n\t\t\t\tresponseData = detailContentsHolder.html();\n\t\t\t\t//thisInstance.triggerDisplayTypeEvent();\n\t\t\t\tthisInstance.registerBlockStatusCheckOnLoad();\n\t\t\t\t//Make select box more usability\n\t\t\t\tApp.Fields.Picklist.changeSelectElementView(detailContentsHolder);\n\t\t\t\t//Attach date picker event to date fields\n\t\t\t\tApp.Fields.Date.register(detailContentsHolder);\n\t\t\t\tthisInstance.getForm().validationEngine();\n\t\t\t\tapp.event.trigger('DetailView.LoadContents.AfterLoad', responseData);\n\t\t\t\taDeferred.resolve(responseData);\n\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\tgetUpdateFieldsArray: function() {\n\t\t\treturn this.updatedFields;\n\t\t},\n\t\t/**\n\t\t * Function to return related tab.\n\t\t * @return : jQuery Object.\n\t\t */\n\t\tgetTabByLabel: function(tabLabel) {\n\t\t\tvar tabs = this.getTabs();\n\t\t\tvar targetTab = false;\n\t\t\ttabs.each(function(index, element) {\n\t\t\t\tvar tab = jQuery(element);\n\t\t\t\tvar labelKey = tab.data('labelKey');\n\t\t\t\tif (labelKey == tabLabel) {\n\t\t\t\t\ttargetTab = tab;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn targetTab;\n\t\t},\n\t\tgetTabByModule: function(moduleName, relationId = '') {\n\t\t\tvar tabs = this.getTabs();\n\t\t\tvar targetTab = false;\n\t\t\ttabs.each(function(index, element) {\n\t\t\t\tvar tab = jQuery(element);\n\t\t\t\tif (\n\t\t\t\t\ttab.data('reference') == moduleName &&\n\t\t\t\t\t(!relationId || (relationId && relationId == tab.data('relation-id')))\n\t\t\t\t) {\n\t\t\t\t\ttargetTab = tab;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn targetTab;\n\t\t},\n\t\tselectModuleTab: function() {\n\t\t\tvar relatedTabContainer = this.getTabContainer();\n\t\t\tvar moduleTab = relatedTabContainer.find('li.module-tab');\n\t\t\tthis.deSelectAllrelatedTabs();\n\t\t\tthis.markTabAsSelected(moduleTab);\n\t\t},\n\t\tdeSelectAllrelatedTabs: function() {\n\t\t\tthis.getTabs().removeClass('active');\n\t\t},\n\t\tmarkTabAsSelected: function(tabElement) {\n\t\t\ttabElement.addClass('active');\n\t\t\t$(\n\t\t\t\t'.related .dropdown [data-reference=\"' +\n\t\t\t\t\ttabElement.data('reference') +\n\t\t\t\t\t'\"][data-relation-id=\"' +\n\t\t\t\t\ttabElement.data('relation-id') +\n\t\t\t\t\t'\"]'\n\t\t\t).addClass('active');\n\t\t},\n\t\treloadTabContent: function() {\n\t\t\tthis.getSelectedTab().trigger('click');\n\t\t},\n\t\tgetSelectedTab: function() {\n\t\t\tvar tabContainer = this.getTabContainer();\n\t\t\treturn tabContainer.find('.js-detail-tab.active:not(.d-none)');\n\t\t},\n\t\tgetTabContainer: function() {\n\t\t\treturn jQuery('div.related');\n\t\t},\n\t\tgetTabs: function() {\n\t\t\tvar topTabs = this.getTabContainer().find('li.baseLink:not(.d-none)');\n\t\t\tvar dropdownMenuTabs = this.getTabContainer().find('li:not(.baseLink)');\n\t\t\tdropdownMenuTabs.each(function(n, e) {\n\t\t\t\tvar currentTarget = jQuery(this);\n\t\t\t\tvar iteration = currentTarget.data('iteration');\n\t\t\t\tvar className = currentTarget.hasClass('mainNav') ? 'mainNav' : 'relatedNav';\n\t\t\t\tif (\n\t\t\t\t\titeration != undefined &&\n\t\t\t\t\ttopTabs.filter('.' + className + '[data-iteration=\"' + iteration + '\"]').length < 1\n\t\t\t\t) {\n\t\t\t\t\ttopTabs.push(currentTarget.get(0));\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn topTabs;\n\t\t},\n\t\tgetContentHolder: function() {\n\t\t\tif (this.detailViewContentHolder == false) {\n\t\t\t\tthis.detailViewContentHolder = jQuery('div.details div.contents');\n\t\t\t}\n\t\t\treturn this.detailViewContentHolder;\n\t\t},\n\t\t/**\n\t\t * Function which will give the detail view form\n\t\t * @return : jQuery element\n\t\t */\n\t\tgetForm: function() {\n\t\t\tif (this.detailViewForm == false) {\n\t\t\t\tthis.detailViewForm = jQuery('#detailView');\n\t\t\t}\n\t\t\treturn this.detailViewForm;\n\t\t},\n\t\tgetRecordId: function() {\n\t\t\treturn app.getRecordId();\n\t\t},\n\t\tgetRelatedModuleName: function() {\n\t\t\tif (jQuery('.relatedModuleName', this.getContentHolder()).length == 1) {\n\t\t\t\treturn jQuery('.relatedModuleName', this.getContentHolder()).val();\n\t\t\t}\n\t\t},\n\t\tsaveFieldValues: function(fieldDetailList) {\n\t\t\tvar aDeferred = jQuery.Deferred();\n\n\t\t\tvar recordId = this.getRecordId();\n\n\t\t\tvar data = {};\n\t\t\tif (typeof fieldDetailList !== 'undefined') {\n\t\t\t\tdata = fieldDetailList;\n\t\t\t}\n\t\t\tdata['record'] = recordId;\n\t\t\tdata['module'] = app.getModuleName();\n\t\t\tdata['action'] = 'SaveAjax';\n\n\t\t\tvar params = {};\n\t\t\tparams.data = data;\n\t\t\tparams.async = false;\n\t\t\tparams.dataType = 'json';\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function(reponseData) {\n\t\t\t\t\taDeferred.resolve(reponseData);\n\t\t\t\t})\n\t\t\t\t.fail((jqXHR, textStatus, errorThrown) => {\n\t\t\t\t\taDeferred.reject(jqXHR, textStatus, errorThrown);\n\t\t\t\t});\n\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\tgetRelatedListCurrentPageNum: function() {\n\t\t\treturn jQuery('input[name=\"currentPageNum\"]', this.getContentHolder()).val();\n\t\t},\n\t\t/**\n\t\t * function to remove comment block if its exists.\n\t\t */\n\t\tremoveCommentBlockIfExists: function() {\n\t\t\t$('.js-add-comment-block', $('.js-comments-body', this.getContentHolder())).remove();\n\t\t},\n\t\t/**\n\t\t * function to get the Comment thread for the given parent.\n\t\t * params: Url to get the Comment thread\n\t\t */\n\t\tgetCommentThread: function(url) {\n\t\t\tvar aDeferred = jQuery.Deferred();\n\t\t\tAppConnector.request(url)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t})\n\t\t\t\t.fail(function(error, err) {});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\t/**\n\t\t * Function to save comment\n\t\t */\n\t\tsaveCommentAjax: function(\n\t\t\telement,\n\t\t\tcommentMode,\n\t\t\tcommentContentValue,\n\t\t\teditCommentReason,\n\t\t\tcommentId,\n\t\t\tparentCommentId,\n\t\t\taDeferred\n\t\t) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({});\n\t\t\tvar commentInfoBlock = element.closest('.js-comment-single');\n\t\t\tvar relatedTo = commentInfoBlock.find('.related_to').val();\n\t\t\tif (!relatedTo) {\n\t\t\t\trelatedTo = thisInstance.getRecordId();\n\t\t\t}\n\t\t\tlet postData = {\n\t\t\t\tcommentcontent: commentContentValue.replace(/\\/|br|/gi, ''),\n\t\t\t\trelated_to: relatedTo,\n\t\t\t\tmodule: 'ModComments'\n\t\t\t};\n\n\t\t\tif (commentMode == 'edit') {\n\t\t\t\tpostData['record'] = commentId;\n\t\t\t\tpostData['reasontoedit'] = editCommentReason;\n\t\t\t\tpostData['parent_comments'] = parentCommentId;\n\t\t\t\tpostData['mode'] = 'edit';\n\t\t\t\tpostData['action'] = 'Save';\n\t\t\t} else if (commentMode == 'add') {\n\t\t\t\tpostData['parent_comments'] = commentId;\n\t\t\t\tpostData['action'] = 'SaveAjax';\n\t\t\t}\n\t\t\tAppConnector.request(postData)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tif (commentMode == 'add') {\n\t\t\t\t\t\tthisInstance.addRelationBetweenRecords(\n\t\t\t\t\t\t\t'ModComments',\n\t\t\t\t\t\t\tdata.result.id,\n\t\t\t\t\t\t\tthisInstance.getTabByLabel(thisInstance.detailViewRecentCommentsTabLabel)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tapp.event.trigger('DetailView.SaveComment.AfterAjax', commentInfoBlock, postData, data);\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t})\n\t\t\t\t.fail(function(textStatus, errorThrown) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\telement.removeAttr('disabled');\n\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t});\n\t\t},\n\t\tsaveComment: function(e) {\n\t\t\tlet aDeferred = jQuery.Deferred(),\n\t\t\t\tcurrentTarget = jQuery(e.currentTarget),\n\t\t\t\tcommentMode = currentTarget.data('mode'),\n\t\t\t\tclosestCommentBlock = currentTarget.closest('.js-add-comment-block'),\n\t\t\t\tcommentContent = closestCommentBlock.find('.js-comment-content'),\n\t\t\t\tcommentContentValue = commentContent.html(),\n\t\t\t\terrorMsg,\n\t\t\t\teditCommentReason;\n\t\t\tif ('' === commentContentValue) {\n\t\t\t\terrorMsg = app.vtranslate('JS_LBL_COMMENT_VALUE_CANT_BE_EMPTY');\n\t\t\t\tcommentContent.validationEngine('showPrompt', errorMsg, 'error', 'bottomLeft', true);\n\t\t\t\taDeferred.reject(errorMsg);\n\t\t\t\treturn aDeferred.promise();\n\t\t\t}\n\t\t\tif ('edit' === commentMode) {\n\t\t\t\teditCommentReason = closestCommentBlock.find('[name=\"reasonToEdit\"]').val();\n\t\t\t}\n\t\t\tlet element = jQuery(e.currentTarget),\n\t\t\t\tcommentInfoHeader = closestCommentBlock.closest('.js-comment-details').find('.js-comment-info-header'),\n\t\t\t\tcommentId = commentInfoHeader.data('commentid'),\n\t\t\t\tparentCommentId = commentInfoHeader.data('parentcommentid');\n\t\t\tthis.saveCommentAjax(\n\t\t\t\telement,\n\t\t\t\tcommentMode,\n\t\t\t\tcommentContentValue,\n\t\t\t\teditCommentReason,\n\t\t\t\tcommentId,\n\t\t\t\tparentCommentId,\n\t\t\t\taDeferred\n\t\t\t);\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\t/**\n\t\t * function to return the UI of the comment.\n\t\t * return html\n\t\t */\n\t\tgetCommentUI: function(commentId) {\n\t\t\tvar aDeferred = jQuery.Deferred();\n\t\t\tvar postData = {\n\t\t\t\tview: 'DetailAjax',\n\t\t\t\tmodule: 'ModComments',\n\t\t\t\trecord: commentId\n\t\t\t};\n\t\t\tAppConnector.request(postData)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t})\n\t\t\t\t.fail(function(error, err) {});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\t/**\n\t\t * function to return cloned add comment block\n\t\t * return jQuery Obj.\n\t\t */\n\t\tgetCommentBlock: function() {\n\t\t\tlet clonedCommentBlock = jQuery('.basicAddCommentBlock', this.getContentHolder())\n\t\t\t\t.clone(true, true)\n\t\t\t\t.removeClass('basicAddCommentBlock d-none')\n\t\t\t\t.addClass('js-add-comment-block');\n\t\t\tclonedCommentBlock\n\t\t\t\t.find('.commentcontenthidden')\n\t\t\t\t.removeClass('commentcontenthidden')\n\t\t\t\t.addClass('js-comment-content');\n\t\t\treturn clonedCommentBlock;\n\t\t},\n\t\t/**\n\t\t * function to return cloned edit comment block\n\t\t * return jQuery Obj.\n\t\t */\n\t\tgetEditCommentBlock: function() {\n\t\t\tlet clonedCommentBlock = jQuery('.basicEditCommentBlock', this.getContentHolder())\n\t\t\t\t.clone(true, true)\n\t\t\t\t.removeClass('basicEditCommentBlock d-none')\n\t\t\t\t.addClass('js-add-comment-block');\n\t\t\tclonedCommentBlock\n\t\t\t\t.find('.commentcontenthidden')\n\t\t\t\t.removeClass('commentcontenthidden')\n\t\t\t\t.addClass('js-comment-content');\n\t\t\tnew App.Fields.Text.Completions(clonedCommentBlock.find('.js-completions'), { emojiPanel: false });\n\t\t\treturn clonedCommentBlock;\n\t\t},\n\t\t/*\n\t\t * Function to register the submit event for Send Sms\n\t\t */\n\t\tregisterSendSmsSubmitEvent: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tjQuery('body').on('submit', '#massSave', function(e) {\n\t\t\t\tvar form = jQuery(e.currentTarget);\n\t\t\t\tvar smsTextLength = form.find('#message').html().length;\n\t\t\t\tif (smsTextLength > 160) {\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\ttitle: app.vtranslate('JS_MESSAGE'),\n\t\t\t\t\t\ttext: app.vtranslate('LBL_SMS_MAX_CHARACTERS_ALLOWED'),\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showPnotify(params);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tvar submitButton = form.find(':submit');\n\t\t\t\tsubmitButton.attr('disabled', 'disabled');\n\t\t\t\tthisInstance.SendSmsSave(form);\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t},\n\t\t/*\n\t\t * Function to Save and sending the Sms and hide the modal window of send sms\n\t\t */\n\t\tSendSmsSave: function(form) {\n\t\t\tvar progressInstance = jQuery.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tvar SendSmsUrl = form.serializeFormData();\n\t\t\tAppConnector.request(SendSmsUrl)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\tprogressInstance.progressIndicator({\n\t\t\t\t\t\tmode: 'hide'\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.fail(function(error, err) {});\n\t\t},\n\t\t/**\n\t\t * Function which will register events to update the record name in the detail view when any of\n\t\t * the name field is changed\n\t\t */\n\t\tregisterNameAjaxEditEvent: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar detailContentsHolder = thisInstance.getContentHolder();\n\t\t\tdetailContentsHolder.on(thisInstance.fieldUpdatedEvent, '.nameField', function(e, params) {\n\t\t\t\tvar form = thisInstance.getForm();\n\t\t\t\tvar nameFields = form.data('nameFields');\n\t\t\t\tvar recordLabel = '';\n\t\t\t\tfor (var index in nameFields) {\n\t\t\t\t\tif (index != 0) {\n\t\t\t\t\t\trecordLabel += ' ';\n\t\t\t\t\t}\n\n\t\t\t\t\tvar nameFieldName = nameFields[index];\n\t\t\t\t\trecordLabel += form.find('[name=\"' + nameFieldName + '\"]').val();\n\t\t\t\t}\n\t\t\t\tvar recordLabelElement = detailContentsHolder.closest('.contentsDiv').find('.recordLabel');\n\t\t\t\trecordLabelElement.text(recordLabel);\n\t\t\t});\n\t\t},\n\t\tupdateHeaderNameFields: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar detailContentsHolder = thisInstance.getContentHolder();\n\t\t\tvar form = thisInstance.getForm();\n\t\t\tvar nameFields = form.data('nameFields');\n\t\t\tvar recordLabelElement = detailContentsHolder.closest('.contentsDiv').find('.recordLabel');\n\t\t\tvar title = '';\n\t\t\tfor (var index in nameFields) {\n\t\t\t\tvar nameFieldName = nameFields[index];\n\t\t\t\tvar nameField = form.find('[name=\"' + nameFieldName + '\"]');\n\t\t\t\tif (nameField.length > 0) {\n\t\t\t\t\tvar recordLabel = nameField.val();\n\t\t\t\t\ttitle += recordLabel + ' ';\n\t\t\t\t\trecordLabelElement.find('[class=\"' + nameFieldName + '\"]').text(recordLabel);\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar salutatioField = recordLabelElement.find('.salutation');\n\t\t\tif (salutatioField.length > 0) {\n\t\t\t\tvar salutatioValue = salutatioField.text();\n\t\t\t\ttitle = salutatioValue + title;\n\t\t\t}\n\t\t\trecordLabelElement.attr('title', title);\n\t\t},\n\t\tregisterAjaxEditEvent: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar detailContentsHolder = thisInstance.getContentHolder();\n\t\t\tdetailContentsHolder.on(thisInstance.fieldUpdatedEvent, 'input,select,textarea', function(e) {\n\t\t\t\tthisInstance.updateHeaderValues(jQuery(e.currentTarget));\n\t\t\t});\n\t\t},\n\t\tupdateHeaderValues: function(currentElement) {\n\t\t\tvar thisInstance = this;\n\t\t\tif (currentElement.hasClass('nameField')) {\n\t\t\t\tthisInstance.updateHeaderNameFields();\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tvar name = currentElement.attr('name');\n\t\t\tvar updatedFields = this.getUpdateFieldsArray();\n\t\t\tvar detailContentsHolder = thisInstance.getContentHolder();\n\t\t\tif (jQuery.inArray(name, updatedFields) != '-1') {\n\t\t\t\tvar recordLabel = currentElement.val();\n\t\t\t\tvar recordLabelElement = detailContentsHolder.closest('.contentsDiv').find('.' + name + '_label');\n\t\t\t\trecordLabelElement.text(recordLabel);\n\t\t\t}\n\t\t},\n\t\t/*\n\t\t * Function to register the click event of email field\n\t\t */\n\t\tregisterEmailFieldClickEvent: function() {\n\t\t\tvar detailContentsHolder = this.getContentHolder();\n\t\t\tdetailContentsHolder.on('click', '.emailField', function(e) {\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t\t},\n\t\t/*\n\t\t * Function to register the click event of phone field\n\t\t */\n\t\tregisterPhoneFieldClickEvent: function() {\n\t\t\tvar detailContentsHolder = this.getContentHolder();\n\t\t\tdetailContentsHolder.on('click', '.phoneField', function(e) {\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t\t},\n\t\t/*\n\t\t * Function to register the click event of url field\n\t\t */\n\t\tregisterUrlFieldClickEvent: function() {\n\t\t\tvar detailContentsHolder = this.getContentHolder();\n\t\t\tdetailContentsHolder.on('click', '.urlField', function(e) {\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function to register event for related list row click\n\t\t */\n\t\tregisterRelatedRowClickEvent: function() {\n\t\t\tvar detailContentsHolder = this.getContentHolder();\n\t\t\tdetailContentsHolder.on('click', '.listViewEntries', function(e) {\n\t\t\t\tvar targetElement = jQuery(e.target, jQuery(e.currentTarget));\n\t\t\t\tif (targetElement.is('td:first-child') && targetElement.children('input[type=\"checkbox\"]').length > 0)\n\t\t\t\t\treturn;\n\t\t\t\tif (jQuery(e.target).is('input[type=\"checkbox\"]')) return;\n\t\t\t\tvar elem = jQuery(e.currentTarget);\n\t\t\t\tvar recordUrl = elem.data('recordurl');\n\t\t\t\tif (typeof recordUrl !== 'undefined') {\n\t\t\t\t\twindow.location.href = recordUrl;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tloadRelatedList: function(params) {\n\t\t\tvar aDeferred = jQuery.Deferred();\n\t\t\tif (params == undefined) {\n\t\t\t\tparams = {};\n\t\t\t}\n\t\t\tvar relatedListInstance = Vtiger_RelatedList_Js.getInstance(\n\t\t\t\tthis.getRecordId(),\n\t\t\t\tapp.getModuleName(),\n\t\t\t\tthis.getSelectedTab(),\n\t\t\t\tthis.getRelatedModuleName()\n\t\t\t);\n\t\t\trelatedListInstance.loadRelatedList(params).done(\n\t\t\t\tfunction(data) {\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t},\n\t\t\t\tfunction(textStatus, errorThrown) {\n\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t}\n\t\t\t);\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\t/**\n\t\t * Function to register Event for Sorting\n\t\t */\n\t\tregisterEventForRelatedList: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar detailContentsHolder = this.getContentHolder();\n\t\t\tvar relatedModuleName = thisInstance.getRelatedModuleName();\n\t\t\tif (relatedModuleName) {\n\t\t\t\tvar relatedController = Vtiger_RelatedList_Js.getInstance(\n\t\t\t\t\tthisInstance.getRecordId(),\n\t\t\t\t\tapp.getModuleName(),\n\t\t\t\t\tthisInstance.getSelectedTab(),\n\t\t\t\t\trelatedModuleName\n\t\t\t\t);\n\t\t\t\trelatedController.setRelatedContainer(detailContentsHolder);\n\t\t\t\trelatedController.registerRelatedEvents();\n\t\t\t}\n\t\t\tdetailContentsHolder.find('.detailViewBlockLink').each(function(n, block) {\n\t\t\t\tblock = $(block);\n\t\t\t\tvar blockContent = block.find('.blockContent');\n\t\t\t\tif (blockContent.is(':visible')) {\n\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\ttype: 'GET',\n\t\t\t\t\t\tdataType: 'html',\n\t\t\t\t\t\tdata: block.data('url')\n\t\t\t\t\t}).done(function(response) {\n\t\t\t\t\t\tblockContent.html(response);\n\t\t\t\t\t\tvar relatedController = Vtiger_RelatedList_Js.getInstance(\n\t\t\t\t\t\t\tthisInstance.getRecordId(),\n\t\t\t\t\t\t\tapp.getModuleName(),\n\t\t\t\t\t\t\tthisInstance.getSelectedTab(),\n\t\t\t\t\t\t\tblock.data('reference')\n\t\t\t\t\t\t);\n\t\t\t\t\t\trelatedController.setRelatedContainer(blockContent);\n\t\t\t\t\t\trelatedController.registerRelatedEvents();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tdetailContentsHolder.find('.detailViewBlockLink .blockHeader').on('click', function(e) {\n\t\t\t\tconst target = $(e.target);\n\t\t\t\tif (\n\t\t\t\t\ttarget.is('input') ||\n\t\t\t\t\ttarget.is('button') ||\n\t\t\t\t\ttarget.parents().is('button') ||\n\t\t\t\t\ttarget.hasClass('js-stop-propagation') ||\n\t\t\t\t\ttarget.parents().hasClass('js-stop-propagation')\n\t\t\t\t) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst block = $(this).closest('.js-toggle-panel');\n\t\t\t\tconst blockContent = block.find('.blockContent');\n\t\t\t\tconst isEmpty = blockContent.is(':empty');\n\t\t\t\tif (!blockContent.is(':visible')) {\n\t\t\t\t\tblockContent.progressIndicator();\n\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\ttype: 'GET',\n\t\t\t\t\t\tdataType: 'html',\n\t\t\t\t\t\tdata: block.data('url')\n\t\t\t\t\t}).done(function(response) {\n\t\t\t\t\t\tblockContent.html(response);\n\t\t\t\t\t\tconst relatedController = Vtiger_RelatedList_Js.getInstance(\n\t\t\t\t\t\t\tthisInstance.getRecordId(),\n\t\t\t\t\t\t\tapp.getModuleName(),\n\t\t\t\t\t\t\tthisInstance.getSelectedTab(),\n\t\t\t\t\t\t\tblock.data('reference')\n\t\t\t\t\t\t);\n\t\t\t\t\t\trelatedController.setRelatedContainer(blockContent);\n\t\t\t\t\t\tif (isEmpty) {\n\t\t\t\t\t\t\trelatedController.registerRelatedEvents();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trelatedController.registerPostLoadEvents();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterBlockAnimationEvent: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar detailContentsHolder = this.getContentHolder();\n\t\t\tdetailContentsHolder.find('.blockHeader').on('click', function(e) {\n\t\t\t\tconst target = $(e.target);\n\t\t\t\tif (\n\t\t\t\t\ttarget.is('input') ||\n\t\t\t\t\ttarget.is('button') ||\n\t\t\t\t\ttarget.parents().is('button') ||\n\t\t\t\t\ttarget.hasClass('js-stop-propagation') ||\n\t\t\t\t\ttarget.parents().hasClass('js-stop-propagation')\n\t\t\t\t) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tvar currentTarget = $(this)\n\t\t\t\t\t.find('.js-block-toggle')\n\t\t\t\t\t.not('.d-none');\n\t\t\t\tvar blockId = currentTarget.data('id');\n\t\t\t\tvar closestBlock = currentTarget.closest('.js-toggle-panel');\n\t\t\t\tvar bodyContents = closestBlock.find('.blockContent');\n\t\t\t\tvar data = currentTarget.data();\n\t\t\t\tvar module = app.getModuleName();\n\t\t\t\tif (data.mode === 'show') {\n\t\t\t\t\tbodyContents.addClass('d-none');\n\t\t\t\t\tapp.cacheSet(module + '.' + blockId, 0);\n\t\t\t\t\tcurrentTarget.addClass('d-none');\n\t\t\t\t\tclosestBlock.find('[data-mode=\"hide\"]').removeClass('d-none');\n\t\t\t\t} else {\n\t\t\t\t\tbodyContents.removeClass('d-none');\n\t\t\t\t\tapp.cacheSet(module + '.' + blockId, 1);\n\t\t\t\t\tcurrentTarget.addClass('d-none');\n\t\t\t\t\tclosestBlock.find('[data-mode=\"show\"]').removeClass('d-none');\n\t\t\t\t}\n\t\t\t\tapp.event.trigger('DetailView.js-block-toggle.PostLoad', bodyContents, data, thisInstance);\n\t\t\t});\n\t\t},\n\t\tregisterBlockStatusCheckOnLoad: function() {\n\t\t\tlet blocks = this.getContentHolder().find('.js-toggle-panel');\n\t\t\tlet module = app.getModuleName();\n\t\t\tblocks.each(function(index, block) {\n\t\t\t\tlet currentBlock = jQuery(block);\n\t\t\t\tlet dynamicAttr = currentBlock.attr('data-dynamic');\n\t\t\t\tif (typeof dynamicAttr !== typeof undefined && dynamicAttr !== false) {\n\t\t\t\t\tlet headerAnimationElement = currentBlock.find('.js-block-toggle').not('.d-none');\n\t\t\t\t\tlet bodyContents = currentBlock.closest('.js-toggle-panel').find('.blockContent');\n\t\t\t\t\tlet blockId = headerAnimationElement.data('id');\n\t\t\t\t\tlet cacheKey = module + '.' + blockId;\n\t\t\t\t\tlet value = app.cacheGet(cacheKey, null);\n\t\t\t\t\tif (value != null) {\n\t\t\t\t\t\tif (value == 1) {\n\t\t\t\t\t\t\theaderAnimationElement.addClass('d-none');\n\t\t\t\t\t\t\tcurrentBlock.find(\"[data-mode='show']\").removeClass('d-none');\n\t\t\t\t\t\t\tbodyContents.removeClass('d-none');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\theaderAnimationElement.addClass('d-none');\n\t\t\t\t\t\t\tcurrentBlock.find(\"[data-mode='hide']\").removeClass('d-none');\n\t\t\t\t\t\t\tbodyContents.addClass('d-none');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function to handle the ajax edit for detailview and summary view fields\n\t\t * which will expects the currentTdElement\n\t\t */\n\t\tajaxEditHandling: function(currentTdElement) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet readRecord = $('.setReadRecord'),\n\t\t\t\tdetailViewValue = $('.value', currentTdElement),\n\t\t\t\teditElement = $('.edit', currentTdElement),\n\t\t\t\tactionElement = $('.js-detail-quick-edit', currentTdElement),\n\t\t\t\tfieldElement = $('.fieldname', editElement);\n\t\t\treadRecord.prop('disabled', true);\n\t\t\t$(fieldElement).each(function(index, element) {\n\t\t\t\tlet fieldName = $(element).val(),\n\t\t\t\t\telementTarget = $(element),\n\t\t\t\t\telementName =\n\t\t\t\t\t\t$.inArray(elementTarget.data('type'), [\n\t\t\t\t\t\t\t'taxes',\n\t\t\t\t\t\t\t'sharedOwner',\n\t\t\t\t\t\t\t'multipicklist',\n\t\t\t\t\t\t\t'multiListFields',\n\t\t\t\t\t\t\t'multiDomain',\n\t\t\t\t\t\t\t'mailScannerFields',\n\t\t\t\t\t\t\t'mailScannerActions'\n\t\t\t\t\t\t]) != -1\n\t\t\t\t\t\t\t? fieldName + '[]'\n\t\t\t\t\t\t\t: fieldName;\n\t\t\t\tlet fieldElement = $('[name=\"' + elementName + '\"]:not([type=\"hidden\"])', editElement);\n\t\t\t\tif (fieldElement.attr('disabled') == 'disabled') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (editElement.length <= 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (editElement.is(':visible')) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (fieldElement.attr('data-inputmask')) {\n\t\t\t\t\tfieldElement.inputmask();\n\t\t\t\t}\n\t\t\t\tdetailViewValue.addClass('d-none');\n\t\t\t\tactionElement.addClass('d-none');\n\t\t\t\teditElement\n\t\t\t\t\t.removeClass('d-none')\n\t\t\t\t\t.children()\n\t\t\t\t\t.filter('input[type!=\"hidden\"]input[type!=\"image\"],select')\n\t\t\t\t\t.filter(':first')\n\t\t\t\t\t.focus();\n\t\t\t\tlet saveHandler = function(e) {\n\t\t\t\t\tthisInstance.registerNameAjaxEditEvent();\n\t\t\t\t\tlet element = $(e.target);\n\t\t\t\t\tif ($(e.currentTarget).find('.dateTimePickerField').length) {\n\t\t\t\t\t\tif (element.closest('.drp-calendar').length || element.hasClass('drp-calendar')) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (\n\t\t\t\t\t\telement.closest('.fieldValue').is(currentTdElement) ||\n\t\t\t\t\t\telement.hasClass('select2-selection__choice__remove') ||\n\t\t\t\t\t\telement.closest('.select2-container--open').length ||\n\t\t\t\t\t\telement.parents('.clockpicker-popover').length\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tcurrentTdElement.removeAttr('tabindex');\n\t\t\t\t\tcurrentTdElement.removeClass('is-edit-active');\n\t\t\t\t\tlet previousValue = elementTarget.data('prevValue'),\n\t\t\t\t\t\tajaxEditNewValue = elementTarget\n\t\t\t\t\t\t\t.closest('.edit')\n\t\t\t\t\t\t\t.find('[name=\"' + elementTarget.val() + '\"]')\n\t\t\t\t\t\t\t.val(),\n\t\t\t\t\t\tfieldInfo = Vtiger_Field_Js.getInstance(fieldElement.data('fieldinfo')),\n\t\t\t\t\t\tdateTimeField = [],\n\t\t\t\t\t\tdateTime = false;\n\t\t\t\t\tif (editElement.find('[data-fieldinfo]').length == 2) {\n\t\t\t\t\t\teditElement.find('[data-fieldinfo]').each(function() {\n\t\t\t\t\t\t\tlet field = {\n\t\t\t\t\t\t\t\tname: $(this).attr('name'),\n\t\t\t\t\t\t\t\ttype: $(this).data('fieldinfo').type\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tif (field['type'] == 'datetime') {\n\t\t\t\t\t\t\t\tdateTime = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdateTimeField.push(field);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (fieldElement.is('input:checkbox')) {\n\t\t\t\t\t\tif (fieldElement.is(':checked')) {\n\t\t\t\t\t\t\tajaxEditNewValue = '1';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tajaxEditNewValue = '0';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfieldElement = fieldElement.filter('[type=\"checkbox\"]');\n\t\t\t\t\t}\n\t\t\t\t\tif (fieldElement.validationEngine('validate')) {\n\t\t\t\t\t\tif (fieldElement.attr('data-inputmask')) {\n\t\t\t\t\t\t\tfieldElement.inputmask();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tfunction toStr(v) {\n\t\t\t\t\t\treturn v === undefined || v === null ? '' : v + '';\n\t\t\t\t\t}\n\t\t\t\t\tfieldElement.validationEngine('hide');\n\t\t\t\t\tif (toStr(previousValue) === toStr(ajaxEditNewValue)) {\n\t\t\t\t\t\teditElement.addClass('d-none');\n\t\t\t\t\t\tdetailViewValue.removeClass('d-none');\n\t\t\t\t\t\tactionElement.removeClass('d-none');\n\t\t\t\t\t\treadRecord.prop('disabled', false);\n\t\t\t\t\t\teditElement.off('clickoutside');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet preFieldSaveEvent = jQuery.Event(thisInstance.fieldPreSave),\n\t\t\t\t\t\t\tfieldNameValueMap = {};\n\t\t\t\t\t\tfieldElement.trigger(preFieldSaveEvent, {\n\t\t\t\t\t\t\tfieldValue: ajaxEditNewValue,\n\t\t\t\t\t\t\trecordId: thisInstance.getRecordId()\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (preFieldSaveEvent.isDefaultPrevented()) {\n\t\t\t\t\t\t\treadRecord.prop('disabled', false);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrentTdElement.progressIndicator();\n\t\t\t\t\t\teditElement.addClass('d-none');\n\t\t\t\t\t\tfieldNameValueMap['value'] = ajaxEditNewValue;\n\t\t\t\t\t\tfieldNameValueMap['field'] = fieldName;\n\t\t\t\t\t\tfieldNameValueMap = thisInstance.getCustomFieldNameValueMap(fieldNameValueMap);\n\t\t\t\t\t\tthisInstance\n\t\t\t\t\t\t\t.saveFieldValues(fieldNameValueMap)\n\t\t\t\t\t\t\t.done(function(response) {\n\t\t\t\t\t\t\t\teditElement.off('clickoutside');\n\t\t\t\t\t\t\t\treadRecord.prop('disabled', false);\n\t\t\t\t\t\t\t\tcurrentTdElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\t\tdetailViewValue.removeClass('d-none');\n\t\t\t\t\t\t\t\tactionElement.removeClass('d-none');\n\t\t\t\t\t\t\t\tif (!response.success) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconst postSaveRecordDetails = response.result;\n\t\t\t\t\t\t\t\tlet displayValue = postSaveRecordDetails[fieldName].display_value,\n\t\t\t\t\t\t\t\t\tprevDisplayValue = postSaveRecordDetails[fieldName].prev_display_value;\n\t\t\t\t\t\t\t\tif (dateTimeField.length && dateTime) {\n\t\t\t\t\t\t\t\t\tdisplayValue =\n\t\t\t\t\t\t\t\t\t\tpostSaveRecordDetails[dateTimeField[0].name].display_value +\n\t\t\t\t\t\t\t\t\t\t' ' +\n\t\t\t\t\t\t\t\t\t\tpostSaveRecordDetails[dateTimeField[1].name].display_value;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdetailViewValue.html(displayValue);\n\t\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\t\t\ttitle: app.vtranslate('JS_SAVE_NOTIFY_OK'),\n\t\t\t\t\t\t\t\t\ttext:\n\t\t\t\t\t\t\t\t\t\t'<b>' +\n\t\t\t\t\t\t\t\t\t\tfieldInfo.data.label +\n\t\t\t\t\t\t\t\t\t\t'</b><br>' +\n\t\t\t\t\t\t\t\t\t\t'<b>' +\n\t\t\t\t\t\t\t\t\t\tapp.vtranslate('JS_SAVED_FROM') +\n\t\t\t\t\t\t\t\t\t\t'</b>: ' +\n\t\t\t\t\t\t\t\t\t\tprevDisplayValue +\n\t\t\t\t\t\t\t\t\t\t'<br> ' +\n\t\t\t\t\t\t\t\t\t\t'<b>' +\n\t\t\t\t\t\t\t\t\t\tapp.vtranslate('JS_SAVED_TO') +\n\t\t\t\t\t\t\t\t\t\t'</b>: ' +\n\t\t\t\t\t\t\t\t\t\tdisplayValue,\n\t\t\t\t\t\t\t\t\ttype: 'info',\n\t\t\t\t\t\t\t\t\ttextTrusted: true\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (postSaveRecordDetails['isViewable'] === false) {\n\t\t\t\t\t\t\t\t\tlet urlObject = app.convertUrlToObject(window.location.href);\n\t\t\t\t\t\t\t\t\tif (window !== window.parent) {\n\t\t\t\t\t\t\t\t\t\twindow.parent.location.href =\n\t\t\t\t\t\t\t\t\t\t\t'index.php?module=' + urlObject['module'] + '&view=ListPreview';\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\twindow.location.href = 'index.php?module=' + urlObject['module'] + '&view=List';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else if (postSaveRecordDetails['isEditable'] === false) {\n\t\t\t\t\t\t\t\t\t$.progressIndicator({\n\t\t\t\t\t\t\t\t\t\tposition: 'html',\n\t\t\t\t\t\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\t\t\t\t\t\tenabled: true\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif (window !== window.parent) {\n\t\t\t\t\t\t\t\t\t\twindow.location.href = window.location.href.replace(\n\t\t\t\t\t\t\t\t\t\t\t'view=Detail',\n\t\t\t\t\t\t\t\t\t\t\t'view=DetailPreview'\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfieldElement.trigger(thisInstance.fieldUpdatedEvent, {\n\t\t\t\t\t\t\t\t\told: previousValue,\n\t\t\t\t\t\t\t\t\tnew: ajaxEditNewValue\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tajaxEditNewValue = ajaxEditNewValue === undefined ? '' : ajaxEditNewValue; //data cannot be undefined\n\t\t\t\t\t\t\t\telementTarget.data('prevValue', ajaxEditNewValue);\n\t\t\t\t\t\t\t\tfieldElement.data('selectedValue', ajaxEditNewValue);\n\t\t\t\t\t\t\t\tif (thisInstance.targetPicklistChange) {\n\t\t\t\t\t\t\t\t\tif ($('.js-widget-general-info', thisInstance.getForm()).length > 0) {\n\t\t\t\t\t\t\t\t\t\tthisInstance.targetPicklist.find('.js-detail-quick-edit').trigger('click');\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tthisInstance.targetPicklist.trigger('click');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tthisInstance.targetPicklistChange = false;\n\t\t\t\t\t\t\t\t\tthisInstance.targetPicklist = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tlet selectedTabElement = thisInstance.getSelectedTab();\n\t\t\t\t\t\t\t\tif (selectedTabElement.data('linkKey') == thisInstance.detailViewSummaryTabLabel) {\n\t\t\t\t\t\t\t\t\tlet detailContentsHolder = thisInstance.getContentHolder();\n\t\t\t\t\t\t\t\t\tthisInstance.reloadTabContent();\n\t\t\t\t\t\t\t\t\tthisInstance.registerSummaryViewContainerEvents(detailContentsHolder);\n\t\t\t\t\t\t\t\t\tthisInstance.registerEventForPicklistDependencySetup(thisInstance.getForm());\n\t\t\t\t\t\t\t\t\tthisInstance.registerEventForRelatedList();\n\t\t\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t\t\tselectedTabElement.data('linkKey') == thisInstance.detailViewDetailsTabLabel\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\tthisInstance.registerEventForPicklistDependencySetup(thisInstance.getForm());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthisInstance.updateRecordsPDFTemplateBtn(thisInstance.getForm());\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.fail(function(jqXHR, textStatus, errorThrown) {\n\t\t\t\t\t\t\t\teditElement.addClass('d-none');\n\t\t\t\t\t\t\t\tdetailViewValue.removeClass('d-none');\n\t\t\t\t\t\t\t\tactionElement.removeClass('d-none');\n\t\t\t\t\t\t\t\teditElement.off('clickoutside');\n\t\t\t\t\t\t\t\treadRecord.prop('disabled', false);\n\t\t\t\t\t\t\t\tcurrentTdElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\t\t\ttitle: app.vtranslate('JS_SAVE_NOTIFY_FAIL'),\n\t\t\t\t\t\t\t\t\ttext: textStatus\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\teditElement.on('clickoutside', saveHandler);\n\t\t\t});\n\t\t},\n\t\ttriggerDisplayTypeEvent: function() {\n\t\t\tvar widthType = app.cacheGet('widthType', 'narrowWidthType');\n\t\t\tif (widthType) {\n\t\t\t\tvar elements = jQuery('#detailView').find('td');\n\t\t\t\telements.addClass(widthType);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Function updates the hidden elements which is used for creating relations\n\t\t */\n\t\taddElementsToQuickCreateForCreatingRelation: function(container, customParams) {\n\t\t\tjQuery('<input type=\"hidden\" name=\"relationOperation\" value=\"true\" >').appendTo(container);\n\t\t\tjQuery.each(customParams, function(index, value) {\n\t\t\t\tjQuery('<input type=\"hidden\" name=\"' + index + '\" value=\"' + value + '\" >').appendTo(container);\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function to register event for activity widget for adding\n\t\t * event and task from the widget\n\t\t */\n\t\tregisterEventForActivityWidget: function() {\n\t\t\tvar thisInstance = this;\n\n\t\t\t/*\n\t\t\t * Register click event for add button in Related Activities widget\n\t\t\t */\n\t\t\tjQuery('.createActivity').on('click', function(e) {\n\t\t\t\tvar referenceModuleName = 'Calendar';\n\t\t\t\tvar recordId = thisInstance.getRecordId();\n\t\t\t\tvar module = app.getModuleName();\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\n\t\t\t\tlet customParams = {};\n\t\t\t\tcustomParams['sourceModule'] = module;\n\t\t\t\tcustomParams['sourceRecord'] = recordId;\n\t\t\t\tif (\n\t\t\t\t\tmodule != '' &&\n\t\t\t\t\treferenceModuleName != '' &&\n\t\t\t\t\ttypeof thisInstance.referenceFieldNames[referenceModuleName] !== 'undefined' &&\n\t\t\t\t\ttypeof thisInstance.referenceFieldNames[referenceModuleName][module] !== 'undefined'\n\t\t\t\t) {\n\t\t\t\t\tvar relField = thisInstance.referenceFieldNames[referenceModuleName][module];\n\t\t\t\t\tcustomParams[relField] = recordId;\n\t\t\t\t}\n\t\t\t\tvar fullFormUrl = element.data('url');\n\t\t\t\tvar preQuickCreateSave = function(data) {\n\t\t\t\t\tthisInstance.addElementsToQuickCreateForCreatingRelation(data, customParams);\n\t\t\t\t\tvar taskGoToFullFormButton = data\n\t\t\t\t\t\t.find('[class^=\"CalendarQuikcCreateContents\"]')\n\t\t\t\t\t\t.find('.js-full-editlink');\n\t\t\t\t\tvar eventsGoToFullFormButton = data\n\t\t\t\t\t\t.find('[class^=\"EventsQuikcCreateContents\"]')\n\t\t\t\t\t\t.find('.js-full-editlink');\n\t\t\t\t\tvar taskFullFormUrl = taskGoToFullFormButton.data('url') + '&' + fullFormUrl;\n\t\t\t\t\tvar eventsFullFormUrl = eventsGoToFullFormButton.data('url') + '&' + fullFormUrl;\n\t\t\t\t\ttaskGoToFullFormButton.data('url', taskFullFormUrl);\n\t\t\t\t\teventsGoToFullFormButton.data('url', eventsFullFormUrl);\n\t\t\t\t};\n\t\t\t\tvar callbackFunction = function() {\n\t\t\t\t\tvar widgetContainer = element.closest('.js-detail-widget');\n\t\t\t\t\tvar widgetContentBlock = widgetContainer.find('.widgetContentBlock');\n\t\t\t\t\tvar urlParams = widgetContentBlock.data('url');\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\ttype: 'GET',\n\t\t\t\t\t\tdataType: 'html',\n\t\t\t\t\t\tdata: urlParams\n\t\t\t\t\t};\n\t\t\t\t\tAppConnector.request(params).done(function(data) {\n\t\t\t\t\t\tvar activitiesWidget = widgetContainer.find('.js-detail-widget-content');\n\t\t\t\t\t\tactivitiesWidget.html(data);\n\t\t\t\t\t\tApp.Fields.Picklist.changeSelectElementView(activitiesWidget);\n\t\t\t\t\t\tthisInstance.loadWidget($('.widgetContentBlock[data-type=\"Updates\"]'));\n\t\t\t\t\t\tthisInstance.loadWidget($('.widgetContentBlock[data-name=\"Calendar\"]'));\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tlet QuickCreateParams = {};\n\t\t\t\tQuickCreateParams['callbackPostShown'] = preQuickCreateSave;\n\t\t\t\tQuickCreateParams['callbackFunction'] = callbackFunction;\n\t\t\t\tQuickCreateParams['data'] = Object.assign({}, customParams);\n\t\t\t\tQuickCreateParams['noCache'] = false;\n\t\t\t\tVtiger_Header_Js.getInstance().quickCreateModule(referenceModuleName, QuickCreateParams);\n\t\t\t});\n\t\t},\n\t\tgetEndDate: function(startDate) {\n\t\t\tvar dateTab = startDate.split('-');\n\t\t\tvar date = new Date(dateTab[0], dateTab[1], dateTab[2]);\n\t\t\tvar newDate = new Date();\n\n\t\t\tnewDate.setDate(date.getDate() + 2);\n\t\t\treturn app.getStringDate(newDate);\n\t\t},\n\t\tgetSingleEventType: function(modDay, id, type) {\n\t\t\tvar dateStartEl = jQuery('[name=\"date_start\"]');\n\t\t\tvar dateStartVal = jQuery(dateStartEl).val();\n\t\t\tvar dateStartFormat = jQuery(dateStartEl).data('date-format');\n\t\t\tvar validDateFromat = Vtiger_Helper_Js.convertToDateString(dateStartVal, dateStartFormat, modDay, type);\n\t\t\tvar map = jQuery.extend({}, ['#b6a996,black']);\n\n\t\t\tvar params = {\n\t\t\t\tmodule: 'Calendar',\n\t\t\t\taction: 'Feed',\n\t\t\t\tstart: validDateFromat,\n\t\t\t\tend: this.getEndDate(validDateFromat),\n\t\t\t\ttype: type,\n\t\t\t\tmapping: map\n\t\t\t};\n\n\t\t\tAppConnector.request(params).done(function(events) {\n\t\t\t\tvar testDate = Vtiger_Helper_Js.convertToDateString(dateStartVal, dateStartFormat, modDay);\n\t\t\t\tif (!jQuery.isEmptyObject(events)) {\n\t\t\t\t\tif (events[0]['activitytype'] === 'Task') {\n\t\t\t\t\t\tfor (var ev in events) {\n\t\t\t\t\t\t\tif (events[ev]['start'].indexOf(testDate) > -1) {\n\t\t\t\t\t\t\t\tjQuery('#' + id + ' .table').append(\n\t\t\t\t\t\t\t\t\t'<tr><td><a target=\"_blank\" href=\"' +\n\t\t\t\t\t\t\t\t\t\tevents[ev]['url'] +\n\t\t\t\t\t\t\t\t\t\t'\">' +\n\t\t\t\t\t\t\t\t\t\tevents[ev]['title'] +\n\t\t\t\t\t\t\t\t\t\t'</a></td></tr>'\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (var i = 0; i < events[0].length; i++) {\n\t\t\t\t\t\t\tif (events[0][i]['start'].indexOf(testDate) > -1) {\n\t\t\t\t\t\t\t\tjQuery('#' + id + ' .table').append(\n\t\t\t\t\t\t\t\t\t'<tr><td><a target=\"_blank\" href=\"' +\n\t\t\t\t\t\t\t\t\t\tevents[0][i]['url'] +\n\t\t\t\t\t\t\t\t\t\t'\">' +\n\t\t\t\t\t\t\t\t\t\tevents[0][i]['title'] +\n\t\t\t\t\t\t\t\t\t\t'</a></td></tr>'\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function to add module related record from summary widget\n\t\t */\n\t\tregisterFilterForAddingModuleRelatedRecordFromSummaryWidget: function(container) {\n\t\t\tvar thisInstance = this;\n\t\t\tcontainer.find('.createRecordFromFilter').on('click', function(e) {\n\t\t\t\tvar currentElement = jQuery(e.currentTarget);\n\t\t\t\tvar summaryWidgetContainer = currentElement.closest('.js-detail-widget');\n\t\t\t\tvar referenceModuleName = summaryWidgetContainer.data('moduleName');\n\t\t\t\tvar quickcreateUrl = currentElement.data('url');\n\t\t\t\tvar parentId = thisInstance.getRecordId();\n\t\t\t\tvar quickCreateParams = {};\n\t\t\t\tvar relatedField = currentElement.data('prf');\n\t\t\t\tvar autoCompleteFields = currentElement.data('acf');\n\t\t\t\tvar moduleName = currentElement\n\t\t\t\t\t.closest('.js-detail-widget-header')\n\t\t\t\t\t.find('[name=\"relatedModule\"]')\n\t\t\t\t\t.val();\n\t\t\t\tvar relatedParams = {};\n\t\t\t\tvar postQuickCreateSave = function(data) {\n\t\t\t\t\tthisInstance.postSummaryWidgetAddRecord(data, currentElement);\n\t\t\t\t\tif (referenceModuleName == 'ProjectTask') {\n\t\t\t\t\t\tthisInstance.loadModuleSummary();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (typeof relatedField !== 'undefined') {\n\t\t\t\t\trelatedParams[relatedField] = parentId;\n\t\t\t\t}\n\t\t\t\tif (typeof autoCompleteFields !== 'undefined') {\n\t\t\t\t\t$.each(autoCompleteFields, function(index, value) {\n\t\t\t\t\t\trelatedParams[index] = value;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (Object.keys(relatedParams).length > 0) {\n\t\t\t\t\tquickCreateParams['data'] = relatedParams;\n\t\t\t\t}\n\t\t\t\tquickCreateParams['noCache'] = true;\n\t\t\t\tquickCreateParams['callbackFunction'] = postQuickCreateSave;\n\t\t\t\tvar progress = jQuery.progressIndicator({\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet headerInstance;\n\t\t\t\tif (window !== window.parent) {\n\t\t\t\t\theaderInstance = window.parent.Vtiger_Header_Js.getInstance();\n\t\t\t\t} else {\n\t\t\t\t\theaderInstance = Vtiger_Header_Js.getInstance();\n\t\t\t\t}\n\t\t\t\theaderInstance.getQuickCreateForm(quickcreateUrl, moduleName, quickCreateParams).done(function(data) {\n\t\t\t\t\theaderInstance.handleQuickCreateData(data, quickCreateParams);\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t});\n\t\t\t});\n\t\t\tcontainer.find('button.selectRelation').on('click', function(e) {\n\t\t\t\tlet summaryWidgetContainer = jQuery(e.currentTarget).closest('.js-detail-widget');\n\t\t\t\tlet referenceModuleName = summaryWidgetContainer.data('moduleName');\n\t\t\t\tlet restrictionsField = $(this).data('rf');\n\t\t\t\tlet params = {\n\t\t\t\t\tmodule: referenceModuleName,\n\t\t\t\t\tsrc_module: app.getModuleName(),\n\t\t\t\t\tsrc_record: thisInstance.getRecordId(),\n\t\t\t\t\tmulti_select: true,\n\t\t\t\t\trelationId: summaryWidgetContainer.data('relationId')\n\t\t\t\t};\n\t\t\t\tif (restrictionsField && Object.keys(restrictionsField).length > 0) {\n\t\t\t\t\tparams['search_key'] = restrictionsField.key;\n\t\t\t\t\tparams['search_value'] = restrictionsField.name;\n\t\t\t\t}\n\t\t\t\tapp.showRecordsList(params, (modal, instance) => {\n\t\t\t\t\tinstance.setSelectEvent(responseData => {\n\t\t\t\t\t\tthisInstance\n\t\t\t\t\t\t\t.addRelationBetweenRecords(referenceModuleName, Object.keys(responseData))\n\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\tthisInstance.loadWidget(summaryWidgetContainer.find('.widgetContentBlock'));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tregisterAddingInventoryRecords: function() {\n\t\t\tjQuery('.createInventoryRecordFromFilter').on('click', function(e) {\n\t\t\t\tvar currentElement = jQuery(e.currentTarget);\n\t\t\t\tvar createUrl = currentElement.data('url');\n\t\t\t\tvar autoCompleteFields = currentElement.data('acf');\n\t\t\t\tvar addidtionalParams = '';\n\t\t\t\tif (typeof autoCompleteFields !== 'undefined') {\n\t\t\t\t\t$.each(autoCompleteFields, function(index, value) {\n\t\t\t\t\t\taddidtionalParams = '&' + index + '=' + value;\n\t\t\t\t\t\tcreateUrl = createUrl.concat(addidtionalParams);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\twindow.location.href = createUrl;\n\t\t\t});\n\t\t},\n\t\tregisterEmailEvent: function() {\n\t\t\tthis.getContentHolder()\n\t\t\t\t.find('.resetRelationsEmail')\n\t\t\t\t.on('click', function(e) {\n\t\t\t\t\tVtiger_Helper_Js.showConfirmationBox({\n\t\t\t\t\t\tmessage: app.vtranslate('JS_EMAIL_RESET_RELATIONS_CONFIRMATION')\n\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\t\tmodule: 'OSSMailView',\n\t\t\t\t\t\t\taction: 'Relation',\n\t\t\t\t\t\t\tmoduleName: app.getModuleName(),\n\t\t\t\t\t\t\trecord: app.getRecordId()\n\t\t\t\t\t\t}).done(function(d) {\n\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({ text: d.result });\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t},\n\t\tgetFiltersDataAndLoad: function(e, params) {\n\t\t\tvar data = this.getFiltersData(e, params);\n\t\t\tthis.loadWidget(data['container'], data['params']);\n\t\t},\n\t\tgetFiltersData: function(e, params) {\n\t\t\tif (e.currentTarget) {\n\t\t\t\tvar currentElement = jQuery(e.currentTarget);\n\t\t\t} else {\n\t\t\t\tcurrentElement = e;\n\t\t\t}\n\t\t\tvar summaryWidgetContainer = currentElement.closest('.js-detail-widget');\n\t\t\tvar widget = summaryWidgetContainer.find('.widgetContentBlock');\n\t\t\tvar url = '&' + widget.data('url');\n\t\t\tvar urlParams = {};\n\t\t\turl.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {\n\t\t\t\turlParams[key] = value;\n\t\t\t});\n\t\t\tvar urlNewParams = [];\n\t\t\tsummaryWidgetContainer\n\t\t\t\t.find('.js-detail-widget .js-switch, .js-detail-widget-header .js-filter_field')\n\t\t\t\t.each(function(n, item) {\n\t\t\t\t\tvar value = '';\n\t\t\t\t\tvar element = jQuery(item);\n\t\t\t\t\tvar name = element.data('urlparams');\n\t\t\t\t\tif (element.attr('type') == 'radio') {\n\t\t\t\t\t\tif (element.prop('checked')) {\n\t\t\t\t\t\t\tvalue =\n\t\t\t\t\t\t\t\ttypeof element.data('on-val') !== 'undefined'\n\t\t\t\t\t\t\t\t\t? element.data('on-val')\n\t\t\t\t\t\t\t\t\t: element.data('off-val');\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar selectedFilter = element.find('option:selected').val();\n\t\t\t\t\t\tvar fieldlable = element.data('fieldlable');\n\t\t\t\t\t\tvar filter = element.data('filter');\n\t\t\t\t\t\tif (selectedFilter != fieldlable) {\n\t\t\t\t\t\t\tvalue = [[filter, 'e', selectedFilter]];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (name && value) {\n\t\t\t\t\t\tif (name in urlNewParams) {\n\t\t\t\t\t\t\turlNewParams[name].push(value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\turlNewParams[name] = [value];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\tif (params != undefined) {\n\t\t\t\t$.extend(urlNewParams, params);\n\t\t\t}\n\t\t\treturn { container: $(widget), params: $.extend(urlParams, urlNewParams) };\n\t\t},\n\t\tregisterChangeFilterForWidget: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tjQuery('.js-switch').on('change', function(e, state) {\n\t\t\t\t$(e.currentTarget)\n\t\t\t\t\t.closest('.js-switch__btn')\n\t\t\t\t\t.addClass('active')\n\t\t\t\t\t.siblings()\n\t\t\t\t\t.removeClass('active');\n\t\t\t\tthisInstance.getFiltersDataAndLoad(e);\n\t\t\t});\n\t\t\tjQuery('.js-filter_field').on('select2:select', function(e, state) {\n\t\t\t\tthisInstance.getFiltersDataAndLoad(e);\n\t\t\t});\n\t\t},\n\t\tregisterChangeSwitchForWidget: function(summaryViewContainer) {\n\t\t\tvar thisInstance = this;\n\t\t\tsummaryViewContainer.find('.activityWidgetContainer').on('change', '.js-switch', function(e) {\n\t\t\t\tvar currentElement = jQuery(e.currentTarget);\n\t\t\t\tvar summaryWidgetContainer = currentElement.closest('.js-detail-widget');\n\t\t\t\tvar widget = summaryWidgetContainer.find('.widgetContentBlock');\n\t\t\t\tvar url = widget.data('url');\n\t\t\t\turl = url.replace('&type=current', '').replace('&type=history', '');\n\t\t\t\turl += '&type=';\n\t\t\t\tif (typeof currentElement.data('on-val') !== 'undefined') {\n\t\t\t\t\tsummaryWidgetContainer.find('.ativitiesPagination').removeClass('d-none');\n\t\t\t\t\turl += 'current';\n\t\t\t\t\turl = url.replace('&sortorder=DESC', '&sortorder=ASC');\n\t\t\t\t} else if (typeof currentElement.data('off-val') !== 'undefined') {\n\t\t\t\t\tsummaryWidgetContainer.find('.ativitiesPagination').addClass('d-none');\n\t\t\t\t\turl += 'history';\n\t\t\t\t\turl = url.replace('&sortorder=ASC', '&sortorder=DESC');\n\t\t\t\t}\n\t\t\t\twidget.data('url', url);\n\t\t\t\tthisInstance.loadWidget($(widget));\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function to register all the events related to summary view widgets\n\t\t */\n\t\tregisterSummaryViewContainerEvents: function(summaryViewContainer) {\n\t\t\tvar thisInstance = this;\n\t\t\tthis.registerEventForActivityWidget();\n\t\t\tthis.registerChangeFilterForWidget();\n\t\t\tthis.registerChangeSwitchForWidget(summaryViewContainer);\n\t\t\tthis.registerAddingInventoryRecords();\n\t\t\tthis.registerEmailEvent();\n\t\t\t/**\n\t\t\t * Function to handle the ajax edit for summary view fields\n\t\t\t */\n\t\t\tsummaryViewContainer.off('click').on('click', '.row .js-detail-quick-edit', function(e) {\n\t\t\t\tvar currentTarget = jQuery(e.currentTarget);\n\t\t\t\tcurrentTarget.addClass('d-none');\n\t\t\t\tvar currentTdElement = currentTarget.closest('.fieldValue');\n\t\t\t\tthisInstance.ajaxEditHandling(currentTdElement);\n\t\t\t});\n\t\t\t/**\n\t\t\t * Function to handle actions after ajax save in summary view\n\t\t\t */\n\t\t\tsummaryViewContainer.on(thisInstance.fieldUpdatedEvent, '.js-widget-general-info', function() {\n\t\t\t\tlet updatesWidget = summaryViewContainer.find(\"[data-type='Updates']\"),\n\t\t\t\t\tparams;\n\t\t\t\tif (updatesWidget.length) {\n\t\t\t\t\tparams = thisInstance.getFiltersData(updatesWidget);\n\t\t\t\t\tupdatesWidget\n\t\t\t\t\t\t.find('.btnChangesReviewedOn')\n\t\t\t\t\t\t.parent()\n\t\t\t\t\t\t.remove();\n\t\t\t\t\tthisInstance.loadWidget(updatesWidget, params['params']);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tsummaryViewContainer.on('click', '.editDefaultStatus', function(e) {\n\t\t\t\tvar currentTarget = jQuery(e.currentTarget);\n\t\t\t\tcurrentTarget.popover('hide');\n\t\t\t\tvar url = currentTarget.data('url');\n\t\t\t\tif (url) {\n\t\t\t\t\tif (currentTarget.hasClass('showEdit')) {\n\t\t\t\t\t\tvar headerInstance = Vtiger_Header_Js.getInstance();\n\t\t\t\t\t\tif (window !== window.parent) {\n\t\t\t\t\t\t\theaderInstance = window.parent.Vtiger_Header_Js.getInstance();\n\t\t\t\t\t\t}\n\t\t\t\t\t\theaderInstance.getQuickCreateForm(url, 'Calendar', { noCache: true }).done(data => {\n\t\t\t\t\t\t\theaderInstance.handleQuickCreateData(data, {\n\t\t\t\t\t\t\t\tcallbackFunction: () => {\n\t\t\t\t\t\t\t\t\tlet widget = currentTarget.closest('.widgetContentBlock');\n\t\t\t\t\t\t\t\t\tif (widget.length) {\n\t\t\t\t\t\t\t\t\t\tthisInstance.loadWidget(widget);\n\t\t\t\t\t\t\t\t\t\tlet updatesWidget = thisInstance\n\t\t\t\t\t\t\t\t\t\t\t.getContentHolder()\n\t\t\t\t\t\t\t\t\t\t\t.find(\"[data-type='Updates']\");\n\t\t\t\t\t\t\t\t\t\tif (updatesWidget.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\tthisInstance.loadWidget(updatesWidget);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tthisInstance.loadRelatedList();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tthisInstance.registerRelatedModulesRecordCount();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tapp.showModalWindow(null, url);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/*\n\t\t\t * Register the event to edit Description for related activities\n\t\t\t */\n\t\t\tsummaryViewContainer.on('click', '.editDescription', function(e) {\n\t\t\t\tlet currentTarget = jQuery(e.currentTarget),\n\t\t\t\t\tcurrentDiv = currentTarget.closest('.activityDescription'),\n\t\t\t\t\teditElement = currentDiv.find('.edit'),\n\t\t\t\t\tdetailViewElement = currentDiv.find('.value'),\n\t\t\t\t\tdescriptionText = currentDiv.find('.js-description-text'),\n\t\t\t\t\tdescriptionEmpty = currentDiv.find('.js-no-description'),\n\t\t\t\t\tsaveButton = currentDiv.find('.js-save-description'),\n\t\t\t\t\tcloseButton = currentDiv.find('.js-close-description'),\n\t\t\t\t\tactivityButtonContainer = currentDiv.find('.js-activity-buttons__container'),\n\t\t\t\t\tfieldnameElement = jQuery('.fieldname', editElement),\n\t\t\t\t\tfieldName = fieldnameElement.val(),\n\t\t\t\t\tfieldElement = jQuery('[name=\"' + fieldName + '\"]', editElement),\n\t\t\t\t\tcallbackFunction = () => {\n\t\t\t\t\t\tlet previousValue = fieldnameElement.data('prevValue'),\n\t\t\t\t\t\t\tajaxEditNewValue = fieldElement.val(),\n\t\t\t\t\t\t\tajaxEditNewLable = fieldElement.val(),\n\t\t\t\t\t\t\tactivityDiv = currentDiv.closest('.activityEntries'),\n\t\t\t\t\t\t\tactivityId = activityDiv.find('.activityId').val(),\n\t\t\t\t\t\t\tmoduleName = activityDiv.find('.activityModule').val(),\n\t\t\t\t\t\t\tactivityType = activityDiv.find('.activityType').val();\n\t\t\t\t\t\tif (previousValue == ajaxEditNewValue) {\n\t\t\t\t\t\t\tcloseDescription();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcurrentDiv.progressIndicator();\n\t\t\t\t\t\t\teditElement.add(activityButtonContainer).addClass('d-none');\n\t\t\t\t\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t\t\t\t\tresolve(fieldElement.validationEngine('validate'));\n\t\t\t\t\t\t\t}).then(errorExists => {\n\t\t\t\t\t\t\t\t//If validation fails\n\t\t\t\t\t\t\t\tif (errorExists) {\n\t\t\t\t\t\t\t\t\tVtiger_Helper_Js.addClickOutSideEvent(currentDiv, callbackFunction);\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tajaxEditNewValue = fieldElement.val(); //update editor value after conversion\n\t\t\t\t\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\t\t\t\t\taction: 'SaveAjax',\n\t\t\t\t\t\t\t\t\t\trecord: activityId,\n\t\t\t\t\t\t\t\t\t\tfield: fieldName,\n\t\t\t\t\t\t\t\t\t\tvalue: ajaxEditNewValue,\n\t\t\t\t\t\t\t\t\t\tmodule: moduleName,\n\t\t\t\t\t\t\t\t\t\tactivitytype: activityType\n\t\t\t\t\t\t\t\t\t}).done(() => {\n\t\t\t\t\t\t\t\t\t\tcurrentDiv.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\t\t\t\tdetailViewElement.removeClass('d-none');\n\t\t\t\t\t\t\t\t\t\tcurrentTarget.show();\n\t\t\t\t\t\t\t\t\t\tdescriptionText.html(ajaxEditNewLable);\n\t\t\t\t\t\t\t\t\t\tfieldnameElement.data('prevValue', ajaxEditNewValue);\n\t\t\t\t\t\t\t\t\t\tif (ajaxEditNewValue === '') {\n\t\t\t\t\t\t\t\t\t\t\tdescriptionEmpty.removeClass('d-none');\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tdescriptionEmpty.addClass('d-none');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcloseDescription = function() {\n\t\t\t\t\t\tfieldElement.val(fieldnameElement.data('prevValue'));\n\t\t\t\t\t\teditElement.add(activityButtonContainer).addClass('d-none');\n\t\t\t\t\t\tdetailViewElement.removeClass('d-none');\n\t\t\t\t\t\tcurrentTarget.show();\n\t\t\t\t\t};\n\t\t\t\tcurrentTarget.hide();\n\t\t\t\tdetailViewElement.addClass('d-none');\n\t\t\t\tactivityButtonContainer.removeClass('d-none');\n\t\t\t\teditElement.removeClass('d-none').show();\n\t\t\t\tsaveButton.off('click').one('click', callbackFunction);\n\t\t\t\tcloseButton.off('click').one('click', closeDescription);\n\t\t\t});\n\n\t\t\t/*\n\t\t\t * Register click event for add button in Related widgets\n\t\t\t * to add record from widget\n\t\t\t */\n\n\t\t\tjQuery('.changeDetailViewMode').on('click', function(e) {\n\t\t\t\tthisInstance\n\t\t\t\t\t.getTabs()\n\t\t\t\t\t.filter('[data-link-key=\"' + thisInstance.detailViewDetailsTabLabel + '\"]:not(.d-none)')\n\t\t\t\t\t.trigger('click');\n\t\t\t});\n\n\t\t\t/*\n\t\t\t * Register click event for add button in Related widgets\n\t\t\t * to add record from widget\n\t\t\t */\n\t\t\tjQuery('.createRecord').on('click', function(e) {\n\t\t\t\tvar currentElement = jQuery(e.currentTarget);\n\t\t\t\tvar summaryWidgetContainer = currentElement.closest('.js-detail-widget');\n\t\t\t\tvar widgetHeaderContainer = summaryWidgetContainer.find('.js-detail-widget-header');\n\t\t\t\tvar referenceModuleName = widgetHeaderContainer.find('[name=\"relatedModule\"]').val();\n\t\t\t\tvar recordId = thisInstance.getRecordId();\n\t\t\t\tvar module = app.getModuleName();\n\t\t\t\tvar customParams = {};\n\t\t\t\tcustomParams['sourceModule'] = module;\n\t\t\t\tcustomParams['sourceRecord'] = recordId;\n\t\t\t\tif (\n\t\t\t\t\tmodule != '' &&\n\t\t\t\t\treferenceModuleName != '' &&\n\t\t\t\t\ttypeof thisInstance.referenceFieldNames[referenceModuleName] !== 'undefined' &&\n\t\t\t\t\ttypeof thisInstance.referenceFieldNames[referenceModuleName][module] !== 'undefined'\n\t\t\t\t) {\n\t\t\t\t\tvar fieldName = thisInstance.referenceFieldNames[referenceModuleName][module];\n\t\t\t\t\tcustomParams[fieldName] = recordId;\n\t\t\t\t}\n\n\t\t\t\tvar postQuickCreateSave = function(data) {\n\t\t\t\t\tthisInstance.postSummaryWidgetAddRecord(data, currentElement);\n\t\t\t\t};\n\n\t\t\t\tvar goToFullFormcallback = function(data) {\n\t\t\t\t\tthisInstance.addElementsToQuickCreateForCreatingRelation(data, customParams);\n\t\t\t\t};\n\n\t\t\t\tvar QuickCreateParams = {};\n\t\t\t\tQuickCreateParams['callbackFunction'] = postQuickCreateSave;\n\t\t\t\tQuickCreateParams['goToFullFormcallback'] = goToFullFormcallback;\n\t\t\t\tQuickCreateParams['data'] = customParams;\n\t\t\t\tQuickCreateParams['noCache'] = false;\n\t\t\t\tVtiger_Header_Js.getInstance().quickCreateModule(referenceModuleName, QuickCreateParams);\n\t\t\t});\n\t\t\tthis.registerFastEditingFiels();\n\t\t},\n\t\taddRelationBetweenRecords: function(relatedModule, relatedModuleRecordId, selectedTabElement) {\n\t\t\tvar aDeferred = jQuery.Deferred();\n\t\t\tvar thisInstance = this;\n\t\t\tif (selectedTabElement == undefined) {\n\t\t\t\tselectedTabElement = thisInstance.getSelectedTab();\n\t\t\t}\n\t\t\tvar relatedController = Vtiger_RelatedList_Js.getInstance(\n\t\t\t\tthisInstance.getRecordId(),\n\t\t\t\tapp.getModuleName(),\n\t\t\t\tselectedTabElement,\n\t\t\t\trelatedModule\n\t\t\t);\n\t\t\trelatedController\n\t\t\t\t.addRelations(relatedModuleRecordId)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tvar summaryViewContainer = thisInstance.getContentHolder();\n\t\t\t\t\tvar updatesWidget = summaryViewContainer.find(\"[data-type='Updates']\");\n\t\t\t\t\tif (updatesWidget.length > 0) {\n\t\t\t\t\t\tvar params = thisInstance.getFiltersData(updatesWidget);\n\t\t\t\t\t\tupdatesWidget\n\t\t\t\t\t\t\t.find('.btnChangesReviewedOn')\n\t\t\t\t\t\t\t.parent()\n\t\t\t\t\t\t\t.remove();\n\t\t\t\t\t\tthisInstance.loadWidget(updatesWidget, params['params']);\n\t\t\t\t\t}\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t})\n\t\t\t\t.fail(function(textStatus, errorThrown) {\n\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\t/**\n\t\t * Function to handle Post actions after adding record from\n\t\t * summary view widget\n\t\t */\n\t\tpostSummaryWidgetAddRecord: function(data, currentElement) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar summaryWidgetContainer = currentElement.closest('.js-detail-widget');\n\t\t\tvar widgetHeaderContainer = summaryWidgetContainer.find('.js-detail-widget-header');\n\t\t\tvar referenceModuleName = widgetHeaderContainer.find('[name=\"relatedModule\"]').val();\n\t\t\tvar idList = [];\n\t\t\tidList.push(data.result._recordId);\n\t\t\tthis.addRelationBetweenRecords(referenceModuleName, idList).done(function(data) {\n\t\t\t\tthisInstance.loadWidget(summaryWidgetContainer.find('[class^=\"widgetContainer_\"]'));\n\t\t\t});\n\t\t},\n\t\tregisterChangeEventForModulesList: function() {\n\t\t\tjQuery('#tagSearchModulesList').on('change', function(e) {\n\t\t\t\tvar modulesSelectElement = jQuery(e.currentTarget);\n\t\t\t\tif (modulesSelectElement.val() == 'all') {\n\t\t\t\t\tjQuery('[name=\"tagSearchModuleResults\"]').removeClass('d-none');\n\t\t\t\t} else {\n\t\t\t\t\tjQuery('[name=\"tagSearchModuleResults\"]').removeClass('d-none');\n\t\t\t\t\tvar selectedOptionValue = modulesSelectElement.val();\n\t\t\t\t\tjQuery('[name=\"tagSearchModuleResults\"]')\n\t\t\t\t\t\t.filter(':not(#' + selectedOptionValue + ')')\n\t\t\t\t\t\t.addClass('d-none');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterEventForRelatedTabClick: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar detailContentsHolder = thisInstance.getContentHolder();\n\t\t\tvar detailContainer = detailContentsHolder.closest('div.detailViewInfo');\n\n\t\t\tjQuery('.related', detailContainer).on('click', 'li:not(.spaceRelatedList)', function(e, urlAttributes) {\n\t\t\t\tvar tabElement = jQuery(e.currentTarget);\n\t\t\t\tif (!tabElement.hasClass('dropdown')) {\n\t\t\t\t\tvar element = jQuery('<div></div>');\n\t\t\t\t\telement.progressIndicator({\n\t\t\t\t\t\tposition: 'html',\n\t\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\t\telementToBlock: detailContainer\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tvar url = tabElement.data('url');\n\t\t\t\t\tif (typeof urlAttributes !== 'undefined') {\n\t\t\t\t\t\tvar callBack = urlAttributes.callback;\n\t\t\t\t\t\tdelete urlAttributes.callback;\n\t\t\t\t\t}\n\t\t\t\t\tthisInstance\n\t\t\t\t\t\t.loadContents(url, urlAttributes)\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\tthisInstance.deSelectAllrelatedTabs();\n\t\t\t\t\t\t\tthisInstance.markTabAsSelected(tabElement);\n\t\t\t\t\t\t\tVtiger_Helper_Js.showHorizontalTopScrollBar();\n\t\t\t\t\t\t\telement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\tthisInstance.registerHelpInfo();\n\t\t\t\t\t\t\tapp.registerModal(detailContentsHolder);\n\t\t\t\t\t\t\tif (typeof callBack == 'function') {\n\t\t\t\t\t\t\t\tcallBack(data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//Summary tab is clicked\n\t\t\t\t\t\t\tif (tabElement.data('linkKey') == thisInstance.detailViewSummaryTabLabel) {\n\t\t\t\t\t\t\t\tthisInstance.loadWidgets();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthisInstance.registerBasicEvents();\n\t\t\t\t\t\t\t// Let listeners know about page state change.\n\t\t\t\t\t\t\tapp.notifyPostAjaxReady();\n\t\t\t\t\t\t\tapp.event.trigger('DetailView.Tab.AfterLoad', data, thisInstance);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\telement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function to register event for setting up picklistdependency\n\t\t * for a module if exist on change of picklist value\n\t\t */\n\t\tregisterEventForPicklistDependencySetup: function(container) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar picklistDependcyElemnt = jQuery('[name=\"picklistDependency\"]', container);\n\t\t\tif (picklistDependcyElemnt.length <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar picklistDependencyMapping = JSON.parse(picklistDependcyElemnt.val());\n\t\t\tvar sourcePicklists = Object.keys(picklistDependencyMapping);\n\t\t\tif (sourcePicklists.length <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar sourcePickListNames = [];\n\t\t\tfor (var i = 0; i < sourcePicklists.length; i++) {\n\t\t\t\tsourcePickListNames.push('[name=\"' + sourcePicklists[i] + '\"]');\n\t\t\t}\n\t\t\tsourcePickListNames = sourcePickListNames.join(',');\n\t\t\tvar sourcePickListElements = container.find(sourcePickListNames);\n\t\t\tsourcePickListElements.on('change', function(e) {\n\t\t\t\tvar currentElement = jQuery(e.currentTarget);\n\t\t\t\tvar sourcePicklistname = currentElement.attr('name');\n\n\t\t\t\tvar configuredDependencyObject = picklistDependencyMapping[sourcePicklistname];\n\t\t\t\tvar selectedValue = currentElement.val();\n\t\t\t\tvar targetObjectForSelectedSourceValue = configuredDependencyObject[selectedValue];\n\t\t\t\tvar picklistmap = configuredDependencyObject['__DEFAULT__'];\n\n\t\t\t\tif (typeof targetObjectForSelectedSourceValue === 'undefined') {\n\t\t\t\t\ttargetObjectForSelectedSourceValue = picklistmap;\n\t\t\t\t}\n\t\t\t\tjQuery.each(picklistmap, function(targetPickListName, targetPickListValues) {\n\t\t\t\t\tvar targetPickListMap = targetObjectForSelectedSourceValue[targetPickListName];\n\t\t\t\t\tif (typeof targetPickListMap === 'undefined') {\n\t\t\t\t\t\ttargetPickListMap = targetPickListValues;\n\t\t\t\t\t}\n\t\t\t\t\tvar targetPickList = jQuery('[name=\"' + targetPickListName + '\"]', container);\n\t\t\t\t\tif (targetPickList.length <= 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t//On change of SourceField value, If TargetField value is not there in mapping, make user to select the new target value also.\n\t\t\t\t\tvar selectedValue = targetPickList.data('selectedValue');\n\t\t\t\t\tif (jQuery.inArray(selectedValue, targetPickListMap) == -1) {\n\t\t\t\t\t\tthisInstance.targetPicklistChange = true;\n\t\t\t\t\t\tthisInstance.targetPicklist = targetPickList.closest('td');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthisInstance.targetPicklistChange = false;\n\t\t\t\t\t\tthisInstance.targetPicklist = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar listOfAvailableOptions = targetPickList.data('availableOptions');\n\t\t\t\t\tif (typeof listOfAvailableOptions === 'undefined') {\n\t\t\t\t\t\tlistOfAvailableOptions = jQuery('option', targetPickList);\n\t\t\t\t\t\ttargetPickList.data('available-options', listOfAvailableOptions);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar targetOptions = new jQuery();\n\t\t\t\t\tvar optionSelector = [];\n\t\t\t\t\toptionSelector.push('');\n\t\t\t\t\tfor (var i = 0; i < targetPickListMap.length; i++) {\n\t\t\t\t\t\toptionSelector.push(targetPickListMap[i]);\n\t\t\t\t\t}\n\n\t\t\t\t\tjQuery.each(listOfAvailableOptions, function(i, e) {\n\t\t\t\t\t\tvar picklistValue = jQuery(e).val();\n\t\t\t\t\t\tif (jQuery.inArray(picklistValue, optionSelector) != -1) {\n\t\t\t\t\t\t\ttargetOptions = targetOptions.add(jQuery(e));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tvar targetPickListSelectedValue = '';\n\t\t\t\t\ttargetPickListSelectedValue = targetOptions.filter('[selected]').val();\n\t\t\t\t\tif (targetPickListMap.length == 1) {\n\t\t\t\t\t\ttargetPickListSelectedValue = targetPickListMap[0]; // to automatically select picklist if only one picklistmap is present.\n\t\t\t\t\t}\n\t\t\t\t\ttargetPickList\n\t\t\t\t\t\t.html(targetOptions)\n\t\t\t\t\t\t.val(targetPickListSelectedValue)\n\t\t\t\t\t\t.trigger('change');\n\t\t\t\t});\n\t\t\t});\n\t\t\t//To Trigger the change on load\n\t\t\tsourcePickListElements.trigger('change');\n\t\t},\n\t\t/**\n\t\t * Function to get child comments\n\t\t */\n\t\tgetChildComments: function(commentId) {\n\t\t\tvar aDeferred = jQuery.Deferred();\n\t\t\tvar url =\n\t\t\t\t'module=' +\n\t\t\t\tapp.getModuleName() +\n\t\t\t\t'&view=Detail&record=' +\n\t\t\t\tthis.getRecordId() +\n\t\t\t\t'&mode=showChildComments&commentid=' +\n\t\t\t\tcommentId;\n\t\t\tvar dataObj = this.getCommentThread(url);\n\t\t\tdataObj.done(function(data) {\n\t\t\t\taDeferred.resolve(data);\n\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\t/**\n\t\t * Function to get parent comment\n\t\t * @param {number} commentId\n\t\t * @returns {string}\n\t\t */\n\t\tgetParentComments(commentId) {\n\t\t\tlet aDeferred = $.Deferred(),\n\t\t\t\turl =\n\t\t\t\t\t'module=' +\n\t\t\t\t\tapp.getModuleName() +\n\t\t\t\t\t'&view=Detail&record=' +\n\t\t\t\t\tthis.getRecordId() +\n\t\t\t\t\t'&mode=showParentComments&commentid=' +\n\t\t\t\t\tcommentId;\n\t\t\tthis.getCommentThread(url).done(function(data) {\n\t\t\t\taDeferred.resolve(data);\n\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\t/**\n\t\t * Function to show total records count in listview on hover\n\t\t * of pageNumber text\n\t\t */\n\t\tregisterEventForTotalRecordsCount: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar detailContentsHolder = this.getContentHolder();\n\t\t\tdetailContentsHolder.on('click', '.totalNumberOfRecords', function(e) {\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\tvar totalNumberOfRecords = jQuery('#totalCount').val();\n\t\t\t\telement.addClass('d-none');\n\t\t\t\telement.parent().progressIndicator({});\n\t\t\t\tif (totalNumberOfRecords == '') {\n\t\t\t\t\tvar selectedTabElement = thisInstance.getSelectedTab();\n\t\t\t\t\tvar relatedModuleName = thisInstance.getRelatedModuleName();\n\t\t\t\t\tvar relatedController = Vtiger_RelatedList_Js.getInstance(\n\t\t\t\t\t\tthisInstance.getRecordId(),\n\t\t\t\t\t\tapp.getModuleName(),\n\t\t\t\t\t\tselectedTabElement,\n\t\t\t\t\t\trelatedModuleName\n\t\t\t\t\t);\n\t\t\t\t\trelatedController.getRelatedPageCount().done(function() {\n\t\t\t\t\t\tthisInstance.showPagingInfo();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthisInstance.showPagingInfo();\n\t\t\t\t}\n\t\t\t\telement.parent().progressIndicator({ mode: 'hide' });\n\t\t\t});\n\t\t},\n\t\tshowPagingInfo: function() {\n\t\t\tvar totalNumberOfRecords = jQuery('#totalCount').val();\n\t\t\tvar pageNumberElement = jQuery('.pageNumbersText');\n\t\t\tvar pageRange = pageNumberElement.text();\n\t\t\tvar newPagingInfo = pageRange + ' (' + totalNumberOfRecords + ')';\n\t\t\tvar listViewEntriesCount = parseInt(jQuery('#noOfEntries').val());\n\t\t\tif (listViewEntriesCount != 0) {\n\t\t\t\tjQuery('.pageNumbersText').html(newPagingInfo);\n\t\t\t} else {\n\t\t\t\tjQuery('.pageNumbersText').html('');\n\t\t\t}\n\t\t},\n\t\tgetCustomFieldNameValueMap: function(fieldNameValueMap) {\n\t\t\treturn fieldNameValueMap;\n\t\t},\n\t\tregisterSetReadRecord: function(detailContentsHolder) {\n\t\t\tvar thisInstance = this;\n\t\t\tdetailContentsHolder.on('click', '.setReadRecord', function(e) {\n\t\t\t\tvar currentElement = jQuery(e.currentTarget);\n\t\t\t\tcurrentElement.closest('.btn-group').addClass('d-none');\n\t\t\t\tjQuery('#Accounts_detailView_fieldValue_was_read')\n\t\t\t\t\t.find('.value')\n\t\t\t\t\t.text(app.vtranslate('LBL_YES'));\n\t\t\t\tvar params = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: 'SaveAjax',\n\t\t\t\t\trecord: thisInstance.getRecordId(),\n\t\t\t\t\tfield: 'was_read',\n\t\t\t\t\tvalue: 'on'\n\t\t\t\t};\n\t\t\t\tAppConnector.request(params).done(function(data) {\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\ttext: app.vtranslate('JS_SET_READ_RECORD'),\n\t\t\t\t\t\ttitle: app.vtranslate('System'),\n\t\t\t\t\t\ttype: 'info'\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showPnotify(params);\n\t\t\t\t\tvar relatedTabKey = jQuery('.related li.active');\n\t\t\t\t\tif (\n\t\t\t\t\t\trelatedTabKey.data('linkKey') == thisInstance.detailViewSummaryTabLabel ||\n\t\t\t\t\t\trelatedTabKey.data('linkKey') == thisInstance.detailViewDetailsTabLabel\n\t\t\t\t\t) {\n\t\t\t\t\t\tthisInstance.reloadTabContent();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tregisterFastEditingFiels: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar fastEditingFiels = jQuery('.summaryWidgetFastEditing select');\n\t\t\tfastEditingFiels.on('change', function(e) {\n\t\t\t\tvar fieldElement = jQuery(e.currentTarget);\n\t\t\t\tvar fieldContainer = fieldElement.closest('.editField');\n\t\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\t\t\tposition: 'summaryWidgetFastEditing',\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tvar fieldName = fieldContainer.data('fieldname');\n\t\t\t\tfieldName = fieldName.replace('q_', '');\n\t\t\t\tvar fieldValue = fieldElement.val();\n\t\t\t\tvar errorExists = fieldElement.validationEngine('validate');\n\t\t\t\tif (errorExists) {\n\t\t\t\t\tfieldContainer.progressIndicator({ mode: 'hide' });\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar preFieldSaveEvent = jQuery.Event(thisInstance.fieldPreSave);\n\t\t\t\tfieldElement.trigger(preFieldSaveEvent, {\n\t\t\t\t\tfieldValue: fieldValue,\n\t\t\t\t\trecordId: thisInstance.getRecordId()\n\t\t\t\t});\n\t\t\t\tvar fieldNameValueMap = {};\n\t\t\t\tfieldNameValueMap['value'] = fieldValue;\n\t\t\t\tfieldNameValueMap['field'] = fieldName;\n\t\t\t\tfieldNameValueMap = thisInstance.getCustomFieldNameValueMap(fieldNameValueMap);\n\t\t\t\tthisInstance.saveFieldValues(fieldNameValueMap);\n\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\tvar params = {\n\t\t\t\t\ttitle: app.vtranslate('JS_SAVE_NOTIFY_OK'),\n\t\t\t\t\ttype: 'success'\n\t\t\t\t};\n\t\t\t\tVtiger_Helper_Js.showPnotify(params);\n\t\t\t\tthisInstance.reloadTabContent();\n\t\t\t});\n\t\t},\n\t\tregisterHelpInfo: function() {\n\t\t\tvar form = this.getForm();\n\t\t\tapp.showPopoverElementView(form.find('.js-help-info'));\n\t\t},\n\t\t/**\n\t\t * Register related modules record cound\n\t\t * @param {jQuery} tabContainer\n\t\t */\n\t\tregisterRelatedModulesRecordCount(tabContainer) {\n\t\t\tconst moreList = $('.related .nav .dropdown-menu');\n\t\t\tlet relationContainer = tabContainer;\n\t\t\tif (!relationContainer || typeof relationContainer.length === 'undefined') {\n\t\t\t\trelationContainer = $(\n\t\t\t\t\t'.related .nav > .relatedNav, .related .nav > .mainNav, .detailViewBlockLink, .related .nav .dropdown-menu > .relatedNav'\n\t\t\t\t);\n\t\t\t}\n\t\t\trelationContainer.each((n, item) => {\n\t\t\t\titem = $(item);\n\t\t\t\tlet relationId = item.data('relationId'),\n\t\t\t\t\trelatedModule = item.data('reference');\n\t\t\t\tif (item.data('count') === 1) {\n\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\t\taction: 'RelationAjax',\n\t\t\t\t\t\trecord: app.getRecordId(),\n\t\t\t\t\t\trelatedModule: relatedModule,\n\t\t\t\t\t\tmode: 'getRelatedListPageCount',\n\t\t\t\t\t\trelationId: relationId,\n\t\t\t\t\t\ttab_label: item.data('label-key')\n\t\t\t\t\t}).done(response => {\n\t\t\t\t\t\tif (response.success) {\n\t\t\t\t\t\t\tif (response.result.numberOfRecords === 0) {\n\t\t\t\t\t\t\t\tresponse.result.numberOfRecords = '';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\titem.find('.count').text(response.result.numberOfRecords);\n\t\t\t\t\t\t\tmoreList\n\t\t\t\t\t\t\t\t.find('[data-reference=\"${relatedModule}\"][data-relation-id=\"${relationId}\"] .count')\n\t\t\t\t\t\t\t\t.text(response.result.numberOfRecords);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function to display a new comments\n\t\t */\n\t\taddComment: function(currentTarget, data) {\n\t\t\tconst self = this;\n\t\t\tlet mode = currentTarget.data('mode'),\n\t\t\t\tclosestAddCommentBlock = currentTarget.closest('.js-add-comment-block'),\n\t\t\t\tcommentTextAreaElement = closestAddCommentBlock.find('.js-comment-content'),\n\t\t\t\tcommentInfoBlock = currentTarget.closest('.js-comment-single');\n\t\t\tcommentTextAreaElement.html('');\n\t\t\tif (mode == 'add') {\n\t\t\t\tlet commentId = data['result']['id'],\n\t\t\t\t\tcommentHtml = self.getCommentUI(commentId);\n\t\t\t\tcommentHtml.done(function(data) {\n\t\t\t\t\tlet commentBlock = closestAddCommentBlock.closest('.js-comment-details'),\n\t\t\t\t\t\tdetailContentsHolder = self.getContentHolder(),\n\t\t\t\t\t\tnoCommentsMsgContainer = $('.js-noCommentsMsgContainer', detailContentsHolder);\n\t\t\t\t\tnoCommentsMsgContainer.remove();\n\t\t\t\t\tif (commentBlock.length > 0) {\n\t\t\t\t\t\tclosestAddCommentBlock.remove();\n\t\t\t\t\t\tlet childComments = commentBlock.find('ul');\n\t\t\t\t\t\tif (childComments.length <= 0) {\n\t\t\t\t\t\t\tlet currentChildCommentsCount = commentInfoBlock\n\t\t\t\t\t\t\t\t\t.find('.js-view-thread-block')\n\t\t\t\t\t\t\t\t\t.data('data-child-comments-count'),\n\t\t\t\t\t\t\t\tnewChildCommentCount = currentChildCommentsCount + 1;\n\t\t\t\t\t\t\tcommentInfoBlock.find('.js-child-comments-count').text(newChildCommentCount);\n\t\t\t\t\t\t\tlet parentCommentId = commentInfoBlock.find('.js-comment-info-header').data('commentid');\n\t\t\t\t\t\t\tself.getChildComments(parentCommentId).done(function(responsedata) {\n\t\t\t\t\t\t\t\t$(responsedata).appendTo(commentBlock);\n\t\t\t\t\t\t\t\tcommentInfoBlock.find('.js-view-thread-block').hide();\n\t\t\t\t\t\t\t\tcommentInfoBlock.find('.hideThreadBlock').show();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$('<li class=\"js-comment-details commentDetails\">' + data + '</li>').appendTo(\n\t\t\t\t\t\t\t\tcommentBlock.find('.js-comments-body')\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$('<li class=\"js-comment-details commentDetails\">' + data + '</li>').prependTo(\n\t\t\t\t\t\t\tclosestAddCommentBlock.closest('.contents').find('.commentsList')\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tcommentInfoBlock.find('.js-comment-container').show();\n\t\t\t\t\tapp.event.trigger('DetailView.SaveComment.AfterLoad', commentInfoBlock, data);\n\t\t\t\t});\n\t\t\t} else if (mode == 'edit') {\n\t\t\t\tlet modifiedTime = commentInfoBlock.find('.js-comment-modified-time'),\n\t\t\t\t\tcommentInfoContent = commentInfoBlock.find('.js-comment-info'),\n\t\t\t\t\tcommentEditStatus = commentInfoBlock.find('.js-edited-status'),\n\t\t\t\t\tcommentReason = commentInfoBlock.find('.js-edit-reason-span');\n\t\t\t\tcommentInfoContent.html(data.result.commentcontent);\n\t\t\t\tcommentReason.html(data.result.reasontoedit);\n\t\t\t\tmodifiedTime.html(data.result.modifiedtime);\n\t\t\t\tmodifiedTime.attr('title', data.result.modifiedtimetitle);\n\t\t\t\tif (commentEditStatus.hasClass('d-none')) {\n\t\t\t\t\tcommentEditStatus.removeClass('d-none');\n\t\t\t\t}\n\t\t\t\tif (data.result.reasontoedit != '') {\n\t\t\t\t\tcommentInfoBlock.find('.js-edit-reason').removeClass('d-none');\n\t\t\t\t}\n\t\t\t\tcommentInfoContent.show();\n\t\t\t\tcommentInfoBlock.find('.js-comment-container').show();\n\t\t\t\tclosestAddCommentBlock.remove();\n\t\t\t\tapp.event.trigger('DetailView.SaveComment.AfterUpdate', commentInfoBlock, data);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Register all comment events\n\t\t * @param {jQuery} detailContentsHolder\n\t\t */\n\t\tregisterCommentEvents(detailContentsHolder) {\n\t\t\tconst self = this;\n\t\t\tdetailContentsHolder.on('click', '.js-close-comment-block', function(e) {\n\t\t\t\tlet commentInfoBlock = $(e.currentTarget.closest('.js-comment-single'));\n\t\t\t\tcommentInfoBlock.find('.js-comment-container').show();\n\t\t\t\tcommentInfoBlock.find('.js-comment-info').show();\n\t\t\t\tself.removeCommentBlockIfExists();\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.js-reply-comment', function(e) {\n\t\t\t\tself.removeCommentBlockIfExists();\n\t\t\t\tlet commentInfoBlock = $(e.currentTarget).closest('.js-comment-single');\n\t\t\t\tcommentInfoBlock.find('.js-comment-container').hide();\n\t\t\t\tself.getCommentBlock()\n\t\t\t\t\t.appendTo(commentInfoBlock)\n\t\t\t\t\t.show();\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.js-edit-comment', function(e) {\n\t\t\t\tself.removeCommentBlockIfExists();\n\t\t\t\tlet commentInfoBlock = $(e.currentTarget).closest('.js-comment-single'),\n\t\t\t\t\tcommentInfoContent = commentInfoBlock.find('.js-comment-info'),\n\t\t\t\t\teditCommentBlock = self.getEditCommentBlock();\n\t\t\t\teditCommentBlock.find('.js-comment-content').html(commentInfoContent.html());\n\t\t\t\teditCommentBlock.find('.js-reason-to-edit').html(commentInfoBlock.find('.js-edit-reason-span').text());\n\t\t\t\tcommentInfoContent.hide();\n\t\t\t\tcommentInfoBlock.find('.js-comment-container').hide();\n\t\t\t\teditCommentBlock.appendTo(commentInfoBlock).show();\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.js-detail-view-save-comment', function(e) {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tif (!element.is(':disabled')) {\n\t\t\t\t\tself.saveComment(e)\n\t\t\t\t\t\t.done(function() {\n\t\t\t\t\t\t\tself.registerRelatedModulesRecordCount();\n\t\t\t\t\t\t\tself.loadWidget(detailContentsHolder.find(\"[data-type='Comments']\")).done(function() {\n\t\t\t\t\t\t\t\telement.removeAttr('disabled');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function(error, err) {\n\t\t\t\t\t\t\telement.removeAttr('disabled');\n\t\t\t\t\t\t\tapp.errorLog(error, err);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.js-save-comment', function(e) {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tif (!element.is(':disabled')) {\n\t\t\t\t\tself.saveComment(e)\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\tself.registerRelatedModulesRecordCount(\n\t\t\t\t\t\t\t\tself.getTabByLabel(self.detailViewRecentCommentsTabLabel)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tself.addComment(element, data);\n\t\t\t\t\t\t\telement.removeAttr('disabled');\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function(error, err) {\n\t\t\t\t\t\t\telement.removeAttr('disabled');\n\t\t\t\t\t\t\tapp.errorLog(error, err);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.js-more-recent-comments ', function() {\n\t\t\t\tself.getTabByLabel(self.detailViewRecentCommentsTabLabel).trigger('click');\n\t\t\t});\n\t\t\tdetailContentsHolder.find('.js-detail-hierarchy-comments-btn').on('click', function(e) {\n\t\t\t\tif (\n\t\t\t\t\t$(this).hasClass('active') &&\n\t\t\t\t\tdetailContentsHolder.find('.js-detail-hierarchy-comments-btn.active').length < 2\n\t\t\t\t) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet recentCommentsTab = self.getTabByLabel(self.detailViewRecentCommentsTabLabel),\n\t\t\t\t\turl = recentCommentsTab.data('url'),\n\t\t\t\t\tregex = /&hierarchy=+([\\w,]+)/;\n\t\t\t\turl = url.replace(regex, '');\n\t\t\t\tlet hierarchy = [];\n\t\t\t\tif ($(this).hasClass('active')) {\n\t\t\t\t\t$(this).removeClass('active');\n\t\t\t\t} else {\n\t\t\t\t\t$(this).addClass('active');\n\t\t\t\t}\n\t\t\t\tdetailContentsHolder.find('.js-detail-hierarchy-comments-btn.active').each(function() {\n\t\t\t\t\thierarchy.push(\n\t\t\t\t\t\t$(this)\n\t\t\t\t\t\t\t.find('.js-detail-hierarchy-comments')\n\t\t\t\t\t\t\t.val()\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t\tif (hierarchy.length !== 0) {\n\t\t\t\t\turl += '&hierarchy=' + hierarchy.join(',');\n\t\t\t\t}\n\t\t\t\trecentCommentsTab.data('url', url);\n\t\t\t\trecentCommentsTab.trigger('click');\n\t\t\t});\n\t\t\tdetailContentsHolder.on('keypress', '.js-comment-search', function(e) {\n\t\t\t\tif (13 === e.which) {\n\t\t\t\t\tself.submitSearchForm(detailContentsHolder);\n\t\t\t\t}\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.js-search-icon', function(e) {\n\t\t\t\tself.submitSearchForm(detailContentsHolder);\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Submit search comment form\n\t\t * @param {jQuery} detailContentsHolder\n\t\t */\n\t\tsubmitSearchForm(detailContentsHolder) {\n\t\t\tlet searchTextDom = detailContentsHolder.find('.js-comment-search'),\n\t\t\t\twidgetContainer = searchTextDom.closest('[data-name=\"ModComments\"]'),\n\t\t\t\tprogressIndicatorElement = $.progressIndicator();\n\t\t\tif (searchTextDom.data('container') === 'widget' && !searchTextDom.val()) {\n\t\t\t\tlet request = widgetContainer.data('url');\n\t\t\t\tAppConnector.request(request).done(function(data) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tdetailContentsHolder.find('.js-comments-container').html(data);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tlet hierarchy = [],\n\t\t\t\t\tlimit = '',\n\t\t\t\t\tisWidget = false;\n\t\t\t\tif (searchTextDom.data('container') === 'widget') {\n\t\t\t\t\t(limit = widgetContainer.data('limit')), (isWidget = true);\n\t\t\t\t\twidgetContainer.find('.js-hierarchy-comments:checked').each(function() {\n\t\t\t\t\t\thierarchy.push($(this).val());\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tdetailContentsHolder.find('.js-detail-hierarchy-comments:checked').each(function() {\n\t\t\t\t\t\thierarchy.push($(this).val());\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Detail',\n\t\t\t\t\tmode: 'showSearchComments',\n\t\t\t\t\thierarchy: hierarchy.join(','),\n\t\t\t\t\tlimit: limit,\n\t\t\t\t\trecord: app.getRecordId(),\n\t\t\t\t\tsearch_key: searchTextDom.val(),\n\t\t\t\t\tis_widget: isWidget\n\t\t\t\t}).done(function(data) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tif (!searchTextDom.val()) {\n\t\t\t\t\t\tdetailContentsHolder.html(data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdetailContentsHolder.find('.js-comments-body').html(data);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Register hierarchy comments buttons\n\t\t * @param {jQuery} widgetContainer\n\t\t */\n\t\tregisterCommentEventsInDetail(widgetContainer) {\n\t\t\tnew App.Fields.Text.Completions($('.js-completions').eq(0), { emojiPanel: false });\n\t\t\twidgetContainer.on('change', '.js-hierarchy-comments', function(e) {\n\t\t\t\tlet hierarchy = [];\n\t\t\t\twidgetContainer.find('.js-hierarchy-comments').each(function() {\n\t\t\t\t\tif ($(this).is(':checked')) {\n\t\t\t\t\t\thierarchy.push($(this).val());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet progressIndicatorElement = $.progressIndicator();\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Detail',\n\t\t\t\t\tmode: 'showRecentComments',\n\t\t\t\t\thierarchy: hierarchy.join(','),\n\t\t\t\t\trecord: app.getRecordId(),\n\t\t\t\t\tlimit: widgetContainer.find('.widgetContentBlock').data('limit')\n\t\t\t\t}).done(function(data) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tlet widgetDataContainer = widgetContainer.find('.js-detail-widget-content');\n\t\t\t\t\twidgetDataContainer.html(data);\n\t\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(widgetDataContainer.find('.select2'));\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tregisterMailPreviewWidget: function(container) {\n\t\t\tconst self = this;\n\t\t\tcontainer.on('click', '.showMailBody', e => {\n\t\t\t\tlet row = $(e.currentTarget).closest('.row'),\n\t\t\t\t\tmailBody = row.find('.mailBody'),\n\t\t\t\t\tmailTeaser = row.find('.mailTeaser');\n\t\t\t\tmailBody.toggleClass('d-none');\n\t\t\t\tmailTeaser.toggleClass('d-none');\n\t\t\t});\n\t\t\tcontainer.find('[name=\"mail-type\"]').on('change', function(e) {\n\t\t\t\tself.loadMailPreviewWidget(container);\n\t\t\t});\n\t\t\tcontainer.find('[name=\"mailFilter\"]').on('change', function(e) {\n\t\t\t\tself.loadMailPreviewWidget(container);\n\t\t\t});\n\t\t\tcontainer.on('click', '.showMailsModal', e => {\n\t\t\t\tlet url = $(e.currentTarget).data('url');\n\t\t\t\turl += '&type=' + container.find('[name=\"mail-type\"]').val();\n\t\t\t\tif (container.find('[name=\"mailFilter\"]').length > 0) {\n\t\t\t\t\turl += '&mailFilter=' + container.find('[name=\"mailFilter\"]').val();\n\t\t\t\t}\n\t\t\t\tlet progressIndicatorElement = jQuery.progressIndicator();\n\t\t\t\tapp.showModalWindow('', url, data => {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tself.registerMailPreviewWidget(data);\n\t\t\t\t\tVtiger_Index_Js.registerMailButtons(data);\n\t\t\t\t\tdata.find('.expandAllMails').click();\n\t\t\t\t});\n\t\t\t});\n\t\t\tcontainer.find('.expandAllMails').on('click', function(e) {\n\t\t\t\tcontainer.find('.mailBody').removeClass('d-none');\n\t\t\t\tcontainer.find('.mailTeaser').addClass('d-none');\n\t\t\t\tcontainer\n\t\t\t\t\t.find('.showMailBody .js-toggle-icon')\n\t\t\t\t\t.removeClass('fa-caret-down')\n\t\t\t\t\t.addClass('fa-caret-up');\n\t\t\t});\n\t\t\tcontainer.find('.collapseAllMails').on('click', function(e) {\n\t\t\t\tcontainer.find('.mailBody').addClass('d-none');\n\t\t\t\tcontainer.find('.mailTeaser').removeClass('d-none');\n\t\t\t\tcontainer\n\t\t\t\t\t.find('.showMailBody .js-toggle-icon')\n\t\t\t\t\t.removeClass('fa-caret-up')\n\t\t\t\t\t.addClass('fa-caret-down');\n\t\t\t});\n\t\t},\n\t\tloadMailPreviewWidget: function(widgetContent) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar widgetDataContainer = widgetContent.find('.js-detail-widget-content');\n\t\t\tvar recordId = $('#recordId').val();\n\t\t\tvar progress = widgetDataContainer.progressIndicator();\n\t\t\tvar params = {};\n\t\t\tparams['module'] = 'OSSMailView';\n\t\t\tparams['view'] = 'Widget';\n\t\t\tparams['smodule'] = $('#module').val();\n\t\t\tparams['srecord'] = recordId;\n\t\t\tparams['mode'] = 'showEmailsList';\n\t\t\tparams['type'] = $('[name=\"mail-type\"]').val();\n\t\t\tparams['mailFilter'] = $('[name=\"mailFilter\"]').val();\n\t\t\tAppConnector.request(params).done(function(data) {\n\t\t\t\twidgetDataContainer.html(data);\n\t\t\t\tapp.event.trigger('DetailView.Widget.AfterLoad', widgetDataContainer, params['module'], thisInstance);\n\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t});\n\t\t},\n\t\tregisterEmailEvents: function(detailContentsHolder) {\n\t\t\tVtiger_Index_Js.registerMailButtons(detailContentsHolder);\n\t\t},\n\t\tregisterMapsEvents: function(container) {\n\t\t\tif (container.find('#coordinates').length) {\n\t\t\t\tvar mapView = new OpenStreetMap_Map_Js();\n\t\t\t\tmapView.registerDetailView(container);\n\t\t\t}\n\t\t},\n\t\tregisterSocialMediaEvents(container) {\n\t\t\tlet socialMediaContainer = container.find('.tpl-Detail-SocialMedia');\n\t\t\tif (socialMediaContainer.length) {\n\t\t\t}\n\t\t},\n\t\tregisterShowSummary: function(container) {\n\t\t\tcontainer.on('click', '.showSummaryRelRecord', function(e) {\n\t\t\t\tvar currentTarget = $(e.currentTarget);\n\t\t\t\tvar id = currentTarget.data('id');\n\t\t\t\tvar summaryView = container.find('.summaryRelRecordView' + id);\n\t\t\t\tcontainer.find('.listViewEntriesTable').css('display', 'none');\n\t\t\t\tsummaryView.show();\n\t\t\t});\n\t\t\tcontainer.on('click', '.hideSummaryRelRecordView', function(e) {\n\t\t\t\tvar summaryView = container.find('.summaryRelRecordView');\n\t\t\t\tcontainer.find('.listViewEntriesTable').css('display', 'table');\n\t\t\t\tsummaryView.hide();\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Show confirmation on event click\n\t\t * @param {jQuery} element\n\t\t * @param {string} picklistName\n\t\t */\n\t\tshowProgressConfirmation(element, picklistName) {\n\t\t\tconst self = this;\n\t\t\tlet picklistValue = $(element).data('picklistValue');\n\t\t\tVtiger_Helper_Js.showConfirmationBox({\n\t\t\t\ttitle: $(element).data('picklistLabel'),\n\t\t\t\tmessage: app.vtranslate('JS_CHANGE_VALUE_CONFIRMATION')\n\t\t\t}).done(() => {\n\t\t\t\tconst progressIndicatorElement = $.progressIndicator();\n\t\t\t\tself.saveFieldValues({\n\t\t\t\t\tvalue: picklistValue,\n\t\t\t\t\tfield: picklistName\n\t\t\t\t})\n\t\t\t\t\t.done(() => {\n\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(error, err) {\n\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\tapp.errorLog(error, err);\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Change status from progress\n\t\t */\n\t\tregisterProgress() {\n\t\t\tconst self = this;\n\t\t\t$('.js-header-progress-bar').each((index, element) => {\n\t\t\t\tlet picklistName = $(element).data('picklistName');\n\t\t\t\t$(element)\n\t\t\t\t\t.find('.js-access')\n\t\t\t\t\t.on('click', e => {\n\t\t\t\t\t\tself.showProgressConfirmation(e.currentTarget, picklistName);\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tloadChat() {\n\t\t\tlet chatVue = $('#ChatRecordRoomVue', this.detailViewContentHolder);\n\t\t\tif (chatVue.length) {\n\t\t\t\tlet chatContainer = this.detailViewContentHolder.find('.js-chat-container');\n\t\t\t\tconst padding = 10;\n\t\t\t\tchatContainer.height(\n\t\t\t\t\t$(document).height() - chatContainer.offset().top - $('.js-footer').outerHeight() - padding\n\t\t\t\t);\n\t\t\t\twindow.ChatRecordRoomVueComponent.mount({\n\t\t\t\t\tel: '#ChatRecordRoomVue'\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tregisterChat() {\n\t\t\tif (window.ChatRecordRoomVueComponent !== undefined) {\n\t\t\t\tthis.loadChat();\n\t\t\t\tapp.event.on('DetailView.Tab.AfterLoad', (e, data, instance) => {\n\t\t\t\t\tinstance.detailViewContentHolder.ready(() => {\n\t\t\t\t\t\tthis.loadChat();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tregisterBasicEvents: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar detailContentsHolder = thisInstance.getContentHolder();\n\t\t\tvar selectedTabElement = thisInstance.getSelectedTab();\n\t\t\t//register all the events for summary view container\n\n\t\t\tif (this.getSelectedTab().data('labelKey') === 'ModComments') {\n\t\t\t\tnew App.Fields.Text.Completions(detailContentsHolder.find('.js-completions'), { emojiPanel: false });\n\t\t\t}\n\t\t\tthisInstance.registerSummaryViewContainerEvents(detailContentsHolder);\n\t\t\tthisInstance.registerCommentEvents(detailContentsHolder);\n\t\t\tthisInstance.registerEmailEvents(detailContentsHolder);\n\t\t\tthisInstance.registerMapsEvents(detailContentsHolder);\n\t\t\tthisInstance.registerSocialMediaEvents(detailContentsHolder);\n\t\t\tthisInstance.registerSubProducts(detailContentsHolder);\n\t\t\tthisInstance.registerCollapsiblePanels(detailContentsHolder);\n\t\t\tApp.Fields.Date.register(detailContentsHolder);\n\t\t\tApp.Fields.DateTime.register(detailContentsHolder);\n\t\t\tApp.Fields.MultiImage.register(detailContentsHolder);\n\t\t\t//Attach time picker event to time fields\n\t\t\tapp.registerEventForClockPicker();\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(detailContentsHolder.find('select.select2'));\n\t\t\tnew App.Fields.Text.Editor(detailContentsHolder, { toolbar: 'Min' });\n\t\t\tdetailContentsHolder.on('click', '#detailViewNextRecordButton', function(e) {\n\t\t\t\tvar url = selectedTabElement.data('url');\n\t\t\t\tvar currentPageNum = thisInstance.getRelatedListCurrentPageNum();\n\t\t\t\tvar requestedPage = parseInt(currentPageNum) + 1;\n\t\t\t\tvar nextPageUrl = url + '&page=' + requestedPage;\n\t\t\t\tthisInstance.loadContents(nextPageUrl);\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '#detailViewPreviousRecordButton', function(e) {\n\t\t\t\tvar url = selectedTabElement.data('url');\n\t\t\t\tvar currentPageNum = thisInstance.getRelatedListCurrentPageNum();\n\t\t\t\tvar requestedPage = parseInt(currentPageNum) - 1;\n\t\t\t\tvar params = {};\n\t\t\t\tvar nextPageUrl = url + '&page=' + requestedPage;\n\t\t\t\tthisInstance.loadContents(nextPageUrl);\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', 'div.detailViewTable div.fieldValue:not(.is-edit-active)', function(e) {\n\t\t\t\tlet target = $(e.target);\n\t\t\t\tif (target.closest('a').hasClass('btnNoFastEdit') || target.hasClass('btnNoFastEdit')) return;\n\t\t\t\tlet currentTdElement = jQuery(e.currentTarget);\n\t\t\t\tcurrentTdElement.addClass('is-edit-active');\n\t\t\t\tthisInstance.ajaxEditHandling(currentTdElement);\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', 'div.recordDetails span.squeezedWell', function(e) {\n\t\t\t\tvar currentElement = jQuery(e.currentTarget);\n\t\t\t\tvar relatedLabel = currentElement.data('reference');\n\t\t\t\tjQuery('.detailViewInfo .related .nav > li[data-reference=\"' + relatedLabel + '\"]').trigger('click');\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.relatedPopup', function(e) {\n\t\t\t\tvar editViewObj = new Vtiger_Edit_Js();\n\t\t\t\teditViewObj.showRecordsList(e);\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.viewThread', function(e) {\n\t\t\t\tlet currentTarget = jQuery(e.currentTarget),\n\t\t\t\t\tcurrentTargetParent = currentTarget.parent(),\n\t\t\t\t\tcommentActionsBlock = currentTarget.closest('.js-comment-actions'),\n\t\t\t\t\tcurrentCommentBlock = currentTarget.closest('.js-comment-details'),\n\t\t\t\t\tulElements = currentCommentBlock.find('ul');\n\t\t\t\tif (ulElements.length > 0) {\n\t\t\t\t\tulElements.show();\n\t\t\t\t\tcommentActionsBlock.find('.hideThreadBlock').show();\n\t\t\t\t\tcurrentTargetParent.hide();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar commentId = currentTarget\n\t\t\t\t\t.closest('.js-comment-div')\n\t\t\t\t\t.find('.js-comment-info-header')\n\t\t\t\t\t.data('commentid');\n\t\t\t\tthisInstance.getChildComments(commentId).done(function(data) {\n\t\t\t\t\tjQuery(data).appendTo(jQuery(e.currentTarget).closest('.js-comment-details'));\n\t\t\t\t\tcommentActionsBlock.find('.hideThreadBlock').show();\n\t\t\t\t\tcurrentTargetParent.hide();\n\t\t\t\t});\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.js-view-parent-thread', function(e) {\n\t\t\t\tlet currentTarget = jQuery(e.currentTarget),\n\t\t\t\t\tcurrentTargetParent = currentTarget.parent(),\n\t\t\t\t\tcommentId = currentTarget\n\t\t\t\t\t\t.closest('.js-comment-div')\n\t\t\t\t\t\t.find('.js-comment-info-header')\n\t\t\t\t\t\t.data('commentid');\n\t\t\t\tthisInstance.getParentComments(commentId).done(function(data) {\n\t\t\t\t\t$(e.currentTarget.closest('.js-comment-details')).html(data);\n\t\t\t\t\tcurrentTarget\n\t\t\t\t\t\t.closest('.js-comment-actions')\n\t\t\t\t\t\t.find('.hideThreadBlock')\n\t\t\t\t\t\t.show();\n\t\t\t\t\tcurrentTargetParent.hide();\n\t\t\t\t});\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.js-fab__btn', e => {\n\t\t\t\t$(e.currentTarget)\n\t\t\t\t\t.closest('.js-fab__container')\n\t\t\t\t\t.toggleClass('q-fab--opened');\n\t\t\t});\n\t\t\tdetailContentsHolder.find('.js-fab__container').on('clickoutside', e => {\n\t\t\t\t$(e.currentTarget).removeClass('q-fab--opened');\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.hideThread', function(e) {\n\t\t\t\tvar currentTarget = jQuery(e.currentTarget);\n\t\t\t\tvar currentTargetParent = currentTarget.parent();\n\t\t\t\tvar commentActionsBlock = currentTarget.closest('.js-comment-actions');\n\t\t\t\tvar currentCommentBlock = currentTarget.closest('.js-comment-details');\n\t\t\t\tcurrentCommentBlock.find('ul').hide();\n\t\t\t\tcurrentTargetParent.hide();\n\t\t\t\tcommentActionsBlock.find('.js-view-thread-block').show();\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.detailViewThread', function(e) {\n\t\t\t\tvar recentCommentsTab = thisInstance.getTabByLabel(thisInstance.detailViewRecentCommentsTabLabel);\n\t\t\t\tvar commentId = jQuery(e.currentTarget)\n\t\t\t\t\t.closest('.js-comment-single')\n\t\t\t\t\t.find('.js-comment-info-header')\n\t\t\t\t\t.data('commentid');\n\t\t\t\tvar commentLoad = function(data) {\n\t\t\t\t\twindow.location.href = window.location.href + '#' + commentId;\n\t\t\t\t};\n\t\t\t\trecentCommentsTab.trigger('click', { commentid: commentId, callback: commentLoad });\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.moreRecentRecords', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tvar recentCommentsTab = thisInstance.getTabByModule(\n\t\t\t\t\t$(this).data('label-key'),\n\t\t\t\t\t$(this).data('relation-id')\n\t\t\t\t);\n\t\t\t\tif (recentCommentsTab.length) {\n\t\t\t\t\trecentCommentsTab.trigger('click');\n\t\t\t\t} else {\n\t\t\t\t\tlet currentTarget = $(e.currentTarget),\n\t\t\t\t\t\tcontainer = currentTarget.closest(\"[class^='widgetContainer_']\");\n\t\t\t\t\tif (container.length) {\n\t\t\t\t\t\tlet page = container.find('[name=\"page\"]:last').val(),\n\t\t\t\t\t\t\turl = container.data('url');\n\t\t\t\t\t\tcurrentTarget.prop('disabled', true);\n\t\t\t\t\t\turl = url.replace('&page=1', '&page=' + ++page);\n\t\t\t\t\t\tAppConnector.request(url).done(function(data) {\n\t\t\t\t\t\t\tlet dataObj = $(data),\n\t\t\t\t\t\t\t\tcontainerTable = container.find('.js-detail-widget-content table');\n\t\t\t\t\t\t\tcurrentTarget.prop('disabled', false).addClass('d-none');\n\t\t\t\t\t\t\tcontainer.find('[name=\"page\"]:last').val(dataObj.find('[name=\"page\"]').val());\n\t\t\t\t\t\t\tif (containerTable.length) {\n\t\t\t\t\t\t\t\tcontainerTable.append(dataObj.find('tbody tr'));\n\t\t\t\t\t\t\t\tif (dataObj.find('.moreRecentRecords').length) {\n\t\t\t\t\t\t\t\t\tcurrentTarget.removeClass('d-none');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcontainer.find('.js-detail-widget-content').append(dataObj);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tdetailContentsHolder.on('change', '.relatedHistoryTypes', function(e) {\n\t\t\t\tlet widgetContent = jQuery(this)\n\t\t\t\t\t\t.closest('.widgetContentBlock')\n\t\t\t\t\t\t.find('.widgetContent'),\n\t\t\t\t\tprogressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t\t\tposition: 'html',\n\t\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\t\telementToBlock: widgetContent\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Detail',\n\t\t\t\t\trecord: app.getRecordId(),\n\t\t\t\t\tmode: 'showRecentRelation',\n\t\t\t\t\tpage: 1,\n\t\t\t\t\tlimit: widgetContent.find('.js-relatedHistoryPageLimit').val(),\n\t\t\t\t\ttype: $(e.currentTarget).val()\n\t\t\t\t}).done(function(data) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\twidgetContent.find('#relatedHistoryCurrentPage').remove();\n\t\t\t\t\twidgetContent.find('#moreRelatedUpdates').remove();\n\t\t\t\t\twidgetContent.html(data);\n\t\t\t\t\tVtiger_Index_Js.registerMailButtons(widgetContent);\n\t\t\t\t});\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.moreProductsService', function() {\n\t\t\t\tjQuery('.related .mainNav[data-reference=\"ProductsAndServices\"]:not(.d-none)').trigger('click');\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.moreRelatedUpdates', function() {\n\t\t\t\tvar widgetContainer = jQuery(this).closest('.widgetContentBlock');\n\t\t\t\tvar widgetContent = widgetContainer.find('.widgetContent');\n\t\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t\tposition: 'html',\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\telementToBlock: widgetContent\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tvar currentPage = widgetContent.find('#relatedHistoryCurrentPage').val();\n\t\t\t\tvar nextPage = parseInt(currentPage) + 1;\n\t\t\t\tvar types = widgetContainer.find('.relatedHistoryTypes').val();\n\t\t\t\tvar pageLimit = widgetContent.find('#relatedHistoryPageLimit').val();\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Detail',\n\t\t\t\t\trecord: app.getRecordId(),\n\t\t\t\t\tmode: 'showRecentRelation',\n\t\t\t\t\tpage: nextPage,\n\t\t\t\t\tlimit: pageLimit,\n\t\t\t\t\ttype: types\n\t\t\t\t}).done(function(data) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\twidgetContent.find('#relatedHistoryCurrentPage').remove();\n\t\t\t\t\twidgetContent.find('#moreRelatedUpdates').remove();\n\t\t\t\t\twidgetContent.find('#relatedUpdates').append(data);\n\t\t\t\t});\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.moreRecentUpdates', function(e) {\n\t\t\t\tconst container = $(e.currentTarget).closest('.recentActivitiesContainer');\n\t\t\t\tlet newChange = container.find('#newChange').val(),\n\t\t\t\t\tnextPage = parseInt(container.find('#updatesCurrentPage').val()) + 1,\n\t\t\t\t\turl;\n\t\t\t\tif (container.closest('.js-detail-widget').length) {\n\t\t\t\t\tlet data = thisInstance.getFiltersData(\n\t\t\t\t\t\te,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpage: nextPage,\n\t\t\t\t\t\t\ttab_label: 'LBL_UPDATES',\n\t\t\t\t\t\t\tnewChange: newChange\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcontainer.find('#updates')\n\t\t\t\t\t);\n\t\t\t\t\turl = data['params'];\n\t\t\t\t} else {\n\t\t\t\t\turl = thisInstance.getTabByLabel(thisInstance.detailViewRecentUpdatesTabLabel).data('url');\n\t\t\t\t\turl = url.replace('&page=1', '&page=' + nextPage) + '&skipHeader=true&newChange=' + newChange;\n\t\t\t\t\tif (url.indexOf('&whereCondition') === -1) {\n\t\t\t\t\t\tlet switchBtn = jQuery('.active .js-switch--recentActivities');\n\t\t\t\t\t\turl +=\n\t\t\t\t\t\t\t'&whereCondition=' +\n\t\t\t\t\t\t\t(typeof switchBtn.data('on-val') === 'undefined'\n\t\t\t\t\t\t\t\t? switchBtn.data('off-val')\n\t\t\t\t\t\t\t\t: switchBtn.data('on-val'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tAppConnector.request(url).done(function(data) {\n\t\t\t\t\tlet dataContainer = jQuery(data);\n\t\t\t\t\tcontainer.find('#newChange').val(dataContainer.find('#newChange').val());\n\t\t\t\t\tcontainer.find('#updatesCurrentPage').val(dataContainer.find('#updatesCurrentPage').val());\n\t\t\t\t\tcontainer.find('.js-more-link').html(dataContainer.find('.js-more-link').html());\n\t\t\t\t\tcontainer.find('#updates ul').append(dataContainer.find('#updates ul').html());\n\t\t\t\t\tapp.event.trigger('DetailView.UpdatesWidget.AddMore', data, thisInstance);\n\t\t\t\t});\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.btnChangesReviewedOn', function(e) {\n\t\t\t\tvar progressInstance = jQuery.progressIndicator({\n\t\t\t\t\tposition: 'html',\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tvar url = 'index.php?module=ModTracker&action=ChangesReviewedOn&record=' + app.getRecordId();\n\t\t\t\tAppConnector.request(url).done(function(data) {\n\t\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tjQuery(e.currentTarget)\n\t\t\t\t\t\t.parent()\n\t\t\t\t\t\t.remove();\n\t\t\t\t\tthisInstance\n\t\t\t\t\t\t.getTabByLabel(thisInstance.detailViewRecentUpdatesTabLabel)\n\t\t\t\t\t\t.find('.count.badge')\n\t\t\t\t\t\t.text('');\n\t\t\t\t\tif (selectedTabElement.data('labelKey') == thisInstance.detailViewRecentUpdatesTabLabel) {\n\t\t\t\t\t\tthisInstance.reloadTabContent();\n\t\t\t\t\t} else if (selectedTabElement.data('linkKey') == thisInstance.detailViewSummaryTabLabel) {\n\t\t\t\t\t\tvar updatesWidget = detailContentsHolder.find(\"[data-type='Updates']\");\n\t\t\t\t\t\tif (updatesWidget.length > 0) {\n\t\t\t\t\t\t\tvar params = thisInstance.getFiltersData(updatesWidget);\n\t\t\t\t\t\t\tthisInstance.loadWidget(updatesWidget, params['params']);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.moreRecentDocuments', function() {\n\t\t\t\tvar recentDocumentsTab = thisInstance.getTabByLabel(thisInstance.detailViewRecentDocumentsTabLabel);\n\t\t\t\trecentDocumentsTab.trigger('click');\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.moreRecentActivities', function(e) {\n\t\t\t\tvar currentTarget = $(e.currentTarget);\n\t\t\t\tcurrentTarget.prop('disabled', true);\n\t\t\t\tvar container = currentTarget.closest('.activityWidgetContainer');\n\t\t\t\tvar page = container.find('.currentPage').val();\n\t\t\t\tpage++;\n\t\t\t\tvar url = container.find('.widgetContentBlock').data('url');\n\t\t\t\turl = url.replace('&page=1', '&page=' + page);\n\t\t\t\turl += '&totalCount=' + container.find('.totaltActivities').val();\n\t\t\t\tAppConnector.request(url).done(function(data) {\n\t\t\t\t\tcurrentTarget.prop('disabled', false);\n\t\t\t\t\tcurrentTarget.addClass('d-none');\n\t\t\t\t\tvar currentPage = container.find('.currentPage').val();\n\t\t\t\t\tcontainer.find('.currentPage').remove();\n\t\t\t\t\tcontainer.find('.countActivities').remove();\n\t\t\t\t\tcontainer.find('.js-detail-widget-content').append(data);\n\t\t\t\t\tcontainer\n\t\t\t\t\t\t.find('.countActivities')\n\t\t\t\t\t\t.val(\n\t\t\t\t\t\t\tparseInt(container.find('.countActivities').val()) +\n\t\t\t\t\t\t\t\tcurrentPage * parseInt(container.find('.pageLimit').val())\n\t\t\t\t\t\t);\n\t\t\t\t\tthisInstance.reloadWidgetActivitesStats(container);\n\t\t\t\t});\n\t\t\t});\n\t\t\tdetailContentsHolder.on('click', '.widgetFullscreen', function(e) {\n\t\t\t\tvar currentTarget = $(e.currentTarget);\n\t\t\t\tvar widgetContentBlock = currentTarget.closest('.widgetContentBlock');\n\t\t\t\tvar url = widgetContentBlock.data('url');\n\t\t\t\turl = url.replace('&view=Detail&', '&view=WidgetFullscreen&');\n\t\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t\tposition: 'html',\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tapp.showModalWindow(null, 'index.php?' + url, function(modal) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t});\n\t\t\t});\n\t\t\tthisInstance.registerEventForRelatedList();\n\t\t\tthisInstance.registerBlockAnimationEvent();\n\t\t\tthisInstance.registerMailPreviewWidget(\n\t\t\t\tdetailContentsHolder.find('.widgetContentBlock[data-type=\"EmailList\"]')\n\t\t\t);\n\t\t\tthisInstance.registerMailPreviewWidget(\n\t\t\t\tdetailContentsHolder.find('.widgetContentBlock[data-type=\"HistoryRelation\"]')\n\t\t\t);\n\t\t\tdetailContentsHolder\n\t\t\t\t.find('.js-switch--recentActivities')\n\t\t\t\t.off()\n\t\t\t\t.on('change', function(e) {\n\t\t\t\t\tconst currentTarget = jQuery(e.currentTarget),\n\t\t\t\t\t\ttabElement = thisInstance.getTabByLabel(thisInstance.detailViewRecentUpdatesTabLabel),\n\t\t\t\t\t\tvariableName = currentTarget.data('urlparams'),\n\t\t\t\t\t\tvalueOn = $(this).data('on-val'),\n\t\t\t\t\t\tvalueOff = $(this).data('off-val');\n\t\t\t\t\tlet url = tabElement.data('url');\n\t\t\t\t\turl = url\n\t\t\t\t\t\t.replace('&' + variableName + '=' + valueOn, '')\n\t\t\t\t\t\t.replace('&' + variableName + '=' + valueOff, '');\n\t\t\t\t\tif (typeof currentTarget.data('on-val') !== 'undefined') {\n\t\t\t\t\t\turl += '&' + variableName + '=' + valueOn;\n\t\t\t\t\t} else if (typeof currentTarget.data('off-val') !== 'undefined') {\n\t\t\t\t\t\turl += '&' + variableName + '=' + valueOff;\n\t\t\t\t\t}\n\t\t\t\t\ttabElement.data('url', url);\n\t\t\t\t\ttabElement.trigger('click');\n\t\t\t\t});\n\t\t\tapp.registerIframeEvents(detailContentsHolder);\n\t\t},\n\t\treloadWidgetActivitesStats: function(container) {\n\t\t\tvar countElement = container.find('.countActivities');\n\t\t\tvar totalElement = container.find('.totaltActivities');\n\t\t\tif (!countElement.length || !totalElement.length) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar stats = ' (' + countElement.val() + '/' + totalElement.val() + ')';\n\t\t\tvar switchBtn = container.find('.active .js-switch');\n\t\t\tvar switchBtnParent = switchBtn.parent();\n\t\t\tvar text = switchBtn.data('basic-text') + stats;\n\t\t\tswitchBtnParent.removeTextNode();\n\t\t\tswitchBtnParent.append(text);\n\t\t},\n\t\trefreshCommentContainer: function(commentId) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar commentContainer = $('.commentsBody');\n\t\t\tvar params = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\tview: 'Detail',\n\t\t\t\trecord: thisInstance.getRecordId(),\n\t\t\t\tmode: 'showThreadComments',\n\t\t\t\tcommentid: commentId\n\t\t\t};\n\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true,\n\t\t\t\t\telementToBlock: commentContainer\n\t\t\t\t}\n\t\t\t});\n\t\t\tAppConnector.request(params).done(function(data) {\n\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\tcommentContainer.html(data);\n\t\t\t});\n\t\t},\n\t\tupdateRecordsPDFTemplateBtn: function(form) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet btnToolbar = $('.js-btn-toolbar .js-pdf');\n\t\t\tif (btnToolbar.length) {\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\t\taction: 'PDF',\n\t\t\t\t\t\tmode: 'hasValidTemplate',\n\t\t\t\t\t\trecord: app.getRecordId(),\n\t\t\t\t\t\tview: app.getViewName()\n\t\t\t\t\t},\n\t\t\t\t\tdataType: 'json'\n\t\t\t\t})\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tif (data['result'].valid === false) {\n\t\t\t\t\t\t\tbtnToolbar.addClass('d-none');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbtnToolbar.removeClass('d-none');\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(data, err) {\n\t\t\t\t\t\tapp.errorLog(data, err);\n\t\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tupdateWindowHeight: function(currentHeight, frame) {\n\t\t\tframe.height(currentHeight);\n\t\t},\n\t\tloadSubProducts: function(parentRow) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet recordId = parentRow.data('product-id'),\n\t\t\t\tsubProrductParams = {\n\t\t\t\t\tmodule: 'Products',\n\t\t\t\t\taction: 'SubProducts',\n\t\t\t\t\trecord: recordId\n\t\t\t\t};\n\t\t\tAppConnector.request(subProrductParams).done(function(data) {\n\t\t\t\tlet responseData = data.result;\n\t\t\t\tthisInstance.addSubProducts(parentRow, responseData);\n\t\t\t});\n\t\t},\n\t\taddSubProducts: function(parentRow, responseData) {\n\t\t\tlet subProductsContainer = $('.js-subproducts-container ul', parentRow);\n\t\t\tfor (let id in responseData) {\n\t\t\t\tlet productText = $('<li>').text(responseData[id]);\n\t\t\t\tsubProductsContainer.append(productText);\n\t\t\t}\n\t\t},\n\t\tregisterSubProducts: function(container) {\n\t\t\tconst thisInstance = this;\n\t\t\tcontainer.find('.inventoryItems .js-inventory-row').each(function(index) {\n\t\t\t\tthisInstance.loadSubProducts($(this), false);\n\t\t\t});\n\t\t},\n\t\tregisterCollapsiblePanels(detailViewContainer) {\n\t\t\tconst panels = detailViewContainer.find('.js-detail-widget-collapse');\n\t\t\tconst storageName = `yf-${app.getModuleName()}-detail-widgets`;\n\t\t\tif (Quasar.plugins.LocalStorage.has(storageName)) {\n\t\t\t\tthis.setPanels({ panels, storageName });\n\t\t\t} else {\n\t\t\t\tpanels.collapse('show');\n\t\t\t\tlet panelsStorage = {};\n\t\t\t\tpanels.each((i, item) => {\n\t\t\t\t\tpanelsStorage[item.dataset.storageId] = 'shown';\n\t\t\t\t});\n\t\t\t\tQuasar.plugins.LocalStorage.set(storageName, panelsStorage);\n\t\t\t}\n\t\t\tpanels.on('hidden.bs.collapse shown.bs.collapse', e => {\n\t\t\t\tthis.updatePanelsStorage({ id: e.target.dataset.storageKey, type: e.type, storageName });\n\t\t\t});\n\t\t\tpanels.on('hide.bs.collapse show.bs.collapse', function(e) {\n\t\t\t\t$(e.currentTarget)\n\t\t\t\t\t.siblings('.js-detail-widget-header')\n\t\t\t\t\t.toggleClass('collapsed');\n\t\t\t});\n\t\t},\n\t\tsetPanels({ panels, storageName }) {\n\t\t\tconst panelsStorage = Quasar.plugins.LocalStorage.getItem(storageName);\n\t\t\tpanels.each((i, item) => {\n\t\t\t\tif (\n\t\t\t\t\tpanelsStorage[item.dataset.storageKey] === 'shown' ||\n\t\t\t\t\tundefined === panelsStorage[item.dataset.storageKey]\n\t\t\t\t) {\n\t\t\t\t\t$(item).collapse('show');\n\t\t\t\t\t$(item)\n\t\t\t\t\t\t.siblings('.js-detail-widget-header')\n\t\t\t\t\t\t.toggleClass('collapsed');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tupdatePanelsStorage({ id, type, storageName }) {\n\t\t\tconst panelsStorage = Quasar.plugins.LocalStorage.getItem(storageName);\n\t\t\tpanelsStorage[id] = type;\n\t\t\tQuasar.plugins.LocalStorage.set(storageName, panelsStorage);\n\t\t},\n\t\tregisterEvents: function() {\n\t\t\t//this.triggerDisplayTypeEvent();\n\t\t\tthis.registerHelpInfo();\n\t\t\tthis.registerSendSmsSubmitEvent();\n\t\t\tthis.registerAjaxEditEvent();\n\t\t\tthis.registerRelatedRowClickEvent();\n\t\t\tthis.registerBlockStatusCheckOnLoad();\n\t\t\tthis.registerEmailFieldClickEvent();\n\t\t\tthis.registerPhoneFieldClickEvent();\n\t\t\tthis.registerEventForRelatedTabClick();\n\t\t\tVtiger_Helper_Js.showHorizontalTopScrollBar();\n\t\t\tthis.registerUrlFieldClickEvent();\n\t\t\tvar detailViewContainer = jQuery('div.detailViewContainer');\n\t\t\tif (detailViewContainer.length <= 0) {\n\t\t\t\t// Not detail view page\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.registerSetReadRecord(detailViewContainer);\n\t\t\tthis.registerEventForPicklistDependencySetup(this.getForm());\n\t\t\tthis.getForm().validationEngine(app.validationEngineOptionsForRecord);\n\t\t\tthis.loadWidgetsEvents();\n\t\t\tthis.loadWidgets();\n\t\t\tthis.registerBasicEvents();\n\t\t\tthis.registerEventForTotalRecordsCount();\n\t\t\tthis.registerProgress();\n\t\t\tthis.registerChat(detailViewContainer);\n\t\t}\n\t}\n);\n"],"names":["jQuery","Class","Vtiger_Detail_Js","detailInstance","moduleClassName","app","getModuleName","getViewName","instance","window","detailActionUrl","callBackFunction","getInstance","selectedIds","push","getRecordId","actionParams","JSON","stringify","request","done","data","showModalWindow","text-align","fail","error","err","module","triggerDetailViewAction","massActionUrl","thisInstance","this","getRelatedModulesContainer","callback","validationEngineOptions","onValidationComplete","form","valid","attr","transferOwnershipSave","validationEngine","selectElement","getRelatedModuleContainer","Fields","Picklist","changeSelectElementView","transferOwner","val","relatedModules","recordId","params","success","hideModalWindow","vtranslate","oldvalue","element","find","removeAttr","trigger","Fieldname","closest","html","showPnotify","length","page","loadRelatedList","popover","treeInstance","jstree","parse","on","tasks","selected","each","index","treeElement","record_id","undefined","parent","Object","keys","loadWidgets","event","e","widgetContent","relatedModuleName","reloadWidgetActivitesStats","registerCommentEventsInDetail","registerShowSummary","registerMailButtons","progressIndicatorElement","progressIndicator","$","currentTarget","mode","registerEmailEvents","registerBlockStatusCheckOnLoad","widgetContainerELement","widgetContainer","loadWidget","registerRelatedModulesRecordCount","contentContainer","registerFilterForAddingModuleRelatedRecordFromSummaryWidget","urlParams","queryParameters","split","keyValueMap","queryParamComponents","aDeferred","Deferred","showSelect2ElementView","registerModal","relatedController","Vtiger_RelatedList_Js","getSelectedTab","setRelatedContainer","registerRelatedEvents","widgetRelatedRecordView","resolve","reject","promise","container","load","cacheKey","relatedRecordCacheID","moduleCacheGet","removeClass","addClass","controlBox","prev","next","active","hasClass","nextElement","moduleCacheSet","prevElement","url","detailContentsHolder","getContentHolder","requestPjax","responseData","Date","register","getForm","updatedFields","tabLabel","tabs","getTabs","targetTab","tab","moduleName","relationId","moduleTab","getTabContainer","deSelectAllrelatedTabs","markTabAsSelected","tabElement","topTabs","n","iteration","className","filter","get","detailViewContentHolder","detailViewForm","fieldDetailList","async","dataType","reponseData","jqXHR","textStatus","errorThrown","remove","commentMode","commentContentValue","editCommentReason","commentId","parentCommentId","commentInfoBlock","relatedTo","postData","replace","addRelationBetweenRecords","result","id","getTabByLabel","detailViewRecentCommentsTabLabel","closestCommentBlock","commentContent","errorMsg","commentInfoHeader","saveCommentAjax","clonedCommentBlock","clone","App","Text","Completions","emojiPanel","SendSmsSave","preventDefault","progressInstance","SendSmsUrl","serializeFormData","fieldUpdatedEvent","nameFields","recordLabel","nameFieldName","text","recordLabelElement","title","nameField","salutatioField","updateHeaderValues","currentElement","updateHeaderNameFields","name","getUpdateFieldsArray","inArray","stopPropagation","targetElement","target","is","children","recordUrl","location","href","getRelatedModuleName","block","blockContent","response","parents","isEmpty","registerPostLoadEvents","not","blockId","closestBlock","bodyContents","cacheSet","blocks","currentBlock","dynamicAttr","headerAnimationElement","value","cacheGet","currentTdElement","readRecord","detailViewValue","editElement","actionElement","fieldElement","prop","fieldName","elementTarget","elementName","inputmask","focus","registerNameAjaxEditEvent","previousValue","ajaxEditNewValue","fieldInfo","Vtiger_Field_Js","dateTimeField","dateTime","field","type","toStr","off","preFieldSaveEvent","Event","fieldPreSave","fieldNameValueMap","isDefaultPrevented","getCustomFieldNameValueMap","saveFieldValues","postSaveRecordDetails","displayValue","display_value","prevDisplayValue","prev_display_value","label","urlObject","convertUrlToObject","reload","targetPicklistChange","targetPicklist","selectedTabElement","detailViewSummaryTabLabel","reloadTabContent","registerSummaryViewContainerEvents","registerEventForPicklistDependencySetup","registerEventForRelatedList","detailViewDetailsTabLabel","updateRecordsPDFTemplateBtn","v","widthType","customParams","appendTo","referenceFieldNames","relField","fullFormUrl","QuickCreateParams","addElementsToQuickCreateForCreatingRelation","taskGoToFullFormButton","eventsGoToFullFormButton","taskFullFormUrl","eventsFullFormUrl","activitiesWidget","assign","quickCreateModule","startDate","dateTab","date","newDate","setDate","getDate","getStringDate","modDay","dateStartEl","dateStartVal","dateStartFormat","validDateFromat","Vtiger_Helper_Js","convertToDateString","map","extend","getEndDate","events","testDate","isEmptyObject","ev","indexOf","append","i","referenceModuleName","quickcreateUrl","parentId","quickCreateParams","relatedField","autoCompleteFields","relatedParams","postSummaryWidgetAddRecord","loadModuleSummary","progress","headerInstance","Vtiger_Header_Js","getQuickCreateForm","handleQuickCreateData","summaryWidgetContainer","restrictionsField","key","showRecordsList","modal","setSelectEvent","createUrl","addidtionalParams","concat","showConfirmationBox","d","showMessage","getFiltersData","widget","m","urlNewParams","item","selectedFilter","fieldlable","state","siblings","getFiltersDataAndLoad","summaryViewContainer","registerEventForActivityWidget","registerChangeFilterForWidget","registerChangeSwitchForWidget","registerAddingInventoryRecords","registerEmailEvent","ajaxEditHandling","updatesWidget","noCache","currentDiv","detailViewElement","descriptionText","descriptionEmpty","saveButton","closeButton","activityButtonContainer","fieldnameElement","closeDescription","add","show","hide","one","callbackFunction","ajaxEditNewLable","activityDiv","activityId","activityType","Promise","then","errorExists","addClickOutSideEvent","registerFastEditingFiels","relatedModule","relatedModuleRecordId","addRelations","idList","_recordId","modulesSelectElement","selectedOptionValue","detailContainer","urlAttributes","callBack","loadContents","showHorizontalTopScrollBar","registerHelpInfo","registerBasicEvents","notifyPostAjaxReady","picklistDependcyElemnt","picklistDependencyMapping","sourcePicklists","sourcePickListNames","join","sourcePickListElements","sourcePicklistname","configuredDependencyObject","targetObjectForSelectedSourceValue","picklistmap","targetPickListName","targetPickListValues","targetPickListMap","targetPickList","selectedValue","listOfAvailableOptions","targetOptions","optionSelector","picklistValue","targetPickListSelectedValue","getCommentThread","totalNumberOfRecords","getRelatedPageCount","showPagingInfo","newPagingInfo","parseInt","relatedTabKey","fieldContainer","fieldValue","showPopoverElementView","tabContainer","moreList","relationContainer","numberOfRecords","self","closestAddCommentBlock","commentTextAreaElement","getCommentUI","commentBlock","newChildCommentCount","getChildComments","responsedata","prependTo","modifiedTime","commentInfoContent","commentEditStatus","commentReason","commentcontent","reasontoedit","modifiedtime","modifiedtimetitle","removeCommentBlockIfExists","getCommentBlock","editCommentBlock","getEditCommentBlock","saveComment","errorLog","addComment","recentCommentsTab","hierarchy","which","submitSearchForm","searchTextDom","limit","isWidget","eq","widgetDataContainer","row","mailBody","mailTeaser","toggleClass","loadMailPreviewWidget","registerMailPreviewWidget","click","OpenStreetMap_Map_Js","registerDetailView","summaryView","css","picklistName","showProgressConfirmation","chatContainer","height","document","offset","top","outerHeight","ChatRecordRoomVueComponent","mount","loadChat","ready","registerCommentEvents","registerMapsEvents","registerSocialMediaEvents","registerSubProducts","registerCollapsiblePanels","DateTime","MultiImage","registerEventForClockPicker","Editor","toolbar","currentPageNum","getRelatedListCurrentPageNum","nextPageUrl","relatedLabel","Vtiger_Edit_Js","currentTargetParent","commentActionsBlock","ulElements","getParentComments","commentid","getTabByModule","dataObj","containerTable","currentPage","nextPage","types","pageLimit","newChange","detailViewRecentUpdatesTabLabel","switchBtn","dataContainer","detailViewRecentDocumentsTabLabel","registerBlockAnimationEvent","variableName","valueOn","valueOff","registerIframeEvents","countElement","totalElement","stats","switchBtnParent","removeTextNode","commentContainer","btnToolbar","currentHeight","frame","parentRow","subProrductParams","addSubProducts","subProductsContainer","productText","loadSubProducts","detailViewContainer","panels","storageName","Quasar","plugins","LocalStorage","has","setPanels","collapse","panelsStorage","dataset","storageId","set","updatePanelsStorage","storageKey","getItem","registerSendSmsSubmitEvent","registerAjaxEditEvent","registerRelatedRowClickEvent","registerEmailFieldClickEvent","registerPhoneFieldClickEvent","registerEventForRelatedTabClick","registerUrlFieldClickEvent","registerSetReadRecord","validationEngineOptionsForRecord","loadWidgetsEvents","registerEventForTotalRecordsCount","registerProgress","registerChat"],"mappings":"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"}