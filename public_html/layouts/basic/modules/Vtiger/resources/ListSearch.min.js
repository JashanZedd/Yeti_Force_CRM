"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},defineProperty=function(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj};jQuery.Class("YetiForce_ListSearch_Js",{getInstance:function(container,noEvents,reletedInstance,moduleName){void 0===moduleName&&(moduleName=app.getModuleName());var moduleClassName=module+"_ListSearch_Js",instance=void 0;return(instance=void 0!==window[moduleClassName]?new window[moduleClassName](container,noEvents,reletedInstance):new window.YetiForce_ListSearch_Js(container,noEvents,reletedInstance)).moduleName=moduleName,instance},registerSearch:function(container,callBack){container.on("click",".js-change-order",(function(e){var element=$(e.currentTarget);callBack({orderby:defineProperty({},element.data("columnname"),element.data("nextsortorderval"))})})),container.on("click",".js-listview_header",(function(e){var element=$(e.currentTarget);callBack({orderby:element.data("columnname"),sortorder:element.data("nextsortorderval")})})),container.on("click",".js-list-reload",(function(e,data){callBack(data)}))}},{moduleName:!1,container:!1,reletedInstance:!1,viewName:!1,init:function(container,noEvents,reletedInstance){void 0===container&&(container=jQuery(".bodyContents")),this.setContainer(container),1!=noEvents&&this.getContainer().find('[data-trigger="listSearch"]').length&&this.initialize(),this.reletedInstance=reletedInstance},setContainer:function(container){this.container=container},getContainer:function(){return this.container},setViewName:function(viewName){this.viewName=viewName},initialize:function(){this.registerEvents()},getAlphabetSearchField:function(){return jQuery("#alphabetSearchKey").val()},getAlphabetSearchValue:function(){return jQuery("#alphabetValue").val()},registerListSearch:function(){var thisInstance=this,listViewContainer=this.getContainer();listViewContainer.find('[data-trigger="listSearch"]').on("click",(function(e){thisInstance.reloadList()})),listViewContainer.find("input.listSearchContributor").on("keypress",(function(e){13==e.keyCode&&thisInstance.triggerListSearch()})),listViewContainer.find(".removeSearchConditions").on("click",(function(){thisInstance.reloadList({search_params:[],search_key:"",search_value:"",operator:""})}))},registerListViewSelect:function(){var _this=this,self=this,listViewContainer=this.getContainer();listViewContainer.find(".listViewEntriesTable .select2noactive").each((function(index,domElement){var select=$(domElement);select.data("select2")||App.Fields.Picklist.showSelect2ElementView(select,{placeholder:app.vtranslate("JS_SELECT_AN_OPTION")})})),"1"==app.getMainParams("autoRefreshListOnChange")&&(listViewContainer.find(".listViewEntriesTable select, .searchInSubcategories").on("change",(function(){_this.triggerListSearch()})),listViewContainer.find(".listViewEntriesTable .picklistSearchField").on("apply.daterangepicker",(function(){_this.triggerListSearch()})),listViewContainer.find(".listViewEntriesTable .dateField").on("DatePicker.onHide",(function(e,y){$(this).data("prevVal")!=$(this).val()&&self.triggerListSearch()})),app.event.off("Clockpicker.changed"),app.event.on("Clockpicker.changed",(function(e,inputEl){listViewContainer.find(inputEl).length&&self.triggerListSearch()})))},resetPagination:function(){jQuery("#deSelectAllMsg").trigger("click"),jQuery("#recordsCount").val(""),jQuery("#pageNumber").val("1"),jQuery("#pageToJump").val("1"),jQuery("#totalPageCount").text(""),jQuery(".pagination").data("totalCount",0)},triggerListSearch:function(){this.getContainer().find('[data-trigger="listSearch"]').trigger("click")},registerDateListSearch:function(container){App.Fields.Date.registerRange(this.getContainer().find(".dateRangeField"))},registerDateTimeListSearch:function(container){App.Fields.DateTime.register(this.getContainer())},registerTimeListSearch:function(){app.registerEventForClockPicker()},registerAlphabetClick:function(){var thisInstance=this;this.getContainer().find(".alphabetBtn").on("click",(function(){app.showModalWindow($(".alphabetModal").html(),(function(data){thisInstance.registerEventForAlphabetSearch(data)}))}))},getCurrentCvId:function(){return jQuery("#customFilter").find("option:selected").data("id")},registerEventForAlphabetSearch:function(modalContainer){var thisInstance=this;modalContainer.find(".alphabetSearch").on("click",(function(e){var alphabet=jQuery(e.currentTarget).find("a").text(),urlParams={viewname:thisInstance.getCurrentCvId(),search_key:thisInstance.getAlphabetSearchField(),search_value:alphabet,operator:"s",page:1};thisInstance.resetPagination(),thisInstance.reloadList(urlParams),app.hideModalWindow()})),modalContainer.find(".removeAlfabetCondition").on("click",(function(){thisInstance.reloadList({search_key:"",search_value:"",operator:""}),app.hideModalWindow()}))},updatePaginationOnAlphabetChange:function(alphabet,AlphabetSearchKey){var thisInstance=this,params={};params.module=thisInstance.moduleName,params.parent=app.getParentModuleName(),params.view="Pagination",params.page=1,params.mode="getPagination",params.search_key=AlphabetSearchKey,params.search_value=alphabet,params.operator="s",AppConnector.request(params).done((function(data){jQuery(".paginationDiv").html(data);var instance=thisInstance.getInstanceView();instance&&jQuery.isFunction(instance.registerPageNavigationEvents)&&instance.registerPageNavigationEvents()}))},getListSearchParams:function(urlSearchParams){var listViewTable=this.getContainer().find(".listViewEntriesTable"),searchParams=[];if(listViewTable.find(".listSearchContributor").each((function(index,domElement){var searchInfo=[],searchContributorElement=$(domElement),fieldInfo=searchContributorElement.data("fieldinfo"),fieldName=searchContributorElement.attr("name"),searchValue=searchContributorElement.val();if("object"==(void 0===searchValue?"undefined":_typeof(searchValue))&&(searchValue=null==searchValue?"":searchValue.join("##")),(searchValue=searchValue.trim()).length<=0)return!0;var searchOperator="a";fieldInfo.hasOwnProperty("searchOperator")?searchOperator=fieldInfo.searchOperator:$.inArray(fieldInfo.type,["modules","time","userCreator","owner","picklist","tree","boolean","fileLocationType","userRole","companySelect","multiReferenceValue","inventoryLimit"])>=0?searchOperator="e":"date"==fieldInfo.type||"datetime"==fieldInfo.type?searchOperator="bw":-1!=$.inArray(fieldInfo.type,["multipicklist","categoryMultipicklist","multiListFields","mailScannerFields","mailScannerActions"])&&(searchOperator="c");var sourceFieldName=searchContributorElement.data("sourceFieldName");if(sourceFieldName?searchInfo.push(fieldName+":"+searchContributorElement.data("moduleName")+":"+sourceFieldName):searchInfo.push(fieldName),searchInfo.push(searchOperator),searchInfo.push(searchValue),"tree"==fieldInfo.type||"categoryMultipicklist"==fieldInfo.type){var searchInSubcategories=jQuery('.listViewHeaders .searchInSubcategories[data-columnname="'+fieldName+'"]').prop("checked");searchInfo.push(searchInSubcategories)}searchParams.push(searchInfo)})),urlSearchParams){var valueInSearch=null,url=app.getUrlVar("search_params");if(null!=url&&url.length){var lengthUrl=url.length;"#"===url.charAt(lengthUrl-1)&&(url=url.substr(0,lengthUrl-1)),url=JSON.parse(decodeURIComponent(url)),$.each(url[0],(function(index,value){var exist=!1;if($.each(searchParams,(function(index,searchParam){searchParam[0]==value[0]&&(exist=!0)})),-1===value[0].indexOf(":"))valueInSearch=listViewTable.find('.listSearchContributor[name="'+value[0]+'"]').val();else{var fieldRelation=value[0].split(":");valueInSearch=listViewTable.find('.listSearchContributor[name="'+fieldRelation[0]+'"][data-module-name="'+fieldRelation[1]+'"][data-source-field-name="'+fieldRelation[2]+'"]').val()}0==exist&&""!=valueInSearch&&null!==valueInSearch&&searchParams.push(value)}))}}return[searchParams]},getInstanceByView:function(){var viewName=this.viewName?this.viewName:app.getViewName(),instance=!1;return"RecordsList"===viewName?((instance=this.reletedInstance).reloadFunctionName="loadRecordList",instance.execute=["updatePagination"]):this.reletedInstance?(instance=this.reletedInstance).reloadFunctionName="loadRelatedList":"Detail"===viewName?(instance=Vtiger_Detail_Js.getInstance()).reloadFunctionName="loadRelatedList":"List"==viewName?((instance=new Vtiger_List_Js).reloadFunctionName="getListViewRecords",instance.execute=["updatePagination"]):"ListPreview"==viewName&&((instance=window.pageController).reloadFunctionName="getListViewRecords",instance.execute=["updatePagination"]),instance},reloadList:function(params){var thisInstance=this;null==params&&(params={page:1});var instance=this.getInstanceByView();if(instance){var funcName=instance.reloadFunctionName;jQuery.isFunction(instance[funcName])&&instance[funcName](params).done((function(){thisInstance.resetPagination(),thisInstance.executeFunctions(instance)}))}},executeFunctions:function(instance){if(instance.execute){var func=instance.execute;for(var i in func){var funcName=func[i];jQuery.isFunction(instance[funcName])&&instance[funcName]()}}},registerBasicEvents:function(){this.registerListViewSelect(),this.registerDateListSearch(),this.registerDateTimeListSearch(),this.registerTimeListSearch(),this.registerAlphabetClick(),this.registerListSearch(),this.getContainer().find("select.select2").each((function(i,obj){$(obj).data("select2")||App.Fields.Picklist.showSelect2ElementView($(obj))}))},registerEvents:function(){this.registerBasicEvents()}});
//# sourceMappingURL=ListSearch.min.js.map
