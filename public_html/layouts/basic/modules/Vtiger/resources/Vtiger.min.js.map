{"version":3,"file":"Vtiger.min.js","sources":["Vtiger.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n * Contributor(s): YetiForce.com\n *************************************************************************************/\n'use strict';\n\nvar Vtiger_Index_Js = {\n\tshowLocation: function(element) {\n\t\tapp.showModalWindow(null, 'index.php?module=OpenStreetMap&view=MapModal', function(container) {\n\t\t\tvar mapView = new OpenStreetMap_Map_Js();\n\t\t\tmapView.registerModalView(container);\n\t\t\tcontainer.find('.searchValue').val($(element).data('location'));\n\t\t\tcontainer.find('.searchBtn').trigger('click');\n\t\t});\n\t},\n\tmassAddDocuments: function(url) {\n\t\tapp.showModalWindow(null, url, function(container) {\n\t\t\tvar uploadButton = container.find('#filesToUpload');\n\t\t\tvar template = container.find('.fileContainer');\n\t\t\tvar uploadContainer = container.find('.uploadFileContainer');\n\t\t\tvar form = container.find('form');\n\t\t\tuploadButton.on('change', function() {\n\t\t\t\tuploadContainer.find('.fileItem').remove();\n\t\t\t\tvar files = uploadButton[0].files;\n\t\t\t\tfor (var i = 0; i < files.length; i++) {\n\t\t\t\t\tuploadContainer.append(template.html());\n\t\t\t\t\tuploadContainer.find('[name=\"nameFile[]\"]:last').val(files[i].name);\n\t\t\t\t}\n\t\t\t});\n\t\t\tform.on('submit', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tapp.removeEmptyFilesInput(form[0]);\n\t\t\t\tvar formData = new FormData(form[0]);\n\t\t\t\turl = 'index.php';\n\t\t\t\tif (app.getViewName() === 'Detail') {\n\t\t\t\t\tformData.append('createmode', 'link');\n\t\t\t\t\tformData.append('return_module', app.getModuleName());\n\t\t\t\t\tformData.append('return_id', app.getRecordId());\n\t\t\t\t}\n\t\t\t\tvar params = {\n\t\t\t\t\turl: url,\n\t\t\t\t\ttype: 'POST',\n\t\t\t\t\tdata: formData,\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tcontentType: false\n\t\t\t\t};\n\t\t\t\tvar progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\tblockInfo: { enabled: true }\n\t\t\t\t});\n\t\t\t\tAppConnector.request(params).done(function(data) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\tvar relatedModuleName = 'Documents';\n\t\t\t\t\tif (app.getViewName() === 'Detail') {\n\t\t\t\t\t\tvar detailView = Vtiger_Detail_Js.getInstance();\n\t\t\t\t\t\tvar selectedTabElement = detailView.getSelectedTab();\n\t\t\t\t\t\tif (selectedTabElement.data('reference') === relatedModuleName) {\n\t\t\t\t\t\t\tdetailView.reloadTabContent();\n\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\tdetailView\n\t\t\t\t\t\t\t\t.getContentHolder()\n\t\t\t\t\t\t\t\t.find('.detailViewBlockLink')\n\t\t\t\t\t\t\t\t.data('reference') === relatedModuleName\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tVtiger_RelatedList_Js.getInstance(\n\t\t\t\t\t\t\t\tdetailView.getRecordId(),\n\t\t\t\t\t\t\t\tapp.getModuleName(),\n\t\t\t\t\t\t\t\tselectedTabElement,\n\t\t\t\t\t\t\t\trelatedModuleName\n\t\t\t\t\t\t\t).loadRelatedList();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar updatesWidget = detailView\n\t\t\t\t\t\t\t\t.getContentHolder()\n\t\t\t\t\t\t\t\t.find(\"[data-type='RelatedModule'][data-name='Documents']\");\n\t\t\t\t\t\t\tif (updatesWidget.length > 0) {\n\t\t\t\t\t\t\t\tvar params = detailView.getFiltersData(updatesWidget);\n\t\t\t\t\t\t\t\tdetailView.loadWidget(updatesWidget, params['params']);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tVtiger_List_Js.getInstance().getListViewRecords();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\tgetEmailFromRecord(record, module, maxEmails) {\n\t\tconst aDeferred = $.Deferred();\n\t\tconst progress = $.progressIndicator({ position: 'html', blockInfo: { enabled: true } });\n\t\tAppConnector.request({\n\t\t\tdataType: 'html',\n\t\t\tdata: {\n\t\t\t\tmodule: 'OSSMail',\n\t\t\t\taction: 'GetMail',\n\t\t\t\tsourceModule: module,\n\t\t\t\tsourceRecord: record,\n\t\t\t\tmaxEmails: maxEmails\n\t\t\t}\n\t\t})\n\t\t\t.done(data => {\n\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\tif (data.substring(0, 1) == '{') {\n\t\t\t\t\tdata = JSON.parse(data);\n\t\t\t\t\tdata = data['result'];\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t} else {\n\t\t\t\t\tapp.showModalWindow(data, data => {\n\t\t\t\t\t\tdata.find('.selectButton').on('click', e => {\n\t\t\t\t\t\t\tif (data.find('input:checked').length) {\n\t\t\t\t\t\t\t\tlet email = data.find('input:checked').val();\n\t\t\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t\t\t\taDeferred.resolve(email);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\t\t\ttext: app.vtranslate('JS_SELECT_AN_OPTION'),\n\t\t\t\t\t\t\t\t\ttype: 'info'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.fail((error, err) => {\n\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\taDeferred.reject(error);\n\t\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\tregisterMailButtons: function(container) {\n\t\tvar thisInstance = this;\n\t\tcontainer.find('.sendMailBtn:not(.mailBtnActive)').each(function(e) {\n\t\t\tvar sendButton = $(this);\n\t\t\tsendButton.addClass('mailBtnActive');\n\t\t\tsendButton.on('click', function(e) {\n\t\t\t\te.stopPropagation();\n\t\t\t\tvar url = sendButton.data('url');\n\t\t\t\tvar popup = sendButton.data('popup');\n\t\t\t\tvar toMail = sendButton.data('to');\n\t\t\t\tif (toMail) {\n\t\t\t\t\turl += '&to=' + toMail;\n\t\t\t\t}\n\t\t\t\tif (app.getRecordId() && sendButton.data('record') !== app.getRecordId()) {\n\t\t\t\t\turl += '&crmModule=' + app.getModuleName() + '&crmRecord=' + app.getRecordId();\n\t\t\t\t}\n\t\t\t\tthisInstance.sendMailWindow(url, popup);\n\t\t\t});\n\t\t});\n\t},\n\tsendMailWindow: function(url, popup, postData) {\n\t\tif (popup) {\n\t\t\tvar width = screen.width - 15;\n\t\t\tvar height = screen.height - 150;\n\t\t\tvar left = 0;\n\t\t\tvar top = 30;\n\t\t\tvar popupParams = 'width=' + width + ', height=' + height + ', left=' + left + ', top=' + top;\n\t\t\tif (postData == undefined) {\n\t\t\t\twindow.open(\n\t\t\t\t\turl,\n\t\t\t\t\t'_blank',\n\t\t\t\t\tpopupParams + ',resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,status=nomenubar=no'\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar form = $('<form/>', { action: 'index.php' });\n\t\t\turl.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {\n\t\t\t\tform.append($('<input>', { name: key, value: value }));\n\t\t\t});\n\t\t\tfor (var i in postData) {\n\t\t\t\tform.append($('<input>', { name: i, value: JSON.stringify(postData[i]) }));\n\t\t\t}\n\t\t\t$('body').append(form);\n\t\t\tform.submit();\n\t\t} else {\n\t\t\twindow.location.href = url;\n\t\t}\n\t},\n\tregisterWidgetsEvents: function() {\n\t\tvar widgets = $('div.widgetContainer');\n\t\twidgets.on('shown.bs.collapse', function(e) {\n\t\t\tvar widgetContainer = $(e.currentTarget);\n\t\t\tVtiger_Index_Js.loadWidgets(widgetContainer);\n\t\t\tvar key = widgetContainer.attr('id');\n\t\t\tapp.cacheSet(key, 1);\n\t\t});\n\t\twidgets.on('hidden.bs.collapse', function(e) {\n\t\t\tvar widgetContainer = $(e.currentTarget);\n\t\t\tvar imageEle = widgetContainer.parent().find('.imageElement');\n\t\t\tvar imagePath = imageEle.data('rightimage');\n\t\t\timageEle.attr('src', imagePath);\n\t\t\tvar key = widgetContainer.attr('id');\n\t\t\tapp.cacheSet(key, 0);\n\t\t});\n\t},\n\t/**\n\t * Function is used to load the sidebar widgets\n\t * @param widgetContainer - widget container\n\t * @param open - widget should be open or closed\n\t */\n\tloadWidgets: function(widgetContainer, open) {\n\t\tvar message = $('.loadingWidgetMsg').html();\n\t\tif (\n\t\t\twidgetContainer\n\t\t\t\t.find('.card-body')\n\t\t\t\t.html()\n\t\t\t\t.trim()\n\t\t) {\n\t\t\tvar imageEle = widgetContainer.parent().find('.imageElement');\n\t\t\tvar imagePath = imageEle.data('downimage');\n\t\t\timageEle.attr('src', imagePath);\n\t\t\twidgetContainer.css('height', 'auto');\n\t\t\treturn;\n\t\t}\n\n\t\twidgetContainer.progressIndicator({ message: message });\n\t\tvar url = widgetContainer.data('url');\n\t\tvar listViewWidgetParams = {\n\t\t\ttype: 'GET',\n\t\t\turl: 'index.php',\n\t\t\tdataType: 'html',\n\t\t\tdata: url\n\t\t};\n\t\tAppConnector.request(listViewWidgetParams).done(function(data) {\n\t\t\tif (typeof open === 'undefined') open = true;\n\t\t\tif (open) {\n\t\t\t\twidgetContainer.progressIndicator({ mode: 'hide' });\n\t\t\t\tvar imageEle = widgetContainer.parent().find('.imageElement');\n\t\t\t\tvar imagePath = imageEle.data('downimage');\n\t\t\t\timageEle.attr('src', imagePath);\n\t\t\t\twidgetContainer.css('height', 'auto');\n\t\t\t}\n\t\t\twidgetContainer.html(data);\n\t\t\tif (data == '') {\n\t\t\t\twidgetContainer.closest('.quickWidget').addClass('d-none');\n\t\t\t} else {\n\t\t\t\tvar label = widgetContainer\n\t\t\t\t\t.closest('.quickWidget')\n\t\t\t\t\t.find('.quickWidgetHeader')\n\t\t\t\t\t.data('label');\n\t\t\t}\n\t\t\t$('.bodyContents').trigger('Vtiger.Widget.Load.' + label, $(widgetContainer));\n\t\t});\n\t},\n\tloadWidgetsOnLoad: function() {\n\t\tvar widgets = $('div.widgetContainer');\n\t\twidgets.each(function(index, element) {\n\t\t\tVtiger_Index_Js.loadWidgets($(element));\n\t\t});\n\t},\n\t/**\n\t * Function to change user theme(colour)\n\t * @params : colour name\n\t */\n\tchangeSkin: function() {\n\t\t$('.themeElement').on('click', function(e) {\n\t\t\te.stopPropagation();\n\t\t\tvar currentElement = $(e.currentTarget);\n\t\t\tcurrentElement.closest('#themeContainer').hide();\n\t\t\tvar progressElement = $('#progressDiv');\n\t\t\tprogressElement.progressIndicator();\n\t\t\tvar params = {\n\t\t\t\tmodule: 'Users',\n\t\t\t\taction: 'SaveAjax',\n\t\t\t\trecord: CONFIG.userId,\n\t\t\t\tfield: 'theme',\n\t\t\t\tvalue: currentElement.data('skinName')\n\t\t\t};\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tif (data.success && data.result) {\n\t\t\t\t\t\tprogressElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t$('.settingIcons').removeClass('open');\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fail(function(error, err) {});\n\t\t});\n\t},\n\tmarkNotifications: function(id) {\n\t\tvar aDeferred = $.Deferred();\n\t\tvar thisInstance = this;\n\t\tvar params = {\n\t\t\tmodule: 'Notification',\n\t\t\taction: 'Notification',\n\t\t\tmode: 'setMark',\n\t\t\tids: id\n\t\t};\n\t\tAppConnector.request(params)\n\t\t\t.done(function(data) {\n\t\t\t\tvar row = $('.notificationEntries .noticeRow[data-id=\"' + id + '\"]');\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttitle: app.vtranslate('JS_MESSAGE'),\n\t\t\t\t\ttext: app.vtranslate('JS_MARKED_AS_READ'),\n\t\t\t\t\ttype: 'info'\n\t\t\t\t});\n\t\t\t\tif (row.length) {\n\t\t\t\t\trow.fadeOut(300, function() {\n\t\t\t\t\t\tvar entries = row.closest('.notificationEntries');\n\t\t\t\t\t\trow.remove();\n\t\t\t\t\t\tentries.each(function(index) {\n\t\t\t\t\t\t\tvar block = $(this);\n\t\t\t\t\t\t\tif (block.find('.noticeRow').length == 0) {\n\t\t\t\t\t\t\t\tblock.closest('.panel').hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tthisInstance.getNotificationsForReminder();\n\t\t\t\t}\n\t\t\t\taDeferred.resolve(data);\n\t\t\t})\n\t\t\t.fail(function(textStatus, errorThrown) {\n\t\t\t\tapp.errorLog(textStatus, errorThrown);\n\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\tmarkAllNotifications: function(element) {\n\t\tvar ids = [];\n\t\tvar li = $(element).closest('.notificationContainer');\n\t\tli.find('.notificationEntries .noticeRow').each(function(index) {\n\t\t\tids.push($(this).data('id'));\n\t\t});\n\t\tif (ids.length == 0) {\n\t\t\telement.remove();\n\t\t\treturn false;\n\t\t}\n\t\tvar params = {\n\t\t\tmodule: 'Notification',\n\t\t\taction: 'Notification',\n\t\t\tmode: 'setMark',\n\t\t\tids: ids\n\t\t};\n\t\tli.progressIndicator({ position: 'html' });\n\t\tAppConnector.request(params).done(function(data) {\n\t\t\tli.progressIndicator({ mode: 'hide' });\n\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\ttitle: app.vtranslate('JS_MESSAGE'),\n\t\t\t\ttext: app.vtranslate('JS_MARKED_AS_READ'),\n\t\t\t\ttype: 'info'\n\t\t\t});\n\t\t\tVtiger_Index_Js.getNotificationsForReminder();\n\t\t});\n\t},\n\t/**\n\t * Function registers event for Reminder popups\n\t */\n\tregisterReminders: function() {\n\t\tvar activityReminder = (parseInt(app.getMainParams('activityReminder')) || 0) * 1000;\n\t\tif (activityReminder != 0 && $('.remindersNotice.autoRefreshing').length) {\n\t\t\tVtiger_Index_Js.requestReminder();\n\t\t\twindow.reminder = setInterval(function() {\n\t\t\t\tVtiger_Index_Js.requestReminder();\n\t\t\t}, activityReminder);\n\t\t}\n\t\tvar reminder = (parseInt(app.getMainParams('intervalForNotificationNumberCheck')) || 0) * 1000;\n\t\tif (reminder != 0 && $('.notificationsNotice.autoRefreshing').length) {\n\t\t\tVtiger_Index_Js.getNotificationsForReminder();\n\t\t\twindow.reminderNotifications = setInterval(function() {\n\t\t\t\tVtiger_Index_Js.getNotificationsForReminder();\n\t\t\t}, reminder);\n\t\t}\n\t},\n\tgetNotificationsForReminder: function() {\n\t\tvar thisInstance = this;\n\t\tvar content = $('.remindersNotificationContainer');\n\t\tvar element = $('.notificationsNotice');\n\t\tvar url = 'index.php?module=Notification&view=Reminders';\n\t\tAppConnector.request(url)\n\t\t\t.done(function(data) {\n\t\t\t\tcontent.html(data);\n\t\t\t\tthisInstance.refreshReminderCount(content, element, 'js-count-notifications-reminder');\n\t\t\t\tcontent.find('.js-set-marked').on('click', function(e) {\n\t\t\t\t\tvar currentElement = $(e.currentTarget);\n\t\t\t\t\tvar recordID = currentElement.closest('.js-notification-panel').data('record');\n\t\t\t\t\tthisInstance.markNotifications(recordID).done(function(data) {\n\t\t\t\t\t\tcurrentElement.closest('.js-notification-panel').fadeOut(300, function() {\n\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\tthisInstance.refreshReminderCount(content, element, 'js-count-notifications-reminder');\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t})\n\t\t\t.fail(function(data, err) {\n\t\t\t\tclearInterval(window.reminderNotifications);\n\t\t\t});\n\t},\n\t/**\n\t * Function request for reminder popups\n\t */\n\trequestReminder: function() {\n\t\tvar thisInstance = this;\n\t\tvar content = $('.remindersNoticeContainer');\n\t\tvar element = $('.remindersNotice');\n\t\tvar url = 'index.php?module=Calendar&view=Reminders&type_remainder=true';\n\t\tAppConnector.request(url)\n\t\t\t.done(function(data) {\n\t\t\t\tcontent.html(data);\n\t\t\t\tthisInstance.refreshReminderCount(content, element, 'countRemindersNotice');\n\t\t\t\tapp.registerModal(content);\n\t\t\t\tcontent.find('.reminderPostpone').on('click', function(e) {\n\t\t\t\t\tvar currentElement = $(e.currentTarget);\n\t\t\t\t\tvar recordID = currentElement.closest('.js-toggle-panel').data('record');\n\t\t\t\t\tvar url =\n\t\t\t\t\t\t'index.php?module=Calendar&action=ActivityReminder&mode=postpone&record=' +\n\t\t\t\t\t\trecordID +\n\t\t\t\t\t\t'&time=' +\n\t\t\t\t\t\tcurrentElement.data('time');\n\t\t\t\t\tAppConnector.request(url).done(function(data) {\n\t\t\t\t\t\tcurrentElement.closest('.js-toggle-panel').fadeOut(300, function() {\n\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\tthisInstance.refreshReminderCount(content, element, 'countRemindersNotice');\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t})\n\t\t\t.fail(function(data, err) {\n\t\t\t\tclearInterval(window.reminder);\n\t\t\t});\n\t},\n\trefreshReminderCount: function(content, element, tag) {\n\t\tvar badge = element.find('.badge');\n\t\tvar count = content.find('.js-toggle-panel').length;\n\t\tbadge.text(count);\n\t\tbadge.removeClass('d-none');\n\t\tif (count > 0 && element.hasClass('autoRefreshing')) {\n\t\t\telement.effect('pulsate', 1500);\n\t\t\tif (app.cacheGet(tag) != count) {\n\t\t\t\tapp.playSound('REMINDERS');\n\t\t\t\tapp.cacheSet(tag, count);\n\t\t\t}\n\t\t} else {\n\t\t\tbadge.addClass('d-none');\n\t\t}\n\t},\n\tregisterResizeEvent: function() {\n\t\t$(window).on('resize', function() {\n\t\t\tif (this.resizeTO) clearTimeout(this.resizeTO);\n\t\t\tthis.resizeTO = setTimeout(function() {\n\t\t\t\t$(this).trigger('resizeEnd');\n\t\t\t}, 600);\n\t\t});\n\t},\n\tchangeWatching: function(instance) {\n\t\tvar value, module, state, className, user, record;\n\t\tif (instance != undefined) {\n\t\t\tinstance = $(instance);\n\t\t\tvalue = instance.data('value');\n\t\t\tif (instance.data('module') != undefined) {\n\t\t\t\tmodule = instance.data('module');\n\t\t\t} else {\n\t\t\t\tmodule = app.getModuleName();\n\t\t\t}\n\t\t\tif (instance.data('user') != undefined) {\n\t\t\t\tuser = instance.data('user');\n\t\t\t}\n\t\t\tif (instance.data('record') != undefined) {\n\t\t\t\trecord = instance.data('record');\n\t\t\t}\n\t\t}\n\t\tbootbox.dialog({\n\t\t\tmessage: app.vtranslate('JS_WATCHING_MESSAGE' + value),\n\t\t\ttitle: '<span class=\"fas fa-eye mr-1\"></span>' + app.vtranslate('JS_WATCHING_TITLE'),\n\t\t\tbuttons: {\n\t\t\t\tsuccess: {\n\t\t\t\t\tlabel: '<span class=\"fas fa-check mr-1\"></span>' + app.vtranslate('LBL_YES'),\n\t\t\t\t\tclassName: 'btn-success',\n\t\t\t\t\tcallback: function() {\n\t\t\t\t\t\tVtiger_Index_Js.updateWatching(module, value, user, record).done(function(data) {\n\t\t\t\t\t\t\tif (instance != undefined) {\n\t\t\t\t\t\t\t\tvar buttonIcon = instance.find('.fas');\n\t\t\t\t\t\t\t\tstate = data.result == 1 ? 0 : 1;\n\t\t\t\t\t\t\t\tinstance.data('value', state);\n\t\t\t\t\t\t\t\tif (state == 1) {\n\t\t\t\t\t\t\t\t\tinstance.toggleClass(instance.data('off') + ' ' + instance.data('on'));\n\t\t\t\t\t\t\t\t\tbuttonIcon.removeClass('fas fa-eye');\n\t\t\t\t\t\t\t\t\tbuttonIcon.addClass('fas fa-eye-slash');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tinstance.toggleClass(instance.data('on') + ' ' + instance.data('off'));\n\t\t\t\t\t\t\t\t\tbuttonIcon.removeClass('fas fa-eye-slash');\n\t\t\t\t\t\t\t\t\tbuttonIcon.addClass('fas fa-eye');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdanger: {\n\t\t\t\t\tlabel: '<span class=\"fas fa-times mr-1\"></span>' + app.vtranslate('LBL_NO'),\n\t\t\t\t\tclassName: 'btn-danger',\n\t\t\t\t\tcallback: function() {}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tupdateWatching: function(module, value, user, record) {\n\t\tvar aDeferred = $.Deferred();\n\t\tvar params = {\n\t\t\tmodule: module,\n\t\t\taction: 'Watchdog',\n\t\t\tstate: value\n\t\t};\n\t\tif (user != undefined) {\n\t\t\tparams['user'] = user;\n\t\t}\n\t\tif (record != undefined && record != 0) {\n\t\t\tparams['record'] = record;\n\t\t}\n\t\tAppConnector.request(params)\n\t\t\t.done(function(data) {\n\t\t\t\taDeferred.resolve(data);\n\t\t\t})\n\t\t\t.fail(function(textStatus, errorThrown) {\n\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\tapp.errorLog(textStatus, errorThrown);\n\t\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\tassignToOwner: function(element, userId) {\n\t\telement = $(element);\n\t\tif (userId == undefined) {\n\t\t\tuserId = CONFIG.userId;\n\t\t}\n\t\tvar params = {\n\t\t\tmodule: element.data('module'),\n\t\t\trecord: element.data('record'),\n\t\t\tfield: 'assigned_user_id',\n\t\t\tvalue: userId\n\t\t};\n\t\tapp.saveAjax('', null, params).done(function(e) {\n\t\t\tapp.hideModalWindow();\n\t\t\tif (app.getViewName() === 'List') {\n\t\t\t\tvar listinstance = new Vtiger_List_Js();\n\t\t\t\tlistinstance.getListViewRecords();\n\t\t\t}\n\t\t});\n\t},\n\tsendNotification: function() {\n\t\tVtiger_Header_Js.getInstance().quickCreateModule('Notification');\n\t},\n\tperformPhoneCall: function(phoneNumber, record) {\n\t\tAppConnector.request({\n\t\t\tmodule: app.getModuleName(),\n\t\t\tview: 'BasicAjax',\n\t\t\tmode: 'performPhoneCall',\n\t\t\tphoneNumber: phoneNumber,\n\t\t\trecord: record\n\t\t}).done(function(response) {\n\t\t\tresponse = JSON.parse(response);\n\t\t\tVtiger_Helper_Js.showMessage({ text: response.result });\n\t\t});\n\t},\n\tregisterAterloginEvents: function() {\n\t\tif (typeof CONFIG.ShowUserPasswordChange !== 'undefined') {\n\t\t\tapp.showModalWindow(null, 'index.php?module=Users&view=PasswordModal&mode=change&record=' + CONFIG.userId);\n\t\t}\n\t\tif (typeof CONFIG.ShowAuthy2faModal !== 'undefined') {\n\t\t\tapp.showModalWindow({\n\t\t\t\tbackdrop: 'static',\n\t\t\t\turl: 'index.php?module=Users&view=TwoFactorAuthenticationModal&record=' + CONFIG.userId\n\t\t\t});\n\t\t}\n\t},\n\tregisterEvents: function() {\n\t\tVtiger_Index_Js.registerWidgetsEvents();\n\t\tVtiger_Index_Js.loadWidgetsOnLoad();\n\t\tVtiger_Index_Js.registerReminders();\n\t\tVtiger_Index_Js.changeSkin();\n\t\tVtiger_Index_Js.registerResizeEvent();\n\t\tVtiger_Index_Js.registerAterloginEvents();\n\t}\n};\n//On Page Load\n$(document).ready(function() {\n\tVtiger_Index_Js.registerEvents();\n});\n"],"names":["Vtiger_Index_Js","element","showModalWindow","container","OpenStreetMap_Map_Js","registerModalView","find","val","$","data","trigger","url","uploadButton","template","uploadContainer","form","on","remove","files","i","length","append","html","name","e","preventDefault","removeEmptyFilesInput","formData","FormData","app","getViewName","getModuleName","getRecordId","params","progressIndicatorElement","progressIndicator","enabled","request","done","mode","hideModalWindow","detailView","Vtiger_Detail_Js","getInstance","selectedTabElement","getSelectedTab","reloadTabContent","getContentHolder","loadRelatedList","updatesWidget","getFiltersData","loadWidget","getListViewRecords","record","module","maxEmails","aDeferred","Deferred","progress","position","blockInfo","substring","JSON","parse","resolve","email","showPnotify","vtranslate","fail","error","err","reject","promise","thisInstance","this","each","sendButton","addClass","stopPropagation","popup","toMail","sendMailWindow","postData","popupParams","screen","width","height","undefined","open","action","replace","m","key","value","stringify","submit","location","href","widgets","widgetContainer","currentTarget","loadWidgets","attr","cacheSet","imageEle","parent","imagePath","message","trim","css","listViewWidgetParams","closest","label","index","currentElement","hide","progressElement","CONFIG","userId","success","result","removeClass","reload","id","row","fadeOut","entries","block","getNotificationsForReminder","textStatus","errorThrown","errorLog","ids","li","push","activityReminder","parseInt","getMainParams","requestReminder","reminder","setInterval","reminderNotifications","content","refreshReminderCount","recordID","markNotifications","window","registerModal","tag","badge","count","text","hasClass","effect","cacheGet","playSound","resizeTO","clearTimeout","setTimeout","instance","state","className","dialog","updateWatching","user","buttonIcon","toggleClass","saveAjax","Vtiger_List_Js","quickCreateModule","phoneNumber","response","showMessage","ShowUserPasswordChange","ShowAuthy2faModal","registerWidgetsEvents","loadWidgetsOnLoad","registerReminders","changeSkin","registerResizeEvent","registerAterloginEvents","document","ready","registerEvents"],"mappings":"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"}