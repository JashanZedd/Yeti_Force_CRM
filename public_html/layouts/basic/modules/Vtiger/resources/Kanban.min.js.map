{"version":3,"file":"Kanban.min.js","sources":["Kanban.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class(\n\t'Vtiger_Kanban_Js',\n\t{},\n\t{\n\t\t/**\n\t\t * Get params\n\t\t */\n\t\tgetParams: function () {\n\t\t\tconst params = [];\n\t\t\tthis.page.find('.js-params').each(function () {\n\t\t\t\tlet element = $(this);\n\t\t\t\tparams[element.attr('name')] = element.val();\n\t\t\t});\n\t\t\treturn $.extend(\n\t\t\t\t{\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Kanban',\n\t\t\t\t\tboard: this.page.find('.js-board-tab.active').data('id')\n\t\t\t\t},\n\t\t\t\tparams\n\t\t\t);\n\t\t},\n\t\tloadKanban: function () {\n\t\t\tconst params = this.getParams(),\n\t\t\t\turlParams = Object.assign({}, params);\n\t\t\tdelete urlParams.orderBy;\n\t\t\tapp.changeUrl(urlParams);\n\t\t\tconst progress = $.progressIndicator({ blockInfo: { enabled: true, elementToBlock: this.container } });\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done((responseData) => {\n\t\t\t\t\tthis.container.html(responseData);\n\t\t\t\t\tthis.registerSortable();\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail(() => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttitle: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t},\n\t\tregisterSortable: function () {\n\t\t\tconst boards = this.container.find('.js-kanban-records');\n\t\t\tboards.sortable({\n\t\t\t\tcontainment: this.container,\n\t\t\t\titems: boards.find('.js-kanban-record'),\n\t\t\t\tcancel: '.js-kanban-disabled',\n\t\t\t\tconnectWith: boards,\n\t\t\t\tplaceholder: 'c-kanban__highlight',\n\t\t\t\trevert: true,\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\tcursor: 'move',\n\t\t\t\tupdate: (e, ui) => {\n\t\t\t\t\tif (ui.sender == null) {\n\t\t\t\t\t\tconst records = ui.item.closest('.js-kanban-records');\n\t\t\t\t\t\tVtiger_Edit_Js.saveAjax({\n\t\t\t\t\t\t\trecord: ui.item.data('id'),\n\t\t\t\t\t\t\tfield: records.data('field'),\n\t\t\t\t\t\t\tvalue: records.data('value')\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(() => {\n\t\t\t\t\t\t\t\tthis.loadKanban();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.fail(function (error, err) {\n\t\t\t\t\t\t\t\tapp.errorLog(error, err);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstart: (e, ui) => {\n\t\t\t\t\tui.placeholder.height(ui.helper.outerHeight());\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Registers mobile devices.\n\t\t */\n\t\tregisterMobileDevices: function () {\n\t\t\tif (app.isTouchDevice()) {\n\t\t\t\tthis.container.find('.js-kanban-record').each(function () {\n\t\t\t\t\tlet element = $(this);\n\t\t\t\t\telement.find('.js-popover-tooltip--record').removeClass('js-popover-tooltip--record');\n\t\t\t\t\tlet btns = element.find('.btns');\n\t\t\t\t\tlet btnQuickEditModal = btns.find('.js-quick-edit-modal');\n\t\t\t\t\telement.addClass('js-quick-edit-modal');\n\t\t\t\t\telement.attr('href', btnQuickEditModal.attr('href'));\n\t\t\t\t\telement.attr('data-record', btnQuickEditModal.data('record'));\n\t\t\t\t\telement.attr('data-module', btnQuickEditModal.data('module'));\n\t\t\t\t\tbtns.remove();\n\t\t\t\t\telement.find('a').on('click', function (e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Registers Kanban view events.\n\t\t */\n\t\tregisterEvents: function () {\n\t\t\tthis.page = $('#centerPanel');\n\t\t\tthis.container = $('.js-kanban-container');\n\t\t\tthis.registerSortable();\n\t\t\tapp.showNewScrollbarTopBottom(this.container);\n\t\t\tthis.page.on('click', '.js-board-tab', (e) => {\n\t\t\t\tthis.page.find('.js-board-tab.active').removeClass('active');\n\t\t\t\t$(e.currentTarget).addClass('active');\n\t\t\t\tthis.loadKanban();\n\t\t\t});\n\t\t\tthis.page.on('change', '.js-params', () => {\n\t\t\t\tthis.loadKanban();\n\t\t\t});\n\t\t\tthis.page.on('click', '.js-list-reload', (e, data) => {\n\t\t\t\tthis.page.find('#orderBy').val(JSON.stringify(data.orderby)).trigger('change');\n\t\t\t});\n\t\t\tthis.registerMobileDevices();\n\t\t}\n\t}\n);\n"],"names":["$","Class","getParams","page","find","each","params","element","attr","val","extend","module","app","getModuleName","view","board","data","loadKanban","urlParams","Object","assign","orderBy","changeUrl","progress","progressIndicator","blockInfo","enabled","elementToBlock","container","AppConnector","request","done","responseData","html","registerSortable","mode","fail","showNotify","title","vtranslate","type","boards","sortable","containment","items","cancel","connectWith","placeholder","revert","tolerance","cursor","update","e","ui","sender","records","item","closest","Vtiger_Edit_Js","saveAjax","record","field","value","error","err","errorLog","start","height","helper","outerHeight","registerMobileDevices","isTouchDevice","removeClass","btnQuickEditModal","btns","addClass","remove","on","stopPropagation","registerEvents","showNewScrollbarTopBottom","currentTarget","JSON","stringify","orderby","trigger"],"mappings":"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"}