{"version":3,"file":"RecordConverter.min.js","sources":["RecordConverter.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n$.Class(\"Base_RecordConverter_JS\", {}, {\n\tcontainer: false,\n\t/**\n\t * Function get values for request query\n\t * @returns {{module: string, view: string, convertType: integer, fieldMerge: string, onlyBody: boolean, destinyModule: string, sourceView: string}}\n\t */\n\tgetParams: function () {\n\t\tlet params = {\n\t\t\tmodule: this.container.data('module'),\n\t\t\tview: this.container.data('view'),\n\t\t\tconvertType: this.container.find('.js-convert-type option:selected').val(),\n\t\t\tonlyBody: true,\n\t\t\tsourceView: app.getViewName()\n\t\t};\n\t\tif (app.getViewName() === 'List') {\n\t\t\tlet listInstance = Vtiger_List_Js.getInstance();\n\t\t\tparams.selected_ids = listInstance.readSelectedIds(true);\n\t\t\tparams.excluded_ids = listInstance.readExcludedIds(true);\n\t\t\tparams.cvId = listInstance.getCurrentCvId();\n\t\t\tif (listInstance.getListSearchInstance()) {\n\t\t\t\tlet searchValue = listInstance.getListSearchInstance().getAlphabetSearchValue();\n\t\t\t\tparams.search_params = JSON.stringify(listInstance.getListSearchInstance().getListSearchParams());\n\t\t\t\tif ((typeof searchValue != \"undefined\") && (searchValue.length > 0)) {\n\t\t\t\t\tparams.search_key = listInstance.getListSearchInstance().getAlphabetSearchField();\n\t\t\t\t\tparams.search_value = searchValue;\n\t\t\t\t\tparams.operator = 's';\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tparams.selected_ids = app.getRecordId()\n\t\t}\n\t\treturn params;\n\t},\n\t/**\n\t * Function load modal window\n\t * @returns {object}\n\t */\n\tloadModalWindow: function () {\n\t\tconst body = this.container.find('.js-modal-body')\n\t\tconst aDeferred = $.Deferred();\n\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true,\n\t\t\t\telementToBlock: body\n\t\t\t}\n\t\t});\n\t\tAppConnector.request(this.getParams()).then(function (responseData) {\n\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\tbody.html($(responseData).html());\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(body.find('.select2'));\n\t\t\taDeferred.resolve(responseData);\n\t\t}, function (textStatus, errorThrown) {\n\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\t/**\n\t * Function listener to change convert type\n\t */\n\tregisterChangeConvertType: function () {\n\t\tlet self = this;\n\t\tself.container.on('change', '.js-convert-type', (e) => {\n\t\t\tself.loadModalWindow();\n\t\t});\n\t},\n\t/**\n\t * Function listener to send a form\n\t * * @returns {object}\n\t */\n\tregisterSubmitForm: function () {\n\t\tlet self = this;\n\t\tself.container.on('click', \"[name='saveButton']\", (e) => {\n\t\t\tlet convertType = self.container.find('.js-convert-type option:selected').val();\n\t\t\tif (convertType) {\n\t\t\t\tlet formData = self.container.find('form').serializeFormData();\n\t\t\t\tlet postData = {};\n\t\t\t\tif (app.getViewName() === 'List') {\n\t\t\t\t\tlet listInstance = Vtiger_List_Js.getInstance();\n\t\t\t\t\tpostData = listInstance.getDefaultParams();\n\t\t\t\t\tpostData.selected_ids = listInstance.readSelectedIds(true);\n\t\t\t\t\tpostData.excluded_ids = listInstance.readExcludedIds(true);\n\t\t\t\t\tpostData.cvid = listInstance.getCurrentCvId();\n\n\t\t\t\t} else {\n\t\t\t\t\tpostData = {\n\t\t\t\t\t\tselected_ids: app.getRecordId()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tpostData.convertType = convertType;\n\t\t\t\tpostData.viewInfo = app.getViewName();\n\t\t\t\tconst aDeferred = $.Deferred();\n\t\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\telementToBlock: self.container.find('.modal-body')\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tAppConnector.request($.extend(formData, postData)).done(function (responseData) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tlet parseResult = JSON.parse(responseData);\n\t\t\t\t\tif (parseResult.result.redirect) {\n\t\t\t\t\t\twindow.location.href = parseResult.result.redirect;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (parseResult.result.createdRecords) {\n\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\ttext: app.vtranslate(parseResult.result.createdRecords),\n\t\t\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (parseResult.result.error) {\n\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\ttext: app.vtranslate(parseResult.result.error),\n\t\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t}\n\t\t\t\t\taDeferred.resolve(responseData);\n\t\t\t\t}, function (textStatus, errorThrown) {\n\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t});\n\t\t\t\treturn aDeferred.promise();\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Register events function\n\t * @param modalContainer\n\t */\n\tregisterEvents: function (modalContainer) {\n\t\tthis.container = modalContainer;\n\t\tthis.registerChangeConvertType();\n\t\tthis.registerSubmitForm();\n\t}\n});\n"],"names":["$","Class","params","container","data","find","val","app","getViewName","listInstance","Vtiger_List_Js","getInstance","selected_ids","readSelectedIds","excluded_ids","readExcludedIds","cvId","getCurrentCvId","getListSearchInstance","searchValue","getAlphabetSearchValue","search_params","JSON","stringify","getListSearchParams","length","search_key","getAlphabetSearchField","search_value","operator","getRecordId","body","aDeferred","Deferred","progressIndicatorElement","progressIndicator","request","getParams","then","responseData","mode","html","Fields","Picklist","showSelect2ElementView","resolve","textStatus","errorThrown","reject","promise","self","on","e","loadModalWindow","convertType","formData","serializeFormData","postData","getDefaultParams","cvid","viewInfo","extend","done","parseResult","parse","result","redirect","location","href","createdRecords","showMessage","vtranslate","error","hideModalWindow","modalContainer","registerChangeConvertType","registerSubmitForm"],"mappings":"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"}