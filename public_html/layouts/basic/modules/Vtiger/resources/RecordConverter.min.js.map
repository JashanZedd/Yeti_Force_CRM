{"version":3,"file":"RecordConverter.min.js","sources":["RecordConverter.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n$.Class(\n\t'Base_RecordConverter_JS',\n\t{},\n\t{\n\t\tcontainer: false,\n\t\t/**\n\t\t * Function get values for request query\n\t\t * @returns {{module: string, view: string, fieldMerge: string, onlyBody: boolean, destinyModule: string, sourceView: string}}\n\t\t */\n\t\tgetParams: function () {\n\t\t\tlet params = {\n\t\t\t\tmodule: this.container.data('module'),\n\t\t\t\tview: this.container.data('view'),\n\t\t\t\tconvertId: this.container.find('.js-convert-type option:selected').val(),\n\t\t\t\tsourceView: this.container.find('[name=\"sourceView\"]').val()\n\t\t\t};\n\t\t\tif (app.getViewName() === 'List') {\n\t\t\t\tlet listInstance = Vtiger_List_Js.getInstance();\n\t\t\t\tparams.selected_ids = listInstance.readSelectedIds(true);\n\t\t\t\tparams.excluded_ids = listInstance.readExcludedIds(true);\n\t\t\t\tparams.cvId = listInstance.getCurrentCvId();\n\t\t\t\tif (listInstance.getListSearchInstance()) {\n\t\t\t\t\tlet searchValue = listInstance.getListSearchInstance().getAlphabetSearchValue();\n\t\t\t\t\tparams.search_params = JSON.stringify(listInstance.getListSearchInstance().getListSearchParams());\n\t\t\t\t\tif (typeof searchValue != 'undefined' && searchValue.length > 0) {\n\t\t\t\t\t\tparams.search_key = listInstance.getListSearchInstance().getAlphabetSearchField();\n\t\t\t\t\t\tparams.search_value = searchValue;\n\t\t\t\t\t\tparams.operator = 's';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tparams.selected_ids = app.getRecordId();\n\t\t\t}\n\t\t\treturn params;\n\t\t},\n\t\t/**\n\t\t * Function load modal window\n\t\t * @returns {object}\n\t\t */\n\t\tloadModalWindow: function () {\n\t\t\tconst body = this.container.find('.js-modal-body');\n\t\t\tconst aDeferred = $.Deferred();\n\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tapp.hideModalWindow(body.closest('.js-modal-container').attr('id'));\n\t\t\tapp.showModalWindow({\n\t\t\t\turl: app.convertObjectToUrl(this.getParams()),\n\t\t\t\tcb: function (_) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\t/**\n\t\t * Function listener to change convert type\n\t\t */\n\t\tregisterChangeConvertType: function () {\n\t\t\tthis.container.on('change', '.js-convert-type', (e) => {\n\t\t\t\tthis.loadModalWindow();\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function listener to send a form\n\t\t * * @returns {object}\n\t\t */\n\t\tregisterSubmitForm: function () {\n\t\t\tlet self = this;\n\t\t\tself.container.on('click', \"[name='saveButton']\", (e) => {\n\t\t\t\tlet formMapping = self.container.find('form.js-form-converter');\n\t\t\t\tif (formMapping.validationEngine('validate')) {\n\t\t\t\t\tlet formData = formMapping.serializeFormData();\n\t\t\t\t\tlet postData = {};\n\t\t\t\t\tif (app.getViewName() === 'List') {\n\t\t\t\t\t\tlet listInstance = Vtiger_List_Js.getInstance();\n\t\t\t\t\t\tpostData = listInstance.getDefaultParams();\n\t\t\t\t\t\tpostData.selected_ids = listInstance.readSelectedIds(true);\n\t\t\t\t\t\tpostData.excluded_ids = listInstance.readExcludedIds(true);\n\t\t\t\t\t\tpostData.cvid = listInstance.getCurrentCvId();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpostData = {\n\t\t\t\t\t\t\tselected_ids: app.getRecordId()\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tpostData.viewInfo = app.getViewName();\n\t\t\t\t\tconst aDeferred = $.Deferred();\n\t\t\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\t\telementToBlock: self.container.find('.modal-body')\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tAppConnector.request($.extend(formData, postData)).done(\n\t\t\t\t\t\tfunction (responseData) {\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\tresponseData = JSON.parse(responseData);\n\t\t\t\t\t\t\tif (responseData.result.redirect) {\n\t\t\t\t\t\t\t\twindow.location.href = responseData.result.redirect;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (responseData.result.createdRecords) {\n\t\t\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\t\t\ttext: app.vtranslate(responseData.result.createdRecords),\n\t\t\t\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (responseData.result.error) {\n\t\t\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\t\t\ttext: app.vtranslate(responseData.result.error),\n\t\t\t\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\taDeferred.resolve(responseData);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction (textStatus, errorThrown) {\n\t\t\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\treturn aDeferred.promise();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Register events function\n\t\t * @param modalContainer\n\t\t */\n\t\tregisterEvents: function (modalContainer) {\n\t\t\tthis.container = modalContainer;\n\t\t\tthis.registerChangeConvertType();\n\t\t\tthis.registerSubmitForm();\n\t\t\tthis.container.find('form.js-form-converter').validationEngine(app.validationEngineOptions);\n\t\t}\n\t}\n);\n"],"names":["$","Class","container","getParams","module","data","view","convertId","find","val","sourceView","app","getViewName","listInstance","Vtiger_List_Js","getInstance","params","selected_ids","readSelectedIds","excluded_ids","readExcludedIds","cvId","getCurrentCvId","getListSearchInstance","searchValue","getAlphabetSearchValue","search_params","JSON","stringify","getListSearchParams","length","search_key","getAlphabetSearchField","search_value","operator","getRecordId","loadModalWindow","aDeferred","Deferred","progressIndicatorElement","progressIndicator","blockInfo","enabled","hideModalWindow","body","closest","attr","showModalWindow","url","convertObjectToUrl","cb","mode","promise","registerChangeConvertType","on","registerSubmitForm","self","formMapping","validationEngine","serializeFormData","postData","getDefaultParams","cvid","viewInfo","elementToBlock","request","extend","formData","done","responseData","parse","result","redirect","window","location","href","createdRecords","Vtiger_Helper_Js","showMessage","text","vtranslate","type","error","resolve","textStatus","errorThrown","reject","registerEvents","modalContainer","validationEngineOptions"],"mappings":"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"}