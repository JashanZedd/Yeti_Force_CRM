{"version":3,"file":"RecordConverter.min.js","sources":["RecordConverter.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n$.Class(\"Base_RecordConverter_JS\", {}, {\n\tcontainer: false,\n\t/**\n\t * Function get values for request query\n\t * @returns {{module: string, view: string, convertType: integer, fieldMerge: string, onlyBody: boolean, destinyModule: string, sourceView: string}}\n\t */\n\tgetParams: function () {\n\t\tlet params = {\n\t\t\tmodule: this.container.data('module'),\n\t\t\tview: this.container.data('view'),\n\t\t\tconvertType: this.container.find('.js-convert-type option:selected').val(),\n\t\t\tonlyBody: true,\n\t\t\tsourceView: app.getViewName()\n\t\t};\n\t\tif (app.getViewName() === 'List') {\n\t\t\tlet listInstance = Vtiger_List_Js.getInstance();\n\t\t\tparams.selected_ids = listInstance.readSelectedIds(true);\n\t\t\tparams.excluded_ids = listInstance.readExcludedIds(true);\n\t\t\tparams.cvId = listInstance.getCurrentCvId();\n\t\t\tif (listInstance.getListSearchInstance()) {\n\t\t\t\tlet searchValue = listInstance.getListSearchInstance().getAlphabetSearchValue();\n\t\t\t\tparams.search_params = JSON.stringify(listInstance.getListSearchInstance().getListSearchParams());\n\t\t\t\tif ((typeof searchValue != \"undefined\") && (searchValue.length > 0)) {\n\t\t\t\t\tparams.search_key = listInstance.getListSearchInstance().getAlphabetSearchField();\n\t\t\t\t\tparams.search_value = searchValue;\n\t\t\t\t\tparams.operator = 's';\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tparams.selected_ids = app.getRecordId()\n\t\t}\n\t\treturn params;\n\t},\n\t/**\n\t * Function load modal window\n\t * @returns {object}\n\t */\n\tloadModalWindow: function () {\n\t\tconst body = this.container.find('.js-modal-body')\n\t\tconst aDeferred = $.Deferred();\n\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true,\n\t\t\t\telementToBlock: body\n\t\t\t}\n\t\t});\n\t\tAppConnector.request(this.getParams()).then(function (responseData) {\n\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\tbody.html($(responseData).html());\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(body.find('.select2'));\n\t\t\taDeferred.resolve(responseData);\n\t\t}, function (textStatus, errorThrown) {\n\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\t/**\n\t * Function listener to change convert type\n\t */\n\tregisterChangeConvertType: function () {\n\t\tlet self = this;\n\t\tself.container.on('change', '.js-convert-type', (e) => {\n\t\t\tself.loadModalWindow();\n\t\t});\n\t},\n\t/**\n\t * Function listener to send a form\n\t * * @returns {object}\n\t */\n\tregisterSubmitForm: function () {\n\t\tlet self = this;\n\t\tself.container.on('click', \"[name='saveButton']\", (e) => {\n\t\t\tlet convertType = self.container.find('.js-convert-type option:selected').val();\n\t\t\tif (convertType) {\n\t\t\t\tlet formData = self.container.find('form').serializeFormData();\n\t\t\t\tlet postData = {};\n\t\t\t\tif (app.getViewName() === 'List') {\n\t\t\t\t\tlet listInstance = Vtiger_List_Js.getInstance();\n\t\t\t\t\tpostData = listInstance.getDefaultParams();\n\t\t\t\t\tpostData.selected_ids = listInstance.readSelectedIds(true);\n\t\t\t\t\tpostData.excluded_ids = listInstance.readExcludedIds(true);\n\t\t\t\t\tpostData.cvid = listInstance.getCurrentCvId();\n\n\t\t\t\t} else {\n\t\t\t\t\tpostData = {\n\t\t\t\t\t\tselected_ids: app.getRecordId()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tpostData.convertType = convertType;\n\t\t\t\tpostData.viewInfo = app.getViewName();\n\t\t\t\tconst aDeferred = $.Deferred();\n\t\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\telementToBlock: self.container.find('.modal-body')\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tAppConnector.request($.extend(formData, postData)).done(function (responseData) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tlet parseResult = JSON.parse(responseData);\n\t\t\t\t\tif (parseResult.result.redirect) {\n\t\t\t\t\t\twindow.location.href = parseResult.result.redirect;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (parseResult.result.createdRecords) {\n\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\ttext: app.vtranslate(parseResult.result.createdRecords),\n\t\t\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (parseResult.result.error) {\n\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\ttext: app.vtranslate(parseResult.result.error),\n\t\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t}\n\t\t\t\t\taDeferred.resolve(responseData);\n\t\t\t\t}, function (textStatus, errorThrown) {\n\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t});\n\t\t\t\treturn aDeferred.promise();\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Register events function\n\t * @param modalContainer\n\t */\n\tregisterEvents: function (modalContainer) {\n\t\tthis.container = modalContainer;\n\t\tthis.registerChangeConvertType();\n\t\tthis.registerSubmitForm();\n\t}\n});\n"],"names":["$","Class","params","this","container","data","find","val","app","getViewName","listInstance","Vtiger_List_Js","getInstance","selected_ids","readSelectedIds","excluded_ids","readExcludedIds","cvId","getCurrentCvId","getListSearchInstance","searchValue","getAlphabetSearchValue","search_params","JSON","stringify","getListSearchParams","length","search_key","getAlphabetSearchField","search_value","operator","getRecordId","body","aDeferred","Deferred","progressIndicatorElement","progressIndicator","request","getParams","then","responseData","mode","html","Fields","Picklist","showSelect2ElementView","resolve","textStatus","errorThrown","reject","promise","self","on","e","loadModalWindow","convertType","formData","serializeFormData","postData","getDefaultParams","cvid","viewInfo","extend","done","parseResult","parse","result","redirect","location","href","createdRecords","showMessage","vtranslate","error","hideModalWindow","modalContainer","registerChangeConvertType","registerSubmitForm"],"mappings":"aACAA,EAAEC,MAAM,0BAA2B,GAAI,YAC3B,YAKA,eACNC,OAAS,QACJC,KAAKC,UAAUC,KAAK,eACtBF,KAAKC,UAAUC,KAAK,oBACbF,KAAKC,UAAUE,KAAK,oCAAoCC,gBAC3D,aACEC,IAAIC,kBAES,SAAtBD,IAAIC,cAA0B,KAC7BC,aAAeC,eAAeC,wBAC3BC,aAAeH,aAAaI,iBAAgB,UAC5CC,aAAeL,aAAaM,iBAAgB,UAC5CC,KAAOP,aAAaQ,iBACvBR,aAAaS,wBAAyB,KACrCC,YAAcV,aAAaS,wBAAwBE,gCAChDC,cAAgBC,KAAKC,UAAUd,aAAaS,wBAAwBM,4BAChD,IAAfL,aAAgCA,YAAYM,OAAS,WACzDC,WAAajB,aAAaS,wBAAwBS,gCAClDC,aAAeT,mBACfU,SAAW,kBAIbjB,aAAeL,IAAIuB,qBAEpB7B,wBAMS,eACV8B,KAAO7B,KAAKC,UAAUE,KAAK,kBAC3B2B,UAAYjC,EAAEkC,WACdC,yBAA2BnC,EAAEoC,kBAAkB,WACzC,UACD,iBACOJ,4BAGLK,QAAQlC,KAAKmC,aAAaC,MAAK,SAAUC,uCAC5BJ,kBAAkB,CAAEK,KAAM,cAC9CC,KAAK1C,EAAEwC,cAAcE,YACtBC,OAAOC,SAASC,uBAAuBb,KAAK1B,KAAK,uBAC3CwC,QAAQN,iBAChB,SAAUO,WAAYC,uBACdC,OAAOF,WAAYC,sCACJZ,kBAAkB,CAAEK,KAAM,YAE7CR,UAAUiB,qCAKS,eACtBC,KAAOhD,UACNC,UAAUgD,GAAG,SAAU,oBAAoB,SAACC,QAC3CC,yCAOa,eACfH,KAAOhD,UACNC,UAAUgD,GAAG,QAAS,uBAAuB,SAACC,OAC9CE,YAAcJ,KAAK/C,UAAUE,KAAK,oCAAoCC,SACtEgD,YAAa,KACZC,SAAWL,KAAK/C,UAAUE,KAAK,QAAQmD,oBACvCC,SAAW,MACW,SAAtBlD,IAAIC,cAA0B,KAC7BC,aAAeC,eAAeC,wBACvBF,aAAaiD,oBACf9C,aAAeH,aAAaI,iBAAgB,YAC5CC,aAAeL,aAAaM,iBAAgB,YAC5C4C,KAAOlD,aAAaQ,+BAGlB,cACIV,IAAIuB,wBAGXwB,YAAcA,qBACdM,SAAWrD,IAAIC,kBAClBwB,UAAYjC,EAAEkC,WACdC,yBAA2BnC,EAAEoC,kBAAkB,WACzC,UACD,iBACOe,KAAK/C,UAAUE,KAAK,sCAGzB+B,QAAQrC,EAAE8D,OAAON,SAAUE,WAAWK,MAAK,SAAUvB,uCACxCJ,kBAAkB,CAAEK,KAAM,aAC/CuB,YAAczC,KAAK0C,MAAMzB,cACzBwB,YAAYE,OAAOC,gBACfC,SAASC,KAAOL,YAAYE,OAAOC,UAEtCH,YAAYE,OAAOI,iCACLC,YAAY,MACtB/D,IAAIgE,WAAWR,YAAYE,OAAOI,qBAClC,YAGJN,YAAYE,OAAOO,wBACLF,YAAY,MACtB/D,IAAIgE,WAAWR,YAAYE,OAAOO,YAClC,cAGJC,6BAEK5B,QAAQN,iBAChB,SAAUO,WAAYC,uBACdC,OAAOF,WAAYC,sCACJZ,kBAAkB,CAAEK,KAAM,YAE7CR,UAAUiB,8BAQJ,SAAUyB,qBACpBvE,UAAYuE,oBACZC,iCACAC"}