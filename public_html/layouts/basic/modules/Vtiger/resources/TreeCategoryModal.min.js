"use strict";jQuery.Class("Vtiger_TreeCategory_Js",{},{modalContainer:!1,treeInstance:!1,treeData:!1,windowParent:app.getWindowParent(),getModalContainer:function(){return 0==this.modalContainer&&(this.modalContainer=jQuery("#modalTreeCategoryModal")),this.modalContainer},getRecords:function(container){if(0==this.treeData&&"undefined"!==container){var treeValues=container.find("#treePopupValues").val();this.treeData=JSON.parse(treeValues)}return this.treeData},generateTree:function(container){if(0==this.treeInstance){this.treeInstance=container.find("#treePopupContents");var plugins=["search","category"];"2"==this.getRelationType()&&plugins.push("checkbox"),"1"==this.getRelationType()&&plugins.push("edit"),this.treeInstance.jstree($.extend(!0,{core:{data:this.getRecords(),themes:{name:"proton",responsive:!0}},checkbox:{three_state:!1},plugins:plugins},this.treeInstance.data("params")))}},getRelationType:function(){return this.getModalContainer().find("#relationType").val()},searching:function(text){this.treeInstance.jstree(!0).search(text)},registerSearchEvent:function(){var thisInstance=this,valueSearch=$("#valueSearchTree"),btnSearch=$("#btnSearchTree");valueSearch.on("keypress",(function(e){13==e.which&&thisInstance.searching(valueSearch.val())})),btnSearch.on("click",(function(){thisInstance.searching(valueSearch.val())}))},registerSaveRecords:function(container){var thisInstance=this,ord=[],ocd=[];$.each(thisInstance.getRecords(),(function(index,value){value.state&&value.state.selected&&"record"===value.attr&&ord.push(value.record_id),value.category&&value.category.checked&&"record"!==value.attr&&ocd.push(value.record_id)})),container.find('[name="saveButton"]').on("click",(function(e){var recordsToAdd=[],categoryToAdd=[],recordsToRemove=Object.assign([],ord),categoryToRemove=Object.assign([],ocd),saveButton=$(this);saveButton.attr("disabled","disabled");var cSelected=thisInstance.treeInstance.jstree("getCategory",!0);$.each(cSelected,(function(index,treeElement){var value=treeElement.record_id;"record"===treeElement.attr?-1==jQuery.inArray(value,recordsToRemove)?recordsToAdd.push(value):recordsToRemove.splice(recordsToRemove.indexOf(value),1):"record"!==treeElement.attr&&(-1==jQuery.inArray(value,categoryToRemove)?categoryToAdd.push(value):categoryToRemove.splice(categoryToRemove.indexOf(value),1))}));var params={module:thisInstance.windowParent.app.getModuleName(),action:"RelationAjax",mode:"updateRelation",recordsToAdd:recordsToAdd,recordsToRemove:recordsToRemove,categoryToAdd:categoryToAdd,categoryToRemove:categoryToRemove,src_record:thisInstance.windowParent.app.getRecordId(),related_module:container.find("#relatedModule").val()};recordsToAdd.length>4?bootbox.dialog({title:app.vtranslate("JS_INFORMATION"),message:app.vtranslate("JS_SAVE_SELECTED_ITEMS_ALERT").replace("__LENGTH__",recordsToAdd.length),buttons:{success:{label:app.vtranslate("JS_LBL_SAVE"),className:"btn-success",callback:function(){thisInstance.saveRecordsEvent(params)}},danger:{label:app.vtranslate("JS_LBL_CANCEL"),className:"btn-warning",callback:function(){saveButton.removeAttr("disabled")}}}}):thisInstance.saveRecordsEvent(params)}))},saveRecordsEvent:function(params){var self=this;AppConnector.request(params).done((function(res){self.windowParent.Vtiger_Detail_Js.getInstance().reloadTabContent(),app.hideModalWindow()}))},registerCounterSelected:function(){var thisInstance=this;this.treeInstance.on("changed.jstree",(function(e,data){var html,counterSelected=0;$.each(thisInstance.treeInstance.jstree("get_selected",!0),(function(index,value){value.original.record_id.toString().indexOf("T")&&counterSelected++})),html=app.vtranslate("JS_SELECTED_ELEMENTS")+": "+counterSelected,$(".counterSelected").text(html)}))},registerEvents:function(){var container=this.getModalContainer();this.getRecords(container),this.generateTree(container),this.registerSaveRecords(container),this.registerSearchEvent(),this.registerCounterSelected()}}),jQuery((function(){(new Vtiger_TreeCategory_Js).registerEvents()}));
//# sourceMappingURL=TreeCategoryModal.min.js.map
