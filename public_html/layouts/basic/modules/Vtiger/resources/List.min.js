'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
  return typeof obj;
} : function (obj) {
  return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
};

jQuery.Class('Vtiger_List_Js',{listInstance:!1,getRelatedModulesContainer:!1,massEditPreSave:'Vtiger.MassEdit.PreSave',getInstance:function getInstance(){if(!1===Vtiger_List_Js.listInstance){var moduleClassName,fallbackClassName,instance,module=app.getModuleName(),parentModule=app.getParentModuleName();return 'Settings'==parentModule?(moduleClassName=parentModule+'_'+module+'_List_Js','undefined'==typeof window[moduleClassName]&&(moduleClassName=module+'_List_Js'),fallbackClassName=parentModule+'_Vtiger_List_Js','undefined'==typeof window[fallbackClassName]&&(fallbackClassName='Vtiger_List_Js')):(moduleClassName=module+'_List_Js',fallbackClassName='Vtiger_List_Js'),instance='undefined'==typeof window[moduleClassName]?new window[fallbackClassName]:new window[moduleClassName],Vtiger_List_Js.listInstance=instance,instance}return Vtiger_List_Js.listInstance},triggerSendEmail:function triggerSendEmail(params){var listInstance=Vtiger_List_Js.getInstance(),validationResult=listInstance.checkListRecordSelected();if(!0!=validationResult){var selectedIds=listInstance.readSelectedIds(!0),excludedIds=listInstance.readExcludedIds(!0),postData=listInstance.getDefaultParams();delete postData.parent,postData.module=app.getModuleName(),postData.view='SendMailModal',postData.selected_ids=selectedIds,postData.excluded_ids=excludedIds,postData.cvid=listInstance.getCurrentCvId(),params&&jQuery.extend(postData,params),AppConnector.request(postData).done(function(response){app.showModalWindow(response,function(data){data.find('[name="saveButton"]').on('click',function(){data.find('form').validationEngine('validate')&&(jQuery.extend(postData,{field:data.find('#field').val(),template:data.find('#template').val(),action:'Mail',mode:'sendMails'}),delete postData.view,AppConnector.request(postData).done(function(response){!0==response.result&&app.hideModalWindow();}).fail(function(){app.hideModalWindow();}));});});});}else listInstance.noRecordSelectedAlert();},triggerSendSms:function triggerSendSms(massActionUrl){var listInstance=Vtiger_List_Js.getInstance(),validationResult=listInstance.checkListRecordSelected();!0==validationResult?listInstance.noRecordSelectedAlert():Vtiger_List_Js.triggerMassAction(massActionUrl);},triggerTransferOwnership:function triggerTransferOwnership(massActionUrl){var thisInstance=this,listInstance=Vtiger_List_Js.getInstance(),validationResult=listInstance.checkListRecordSelected();if(!0!=validationResult){var progressIndicatorElement=jQuery.progressIndicator();thisInstance.getRelatedModulesContainer=!1;AppConnector.request({type:'POST',url:massActionUrl,dataType:'html',data:{}}).done(function(data){if(progressIndicatorElement.progressIndicator({mode:'hide'}),data){var callback=function(data){var params=app.validationEngineOptions;params.onValidationComplete=function(form,valid){return valid&&thisInstance.transferOwnershipSave(form),!1},data.find('#changeOwner').validationEngine(app.validationEngineOptions);};app.showModalWindow(data,function(data){var selectElement=thisInstance.getRelatedModuleContainer();App.Fields.Picklist.changeSelectElementView(selectElement,'select2'),'function'==typeof callback&&callback(data);});}});}else listInstance.noRecordSelectedAlert();},triggerQuickExportToExcel:function triggerQuickExportToExcel(module){var listInstance=Vtiger_List_Js.getInstance(),validationResult=listInstance.checkListRecordSelected();if(!0!=validationResult){var progressIndicatorElement=jQuery.progressIndicator(),selectedIds=listInstance.readSelectedIds(!0),excludedIds=listInstance.readExcludedIds(!0),cvId=listInstance.getCurrentCvId(),postData={viewname:cvId,selected_ids:selectedIds,excluded_ids:excludedIds},searchValue=listInstance.getListSearchInstance().getAlphabetSearchValue();postData.search_params=JSON.stringify(listInstance.getListSearchInstance().getListSearchParams()),'undefined'!=typeof searchValue&&0<searchValue.length&&(postData.search_key=listInstance.getListSearchInstance().getAlphabetSearchField(),postData.search_value=searchValue,postData.operator='s');var form=$('<form method="POST" action="index.php">');form.append($('<input />',{name:'module',value:module})),form.append($('<input />',{name:'action',value:'QuickExport'})),form.append($('<input />',{name:'mode',value:'exportToExcel'})),'undefined'!=typeof csrfMagicName&&form.append($('<input />',{name:csrfMagicName,value:csrfMagicToken})),$.each({type:'POST',url:'index.php',dataType:'application/x-msexcel',data:postData}.data,function(k,v){form.append($('<input />',{name:k,value:v}));}),$('body').append(form),form.submit(),Vtiger_Helper_Js.showMessage({text:app.vtranslate('JS_STARTED_GENERATING_FILE'),type:'info'}),progressIndicatorElement.progressIndicator({mode:'hide'});}else listInstance.noRecordSelectedAlert();},transferOwnershipSave:function transferOwnershipSave(){var listInstance=Vtiger_List_Js.getInstance(),selectedIds=listInstance.readSelectedIds(!0),excludedIds=listInstance.readExcludedIds(!0),cvId=listInstance.getCurrentCvId(),transferOwner=jQuery('#transferOwnerId').val(),relatedModules=jQuery('#related_modules').val(),params={module:app.getModuleName(),action:'TransferOwnership',viewname:cvId,selected_ids:selectedIds,excluded_ids:excludedIds,transferOwnerId:transferOwner,related_modules:relatedModules};AppConnector.request(params).done(function(data){if(data.success){app.hideModalWindow();var params={title:app.vtranslate('JS_MESSAGE'),text:app.vtranslate('JS_RECORDS_TRANSFERRED_SUCCESSFULLY'),type:'info'};Vtiger_Helper_Js.showPnotify(params),listInstance.getListViewRecords(),Vtiger_List_Js.clearList();}});},getRelatedModuleContainer:function getRelatedModuleContainer(){return !1==this.getRelatedModulesContainer&&(this.getRelatedModulesContainer=jQuery('#related_modules')),this.getRelatedModulesContainer},triggerMassAction:function triggerMassAction(massActionUrl,callBackFunction,beforeShowCb,css){'undefined'==typeof beforeShowCb&&(beforeShowCb=function(){return !0}),'object'==('undefined'==typeof beforeShowCb?'undefined':_typeof(beforeShowCb))&&(css=beforeShowCb,beforeShowCb=function(){return !0});var listInstance=Vtiger_List_Js.getInstance(),validationResult=listInstance.checkListRecordSelected();if(!0!=validationResult){var progressIndicatorElement=jQuery.progressIndicator(),selectedIds=listInstance.readSelectedIds(!0),excludedIds=listInstance.readExcludedIds(!0),cvId=listInstance.getCurrentCvId(),postData={viewname:cvId,selected_ids:selectedIds,excluded_ids:excludedIds},listViewInstance=Vtiger_List_Js.getInstance();if(listViewInstance.getListSearchInstance()){var searchValue=listViewInstance.getListSearchInstance().getAlphabetSearchValue();postData.search_params=JSON.stringify(listViewInstance.getListSearchInstance().getListSearchParams()),'undefined'!=typeof searchValue&&0<searchValue.length&&(postData.search_key=listViewInstance.getListSearchInstance().getAlphabetSearchField(),postData.search_value=searchValue,postData.operator='s');}'undefined'==typeof css&&(css={}),css=jQuery.extend({"text-align":'left'},css),AppConnector.request({type:'POST',url:massActionUrl,dataType:'html',data:postData}).done(function(data){if(progressIndicatorElement.progressIndicator({mode:'hide'}),data){var result=beforeShowCb(data);if(!result)return;app.showModalWindow(data,function(data){'function'==typeof callBackFunction&&callBackFunction(data);},css),$('#massEditContainer').length&&listInstance.inactiveFieldsValidation($('#massEditContainer').find('form'));}}).fail(function(error,err){progressIndicatorElement.progressIndicator({mode:'hide'}),Vtiger_Helper_Js.showPnotify({title:app.vtranslate('JS_MESSAGE'),text:err,type:'error'});});}else listInstance.noRecordSelectedAlert();},triggerMassEdit:function triggerMassEdit(massEditUrl){var selectedCount=this.getSelectedRecordCount();if(selectedCount>jQuery('#listMaxEntriesMassEdit').val()){var params={title:app.vtranslate('JS_MESSAGE'),text:app.vtranslate('JS_MASS_EDIT_LIMIT'),type:'error'};return void Vtiger_Helper_Js.showPnotify(params)}Vtiger_List_Js.triggerMassAction(massEditUrl,function(container){var massEditForm=container.find('#massEdit');massEditForm.validationEngine(app.validationEngineOptions);var listInstance=Vtiger_List_Js.getInstance();listInstance.registerEventForTabClick(massEditForm);var editInstance=Vtiger_Edit_Js.getInstance();editInstance.registerBasicEvents(massEditForm),listInstance.postMassEdit(container),listInstance.registerSlimScrollMassEdit();},{width:'65%'});},getSelectedRecordCount:function getSelectedRecordCount(){var count,listInstance=Vtiger_List_Js.getInstance(),cvId=listInstance.getCurrentCvId(),selectedIdObj=jQuery('#selectedIds').data(cvId+'Selectedids');if(selectedIdObj!=null)if('all'!=selectedIdObj)count=selectedIdObj.length;else{var excludedIdsCount=jQuery('#excludedIds').data(cvId+'Excludedids').length,totalRecords=jQuery('#recordsCount').val();count=totalRecords-excludedIdsCount;}return count},triggerExportAction:function triggerExportAction(exportActionUrl){var listInstance=Vtiger_List_Js.getInstance(),selectedIds=listInstance.readSelectedIds(!0),excludedIds=listInstance.readExcludedIds(!0),cvId=listInstance.getCurrentCvId(),pageNumber=jQuery('#pageNumber').val();exportActionUrl+='undefined'==typeof cvId?'&selected_ids='+selectedIds+'&excluded_ids='+excludedIds+'&page='+pageNumber:'&selected_ids='+selectedIds+'&excluded_ids='+excludedIds+'&viewname='+cvId+'&page='+pageNumber;var listViewInstance=Vtiger_List_Js.getInstance();if(listViewInstance.getListSearchInstance()){var searchValue=listViewInstance.getListSearchInstance().getAlphabetSearchValue();exportActionUrl+='&search_params='+JSON.stringify(listViewInstance.getListSearchInstance().getListSearchParams()),'undefined'!=typeof searchValue&&0<searchValue.length&&(exportActionUrl+='&search_key='+listViewInstance.getListSearchInstance().getAlphabetSearchField(),exportActionUrl+='&search_value='+searchValue,exportActionUrl+='&operator=s');}window.location.href=exportActionUrl;},clearList:function clearList(){jQuery('#deSelectAllMsg').trigger('click'),jQuery('#selectAllMsgDiv').hide();},triggerListSearch:function triggerListSearch(){var listInstance=Vtiger_List_Js.getInstance(),listViewContainer=listInstance.getListViewContentContainer();listViewContainer.find('[data-trigger="listSearch"]').trigger('click');},getSelectedRecordsParams:function getSelectedRecordsParams(checkList){var listInstance=Vtiger_List_Js.getInstance();if(!1==checkList||!0!=listInstance.checkListRecordSelected()){var selectedIds=listInstance.readSelectedIds(!0),excludedIds=listInstance.readExcludedIds(!0),cvId=listInstance.getCurrentCvId(),postData={viewname:cvId,selected_ids:selectedIds,excluded_ids:excludedIds},searchValue=listInstance.getListSearchInstance().getAlphabetSearchValue();return postData.search_params=JSON.stringify(listInstance.getListSearchInstance().getListSearchParams()),'undefined'!=typeof searchValue&&0<searchValue.length&&(postData.search_key=listInstance.getListSearchInstance().getAlphabetSearchField(),postData.search_value=searchValue,postData.operator='s'),postData}return listInstance.noRecordSelectedAlert(),!1},triggerGenerateRecords:function triggerGenerateRecords(url){var selected=Vtiger_List_Js.getSelectedRecordsParams();if(!1===selected)return !1;var params={};jQuery.extend(params,selected),url+='&'+jQuery.param(params);var progressIndicatorElement=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});app.showModalWindow(null,url,function(){progressIndicatorElement.progressIndicator({mode:'hide'});});},showMap:function showMap(){var selectedParams=Vtiger_List_Js.getSelectedRecordsParams(!1),url='index.php?module=OpenStreetMap&view=MapModal&srcModule='+app.getModuleName();app.showModalWindow(null,url,function(container){var mapView=new OpenStreetMap_Map_Js;mapView.setSelectedParams(selectedParams),mapView.registerModalView(container);});},triggerReviewChanges:function triggerReviewChanges(reviewUrl){var listInstance=Vtiger_List_Js.getInstance(),validationResult=listInstance.checkListRecordSelected();if(!0!=validationResult){var selectedIds=listInstance.readSelectedIds(!0),excludedIds=listInstance.readExcludedIds(!0),cvId=listInstance.getCurrentCvId(),message=app.vtranslate('JS_MASS_REVIEWING_CHANGES_CONFIRMATION'),title='<i class="fa fa-check-circle"></i> '+app.vtranslate('JS_LBL_REVIEW_CHANGES');Vtiger_Helper_Js.showConfirmationBox({message:message,title:title}).done(function(){var url=reviewUrl+'&viewname='+cvId+'&selected_ids='+selectedIds+'&excluded_ids='+excludedIds;if(listInstance.getListSearchInstance()){var searchValue=listInstance.getListSearchInstance().getAlphabetSearchValue();url+='&search_params='+JSON.stringify(listInstance.getListSearchInstance().getListSearchParams()),'undefined'!=typeof searchValue&&0<searchValue.length&&(url+='&search_key='+listInstance.getListSearchInstance().getAlphabetSearchField(),url+='&search_value='+searchValue,url+='&operator=s');}var deleteMessage=app.vtranslate('JS_LOADING_PLEASE_WAIT'),progressIndicatorElement=jQuery.progressIndicator({message:deleteMessage,position:'html',blockInfo:{enabled:!0}});AppConnector.request(url).done(function(data){if(progressIndicatorElement.progressIndicator({mode:'hide'}),data.result){var params={text:data.result,type:'info'};Vtiger_Helper_Js.showPnotify(params);}else listInstance.getListViewRecords();}).fail(function(error,err){app.errorLog(error,err);});}).fail(function(){Vtiger_List_Js.clearList();});}else listInstance.noRecordSelectedAlert();}},{listViewContainer:!1,listViewTopMenuContainer:!1,listViewContentContainer:!1,filterBlock:!1,filterSelectElement:!1,listSearchInstance:!1,noEventsListSearch:!0,getListSearchInstance:function getListSearchInstance(events){return null!=events&&(this.noEventsListSearch=events),!1==this.listSearchInstance&&(this.getListViewContainer().find('.searchField').length||this.getListViewContainer().find('.picklistSearchField').length)&&(this.listSearchInstance=YetiForce_ListSearch_Js.getInstance(this.getListViewContainer(),this.noEventsListSearch)),this.listSearchInstance},getListViewContainer:function getListViewContainer(){return !1==this.listViewContainer&&(this.listViewContainer=jQuery('div.listViewPageDiv')),this.listViewContainer},getListViewTopMenuContainer:function getListViewTopMenuContainer(){return !1==this.listViewTopMenuContainer&&(this.listViewTopMenuContainer=jQuery('.listViewTopMenuDiv')),this.listViewTopMenuContainer},getListViewContentContainer:function getListViewContentContainer(){return !1==this.listViewContentContainer&&(this.listViewContentContainer=jQuery('.listViewContentDiv')),this.listViewContentContainer},getFilterBlock:function getFilterBlock(){if(!1==this.filterBlock){var filterSelectElement=this.getFilterSelectElement();0>=filterSelectElement.length?this.filterBlock=jQuery():filterSelectElement.is('select')&&(this.filterBlock=filterSelectElement.data('select2').$dropdown);}return this.filterBlock},getFilterSelectElement:function getFilterSelectElement(){return !1==this.filterSelectElement&&(this.filterSelectElement=jQuery('#customFilter')),this.filterSelectElement},getDefaultParams:function getDefaultParams(){var params={module:app.getModuleName(),page:jQuery('#pageNumber').val(),view:app.getViewName(),viewname:this.getCurrentCvId(),orderby:jQuery('#orderBy').val(),sortorder:jQuery('#sortOrder').val(),entityState:jQuery('#entityState').val()};app.getParentModuleName()&&(params.parent=app.getParentModuleName());var listSearchInstance=this.getListSearchInstance();if(!1!==listSearchInstance){var searchValue=listSearchInstance.getAlphabetSearchValue();params.search_params=JSON.stringify(listSearchInstance.getListSearchParams(!0)),'undefined'!=typeof searchValue&&0<searchValue.length&&(params.search_key=listSearchInstance.getAlphabetSearchField(),params.search_value=searchValue,params.operator='s');}return params},getListViewRecords:function getListViewRecords(urlParams){var aDeferred=$.Deferred();'undefined'==typeof urlParams&&(urlParams={});var thisInstance=this,listViewContentsContainer=$('#listViewContents'),loadingMessage=jQuery('.listViewLoadingMsg').text(),progressIndicatorElement=$.progressIndicator({message:loadingMessage,position:'html',blockInfo:{enabled:!0}}),defaultParams=this.getDefaultParams();return urlParams=$.extend(defaultParams,urlParams),AppConnector.requestPjax(urlParams).done(function(data){progressIndicatorElement.progressIndicator({mode:'hide'}),listViewContentsContainer.html(data),app.event.trigger('RecordListView.AfterLoad',data,thisInstance),thisInstance.calculatePages().done(function(data){aDeferred.resolve(data),app.notifyPostAjaxReady();}),thisInstance.postLoadListViewRecordsEvents(listViewContentsContainer);}).fail(function(textStatus,errorThrown){aDeferred.reject(textStatus,errorThrown);}),aDeferred.promise()},postLoadListViewRecordsEvents:function postLoadListViewRecordsEvents(container){var self=this;self.registerListScroll(container),App.Fields.Picklist.showSelect2ElementView(container.find('select.select2')),App.Fields.Picklist.changeSelectElementView(container),app.showPopoverElementView(container.find('.js-popover-tooltip')),self.registerListViewSpecialOption();var searchInstance=self.getListSearchInstance();!1!==searchInstance&&searchInstance.registerBasicEvents(),Vtiger_Index_Js.registerMailButtons(container),Vtiger_Helper_Js.showHorizontalTopScrollBar();var selectedIds=self.readSelectedIds();if(''!=selectedIds){if('all'==selectedIds){$('.listViewEntriesCheckBox').each(function(){$(this).prop('checked',!0).closest('tr').addClass('highlightBackgroundColor');}),$('#deSelectAllMsgDiv').show();var excludedIds=self.readExcludedIds();''!=excludedIds&&($('#listViewEntriesMainCheckBox').prop('checked',!1),$('.listViewEntriesCheckBox').each(function(index,element){-1!=$.inArray($(element).val(),excludedIds)&&$(element).prop('checked',!1).closest('tr').removeClass('highlightBackgroundColor');}));}else $('.listViewEntriesCheckBox').each(function(index,element){-1!=$.inArray($(element).val(),selectedIds)&&$(this).prop('checked',!0).closest('tr').addClass('highlightBackgroundColor');});self.checkSelectAll();}self.registerUnreviewedCountEvent(),self.registerLastRelationsEvent();},calculatePages:function calculatePages(){var aDeferred=jQuery.Deferred(),element=jQuery('#totalPageCount'),totalPageNumber=element.text();if(''==totalPageNumber){var totalRecordCount=jQuery('#totalCount').val();if(''!=totalRecordCount){var pageLimit=jQuery('#pageLimit').val();'0'==pageLimit&&(pageLimit=1);var pageCount=Math.ceil(totalRecordCount/pageLimit);return 0==pageCount&&(pageCount=1),element.text(pageCount),aDeferred.resolve(),aDeferred.promise()}aDeferred.resolve();}else aDeferred.resolve();return aDeferred.promise()},noRecordSelectedAlert:function noRecordSelectedAlert(){var text=0<arguments.length&&arguments[0]!==void 0?arguments[0]:'JS_PLEASE_SELECT_ONE_RECORD';return Vtiger_Helper_Js.showPnotify({text:app.vtranslate(text)})},massActionSave:function massActionSave(form,isMassEdit){'undefined'==typeof isMassEdit&&(isMassEdit=!1);var aDeferred=jQuery.Deferred();if(isMassEdit){var massEditPreSaveEvent=jQuery.Event(Vtiger_List_Js.massEditPreSave);if(form.trigger(massEditPreSaveEvent),massEditPreSaveEvent.isDefaultPrevented())return form.find('[name="saveButton"]').removeAttr('disabled'),aDeferred.reject(),aDeferred.promise();form.find('[id^="selectRow"]').each(function(index,checkbox){checkbox=jQuery(checkbox),checkbox.prop('checked')||checkbox.closest('.js-form-row-container').find('.fieldValue [name]').each(function(index,element){element=jQuery(element),element.attr('data-element-name',element.attr('name')).removeAttr('name');});});}var massActionUrl=form.serializeFormData(),progressIndicatorElement=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});return AppConnector.request(massActionUrl).done(function(data){if(progressIndicatorElement.progressIndicator({mode:'hide'}),app.hideModalWindow(),!data.result){var params={text:app.vtranslate('JS_MASS_EDIT_NOT_SUCCESSFUL'),type:'info'};Vtiger_Helper_Js.showPnotify(params);}aDeferred.resolve(data);}).fail(function(error,err){app.hideModalWindow(),app.errorLog(error,err),aDeferred.reject(error,err);}),aDeferred.promise()},checkSelectAll:function checkSelectAll(){var state=!0;jQuery('.listViewEntriesCheckBox').each(function(index,element){return jQuery(element).is(':checked')?void(state=!0):(state=!1,!1)}),!0==state?jQuery('#listViewEntriesMainCheckBox').prop('checked',!0):jQuery('#listViewEntriesMainCheckBox').prop('checked',!1);},getRecordsCount:function getRecordsCount(){var aDeferred=jQuery.Deferred(),recordCountVal=jQuery('#recordsCount').val();if(''!=recordCountVal)aDeferred.resolve(recordCountVal);else{var count='',params=this.getDefaultParams();params.view='ListAjax',params.mode='getRecordsCount',AppConnector.request(params).done(function(data){var response=JSON.parse(data);jQuery('#recordsCount').val(response.result.count),count=response.result.count,aDeferred.resolve(count);});}return aDeferred.promise()},getSelectOptionFromChosenOption:function getSelectOptionFromChosenOption(liElement){var id=liElement.attr('id'),idArr=id.split('-'),currentOptionId='';if(0<idArr.length)currentOptionId=idArr[idArr.length-1];else return !1;return jQuery('#filterOptionId_'+currentOptionId)},readSelectedIds:function readSelectedIds(decode){var cvId=this.getCurrentCvId(),selectedIdsElement=jQuery('#selectedIds'),selectedIdsDataAttr=cvId+'Selectedids',selectedIdsElementDataAttributes=selectedIdsElement.data();if(!(selectedIdsDataAttr in selectedIdsElementDataAttributes)){var selectedIds=[];this.writeSelectedIds(selectedIds);}else selectedIds=selectedIdsElementDataAttributes[selectedIdsDataAttr];return !0==decode&&'object'==('undefined'==typeof selectedIds?'undefined':_typeof(selectedIds))?JSON.stringify(selectedIds):selectedIds},readExcludedIds:function readExcludedIds(decode){var cvId=this.getCurrentCvId(),exlcudedIdsElement=jQuery('#excludedIds'),excludedIdsDataAttr=cvId+'Excludedids',excludedIdsElementDataAttributes=exlcudedIdsElement.data();if(!(excludedIdsDataAttr in excludedIdsElementDataAttributes)){var excludedIds=[];this.writeExcludedIds(excludedIds);}else excludedIds=excludedIdsElementDataAttributes[excludedIdsDataAttr];return !0==decode&&'object'==('undefined'==typeof excludedIds?'undefined':_typeof(excludedIds))?JSON.stringify(excludedIds):excludedIds},writeSelectedIds:function writeSelectedIds(selectedIds){var cvId=this.getCurrentCvId();Array.isArray(selectedIds)||(selectedIds=[selectedIds]),jQuery('#selectedIds').data(cvId+'Selectedids',selectedIds);},writeExcludedIds:function writeExcludedIds(excludedIds){var cvId=this.getCurrentCvId();jQuery('#excludedIds').data(cvId+'Excludedids',excludedIds);},getCurrentCvId:function getCurrentCvId(){return jQuery('#customFilter').find('option:selected').data('id')},getAlphabetSearchField:function getAlphabetSearchField(){return jQuery('#alphabetSearchKey').val()},getAlphabetSearchValue:function getAlphabetSearchValue(){return jQuery('#alphabetValue').val()},checkListRecordSelected:function checkListRecordSelected(){var minNumberOfRecords=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,selectedIds=this.readSelectedIds();return !!('object'===('undefined'==typeof selectedIds?'undefined':_typeof(selectedIds))&&selectedIds.length<minNumberOfRecords)},inactiveFieldValidation:function inactiveFieldValidation(field){field.validationEngine('hide');var form=field.closest('form'),invalidFields=form.data('jqv').InvalidFields,fields=[field.get(0)],validationVal=field.attr('data-validation-engine');if(field.attr('data-invalid-validation-engine',validationVal?validationVal:'validate[]'),field.removeAttr('data-validation-engine'),field.is('select')&&field.hasClass('select2')){var selectElement=app.getSelect2ElementFromSelect(field);selectElement.validationEngine('hide'),fields.push(selectElement.get(0));}for(var i in fields){var response=jQuery.inArray(fields[i],invalidFields);'-1'!=response&&invalidFields.splice(response,1);}},activeFieldValidation:function activeFieldValidation(field){var validationVal=field.attr('data-invalid-validation-engine');'undefined'==typeof validationVal||(field.attr('data-validation-engine',validationVal?validationVal:'validate[]'),field.removeAttr('data-invalid-validation-engine'));},postMassEdit:function postMassEdit(massEditContainer){var thisInstance=this,editInstance=Vtiger_Edit_Js.getInstance();massEditContainer.find('.selectRow').on('change',function(e){var element=jQuery(e.currentTarget),blockElement=element.closest('.js-form-row-container').find('.fieldValue'),fieldElement=blockElement.find('[data-validation-engine],[data-invalid-validation-engine]'),fieldInfo=fieldElement.data('fieldinfo');if(element.prop('checked')?thisInstance.activeFieldValidation(fieldElement):thisInstance.inactiveFieldValidation(fieldElement),void 0!==fieldInfo&&'reference'===fieldInfo.type){var mapFields=editInstance.getMappingRelatedField(fieldInfo.name,editInstance.getReferencedModuleName(blockElement),massEditContainer);$.each(mapFields,function(key){var checkboxElement=massEditContainer.find('[id="selectRow'+key+'"]');checkboxElement.length&&checkboxElement.prop('disabled')&&(checkboxElement.prop('disabled',!1),checkboxElement.trigger('click'),checkboxElement.prop('disabled',!0));});}}),massEditContainer.find('form').on('submit',function(e){var form=jQuery(e.currentTarget);if('undefined'!=typeof form.data('submit'))return !1;if(form.validationEngine('validate')){if(e.preventDefault(),!form.find('input[id^="selectRow"]:checked').length)return void Vtiger_Helper_Js.showPnotify(app.vtranslate('NONE_OF_THE_FIELD_VALUES_ARE_CHANGED_IN_MASS_EDIT'));var invalidFields=form.data('jqv').InvalidFields;if(0==invalidFields.length)form.find('[name="saveButton"]').prop('disabled',!0);else return;thisInstance.massActionSave(form,!0).done(function(){thisInstance.getListViewRecords(),Vtiger_List_Js.clearList();}).fail(function(error,err){app.errorLog(error,err);});}else form.removeData('submit'),app.formAlignmentAfterValidation(form);});},registerPageNavigationEvents:function registerPageNavigationEvents(){var aDeferred=jQuery.Deferred(),thisInstance=this;jQuery('#listViewNextPageButton').on('click',function(){if(!$(this).hasClass('disabled')){var pageLimit=jQuery('#pageLimit').val(),noOfEntries=jQuery('#noOfEntries').val();if(noOfEntries==pageLimit){var orderBy=jQuery('#orderBy').val(),sortOrder=jQuery('#sortOrder').val(),cvId=thisInstance.getCurrentCvId(),pageNumber=jQuery('#pageNumber').val(),nextPageNumber=parseInt(parseFloat(pageNumber))+1;jQuery('#pageNumber').val(nextPageNumber),jQuery('#pageToJump').val(nextPageNumber),thisInstance.getListViewRecords({orderby:orderBy,sortorder:sortOrder,viewname:cvId}).done(function(){thisInstance.updatePagination(nextPageNumber),aDeferred.resolve();}).fail(function(textStatus,errorThrown){aDeferred.reject(textStatus,errorThrown);});}return aDeferred.promise()}}),jQuery('#listViewPreviousPageButton').on('click',function(){var aDeferred=jQuery.Deferred(),pageNumber=jQuery('#pageNumber').val();if(1<pageNumber){var orderBy=jQuery('#orderBy').val(),sortOrder=jQuery('#sortOrder').val(),cvId=thisInstance.getCurrentCvId(),previousPageNumber=parseInt(parseFloat(pageNumber))-1;jQuery('#pageNumber').val(previousPageNumber),jQuery('#pageToJump').val(previousPageNumber),thisInstance.getListViewRecords({orderby:orderBy,sortorder:sortOrder,viewname:cvId}).done(function(){thisInstance.updatePagination(previousPageNumber),aDeferred.resolve();}).fail(function(textStatus,errorThrown){aDeferred.reject(textStatus,errorThrown);});}}),jQuery('.pageNumber').on('click',function(){var disabled=$(this).hasClass('disabled');if(disabled)return !1;var pageNumber=$(this).data('id'),orderBy=jQuery('#orderBy').val(),sortOrder=jQuery('#sortOrder').val(),cvId=thisInstance.getCurrentCvId(),previousPageNumber=parseInt(parseFloat(pageNumber))-1;jQuery('#pageNumber').val(previousPageNumber),jQuery('#pageToJump').val(previousPageNumber),thisInstance.getListViewRecords({orderby:orderBy,sortorder:sortOrder,viewname:cvId,page:pageNumber}).done(function(){thisInstance.updatePagination(pageNumber);}).fail(function(){});}),$('#totalCountBtn').on('click',function(){app.hidePopover(jQuery(this));var paramsNotifier={title:app.vtranslate('JS_LBL_PERMISSION'),text:app.vtranslate('JS_GET_PAGINATION_INFO'),type:'info'};Vtiger_Helper_Js.showMessage(paramsNotifier);var params=thisInstance.getDefaultParams();params.totalCount=-1,params.view='Pagination',params.mode='getPagination',AppConnector.request(params).done(function(data){jQuery('.paginationDiv').html(data),thisInstance.registerPageNavigationEvents();});}),jQuery('#listViewPageJump').on('click',function(){if('undefined'!=typeof Vtiger_WholeNumberGreaterThanZero_Validator_Js.invokeValidation(jQuery('#pageToJump'))){var pageNo=jQuery('#pageNumber').val();jQuery('#pageToJump').val(pageNo);}jQuery('#pageToJump').validationEngine('hideAll');var element=jQuery('#totalPageCount'),totalPageNumber=element.text();if(''==totalPageNumber){var totalCountElem=jQuery('#totalCount'),totalRecordCount=totalCountElem.val();if(''!=totalRecordCount){var recordPerPage=jQuery('#pageLimit').val();'0'==recordPerPage&&(recordPerPage=1);var pageCount=Math.ceil(totalRecordCount/recordPerPage);return 0==pageCount&&(pageCount=1),void element.text(pageCount)}element.progressIndicator({}),thisInstance.getPageCount().done(function(data){var pageCount=data.result.page;totalCountElem.val(data.result.numberOfRecords),0==pageCount&&(pageCount=1),element.text(pageCount),element.progressIndicator({mode:'hide'});});}}),jQuery('#listViewPageJumpDropDown').on('click','li',function(e){e.stopImmediatePropagation();}).on('keypress','#pageToJump',function(e){if(13==e.which){e.stopImmediatePropagation();var element=jQuery(e.currentTarget),response=Vtiger_WholeNumberGreaterThanZero_Validator_Js.invokeValidation(element);if('undefined'!=typeof response)element.validationEngine('showPrompt',response,'','topLeft',!0);else{element.validationEngine('hideAll');var currentPageElement=jQuery('#pageNumber'),currentPageNumber=currentPageElement.val(),newPageNumber=parseInt(jQuery(e.currentTarget).val()),totalPages=parseInt(jQuery('#totalPageCount').text());if(newPageNumber>totalPages){var error=app.vtranslate('JS_PAGE_NOT_EXIST');return void element.validationEngine('showPrompt',error,'','topLeft',!0)}if(newPageNumber==currentPageNumber){var message=app.vtranslate('JS_YOU_ARE_IN_PAGE_NUMBER')+' '+newPageNumber;return void Vtiger_Helper_Js.showMessage({text:message,type:'info'})}currentPageElement.val(newPageNumber),thisInstance.getListViewRecords().done(function(){thisInstance.updatePagination(newPageNumber),element.closest('.btn-group ').removeClass('open');}).fail(function(){});}return !1}});},getPageCount:function getPageCount(){var aDeferred=jQuery.Deferred(),pageCountParams=this.getPageJumpParams();return AppConnector.request(pageCountParams).done(function(data){var response;response='object'==('undefined'==typeof data?'undefined':_typeof(data))?data:JSON.parse(data),aDeferred.resolve(response);}).fail(function(){}),aDeferred.promise()},getPageJumpParams:function getPageJumpParams(){var params=this.getDefaultParams();return params.view='ListAjax',params.mode='getPageCount',params},updatePagination:function updatePagination(pageNumber){pageNumber='undefined'==typeof pageNumber?1:pageNumber;var thisInstance=this,cvId=thisInstance.getCurrentCvId(),params={};params.module=app.getModuleName(),'Settings'==app.getParentModuleName()&&(params.parent='Settings'),params.view='Pagination',params.viewname=cvId,params.page=pageNumber,params.mode='getPagination',params.sourceModule=jQuery('#moduleFilter').val(),params.totalCount=$('.pagination').data('totalCount');var searchInstance=this.getListSearchInstance();if(!1!==searchInstance){var searchValue=searchInstance.getAlphabetSearchValue();params.search_params=JSON.stringify(this.getListSearchInstance().getListSearchParams()),'undefined'!=typeof searchValue&&0<searchValue.length&&(params.search_key=this.getListSearchInstance().getAlphabetSearchField(),params.search_value=searchValue,params.operator='s');}params.noOfEntries=jQuery('#noOfEntries').val(),AppConnector.request(params).done(function(data){jQuery('.paginationDiv').html(data),thisInstance.registerPageNavigationEvents();});},registerChangeCustomFilterEvent:function registerChangeCustomFilterEvent(event){var _this=this,target=$(event.currentTarget),selectOption='',selectOptionId='',textOption='';target.is('option')?selectOption=target:'select2:selecting'===event.type?(selectOptionId=event.params.args.data.id,selectOption=$('#filterOptionId_'+selectOptionId)):'mouseup'===event.type&&(selectOptionId=event.currentTarget.id.split('-').pop(),selectOption=$('#filterOptionId_'+selectOptionId),this.getFilterSelectElement().val(event.currentTarget.id.split('-').pop()).trigger('change')),0===$('.nav-item[data-cvid=\''+selectOptionId+'\'] .nav-link').tab('show').length&&$('.js-filter-tab .active').removeClass('active'),'object'===('undefined'==typeof selectOption?'undefined':_typeof(selectOption))&&(textOption=selectOption.text()),$('#select2-customFilter-container span').contents().last().replaceWith(textOption),app.setMainParams('pageNumber','1'),app.setMainParams('pageToJump','1'),app.setMainParams('orderBy',selectOption.data('orderby')),app.setMainParams('sortOrder',selectOption.data('sortorder'));var urlParams={viewname:selectOption.val(),search_key:this.getAlphabetSearchField(),search_value:'',search_params:''};jQuery('#recordsCount').val(''),jQuery('#totalPageCount').text(''),$('.pagination').data('totalCount',0),this.getListViewRecords(urlParams).done(function(){_this.breadCrumbsFilter(selectOption.text()),_this.ListViewPostOperation(),_this.updatePagination(1);}),event.stopPropagation();},registerChangeCustomFilterEventListeners:function registerChangeCustomFilterEventListeners(){var _this2=this,filterSelect=this.getFilterSelectElement();filterSelect.on('select2:selecting',function(event){return $(':focus').length?void _this2.registerChangeCustomFilterEvent(event):(event.preventDefault(),filterSelect.select2('close'),!1)}),filterSelect.on('click','option',this.registerChangeCustomFilterEvent.bind(this)),this.getFilterBlock().on('mouseup','li .select2-results__option',this.registerChangeCustomFilterEvent.bind(this)),this.getListViewTopMenuContainer().find('.js-filter-tab').on('click',function(e){var cvId=$(e.currentTarget).data('cvid'),selectOption=filterSelect.find('[value='+cvId+']');selectOption.trigger('click'),$('#select2-customFilter-container span').contents().last().replaceWith(selectOption.text()),filterSelect.val(cvId).trigger('change');});},breadCrumbsFilter:function breadCrumbsFilter(text){var breadCrumbs=jQuery('.breadcrumbsContainer'),breadCrumbsLastSpan=breadCrumbs.last('span'),filterExist=breadCrumbsLastSpan.find('.breadCrumbsFilter');filterExist.length&&text!=null?filterExist.text(' ['+app.vtranslate('JS_FILTER')+': '+text+']'):1>filterExist.length&&(text=text==null?this.getFilterSelectElement().find(':selected').text():text,breadCrumbsLastSpan.hasClass('breadCrumbsFilter')?breadCrumbsLastSpan.text(': '+text):breadCrumbs.append('<small class="breadCrumbsFilter hideToHistory p-1 js-text-content" data-js="text"> ['+app.vtranslate('JS_FILTER')+': '+text+']</small>'));},ListViewPostOperation:function ListViewPostOperation(){return !0},registerMainCheckBoxClickEvent:function registerMainCheckBoxClickEvent(){var listViewPageDiv=this.getListViewContainer(),thisInstance=this;listViewPageDiv.on('click','#listViewEntriesMainCheckBox',function(){var selectedIds=thisInstance.readSelectedIds(),excludedIds=thisInstance.readExcludedIds();if(jQuery('#listViewEntriesMainCheckBox').is(':checked')){var recordCountObj=thisInstance.getRecordsCount();recordCountObj.done(function(data){jQuery('#totalRecordsCount').text(data),'none'==jQuery('#deSelectAllMsgDiv').css('display')&&jQuery('#selectAllMsgDiv').show();}),jQuery('.listViewEntriesCheckBox').each(function(index,element){jQuery(this).prop('checked',!0).closest('tr').addClass('highlightBackgroundColor'),'all'==selectedIds?-1!=jQuery.inArray(jQuery(element).val(),excludedIds)&&excludedIds.splice(jQuery.inArray(jQuery(element).val(),excludedIds),1):-1==jQuery.inArray(jQuery(element).val(),selectedIds)&&selectedIds.push(jQuery(element).val());});}else jQuery('#selectAllMsgDiv').hide(),jQuery('.listViewEntriesCheckBox').each(function(index,element){jQuery(this).prop('checked',!1).closest('tr').removeClass('highlightBackgroundColor'),'all'==selectedIds?(excludedIds.push(jQuery(element).val()),selectedIds='all'):selectedIds.splice(jQuery.inArray(jQuery(element).val(),selectedIds),1);});thisInstance.writeSelectedIds(selectedIds),thisInstance.writeExcludedIds(excludedIds);});},registerCheckBoxClickEvent:function registerCheckBoxClickEvent(){var listViewPageDiv=this.getListViewContainer(),thisInstance=this;listViewPageDiv.on('click','.listViewEntriesCheckBox',function(e){var selectedIds=thisInstance.readSelectedIds(),excludedIds=thisInstance.readExcludedIds(),elem=jQuery(e.currentTarget);elem.is(':checked')?(elem.closest('tr').addClass('highlightBackgroundColor'),'all'==selectedIds?excludedIds.splice(jQuery.inArray(elem.val(),excludedIds),1):-1==jQuery.inArray(elem.val(),selectedIds)&&selectedIds.push(elem.val())):(elem.closest('tr').removeClass('highlightBackgroundColor'),'all'==selectedIds?(excludedIds.push(elem.val()),selectedIds='all'):selectedIds.splice(jQuery.inArray(elem.val(),selectedIds),1)),thisInstance.checkSelectAll(),thisInstance.writeSelectedIds(selectedIds),thisInstance.writeExcludedIds(excludedIds);});},registerSelectAllClickEvent:function registerSelectAllClickEvent(){var listViewPageDiv=this.getListViewContainer(),thisInstance=this;listViewPageDiv.on('click','#selectAllMsg',function(){jQuery('#selectAllMsgDiv').hide(),jQuery('#deSelectAllMsgDiv').show(),jQuery('#listViewEntriesMainCheckBox').prop('checked',!0),jQuery('.listViewEntriesCheckBox').each(function(){jQuery(this).prop('checked',!0).closest('tr').addClass('highlightBackgroundColor');}),thisInstance.writeSelectedIds('all');});},registerDeselectAllClickEvent:function registerDeselectAllClickEvent(){var listViewPageDiv=this.getListViewContainer(),thisInstance=this;listViewPageDiv.on('click','#deSelectAllMsg',function(){jQuery('#deSelectAllMsgDiv').hide(),jQuery('#listViewEntriesMainCheckBox').prop('checked',!1),jQuery('.listViewEntriesCheckBox').each(function(){jQuery(this).prop('checked',!1).closest('tr').removeClass('highlightBackgroundColor');});thisInstance.writeSelectedIds([]),thisInstance.writeExcludedIds([]);});},registerHeadersClickEvent:function registerHeadersClickEvent(){var listViewPageDiv=this.getListViewContainer(),thisInstance=this;listViewPageDiv.on('click','.listViewHeaderValues',function(e){var fieldName=jQuery(e.currentTarget).data('columnname'),sortOrderVal=jQuery(e.currentTarget).data('nextsortorderval');if('undefined'!=typeof sortOrderVal){var cvId=thisInstance.getCurrentCvId();thisInstance.getListViewRecords({orderby:fieldName,sortorder:sortOrderVal,viewname:cvId});}});},createFilterClickEvent:function createFilterClickEvent(event){this.getFilterSelectElement().data('select2').close(),new CustomView($(event.currentTarget).find('#createFilter').data('createurl'));},registerDuplicateFilterClickEvent:function registerDuplicateFilterClickEvent(){var thisInstance=this,listViewFilterBlock=this.getFilterBlock();!1!=listViewFilterBlock&&listViewFilterBlock.on('mouseup','li [data-fa-i2svg].js-filter-duplicate',function(event){thisInstance.getFilterSelectElement().data('select2').close();var liElement=jQuery(event.currentTarget).closest('.select2-results__option'),currentOptionElement=thisInstance.getSelectOptionFromChosenOption(liElement),editUrl=currentOptionElement.data('duplicateurl');new CustomView(editUrl),event.stopPropagation();});},registerEditFilterClickEvent:function registerEditFilterClickEvent(){var thisInstance=this,listViewFilterBlock=this.getFilterBlock();!1!=listViewFilterBlock&&listViewFilterBlock.on('mouseup','li [data-fa-i2svg].js-filter-edit',function(event){thisInstance.getFilterSelectElement().data('select2').close();var liElement=jQuery(event.currentTarget).closest('.select2-results__option'),currentOptionElement=thisInstance.getSelectOptionFromChosenOption(liElement),editUrl=currentOptionElement.data('editurl');new CustomView(editUrl);jQuery(this).data('cvid');event.stopPropagation();});},registerDeleteFilterClickEvent:function registerDeleteFilterClickEvent(){var thisInstance=this,listViewFilterBlock=this.getFilterBlock();!1!=listViewFilterBlock&&listViewFilterBlock.on('mouseup','li [data-fa-i2svg].js-filter-delete',function(event){thisInstance.getFilterSelectElement().data('select2').close();var liElement=jQuery(event.currentTarget).closest('.select2-results__option'),message=app.vtranslate('JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE_FILTER');Vtiger_Helper_Js.showConfirmationBox({message:message}).done(function(){var currentOptionElement=thisInstance.getSelectOptionFromChosenOption(liElement),deleteUrl=currentOptionElement.data('deleteurl'),newEle='<form action='+deleteUrl+' method="POST">';'undefined'!=typeof csrfMagicName&&(newEle+='<input type = "hidden" name ="'+csrfMagicName+'"  value=\''+csrfMagicToken+'\'>'),newEle+='</form>';var formElement=jQuery(newEle);formElement.appendTo('body').submit();}),event.stopPropagation();});},registerApproveFilterClickEvent:function registerApproveFilterClickEvent(){var thisInstance=this,listViewFilterBlock=this.getFilterBlock();!1!=listViewFilterBlock&&listViewFilterBlock.on('mouseup','li [data-fa-i2svg].js-filter-approve',function(event){thisInstance.getFilterSelectElement().data('select2').close();var liElement=jQuery(event.currentTarget).closest('.select2-results__option'),currentOptionElement=thisInstance.getSelectOptionFromChosenOption(liElement),approveUrl=currentOptionElement.data('approveurl'),newEle='<form action='+approveUrl+' method="POST">';'undefined'!=typeof csrfMagicName&&(newEle+='<input type = "hidden" name ="'+csrfMagicName+'"  value=\''+csrfMagicToken+'\'>'),newEle+='</form>';var formElement=jQuery(newEle);formElement.appendTo('body').submit(),event.stopPropagation();});},registerDenyFilterClickEvent:function registerDenyFilterClickEvent(){var thisInstance=this,listViewFilterBlock=this.getFilterBlock();!1!=listViewFilterBlock&&listViewFilterBlock.on('mouseup','li [data-fa-i2svg].js-filter-deny',function(event){thisInstance.getFilterSelectElement().data('select2').close();var liElement=jQuery(event.currentTarget).closest('.select2-results__option'),currentOptionElement=thisInstance.getSelectOptionFromChosenOption(liElement),denyUrl=currentOptionElement.data('denyurl'),form='<form action='+denyUrl+' method="POST">';'undefined'!=typeof csrfMagicName&&(form+='<input type = "hidden" name ="'+csrfMagicName+'"  value=\''+csrfMagicToken+'\'>'),form+='</form>',jQuery(form).appendTo('body').submit(),event.stopPropagation();});},appendFilterActionsTemplate:function appendFilterActionsTemplate(liElement){var currentOptionElement=this.getSelectOptionFromChosenOption(liElement),template=$('<span class="js-filter-actions o-filter-actions float-right">\n\t\t\t\t\t<span title="'+app.vtranslate('JS_DUPLICATE')+'" data-value="duplicate" data-js="click"\n\t\t\t\t\t\t  class="fas fa-retweet mr-1 js-filter-duplicate '+(0===$('#createFilter').length?'d-none':'')+'"></span>\n\t\t\t\t\t<span title="'+app.vtranslate('JS_EDIT')+'" data-value="edit" data-js="click"\n\t\t\t\t\t\t  class="fas fa-pencil-alt mr-1 js-filter-edit '+(1===currentOptionElement.data('editable')?'':'d-none')+'"></span>\n\t\t\t\t\t<span title="'+app.vtranslate('JS_DELETE')+'" data-value="delete" data-js="click"\n\t\t\t\t\t\t  class="fas fa-trash-alt mr-1 js-filter-delete '+(1===currentOptionElement.data('deletable')?'':'d-none')+'"></span>\n\t\t\t\t\t<span title="'+app.vtranslate('JS_DENY')+'" data-value="deny" data-js="click"\n\t\t\t\t\t\t  class="fas fa-exclamation-circle mr-1 js-filter-deny '+(1===currentOptionElement.data('public')?'':'d-none')+'"></span>\n\t\t\t\t\t<span title="'+app.vtranslate('JS_APPROVE')+'" data-value="approve" data-js="click"\n\t\t\t\t\t\t  class="fas fa-check mr-1 js-filter-approve '+(1===currentOptionElement.data('pending')?'':'d-none')+'"></span>\n\t\t\t\t</span>');template.appendTo(liElement);},registerCustomFilterOptionsHoverEvent:function registerCustomFilterOptionsHoverEvent(){var _this3=this,filterBlock=this.getFilterBlock();!1!=filterBlock&&filterBlock.on('mouseenter mouseleave','li.select2-results__option[role="treeitem"]',function(event){var liElement=$(event.currentTarget),liFilterImages=liElement.find('.js-filter-actions');liElement.hasClass('group-result')||'mouseenter'===event.type&&0===liFilterImages.length&&_this3.appendFilterActionsTemplate(liElement);});},registerRowClickEvent:function registerRowClickEvent(){var listViewContentDiv=this.getListViewContentContainer();listViewContentDiv.on('click','.listViewEntries',function(e){if(!jQuery(e.target).closest('div').hasClass('actions')&&!(jQuery(e.target).is('button')||jQuery(e.target).parent().is('button'))&&!jQuery(e.target).closest('a').hasClass('noLinkBtn')&&!jQuery(e.target,jQuery(e.currentTarget)).is('td:first-child')&&!jQuery(e.target).is('input[type="checkbox"]')&&!$.contains(jQuery(e.currentTarget).find('td:last-child').get(0),e.target)&&!$.contains(jQuery(e.currentTarget).find('td:first-child').get(0),e.target)){var elem=jQuery(e.currentTarget),recordUrl=elem.data('recordurl');'undefined'==typeof recordUrl||(window.location.href=recordUrl);}});},registerRecordEvents:function registerRecordEvents(){var thisInstance=this,listViewContentDiv=this.getListViewContentContainer();listViewContentDiv.on('click','.recordEvent',function(event){var target=$(this),recordId=target.closest('tr').data('id'),params={};target.data('confirm')?(params.message=target.data('confirm'),params.title=target.html()+' '+target.data('content')):params.message=target.data('content'),Vtiger_Helper_Js.showConfirmationBox(params).done(function(){var progressIndicatorElement=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});AppConnector.request(target.data('url')+'&sourceView=List&record='+recordId).done(function(data){if(progressIndicatorElement.progressIndicator({mode:'hide'}),data&&data.success){data.result.notify&&Vtiger_Helper_Js.showMessage(data.result.notify);var paginationObject=$('.pagination'),totalCount=paginationObject.data('totalCount');''!=totalCount&&(totalCount--,paginationObject.data('totalCount',totalCount));var orderBy=jQuery('#orderBy').val(),sortOrder=jQuery('#sortOrder').val(),pageNumber=parseInt($('#pageNumber').val());1==$('#noOfEntries').val()&&1!=pageNumber&&pageNumber--;var urlParams={viewname:data.result.viewname,orderby:orderBy,sortorder:sortOrder,page:pageNumber};$('#recordsCount').val(''),$('#totalPageCount').text(''),thisInstance.getListViewRecords(urlParams).done(function(){thisInstance.updatePagination(pageNumber);});}else Vtiger_Helper_Js.showPnotify({text:app.vtranslate(data.error.message),title:app.vtranslate('JS_LBL_PERMISSION')});});}),event.stopPropagation();});},registerMassRecordsEvents:function registerMassRecordsEvents(){var thisInstance=this;jQuery('.listViewActionsDiv').on('click','.massRecordEvent',function(){var target=$(this),listInstance=Vtiger_List_Js.getInstance(),validationResult=listInstance.checkListRecordSelected();if(!0!=validationResult){var params={};target.data('confirm')?(params.message=target.data('confirm'),params.title=target.html()):params.message=target.html(),Vtiger_Helper_Js.showConfirmationBox(params).done(function(){var progressIndicatorElement=jQuery.progressIndicator(),postData={viewname:listInstance.getCurrentCvId(),selected_ids:listInstance.readSelectedIds(!0),excluded_ids:listInstance.readExcludedIds(!0)},listViewInstance=Vtiger_List_Js.getInstance();if(listViewInstance.getListSearchInstance()){var searchValue=listViewInstance.getListSearchInstance().getAlphabetSearchValue();postData.search_params=JSON.stringify(listViewInstance.getListSearchInstance().getListSearchParams()),'undefined'!=typeof searchValue&&0<searchValue.length&&(postData.search_key=listViewInstance.getListSearchInstance().getAlphabetSearchField(),postData.search_value=searchValue,postData.operator='s');}AppConnector.request({type:'POST',url:target.data('url'),data:postData}).done(function(data){progressIndicatorElement.progressIndicator({mode:'hide'}),data&&data.result&&data.result.notify&&Vtiger_Helper_Js.showMessage(data.result.notify),thisInstance.getListViewRecords(),thisInstance.writeSelectedIds([]);}).fail(function(){progressIndicatorElement.progressIndicator({mode:'hide'});});});}else listInstance.noRecordSelectedAlert();});},registerEmailFieldClickEvent:function registerEmailFieldClickEvent(){var listViewContentDiv=this.getListViewContentContainer();listViewContentDiv.on('click','.emailField',function(e){e.stopPropagation();});},registerPhoneFieldClickEvent:function registerPhoneFieldClickEvent(){var listViewContentDiv=this.getListViewContentContainer();listViewContentDiv.on('click','.phoneField',function(e){e.stopPropagation();});},registerUrlFieldClickEvent:function registerUrlFieldClickEvent(){var listViewContentDiv=this.getListViewContentContainer();listViewContentDiv.on('click','.urlField',function(e){e.stopPropagation();});},inactiveFieldsValidation:function inactiveFieldsValidation(form){var massEditFieldList=jQuery('#massEditFieldsNameList').data('value');for(var fieldName in massEditFieldList){var fieldInfo=massEditFieldList[fieldName],fieldElement=form.find('[name="'+fieldInfo.name+'"]');if('reference'==fieldInfo.type?fieldElement=form.find('[name="'+fieldInfo.name+'_display"]'):('multipicklist'==fieldInfo.type||'sharedOwner'==fieldInfo.type)&&(fieldElement=form.find('[name="'+fieldInfo.name+'[]"]')),0!=fieldElement.length){var elemData=fieldElement.data(),validationVal='validate[]';'validationEngine'in elemData&&(validationVal=elemData.validationEngine,delete elemData.validationEngine),fieldElement.attr('data-invalid-validation-engine',validationVal),fieldElement.removeAttr('data-validation-engine');}}},registerEventForTabClick:function registerEventForTabClick(form){var ulContainer=form.find('.massEditTabs');ulContainer.on('click','a[data-toggle="tab"]',function(e){form.validationEngine('validate');var invalidFields=form.data('jqv').InvalidFields;0<invalidFields.length&&e.stopPropagation();});},registerSlimScrollMassEdit:function registerSlimScrollMassEdit(){app.showScrollBar(jQuery('div[name="massEditContent"]'),{height:app.getScreenHeight(70)+'px'});},registerMassActionSubmitEvent:function registerMassActionSubmitEvent(){var thisInstance=this;jQuery('body').on('submit','#massSave',function(e){var form=jQuery(e.currentTarget),commentContent=form.find('#commentcontent'),commentContentValue=commentContent.val();if(''==commentContentValue){var errorMsg=app.vtranslate('JS_LBL_COMMENT_VALUE_CANT_BE_EMPTY');return commentContent.validationEngine('showPrompt',errorMsg,'error','bottomLeft',!0),void e.preventDefault()}commentContent.validationEngine('hide'),jQuery(form).find('[name=saveButton]').attr('disabled','disabled'),thisInstance.massActionSave(form).done(function(){Vtiger_List_Js.clearList();}),e.preventDefault();});},changeCustomFilterElementView:function changeCustomFilterElementView(){var thisInstance=this,filterSelectElement=this.getFilterSelectElement();if(0<filterSelectElement.length&&filterSelectElement.is('select')){App.Fields.Picklist.showSelect2ElementView(filterSelectElement,{templateSelection:function templateSelection(data){var resultContainer=jQuery('<span></span>');return resultContainer.append(jQuery(jQuery('.filterImage').clone().get(0)).show()),resultContainer.append(data.text),resultContainer},customSortOptGroup:!0,closeOnSelect:!0});var select2Instance=filterSelectElement.data('select2');jQuery('.filterActionsDiv').appendTo(select2Instance.$dropdown.find('.select2-dropdown:last')).removeClass('d-none').on('click',function(e){thisInstance.createFilterClickEvent(e);});}},triggerDisplayTypeEvent:function triggerDisplayTypeEvent(){var widthType=app.cacheGet('widthType','narrowWidthType');if(widthType){var elements=jQuery('.listViewEntriesTable').find('td,th');elements.attr('class',widthType);}},registerEventForTotalRecordsCount:function registerEventForTotalRecordsCount(){var thisInstance=this;jQuery('.totalNumberOfRecords').on('click',function(e){var element=jQuery(e.currentTarget),totalRecordsElement=jQuery('#totalCount'),totalNumberOfRecords=totalRecordsElement.val();element.addClass('d-none'),element.parent().progressIndicator({}),''==totalNumberOfRecords?thisInstance.getPageCount().done(function(data){totalNumberOfRecords=data.result.numberOfRecords,totalRecordsElement.val(totalNumberOfRecords),thisInstance.showPagingInfo();}):thisInstance.showPagingInfo(),element.parent().progressIndicator({mode:'hide'});});},showPagingInfo:function showPagingInfo(){var totalNumberOfRecords=jQuery('#totalCount').val(),pageNumberElement=jQuery('.pageNumbersText'),pageRange=pageNumberElement.text(),listViewEntriesCount=parseInt(jQuery('#noOfEntries').val());0==listViewEntriesCount?jQuery('.pageNumbersText').html(''):jQuery('.pageNumbersText').html(pageRange+' ('+totalNumberOfRecords+')');},registerUnreviewedCountEvent:function registerUnreviewedCountEvent(){var ids=[],listViewContentDiv=this.getListViewContentContainer(),isUnreviewedActive=listViewContentDiv.find('.unreviewed').length;if(listViewContentDiv.find('tr.listViewEntries').each(function(){var id=jQuery(this).data('id');id&&ids.push(id);}),!(1>isUnreviewedActive)){var actionParams={action:'ChangesReviewedOn',mode:'getUnreviewed',module:'ModTracker',sourceModule:app.getModuleName(),recordsId:ids};AppConnector.request(actionParams).done(function(appData){var data=appData.result;$.each(data,function(id,value){0<value.a&&listViewContentDiv.find('tr[data-id="'+id+'"] .unreviewed .badge.all').text(value.a).parent().removeClass('d-none'),0<value.m&&listViewContentDiv.find('tr[data-id="'+id+'"] .unreviewed .badge.mail').text(value.m).parent().removeClass('d-none');}),Vtiger_Helper_Js.showHorizontalTopScrollBar();});}},registerLastRelationsEvent:function registerLastRelationsEvent(){var ids=[],listViewContentDiv=this.getListViewContentContainer(),isTimeLineActive=listViewContentDiv.find('.timeLineIconList').length;if(listViewContentDiv.find('tr.listViewEntries').each(function(){var id=jQuery(this).data('id');id&&ids.push(id);}),!(1>isTimeLineActive)){var actionParams={action:'LastRelation',module:'ModTracker',sourceModule:app.getModuleName(),recordsId:ids};AppConnector.request(actionParams).done(function(appData){var data=appData.result;$.each(data,function(id,value){value.type&&listViewContentDiv.find('tr[data-id="'+id+'"] .timeLineIconList').addClass(value.color+' userIcon-'+value.type).parent().removeClass('d-none').on('click',function(e){var element=jQuery(e.currentTarget),url=element.data('url');app.showModalWindow(null,url,function(data){Vtiger_Index_Js.registerMailButtons(data);});});}),Vtiger_Helper_Js.showHorizontalTopScrollBar();});}},registerChangeEntityStateEvent:function registerChangeEntityStateEvent(){var thisInstance=this;$('.dropdownEntityState a').on('click',function(){var element=$(this);element.closest('ul').find('a').removeClass('active'),element.addClass('active'),$('#entityState').val(element.data('value')),app.setMainParams('pageNumber','1'),app.setMainParams('pageToJump','1'),$('#recordsCount').val(''),$('#totalPageCount').text(''),$('.pagination').data('totalCount',0),$('#dropdownEntityState').find('[data-fa-i2svg]').attr('class',element.find('[data-fa-i2svg]').attr('class')),thisInstance.getListViewRecords().done(function(){thisInstance.calculatePages().done(function(){thisInstance.updatePagination();});});});},registerSummationEvent:function registerSummationEvent(){var thisInstance=this;this.getListViewContentContainer().on('click','.listViewSummation button',function(){var button=$(this),calculateValue=button.closest('td').find('.calculateValue'),params=thisInstance.getDefaultParams(),progress=$.progressIndicator({message:app.vtranslate('JS_CALCULATING_IN_PROGRESS'),position:'html',blockInfo:{enabled:!0}});params.action='List',params.mode='calculate',params.fieldName=button.data('field'),params.calculateType=button.data('operator'),!0!=thisInstance.checkListRecordSelected()&&(params.selected_ids=thisInstance.readSelectedIds(!0),params.excluded_ids=thisInstance.readExcludedIds(!0)),delete params.view,app.hidePopover(button),AppConnector.request(params).done(function(response){response.success?calculateValue.html(response.result):calculateValue.html(''),progress.progressIndicator({mode:'hide'});});});},registerListScroll:function registerListScroll(container){if('ListPreview'!==CONFIG.view){var containerH=container.height(),containerOffsetTop=container.offset().top,footerH=$('.js-footer').height(),windowH=$(window).height();$(window).width()>app.breakpoints.sm&&(containerH+containerOffsetTop+footerH>windowH&&container.height(windowH-(containerOffsetTop+footerH)),app.showNewScrollbarTopBottomRight(container));}},registerMassActionsBtnMergeEvents:function registerMassActionsBtnMergeEvents(){var _this4=this;this.getListViewContainer().on('click','.js-mass-action--merge',function(e){var url=$(e.target).data('url');'undefined'!=typeof url&&(!0===_this4.checkListRecordSelected(2)?_this4.noRecordSelectedAlert('JS_SELECT_ATLEAST_TWO_RECORD_FOR_MERGING'):Vtiger_List_Js.triggerMassAction(url));});},registerEvents:function registerEvents(){this.breadCrumbsFilter(),this.registerRowClickEvent(),this.registerPageNavigationEvents(),this.registerMainCheckBoxClickEvent(),this.registerCheckBoxClickEvent(),this.registerSelectAllClickEvent(),this.registerDeselectAllClickEvent(),this.registerRecordEvents(),this.registerMassRecordsEvents(),this.registerMassActionsBtnMergeEvents(),this.registerHeadersClickEvent(),this.registerMassActionSubmitEvent(),this.changeCustomFilterElementView(),this.registerChangeCustomFilterEventListeners(),this.registerChangeEntityStateEvent(),this.registerDuplicateFilterClickEvent(),this.registerEditFilterClickEvent(),this.registerDeleteFilterClickEvent(),this.registerApproveFilterClickEvent(),this.registerDenyFilterClickEvent(),this.registerCustomFilterOptionsHoverEvent(),this.registerEmailFieldClickEvent(),this.registerPhoneFieldClickEvent(),Vtiger_Helper_Js.showHorizontalTopScrollBar(),this.registerUrlFieldClickEvent(),this.registerEventForTotalRecordsCount(),this.registerSummationEvent();var listViewContainer=this.getListViewContentContainer();listViewContainer.find('#listViewEntriesMainCheckBox,.listViewEntriesCheckBox').prop('checked',!1),this.registerListScroll(listViewContainer),this.getListSearchInstance(!1),this.registerListViewSpecialOption(),this.registerUnreviewedCountEvent(),this.registerLastRelationsEvent(),app.showPopoverElementView(listViewContainer.find('.js-popover-tooltip')),Vtiger_Index_Js.registerMailButtons(listViewContainer);},registerListViewSpecialOption:function registerListViewSpecialOption(){var thisInstance=this,listViewContainer=this.getListViewContentContainer(),box=listViewContainer.find('.listViewEntriesTable input.searchInSubcategories');box.on('change',function(e){var element=jQuery(e.currentTarget),searchContributorElement=jQuery('.listSearchContributor[name="'+element.data('columnname')+'"]'),searchValue=searchContributorElement.val();searchValue&&thisInstance.getListSearchInstance().triggerListSearch();});},postMassDeleteRecords:function postMassDeleteRecords(){var aDeferred=jQuery.Deferred(),listInstance=Vtiger_List_Js.getInstance();app.hideModalWindow();app.getModuleName();return listInstance.getListViewRecords().done(function(){jQuery('#recordsCount').val(''),jQuery('#totalPageCount').text(''),jQuery('#deSelectAllMsg').trigger('click'),listInstance.calculatePages().done(function(){listInstance.updatePagination();}),aDeferred.resolve();}),jQuery('#recordsCount').val(''),aDeferred.promise()}});
//# sourceMappingURL=List.min.js.map
