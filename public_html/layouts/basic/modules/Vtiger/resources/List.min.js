'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
  return typeof obj;
} : function (obj) {
  return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
};

jQuery.Class('Vtiger_List_Js',{listInstance:!1,getRelatedModulesContainer:!1,massEditPreSave:'Vtiger.MassEdit.PreSave',getInstance:function e(){if(!1===Vtiger_List_Js.listInstance){var t,a,i,n=app.getModuleName(),r=app.getParentModuleName();return 'Settings'==r?(t=r+'_'+n+'_List_Js','undefined'==typeof window[t]&&(t=n+'_List_Js'),a=r+'_Vtiger_List_Js','undefined'==typeof window[a]&&(a='Vtiger_List_Js')):(t=n+'_List_Js',a='Vtiger_List_Js'),i='undefined'==typeof window[t]?new window[a]:new window[t],Vtiger_List_Js.listInstance=i,i}return Vtiger_List_Js.listInstance},triggerSendEmail:function s(e){var t=Vtiger_List_Js.getInstance(),a=t.checkListRecordSelected();if(!0!=a){var i=t.readSelectedIds(!0),n=t.readExcludedIds(!0),r=t.getDefaultParams();delete r.parent,r.module=app.getModuleName(),r.view='SendMailModal',r.selected_ids=i,r.excluded_ids=n,r.cvid=t.getCurrentCvId(),e&&jQuery.extend(r,e),AppConnector.request(r).done(function(e){app.showModalWindow(e,function(e){e.find('[name="saveButton"]').on('click',function(){e.find('form').validationEngine('validate')&&(jQuery.extend(r,{field:e.find('#field').val(),template:e.find('#template').val(),action:'Mail',mode:'sendMails'}),delete r.view,AppConnector.request(r).done(function(e){!0==e.result&&app.hideModalWindow();}).fail(function(){app.hideModalWindow();}));});});});}else t.noRecordSelectedAlert();},triggerSendSms:function i(e){var t=Vtiger_List_Js.getInstance(),a=t.checkListRecordSelected();!0==a?t.noRecordSelectedAlert():Vtiger_List_Js.triggerMassAction(e);},triggerTransferOwnership:function r(e){var t=this,a=Vtiger_List_Js.getInstance(),i=a.checkListRecordSelected();if(!0!=i){var n=jQuery.progressIndicator();t.getRelatedModulesContainer=!1;AppConnector.request({type:'POST',url:e,dataType:'html',data:{}}).done(function(e){if(n.progressIndicator({mode:'hide'}),e){var a=function(e){var a=app.validationEngineOptions;a.onValidationComplete=function(e,a){return a&&t.transferOwnershipSave(e),!1},e.find('#changeOwner').validationEngine(app.validationEngineOptions);};app.showModalWindow(e,function(e){var i=t.getRelatedModuleContainer();App.Fields.Picklist.changeSelectElementView(i,'select2'),'function'==typeof a&&a(e);});}});}else a.noRecordSelectedAlert();},triggerQuickExportToExcel:function g(e){var a=Vtiger_List_Js.getInstance(),i=a.checkListRecordSelected();if(!0!=i){var n=jQuery.progressIndicator(),r=a.readSelectedIds(!0),s=a.readExcludedIds(!0),l=a.getCurrentCvId(),o={viewname:l,selected_ids:r,excluded_ids:s},d=a.getListSearchInstance().getAlphabetSearchValue();o.search_params=JSON.stringify(a.getListSearchInstance().getListSearchParams()),'undefined'!=typeof d&&0<d.length&&(o.search_key=a.getListSearchInstance().getAlphabetSearchField(),o.search_value=d,o.operator='s');var c=$('<form method="POST" action="index.php">');c.append($('<input />',{name:'module',value:e})),c.append($('<input />',{name:'action',value:'QuickExport'})),c.append($('<input />',{name:'mode',value:'exportToExcel'})),'undefined'!=typeof csrfMagicName&&c.append($('<input />',{name:csrfMagicName,value:csrfMagicToken})),$.each({type:'POST',url:'index.php',dataType:'application/x-msexcel',data:o}.data,function(e,t){c.append($('<input />',{name:e,value:t}));}),$('body').append(c),c.submit(),Vtiger_Helper_Js.showMessage({text:app.vtranslate('JS_STARTED_GENERATING_FILE'),type:'info'}),n.progressIndicator({mode:'hide'});}else a.noRecordSelectedAlert();},transferOwnershipSave:function l(){var e=Vtiger_List_Js.getInstance(),t=e.readSelectedIds(!0),a=e.readExcludedIds(!0),i=e.getCurrentCvId(),n=jQuery('#transferOwnerId').val(),r=jQuery('#related_modules').val(),s={module:app.getModuleName(),action:'TransferOwnership',viewname:i,selected_ids:t,excluded_ids:a,transferOwnerId:n,related_modules:r};AppConnector.request(s).done(function(t){if(t.success){app.hideModalWindow();var a={title:app.vtranslate('JS_MESSAGE'),text:app.vtranslate('JS_RECORDS_TRANSFERRED_SUCCESSFULLY'),type:'info'};Vtiger_Helper_Js.showPnotify(a),e.getListViewRecords(),Vtiger_List_Js.clearList();}});},getRelatedModuleContainer:function e(){return !1==this.getRelatedModulesContainer&&(this.getRelatedModulesContainer=jQuery('#related_modules')),this.getRelatedModulesContainer},triggerMassAction:function p(e,t,a,i){'undefined'==typeof a&&(a=function(){return !0}),'object'==('undefined'==typeof a?'undefined':_typeof(a))&&(i=a,a=function(){return !0});var n=Vtiger_List_Js.getInstance(),r=n.checkListRecordSelected();if(!0!=r){var s=jQuery.progressIndicator(),l=n.readSelectedIds(!0),o=n.readExcludedIds(!0),d=n.getCurrentCvId(),c={viewname:d,selected_ids:l,excluded_ids:o},g=Vtiger_List_Js.getInstance();if(g.getListSearchInstance()){var u=g.getListSearchInstance().getAlphabetSearchValue();c.search_params=JSON.stringify(g.getListSearchInstance().getListSearchParams()),'undefined'!=typeof u&&0<u.length&&(c.search_key=g.getListSearchInstance().getAlphabetSearchField(),c.search_value=u,c.operator='s');}'undefined'==typeof i&&(i={}),i=jQuery.extend({"text-align":'left'},i),AppConnector.request({type:'POST',url:e,dataType:'html',data:c}).done(function(e){if(s.progressIndicator({mode:'hide'}),e){var r=a(e);if(!r)return;app.showModalWindow(e,function(e){'function'==typeof t&&t(e);},i),$('#massEditContainer').length&&n.inactiveFieldsValidation($('#massEditContainer').find('form'));}}).fail(function(e,t){s.progressIndicator({mode:'hide'}),Vtiger_Helper_Js.showPnotify({title:app.vtranslate('JS_MESSAGE'),text:t,type:'error'});});}else n.noRecordSelectedAlert();},triggerMassEdit:function i(e){var t=this.getSelectedRecordCount();if(t>jQuery('#listMaxEntriesMassEdit').val()){var a={title:app.vtranslate('JS_MESSAGE'),text:app.vtranslate('JS_MASS_EDIT_LIMIT'),type:'error'};return void Vtiger_Helper_Js.showPnotify(a)}Vtiger_List_Js.triggerMassAction(e,function(e){var t=e.find('#massEdit');t.validationEngine(app.validationEngineOptions);var a=Vtiger_List_Js.getInstance();a.registerEventForTabClick(t);var i=Vtiger_Edit_Js.getInstance();i.registerBasicEvents(t),a.postMassEdit(e),a.registerSlimScrollMassEdit();},{width:'65%'});},getSelectedRecordCount:function s(){var e,t=Vtiger_List_Js.getInstance(),a=t.getCurrentCvId(),i=jQuery('#selectedIds').data(a+'Selectedids');if(i!=null)if('all'!=i)e=i.length;else{var n=jQuery('#excludedIds').data(a+'Excludedids').length,r=jQuery('#recordsCount').val();e=r-n;}return e},triggerExportAction:function o(e){var t=Vtiger_List_Js.getInstance(),a=t.readSelectedIds(!0),i=t.readExcludedIds(!0),n=t.getCurrentCvId(),r=jQuery('#pageNumber').val();e+='undefined'==typeof n?'&selected_ids='+a+'&excluded_ids='+i+'&page='+r:'&selected_ids='+a+'&excluded_ids='+i+'&viewname='+n+'&page='+r;var s=Vtiger_List_Js.getInstance();if(s.getListSearchInstance()){var l=s.getListSearchInstance().getAlphabetSearchValue();e+='&search_params='+JSON.stringify(s.getListSearchInstance().getListSearchParams()),'undefined'!=typeof l&&0<l.length&&(e+='&search_key='+s.getListSearchInstance().getAlphabetSearchField(),e+='&search_value='+l,e+='&operator=s');}window.location.href=e;},clearList:function e(){jQuery('#deSelectAllMsg').trigger('click'),jQuery('#selectAllMsgDiv').hide();},triggerListSearch:function a(){var e=Vtiger_List_Js.getInstance(),t=e.getListViewContentContainer();t.find('[data-trigger="listSearch"]').trigger('click');},getSelectedRecordsParams:function l(e){var t=Vtiger_List_Js.getInstance();if(!1==e||!0!=t.checkListRecordSelected()){var a=t.readSelectedIds(!0),i=t.readExcludedIds(!0),n=t.getCurrentCvId(),r={viewname:n,selected_ids:a,excluded_ids:i},s=t.getListSearchInstance().getAlphabetSearchValue();return r.search_params=JSON.stringify(t.getListSearchInstance().getListSearchParams()),'undefined'!=typeof s&&0<s.length&&(r.search_key=t.getListSearchInstance().getAlphabetSearchField(),r.search_value=s,r.operator='s'),r}return t.noRecordSelectedAlert(),!1},triggerGenerateRecords:function n(e){var t=Vtiger_List_Js.getSelectedRecordsParams();if(!1===t)return !1;var a={};jQuery.extend(a,t),e+='&'+jQuery.param(a);var i=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});app.showModalWindow(null,e,function(){i.progressIndicator({mode:'hide'});});},showMap:function a(){var e=Vtiger_List_Js.getSelectedRecordsParams(!1),t='index.php?module=OpenStreetMap&view=MapModal&srcModule='+app.getModuleName();app.showModalWindow(null,t,function(t){var a=new OpenStreetMap_Map_Js;a.setSelectedParams(e),a.registerModalView(t);});},triggerReviewChanges:function o(e){var t=Vtiger_List_Js.getInstance(),a=t.checkListRecordSelected();if(!0!=a){var i=t.readSelectedIds(!0),n=t.readExcludedIds(!0),r=t.getCurrentCvId(),s=app.vtranslate('JS_MASS_REVIEWING_CHANGES_CONFIRMATION'),l='<i class="fa fa-check-circle"></i> '+app.vtranslate('JS_LBL_REVIEW_CHANGES');Vtiger_Helper_Js.showConfirmationBox({message:s,title:l}).done(function(){var a=e+'&viewname='+r+'&selected_ids='+i+'&excluded_ids='+n;if(t.getListSearchInstance()){var s=t.getListSearchInstance().getAlphabetSearchValue();a+='&search_params='+JSON.stringify(t.getListSearchInstance().getListSearchParams()),'undefined'!=typeof s&&0<s.length&&(a+='&search_key='+t.getListSearchInstance().getAlphabetSearchField(),a+='&search_value='+s,a+='&operator=s');}var l=app.vtranslate('JS_LOADING_PLEASE_WAIT'),o=jQuery.progressIndicator({message:l,position:'html',blockInfo:{enabled:!0}});AppConnector.request(a).done(function(e){if(o.progressIndicator({mode:'hide'}),e.result){var a={text:e.result,type:'info'};Vtiger_Helper_Js.showPnotify(a);}else t.getListViewRecords();}).fail(function(e,t){app.errorLog(e,t);});}).fail(function(){Vtiger_List_Js.clearList();});}else t.noRecordSelectedAlert();}},{listViewContainer:!1,listViewTopMenuContainer:!1,listViewContentContainer:!1,filterBlock:!1,filterSelectElement:!1,listSearchInstance:!1,noEventsListSearch:!0,getListSearchInstance:function t(e){return null!=e&&(this.noEventsListSearch=e),!1==this.listSearchInstance&&(this.getListViewContainer().find('.searchField').length||this.getListViewContainer().find('.picklistSearchField').length)&&(this.listSearchInstance=YetiForce_ListSearch_Js.getInstance(this.getListViewContainer(),this.noEventsListSearch)),this.listSearchInstance},getListViewContainer:function e(){return !1==this.listViewContainer&&(this.listViewContainer=jQuery('div.listViewPageDiv')),this.listViewContainer},getListViewTopMenuContainer:function e(){return !1==this.listViewTopMenuContainer&&(this.listViewTopMenuContainer=jQuery('.listViewTopMenuDiv')),this.listViewTopMenuContainer},getListViewContentContainer:function e(){return !1==this.listViewContentContainer&&(this.listViewContentContainer=jQuery('.listViewContentDiv')),this.listViewContentContainer},getFilterBlock:function t(){if(!1==this.filterBlock){var e=this.getFilterSelectElement();0>=e.length?this.filterBlock=jQuery():e.is('select')&&(this.filterBlock=e.data('select2').$dropdown);}return this.filterBlock},getFilterSelectElement:function e(){return !1==this.filterSelectElement&&(this.filterSelectElement=jQuery('#customFilter')),this.filterSelectElement},getDefaultParams:function i(){var e={module:app.getModuleName(),page:jQuery('#pageNumber').val(),view:app.getViewName(),viewname:this.getCurrentCvId(),orderby:jQuery('#orderBy').val(),sortorder:jQuery('#sortOrder').val(),entityState:jQuery('#entityState').val()};app.getParentModuleName()&&(e.parent=app.getParentModuleName());var t=this.getListSearchInstance();if(!1!==t){var a=t.getAlphabetSearchValue();e.search_params=JSON.stringify(t.getListSearchParams(!0)),'undefined'!=typeof a&&0<a.length&&(e.search_key=t.getAlphabetSearchField(),e.search_value=a,e.operator='s');}return e},getListViewRecords:function l(e){var t=$.Deferred();'undefined'==typeof e&&(e={});var a=this,i=$('#listViewContents'),n=jQuery('.listViewLoadingMsg').text(),r=$.progressIndicator({message:n,position:'html',blockInfo:{enabled:!0}}),s=this.getDefaultParams();return e=$.extend(s,e),AppConnector.requestPjax(e).done(function(e){r.progressIndicator({mode:'hide'}),i.html(e),app.event.trigger('RecordListView.AfterLoad',e,a),a.calculatePages().done(function(e){t.resolve(e),app.notifyPostAjaxReady();}),a.postLoadListViewRecordsEvents(i);}).fail(function(e,a){t.reject(e,a);}),t.promise()},postLoadListViewRecordsEvents:function r(e){var t=this;t.registerListScroll(e),App.Fields.Picklist.showSelect2ElementView(e.find('select.select2')),App.Fields.Picklist.changeSelectElementView(e),app.showPopoverElementView(e.find('.js-popover-tooltip')),t.registerListViewSpecialOption();var a=t.getListSearchInstance();!1!==a&&a.registerBasicEvents(),Vtiger_Index_Js.registerMailButtons(e),Vtiger_Helper_Js.showHorizontalTopScrollBar();var i=t.readSelectedIds();if(''!=i){if('all'==i){$('.listViewEntriesCheckBox').each(function(){$(this).prop('checked',!0).closest('tr').addClass('highlightBackgroundColor');}),$('#deSelectAllMsgDiv').show();var n=t.readExcludedIds();''!=n&&($('#listViewEntriesMainCheckBox').prop('checked',!1),$('.listViewEntriesCheckBox').each(function(e,t){-1!=$.inArray($(t).val(),n)&&$(t).prop('checked',!1).closest('tr').removeClass('highlightBackgroundColor');}));}else $('.listViewEntriesCheckBox').each(function(e,t){-1!=$.inArray($(t).val(),i)&&$(this).prop('checked',!0).closest('tr').addClass('highlightBackgroundColor');});t.checkSelectAll();}t.registerUnreviewedCountEvent(),t.registerLastRelationsEvent();},calculatePages:function r(){var e=jQuery.Deferred(),t=jQuery('#totalPageCount'),a=t.text();if(''==a){var i=jQuery('#totalCount').val();if(''!=i){var n=jQuery('#pageLimit').val();'0'==n&&(n=1);var s=Math.ceil(i/n);return 0==s&&(s=1),t.text(s),e.resolve(),e.promise()}e.resolve();}else e.resolve();return e.promise()},noRecordSelectedAlert:function t(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:'JS_PLEASE_SELECT_ONE_RECORD';return Vtiger_Helper_Js.showPnotify({text:app.vtranslate(e)})},massActionSave:function s(e,t){'undefined'==typeof t&&(t=!1);var a=jQuery.Deferred();if(t){var i=jQuery.Event(Vtiger_List_Js.massEditPreSave);if(e.trigger(i),i.isDefaultPrevented())return e.find('[name="saveButton"]').removeAttr('disabled'),a.reject(),a.promise();e.find('[id^="selectRow"]').each(function(e,t){t=jQuery(t),t.prop('checked')||t.closest('.js-form-row-container').find('.fieldValue [name]').each(function(e,t){t=jQuery(t),t.attr('data-element-name',t.attr('name')).removeAttr('name');});});}var n=e.serializeFormData(),r=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});return AppConnector.request(n).done(function(e){if(r.progressIndicator({mode:'hide'}),app.hideModalWindow(),!e.result){var t={text:app.vtranslate('JS_MASS_EDIT_NOT_SUCCESSFUL'),type:'info'};Vtiger_Helper_Js.showPnotify(t);}a.resolve(e);}).fail(function(e,t){app.hideModalWindow(),app.errorLog(e,t),a.reject(e,t);}),a.promise()},checkSelectAll:function t(){var e=!0;jQuery('.listViewEntriesCheckBox').each(function(t,a){return jQuery(a).is(':checked')?void(e=!0):(e=!1,!1)}),!0==e?jQuery('#listViewEntriesMainCheckBox').prop('checked',!0):jQuery('#listViewEntriesMainCheckBox').prop('checked',!1);},getRecordsCount:function n(){var e=jQuery.Deferred(),t=jQuery('#recordsCount').val();if(''!=t)e.resolve(t);else{var a='',i=this.getDefaultParams();i.view='ListAjax',i.mode='getRecordsCount',AppConnector.request(i).done(function(t){var i=JSON.parse(t);jQuery('#recordsCount').val(i.result.count),a=i.result.count,e.resolve(a);});}return e.promise()},getSelectOptionFromChosenOption:function n(e){var t=e.attr('id'),a=t.split('-'),i='';if(0<a.length)i=a[a.length-1];else return !1;return jQuery('#filterOptionId_'+i)},readSelectedIds:function s(e){var t=this.getCurrentCvId(),a=jQuery('#selectedIds'),i=t+'Selectedids',n=a.data();if(!(i in n)){var r=[];this.writeSelectedIds(r);}else r=n[i];return !0==e&&'object'==('undefined'==typeof r?'undefined':_typeof(r))?JSON.stringify(r):r},readExcludedIds:function s(e){var t=this.getCurrentCvId(),a=jQuery('#excludedIds'),i=t+'Excludedids',n=a.data();if(!(i in n)){var r=[];this.writeExcludedIds(r);}else r=n[i];return !0==e&&'object'==('undefined'==typeof r?'undefined':_typeof(r))?JSON.stringify(r):r},writeSelectedIds:function a(e){var t=this.getCurrentCvId();Array.isArray(e)||(e=[e]),jQuery('#selectedIds').data(t+'Selectedids',e);},writeExcludedIds:function a(e){var t=this.getCurrentCvId();jQuery('#excludedIds').data(t+'Excludedids',e);},getCurrentCvId:function e(){return jQuery('#customFilter').find('option:selected').data('id')},getAlphabetSearchField:function e(){return jQuery('#alphabetSearchKey').val()},getAlphabetSearchValue:function e(){return jQuery('#alphabetValue').val()},checkListRecordSelected:function a(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,t=this.readSelectedIds();return !!('object'===('undefined'==typeof t?'undefined':_typeof(t))&&t.length<e)},inactiveFieldValidation:function l(e){e.validationEngine('hide');var t=e.closest('form'),a=t.data('jqv').InvalidFields,n=[e.get(0)],r=e.attr('data-validation-engine');if(e.attr('data-invalid-validation-engine',r?r:'validate[]'),e.removeAttr('data-validation-engine'),e.is('select')&&e.hasClass('select2')){var o=app.getSelect2ElementFromSelect(e);o.validationEngine('hide'),n.push(o.get(0));}for(var s in n){var i=jQuery.inArray(n[s],a);'-1'!=i&&a.splice(i,1);}},activeFieldValidation:function a(e){var t=e.attr('data-invalid-validation-engine');'undefined'==typeof t||(e.attr('data-validation-engine',t?t:'validate[]'),e.removeAttr('data-invalid-validation-engine'));},postMassEdit:function i(e){var t=this,a=Vtiger_Edit_Js.getInstance();e.find('.selectRow').on('change',function(i){var n=jQuery(i.currentTarget),r=n.closest('.js-form-row-container').find('.fieldValue'),s=r.find('[data-validation-engine],[data-invalid-validation-engine]'),l=s.data('fieldinfo');if(n.prop('checked')?t.activeFieldValidation(s):t.inactiveFieldValidation(s),void 0!==l&&'reference'===l.type){var o=a.getMappingRelatedField(l.name,a.getReferencedModuleName(r),e);$.each(o,function(t){var a=e.find('[id="selectRow'+t+'"]');a.length&&a.prop('disabled')&&(a.prop('disabled',!1),a.trigger('click'),a.prop('disabled',!0));});}}),e.find('form').on('submit',function(a){var e=jQuery(a.currentTarget);if('undefined'!=typeof e.data('submit'))return !1;if(e.validationEngine('validate')){if(a.preventDefault(),!e.find('input[id^="selectRow"]:checked').length)return void Vtiger_Helper_Js.showPnotify(app.vtranslate('NONE_OF_THE_FIELD_VALUES_ARE_CHANGED_IN_MASS_EDIT'));var i=e.data('jqv').InvalidFields;if(0==i.length)e.find('[name="saveButton"]').prop('disabled',!0);else return;t.massActionSave(e,!0).done(function(){t.getListViewRecords(),Vtiger_List_Js.clearList();}).fail(function(e,t){app.errorLog(e,t);});}else e.removeData('submit'),app.formAlignmentAfterValidation(e);});},registerPageNavigationEvents:function a(){var e=jQuery.Deferred(),t=this;jQuery('#listViewNextPageButton').on('click',function(){if(!$(this).hasClass('disabled')){var a=jQuery('#pageLimit').val(),i=jQuery('#noOfEntries').val();if(i==a){var n=jQuery('#orderBy').val(),r=jQuery('#sortOrder').val(),s=t.getCurrentCvId(),l=jQuery('#pageNumber').val(),o=parseInt(parseFloat(l))+1;jQuery('#pageNumber').val(o),jQuery('#pageToJump').val(o),t.getListViewRecords({orderby:n,sortorder:r,viewname:s}).done(function(){t.updatePagination(o),e.resolve();}).fail(function(t,a){e.reject(t,a);});}return e.promise()}}),jQuery('#listViewPreviousPageButton').on('click',function(){var e=jQuery.Deferred(),a=jQuery('#pageNumber').val();if(1<a){var i=jQuery('#orderBy').val(),n=jQuery('#sortOrder').val(),r=t.getCurrentCvId(),s=parseInt(parseFloat(a))-1;jQuery('#pageNumber').val(s),jQuery('#pageToJump').val(s),t.getListViewRecords({orderby:i,sortorder:n,viewname:r}).done(function(){t.updatePagination(s),e.resolve();}).fail(function(t,a){e.reject(t,a);});}}),jQuery('.pageNumber').on('click',function(){var e=$(this).hasClass('disabled');if(e)return !1;var a=$(this).data('id'),i=jQuery('#orderBy').val(),n=jQuery('#sortOrder').val(),r=t.getCurrentCvId(),s=parseInt(parseFloat(a))-1;jQuery('#pageNumber').val(s),jQuery('#pageToJump').val(s),t.getListViewRecords({orderby:i,sortorder:n,viewname:r,page:a}).done(function(){t.updatePagination(a);}).fail(function(){});}),$('#totalCountBtn').on('click',function(){app.hidePopover(jQuery(this));var e={title:app.vtranslate('JS_LBL_PERMISSION'),text:app.vtranslate('JS_GET_PAGINATION_INFO'),type:'info'};Vtiger_Helper_Js.showMessage(e);var a=t.getDefaultParams();a.totalCount=-1,a.view='Pagination',a.mode='getPagination',AppConnector.request(a).done(function(e){jQuery('.paginationDiv').html(e),t.registerPageNavigationEvents();});}),jQuery('#listViewPageJump').on('click',function(){if('undefined'!=typeof Vtiger_WholeNumberGreaterThanZero_Validator_Js.invokeValidation(jQuery('#pageToJump'))){var e=jQuery('#pageNumber').val();jQuery('#pageToJump').val(e);}jQuery('#pageToJump').validationEngine('hideAll');var a=jQuery('#totalPageCount'),i=a.text();if(''==i){var n=jQuery('#totalCount'),r=n.val();if(''!=r){var s=jQuery('#pageLimit').val();'0'==s&&(s=1);var l=Math.ceil(r/s);return 0==l&&(l=1),void a.text(l)}a.progressIndicator({}),t.getPageCount().done(function(e){var t=e.result.page;n.val(e.result.numberOfRecords),0==t&&(t=1),a.text(t),a.progressIndicator({mode:'hide'});});}}),jQuery('#listViewPageJumpDropDown').on('click','li',function(t){t.stopImmediatePropagation();}).on('keypress','#pageToJump',function(a){if(13==a.which){a.stopImmediatePropagation();var e=jQuery(a.currentTarget),i=Vtiger_WholeNumberGreaterThanZero_Validator_Js.invokeValidation(e);if('undefined'!=typeof i)e.validationEngine('showPrompt',i,'','topLeft',!0);else{e.validationEngine('hideAll');var n=jQuery('#pageNumber'),r=n.val(),s=parseInt(jQuery(a.currentTarget).val()),l=parseInt(jQuery('#totalPageCount').text());if(s>l){var o=app.vtranslate('JS_PAGE_NOT_EXIST');return void e.validationEngine('showPrompt',o,'','topLeft',!0)}if(s==r){var d=app.vtranslate('JS_YOU_ARE_IN_PAGE_NUMBER')+' '+s;return void Vtiger_Helper_Js.showMessage({text:d,type:'info'})}n.val(s),t.getListViewRecords().done(function(){t.updatePagination(s),e.closest('.btn-group ').removeClass('open');}).fail(function(){});}return !1}});},getPageCount:function a(){var e=jQuery.Deferred(),t=this.getPageJumpParams();return AppConnector.request(t).done(function(t){var a;a='object'==('undefined'==typeof t?'undefined':_typeof(t))?t:JSON.parse(t),e.resolve(a);}).fail(function(){}),e.promise()},getPageJumpParams:function t(){var e=this.getDefaultParams();return e.view='ListAjax',e.mode='getPageCount',e},updatePagination:function s(e){e='undefined'==typeof e?1:e;var t=this,a=t.getCurrentCvId(),i={};i.module=app.getModuleName(),'Settings'==app.getParentModuleName()&&(i.parent='Settings'),i.view='Pagination',i.viewname=a,i.page=e,i.mode='getPagination',i.sourceModule=jQuery('#moduleFilter').val(),i.totalCount=$('.pagination').data('totalCount');var n=this.getListSearchInstance();if(!1!==n){var r=n.getAlphabetSearchValue();i.search_params=JSON.stringify(this.getListSearchInstance().getListSearchParams()),'undefined'!=typeof r&&0<r.length&&(i.search_key=this.getListSearchInstance().getAlphabetSearchField(),i.search_value=r,i.operator='s');}i.noOfEntries=jQuery('#noOfEntries').val(),AppConnector.request(i).done(function(e){jQuery('.paginationDiv').html(e),t.registerPageNavigationEvents();});},registerChangeCustomFilterEvent:function l(e){var t=this,a=$(e.currentTarget),i='',n='',r='';a.is('option')?i=a:'select2:selecting'===e.type?(n=e.params.args.data.id,i=$('#filterOptionId_'+n)):'mouseup'===e.type&&(n=e.currentTarget.id.split('-').pop(),i=$('#filterOptionId_'+n),this.getFilterSelectElement().val(e.currentTarget.id.split('-').pop()).trigger('change')),0===$('.nav-item[data-cvid=\''+n+'\'] .nav-link').tab('show').length&&$('.js-filter-tab .active').removeClass('active'),'object'===('undefined'==typeof i?'undefined':_typeof(i))&&(r=i.text()),$('#select2-customFilter-container span').contents().last().replaceWith(r),app.setMainParams('pageNumber','1'),app.setMainParams('pageToJump','1'),app.setMainParams('orderBy',i.data('orderby')),app.setMainParams('sortOrder',i.data('sortorder'));var s={viewname:i.val(),search_key:this.getAlphabetSearchField(),search_value:'',search_params:''};jQuery('#recordsCount').val(''),jQuery('#totalPageCount').text(''),$('.pagination').data('totalCount',0),this.getListViewRecords(s).done(function(){t.breadCrumbsFilter(i.text()),t.ListViewPostOperation(),t.updatePagination(1);}),e.stopPropagation();},registerChangeCustomFilterEventListeners:function a(){var e=this,t=this.getFilterSelectElement();t.on('select2:selecting',function(a){return $(':focus').length?void e.registerChangeCustomFilterEvent(a):(a.preventDefault(),t.select2('close'),!1)}),t.on('click','option',this.registerChangeCustomFilterEvent.bind(this)),this.getFilterBlock().on('mouseup','li .select2-results__option',this.registerChangeCustomFilterEvent.bind(this)),this.getListViewTopMenuContainer().find('.js-filter-tab').on('click',function(a){var e=$(a.currentTarget).data('cvid'),i=t.find('[value='+e+']');i.trigger('click'),$('#select2-customFilter-container span').contents().last().replaceWith(i.text()),t.val(e).trigger('change');});},breadCrumbsFilter:function n(e){var t=jQuery('.breadcrumbsContainer'),a=t.last('span'),i=a.find('.breadCrumbsFilter');i.length&&e!=null?i.text(' ['+app.vtranslate('JS_FILTER')+': '+e+']'):1>i.length&&(e=e==null?this.getFilterSelectElement().find(':selected').text():e,a.hasClass('breadCrumbsFilter')?a.text(': '+e):t.append('<small class="breadCrumbsFilter hideToHistory p-1 js-text-content" data-js="text"> ['+app.vtranslate('JS_FILTER')+': '+e+']</small>'));},ListViewPostOperation:function e(){return !0},registerMainCheckBoxClickEvent:function a(){var e=this.getListViewContainer(),t=this;e.on('click','#listViewEntriesMainCheckBox',function(){var e=t.readSelectedIds(),a=t.readExcludedIds();if(jQuery('#listViewEntriesMainCheckBox').is(':checked')){var i=t.getRecordsCount();i.done(function(e){jQuery('#totalRecordsCount').text(e),'none'==jQuery('#deSelectAllMsgDiv').css('display')&&jQuery('#selectAllMsgDiv').show();}),jQuery('.listViewEntriesCheckBox').each(function(t,i){jQuery(this).prop('checked',!0).closest('tr').addClass('highlightBackgroundColor'),'all'==e?-1!=jQuery.inArray(jQuery(i).val(),a)&&a.splice(jQuery.inArray(jQuery(i).val(),a),1):-1==jQuery.inArray(jQuery(i).val(),e)&&e.push(jQuery(i).val());});}else jQuery('#selectAllMsgDiv').hide(),jQuery('.listViewEntriesCheckBox').each(function(t,i){jQuery(this).prop('checked',!1).closest('tr').removeClass('highlightBackgroundColor'),'all'==e?(a.push(jQuery(i).val()),e='all'):e.splice(jQuery.inArray(jQuery(i).val(),e),1);});t.writeSelectedIds(e),t.writeExcludedIds(a);});},registerCheckBoxClickEvent:function a(){var e=this.getListViewContainer(),t=this;e.on('click','.listViewEntriesCheckBox',function(a){var e=t.readSelectedIds(),i=t.readExcludedIds(),n=jQuery(a.currentTarget);n.is(':checked')?(n.closest('tr').addClass('highlightBackgroundColor'),'all'==e?i.splice(jQuery.inArray(n.val(),i),1):-1==jQuery.inArray(n.val(),e)&&e.push(n.val())):(n.closest('tr').removeClass('highlightBackgroundColor'),'all'==e?(i.push(n.val()),e='all'):e.splice(jQuery.inArray(n.val(),e),1)),t.checkSelectAll(),t.writeSelectedIds(e),t.writeExcludedIds(i);});},registerSelectAllClickEvent:function a(){var e=this.getListViewContainer(),t=this;e.on('click','#selectAllMsg',function(){jQuery('#selectAllMsgDiv').hide(),jQuery('#deSelectAllMsgDiv').show(),jQuery('#listViewEntriesMainCheckBox').prop('checked',!0),jQuery('.listViewEntriesCheckBox').each(function(){jQuery(this).prop('checked',!0).closest('tr').addClass('highlightBackgroundColor');}),t.writeSelectedIds('all');});},registerDeselectAllClickEvent:function a(){var e=this.getListViewContainer(),t=this;e.on('click','#deSelectAllMsg',function(){jQuery('#deSelectAllMsgDiv').hide(),jQuery('#listViewEntriesMainCheckBox').prop('checked',!1),jQuery('.listViewEntriesCheckBox').each(function(){jQuery(this).prop('checked',!1).closest('tr').removeClass('highlightBackgroundColor');});t.writeSelectedIds([]),t.writeExcludedIds([]);});},registerHeadersClickEvent:function a(){var e=this.getListViewContainer(),t=this;e.on('click','.listViewHeaderValues',function(a){var e=jQuery(a.currentTarget).data('columnname'),i=jQuery(a.currentTarget).data('nextsortorderval');if('undefined'!=typeof i){var n=t.getCurrentCvId();t.getListViewRecords({orderby:e,sortorder:i,viewname:n});}});},createFilterClickEvent:function t(e){this.getFilterSelectElement().data('select2').close(),Vtiger_CustomView_Js.loadFilterView($(e.currentTarget).find('#createFilter').data('createurl'));},registerDuplicateFilterClickEvent:function a(){var e=this,t=this.getFilterBlock();!1!=t&&t.on('mouseup','li [data-fa-i2svg].js-filter-duplicate',function(t){e.getFilterSelectElement().data('select2').close();var a=jQuery(t.currentTarget).closest('.select2-results__option'),i=e.getSelectOptionFromChosenOption(a),n=i.data('duplicateurl');Vtiger_CustomView_Js.loadFilterView(n),t.stopPropagation();});},registerEditFilterClickEvent:function a(){var e=this,t=this.getFilterBlock();!1!=t&&t.on('mouseup','li [data-fa-i2svg].js-filter-edit',function(t){e.getFilterSelectElement().data('select2').close();var a=jQuery(t.currentTarget).closest('.select2-results__option'),i=e.getSelectOptionFromChosenOption(a),n=i.data('editurl');Vtiger_CustomView_Js.loadFilterView(n);jQuery(this).data('cvid');t.stopPropagation();});},registerDeleteFilterClickEvent:function a(){var e=this,t=this.getFilterBlock();!1!=t&&t.on('mouseup','li [data-fa-i2svg].js-filter-delete',function(t){e.getFilterSelectElement().data('select2').close();var a=jQuery(t.currentTarget).closest('.select2-results__option'),i=app.vtranslate('JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE_FILTER');Vtiger_Helper_Js.showConfirmationBox({message:i}).done(function(){var t=e.getSelectOptionFromChosenOption(a),i=t.data('deleteurl'),n='<form action='+i+' method="POST">';'undefined'!=typeof csrfMagicName&&(n+='<input type = "hidden" name ="'+csrfMagicName+'"  value=\''+csrfMagicToken+'\'>'),n+='</form>';var r=jQuery(n);r.appendTo('body').submit();}),t.stopPropagation();});},registerApproveFilterClickEvent:function a(){var e=this,t=this.getFilterBlock();!1!=t&&t.on('mouseup','li [data-fa-i2svg].js-filter-approve',function(t){e.getFilterSelectElement().data('select2').close();var a=jQuery(t.currentTarget).closest('.select2-results__option'),i=e.getSelectOptionFromChosenOption(a),n=i.data('approveurl'),r='<form action='+n+' method="POST">';'undefined'!=typeof csrfMagicName&&(r+='<input type = "hidden" name ="'+csrfMagicName+'"  value=\''+csrfMagicToken+'\'>'),r+='</form>';var s=jQuery(r);s.appendTo('body').submit(),t.stopPropagation();});},registerDenyFilterClickEvent:function a(){var e=this,t=this.getFilterBlock();!1!=t&&t.on('mouseup','li [data-fa-i2svg].js-filter-deny',function(t){e.getFilterSelectElement().data('select2').close();var a=jQuery(t.currentTarget).closest('.select2-results__option'),i=e.getSelectOptionFromChosenOption(a),n=i.data('denyurl'),r='<form action='+n+' method="POST">';'undefined'!=typeof csrfMagicName&&(r+='<input type = "hidden" name ="'+csrfMagicName+'"  value=\''+csrfMagicToken+'\'>'),r+='</form>',jQuery(r).appendTo('body').submit(),t.stopPropagation();});},appendFilterActionsTemplate:function i(e){var t=this.getSelectOptionFromChosenOption(e),a=$('<span class="js-filter-actions o-filter-actions float-right">\n\t\t\t\t\t<span title="'+app.vtranslate('JS_DUPLICATE')+'" data-value="duplicate" data-js="click"\n\t\t\t\t\t\t  class="fas fa-retweet mr-1 js-filter-duplicate '+(0===$('#createFilter').length?'d-none':'')+'"></span>\n\t\t\t\t\t<span title="'+app.vtranslate('JS_EDIT')+'" data-value="edit" data-js="click"\n\t\t\t\t\t\t  class="fas fa-pencil-alt mr-1 js-filter-edit '+(1===t.data('editable')?'':'d-none')+'"></span>\n\t\t\t\t\t<span title="'+app.vtranslate('JS_DELETE')+'" data-value="delete" data-js="click"\n\t\t\t\t\t\t  class="fas fa-trash-alt mr-1 js-filter-delete '+(1===t.data('deletable')?'':'d-none')+'"></span>\n\t\t\t\t\t<span title="'+app.vtranslate('JS_DENY')+'" data-value="deny" data-js="click"\n\t\t\t\t\t\t  class="fas fa-exclamation-circle mr-1 js-filter-deny '+(1===t.data('public')?'':'d-none')+'"></span>\n\t\t\t\t\t<span title="'+app.vtranslate('JS_APPROVE')+'" data-value="approve" data-js="click"\n\t\t\t\t\t\t  class="fas fa-check mr-1 js-filter-approve '+(1===t.data('pending')?'':'d-none')+'"></span>\n\t\t\t\t</span>');a.appendTo(e);},registerCustomFilterOptionsHoverEvent:function a(){var e=this,t=this.getFilterBlock();!1!=t&&t.on('mouseenter mouseleave','li.select2-results__option[role="treeitem"]',function(t){var a=$(t.currentTarget),i=a.find('.js-filter-actions');a.hasClass('group-result')||'mouseenter'===t.type&&0===i.length&&e.appendFilterActionsTemplate(a);});},registerRowClickEvent:function a(){var t=this.getListViewContentContainer();t.on('click','.listViewEntries',function(t){if(!jQuery(t.target).closest('div').hasClass('actions')&&!(jQuery(t.target).is('button')||jQuery(t.target).parent().is('button'))&&!jQuery(t.target).closest('a').hasClass('noLinkBtn')&&!jQuery(t.target,jQuery(t.currentTarget)).is('td:first-child')&&!jQuery(t.target).is('input[type="checkbox"]')&&!$.contains(jQuery(t.currentTarget).find('td:last-child').get(0),t.target)&&!$.contains(jQuery(t.currentTarget).find('td:first-child').get(0),t.target)){var e=jQuery(t.currentTarget),a=e.data('recordurl');'undefined'==typeof a||(window.location.href=a);}});},registerRecordEvents:function a(){var e=this,t=this.getListViewContentContainer();t.on('click','.recordEvent',function(t){var a=$(this),i=a.closest('tr').data('id'),n={};a.data('confirm')?(n.message=a.data('confirm'),n.title=a.html()+' '+a.data('content')):n.message=a.data('content'),Vtiger_Helper_Js.showConfirmationBox(n).done(function(){var t=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});AppConnector.request(a.data('url')+'&sourceView=List&record='+i).done(function(a){if(t.progressIndicator({mode:'hide'}),a&&a.success){a.result.notify&&Vtiger_Helper_Js.showMessage(a.result.notify);var i=$('.pagination'),n=i.data('totalCount');''!=n&&(n--,i.data('totalCount',n));var r=jQuery('#orderBy').val(),s=jQuery('#sortOrder').val(),l=parseInt($('#pageNumber').val());1==$('#noOfEntries').val()&&1!=l&&l--;var o={viewname:a.result.viewname,orderby:r,sortorder:s,page:l};$('#recordsCount').val(''),$('#totalPageCount').text(''),e.getListViewRecords(o).done(function(){e.updatePagination(l);});}else Vtiger_Helper_Js.showPnotify({text:app.vtranslate(a.error.message),title:app.vtranslate('JS_LBL_PERMISSION')});});}),t.stopPropagation();});},registerMassRecordsEvents:function t(){var e=this;jQuery('.listViewActionsDiv').on('click','.massRecordEvent',function(){var t=$(this),a=Vtiger_List_Js.getInstance(),i=a.checkListRecordSelected();if(!0!=i){var n={};t.data('confirm')?(n.message=t.data('confirm'),n.title=t.html()):n.message=t.html(),Vtiger_Helper_Js.showConfirmationBox(n).done(function(){var i=jQuery.progressIndicator(),n={viewname:a.getCurrentCvId(),selected_ids:a.readSelectedIds(!0),excluded_ids:a.readExcludedIds(!0)},r=Vtiger_List_Js.getInstance();if(r.getListSearchInstance()){var s=r.getListSearchInstance().getAlphabetSearchValue();n.search_params=JSON.stringify(r.getListSearchInstance().getListSearchParams()),'undefined'!=typeof s&&0<s.length&&(n.search_key=r.getListSearchInstance().getAlphabetSearchField(),n.search_value=s,n.operator='s');}AppConnector.request({type:'POST',url:t.data('url'),data:n}).done(function(t){i.progressIndicator({mode:'hide'}),t&&t.result&&t.result.notify&&Vtiger_Helper_Js.showMessage(t.result.notify),e.getListViewRecords(),e.writeSelectedIds([]);}).fail(function(){i.progressIndicator({mode:'hide'});});});}else a.noRecordSelectedAlert();});},registerEmailFieldClickEvent:function t(){var e=this.getListViewContentContainer();e.on('click','.emailField',function(t){t.stopPropagation();});},registerPhoneFieldClickEvent:function t(){var e=this.getListViewContentContainer();e.on('click','.phoneField',function(t){t.stopPropagation();});},registerUrlFieldClickEvent:function t(){var e=this.getListViewContentContainer();e.on('click','.urlField',function(t){t.stopPropagation();});},inactiveFieldsValidation:function l(e){var t=jQuery('#massEditFieldsNameList').data('value');for(var a in t){var i=t[a],n=e.find('[name="'+i.name+'"]');if('reference'==i.type?n=e.find('[name="'+i.name+'_display"]'):('multipicklist'==i.type||'sharedOwner'==i.type)&&(n=e.find('[name="'+i.name+'[]"]')),0!=n.length){var r=n.data(),s='validate[]';'validationEngine'in r&&(s=r.validationEngine,delete r.validationEngine),n.attr('data-invalid-validation-engine',s),n.removeAttr('data-validation-engine');}}},registerEventForTabClick:function a(t){var e=t.find('.massEditTabs');e.on('click','a[data-toggle="tab"]',function(a){t.validationEngine('validate');var e=t.data('jqv').InvalidFields;0<e.length&&a.stopPropagation();});},registerSlimScrollMassEdit:function e(){app.showScrollBar(jQuery('div[name="massEditContent"]'),{height:app.getScreenHeight(70)+'px'});},registerMassActionSubmitEvent:function e(){var t=this;jQuery('body').on('submit','#massSave',function(a){var e=jQuery(a.currentTarget),i=e.find('#commentcontent'),n=i.val();if(''==n){var r=app.vtranslate('JS_LBL_COMMENT_VALUE_CANT_BE_EMPTY');return i.validationEngine('showPrompt',r,'error','bottomLeft',!0),void a.preventDefault()}i.validationEngine('hide'),jQuery(e).find('[name=saveButton]').attr('disabled','disabled'),t.massActionSave(e).done(function(){Vtiger_List_Js.clearList();}),a.preventDefault();});},changeCustomFilterElementView:function i(){var t=this,e=this.getFilterSelectElement();if(0<e.length&&e.is('select')){App.Fields.Picklist.showSelect2ElementView(e,{templateSelection:function a(e){var t=jQuery('<span></span>');return t.append(jQuery(jQuery('.filterImage').clone().get(0)).show()),t.append(e.text),t},customSortOptGroup:!0,closeOnSelect:!0});var a=e.data('select2');jQuery('.filterActionsDiv').appendTo(a.$dropdown.find('.select2-dropdown:last')).removeClass('d-none').on('click',function(a){t.createFilterClickEvent(a);});}},triggerDisplayTypeEvent:function a(){var e=app.cacheGet('widthType','narrowWidthType');if(e){var t=jQuery('.listViewEntriesTable').find('td,th');t.attr('class',e);}},registerEventForTotalRecordsCount:function e(){var t=this;jQuery('.totalNumberOfRecords').on('click',function(a){var e=jQuery(a.currentTarget),i=jQuery('#totalCount'),n=i.val();e.addClass('d-none'),e.parent().progressIndicator({}),''==n?t.getPageCount().done(function(e){n=e.result.numberOfRecords,i.val(n),t.showPagingInfo();}):t.showPagingInfo(),e.parent().progressIndicator({mode:'hide'});});},showPagingInfo:function n(){var e=jQuery('#totalCount').val(),t=jQuery('.pageNumbersText'),a=t.text(),i=parseInt(jQuery('#noOfEntries').val());0==i?jQuery('.pageNumbersText').html(''):jQuery('.pageNumbersText').html(a+' ('+e+')');},registerUnreviewedCountEvent:function r(){var t=[],a=this.getListViewContentContainer(),i=a.find('.unreviewed').length;if(a.find('tr.listViewEntries').each(function(){var e=jQuery(this).data('id');e&&t.push(e);}),!(1>i)){var n={action:'ChangesReviewedOn',mode:'getUnreviewed',module:'ModTracker',sourceModule:app.getModuleName(),recordsId:t};AppConnector.request(n).done(function(e){var t=e.result;$.each(t,function(e,t){0<t.a&&a.find('tr[data-id="'+e+'"] .unreviewed .badge.all').text(t.a).parent().removeClass('d-none'),0<t.m&&a.find('tr[data-id="'+e+'"] .unreviewed .badge.mail').text(t.m).parent().removeClass('d-none');}),Vtiger_Helper_Js.showHorizontalTopScrollBar();});}},registerLastRelationsEvent:function r(){var t=[],a=this.getListViewContentContainer(),i=a.find('.timeLineIconList').length;if(a.find('tr.listViewEntries').each(function(){var e=jQuery(this).data('id');e&&t.push(e);}),!(1>i)){var n={action:'LastRelation',module:'ModTracker',sourceModule:app.getModuleName(),recordsId:t};AppConnector.request(n).done(function(e){var t=e.result;$.each(t,function(e,t){t.type&&a.find('tr[data-id="'+e+'"] .timeLineIconList').addClass(t.color+' userIcon-'+t.type).parent().removeClass('d-none').on('click',function(t){var e=jQuery(t.currentTarget),a=e.data('url');app.showModalWindow(null,a,function(e){Vtiger_Index_Js.registerMailButtons(e);});});}),Vtiger_Helper_Js.showHorizontalTopScrollBar();});}},registerChangeEntityStateEvent:function t(){var e=this;$('.dropdownEntityState a').on('click',function(){var t=$(this);t.closest('ul').find('a').removeClass('active'),t.addClass('active'),$('#entityState').val(t.data('value')),app.setMainParams('pageNumber','1'),app.setMainParams('pageToJump','1'),$('#recordsCount').val(''),$('#totalPageCount').text(''),$('.pagination').data('totalCount',0),$('#dropdownEntityState').find('[data-fa-i2svg]').attr('class',t.find('[data-fa-i2svg]').attr('class')),e.getListViewRecords().done(function(){e.calculatePages().done(function(){e.updatePagination();});});});},registerSummationEvent:function t(){var e=this;this.getListViewContentContainer().on('click','.listViewSummation button',function(){var t=$(this),a=t.closest('td').find('.calculateValue'),i=e.getDefaultParams(),n=$.progressIndicator({message:app.vtranslate('JS_CALCULATING_IN_PROGRESS'),position:'html',blockInfo:{enabled:!0}});i.action='List',i.mode='calculate',i.fieldName=t.data('field'),i.calculateType=t.data('operator'),!0!=e.checkListRecordSelected()&&(i.selected_ids=e.readSelectedIds(!0),i.excluded_ids=e.readExcludedIds(!0)),delete i.view,app.hidePopover(t),AppConnector.request(i).done(function(e){e.success?a.html(e.result):a.html(''),n.progressIndicator({mode:'hide'});});});},registerListScroll:function t(e){if('ListPreview'!==CONFIG.view){var a=e.height(),i=e.offset().top,n=$('.js-footer').height(),r=$(window).height();$(window).width()>app.breakpoints.sm&&(a+i+n>r&&e.height(r-(i+n)),app.showNewScrollbarTopBottomRight(e));}},registerMassActionsBtnMergeEvents:function e(){var t=this;this.getListViewContainer().on('click','.js-mass-action--merge',function(a){var e=$(a.target).data('url');'undefined'!=typeof e&&(!0===t.checkListRecordSelected(2)?t.noRecordSelectedAlert('JS_SELECT_ATLEAST_TWO_RECORD_FOR_MERGING'):Vtiger_List_Js.triggerMassAction(e));});},registerEvents:function t(){this.breadCrumbsFilter(),this.registerRowClickEvent(),this.registerPageNavigationEvents(),this.registerMainCheckBoxClickEvent(),this.registerCheckBoxClickEvent(),this.registerSelectAllClickEvent(),this.registerDeselectAllClickEvent(),this.registerRecordEvents(),this.registerMassRecordsEvents(),this.registerMassActionsBtnMergeEvents(),this.registerHeadersClickEvent(),this.registerMassActionSubmitEvent(),this.changeCustomFilterElementView(),this.registerChangeCustomFilterEventListeners(),this.registerChangeEntityStateEvent(),this.registerDuplicateFilterClickEvent(),this.registerEditFilterClickEvent(),this.registerDeleteFilterClickEvent(),this.registerApproveFilterClickEvent(),this.registerDenyFilterClickEvent(),this.registerCustomFilterOptionsHoverEvent(),this.registerEmailFieldClickEvent(),this.registerPhoneFieldClickEvent(),Vtiger_Helper_Js.showHorizontalTopScrollBar(),this.registerUrlFieldClickEvent(),this.registerEventForTotalRecordsCount(),this.registerSummationEvent();var e=this.getListViewContentContainer();e.find('#listViewEntriesMainCheckBox,.listViewEntriesCheckBox').prop('checked',!1),this.registerListScroll(e),this.getListSearchInstance(!1),this.registerListViewSpecialOption(),this.registerUnreviewedCountEvent(),this.registerLastRelationsEvent(),app.showPopoverElementView(e.find('.js-popover-tooltip')),Vtiger_Index_Js.registerMailButtons(e);},registerListViewSpecialOption:function i(){var t=this,e=this.getListViewContentContainer(),a=e.find('.listViewEntriesTable input.searchInSubcategories');a.on('change',function(a){var e=jQuery(a.currentTarget),i=jQuery('.listSearchContributor[name="'+e.data('columnname')+'"]'),n=i.val();n&&t.getListSearchInstance().triggerListSearch();});},postMassDeleteRecords:function a(){var e=jQuery.Deferred(),t=Vtiger_List_Js.getInstance();app.hideModalWindow();app.getModuleName();return t.getListViewRecords().done(function(){jQuery('#recordsCount').val(''),jQuery('#totalPageCount').text(''),jQuery('#deSelectAllMsg').trigger('click'),t.calculatePages().done(function(){t.updatePagination();}),e.resolve();}),jQuery('#recordsCount').val(''),e.promise()}});
//# sourceMappingURL=List.min.js.map
