'use strict';

Vtiger_AdvanceFilter_Js('Vtiger_AdvanceFilterEx_Js',{},{validationSupportedFieldConditionMap:{email:['e','n'],date:['is'],datetime:['is']},allConditionValidationNeededFieldList:['double','integer'],comparatorsWithNoValueBoxMap:['has changed','is empty','is not empty','is added'],init:function b(a){'undefined'==typeof a&&(a=jQuery('#advanceFilterContainer')),a.is('#advanceFilterContainer')?this.setFilterContainer(a):this.setFilterContainer(jQuery('#advanceFilterContainer',a)),this.initialize();},getFieldSpecificType:function d(a){var b=a.data('fieldinfo'),c=b.type;return c},getModuleName:function a(){return 'AdvanceFilterEx'},addNewCondition:function e(a){var b=jQuery('.basic',a),c=b.find('.js-conditions-row').clone(!0,!0);jQuery('select',c).addClass('select2');var d=jQuery('.conditionList',a);return d.append(c),App.Fields.Picklist.changeSelectElementView(c),c.find('[name="columnname"]').find('optgroup:first option:first').attr('selected','selected').trigger('change'),this},loadConditions:function n(a){var b=a.closest('div.js-conditions-row'),c=b.find('select[name="comparator"]'),d=c.val(),e=a.find('option:selected'),f=e.val(),g=f.match(/\((\w+)\) (\w+)/),h=this.getFieldSpecificType(e),i=this.getConditionListFromType(h);'undefined'==typeof i&&(i={},i.none='None');var j='';for(var k in i)if(i.hasOwnProperty(k)){var l=i[k],m=this.getConditionLabel(l);null==g?(j+='<option value="'+l+'"',l==d&&(j+=' selected="selected" '),j+='>'+m+'</option>'):'has changed'!=l&&(j+='<option value="'+l+'"',l==d&&(j+=' selected="selected" '),j+='>'+m+'</option>');}return c.empty().html(j).trigger('change'),c},getValues:function g(){var a=this,b=this.getFilterContainer(),c=['columnname','comparator','value','valuetype','column_condition'],d={},e=0,f=$('.conditionGroup',b);return f.each(function(b,g){var h=$(g),i=$('.conditionList .js-conditions-row',h),j={};return !!(0>=i.length)||void(i.each(function(d,f){var g=$(f),h=$('[name="columnname"]',g),k=$('[data-value="value"]',g);if(a.isEmptyFieldSelected(h))return !0;var l,m,n=h.find('option:selected').data('fieldinfo').type,o={};if(-1<$.inArray(n,['picklist','multipicklist','multiReferenceValue'])){for(l in c)if(m=c[l],'value'===m&&k.is('input')){var p=k.data('picklistvalues'),q=k.val().split(','),r=[];for(d=0;d<q.length;d++)'undefined'==typeof p[q[d]]?r.push(q[d]):r.push(p[q[d]]);o[m]=r.join(',');}else if('value'===m&&k.is('select')&&'picklist'===n)o[m]=k.val();else if('value'===m&&k.is('select')&&-1<$.inArray(n,['multipicklist','multiReferenceValue'])){var s=k.val();o[m]=null==s?s:s.join(',');}else o[m]=$('[name="'+m+'"]',g).val();}else for(l in c)m=c[l],o[m]='value'===m?k.val():$('[name="'+m+'"]',g).val();('false'===$('[name="valuetype"]',g).val()||0===$('[name="valuetype"]',g).length)&&(o.valuetype='rawtext'),o.groupid='0'===b?'0':'1',g.is(':last-child')&&(o.column_condition=''),j[e]=o,e++;}),!$.isEmptyObject(j)&&(d[b+1]={},d[b+1].columns=j),0<h.find('div.groupCondition').length&&!$.isEmptyObject(d[b+1])&&(d[b+1].condition=f.find('div.groupCondition [name="condition"]').val()))}),d},getFieldSpecificUi:function d(a){var b=a.find('option:selected'),c=b.data('fieldinfo');return -1==jQuery.inArray(c.comparatorElementVal,this.comparatorsWithNoValueBoxMap)?this._super(a):jQuery('')},getPopUp:function c(a){var b=this;'undefined'==typeof a&&(a=b.getFilterContainer()),a.on('click','.getPopupUi',function(a){var c=jQuery(a.currentTarget),d=c.val(),e=c.closest('.fieldUiHolder'),f=e.find('[name="valuetype"]').val(),g=c.closest('.js-conditions-container'),h=g.find('.popupUi').clone(!0,!0).removeClass('popupUi').addClass('clonedPopupUi'),i='';if(h.find('select').addClass('select2'),h.find('.fieldValue').val(d),''===f&&(f='rawtext'),c.hasClass('date')){h.find('.textType').find('option[value="rawtext"]').attr('data-ui','input');var k=c.data('date-format');'rawtext'===f&&(i=c.val()),h.find('.fieldValueContainer').prepend('<input type="text" class="dateField fieldValue col-md-4" value="'+i+'" data-date-format="'+k+'" data-input="true" >');}else c.hasClass('time')?(h.find('.textType').find('option[value="rawtext"]').attr('data-ui','input'),'rawtext'===f&&(i=c.val()),h.find('.fieldValueContainer').prepend('<input type="text" class="clockPicker fieldValue col-md-4 form-control" value="'+i+'" data-input="true" >')):c.hasClass('boolean')&&(h.find('.textType').find('option[value="rawtext"]').attr('data-ui','input'),'rawtext'===f&&(i=c.val()),h.find('.fieldValueContainer').prepend('<input type="checkbox" class="fieldValue col-md-4" value="'+i+'" data-input="true" >'),'true:boolean'==i||''===i?h.find('.fieldValueContainer input').attr('checked','checked'):h.find('.fieldValueContainer input').removeAttr('checked'));var j=function(a){a.find('.clonedPopupUi').removeClass('d-none');var d=c.closest('.js-conditions-row').find('[name="modulename"]');if(0<d.length){var g=d.val();a.find('.useFieldElement').addClass('d-none'),a.find('[name="'+g+'"]').removeClass('d-none');}App.Fields.Picklist.changeSelectElementView(a),App.Fields.Date.register(a),app.registerEventForClockPicker(a),b.postShowModalAction(a,f),b.registerChangeFieldEvent(a),b.registerSelectOptionEvent(a),b.registerPopUpSaveEvent(a,e),b.registerRemoveModalEvent(a),a.find('.fieldValue').filter(':visible').trigger('focus'),a.find('[data-close-modal="modal"]').off('click').on('click',function(){$(this).closest('.modal').removeClass('in').css('display','none');});};g.find('.clonedPopUp').html(h),$('.clonedPopupUi').on('shown.bs.modal',function(){'function'==typeof j&&j($('.clonedPopupUi',g));}),$('.clonedPopUp',g).find('.clonedPopupUi').modal();});},postShowModalAction:function d(a,b){'fieldname'==b?(jQuery('.useFieldContainer',a).removeClass('d-none'),jQuery('.textType',a).val(b).trigger('change')):'expression'==b&&(jQuery('.useFieldContainer',a).removeClass('d-none'),jQuery('.useFunctionContainer',a).removeClass('d-none'),jQuery('.textType',a).val(b).trigger('change')),jQuery('#'+b+'_help',a).removeClass('d-none');var c=jQuery('.textType',a).find('option:selected').data('ui');jQuery('.fieldValue',a).hide(),jQuery('[data-'+c+']',a).show();},registerChangeFieldEvent:function b(a){jQuery('.textType',a).on('change',function(b){var c=jQuery(b.currentTarget).val(),d=jQuery('.useFieldContainer',a),e=jQuery('.useFunctionContainer',a),f=jQuery(b.currentTarget).find('option:selected').data('ui');jQuery('.fieldValue',a).hide(),jQuery('[data-'+f+']',a).show(),'fieldname'==c?(d.removeClass('d-none'),e.addClass('d-none')):'expression'==c?(d.removeClass('d-none'),e.removeClass('d-none')):(d.addClass('d-none'),e.addClass('d-none')),jQuery('.helpmessagebox',a).addClass('d-none'),jQuery('#'+c+'_help',a).removeClass('d-none'),a.find('.fieldValue').val('');});},registerSelectOptionEvent:function b(a){jQuery('.useField,.useFunction',a).on('change',function(b){var c=jQuery(b.currentTarget),d=c.val(),e=a.find('.fieldValue').filter(':visible').val();if(!c.hasClass('useField'))f=e+d;else if(''!=e)var f=e+' '+d;else f=d;a.find('.fieldValue').val(f),c.val('').trigger('change');});},registerPopUpSaveEvent:function c(a,b){jQuery('[name="saveButton"]',a).on('click',function(){var c=jQuery('.textType',a).val();b.find('[name="valuetype"]').val(c);var d=b.find('.getPopupUi');'rawtext'==c?(d.addClass('validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]'),d.attr('data-validation-engine','validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]')):(d.removeAttr('data-validation-engine'),d.removeClass('validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]'));var e=a.find('.fieldValue').filter(':visible').attr('type'),f=a.find('.fieldValue').filter(':visible').val();'checkbox'==e&&(a.find('.fieldValue').filter(':visible').is(':checked')?f='true:boolean':f='false:boolean'),d.val(f),a.modal('hide'),d.validationEngine('hide');});},registerRemoveModalEvent:function b(a){a.on('click','.closeModal',function(){a.modal('hide');});},registerEvents:function a(){this._super(),this.getPopUp();}}),Vtiger_Field_Js('AdvanceFilterEx_Field_Js',{},{getUiTypeSpecificHtml:function b(){var a=this.getUiTypeModel();return a.getUi()},getModuleName:function b(){var a=app.getModuleName();return a},getUi:function b(){var a='<input type="text" class="getPopupUi form-control" name="'+this.getName()+'"  /><input type="hidden" name="valuetype" value="'+this.get('workflow_valuetype')+'" />';return a=jQuery(a),a.filter('.getPopupUi').val(app.htmlDecode(this.getValue())),this.addValidationToElement(a)}}),Vtiger_Date_Field_Js('AdvanceFilterEx_Date_Field_Js',{},{getDateFormat:function a(){return this.get('date-format')},getUi:function e(){var a,b,c=this.get('comparatorElementVal'),d=this.get('dateSpecificConditions');if(0<c.length){if('between'===c||'custom'===c)return a='<div class="date"><input class="dateRangeField" data-calendar-type="range" name="'+this.getName()+'" data-date-format="'+this.getDateFormat()+'" type="text" ReadOnly="true" value="'+this.getValue()+'"></div>',b=$(a),this.addValidationToElement(b);if(this._specialDateComparator(c))return a='<input name="'+this.getName()+'" type="text" value="'+this.getValue()+'" data-validation-engine="validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]" data-validator="[{"name":"PositiveNumber"}]">\n\t\t\t\t\t\t\t<input type="hidden" name="valuetype" value="'+this.get('workflow_valuetype')+'" />',$(a);if(c in d){var f=d[c].startdate,g=d[c].enddate;return a='<input name="'+this.getName()+'"  type="text" ReadOnly="true" value="'+f+','+g+'">',$(a)}if('is today'===c);else return this._super()}else return a='<input type="text" class="getPopupUi date form-control" name="'+this.getName()+'"  data-date-format="'+this.getDateFormat()+'"  value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get('workflow_valuetype')+'" />',b=$(a),this.addValidationToElement(b)},_specialDateComparator:function d(a){var b,c=['less than days ago','more than days ago','in less than','in more than','days ago','days later'];for(b in c)if(a==c[b])return !0;return !1}}),Vtiger_Date_Field_Js('AdvanceFilterEx_Datetime_Field_Js',{},{getDateFormat:function a(){return this.get('date-format')},getUi:function d(){var a,b,c=this.get('comparatorElementVal');return this._specialDateTimeComparator(c)?(a='<input name="'+this.getName()+'" type="text" value="'+this.getValue()+'" data-validator="[{name:PositiveNumber}]"><input type="hidden" name="valuetype" value="'+this.get('workflow_valuetype')+'" />',b=jQuery(a)):(a='<input type="text" class="getPopupUi date form-control" name="'+this.getName()+'"  data-date-format="'+this.getDateFormat()+'"  value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get('workflow_valuetype')+'" />',b=jQuery(a)),b},_specialDateTimeComparator:function d(a){var b,c=['less than hours before','less than hours later','more than hours later','more than hours before'];for(b in c)if(a==c[b])return !0;return !1}}),Vtiger_Currency_Field_Js('AdvanceFilterEx_Currency_Field_Js',{},{getUi:function c(){var a='<input type="text" class="getPopupUi marginLeftZero form-control" name="'+this.getName()+'" value="'+this.getValue()+'"  /><input type="hidden" name="valuetype" value="'+this.get('workflow_valuetype')+'" />',b=jQuery(a);return this.addValidationToElement(b)}}),Vtiger_Time_Field_Js('AdvanceFilterEx_Time_Field_Js',{},{getUi:function c(){var a='<input type="text" class="getPopupUi time form-control" name="'+this.getName()+'"  value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get('workflow_valuetype')+'" />',b=jQuery(a);return this.addValidationToElement(b)}}),Vtiger_Field_Js('Vtiger_Percentage_Field_Js',{},{getUi:function c(){var a='<input type="text" class="getPopupUi form-control" name="'+this.getName()+'" value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get('workflow_valuetype')+'" />',b=jQuery(a);return this.addValidationToElement(b)}}),Vtiger_Field_Js('Vtiger_Text_Field_Js',{},{getUi:function c(){var a='<input type="text" class="getPopupUi form-control" name="'+this.getName()+'" value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get('workflow_valuetype')+'" />',b=jQuery(a);return this.addValidationToElement(b)}}),Vtiger_Field_Js('Vtiger_Boolean_Field_Js',{},{getUi:function c(){var a='<input type="text" class="getPopupUi form-control boolean" name="'+this.getName()+'" value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get('workflow_valuetype')+'" />',b=jQuery(a);return this.addValidationToElement(b)}}),Vtiger_Owner_Field_Js('AdvanceFilterEx_Owner_Field_Js',{},{getUi:function h(){var a='<select class="select2" name="'+this.getName()+'">',b=this.getPickListValues(),c=this.getValue();for(var d in b){a+='<optgroup label="'+d+'">';var e=b[d];for(var f in e)a+='<option value="'+f+'" ',f==c&&(a+=' selected '),a+='>'+e[f]+'</option>';a+='</optgroup>';}a+='</select>';var g=jQuery(a);return this.addValidationToElement(g),g}}),Vtiger_Picklist_Field_Js('AdvanceFilterEx_Picklist_Field_Js',{},{});
//# sourceMappingURL=AdvanceFilterEx.min.js.map
