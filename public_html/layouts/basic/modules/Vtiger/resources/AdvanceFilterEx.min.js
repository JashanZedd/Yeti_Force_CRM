"use strict";Vtiger_AdvanceFilter_Js("Vtiger_AdvanceFilterEx_Js",{},{validationSupportedFieldConditionMap:{email:["e","n"],date:["is"],datetime:["is"]},allConditionValidationNeededFieldList:["double","integer"],comparatorsWithNoValueBoxMap:["has changed","is empty","is not empty","is added"],init:function(container){void 0===container&&(container=jQuery("#advanceFilterContainer")),container.is("#advanceFilterContainer")?this.setFilterContainer(container):this.setFilterContainer(jQuery("#advanceFilterContainer",container)),this.initialize()},getFieldSpecificType:function(fieldSelected){return fieldSelected.data("fieldinfo").type},getModuleName:function(){return"AdvanceFilterEx"},addNewCondition:function(conditionGroupElement){var newRowElement=jQuery(".basic",conditionGroupElement).find(".js-conditions-row").clone(!0,!0);return jQuery("select",newRowElement).addClass("select2"),jQuery(".conditionList",conditionGroupElement).append(newRowElement),App.Fields.Picklist.changeSelectElementView(newRowElement),newRowElement.find('[name="columnname"]').find("optgroup:first option:first").attr("selected","selected").trigger("change"),this},loadConditions:function(fieldSelect){var conditionSelectElement=fieldSelect.closest("div.js-conditions-row").find('select[name="comparator"]'),conditionSelected=conditionSelectElement.val(),fieldSelected=fieldSelect.find("option:selected"),match=fieldSelected.val().match(/\((\w+)\) (\w+)/),fieldSpecificType=this.getFieldSpecificType(fieldSelected),conditionList=this.getConditionListFromType(fieldSpecificType);void 0===conditionList&&((conditionList={}).none="None");var options="";for(var key in conditionList)if(conditionList.hasOwnProperty(key)){var conditionValue=conditionList[key],conditionLabel=this.getConditionLabel(conditionValue);null!=match?"has changed"!=conditionValue&&(options+='<option value="'+conditionValue+'"',conditionValue==conditionSelected&&(options+=' selected="selected" '),options+=">"+conditionLabel+"</option>"):(options+='<option value="'+conditionValue+'"',conditionValue==conditionSelected&&(options+=' selected="selected" '),options+=">"+conditionLabel+"</option>")}return conditionSelectElement.empty().html(options).trigger("change"),conditionSelectElement},getValues:function(){var thisInstance=this,filterContainer=this.getFilterContainer(),fieldList=["columnname","comparator","value","valuetype","column_condition"],values={},columnIndex=0,conditionGroups=$(".conditionGroup",filterContainer);return conditionGroups.each((function(index,domElement){var groupElement=$(domElement),conditions=$(".conditionList .js-conditions-row",groupElement),iterationValues={};if(conditions.length<=0)return!0;conditions.each((function(i,conditionDomElement){var rowElement=$(conditionDomElement),fieldSelectElement=$('[name="columnname"]',rowElement),valueSelectElement=$('[data-value="value"]',rowElement);if(thisInstance.isEmptyFieldSelected(fieldSelectElement))return!0;var fieldType=fieldSelectElement.find("option:selected").data("fieldinfo").type,rowValues={},key=void 0,field=void 0;if($.inArray(fieldType,["picklist","multipicklist","multiReferenceValue"])>-1)for(key in fieldList)if("value"===(field=fieldList[key])&&valueSelectElement.is("input")){var pickListValues=valueSelectElement.data("picklistvalues"),valuesArr=valueSelectElement.val().split(","),newValuesArr=[];for(i=0;i<valuesArr.length;i++)void 0!==pickListValues[valuesArr[i]]?newValuesArr.push(pickListValues[valuesArr[i]]):newValuesArr.push(valuesArr[i]);rowValues[field]=newValuesArr.join(",")}else if("value"===field&&valueSelectElement.is("select")&&"picklist"===fieldType)rowValues[field]=valueSelectElement.val();else if("value"===field&&valueSelectElement.is("select")&&$.inArray(fieldType,["multipicklist","multiReferenceValue"])>-1){var value=valueSelectElement.val();rowValues[field]=null==value?value:value.join(",")}else rowValues[field]=$('[name="'+field+'"]',rowElement).val();else for(key in fieldList)rowValues[field=fieldList[key]]="value"===field?valueSelectElement.val():$('[name="'+field+'"]',rowElement).val();"false"!==$('[name="valuetype"]',rowElement).val()&&0!==$('[name="valuetype"]',rowElement).length||(rowValues.valuetype="rawtext"),rowValues.groupid=0===index?0:1,rowElement.is(":last-child")&&(rowValues.column_condition=""),iterationValues[columnIndex]=rowValues,columnIndex++})),$.isEmptyObject(iterationValues)||(values[index+1]={},values[index+1].columns=iterationValues),groupElement.find("div.groupCondition").length>0&&!$.isEmptyObject(values[index+1])&&(values[index+1].condition=conditionGroups.find('div.groupCondition [name="condition"]').val())})),values},getFieldSpecificUi:function(fieldSelectElement){var fieldInfo=fieldSelectElement.find("option:selected").data("fieldinfo");return-1!=jQuery.inArray(fieldInfo.comparatorElementVal,this.comparatorsWithNoValueBoxMap)?jQuery(""):this._super(fieldSelectElement)},getPopUp:function(container){var thisInstance=this;void 0===container&&(container=thisInstance.getFilterContainer()),container.on("click",".getPopupUi",(function(e){var fieldValueElement=jQuery(e.currentTarget),fieldValue=fieldValueElement.val(),fieldUiHolder=fieldValueElement.closest(".fieldUiHolder"),valueType=fieldUiHolder.find('[name="valuetype"]').val(),conditionsContainer=fieldValueElement.closest(".js-conditions-container"),clonedPopupUi=conditionsContainer.find(".popupUi").clone(!0,!0).removeClass("popupUi").addClass("clonedPopupUi"),value="";if(clonedPopupUi.find("select").addClass("select2"),clonedPopupUi.find(".fieldValue").val(fieldValue),""===valueType&&(valueType="rawtext"),fieldValueElement.hasClass("date")){clonedPopupUi.find(".textType").find('option[value="rawtext"]').attr("data-ui","input");var dataFormat=fieldValueElement.data("date-format");"rawtext"===valueType&&(value=fieldValueElement.val()),clonedPopupUi.find(".fieldValueContainer").prepend('<input type="text" class="dateField fieldValue col-md-4" value="'+value+'" data-date-format="'+dataFormat+'" data-input="true" >')}else fieldValueElement.hasClass("time")?(clonedPopupUi.find(".textType").find('option[value="rawtext"]').attr("data-ui","input"),"rawtext"===valueType&&(value=fieldValueElement.val()),clonedPopupUi.find(".fieldValueContainer").prepend('<input type="text" class="clockPicker fieldValue col-md-4 form-control" value="'+value+'" data-input="true" >')):fieldValueElement.hasClass("boolean")&&(clonedPopupUi.find(".textType").find('option[value="rawtext"]').attr("data-ui","input"),"rawtext"===valueType&&(value=fieldValueElement.val()),clonedPopupUi.find(".fieldValueContainer").prepend('<input type="checkbox" class="fieldValue col-md-4" value="'+value+'" data-input="true" >'),"true:boolean"==value||""===value?clonedPopupUi.find(".fieldValueContainer input").attr("checked","checked"):clonedPopupUi.find(".fieldValueContainer input").removeAttr("checked"));var callBackFunction=function(data){data.find(".clonedPopupUi").removeClass("d-none");var moduleNameElement=fieldValueElement.closest(".js-conditions-row").find('[name="modulename"]');if(moduleNameElement.length>0){var moduleName=moduleNameElement.val();data.find(".useFieldElement").addClass("d-none"),data.find('[name="'+moduleName+'"]').removeClass("d-none")}App.Fields.Picklist.changeSelectElementView(data),App.Fields.Date.register(data),app.registerEventForClockPicker(data),thisInstance.postShowModalAction(data,valueType),thisInstance.registerChangeFieldEvent(data),thisInstance.registerSelectOptionEvent(data),thisInstance.registerPopUpSaveEvent(data,fieldUiHolder),thisInstance.registerRemoveModalEvent(data),data.find(".fieldValue").filter(":visible").trigger("focus"),data.find('[data-close-modal="modal"]').off("click").on("click",(function(){$(this).closest(".modal").removeClass("in").css("display","none")}))};conditionsContainer.find(".clonedPopUp").html(clonedPopupUi),$(".clonedPopupUi").on("shown.bs.modal",(function(){callBackFunction($(".clonedPopupUi",conditionsContainer))})),$(".clonedPopUp",conditionsContainer).find(".clonedPopupUi").modal()}))},postShowModalAction:function(data,valueType){"fieldname"==valueType?(jQuery(".useFieldContainer",data).removeClass("d-none"),jQuery(".textType",data).val(valueType).trigger("change")):"expression"==valueType&&(jQuery(".useFieldContainer",data).removeClass("d-none"),jQuery(".useFunctionContainer",data).removeClass("d-none"),jQuery(".textType",data).val(valueType).trigger("change")),jQuery("#"+valueType+"_help",data).removeClass("d-none");var uiType=jQuery(".textType",data).find("option:selected").data("ui");jQuery(".fieldValue",data).hide(),jQuery("[data-"+uiType+"]",data).show()},registerChangeFieldEvent:function(data){jQuery(".textType",data).on("change",(function(e){var valueType=jQuery(e.currentTarget).val(),useFieldContainer=jQuery(".useFieldContainer",data),useFunctionContainer=jQuery(".useFunctionContainer",data),uiType=jQuery(e.currentTarget).find("option:selected").data("ui");jQuery(".fieldValue",data).hide(),jQuery("[data-"+uiType+"]",data).show(),"fieldname"==valueType?(useFieldContainer.removeClass("d-none"),useFunctionContainer.addClass("d-none")):"expression"==valueType?(useFieldContainer.removeClass("d-none"),useFunctionContainer.removeClass("d-none")):(useFieldContainer.addClass("d-none"),useFunctionContainer.addClass("d-none")),jQuery(".helpmessagebox",data).addClass("d-none"),jQuery("#"+valueType+"_help",data).removeClass("d-none"),data.find(".fieldValue").val("")}))},registerSelectOptionEvent:function(data){$(".useField,.useFunction",data).on("change",(function(e){var currentElement=jQuery(e.currentTarget),newValue=currentElement.val(),oldValue=data.find(".fieldValue").filter(":visible").val();if(currentElement.hasClass("useField"))if(""!=oldValue)var concatenatedValue=oldValue+" "+newValue;else concatenatedValue=newValue;else concatenatedValue=oldValue+newValue;data.find(".fieldValue").val(concatenatedValue),currentElement.val("").trigger("change.select2")}))},registerPopUpSaveEvent:function(data,fieldUiHolder){jQuery('[name="saveButton"]',data).on("click",(function(e){var valueType=jQuery(".textType",data).val();fieldUiHolder.find('[name="valuetype"]').val(valueType);var fieldValueElement=fieldUiHolder.find(".getPopupUi");"rawtext"!=valueType?(fieldValueElement.removeAttr("data-validation-engine"),fieldValueElement.removeClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]")):(fieldValueElement.addClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]"),fieldValueElement.attr("data-validation-engine","validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]"));var fieldType=data.find(".fieldValue").filter(":visible").attr("type"),fieldValue=data.find(".fieldValue").filter(":visible").val();"checkbox"==fieldType&&(fieldValue=data.find(".fieldValue").filter(":visible").is(":checked")?"true:boolean":"false:boolean"),fieldValueElement.val(fieldValue),data.modal("hide"),fieldValueElement.validationEngine("hide")}))},registerRemoveModalEvent:function(data){data.on("click",".closeModal",(function(e){data.modal("hide")}))},registerEvents:function(){this._super(),this.getPopUp()}}),Vtiger_Field_Js("AdvanceFilterEx_Field_Js",{},{getUiTypeSpecificHtml:function(){return this.getUiTypeModel().getUi()},getModuleName:function(){return app.getModuleName()},getUi:function(){var html='<input type="text" class="getPopupUi form-control" name="'+this.getName()+'"  /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />';return(html=jQuery(html)).filter(".getPopupUi").val(app.htmlDecode(this.getValue())),this.addValidationToElement(html)}}),Vtiger_Date_Field_Js("AdvanceFilterEx_Date_Field_Js",{},{getDateFormat:function(){return this.get("date-format")},getUi:function(){var comparatorSelectedOptionVal=this.get("comparatorElementVal"),dateSpecificConditions=this.get("dateSpecificConditions"),html=void 0,element=void 0;if(!(comparatorSelectedOptionVal.length>0))return html='<input type="text" class="getPopupUi date form-control" name="'+this.getName()+'"  data-date-format="'+this.getDateFormat()+'"  value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />',element=$(html),this.addValidationToElement(element);if("between"===comparatorSelectedOptionVal||"custom"===comparatorSelectedOptionVal)return html='<div class="date"><input class="dateRangeField form-control" data-calendar-type="range" name="'+this.getName()+'" data-date-format="'+this.getDateFormat()+'" type="text" ReadOnly="true" value="'+this.getValue()+'"></div>',element=$(html),this.addValidationToElement(element);if(this._specialDateComparator(comparatorSelectedOptionVal))return html='<input name="'+this.getName()+'" type="text" value="'+this.getValue()+'" data-validation-engine="validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]" data-validator="[{"name":"PositiveNumber"}]"><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />',jQuery(html);if(comparatorSelectedOptionVal in dateSpecificConditions){var startValue=dateSpecificConditions[comparatorSelectedOptionVal].startdate,endValue=dateSpecificConditions[comparatorSelectedOptionVal].enddate;return html='<input name="'+this.getName()+'"  type="text" ReadOnly="true" value="'+startValue+","+endValue+'">',$(html)}return"is today"!==comparatorSelectedOptionVal?this._super():void 0},_specialDateComparator:function(comp){var specialComparators=["less than days ago","more than days ago","in less than","in more than","days ago","days later"],index=void 0;for(index in specialComparators)if(comp==specialComparators[index])return!0;return!1}}),Vtiger_Date_Field_Js("AdvanceFilterEx_Datetime_Field_Js",{},{getDateFormat:function(){return this.get("date-format")},getUi:function(){var comparatorSelectedOptionVal=this.get("comparatorElementVal"),html=void 0,element=void 0;return this._specialDateTimeComparator(comparatorSelectedOptionVal)?(html='<input name="'+this.getName()+'" type="text" value="'+this.getValue()+'" data-validator="[{name:PositiveNumber}]"><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />',element=jQuery(html)):(html='<input type="text" class="getPopupUi date form-control" name="'+this.getName()+'"  data-date-format="'+this.getDateFormat()+'"  value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />',element=jQuery(html)),element},_specialDateTimeComparator:function(comp){var specialComparators=["less than hours before","less than hours later","more than hours later","more than hours before"],index=void 0;for(index in specialComparators)if(comp==specialComparators[index])return!0;return!1}}),Vtiger_Currency_Field_Js("AdvanceFilterEx_Currency_Field_Js",{},{getUi:function(){var html='<input type="text" class="getPopupUi marginLeftZero form-control" name="'+this.getName()+'" value="'+this.getValue()+'"  /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />',element=jQuery(html);return this.addValidationToElement(element)}}),Vtiger_Time_Field_Js("AdvanceFilterEx_Time_Field_Js",{},{getUi:function(){var html='<input type="text" class="getPopupUi time form-control" name="'+this.getName()+'"  value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />',element=jQuery(html);return this.addValidationToElement(element)}}),Vtiger_Field_Js("Vtiger_Percentage_Field_Js",{},{getUi:function(){var html='<input type="text" class="getPopupUi form-control" name="'+this.getName()+'" value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />',element=jQuery(html);return this.addValidationToElement(element)}}),Vtiger_Field_Js("Vtiger_Text_Field_Js",{},{getUi:function(){var html='<input type="text" class="getPopupUi form-control" name="'+this.getName()+'" value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />',element=jQuery(html);return this.addValidationToElement(element)}}),Vtiger_Field_Js("Vtiger_Boolean_Field_Js",{},{getUi:function(){var html='<input type="text" class="getPopupUi form-control boolean" name="'+this.getName()+'" value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />',element=jQuery(html);return this.addValidationToElement(element)}}),Vtiger_Owner_Field_Js("AdvanceFilterEx_Owner_Field_Js",{},{getUi:function(){var html='<select class="select2" name="'+this.getName()+'">',pickListValues=this.getPickListValues(),selectedOption=this.getValue();for(var optGroup in pickListValues){html+='<optgroup label="'+optGroup+'">';var optionGroupValues=pickListValues[optGroup];for(var option in optionGroupValues)html+='<option value="'+option+'" ',option==selectedOption&&(html+=" selected "),html+=">"+optionGroupValues[option]+"</option>";html+="</optgroup>"}html+="</select>";var selectContainer=jQuery(html);return this.addValidationToElement(selectContainer),selectContainer}}),Vtiger_Picklist_Field_Js("AdvanceFilterEx_Picklist_Field_Js",{},{});
//# sourceMappingURL=AdvanceFilterEx.min.js.map
