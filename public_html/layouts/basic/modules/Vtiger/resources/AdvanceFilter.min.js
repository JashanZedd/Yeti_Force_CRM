"use strict";jQuery.Class("Vtiger_AdvanceFilter_Js",{getInstance:function(container){var module=app.getModuleName(),moduleClassName1=module+"_AdvanceFilterEx_Js",moduleClassName2=module+"_AdvanceFilter_Js";return void 0!==window[moduleClassName1]?new window[moduleClassName1](container):void 0!==window[moduleClassName2]?new window[moduleClassName2](container):void 0!==window.Vtiger_AdvanceFilterEx_Js?new window.Vtiger_AdvanceFilterEx_Js(container):new window.Vtiger_AdvanceFilter_Js(container)}},{filterContainer:!1,fieldTypeConditionMapping:!1,conditonOperatorLabelMapping:!1,dateConditionInfo:!1,fieldModelInstance:!1,validationSupportedFieldConditionMap:{email:["e","n"]},allConditionValidationNeededFieldList:["double","integer","currency"],validationForControlsRegistered:!1,init:function(container){void 0===container&&(container=jQuery(".filterContainer")),container.is(".filterContainer")?this.setFilterContainer(container):this.setFilterContainer(jQuery(".filterContainer",container)),this.initialize()},getModuleName:function(){return"AdvanceFilter"},initialize:function(){this.registerEvents(),this.initializeOperationMappingDetails(),this.loadFieldSpecificUiForAll()},initializeOperationMappingDetails:function(){var filterContainer=this.getFilterContainer();return this.fieldTypeConditionMapping=jQuery('input[name="advanceFilterOpsByFieldType"]',filterContainer).data("value"),this.conditonOperatorLabelMapping=jQuery('input[name="advanceFilterOptions"]',filterContainer).data("value"),this.dateConditionInfo=jQuery('[name="date_filters"]').data("value"),this},getFilterContainer:function(){return this.filterContainer},setFilterContainer:function(element){return this.filterContainer=element,this},getDateSpecificConditionInfo:function(){return this.dateConditionInfo},getConditionListFromType:function(fieldType){var fieldTypeConditions=this.fieldTypeConditionMapping[fieldType];return"D"!=fieldType&&"DT"!=fieldType||(fieldTypeConditions=fieldTypeConditions.concat(this.getDateConditions(fieldType))),fieldTypeConditions},getDateConditions:function(fieldType){if("D"!=fieldType&&"DT"!=fieldType)return[];var dateFilters=this.getDateSpecificConditionInfo();return Object.keys(dateFilters)},getConditionLabel:function(key){return key in this.conditonOperatorLabelMapping?this.conditonOperatorLabelMapping[key]:key in this.getDateSpecificConditionInfo()?this.getDateSpecificConditionInfo()[key].label:key},isEmptyFieldSelected:function(fieldSelect){return"none"==fieldSelect.find("option:selected").val()},getAddConditionElement:function(){var filterContainer=this.getFilterContainer();return jQuery(".addCondition button",filterContainer)},addNewCondition:function(conditionGroupElement){var newRowElement=$(".basic",conditionGroupElement).find(".js-conditions-row").clone(!0,!0),selectElement=newRowElement.find("select").addClass("select2");return $(".conditionList",conditionGroupElement).append(newRowElement),App.Fields.Picklist.showSelect2ElementView(selectElement,{dropdownParent:conditionGroupElement}),this},addConditionHandler:function(e){var conditionGroup=jQuery(e.currentTarget).closest("div.conditionGroup");this.addNewCondition(conditionGroup)},getFieldSpecificType:function(fieldSelected){return"reference"==fieldSelected.data("fieldinfo").type?"V":fieldSelected.data("fieldtype")},loadConditions:function(fieldSelect){var row=fieldSelect.closest("div.js-conditions-row"),conditionSelectElement=row.find('select[name="comparator"]'),group=row.find('[name="column_condition"]'),conditionSelected=conditionSelectElement.val(),fieldSelected=fieldSelect.find("option:selected"),fieldSpecificType=this.getFieldSpecificType(fieldSelected),conditionList=this.getConditionListFromType(fieldSpecificType),fieldInfo=fieldSelected.data("fieldinfo");void 0===conditionList&&((conditionList={}).none="None");var options="";for(var key in conditionList)if((-1==jQuery.inArray(fieldInfo.type,["rangeTime","image"])||-1!=jQuery.inArray(conditionList[key],["y","ny"]))&&(-1==jQuery.inArray(fieldInfo.type,["userCreator","owner","picklist","modules","tree","inventoryLimit","languages","currencyList","fileLocationType"])||-1==jQuery.inArray(conditionList[key],["s","ew","c","k"]))&&("om"!==conditionList[key]||-1!=jQuery.inArray(fieldInfo.type,["owner","sharedOwner","userCreator"]))&&(-1==jQuery.inArray(conditionList[key],["wr","nwr"])||-1!=jQuery.inArray(fieldInfo.type,["owner"]))&&(-1==jQuery.inArray(conditionList[key],["s","ew"])||-1==jQuery.inArray(fieldInfo.type,["taxes","multipicklist","categoryMultipicklist","sharedOwner"]))&&(-1==jQuery.inArray(conditionList[key],["bw","m","h"])||-1==jQuery.inArray(fieldInfo.type,["time"]))&&("d"!==conditionList[key]||"and"===group.val())&&conditionList.hasOwnProperty(key)){var conditionValue=conditionList[key];options+='<option value="'+conditionValue+'"',conditionValue==conditionSelected&&(options+=' selected="selected" '),options+=">"+this.getConditionLabel(conditionValue)+"</option>"}return conditionSelectElement.empty().html(options).trigger("change"),conditionSelectElement},getFieldSpecificUi:function(fieldSelectElement){var fieldModel=this.fieldModelInstance,html=void 0;if("d"===fieldModel.get("comparatorElementVal"))return html='<div class="checkbox"><label><input type="checkbox" name="'+fieldModel.getName()+'" value="0" ',1!==fieldModel.getValue()&&"1"!==fieldModel.getValue()||(html+="checked"),html+=" >"+app.vtranslate("JS_IGNORE_EMPTY_VALUES")+"</label></div>",$(html);if("boolean"===fieldModel.getType().toLowerCase()||"C"===fieldSelectElement.find("option:selected").data("fieldtype")){var selectedValue=fieldSelectElement.closest(".js-conditions-row").find('[data-value="value"]').val();return html='<select class="select2" name="'+fieldModel.getName()+'">',html+='<option value="0"',"0"===selectedValue&&(html+=' selected="selected" '),html+=">"+app.vtranslate("JS_IS_DISABLED")+"</option>",html+='<option value="1"',"1"===selectedValue&&(html+=' selected="selected" '),html+=">"+app.vtranslate("JS_IS_ENABLED")+"</option>",html+="</select>",$(html)}return $(fieldModel.getUiTypeSpecificHtml())},loadFieldSpecificUi:function(fieldSelect){var selectedOption=fieldSelect.find("option:selected"),row=fieldSelect.closest("div.js-conditions-row"),fieldUiHolder=row.find(".fieldUiHolder"),conditionSelectElement=row.find('select[name="comparator"]'),fieldInfo=selectedOption.data("fieldinfo"),valueType=fieldUiHolder.find('[name="'+fieldInfo.name+'"]').data("valuetype"),fieldType="string";void 0!==fieldInfo?fieldType=fieldInfo.type:fieldInfo={};var comparatorElementVal=fieldInfo.comparatorElementVal=conditionSelectElement.val();"date"!=fieldType&&"datetime"!=fieldType||(fieldInfo.dateSpecificConditions=this.getDateSpecificConditionInfo());var moduleName=this.getModuleName(),fieldModel=Vtiger_Field_Js.getInstance(fieldInfo,moduleName);this.fieldModelInstance=fieldModel;var fieldSpecificUi=this.getFieldSpecificUi(fieldSelect),fieldName=fieldModel.getName();$.inArray(fieldModel.getType(),["multipicklist","sharedOwner","multiReferenceValue","taxes","categoryMultipicklist"])>-1?fieldName+="[]":$.inArray(fieldModel.getType(),["userCreator","picklist","owner","languages","modules","inventoryLimit","currencyList","fileLocationType"])>-1&&fieldSpecificUi.is("select")&&("e"==comparatorElementVal||"n"==comparatorElementVal)&&(fieldName+="[]"),fieldSpecificUi.find(".input-group-addon").length>0?(fieldSpecificUi.find(".input-group").addClass("row"),fieldSpecificUi.find(".input-group").addClass("row"),fieldSpecificUi.find('input[type="text"]').css("width","100%"),fieldSpecificUi.find('input[type="text"]').addClass("form-control")):fieldSpecificUi.filter('[name="'+fieldName+'"]').addClass("form-control"),fieldSpecificUi.filter('[name="'+fieldName+'"]').attr("data-value","value").removeAttr("data-validation-engine"),fieldSpecificUi.find('[name="'+fieldName+'"]').attr("data-value","value").removeAttr("data-validation-engine"),"currency"==fieldModel.getType()&&(fieldSpecificUi.filter('[name="'+fieldName+'"]').attr("data-decimal-separator",fieldInfo.decimal_separator).attr("data-group-separator",fieldInfo.group_separator),fieldSpecificUi.find('[name="'+fieldName+'"]').attr("data-decimal-separator",fieldInfo.decimal_separator).attr("data-group-separator",fieldInfo.group_separator)),valueType&&(this.fieldModelInstance.data.workflow_valuetype=valueType),fieldUiHolder.html(fieldSpecificUi),fieldSpecificUi.is("select")?App.Fields.Picklist.showSelect2ElementView(fieldSpecificUi,{dropdownParent:row}):fieldSpecificUi.has("input.dateField").length>0?App.Fields.Date.register(fieldSpecificUi):fieldSpecificUi.has("input.dateRangeField").length>0?App.Fields.Date.registerRange(fieldSpecificUi,{ranges:!1}):fieldSpecificUi.has("input.clockPicker").length>0&&app.registerEventForClockPicker(fieldSpecificUi),this.addValidationToFieldIfNeeded(fieldSelect);return-1!=["y","today","tomorrow","yesterday","smallerthannow","greaterthannow","ny","om","wr","nwr"].indexOf(conditionSelectElement.val())?fieldUiHolder.hide():fieldUiHolder.show(),this},loadFieldSpecificUiForAll:function(){var conditionsContainer=jQuery(".conditionList"),fieldSelectElement=jQuery('select[name="columnname"]',conditionsContainer);return jQuery.each(fieldSelectElement,(function(i,elem){var currentElement=jQuery(elem);"none"!=currentElement.val()&&currentElement.trigger("change",{_intialize:!0})})),this},addValidationToFieldIfNeeded:function(selectFieldElement){var selectedOption=selectFieldElement.find("option:selected"),fieldSpecificElement=selectFieldElement.closest("div.js-conditions-row").find('[data-value="value"]'),validator=selectedOption.attr("data-validator");return this.isFieldSupportsValidation(selectFieldElement)?(fieldSpecificElement.addClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]").attr("data-validation-engine","validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]").attr("data-fieldinfo",JSON.stringify(selectedOption.data("fieldinfo"))),void 0!==validator&&fieldSpecificElement.attr("data-validator",validator)):fieldSpecificElement.removeClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]").removeAttr("data-validation-engine").removeAttr("data-fieldinfo"),this},isFieldSupportsValidation:function(fieldSelect){var type=this.fieldModelInstance.getType();if(jQuery.inArray(type,this.allConditionValidationNeededFieldList)>=0)return!0;var conditionValue=fieldSelect.closest("div.js-conditions-row").find('select[name="comparator"]').val();return type in this.validationSupportedFieldConditionMap&&jQuery.inArray(conditionValue,this.validationSupportedFieldConditionMap[type])>=0},getValues:function(){var thisInstance=this,fieldList=["columnname","comparator","value","column_condition"],filterContainer=this.getFilterContainer(),conditionGroups=$(".conditionGroup",filterContainer),values={},columnIndex=0;return $(".conditionGroup",filterContainer).each((function(index,domElement){var groupElement=$(domElement);values[index+1]={},values[index+1].columns={},$(".conditionList .js-conditions-row",groupElement).each((function(i,conditionDomElement){var rowElement=$(conditionDomElement),fieldSelectElement=$('[name="columnname"]',rowElement),valueSelectElement=$('[data-value="value"]',rowElement);if(thisInstance.isEmptyFieldSelected(fieldSelectElement))return!0;var fieldType=fieldSelectElement.find("option:selected").data("fieldinfo").type,rowValues={},key=void 0,field=void 0;if("owner"===fieldType||"userCreator"===fieldType)for(key in fieldList)if("value"===(field=fieldList[key])&&valueSelectElement.is("select")){var newValuesArr=valueSelectElement.val();rowValues[field]=newValuesArr?newValuesArr.join(","):""}else"value"===field&&valueSelectElement.is("input")?rowValues[field]="checkbox"===valueSelectElement.attr("type")&&valueSelectElement.prop("checked")?1:valueSelectElement.val():rowValues[field]=$('[name="'+field+'"]',rowElement).val();else if($.inArray(fieldType,["picklist","multipicklist","modules","sharedOwner","multiReferenceValue","inventoryLimit","languages","currencyList","taxes","fileLocationType","categoryMultipicklist"])>-1)for(key in fieldList)if("value"===(field=fieldList[key])&&"checkbox"===valueSelectElement.attr("type"))rowValues[field]=valueSelectElement.prop("checked")?1:valueSelectElement.val();else if("value"===field&&valueSelectElement.is("input")){var pickListValues=valueSelectElement.data("picklistvalues"),valuesArr=valueSelectElement.val().split(","),_newValuesArr=[];for(i=0;i<valuesArr.length;i++)void 0!==pickListValues[valuesArr[i]]?_newValuesArr.push(pickListValues[valuesArr[i]]):_newValuesArr.push(valuesArr[i]);rowValues[field]=_newValuesArr.join(",")}else if("value"===field&&valueSelectElement.is("select")&&$.inArray(fieldType,["picklist","multipicklist","modules","sharedOwner","multiReferenceValue","inventoryLimit","languages","currencyList","taxes","fileLocationType","categoryMultipicklist"])>-1){var value=valueSelectElement.val();rowValues[field]=null==value?value:value.join(",")}else rowValues[field]=$('[name="'+field+'"]',rowElement).val();else for(key in fieldList)rowValues[field=fieldList[key]]="value"===field?"checkbox"===valueSelectElement.attr("type")&&valueSelectElement.prop("checked")?1:valueSelectElement.val():$('[name="'+field+'"]',rowElement).val();rowElement.is(":last-child")&&(rowValues.column_condition=""),values[index+1].columns[columnIndex]=rowValues,columnIndex++})),groupElement.find("div.groupCondition").length>0&&(values[index+1].condition=conditionGroups.find('div.groupCondition [name="condition"]').val())})),values},deleteConditionHandler:function(e){jQuery(e.currentTarget).closest(".js-conditions-row").remove()},registerAddCondition:function(){var thisInstance=this;this.getAddConditionElement().on("click",(function(e){thisInstance.addConditionHandler(e)}))},registerFieldChange:function(){var filterContainer=this.getFilterContainer(),thisInstance=this;filterContainer.on("change",'select[name="columnname"]',(function(e,data){var currentElement=jQuery(e.currentTarget);void 0!==data&&1==data._intialize||currentElement.closest("div.js-conditions-row").find('select[name="comparator"]').empty();thisInstance.loadConditions(currentElement),thisInstance.loadFieldSpecificUi(currentElement)}))},registerConditionChange:function(){var filterContainer=this.getFilterContainer(),thisInstance=this;filterContainer.on("change",'select[name="comparator"]',(function(e){var fieldSelectElement=jQuery(e.currentTarget).closest("div.js-conditions-row").find('select[name="columnname"]');thisInstance.loadFieldSpecificUi(fieldSelectElement),thisInstance.addValidationToFieldIfNeeded(fieldSelectElement)}))},registerDeleteCondition:function(){var thisInstance=this;this.getFilterContainer().on("click",".js-condition-delete",(function(e){thisInstance.deleteConditionHandler(e)}))},registerEvents:function(){this.registerAddCondition(),this.registerFieldChange(),this.registerDeleteCondition(),this.registerConditionChange()}}),Vtiger_Field_Js("AdvanceFilter_Field_Js",{},{getUiTypeSpecificHtml:function(){return this.getUiTypeModel().getUi()},getModuleName:function(){var currentModule=app.getModuleName(),type=this.getType();return $.inArray(type,["picklist","userCreator","multipicklist","owner","userCreator","modules","date","datetime","sharedOwner","multiReferenceValue","inventoryLimit","languages","currencyList","taxes","fileLocationType","categoryMultipicklist"])>-1&&(currentModule="AdvanceFilter"),currentModule}}),Vtiger_Picklist_Field_Js("AdvanceFilter_Picklist_Field_Js",{},{getUi:function(){var html='<select class="select2" multiple name="'+this.getName()+'[]">',pickListValues=this.getPickListValues(),selectedOptionsArray=app.htmlDecode(this.getValue()).split(",");for(var option in pickListValues)html+='<option value="'+option+'" ',-1!=jQuery.inArray(option,selectedOptionsArray)&&(html+=" selected "),html+=">"+pickListValues[option]+"</option>";html+="</select>";var selectContainer=jQuery(html);return this.addValidationToElement(selectContainer),selectContainer}}),AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Modules_Field_Js",{},{}),AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Inventorylimit_Field_Js",{},{}),AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Filelocationtype_Field_Js",{},{}),Vtiger_Multipicklist_Field_Js("AdvanceFilter_Multipicklist_Field_Js",{},{}),Vtiger_Multipicklist_Field_Js("AdvanceFilter_Categorymultipicklist_Field_Js",{},{}),AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Languages_Field_Js",{},{}),AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Currencylist_Field_Js",{},{}),AdvanceFilter_Multipicklist_Field_Js("AdvanceFilter_Taxes_Field_Js",{},{}),Vtiger_Owner_Field_Js("AdvanceFilter_Owner_Field_Js",{},{getUi:function(){var comparatorSelectedOptionVal=this.get("comparatorElementVal"),html="",selectContainer=void 0;if("e"===comparatorSelectedOptionVal||"n"===comparatorSelectedOptionVal||"shownerid"===this.getName()&&-1!=$.inArray(comparatorSelectedOptionVal,["c","k"])){html='<select class="select2" multiple name="'+this.getName()+'[]">';var pickListValues=this.getPickListValues(),selectedOption=app.htmlDecode(this.getValue()),optGroup=void 0;for(optGroup in pickListValues){html+='<optgroup label="'+optGroup+'">';var optionGroupValues=pickListValues[optGroup],option=void 0;for(option in optionGroupValues)html+='<option value="'+option+'" ',-1!=$.inArray(option,selectedOption.split(","))&&(html+=" selected "),html+=">"+optionGroupValues[option]+"</option>";html+="</optgroup>"}return html+="</select>",selectContainer=$(html),this.addValidationToElement(selectContainer),selectContainer}var tagsArray=[];return $.each(this.getPickListValues(),(function(groups,blocks){$.each(blocks,(function(i,e){tagsArray.push($.trim(e))}))})),html='<input data-tags="'+tagsArray+'" type="hidden" class="row select2" name="'+this.getName()+'">',(selectContainer=$(html).val(this.getValue())).data("tags",tagsArray),this.addValidationToElement(selectContainer),selectContainer}}),Vtiger_Multireferencevalue_Field_Js("AdvanceFilter_Multireferencevalue_Field_Js",{},{}),AdvanceFilter_Owner_Field_Js("AdvanceFilter_Sharedowner_Field_Js",{},{}),AdvanceFilter_Owner_Field_Js("AdvanceFilter_Usercreator_Field_Js",{},{}),Vtiger_Date_Field_Js("AdvanceFilter_Date_Field_Js",{},{getUi:function(){var comparatorSelectedOptionVal=this.get("comparatorElementVal"),dateSpecificConditions=this.get("dateSpecificConditions"),html="";if("bw"===comparatorSelectedOptionVal||"custom"===comparatorSelectedOptionVal){html='<div class="date"><input class="dateRangeField form-control" data-calendar-type="range" name="'+this.getName()+'" data-date-format="'+this.getDateFormat()+'" type="text" ReadOnly="true" value="'+this.getValue()+'"></div>';var element=$(html),dateFieldUi=element.find(".dateRangeField");if(-1!==dateFieldUi.val().indexOf(",")){var valueArray=this.getValue().split(","),startDateTime=valueArray[0],endDateTime=valueArray[1];if(-1!==startDateTime.indexOf(" ")){var dateTime=startDateTime.split(" ");startDateTime=dateTime[0]}if(-1!==endDateTime.indexOf(" ")){var dateTimeValue=endDateTime.split(" ");endDateTime=dateTimeValue[0]}dateFieldUi.val(startDateTime+","+endDateTime)}else{var value=this.getValue().split(" "),startDate=value[0],endDate=value[0];""!==startDate&&""!==endDate&&dateFieldUi.val(startDate+","+endDate)}return this.addValidationToElement(element)}if(comparatorSelectedOptionVal in dateSpecificConditions){var startValue=dateSpecificConditions[comparatorSelectedOptionVal].startdate,endValue=dateSpecificConditions[comparatorSelectedOptionVal].enddate;return html="today"===comparatorSelectedOptionVal||"tomorrow"===comparatorSelectedOptionVal||"yesterday"===comparatorSelectedOptionVal?'<input name="'+this.getName()+'" type="text" ReadOnly="true" value="'+startValue+'">':'<input name="'+this.getName()+'" type="text" ReadOnly="true" value="'+startValue+","+endValue+'">',$(html)}var fieldUi=this._super(),dateTimeFieldValue=fieldUi.find(".dateField").val(),dateValue=dateTimeFieldValue.split(" ");if("00:00:00"===dateValue[1])dateTimeFieldValue=dateValue[0];else if("e"===comparatorSelectedOptionVal||"n"===comparatorSelectedOptionVal||"b"===comparatorSelectedOptionVal||"a"===comparatorSelectedOptionVal){var dateTimeArray=dateTimeFieldValue.split(" ");dateTimeFieldValue=dateTimeArray[0]}return fieldUi.find(".dateField").val(dateTimeFieldValue),fieldUi}}),AdvanceFilter_Date_Field_Js("AdvanceFilter_Datetime_Field_Js",{},{});
//# sourceMappingURL=AdvanceFilter.min.js.map
