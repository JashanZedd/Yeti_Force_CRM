{"version":3,"file":"TreeCategoryModal.min.js","sources":["TreeCategoryModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\n\t'Vtiger_TreeCategory_Js',\n\t{},\n\t{\n\t\tmodalContainer: false,\n\t\ttreeInstance: false,\n\t\ttreeData: false,\n\t\twindowParent: app.getWindowParent(),\n\t\tgetModalContainer: function() {\n\t\t\tif (this.modalContainer == false) {\n\t\t\t\tthis.modalContainer = jQuery('#modalTreeCategoryModal');\n\t\t\t}\n\t\t\treturn this.modalContainer;\n\t\t},\n\t\tgetRecords: function(container) {\n\t\t\tif (this.treeData == false && container !== 'undefined') {\n\t\t\t\tvar treeValues = container.find('#treePopupValues').val();\n\t\t\t\tthis.treeData = JSON.parse(treeValues);\n\t\t\t}\n\t\t\treturn this.treeData;\n\t\t},\n\t\tgenerateTree: function(container) {\n\t\t\tvar thisInstance = this;\n\t\t\tif (thisInstance.treeInstance == false) {\n\t\t\t\tthisInstance.treeInstance = container.find('#treePopupContents');\n\t\t\t\tlet plugins = ['search', 'category'];\n\t\t\t\tif (thisInstance.getRelationType() == '2') {\n\t\t\t\t\tplugins.push('checkbox');\n\t\t\t\t}\n\t\t\t\tif (thisInstance.getRelationType() == '1') {\n\t\t\t\t\tplugins.push('edit');\n\t\t\t\t}\n\t\t\t\tthisInstance.treeInstance.jstree(\n\t\t\t\t\t$.extend(\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcore: {\n\t\t\t\t\t\t\t\tdata: thisInstance.getRecords(),\n\t\t\t\t\t\t\t\tthemes: {\n\t\t\t\t\t\t\t\t\tname: 'proton',\n\t\t\t\t\t\t\t\t\tresponsive: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcheckbox: {\n\t\t\t\t\t\t\t\tthree_state: false\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tplugins: plugins\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthisInstance.treeInstance.data('params')\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tgetRelationType: function() {\n\t\t\treturn this.getModalContainer()\n\t\t\t\t.find('#relationType')\n\t\t\t\t.val();\n\t\t},\n\t\tsearching: function(text) {\n\t\t\tthis.treeInstance.jstree(true).search(text);\n\t\t},\n\t\tregisterSearchEvent: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar valueSearch = $('#valueSearchTree');\n\t\t\tvar btnSearch = $('#btnSearchTree');\n\t\t\tvalueSearch.on('keypress', function(e) {\n\t\t\t\tif (e.which == 13) {\n\t\t\t\t\tthisInstance.searching(valueSearch.val());\n\t\t\t\t}\n\t\t\t});\n\t\t\tbtnSearch.on('click', function() {\n\t\t\t\tthisInstance.searching(valueSearch.val());\n\t\t\t});\n\t\t},\n\t\tregisterSaveRecords: function(container) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet ord = [],\n\t\t\t\tocd = [];\n\t\t\t$.each(thisInstance.getRecords(), function(index, value) {\n\t\t\t\tif (value.state && value.state.selected && value.attr === 'record') {\n\t\t\t\t\tord.push(value.record_id);\n\t\t\t\t}\n\t\t\t\tif (value.category && value.category.checked && value.attr !== 'record') {\n\t\t\t\t\tocd.push(value.record_id);\n\t\t\t\t}\n\t\t\t});\n\t\t\tcontainer.find('[name=\"saveButton\"]').on('click', function(e) {\n\t\t\t\tlet recordsToAdd = [],\n\t\t\t\t\tcategoryToAdd = [],\n\t\t\t\t\trecordsToRemove = Object.assign([], ord),\n\t\t\t\t\tcategoryToRemove = Object.assign([], ocd);\n\t\t\t\tlet saveButton = $(this);\n\t\t\t\tsaveButton.attr('disabled', 'disabled');\n\t\t\t\tlet cSelected = thisInstance.treeInstance.jstree('getCategory', true);\n\t\t\t\t$.each(cSelected, function(index, treeElement) {\n\t\t\t\t\tlet value = treeElement.record_id;\n\t\t\t\t\tif (treeElement.attr === 'record') {\n\t\t\t\t\t\tif (jQuery.inArray(value, recordsToRemove) == -1) {\n\t\t\t\t\t\t\trecordsToAdd.push(value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trecordsToRemove.splice(recordsToRemove.indexOf(value), 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (treeElement.attr !== 'record') {\n\t\t\t\t\t\tif (jQuery.inArray(value, categoryToRemove) == -1) {\n\t\t\t\t\t\t\tcategoryToAdd.push(value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcategoryToRemove.splice(categoryToRemove.indexOf(value), 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet params = {\n\t\t\t\t\tmodule: thisInstance.windowParent.app.getModuleName(),\n\t\t\t\t\taction: 'RelationAjax',\n\t\t\t\t\tmode: 'updateRelation',\n\t\t\t\t\trecordsToAdd: recordsToAdd,\n\t\t\t\t\trecordsToRemove: recordsToRemove,\n\t\t\t\t\tcategoryToAdd: categoryToAdd,\n\t\t\t\t\tcategoryToRemove: categoryToRemove,\n\t\t\t\t\tsrc_record: thisInstance.windowParent.app.getRecordId(),\n\t\t\t\t\trelated_module: container.find('#relatedModule').val()\n\t\t\t\t};\n\t\t\t\tif (recordsToAdd.length > 4) {\n\t\t\t\t\tbootbox.dialog({\n\t\t\t\t\t\ttitle: app.vtranslate('JS_INFORMATION'),\n\t\t\t\t\t\tmessage: app.vtranslate('JS_SAVE_SELECTED_ITEMS_ALERT').replace('__LENGTH__', recordsToAdd.length),\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\tlabel: app.vtranslate('JS_LBL_SAVE'),\n\t\t\t\t\t\t\t\tclassName: 'btn-success',\n\t\t\t\t\t\t\t\tcallback: function() {\n\t\t\t\t\t\t\t\t\tthisInstance.saveRecordsEvent(params);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdanger: {\n\t\t\t\t\t\t\t\tlabel: app.vtranslate('JS_LBL_CANCEL'),\n\t\t\t\t\t\t\t\tclassName: 'btn-warning',\n\t\t\t\t\t\t\t\tcallback: function() {\n\t\t\t\t\t\t\t\t\tsaveButton.removeAttr('disabled');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthisInstance.saveRecordsEvent(params);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tsaveRecordsEvent: function(params) {\n\t\t\tconst self = this;\n\t\t\tAppConnector.request(params).done(function(res) {\n\t\t\t\tself.windowParent.Vtiger_Detail_Js.getInstance().reloadTabContent();\n\t\t\t\tapp.hideModalWindow();\n\t\t\t});\n\t\t},\n\t\tregisterCounterSelected: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tthis.treeInstance.on('changed.jstree', function(e, data) {\n\t\t\t\tvar counterSelected = 0;\n\t\t\t\tvar html = '';\n\t\t\t\t$.each(thisInstance.treeInstance.jstree('get_selected', true), function(index, value) {\n\t\t\t\t\tvar id = value.original.record_id.toString();\n\t\t\t\t\tif (id.indexOf('T')) {\n\t\t\t\t\t\tcounterSelected++;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\thtml = app.vtranslate('JS_SELECTED_ELEMENTS') + ': ' + counterSelected;\n\t\t\t\t$('.counterSelected').text(html);\n\t\t\t});\n\t\t},\n\t\tregisterEvents: function() {\n\t\t\tvar container = this.getModalContainer();\n\t\t\tthis.getRecords(container);\n\t\t\tthis.generateTree(container);\n\t\t\tthis.registerSaveRecords(container);\n\t\t\tthis.registerSearchEvent();\n\t\t\tthis.registerCounterSelected();\n\t\t}\n\t}\n);\njQuery(function() {\n\tvar instance = new Vtiger_TreeCategory_Js();\n\tinstance.registerEvents();\n});\n"],"names":["jQuery","Class","app","getWindowParent","this","modalContainer","container","treeData","treeValues","find","val","JSON","parse","treeInstance","plugins","getRelationType","push","jstree","$","extend","getRecords","data","getModalContainer","text","search","thisInstance","valueSearch","btnSearch","on","e","which","searching","ord","ocd","each","index","value","state","selected","attr","record_id","category","checked","recordsToAdd","categoryToAdd","recordsToRemove","Object","assign","categoryToRemove","saveButton","cSelected","treeElement","inArray","splice","indexOf","params","windowParent","getModuleName","getRecordId","length","dialog","vtranslate","replace","saveRecordsEvent","removeAttr","self","request","done","res","Vtiger_Detail_Js","getInstance","reloadTabContent","hideModalWindow","html","counterSelected","original","toString","generateTree","registerSaveRecords","registerSearchEvent","registerCounterSelected","Vtiger_TreeCategory_Js","registerEvents"],"mappings":"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"}