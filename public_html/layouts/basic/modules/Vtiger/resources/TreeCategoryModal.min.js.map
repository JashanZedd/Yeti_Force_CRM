{"version":3,"file":"TreeCategoryModal.min.js","sources":["TreeCategoryModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\n\t'Vtiger_TreeCategory_Js',\n\t{},\n\t{\n\t\tmodalContainer: false,\n\t\ttreeInstance: false,\n\t\ttreeData: false,\n\t\twindowParent: app.getWindowParent(),\n\t\tgetModalContainer: function() {\n\t\t\tif (this.modalContainer == false) {\n\t\t\t\tthis.modalContainer = jQuery('#modalTreeCategoryModal');\n\t\t\t}\n\t\t\treturn this.modalContainer;\n\t\t},\n\t\tgetRecords: function(container) {\n\t\t\tif (this.treeData == false && container !== 'undefined') {\n\t\t\t\tvar treeValues = container.find('#treePopupValues').val();\n\t\t\t\tthis.treeData = JSON.parse(treeValues);\n\t\t\t}\n\t\t\treturn this.treeData;\n\t\t},\n\t\tgenerateTree: function(container) {\n\t\t\tvar thisInstance = this;\n\t\t\tif (thisInstance.treeInstance == false) {\n\t\t\t\tthisInstance.treeInstance = container.find('#treePopupContents');\n\t\t\t\tlet plugins = ['search', 'category'];\n\t\t\t\tif (thisInstance.getRelationType() == '2') {\n\t\t\t\t\tplugins.push('checkbox');\n\t\t\t\t}\n\t\t\t\tif (thisInstance.getRelationType() == '1') {\n\t\t\t\t\tplugins.push('edit');\n\t\t\t\t}\n\t\t\t\tthisInstance.treeInstance.jstree(\n\t\t\t\t\t$.extend(\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcore: {\n\t\t\t\t\t\t\t\tdata: thisInstance.getRecords(),\n\t\t\t\t\t\t\t\tthemes: {\n\t\t\t\t\t\t\t\t\tname: 'proton',\n\t\t\t\t\t\t\t\t\tresponsive: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcheckbox: {\n\t\t\t\t\t\t\t\tthree_state: false\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tplugins: plugins\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthisInstance.treeInstance.data('params')\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tgetRelationType: function() {\n\t\t\treturn this.getModalContainer()\n\t\t\t\t.find('#relationType')\n\t\t\t\t.val();\n\t\t},\n\t\tsearching: function(text) {\n\t\t\tthis.treeInstance.jstree(true).search(text);\n\t\t},\n\t\tregisterSearchEvent: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar valueSearch = $('#valueSearchTree');\n\t\t\tvar btnSearch = $('#btnSearchTree');\n\t\t\tvalueSearch.on('keypress', function(e) {\n\t\t\t\tif (e.which == 13) {\n\t\t\t\t\tthisInstance.searching(valueSearch.val());\n\t\t\t\t}\n\t\t\t});\n\t\t\tbtnSearch.on('click', function() {\n\t\t\t\tthisInstance.searching(valueSearch.val());\n\t\t\t});\n\t\t},\n\t\tregisterSaveRecords: function(container) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet ord = [],\n\t\t\t\tocd = [];\n\t\t\t$.each(thisInstance.getRecords(), function(index, value) {\n\t\t\t\tif (value.state && value.state.selected && value.attr === 'record') {\n\t\t\t\t\tord.push(value.record_id);\n\t\t\t\t}\n\t\t\t\tif (value.category && value.category.checked && value.attr !== 'record') {\n\t\t\t\t\tocd.push(value.record_id);\n\t\t\t\t}\n\t\t\t});\n\t\t\tcontainer.find('[name=\"saveButton\"]').on('click', function(e) {\n\t\t\t\tlet recordsToAdd = [],\n\t\t\t\t\tcategoryToAdd = [],\n\t\t\t\t\trecordsToRemove = Object.assign([], ord),\n\t\t\t\t\tcategoryToRemove = Object.assign([], ocd);\n\t\t\t\tlet saveButton = $(this);\n\t\t\t\tsaveButton.attr('disabled', 'disabled');\n\t\t\t\tlet cSelected = thisInstance.treeInstance.jstree('getCategory', true);\n\t\t\t\t$.each(cSelected, function(index, treeElement) {\n\t\t\t\t\tlet value = treeElement.record_id;\n\t\t\t\t\tif (treeElement.attr === 'record') {\n\t\t\t\t\t\tif (jQuery.inArray(value, recordsToRemove) == -1) {\n\t\t\t\t\t\t\trecordsToAdd.push(value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trecordsToRemove.splice(recordsToRemove.indexOf(value), 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (treeElement.attr !== 'record') {\n\t\t\t\t\t\tif (jQuery.inArray(value, categoryToRemove) == -1) {\n\t\t\t\t\t\t\tcategoryToAdd.push(value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcategoryToRemove.splice(categoryToRemove.indexOf(value), 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet params = {\n\t\t\t\t\tmodule: thisInstance.windowParent.app.getModuleName(),\n\t\t\t\t\taction: 'RelationAjax',\n\t\t\t\t\tmode: 'updateRelation',\n\t\t\t\t\trecordsToAdd: recordsToAdd,\n\t\t\t\t\trecordsToRemove: recordsToRemove,\n\t\t\t\t\tcategoryToAdd: categoryToAdd,\n\t\t\t\t\tcategoryToRemove: categoryToRemove,\n\t\t\t\t\tsrc_record: thisInstance.windowParent.app.getRecordId(),\n\t\t\t\t\trelated_module: container.find('#relatedModule').val()\n\t\t\t\t};\n\t\t\t\tif (recordsToAdd.length > 4) {\n\t\t\t\t\tbootbox.dialog({\n\t\t\t\t\t\ttitle: app.vtranslate('JS_INFORMATION'),\n\t\t\t\t\t\tmessage: app.vtranslate('JS_SAVE_SELECTED_ITEMS_ALERT').replace('__LENGTH__', recordsToAdd.length),\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\tlabel: app.vtranslate('JS_LBL_SAVE'),\n\t\t\t\t\t\t\t\tclassName: 'btn-success',\n\t\t\t\t\t\t\t\tcallback: function() {\n\t\t\t\t\t\t\t\t\tthisInstance.saveRecordsEvent(params);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdanger: {\n\t\t\t\t\t\t\t\tlabel: app.vtranslate('JS_LBL_CANCEL'),\n\t\t\t\t\t\t\t\tclassName: 'btn-warning',\n\t\t\t\t\t\t\t\tcallback: function() {\n\t\t\t\t\t\t\t\t\tsaveButton.removeAttr('disabled');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthisInstance.saveRecordsEvent(params);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tsaveRecordsEvent: function(params) {\n\t\t\tconst self = this;\n\t\t\tAppConnector.request(params).done(function(res) {\n\t\t\t\tself.windowParent.Vtiger_Detail_Js.getInstance().reloadTabContent();\n\t\t\t\tapp.hideModalWindow();\n\t\t\t});\n\t\t},\n\t\tregisterCounterSelected: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tthis.treeInstance.on('changed.jstree', function(e, data) {\n\t\t\t\tvar counterSelected = 0;\n\t\t\t\tvar html = '';\n\t\t\t\t$.each(thisInstance.treeInstance.jstree('get_selected', true), function(index, value) {\n\t\t\t\t\tvar id = value.original.record_id.toString();\n\t\t\t\t\tif (id.indexOf('T')) {\n\t\t\t\t\t\tcounterSelected++;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\thtml = app.vtranslate('JS_SELECTED_ELEMENTS') + ': ' + counterSelected;\n\t\t\t\t$('.counterSelected').text(html);\n\t\t\t});\n\t\t},\n\t\tregisterEvents: function() {\n\t\t\tvar container = this.getModalContainer();\n\t\t\tthis.getRecords(container);\n\t\t\tthis.generateTree(container);\n\t\t\tthis.registerSaveRecords(container);\n\t\t\tthis.registerSearchEvent();\n\t\t\tthis.registerCounterSelected();\n\t\t}\n\t}\n);\njQuery(function() {\n\tvar instance = new Vtiger_TreeCategory_Js();\n\tinstance.registerEvents();\n});\n"],"names":["jQuery","Class","app","getWindowParent","modalContainer","container","treeData","treeValues","find","val","JSON","parse","thisInstance","treeInstance","plugins","getRelationType","push","jstree","$","extend","getRecords","data","getModalContainer","text","search","valueSearch","btnSearch","on","e","which","searching","ord","ocd","each","index","value","state","selected","attr","record_id","category","checked","recordsToAdd","categoryToAdd","recordsToRemove","Object","assign","categoryToRemove","saveButton","cSelected","treeElement","inArray","splice","indexOf","params","windowParent","getModuleName","getRecordId","length","dialog","vtranslate","replace","saveRecordsEvent","removeAttr","self","request","done","res","Vtiger_Detail_Js","getInstance","reloadTabContent","hideModalWindow","counterSelected","html","id","original","toString","generateTree","registerSaveRecords","registerSearchEvent","registerCounterSelected","instance","Vtiger_TreeCategory_Js","registerEvents"],"mappings":"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"}