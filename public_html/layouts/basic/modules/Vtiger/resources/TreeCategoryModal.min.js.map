{"version":3,"file":"TreeCategoryModal.min.js","sources":["TreeCategoryModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\"Vtiger_TreeCategory_Js\", {}, {\n\tmodalContainer: false,\n\ttreeInstance: false,\n\ttreeData: false,\n\twindowParent: app.getWindowParent(),\n\tgetModalContainer: function () {\n\t\tif (this.modalContainer == false) {\n\t\t\tthis.modalContainer = jQuery('#modalTreeCategoryModal');\n\t\t}\n\t\treturn this.modalContainer;\n\t},\n\tgetRecords: function (container) {\n\t\tif (this.treeData == false && container !== \"undefined\") {\n\t\t\tvar treeValues = container.find('#treePopupValues').val();\n\t\t\tthis.treeData = JSON.parse(treeValues);\n\t\t}\n\t\treturn this.treeData;\n\t},\n\tgenerateTree: function (container) {\n\t\tvar thisInstance = this;\n\t\tif (thisInstance.treeInstance == false) {\n\t\t\tthisInstance.treeInstance = container.find(\"#treePopupContents\");\n\t\t\tvar plugins = [\n\t\t\t\t\"search\"\n\t\t\t];\n\t\t\tif (thisInstance.isActiveCategory()) {\n\t\t\t\tplugins.push(\"category\");\n\t\t\t}\n\t\t\tif (thisInstance.getRelationType() == '2') {\n\t\t\t\tplugins.push(\"checkbox\");\n\t\t\t}\n\t\t\tif (thisInstance.getRelationType() == '1') {\n\t\t\t\tplugins.push(\"edit\");\n\t\t\t}\n\t\t\tthisInstance.treeInstance.jstree($.extend(true, {\n\t\t\t\tcore: {\n\t\t\t\t\tdata: thisInstance.getRecords(),\n\t\t\t\t\tthemes: {\n\t\t\t\t\t\tname: 'proton',\n\t\t\t\t\t\tresponsive: true\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcheckbox: {\n\t\t\t\t\tthree_state: false,\n\t\t\t\t},\n\t\t\t\tplugins: plugins\n\t\t\t}, thisInstance.treeInstance.data('params')));\n\t\t}\n\t},\n\tisActiveCategory: function () {\n\t\treturn this.getModalContainer().find('#isActiveCategory').val() == '1';\n\t},\n\tgetRelationType: function () {\n\t\treturn this.getModalContainer().find('#relationType').val();\n\t},\n\tsearching: function (text) {\n\t\tthis.treeInstance.jstree(true).search(text);\n\t},\n\tregisterSearchEvent: function () {\n\t\tvar thisInstance = this;\n\t\tvar valueSearch = $('#valueSearchTree');\n\t\tvar btnSearch = $('#btnSearchTree');\n\t\tvalueSearch.on('keypress', function (e) {\n\t\t\tif (e.which == 13) {\n\t\t\t\tthisInstance.searching(valueSearch.val());\n\t\t\t}\n\t\t});\n\t\tbtnSearch.on('click', function () {\n\t\t\tthisInstance.searching(valueSearch.val());\n\t\t});\n\t},\n\tregisterSaveRecords: function (container) {\n\t\tvar thisInstance = this;\n\t\tvar ord = [], ocd = [];\n\t\t$.each(thisInstance.getRecords(), function (index, value) {\n\t\t\tif (value.state && value.state.selected && value.type == \"record\") {\n\t\t\t\tord.push(value.record_id);\n\t\t\t}\n\t\t\tif (value.category && value.category.checked) {\n\t\t\t\tocd.push(value.record_id);\n\t\t\t}\n\t\t});\n\t\tcontainer.find('[name=\"saveButton\"]').on('click', function (e) {\n\t\t\tvar rSelected = [], cSelected = [], recordsToAdd = [], recordsToRemove = [], categoryToAdd = [],\n\t\t\t\tcategoryToRemove = []\n\t\t\tvar saveButton = $(this);\n\t\t\tsaveButton.attr('disabled', 'disabled');\n\t\t\t$.each(thisInstance.treeInstance.jstree(\"get_selected\", true), function (index, value) {\n\t\t\t\tif (jQuery.inArray(value.original.record_id, ord) == -1 && value.original.type == \"record\") {\n\t\t\t\t\trecordsToAdd.push(value.original.record_id);\n\t\t\t\t}\n\t\t\t\trSelected.push(value.original.record_id);\n\t\t\t});\n\t\t\t$.each(ord, function (index, value) {\n\t\t\t\tif (jQuery.inArray(value, rSelected) == -1) {\n\t\t\t\t\trecordsToRemove.push(value);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (thisInstance.isActiveCategory()) {\n\t\t\t\tcSelected = thisInstance.treeInstance.jstree(\"getCategory\");\n\t\t\t\t$.each(cSelected, function (index, value) {\n\t\t\t\t\tif (jQuery.inArray(value, ocd) == -1) {\n\t\t\t\t\t\tcategoryToAdd.push(value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t$.each(ocd, function (index, value) {\n\t\t\t\t\tif (jQuery.inArray(value, cSelected) == -1) {\n\t\t\t\t\t\tcategoryToRemove.push(value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tvar params = {\n\t\t\t\tmodule: thisInstance.windowParent.app.getModuleName(),\n\t\t\t\taction: 'RelationAjax',\n\t\t\t\tmode: 'updateRelation',\n\t\t\t\trecordsToAdd: recordsToAdd,\n\t\t\t\trecordsToRemove: recordsToRemove,\n\t\t\t\tcategoryToAdd: categoryToAdd,\n\t\t\t\tcategoryToRemove: categoryToRemove,\n\t\t\t\tsrc_record: thisInstance.windowParent.app.getRecordId(),\n\t\t\t\trelated_module: container.find('#relatedModule').val(),\n\t\t\t};\n\t\t\tif (recordsToAdd.length > 4) {\n\t\t\t\tbootbox.dialog({\n\t\t\t\t\ttitle: app.vtranslate('JS_INFORMATION'),\n\t\t\t\t\tmessage: app.vtranslate('JS_SAVE_SELECTED_ITEMS_ALERT').replace('__LENGTH__', recordsToAdd.length),\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\tlabel: app.vtranslate('JS_LBL_SAVE'),\n\t\t\t\t\t\t\tclassName: \"btn-success\",\n\t\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\t\tthisInstance.saveRecordsEvent(params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdanger: {\n\t\t\t\t\t\t\tlabel: app.vtranslate('JS_LBL_CANCEL'),\n\t\t\t\t\t\t\tclassName: \"btn-warning\",\n\t\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\t\tsaveButton.removeAttr('disabled');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthisInstance.saveRecordsEvent(params);\n\t\t\t}\n\t\t});\n\t},\n\tsaveRecordsEvent: function (params) {\n\t\tconst self = this;\n\t\tAppConnector.request(params).done(function (res) {\n\t\t\tself.windowParent.Vtiger_Detail_Js.getInstance().reloadTabContent();\n\t\t\tapp.hideModalWindow();\n\t\t})\n\t},\n\tregisterCounterSelected: function () {\n\t\tvar thisInstance = this;\n\t\tthis.treeInstance.on(\"changed.jstree\", function (e, data) {\n\t\t\tvar counterSelected = 0;\n\t\t\tvar html = '';\n\t\t\t$.each(thisInstance.treeInstance.jstree(\"get_selected\", true), function (index, value) {\n\t\t\t\tvar id = value.original.record_id.toString();\n\t\t\t\tif (id.indexOf(\"T\")) {\n\t\t\t\t\tcounterSelected++;\n\t\t\t\t}\n\t\t\t});\n\t\t\thtml = app.vtranslate('JS_SELECTED_ELEMENTS') + ': ' + counterSelected;\n\t\t\t$('.counterSelected').text(html);\n\t\t});\n\t},\n\tregisterEvents: function () {\n\t\tvar container = this.getModalContainer();\n\t\tthis.getRecords(container);\n\t\tthis.generateTree(container);\n\t\tthis.registerSaveRecords(container);\n\t\tthis.registerSearchEvent();\n\t\tthis.registerCounterSelected();\n\t}\n});\njQuery(function () {\n\tvar instance = new Vtiger_TreeCategory_Js();\n\tinstance.registerEvents();\n});\n"],"names":["jQuery","Class","modalContainer","treeInstance","treeData","windowParent","app","getWindowParent","getModalContainer","getRecords","container","find","val","JSON","parse","treeValues","generateTree","thisInstance","isActiveCategory","plugins","push","getRelationType","jstree","$","extend","core","data","themes","name","responsive","checkbox","three_state","searching","text","search","registerSearchEvent","valueSearch","btnSearch","on","e","which","registerSaveRecords","ord","ocd","each","index","value","state","selected","type","record_id","category","checked","cSelected","recordsToAdd","recordsToRemove","categoryToAdd","categoryToRemove","saveButton","attr","inArray","original","rSelected","module","getModuleName","action","mode","src_record","getRecordId","related_module","length","bootbox","dialog","title","vtranslate","message","replace","buttons","success","label","className","callback","saveRecordsEvent","params","danger","removeAttr","AppConnector","request","done","self","Vtiger_Detail_Js","getInstance","reloadTabContent","hideModalWindow","registerCounterSelected","html","toString","id","indexOf","counterSelected","registerEvents","instance"],"mappings":"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"}