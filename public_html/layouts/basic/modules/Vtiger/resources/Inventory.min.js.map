{"version":3,"file":"Inventory.min.js","sources":["Inventory.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class(\n\t'Vtiger_Inventory_Js',\n\t{\n\t\tinventoryInstance: false,\n\t\t/**\n\t\t * Get inventory instance\n\t\t * @param {jQuery} container\n\t\t * @returns {Vtiger_Inventory_Js}\n\t\t */\n\t\tgetInventoryInstance: function(container) {\n\t\t\tif (this.inventoryInstance === false) {\n\t\t\t\tlet moduleClassName = container.find('[name=\"module\"]').val() + '_Inventory_Js';\n\t\t\t\tif (typeof window[moduleClassName] === 'undefined') {\n\t\t\t\t\tmoduleClassName = 'Vtiger_Inventory_Js';\n\t\t\t\t}\n\t\t\t\tif (typeof window[moduleClassName] !== 'undefined') {\n\t\t\t\t\tthis.inventoryInstance = new window[moduleClassName]();\n\t\t\t\t\tthis.inventoryInstance.registerEvents(container);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this.inventoryInstance;\n\t\t}\n\t},\n\t{\n\t\tform: false,\n\t\tinventoryContainer: false,\n\t\tinventoryHeadContainer: false,\n\t\tsummaryTaxesContainer: false,\n\t\tsummaryDiscountContainer: false,\n\t\tsummaryCurrenciesContainer: false,\n\t\trowClass: 'tr.inventoryRow',\n\t\tdiscountModalFields: [\n\t\t\t'aggregationType',\n\t\t\t'globalDiscount',\n\t\t\t'groupCheckbox',\n\t\t\t'groupDiscount',\n\t\t\t'individualDiscount',\n\t\t\t'individualDiscountType'\n\t\t],\n\t\ttaxModalFields: ['aggregationType', 'globalTax', 'groupCheckbox', 'groupTax', 'individualTax', 'regionalTax'],\n\t\t/**\n\t\t * Get current form element\n\t\t * @returns {jQuery}\n\t\t */\n\t\tgetForm() {\n\t\t\treturn this.form;\n\t\t},\n\t\t/**\n\t\t * Function that is used to get the line item container\n\t\t * @return : jQuery object\n\t\t */\n\t\tgetInventoryItemsContainer: function() {\n\t\t\tif (this.inventoryContainer === false) {\n\t\t\t\tthis.inventoryContainer = $('.inventoryItems');\n\t\t\t}\n\t\t\treturn this.inventoryContainer;\n\t\t},\n\t\tgetInventoryHeadContainer: function() {\n\t\t\tif (this.inventoryHeadContainer === false) {\n\t\t\t\tthis.inventoryHeadContainer = $('.inventoryHeader');\n\t\t\t}\n\t\t\treturn this.inventoryHeadContainer;\n\t\t},\n\t\tgetInventorySummaryDiscountContainer: function() {\n\t\t\tif (this.summaryDiscountContainer === false) {\n\t\t\t\tthis.summaryDiscountContainer = $('.inventorySummaryDiscounts');\n\t\t\t}\n\t\t\treturn this.summaryDiscountContainer;\n\t\t},\n\t\tgetInventorySummaryTaxesContainer: function() {\n\t\t\tif (this.summaryTaxesContainer === false) {\n\t\t\t\tthis.summaryTaxesContainer = $('.inventorySummaryTaxes');\n\t\t\t}\n\t\t\treturn this.summaryTaxesContainer;\n\t\t},\n\t\tgetInventorySummaryCurrenciesContainer: function() {\n\t\t\tif (this.summaryCurrenciesContainer === false) {\n\t\t\t\tthis.summaryCurrenciesContainer = $('.inventorySummaryCurrencies');\n\t\t\t}\n\t\t\treturn this.summaryCurrenciesContainer;\n\t\t},\n\t\tgetNextLineItemRowNumber: function() {\n\t\t\tvar $inventoryItemsNo = $('#inventoryItemsNo');\n\t\t\tvar rowNumber = parseInt($inventoryItemsNo.val()) + 1;\n\t\t\t$inventoryItemsNo.val(rowNumber);\n\t\t\treturn rowNumber;\n\t\t},\n\t\tgetAccountId: function() {\n\t\t\tvar accountReferenceField = $('#accountReferenceField').val();\n\t\t\tif (accountReferenceField != '') {\n\t\t\t\treturn $('[name=\"' + accountReferenceField + '\"]').val();\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\tcheckDeleteIcon: function() {\n\t\t\tif (this.getInventoryItemsContainer().find(this.rowClass).length > 1) {\n\t\t\t\tthis.showLineItemsDeleteIcon();\n\t\t\t} else if (app.getMainParams('isRequiredInventory')) {\n\t\t\t\tthis.hideLineItemsDeleteIcon();\n\t\t\t}\n\t\t},\n\t\tshowLineItemsDeleteIcon: function() {\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find('.deleteRow')\n\t\t\t\t.removeClass('d-none');\n\t\t},\n\t\thideLineItemsDeleteIcon: function() {\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find('.deleteRow')\n\t\t\t\t.addClass('d-none');\n\t\t},\n\t\tgetClosestRow: function(element) {\n\t\t\treturn element.closest(this.rowClass);\n\t\t},\n\t\t/**\n\t\t * Function which will return the basic row which can be used to add new rows\n\t\t * @return jQuery object which you can use to\n\t\t */\n\t\tgetBasicRow: function() {\n\t\t\treturn this.getForm()\n\t\t\t\t.find('.js-inventory-base-item')\n\t\t\t\t.eq(0)\n\t\t\t\t.clone(true, true);\n\t\t},\n\t\tisRecordSelected: function(element) {\n\t\t\tvar parentRow = element.closest('tr');\n\t\t\tvar productField = parentRow.find('.recordLabel');\n\t\t\treturn productField.validationEngine('validate');\n\t\t},\n\t\tgetTaxModeSelectElement: function(row) {\n\t\t\tvar items = this.getInventoryHeadContainer();\n\t\t\tif (items.find('thead .js-taxmode').length > 0) {\n\t\t\t\treturn $('.js-taxmode');\n\t\t\t}\n\t\t\tif (row) {\n\t\t\t\treturn row.find('.js-taxmode');\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tisIndividualTaxMode: function(row) {\n\t\t\tvar taxModeElement = this.getTaxModeSelectElement(row);\n\t\t\tvar selectedOption = taxModeElement.find('option:selected');\n\t\t\treturn selectedOption.val() == '1';\n\t\t},\n\t\tisGroupTaxMode: function() {\n\t\t\tvar taxTypeElement = this.getTaxModeSelectElement();\n\t\t\tif (taxTypeElement) {\n\t\t\t\tvar selectedOption = taxTypeElement.find('option:selected');\n\t\t\t\tif (selectedOption.val() == '0') {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tshowIndividualTax: function(row) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar groupTax = thisInstance.getInventorySummaryTaxesContainer().find('.groupTax');\n\t\t\tvar items = thisInstance.getInventoryItemsContainer();\n\t\t\tvar newRow = $('#blackIthemTable').find('tbody');\n\t\t\tif (thisInstance.isIndividualTaxMode()) {\n\t\t\t\tgroupTax.addClass('d-none');\n\t\t\t\titems.find('.changeTax').removeClass('d-none');\n\t\t\t\tnewRow.find('.changeTax').removeClass('d-none');\n\t\t\t\tlet parentRow = thisInstance.getInventoryItemsContainer();\n\t\t\t\tlet taxParam = { aggregationType: 'global' };\n\n\t\t\t\tparentRow.find(thisInstance.rowClass).each(function() {\n\t\t\t\t\tlet thisItem = $(this);\n\t\t\t\t\ttaxParam['globalTax'] = App.Fields.Double.formatToDb(thisItem.find('.js-tax').attr('data-default-tax'));\n\t\t\t\t\tthisInstance.setTaxParam(thisItem, taxParam);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthisInstance.setTax(items, 0);\n\t\t\t\tthisInstance.setTaxPercent(items, 0);\n\t\t\t\tthisInstance.setTaxParam(items, []);\n\t\t\t\tthisInstance.setDefaultGlobalTax(row);\n\t\t\t\tgroupTax.removeClass('d-none');\n\t\t\t\titems.find('.changeTax').addClass('d-none');\n\t\t\t\tnewRow.find('.changeTax').addClass('d-none');\n\t\t\t}\n\t\t\tthisInstance.rowsCalculations();\n\t\t},\n\t\tsetDefaultGlobalTax: function(row) {\n\t\t\tlet thisInstance = this;\n\t\t\tlet parentRow = thisInstance.getInventoryItemsContainer();\n\t\t\tlet taxDefaultValue = thisInstance\n\t\t\t\t.getInventorySummaryTaxesContainer()\n\t\t\t\t.find('.js-default-tax')\n\t\t\t\t.data('tax-default-value');\n\t\t\tlet isGroupTax = thisInstance.isGroupTaxMode();\n\t\t\tif (isGroupTax) {\n\t\t\t\tif (taxDefaultValue) {\n\t\t\t\t\tlet taxParam = { aggregationType: 'global' };\n\t\t\t\t\ttaxParam['globalTax'] = App.Fields.Double.formatToDisplay(taxDefaultValue);\n\t\t\t\t\ttaxParam['individualTax'] = '';\n\t\t\t\t\tthisInstance.setTaxParam($('#blackIthemTable'), taxParam);\n\t\t\t\t\tthisInstance.setTaxParam(parentRow, taxParam);\n\t\t\t\t\tparentRow.closest('.inventoryItems').data('taxParam', JSON.stringify(taxParam));\n\t\t\t\t\tparentRow.find(thisInstance.rowClass).each(function() {\n\t\t\t\t\t\tthisInstance.quantityChangeActions($(this));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthisInstance.setTaxParam($('#blackIthemTable'), []);\n\t\t\t\tparentRow.closest('.inventoryItems').data('taxParam', []);\n\t\t\t}\n\t\t},\n\t\tgetDiscountModeSelectElement: function(row) {\n\t\t\tvar items = this.getInventoryHeadContainer();\n\t\t\tif (items.find('thead .js-discountmode').length > 0) {\n\t\t\t\treturn $('.js-discountmode');\n\t\t\t}\n\t\t\treturn row.find('.js-discountmode');\n\t\t},\n\t\tisIndividualDiscountMode: function(row) {\n\t\t\tvar discountModeElement = this.getDiscountModeSelectElement(row);\n\t\t\tvar selectedOption = discountModeElement.find('option:selected');\n\t\t\treturn selectedOption.val() == '1';\n\t\t},\n\t\tshowIndividualDiscount: function(row) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar groupDiscount = thisInstance.getInventorySummaryDiscountContainer().find('.groupDiscount');\n\t\t\tvar items = thisInstance.getInventoryItemsContainer();\n\t\t\tvar newRow = $('#blackIthemTable').find('tbody');\n\t\t\tif (thisInstance.isIndividualDiscountMode(row)) {\n\t\t\t\tgroupDiscount.addClass('d-none');\n\t\t\t\titems.find('.changeDiscount').removeClass('d-none');\n\t\t\t\tnewRow.find('.changeDiscount').removeClass('d-none');\n\t\t\t} else {\n\t\t\t\tgroupDiscount.removeClass('d-none');\n\t\t\t\titems.find('.changeDiscount').addClass('d-none');\n\t\t\t\tnewRow.find('.changeDiscount').addClass('d-none');\n\t\t\t}\n\t\t\tthisInstance.setDiscount(items, 0);\n\t\t\tthisInstance.setDiscountParam(items, []);\n\t\t\tthisInstance.rowsCalculations();\n\t\t},\n\t\tgetCurrency: function() {\n\t\t\tlet currency = $('.js-currency', this.getInventoryHeadContainer());\n\t\t\treturn currency.find('option:selected').val();\n\t\t},\n\t\tgetTax: function(row) {\n\t\t\tvar taxParams = row.find('.taxParam').val();\n\t\t\tif (taxParams == '' || taxParams == '[]' || taxParams == undefined) return 0;\n\t\t\ttaxParams = JSON.parse(taxParams);\n\t\t\tvar aggregationType = $('.aggregationTypeTax').val();\n\t\t\tvar valuePrices = this.getNetPrice(row);\n\t\t\tvar taxRate = 0;\n\t\t\tvar types = taxParams.aggregationType;\n\t\t\tif (typeof types == 'string') {\n\t\t\t\ttypes = [types];\n\t\t\t}\n\t\t\tif (types) {\n\t\t\t\ttypes.forEach(function(entry) {\n\t\t\t\t\tvar taxValue = 0;\n\t\t\t\t\tswitch (entry) {\n\t\t\t\t\t\tcase 'individual':\n\t\t\t\t\t\t\ttaxValue = taxParams.individualTax;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'global':\n\t\t\t\t\t\t\ttaxValue = taxParams.globalTax;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'group':\n\t\t\t\t\t\t\ttaxValue = taxParams.groupTax;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'regional':\n\t\t\t\t\t\t\ttaxValue = taxParams.regionalTax;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\ttaxRate += valuePrices * (App.Fields.Double.formatToDb(taxValue) / 100);\n\t\t\t\t\tif (aggregationType == '2') {\n\t\t\t\t\t\tvaluePrices = valuePrices + taxRate;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn taxRate;\n\t\t},\n\t\tgetTaxPercent: function(row) {\n\t\t\tvar taxParams = row.find('.taxParam').val();\n\t\t\tif (taxParams == '' || taxParams == '[]' || taxParams == undefined) return 0;\n\t\t\ttaxParams = JSON.parse(taxParams);\n\t\t\tlet taxPercent = taxParams[taxParams.aggregationType + 'Tax'];\n\t\t\treturn taxPercent ? taxPercent : 0;\n\t\t},\n\t\tgetTaxParams: function(row) {\n\t\t\tvar taxParams = row.find('.taxParam').val();\n\t\t\tif (taxParams == '' || taxParams == '[]' || taxParams == undefined) return false;\n\t\t\treturn JSON.parse(taxParams);\n\t\t},\n\t\tgetQuantityValue: function(row) {\n\t\t\treturn $('.qty', row).getNumberFromValue();\n\t\t},\n\t\tgetUnitPriceValue: function(row) {\n\t\t\treturn $('.unitPrice', row).getNumberFromValue();\n\t\t},\n\t\tgetDiscount: function(row) {\n\t\t\tvar discountParams = row.find('.discountParam').val();\n\t\t\tvar aggregationType = $('.aggregationTypeDiscount').val();\n\t\t\tif (discountParams == '' || discountParams == 'null' || discountParams == '[]' || discountParams == undefined)\n\t\t\t\treturn 0;\n\t\t\tdiscountParams = JSON.parse(discountParams);\n\t\t\tvar valuePrices = this.getTotalPrice(row);\n\t\t\tvar discountRate = 0;\n\t\t\tvar types = discountParams.aggregationType;\n\t\t\tif (typeof types == 'string') {\n\t\t\t\ttypes = [types];\n\t\t\t}\n\t\t\tif (types) {\n\t\t\t\ttypes.forEach(function(entry) {\n\t\t\t\t\tvar discountValue;\n\t\t\t\t\tif (entry == 'individual') {\n\t\t\t\t\t\tdiscountValue = discountParams.individualDiscount;\n\t\t\t\t\t\tvar discountType = discountParams.individualDiscountType;\n\t\t\t\t\t\tif (discountType == 'percentage') {\n\t\t\t\t\t\t\tdiscountRate += valuePrices * (discountValue / 100);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdiscountRate += App.Fields.Double.formatToDb(discountValue);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (entry == 'global') {\n\t\t\t\t\t\tdiscountRate += valuePrices * (App.Fields.Double.formatToDb(discountParams.globalDiscount) / 100);\n\t\t\t\t\t}\n\t\t\t\t\tif (entry == 'group') {\n\t\t\t\t\t\tdiscountRate += valuePrices * (App.Fields.Double.formatToDb(discountParams.groupDiscount) / 100);\n\t\t\t\t\t}\n\t\t\t\t\tif (aggregationType == '2') {\n\t\t\t\t\t\tvaluePrices = valuePrices - discountRate;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn discountRate;\n\t\t},\n\t\tgetNetPrice: function(row) {\n\t\t\treturn this.getTotalPrice(row) - this.getDiscount(row);\n\t\t},\n\t\tgetTotalPrice: function(row) {\n\t\t\treturn this.getQuantityValue(row) * this.getUnitPriceValue(row);\n\t\t},\n\t\tgetGrossPrice: function(row) {\n\t\t\treturn $('.grossPrice', row).getNumberFromValue();\n\t\t},\n\t\tgetPurchase: function(row) {\n\t\t\tvar qty = this.getQuantityValue(row);\n\t\t\tvar element = $('.purchase', row);\n\t\t\tvar purchase = 0;\n\t\t\tif (element.length > 0) {\n\t\t\t\tpurchase = App.Fields.Double.formatToDb(element.val());\n\t\t\t}\n\t\t\treturn purchase * qty;\n\t\t},\n\t\tgetSummaryGrossPrice: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar price = 0;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tprice += thisInstance.getGrossPrice($(this));\n\t\t\t\t});\n\t\t\treturn App.Fields.Double.formatToDb(price);\n\t\t},\n\t\t/**\n\t\t * Set currency\n\t\t * @param {int} val\n\t\t */\n\t\tsetCurrency(val) {\n\t\t\tthis.getInventoryHeadContainer()\n\t\t\t\t.find('.js-currency')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set currency param\n\t\t * @param {string} val json string\n\t\t */\n\t\tsetCurrencyParam(val) {\n\t\t\tthis.getInventoryHeadContainer()\n\t\t\t\t.find('.js-currencyparam')\n\t\t\t\t.val(val);\n\t\t},\n\t\t/**\n\t\t * Set discount mode\n\t\t * @param {int} val\n\t\t */\n\t\tsetDiscountMode(val) {\n\t\t\tthis.getInventoryHeadContainer()\n\t\t\t\t.find('.js-discountmode')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set tax mode\n\t\t * @param {int} val\n\t\t */\n\t\tsetTaxMode(val) {\n\t\t\tthis.getInventoryHeadContainer()\n\t\t\t\t.find('.js-taxmode')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set inventory id\n\t\t * @param {jQuery} row\n\t\t * @param {int} val\n\t\t * @param {string} display\n\t\t */\n\t\tsetName(row, val, display) {\n\t\t\trow\n\t\t\t\t.find('.js-name')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t\trow\n\t\t\t\t.find('.js-name_display')\n\t\t\t\t.val(display)\n\t\t\t\t.attr('readonly', 'true')\n\t\t\t\t.trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set inventory row quantity\n\t\t * @param {jQuery} row\n\t\t * @param {int} val\n\t\t */\n\t\tsetQuantity(row, val) {\n\t\t\trow\n\t\t\t\t.find('.qty')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set unit original (db) value\n\t\t * @param {jQuery} row\n\t\t * @param {string} val\n\t\t * @param {string} display\n\t\t */\n\t\tsetUnit(row, val, display) {\n\t\t\trow\n\t\t\t\t.find('.unit')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t\trow\n\t\t\t\t.find('.unitText')\n\t\t\t\t.text(display)\n\t\t\t\t.trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set subUnit original (db) value\n\t\t * @param {jQuery} row\n\t\t * @param {string} val\n\t\t * @param {string} display\n\t\t */\n\t\tsetSubUnit(row, val, display) {\n\t\t\trow.find('.subunit').val(val);\n\t\t\trow.find('.subunitText').val(display);\n\t\t},\n\t\t/**\n\t\t * Set inventory row comment\n\t\t * @param {jQuery} row\n\t\t * @param {string} val\n\t\t */\n\t\tsetComment(row, val) {\n\t\t\trow\n\t\t\t\t.parent()\n\t\t\t\t.find('[numrowex=' + row.attr('numrow') + ']')\n\t\t\t\t.find('.comment')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t},\n\t\tsetUnitPrice: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\trow\n\t\t\t\t.find('.unitPrice')\n\t\t\t\t.val(val)\n\t\t\t\t.attr('title', val);\n\t\t\treturn this;\n\t\t},\n\t\tsetPurchase: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\trow.find('.purchase').val(val);\n\t\t\treturn this;\n\t\t},\n\t\tsetNetPrice: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.netPriceText', row).text(val);\n\t\t\t$('.netPrice', row).val(val);\n\t\t},\n\t\tsetGrossPrice: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.grossPriceText', row).text(val);\n\t\t\t$('.grossPrice', row).val(val);\n\t\t},\n\t\tsetTotalPrice: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.totalPriceText', row).text(val);\n\t\t\t$('.totalPrice', row).val(val);\n\t\t},\n\t\tsetMargin: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.margin', row).val(val);\n\t\t},\n\t\tsetMarginP: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.marginp', row).val(val);\n\t\t},\n\t\tsetDiscount: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.discount', row).val(val);\n\t\t},\n\t\tsetDiscountParam: function(row, val) {\n\t\t\t$('.discountParam', row).val(JSON.stringify(val));\n\t\t},\n\t\tsetTax: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.tax', row).val(val);\n\t\t},\n\t\tsetTaxPercent: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.js-tax-percent', row).val(val);\n\t\t},\n\t\tsetTaxParam: function(row, val) {\n\t\t\t$('.taxParam', row).val(JSON.stringify(val));\n\t\t},\n\t\tquantityChangeActions: function(row) {\n\t\t\tthis.rowCalculations(row);\n\t\t\tthis.summaryCalculations();\n\t\t},\n\t\trowCalculations: function(row) {\n\t\t\tthis.calculateTotalPrice(row);\n\t\t\tthis.calculateDiscounts(row);\n\t\t\tthis.calculateNetPrice(row);\n\t\t\tthis.calculateTaxes(row);\n\t\t\tthis.calculateGrossPrice(row);\n\t\t\tthis.calculateMargin(row);\n\t\t},\n\t\trowsCalculations: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tthisInstance.quantityChangeActions($(this));\n\t\t\t\t});\n\t\t\tthisInstance.calculateItemNumbers();\n\t\t},\n\t\tcalculateDiscounts: function(row) {\n\t\t\tthis.setDiscount(row, this.getDiscount(row));\n\t\t},\n\t\tcalculateTaxes: function(row) {\n\t\t\tthis.setTax(row, this.getTax(row));\n\t\t\tthis.setTaxPercent(row, this.getTaxPercent(row));\n\t\t},\n\t\tsummaryCalculations: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tthisInstance\n\t\t\t\t.getInventoryItemsContainer()\n\t\t\t\t.find('tfoot .wisableTd')\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tthisInstance.calculatSummary($(this), $(this).data('sumfield'));\n\t\t\t\t});\n\t\t\tthisInstance.calculatDiscountSummary();\n\t\t\tthisInstance.calculatTaxSummary();\n\t\t\tthisInstance.calculatCurrenciesSummary();\n\t\t\tthisInstance.calculatMarginPSummary();\n\t\t},\n\t\tcalculatSummary: function(element, field) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar sum = 0;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tvar element = $(this).find('.' + field);\n\t\t\t\t\tif (element.length > 0) {\n\t\t\t\t\t\tsum += App.Fields.Double.formatToDb(element.val());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\telement.text(App.Fields.Double.formatToDisplay(sum));\n\t\t},\n\t\tcalculatMarginPSummary: function() {\n\t\t\tlet sumRow = this.getInventoryItemsContainer().find('tfoot'),\n\t\t\t\ttotalPriceField =\n\t\t\t\t\tsumRow.find('[data-sumfield=\"netPrice\"]').length > 0\n\t\t\t\t\t\t? sumRow.find('[data-sumfield=\"netPrice\"]')\n\t\t\t\t\t\t: sumRow.find('[data-sumfield=\"totalPrice\"]'),\n\t\t\t\tsumPrice = totalPriceField.getNumberFromText(),\n\t\t\t\tpurchase = 0,\n\t\t\t\tmarginp = 0;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(this.rowClass)\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tlet qty = $(this)\n\t\t\t\t\t\t\t.find('.qty')\n\t\t\t\t\t\t\t.getNumberFromValue(),\n\t\t\t\t\t\tpurchasePrice = $(this)\n\t\t\t\t\t\t\t.find('.purchase')\n\t\t\t\t\t\t\t.getNumberFromValue();\n\t\t\t\t\tif (qty > 0 && purchasePrice > 0) {\n\t\t\t\t\t\tpurchase += qty * purchasePrice;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\tlet subtraction = sumPrice - purchase;\n\t\t\tif (purchase !== 0 && sumPrice !== 0) {\n\t\t\t\tmarginp = (subtraction / sumPrice) * 100;\n\t\t\t}\n\t\t\tsumRow.find('[data-sumfield=\"marginP\"]').text(App.Fields.Double.formatToDisplay(marginp) + '%');\n\t\t},\n\t\tcalculatDiscountSummary: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar discount = thisInstance.getAllDiscount();\n\t\t\tvar container = thisInstance.getInventorySummaryDiscountContainer();\n\t\t\tcontainer.find('input').val(App.Fields.Double.formatToDisplay(discount));\n\t\t},\n\t\tgetAllDiscount: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar discount = 0;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tvar row = $(this);\n\t\t\t\t\tdiscount += thisInstance.getDiscount(row);\n\t\t\t\t});\n\t\t\treturn discount;\n\t\t},\n\t\tcalculatCurrenciesSummary: function() {\n\t\t\tlet container = this.getInventorySummaryCurrenciesContainer(),\n\t\t\t\tselected = $('.js-currency option:selected', this.getInventoryHeadContainer()),\n\t\t\t\tbase = $('.js-currency option[data-base-currency=\"1\"]', this.getInventoryHeadContainer()),\n\t\t\t\tconversionRate = selected.data('conversionRate'),\n\t\t\t\tbaseConversionRate = base.data('conversionRate');\n\t\t\tif (conversionRate == baseConversionRate) {\n\t\t\t\tcontainer.addClass('d-none');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconversionRate = parseFloat(baseConversionRate) / parseFloat(conversionRate);\n\t\t\tcontainer.removeClass('d-none');\n\t\t\tvar taxs = this.getAllTaxs();\n\t\t\tvar sum = 0;\n\t\t\tcontainer.find('.js-panel__body').html('');\n\t\t\t$.each(taxs, function(index, value) {\n\t\t\t\tif (value != undefined) {\n\t\t\t\t\tvalue = value * conversionRate;\n\t\t\t\t\tvar row = container.find('.d-none .form-group').clone();\n\t\t\t\t\trow.find('.percent').text(index + '%');\n\t\t\t\t\trow.find('input').val(App.Fields.Double.formatToDisplay(value));\n\t\t\t\t\trow.appendTo(container.find('.js-panel__body'));\n\t\t\t\t\tsum += value;\n\t\t\t\t}\n\t\t\t});\n\t\t\tcontainer.find('.js-panel__footer input').val(App.Fields.Double.formatToDisplay(sum));\n\t\t},\n\t\tcalculatTaxSummary: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar taxs = thisInstance.getAllTaxs();\n\t\t\tvar container = thisInstance.getInventorySummaryTaxesContainer();\n\t\t\tcontainer.find('.js-panel__body').html('');\n\t\t\tvar sum = 0;\n\t\t\tfor (var index in taxs) {\n\t\t\t\tvar row = container.find('.d-none .form-group').clone();\n\t\t\t\trow.find('.percent').text(App.Fields.Double.formatToDisplay(App.Fields.Double.formatToDb(index)) + '%');\n\t\t\t\trow.find('input').val(App.Fields.Double.formatToDisplay(taxs[index]));\n\t\t\t\trow.appendTo(container.find('.js-panel__body'));\n\t\t\t\tsum += taxs[index];\n\t\t\t}\n\t\t\tcontainer.find('.js-panel__footer input').val(App.Fields.Double.formatToDisplay(sum));\n\t\t},\n\t\tgetAllTaxs: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar tax = [];\n\t\t\tvar typeSummary = $('.aggregationTypeTax').val();\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tvar row = $(this);\n\t\t\t\t\tvar netPrice = thisInstance.getNetPrice(row);\n\t\t\t\t\tvar params = row.find('.taxParam').val();\n\t\t\t\t\tif (params != '' && params != '[]' && params != undefined) {\n\t\t\t\t\t\tvar param = JSON.parse(params);\n\t\t\t\t\t\tif (typeof param.aggregationType == 'string') {\n\t\t\t\t\t\t\tparam.aggregationType = [param.aggregationType];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (param.aggregationType)\n\t\t\t\t\t\t\t$.each(param.aggregationType, function(index, name) {\n\t\t\t\t\t\t\t\tname = name + 'Tax';\n\t\t\t\t\t\t\t\tvar precent = param[name];\n\t\t\t\t\t\t\t\tvar old = 0;\n\t\t\t\t\t\t\t\tif (tax[precent] != undefined) {\n\t\t\t\t\t\t\t\t\told = parseFloat(tax[precent]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvar taxRate = netPrice * (App.Fields.Double.formatToDb(precent) / 100);\n\t\t\t\t\t\t\t\ttax[precent] = old + taxRate;\n\t\t\t\t\t\t\t\tif (typeSummary == '2') {\n\t\t\t\t\t\t\t\t\tnetPrice += taxRate;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\treturn tax;\n\t\t},\n\t\tcalculateNetPrice: function(row) {\n\t\t\tthis.setNetPrice(row, this.getNetPrice(row));\n\t\t},\n\t\tcalculateGrossPrice: function(row) {\n\t\t\tvar netPrice = this.getNetPrice(row);\n\t\t\tif (this.isIndividualTaxMode(row) || this.isGroupTaxMode(row)) {\n\t\t\t\tnetPrice += this.getTax(row);\n\t\t\t}\n\t\t\tthis.setGrossPrice(row, netPrice);\n\t\t},\n\t\tcalculateTotalPrice: function(row) {\n\t\t\tthis.setTotalPrice(row, this.getTotalPrice(row));\n\t\t},\n\t\tcalculateMargin: function(row) {\n\t\t\tvar netPrice;\n\t\t\tif ($('.netPrice', row).length) {\n\t\t\t\tnetPrice = this.getNetPrice(row);\n\t\t\t} else {\n\t\t\t\tnetPrice = this.getTotalPrice(row) - this.getDiscount(row);\n\t\t\t}\n\t\t\tvar purchase = this.getPurchase(row);\n\t\t\tvar margin = netPrice - purchase;\n\t\t\tthis.setMargin(row, margin);\n\t\t\tvar marginp = '0';\n\t\t\tif (purchase !== 0) {\n\t\t\t\tmarginp = (margin / purchase) * 100;\n\t\t\t}\n\t\t\tthis.setMarginP(row, marginp);\n\t\t},\n\t\tcalculateDiscount: function(row, modal) {\n\t\t\tvar netPriceBeforeDiscount = App.Fields.Double.formatToDb(modal.find('.valueTotalPrice').text()),\n\t\t\t\tvaluePrices = netPriceBeforeDiscount,\n\t\t\t\tglobalDiscount = 0,\n\t\t\t\tgroupDiscount = 0,\n\t\t\t\tindividualDiscount = 0,\n\t\t\t\tvalueDiscount = 0;\n\n\t\t\tvar discountsType = modal.find('.discountsType').val();\n\n\t\t\tif (discountsType == '0' || discountsType == '1') {\n\t\t\t\tif (modal.find('.js-active .globalDiscount').length > 0) {\n\t\t\t\t\tglobalDiscount = App.Fields.Double.formatToDb(modal.find('.js-active .globalDiscount').val());\n\t\t\t\t}\n\t\t\t\tif (modal.find('.js-active .individualDiscountType').length > 0) {\n\t\t\t\t\tvar individualTypeDiscount = modal.find('.js-active .individualDiscountType:checked').val();\n\t\t\t\t\tvar value = App.Fields.Double.formatToDb(modal.find('.js-active .individualDiscountValue').val());\n\t\t\t\t\tif (individualTypeDiscount == 'percentage') {\n\t\t\t\t\t\tindividualDiscount = netPriceBeforeDiscount * (value / 100);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tindividualDiscount = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\tmodal.find('.js-active .groupCheckbox').length > 0 &&\n\t\t\t\t\tmodal.find('.js-active .groupCheckbox').prop('checked') == true\n\t\t\t\t) {\n\t\t\t\t\tgroupDiscount = App.Fields.Double.formatToDb(modal.find('.groupValue').val());\n\t\t\t\t\tgroupDiscount = netPriceBeforeDiscount * (groupDiscount / 100);\n\t\t\t\t}\n\n\t\t\t\tvaluePrices = valuePrices * ((100 - globalDiscount) / 100);\n\t\t\t\tvaluePrices = valuePrices - individualDiscount;\n\t\t\t\tvaluePrices = valuePrices - groupDiscount;\n\t\t\t} else if (discountsType == '2') {\n\t\t\t\tmodal.find('.js-active').each(function(index) {\n\t\t\t\t\tvar panel = $(this);\n\t\t\t\t\tif (panel.find('.globalDiscount').length > 0) {\n\t\t\t\t\t\tvar globalDiscount = App.Fields.Double.formatToDb(panel.find('.globalDiscount').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 - globalDiscount) / 100);\n\t\t\t\t\t} else if (panel.find('.groupCheckbox').length > 0 && panel.find('.groupCheckbox').prop('checked') == true) {\n\t\t\t\t\t\tvar groupDiscount = App.Fields.Double.formatToDb(panel.find('.groupValue').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 - groupDiscount) / 100);\n\t\t\t\t\t} else if (panel.find('.individualDiscountType').length > 0) {\n\t\t\t\t\t\tvar value = App.Fields.Double.formatToDb(panel.find('.individualDiscountValue').val());\n\t\t\t\t\t\tif (panel.find('.individualDiscountType[name=\"individualDiscountType\"]:checked').val() == 'percentage') {\n\t\t\t\t\t\t\tvaluePrices = valuePrices * ((100 - value) / 100);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvaluePrices = valuePrices - value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tmodal.find('.valuePrices').text(App.Fields.Double.formatToDisplay(valuePrices));\n\t\t\tmodal.find('.valueDiscount').text(App.Fields.Double.formatToDisplay(netPriceBeforeDiscount - valuePrices));\n\t\t},\n\t\tcalculateTax: function(row, modal) {\n\t\t\tvar netPriceWithoutTax = App.Fields.Double.formatToDb(modal.find('.valueNetPrice').text()),\n\t\t\t\tvaluePrices = netPriceWithoutTax,\n\t\t\t\tglobalTax = 0,\n\t\t\t\tgroupTax = 0,\n\t\t\t\tregionalTax = 0,\n\t\t\t\tindividualTax = 0;\n\n\t\t\tvar taxType = modal.find('.taxsType').val();\n\t\t\tif (taxType == '0' || taxType == '1') {\n\t\t\t\tif (modal.find('.js-active .globalTax').length > 0) {\n\t\t\t\t\tglobalTax = App.Fields.Double.formatToDb(modal.find('.js-active .globalTax').val());\n\t\t\t\t}\n\t\t\t\tif (modal.find('.js-active .individualTaxValue').length > 0) {\n\t\t\t\t\tvar value = App.Fields.Double.formatToDb(modal.find('.js-active .individualTaxValue').val());\n\t\t\t\t\tindividualTax = (value / 100) * valuePrices;\n\t\t\t\t}\n\t\t\t\tif (modal.find('.js-active .groupTax').length > 0) {\n\t\t\t\t\tgroupTax = App.Fields.Double.formatToDb(modal.find('.groupTax').val());\n\t\t\t\t\tgroupTax = netPriceWithoutTax * (groupTax / 100);\n\t\t\t\t}\n\t\t\t\tif (modal.find('.js-active .regionalTax').length > 0) {\n\t\t\t\t\tregionalTax = App.Fields.Double.formatToDb(modal.find('.regionalTax').val());\n\t\t\t\t\tregionalTax = netPriceWithoutTax * (regionalTax / 100);\n\t\t\t\t}\n\n\t\t\t\tvaluePrices = valuePrices * ((100 + globalTax) / 100);\n\t\t\t\tvaluePrices = valuePrices + individualTax;\n\t\t\t\tvaluePrices = valuePrices + groupTax;\n\t\t\t\tvaluePrices = valuePrices + regionalTax;\n\t\t\t} else if (taxType == '2') {\n\t\t\t\tmodal.find('.js-active').each(function(index) {\n\t\t\t\t\tvar panel = $(this);\n\t\t\t\t\tif (panel.find('.globalTax').length > 0) {\n\t\t\t\t\t\tvar globalTax = App.Fields.Double.formatToDb(panel.find('.globalTax').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 + globalTax) / 100);\n\t\t\t\t\t} else if (panel.find('.groupTax').length > 0) {\n\t\t\t\t\t\tvar groupTax = App.Fields.Double.formatToDb(panel.find('.groupTax').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 + groupTax) / 100);\n\t\t\t\t\t} else if (panel.find('.regionalTax').length > 0) {\n\t\t\t\t\t\tvar regionalTax = App.Fields.Double.formatToDb(panel.find('.regionalTax').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 + regionalTax) / 100);\n\t\t\t\t\t} else if (panel.find('.individualTaxValue').length > 0) {\n\t\t\t\t\t\tvar value = App.Fields.Double.formatToDb(panel.find('.individualTaxValue').val());\n\t\t\t\t\t\tvaluePrices = ((value + 100) / 100) * valuePrices;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (netPriceWithoutTax) {\n\t\t\t\tlet taxValue = ((valuePrices - netPriceWithoutTax) / netPriceWithoutTax) * 100;\n\t\t\t\tmodal.find('.js-tax-value').text(App.Fields.Double.formatToDisplay(taxValue));\n\t\t\t}\n\t\t\tmodal.find('.valuePrices').text(App.Fields.Double.formatToDisplay(valuePrices));\n\t\t\tmodal.find('.valueTax').text(App.Fields.Double.formatToDisplay(valuePrices - netPriceWithoutTax));\n\t\t},\n\t\tupdateRowSequence: function() {\n\t\t\tvar items = this.getInventoryItemsContainer();\n\t\t\titems.find(this.rowClass).each(function(index) {\n\t\t\t\t$(this)\n\t\t\t\t\t.find('.sequence')\n\t\t\t\t\t.val(index + 1);\n\t\t\t});\n\t\t},\n\t\tregisterInventorySaveData: function() {\n\t\t\tconst thisInstance = this;\n\t\t\tthisInstance.form.on(Vtiger_Edit_Js.recordPreSave, function(e, data) {\n\t\t\t\tthisInstance.syncHeaderData();\n\t\t\t\tif (!thisInstance.checkLimits(thisInstance.form)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tlet table = thisInstance.form.find('#blackIthemTable');\n\t\t\t\ttable.find('[name]').removeAttr('name');\n\t\t\t});\n\t\t},\n\t\tsyncHeaderData() {\n\t\t\tlet header = this.getInventoryHeadContainer();\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find('.js-sync')\n\t\t\t\t.each(function() {\n\t\t\t\t\tlet element = $(this);\n\t\t\t\t\telement.val(header.find('.js-' + element.data('syncId')).val());\n\t\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function which will be used to handle price book popup\n\t\t * @params :  element - popup image element\n\t\t */\n\t\tpricebooksModalHandler: function(element) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet lineItemRow = element.closest(this.rowClass);\n\t\t\tlet rowName = lineItemRow.find('.rowName');\n\t\t\tapp.showRecordsList(\n\t\t\t\t{\n\t\t\t\t\tmodule: 'PriceBooks',\n\t\t\t\t\tsrc_module: $('[name=\"popupReferenceModule\"]', rowName).val(),\n\t\t\t\t\tsrc_record: $('.sourceField', rowName).val(),\n\t\t\t\t\tsrc_field: $('[name=\"popupReferenceModule\"]', rowName).data('field'),\n\t\t\t\t\tcurrency_id: thisInstance.getCurrency() || CONFIG.defaultCurrencyId\n\t\t\t\t},\n\t\t\t\t(modal, instance) => {\n\t\t\t\t\tinstance.setSelectEvent(responseData => {\n\t\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\t\tmodule: 'PriceBooks',\n\t\t\t\t\t\t\taction: 'ProductListPrice',\n\t\t\t\t\t\t\trecord: responseData.id,\n\t\t\t\t\t\t\tsrc_record: $('.sourceField', rowName).val()\n\t\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\t\tif (data.result) {\n\t\t\t\t\t\t\t\tthisInstance.setUnitPrice(lineItemRow, data.result);\n\t\t\t\t\t\t\t\tthisInstance.quantityChangeActions(lineItemRow);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tapp.errorLog('Incorrect data', responseData);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\tsubProductsCashe: [],\n\t\tloadSubProducts: function(parentRow, indicator) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar recordId = $('input.sourceField', parentRow).val();\n\t\t\tvar recordModule = parentRow.find('.rowName input[name=\"popupReferenceModule\"]').val();\n\t\t\tthisInstance.removeSubProducts(parentRow);\n\t\t\tif (recordId == '0' || recordId == '' || $.inArray(recordModule, ['Products', 'Services']) < 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (thisInstance.subProductsCashe[recordId]) {\n\t\t\t\tthisInstance.addSubProducts(parentRow, thisInstance.subProductsCashe[recordId]);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar subProrductParams = {\n\t\t\t\tmodule: 'Products',\n\t\t\t\taction: 'SubProducts',\n\t\t\t\trecord: recordId\n\t\t\t};\n\t\t\tif (indicator) {\n\t\t\t\tvar progressInstace = $.progressIndicator();\n\t\t\t}\n\t\t\tAppConnector.request(subProrductParams)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tvar responseData = data.result;\n\t\t\t\t\tthisInstance.subProductsCashe[recordId] = responseData;\n\t\t\t\t\tthisInstance.addSubProducts(parentRow, responseData);\n\t\t\t\t\tif (progressInstace) {\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fail(function(error, err) {\n\t\t\t\t\tif (progressInstace) {\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\tremoveSubProducts: function(parentRow) {\n\t\t\tvar subProductsContainer = $('.subProductsContainer ul', parentRow);\n\t\t\tsubProductsContainer.find('li').remove();\n\t\t},\n\t\taddSubProducts: function(parentRow, responseData) {\n\t\t\tvar subProductsContainer = $('.subProductsContainer ul', parentRow);\n\t\t\tfor (var id in responseData) {\n\t\t\t\tvar priductText = $('<li>').text(responseData[id]);\n\t\t\t\tsubProductsContainer.append(priductText);\n\t\t\t}\n\t\t},\n\t\tmapResultsToFields: function(referenceModule, parentRow, responseData) {\n\t\t\tlet unit,\n\t\t\t\tunitPrice,\n\t\t\t\ttaxParam = [];\n\t\t\tvar thisInstance = this;\n\t\t\tvar isGroupTax = thisInstance.isGroupTaxMode();\n\t\t\tfor (var id in responseData) {\n\t\t\t\tvar recordData = responseData[id];\n\t\t\t\tvar description = recordData.description;\n\t\t\t\tvar unitPriceValues = recordData.unitPriceValues;\n\t\t\t\tvar unitPriceValuesJson = JSON.stringify(unitPriceValues);\n\t\t\t\t// Load taxses detail\n\t\t\t\tif (isGroupTax) {\n\t\t\t\t\tvar parameters = parentRow.closest('.inventoryItems').data('taxParam');\n\t\t\t\t\tif (parameters) {\n\t\t\t\t\t\ttaxParam = JSON.parse(parameters);\n\t\t\t\t\t}\n\t\t\t\t} else if (recordData['taxes']) {\n\t\t\t\t\ttaxParam = { aggregationType: recordData.taxes.type };\n\t\t\t\t\ttaxParam[recordData.taxes.type + 'Tax'] = recordData.taxes.value;\n\t\t\t\t}\n\t\t\t\tif (recordData['taxes']) {\n\t\t\t\t\tparentRow.find('.js-tax').attr('data-default-tax', App.Fields.Double.formatToDisplay(recordData.taxes.value));\n\t\t\t\t}\n\t\t\t\tthisInstance.setPurchase(parentRow, recordData.purchase);\n\t\t\t\tthisInstance.setTaxParam(parentRow, taxParam);\n\t\t\t\tthisInstance.setTax(parentRow, 0);\n\t\t\t\tthisInstance.setTaxPercent(parentRow, 0);\n\t\t\t\t// Load auto fields\n\t\t\t\tfor (var field in recordData['autoFields']) {\n\t\t\t\t\tparentRow.find('input.' + field).val(recordData['autoFields'][field]);\n\t\t\t\t\tif (recordData['autoFields'][field + 'Text']) {\n\t\t\t\t\t\tparentRow.find('.' + field + 'Text').text(recordData['autoFields'][field + 'Text']);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (recordData.price !== undefined) {\n\t\t\t\t\tthisInstance.setUnitPrice(parentRow, recordData.price);\n\t\t\t\t}\n\t\t\t\tif (unitPriceValuesJson !== undefined) {\n\t\t\t\t\t$('input.unitPrice', parentRow).attr('list-info', unitPriceValuesJson);\n\t\t\t\t}\n\t\t\t\tvar commentElement = $('textarea.commentTextarea', parentRow.next());\n\t\t\t\tvar editorInstance = CKEDITOR.instances[commentElement.attr('id')];\n\t\t\t\tif (editorInstance) {\n\t\t\t\t\teditorInstance.setData(description);\n\t\t\t\t} else {\n\t\t\t\t\tcommentElement.val(description);\n\t\t\t\t}\n\t\t\t\tif (typeof recordData['autoFields']['unit'] !== 'undefined') {\n\t\t\t\t\tunit = recordData['autoFields']['unit'];\n\t\t\t\t}\n\t\t\t\tthis.triggerQtyParam(unit, recordData.qtyPerUnit, parentRow);\n\t\t\t}\n\t\t\tif (referenceModule === 'Products') {\n\t\t\t\tthisInstance.loadSubProducts(parentRow, true);\n\t\t\t}\n\t\t\tthisInstance.quantityChangeActions(parentRow);\n\t\t},\n\t\t/**\n\t\t * Update qtyparam\n\t\t * @param {null|string} unit\n\t\t * @param int perUnit\n\t\t * @param {jQuery} parentRow\n\t\t */\n\t\ttriggerQtyParam(unit, perUnit, parentRow) {\n\t\t\tlet validationEngine;\n\t\t\tswitch (unit) {\n\t\t\t\tdefault:\n\t\t\t\t\t$('.qtyParamInfo', parentRow).addClass('d-none');\n\t\t\t\t\tvalidationEngine = 'validate[required,funcCall[Vtiger_NumberUserFormat_Validator_Js.invokeValidation]]';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'pack':\n\t\t\t\t\t$('.qtyParamInfo', parentRow)\n\t\t\t\t\t\t.removeClass('d-none')\n\t\t\t\t\t\t.removeClass('active');\n\t\t\t\t\t$('.qtyParamInfo', parentRow).attr('data-content', perUnit);\n\t\t\t\t\tvalidationEngine = 'validate[required,funcCall[Vtiger_WholeNumber_Validator_Js.invokeValidation]]';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'pcs':\n\t\t\t\t\t$('.qtyParamInfo', parentRow).addClass('d-none');\n\t\t\t\t\tvalidationEngine = 'validate[required,funcCall[Vtiger_WholeNumber_Validator_Js.invokeValidation]]';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t$('input.qty', parentRow).attr('data-validation-engine', validationEngine);\n\t\t},\n\t\tsaveDiscountsParameters: function(parentRow, modal) {\n\t\t\tvar thisInstance = this;\n\t\t\tlet info = {};\n\t\t\tlet typeName = 'aggregationType';\n\t\t\tlet panels = modal.find('[name=\"' + typeName + '\"]:checked');\n\t\t\tinfo[typeName] = [];\n\t\t\tpanels.each(function(i) {\n\t\t\t\tlet type = $(this).val(),\n\t\t\t\t\tcontainer = $(this).closest('.js-panel');\n\t\t\t\tif (panels.length > 1) {\n\t\t\t\t\tinfo[typeName].push(type);\n\t\t\t\t} else {\n\t\t\t\t\tinfo[typeName] = type;\n\t\t\t\t}\n\t\t\t\tcontainer.find('[name=\"' + type + 'Discount\"]').each(function() {\n\t\t\t\t\tlet param = type + 'Discount';\n\t\t\t\t\tlet element = $(this);\n\t\t\t\t\tif ('global' === type) {\n\t\t\t\t\t\tinfo[param] = element.val();\n\t\t\t\t\t} else if (\n\t\t\t\t\t\t'group' === type &&\n\t\t\t\t\t\telement\n\t\t\t\t\t\t\t.closest('.input-group')\n\t\t\t\t\t\t\t.find('.groupCheckbox')\n\t\t\t\t\t\t\t.prop('checked')\n\t\t\t\t\t) {\n\t\t\t\t\t\tinfo[param] = App.Fields.Double.formatToDb(element.val());\n\t\t\t\t\t} else if ('individual' === type) {\n\t\t\t\t\t\tlet name = 'individualDiscountType';\n\t\t\t\t\t\tinfo[name] = container.find('[name=\"' + name + '\"]:checked').val();\n\t\t\t\t\t\tinfo[param] = App.Fields.Double.formatToDb(element.val());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tthisInstance.setDiscountParam($('#blackIthemTable'), info);\n\t\t\tthisInstance.setDiscountParam(parentRow, info);\n\t\t},\n\t\tsaveTaxsParameters: function(parentRow, modal) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar info = {};\n\t\t\tvar extend = ['aggregationType', 'groupCheckbox', 'individualTaxType'];\n\t\t\t$.each(thisInstance.taxModalFields, function(index, param) {\n\t\t\t\tif ($.inArray(param, extend) >= 0) {\n\t\t\t\t\tif (modal.find('[name=\"' + param + '\"]:checked').length > 1) {\n\t\t\t\t\t\tinfo[param] = [];\n\t\t\t\t\t\tmodal.find('[name=\"' + param + '\"]:checked').each(function(index) {\n\t\t\t\t\t\t\tinfo[param].push($(this).val());\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinfo[param] = modal.find('[name=\"' + param + '\"]:checked').val();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tinfo[param] = App.Fields.Double.formatToDb(modal.find('[name=\"' + param + '\"]').val());\n\t\t\t\t}\n\t\t\t});\n\t\t\tparentRow.data('taxParam', JSON.stringify(info));\n\t\t\tthisInstance.setTaxParam(parentRow, info);\n\t\t\tthisInstance.setTaxParam($('#blackIthemTable'), info);\n\t\t},\n\t\tshowExpandedRow: function(row) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar items = thisInstance.getInventoryItemsContainer();\n\t\t\tvar inventoryRowExpanded = items.find('[numrowex=\"' + row.attr('numrow') + '\"]');\n\t\t\tvar element = row.find('.toggleVisibility');\n\t\t\telement.data('status', '1');\n\t\t\tinventoryRowExpanded.removeClass('d-none');\n\t\t\tvar listInstance = Vtiger_Edit_Js.getInstance();\n\t\t\t$.each(inventoryRowExpanded.find('.js-editor'), function(key, data) {\n\t\t\t\tlistInstance.loadEditorElement($(data));\n\t\t\t});\n\t\t},\n\t\thideExpandedRow: function(row) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar items = thisInstance.getInventoryItemsContainer();\n\t\t\tvar inventoryRowExpanded = items.find('[numrowex=\"' + row.attr('numrow') + '\"]');\n\t\t\tvar element = row.find('.toggleVisibility');\n\t\t\telement.data('status', '0');\n\t\t\tinventoryRowExpanded.addClass('d-none');\n\t\t\t$.each(inventoryRowExpanded.find('.js-editor'), function(key, data) {\n\t\t\t\tvar editorInstance = CKEDITOR.instances[$(data).attr('id')];\n\t\t\t\tif (editorInstance) {\n\t\t\t\t\teditorInstance.destroy();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tinitDiscountsParameters: function(parentRow, modal) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar parameters = parentRow.find('.discountParam').val();\n\t\t\tif (parameters == '' || parameters == undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tparameters = JSON.parse(parameters);\n\t\t\t$.each(thisInstance.discountModalFields, function(index, param) {\n\t\t\t\tlet parameter = parameters[param];\n\t\t\t\tlet field = modal.find('[name=\"' + param + '\"]');\n\t\t\t\tif (field.attr('type') == 'checkbox' || field.attr('type') == 'radio') {\n\t\t\t\t\tif ('groupCheckbox' === param && parameters['groupDiscount'] !== undefined) {\n\t\t\t\t\t\tfield.prop('checked', true);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tvar array = parameter;\n\t\t\t\t\tif (!$.isArray(array)) {\n\t\t\t\t\t\tarray = [array];\n\t\t\t\t\t}\n\t\t\t\t\t$.each(array, function(index, arrayValue) {\n\t\t\t\t\t\tvar value = field.filter('[value=\"' + arrayValue + '\"]').prop('checked', true);\n\t\t\t\t\t\tif (param == 'aggregationType') {\n\t\t\t\t\t\t\tvalue\n\t\t\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\t\t\tvalue.closest('.js-panel').addClass('js-active');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else if (field.prop('tagName') == 'SELECT') {\n\t\t\t\t\tfield\n\t\t\t\t\t\t.find('option[value=\"' + parameter + '\"]')\n\t\t\t\t\t\t.prop('selected', 'selected')\n\t\t\t\t\t\t.change();\n\t\t\t\t} else if (!field.prop('readonly')) {\n\t\t\t\t\tfield.val(parameter);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthisInstance.calculateDiscount(parentRow, modal);\n\t\t},\n\t\tinitTaxParameters: function(parentRow, modal) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet parameters;\n\t\t\tif (parentRow.data('taxParam')) {\n\t\t\t\tparameters = parentRow.data('taxParam');\n\t\t\t} else {\n\t\t\t\tparameters = parentRow.find('.taxParam').val();\n\t\t\t}\n\t\t\tif (!parameters) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tparameters = JSON.parse(parameters.toString());\n\t\t\t$.each(thisInstance.taxModalFields, function(index, param) {\n\t\t\t\tlet parameter = parameters[param],\n\t\t\t\t\tfield = modal.find('[name=\"' + param + '\"]');\n\n\t\t\t\tif (field.attr('type') === 'checkbox' || field.attr('type') === 'radio') {\n\t\t\t\t\tlet array = parameter,\n\t\t\t\t\t\tvalue;\n\t\t\t\t\tif (!$.isArray(array)) {\n\t\t\t\t\t\tarray = [array];\n\t\t\t\t\t}\n\t\t\t\t\t$.each(array, function(index, arrayValue) {\n\t\t\t\t\t\tvalue = field.filter('[value=\"' + arrayValue + '\"]').prop('checked', true);\n\t\t\t\t\t\tif (param === 'aggregationType') {\n\t\t\t\t\t\t\tvalue\n\t\t\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\t\t\tvalue.closest('.js-panel').addClass('js-active');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else if (field.prop('tagName') === 'SELECT') {\n\t\t\t\t\tfield\n\t\t\t\t\t\t.find('option[value=\"' + parameter + '\"]')\n\t\t\t\t\t\t.prop('selected', 'selected')\n\t\t\t\t\t\t.change();\n\t\t\t\t} else {\n\t\t\t\t\tlet input = modal.find('[name=\"' + param + '\"]');\n\t\t\t\t\tinput.val(parameter);\n\t\t\t\t\tif (param === 'individualTax') {\n\t\t\t\t\t\tinput.formatNumber();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tthisInstance.calculateTax(parentRow, modal);\n\t\t},\n\t\tlimitEnableSave: false,\n\t\tcheckLimits: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar account = thisInstance.getAccountId();\n\t\t\tvar limit = parseInt(app.getMainParams('inventoryLimit'));\n\t\t\tvar response = true;\n\n\t\t\tif (account == '' || thisInstance.limitEnableSave || !limit) {\n\t\t\t\treturn response;\n\t\t\t}\n\n\t\t\tvar params = {};\n\t\t\tparams.data = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'Inventory',\n\t\t\t\tmode: 'checkLimits',\n\t\t\t\trecord: account,\n\t\t\t\tcurrency: thisInstance.getCurrency(),\n\t\t\t\tprice: thisInstance.getSummaryGrossPrice()\n\t\t\t};\n\t\t\tparams.async = false;\n\t\t\tparams.dataType = 'json';\n\t\t\tvar progressInstace = $.progressIndicator();\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\tif (data.result.status == false) {\n\t\t\t\t\t\tapp.showModalWindow(data.result.html, function(data) {});\n\t\t\t\t\t\tresponse = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fail(function(error, err) {\n\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t});\n\t\t\treturn response;\n\t\t},\n\t\tcurrencyChangeActions: function(select, option) {\n\t\t\tif (option.data('baseCurrency') !== select.val()) {\n\t\t\t\tthis.showCurrencyChangeModal(select, option);\n\t\t\t} else {\n\t\t\t\tthis.currencyConvertValues(select, option);\n\t\t\t\tselect.data('oldValue', select.val());\n\t\t\t}\n\t\t},\n\t\tshowCurrencyChangeModal: function(select, option) {\n\t\t\tvar thisInstance = this;\n\t\t\tif (thisInstance.lockCurrencyChange == true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthisInstance.lockCurrencyChange = true;\n\t\t\tvar block = select.closest('th');\n\t\t\tvar modal = block.find('.modelContainer').clone();\n\t\t\tapp.showModalWindow(modal, function(data) {\n\t\t\t\tvar modal = $(data);\n\t\t\t\tvar currencyParam = JSON.parse(block.find('.js-currencyparam').val());\n\n\t\t\t\tif (currencyParam != false) {\n\t\t\t\t\tif (typeof currencyParam[option.val()] === 'undefined') {\n\t\t\t\t\t\tvar defaultCurrencyParams = {\n\t\t\t\t\t\t\tvalue: 1,\n\t\t\t\t\t\t\tdate: ''\n\t\t\t\t\t\t};\n\t\t\t\t\t\tcurrencyParam[option.val()] = defaultCurrencyParams;\n\t\t\t\t\t}\n\t\t\t\t\tmodal.find('.currencyName').text(option.text());\n\t\t\t\t\tmodal.find('.currencyRate').val(currencyParam[option.val()]['value']);\n\t\t\t\t\tmodal.find('.currencyDate').text(currencyParam[option.val()]['date']);\n\t\t\t\t}\n\t\t\t\tmodal\n\t\t\t\t\t.on('click', 'button[type=\"submit\"]', function(e) {\n\t\t\t\t\t\tvar rate = modal.find('.currencyRate').val();\n\t\t\t\t\t\tvar value = App.Fields.Double.formatToDb(rate);\n\t\t\t\t\t\tvar conversionRate = 1 / App.Fields.Double.formatToDb(rate);\n\n\t\t\t\t\t\toption.data('conversionRate', conversionRate);\n\t\t\t\t\t\tcurrencyParam[option.val()] = {\n\t\t\t\t\t\t\tdate: option.data('conversionDate'),\n\t\t\t\t\t\t\tvalue: value.toString(),\n\t\t\t\t\t\t\tconversion: conversionRate.toString()\n\t\t\t\t\t\t};\n\t\t\t\t\t\tblock.find('.js-currencyparam').val(JSON.stringify(currencyParam));\n\n\t\t\t\t\t\tthisInstance.currencyConvertValues(select, option);\n\t\t\t\t\t\tselect.data('oldValue', select.val());\n\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t\tthisInstance.lockCurrencyChange = false;\n\t\t\t\t\t})\n\t\t\t\t\t.one('hidden.bs.modal', function() {\n\t\t\t\t\t\tselect.val(select.data('oldValue')).change();\n\t\t\t\t\t\tthisInstance.lockCurrencyChange = false;\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tcurrencyConvertValues: function(select, selected) {\n\t\t\tvar thisInstance = this;\n\n\t\t\tvar previous = select.find('option[value=\"' + select.data('oldValue') + '\"]');\n\t\t\tvar conversionRate = selected.data('conversionRate');\n\t\t\tvar prevConversionRate = previous.data('conversionRate');\n\t\t\tconversionRate = parseFloat(conversionRate) / parseFloat(prevConversionRate);\n\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tvar row = $(this);\n\n\t\t\t\t\tthisInstance.setUnitPrice(\n\t\t\t\t\t\trow,\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(thisInstance.getUnitPriceValue(row) * conversionRate)\n\t\t\t\t\t);\n\t\t\t\t\tthisInstance.setDiscount(row, App.Fields.Double.formatToDb(thisInstance.getDiscount(row) * conversionRate));\n\t\t\t\t\tthisInstance.setTax(row, App.Fields.Double.formatToDb(thisInstance.getTax(row) * conversionRate));\n\t\t\t\t\tthisInstance.quantityChangeActions(row);\n\t\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Set up all row data that comes from request\n\t\t * @param {jQuery} row\n\t\t * @param {object} rowData\n\t\t */\n\t\tsetRowData(row, rowData) {\n\t\t\tthis.setName(row, rowData.name, rowData.info.name);\n\t\t\tthis.setQuantity(row, rowData.qty);\n\t\t\tthis.setUnit(row, rowData.info.autoFields.unit, rowData.info.autoFields.unitText);\n\t\t\tif (typeof rowData.info.autoFields !== 'undefined' && typeof rowData.info.autoFields.subunit !== 'undefined') {\n\t\t\t\tthis.setSubUnit(row, rowData.info.autoFields.subunit, rowData.info.autoFields.subunitText);\n\t\t\t}\n\t\t\tthis.setComment(row, rowData.comment1);\n\t\t\tthis.setUnitPrice(row, rowData.price);\n\t\t\tthis.setNetPrice(row, rowData.net);\n\t\t\tthis.setGrossPrice(row, rowData.gross);\n\t\t\tthis.setTotalPrice(row, rowData.total);\n\t\t\tlet discountParam = rowData.discountparam || null;\n\t\t\tthis.setDiscountParam(row, JSON.parse(discountParam));\n\t\t\tthis.setDiscount(row, rowData.discount);\n\t\t\tthis.setTaxParam(row, JSON.parse(rowData.taxparam));\n\t\t\tthis.setTax(row, rowData.tax);\n\t\t\tthis.setTaxPercent(row, rowData.tax_percent);\n\t\t},\n\t\t/**\n\t\t * Add new row to inventory list\n\t\t * @param {string} module\n\t\t * @param {string} baseTableId\n\t\t * @param {object} rowData [optional]\n\t\t */\n\t\taddItem(module, baseTableId, rowData = false) {\n\t\t\tconst items = this.getInventoryItemsContainer();\n\t\t\tlet newRow = this.getBasicRow();\n\t\t\tconst sequenceNumber = this.getNextLineItemRowNumber();\n\t\t\tconst replaced = newRow.html().replace(/\\_NUM_/g, sequenceNumber);\n\t\t\tconst moduleLbls = newRow.data('moduleLbls');\n\t\t\tnewRow.html(replaced);\n\t\t\tnewRow = newRow.children().appendTo(items.find('.js-inventory-items-body'));\n\t\t\tnewRow\n\t\t\t\t.find('.rowName input[name=\"popupReferenceModule\"]')\n\t\t\t\t.val(module)\n\t\t\t\t.data('field', baseTableId);\n\t\t\tnewRow\n\t\t\t\t.find('.js-module-icon')\n\t\t\t\t.removeClass()\n\t\t\t\t.addClass(`userIcon-${module}`);\n\t\t\tnewRow.find('.rowName span.input-group-text').attr('data-content', moduleLbls[module]);\n\t\t\tnewRow.find('.colPicklistField select').each(function(index, select) {\n\t\t\t\tselect = $(select);\n\t\t\t\tselect.find('option').each(function(index, option) {\n\t\t\t\t\toption = $(option);\n\t\t\t\t\tif (option.data('module') !== module) {\n\t\t\t\t\t\toption.remove();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.initItem(newRow);\n\t\t\tVtiger_Edit_Js.getInstance().registerAutoCompleteFields(newRow);\n\t\t\tif (rowData) {\n\t\t\t\tthis.setRowData(newRow, rowData);\n\t\t\t\tthis.quantityChangeActions(newRow);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Register add item button click\n\t\t * @param {jQuery} container\n\t\t */\n\t\tregisterAddItem() {\n\t\t\tconst thisInstance = this;\n\t\t\tconst itemsHeader = thisInstance.getInventoryHeadContainer();\n\t\t\titemsHeader.find('.js-inv-add-item').on('click', function(e) {\n\t\t\t\tconst btn = $(this);\n\t\t\t\tthisInstance.addItem(btn.data('module'), btn.data('field'));\n\t\t\t});\n\t\t},\n\t\tregisterSortableItems: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar items = thisInstance.getInventoryItemsContainer();\n\t\t\titems.sortable({\n\t\t\t\thandle: '.dragHandle',\n\t\t\t\titems: thisInstance.rowClass,\n\t\t\t\trevert: true,\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\tplaceholder: 'ui-state-highlight',\n\t\t\t\thelper: function(e, ui) {\n\t\t\t\t\tui.children().each(function(index, element) {\n\t\t\t\t\t\telement = $(element);\n\t\t\t\t\t\telement.width(element.width());\n\t\t\t\t\t});\n\t\t\t\t\treturn ui;\n\t\t\t\t},\n\t\t\t\tstart: function(event, ui) {\n\t\t\t\t\titems.find(thisInstance.rowClass).each(function(index, element) {\n\t\t\t\t\t\tvar row = $(element);\n\t\t\t\t\t\tthisInstance.hideExpandedRow(row);\n\t\t\t\t\t});\n\t\t\t\t\tui.item.startPos = ui.item.index();\n\t\t\t\t},\n\t\t\t\tstop: function(event, ui) {\n\t\t\t\t\tvar numrow = $(ui.item).attr('numrow');\n\t\t\t\t\tvar child = items\n\t\t\t\t\t\t.find('.numRow' + numrow)\n\t\t\t\t\t\t.remove()\n\t\t\t\t\t\t.clone();\n\t\t\t\t\titems.find('[numrow=\"' + numrow + '\"]').after(child);\n\t\t\t\t\tif (ui.item.startPos < ui.item.index()) {\n\t\t\t\t\t\tchild = items\n\t\t\t\t\t\t\t.find('.numRow' + numrow)\n\t\t\t\t\t\t\t.next()\n\t\t\t\t\t\t\t.remove()\n\t\t\t\t\t\t\t.clone();\n\t\t\t\t\t\titems.find('[numrow=\"' + numrow + '\"]').before(child);\n\t\t\t\t\t}\n\t\t\t\t\tthisInstance.updateRowSequence();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterShowHideExpanded: function() {\n\t\t\tconst thisInstance = this;\n\t\t\tthisInstance.form.on('click', '.toggleVisibility', function(e) {\n\t\t\t\tvar element = $(e.currentTarget);\n\t\t\t\tvar row = thisInstance.getClosestRow(element);\n\t\t\t\tif (element.data('status') == 0) {\n\t\t\t\t\tthisInstance.showExpandedRow(row);\n\t\t\t\t} else {\n\t\t\t\t\tthisInstance.hideExpandedRow(row);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterPriceBookModal: function(container) {\n\t\t\tvar thisInstance = this;\n\t\t\tcontainer.find('.js-price-book-modal').on('click', function(e) {\n\t\t\t\tvar element = $(e.currentTarget);\n\t\t\t\tvar response = thisInstance.isRecordSelected(element);\n\t\t\t\tif (response == true) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthisInstance.pricebooksModalHandler(element);\n\t\t\t});\n\t\t},\n\t\tregisterRowChangeEvent: function(container) {\n\t\t\tcontainer.on('focusout', '.qty', e => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\telement.formatNumber();\n\t\t\t\tthis.quantityChangeActions(this.getClosestRow(element));\n\t\t\t});\n\t\t\tcontainer.on('focusout', '.unitPrice', e => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\telement.formatNumber();\n\t\t\t\tthis.quantityChangeActions(this.getClosestRow(element));\n\t\t\t});\n\t\t\tcontainer.on('focusout', '.purchase', e => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\telement.formatNumber();\n\t\t\t\tthis.quantityChangeActions(this.getClosestRow(element));\n\t\t\t});\n\t\t\tvar headContainer = this.getInventoryHeadContainer();\n\t\t\theadContainer.on('change', '.js-taxmode', e => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tthis.showIndividualTax(this.getClosestRow(element));\n\t\t\t\tthis.rowsCalculations();\n\t\t\t});\n\t\t\theadContainer.on('change', '.js-discountmode', e => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tthis.showIndividualDiscount(this.getClosestRow(element));\n\t\t\t\tthis.rowsCalculations();\n\t\t\t});\n\t\t},\n\t\tregisterSubProducts: function() {\n\t\t\tconst thisInstance = this;\n\t\t\tthisInstance.form.find('.inventoryItems ' + thisInstance.rowClass).each(function(index) {\n\t\t\t\tthisInstance.loadSubProducts($(this), false);\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Register clear reference selection\n\t\t */\n\t\tregisterClearReferenceSelection() {\n\t\t\tthis.form.on('click', '.clearReferenceSelection', e => {\n\t\t\t\tconst referenceGroup = $(e.currentTarget).closest('div.referenceGroup');\n\t\t\t\tif (referenceGroup.length) {\n\t\t\t\t\treferenceGroup\n\t\t\t\t\t\t.find('input[id$=\"_display\"]')\n\t\t\t\t\t\t.val('')\n\t\t\t\t\t\t.removeAttr('readonly');\n\t\t\t\t} else {\n\t\t\t\t\tconst row = this.getClosestRow($(e.currentTarget));\n\t\t\t\t\tthis.removeSubProducts(row);\n\t\t\t\t\trow\n\t\t\t\t\t\t.find('.unitPrice,.tax,.discount,.margin,.purchase,.js-tax-percent')\n\t\t\t\t\t\t.val(App.Fields.Double.formatToDisplay(0));\n\t\t\t\t\trow.find('.qty').val(1);\n\t\t\t\t\trow.find('textarea,.valueVal').val('');\n\t\t\t\t\trow.find('.valueText').text('');\n\t\t\t\t\trow.find('.qtyParamInfo').addClass('d-none');\n\t\t\t\t\trow\n\t\t\t\t\t\t.find('.recordLabel')\n\t\t\t\t\t\t.val('')\n\t\t\t\t\t\t.removeAttr('readonly');\n\t\t\t\t\tif (!this.isGroupTaxMode()) {\n\t\t\t\t\t\tthis.setTaxParam(row, []);\n\t\t\t\t\t}\n\t\t\t\t\tthis.quantityChangeActions(row);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterDeleteLineItemEvent: function(container) {\n\t\t\tvar thisInstance = this;\n\t\t\tcontainer.on('click', '.deleteRow', function(e) {\n\t\t\t\tlet num = thisInstance.getClosestRow($(e.currentTarget)).attr('numrow');\n\t\t\t\tthisInstance\n\t\t\t\t\t.getInventoryItemsContainer()\n\t\t\t\t\t.find('[numrow=\"' + num + '\"], [numrowex=\"' + num + '\"]')\n\t\t\t\t\t.remove();\n\t\t\t\tthisInstance.checkDeleteIcon();\n\t\t\t\tthisInstance.rowsCalculations();\n\t\t\t\tif (thisInstance.getInventoryItemsContainer().find('.inventoryRow').length === 0) {\n\t\t\t\t\t$('#inventoryItemsNo').val(0);\n\t\t\t\t}\n\t\t\t\tthisInstance.updateRowSequence();\n\t\t\t});\n\t\t},\n\t\tregisterChangeDiscount: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tthisInstance.form.on('click', '.changeDiscount', function(e) {\n\t\t\t\tvar parentRow;\n\t\t\t\tvar element = $(e.currentTarget);\n\t\t\t\tvar params = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Inventory',\n\t\t\t\t\tmode: 'showDiscounts',\n\t\t\t\t\tcurrency: thisInstance.getCurrency(),\n\t\t\t\t\trelatedRecord: thisInstance.getAccountId()\n\t\t\t\t};\n\t\t\t\tif (element.hasClass('groupDiscount')) {\n\t\t\t\t\tparentRow = thisInstance.getInventoryItemsContainer();\n\t\t\t\t\tif (parentRow.find('tfoot .colTotalPrice').length != 0) {\n\t\t\t\t\t\tparams.totalPrice = App.Fields.Double.formatToDb(parentRow.find('tfoot .colTotalPrice').text());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tparams.totalPrice = 0;\n\t\t\t\t\t}\n\t\t\t\t\tparams.discountType = 1;\n\t\t\t\t} else {\n\t\t\t\t\tparentRow = element.closest(thisInstance.rowClass);\n\t\t\t\t\tparams.totalPrice = thisInstance.getTotalPrice(parentRow);\n\t\t\t\t\tparams.discountType = 0;\n\t\t\t\t}\n\n\t\t\t\tvar progressInstace = $.progressIndicator();\n\t\t\t\tAppConnector.request(params)\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tapp.showModalWindow(data, function(data) {\n\t\t\t\t\t\t\tthisInstance.initDiscountsParameters(parentRow, $(data));\n\t\t\t\t\t\t\tthisInstance.registerChangeDiscountModal(data, parentRow, params);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(error, err) {\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tregisterChangeDiscountModal: function(modal, parentRow, params) {\n\t\t\tvar thisInstance = this;\n\t\t\tmodal.on('change', '.individualDiscountType', function(e) {\n\t\t\t\tvar element = $(e.currentTarget);\n\t\t\t\tmodal.find('.individualDiscountContainer .input-group-text').text(element.data('symbol'));\n\t\t\t});\n\t\t\tmodal.on('change', '.activeCheckbox[name=\"aggregationType\"]', function(e) {\n\t\t\t\tvar element = $(e.currentTarget);\n\n\t\t\t\tif (element.attr('type') == 'checkbox' && this.checked) {\n\t\t\t\t\telement\n\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').addClass('js-active');\n\t\t\t\t} else if (element.attr('type') == 'radio') {\n\t\t\t\t\tmodal.find('.js-panel').removeClass('js-active');\n\t\t\t\t\tmodal.find('.js-panel .js-panel__body').addClass('d-none');\n\t\t\t\t\telement\n\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').addClass('js-active');\n\t\t\t\t} else {\n\t\t\t\t\telement\n\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t.addClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').removeClass('js-active');\n\t\t\t\t}\n\t\t\t});\n\t\t\tmodal.on(\n\t\t\t\t'change',\n\t\t\t\t'.activeCheckbox, .globalDiscount,.individualDiscountValue,.individualDiscountType,.groupCheckbox',\n\t\t\t\tfunction(e) {\n\t\t\t\t\tthisInstance.calculateDiscount(parentRow, modal);\n\t\t\t\t}\n\t\t\t);\n\t\t\tmodal.on('click', '.saveDiscount', function(e) {\n\t\t\t\tthisInstance.saveDiscountsParameters(parentRow, modal);\n\t\t\t\tif (params.discountType == 0) {\n\t\t\t\t\tthisInstance.setDiscount(parentRow, App.Fields.Double.formatToDb(modal.find('.valueDiscount').text()));\n\t\t\t\t\tthisInstance.quantityChangeActions(parentRow);\n\t\t\t\t} else {\n\t\t\t\t\tvar rate =\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.valueDiscount').text()) /\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.valueTotalPrice').text());\n\t\t\t\t\tparentRow.find(thisInstance.rowClass).each(function(index) {\n\t\t\t\t\t\tthisInstance.setDiscount($(this), thisInstance.getTotalPrice($(this)) * rate);\n\t\t\t\t\t\tthisInstance.quantityChangeActions($(this));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tapp.hideModalWindow();\n\t\t\t});\n\t\t},\n\t\tregisterChangeTax: function() {\n\t\t\tconst thisInstance = this;\n\t\t\tthisInstance.form.on('click', '.changeTax', function(e) {\n\t\t\t\tvar parentRow;\n\t\t\t\tvar element = $(e.currentTarget);\n\t\t\t\tvar params = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Inventory',\n\t\t\t\t\tmode: 'showTaxes',\n\t\t\t\t\tcurrency: thisInstance.getCurrency(),\n\t\t\t\t\tsourceRecord: app.getRecordId()\n\t\t\t\t};\n\t\t\t\tif (element.hasClass('groupTax')) {\n\t\t\t\t\tparentRow = thisInstance.getInventoryItemsContainer();\n\t\t\t\t\tvar totalPrice = 0;\n\t\t\t\t\tif (parentRow.find('tfoot .colNetPrice').length > 0) {\n\t\t\t\t\t\ttotalPrice = parentRow.find('tfoot .colNetPrice').text();\n\t\t\t\t\t} else if (parentRow.find('tfoot .colTotalPrice ').length > 0) {\n\t\t\t\t\t\ttotalPrice = parentRow.find('tfoot .colTotalPrice ').text();\n\t\t\t\t\t}\n\t\t\t\t\tparams.totalPrice = App.Fields.Double.formatToDb(totalPrice);\n\t\t\t\t\tparams.taxType = 1;\n\t\t\t\t} else {\n\t\t\t\t\tparentRow = element.closest(thisInstance.rowClass);\n\t\t\t\t\tlet sourceRecord = parentRow.find('.rowName .sourceField').val();\n\t\t\t\t\tparams.totalPrice = thisInstance.getNetPrice(parentRow);\n\t\t\t\t\tparams.taxType = 0;\n\t\t\t\t\tif (sourceRecord) {\n\t\t\t\t\t\tparams.record = sourceRecord;\n\t\t\t\t\t}\n\t\t\t\t\tparams.recordModule = parentRow.find('.rowName [name=\"popupReferenceModule\"]').val();\n\t\t\t\t}\n\t\t\t\tvar progressInstace = $.progressIndicator();\n\t\t\t\tAppConnector.request(params)\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tapp.showModalWindow(data, function(data) {\n\t\t\t\t\t\t\tthisInstance.initTaxParameters(parentRow, $(data));\n\t\t\t\t\t\t\tthisInstance.registerChangeTaxModal(data, parentRow, params);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(error, err) {\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tlockCurrencyChange: false,\n\t\tregisterChangeCurrency() {\n\t\t\tthis.getInventoryHeadContainer().on('change', '.js-currency', e => {\n\t\t\t\tlet element = $(e.currentTarget),\n\t\t\t\t\tsymbol = element.find('option:selected').data('conversionSymbol');\n\t\t\t\tthis.currencyChangeActions(element, element.find('option:selected'));\n\t\t\t\tthis.form.find('.currencySymbol').text(symbol);\n\t\t\t});\n\t\t},\n\t\tregisterChangeTaxModal: function(modal, parentRow, params) {\n\t\t\tvar thisInstance = this;\n\t\t\tmodal.on('change', '.individualTaxType', function(e) {\n\t\t\t\tvar element = $(e.currentTarget);\n\t\t\t\tmodal.find('.individualTaxContainer .input-group-text').text(element.data('symbol'));\n\t\t\t});\n\t\t\tmodal.on('change', '.activeCheckbox[name=\"aggregationType\"]', function(e) {\n\t\t\t\tvar element = $(e.currentTarget);\n\n\t\t\t\tif (element.attr('type') == 'checkbox' && this.checked) {\n\t\t\t\t\telement\n\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').addClass('js-active');\n\t\t\t\t} else if (element.attr('type') == 'radio') {\n\t\t\t\t\tmodal.find('.js-panel').removeClass('js-active');\n\t\t\t\t\tmodal.find('.js-panel .js-panel__body').addClass('d-none');\n\t\t\t\t\telement\n\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').addClass('js-active');\n\t\t\t\t} else {\n\t\t\t\t\telement\n\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t.addClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').removeClass('js-active');\n\t\t\t\t}\n\t\t\t});\n\t\t\tmodal.on('change', '.activeCheckbox, .globalTax, .individualTaxValue, .groupTax, .regionalTax', function(e) {\n\t\t\t\tthisInstance.calculateTax(parentRow, modal);\n\t\t\t});\n\t\t\tmodal.on('click', '.saveTaxs', function(e) {\n\t\t\t\tthisInstance.saveTaxsParameters(parentRow, modal);\n\t\t\t\tif (params.taxType == '0') {\n\t\t\t\t\tthisInstance.setTax(parentRow, App.Fields.Double.formatToDb(modal.find('.valueTax').text()));\n\t\t\t\t\tthisInstance.setTaxPercent(parentRow, App.Fields.Double.formatToDb(modal.find('.js-tax-value').text()));\n\t\t\t\t\tthisInstance.quantityChangeActions(parentRow);\n\t\t\t\t} else {\n\t\t\t\t\tvar rate =\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.valueTax').text()) /\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.valueNetPrice').text());\n\t\t\t\t\tparentRow.find(thisInstance.rowClass).each(function(index) {\n\t\t\t\t\t\tvar totalPrice;\n\t\t\t\t\t\tif ($('.netPrice', $(this)).length > 0) {\n\t\t\t\t\t\t\ttotalPrice = thisInstance.getNetPrice($(this));\n\t\t\t\t\t\t} else if ($('.totalPrice', $(this)).length > 0) {\n\t\t\t\t\t\t\ttotalPrice = thisInstance.getTotalPrice($(this));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthisInstance.setTax($(this), totalPrice * rate);\n\t\t\t\t\t\tthisInstance.setTaxPercent($(this), App.Fields.Double.formatToDb(modal.find('.js-tax-value').text()));\n\t\t\t\t\t\tthisInstance.quantityChangeActions($(this));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tapp.hideModalWindow();\n\t\t\t});\n\t\t},\n\t\tregisterRowAutoComplete: function(container) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet sourceFieldElement = container.find('.sourceField.js-name');\n\t\t\tsourceFieldElement.on(Vtiger_Edit_Js.referenceSelectionEvent, function(e, params) {\n\t\t\t\tvar record = params.record;\n\t\t\t\tvar element = $(e.currentTarget);\n\t\t\t\tvar parentRow = element.closest(thisInstance.rowClass);\n\t\t\t\tvar selectedModule = parentRow.find('.rowName [name=\"popupReferenceModule\"]').val();\n\t\t\t\tvar dataUrl =\n\t\t\t\t\t'index.php?module=' +\n\t\t\t\t\tapp.getModuleName() +\n\t\t\t\t\t'&action=Inventory&mode=getDetails&record=' +\n\t\t\t\t\trecord +\n\t\t\t\t\t'&fieldname=' +\n\t\t\t\t\telement.data('columnname');\n\t\t\t\tif (thisInstance.getCurrency()) {\n\t\t\t\t\tdataUrl += '&currency_id=' + thisInstance.getCurrency();\n\t\t\t\t}\n\t\t\t\tAppConnector.request(dataUrl).done(function(data) {\n\t\t\t\t\tfor (var id in data) {\n\t\t\t\t\t\tif (typeof data[id] == 'object') {\n\t\t\t\t\t\t\tvar recordData = data[id];\n\t\t\t\t\t\t\tthisInstance.mapResultsToFields(selectedModule, parentRow, recordData);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tcalculateItemNumbers: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar items = this.getInventoryItemsContainer();\n\t\t\tvar i = 1;\n\t\t\titems.find(thisInstance.rowClass).each(function(index) {\n\t\t\t\t$(this)\n\t\t\t\t\t.find('.itemNumberText')\n\t\t\t\t\t.text(i);\n\t\t\t\ti++;\n\t\t\t});\n\t\t},\n\t\tinitItem: function(container) {\n\t\t\tlet thisInstance = this;\n\t\t\tif (typeof container === 'undefined') {\n\t\t\t\tcontainer = thisInstance.getInventoryItemsContainer();\n\t\t\t}\n\t\t\tthisInstance.registerDeleteLineItemEvent(container);\n\t\t\tthisInstance.registerPriceBookModal(container);\n\t\t\tthisInstance.registerRowChangeEvent(container);\n\t\t\tthisInstance.registerRowAutoComplete(container);\n\t\t\tthisInstance.checkDeleteIcon();\n\t\t\tthisInstance.rowsCalculations();\n\t\t\tthisInstance.updateRowSequence();\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(container.find('.selectInv'));\n\t\t\tApp.Fields.Date.register(container, true, {}, 'dateFieldInv');\n\t\t\tcontainer.validationEngine('detach');\n\t\t\tcontainer.validationEngine(app.validationEngineOptions);\n\t\t},\n\t\t/**\n\t\t * Load inventory data for specified record\n\t\t * @param {int} recordId\n\t\t * @param {string} sourceModule\n\t\t * @param {function|bool} success callback\n\t\t * @param {function|bool} fail callback\n\t\t * @returns Promise\n\t\t */\n\t\tloadInventoryData(recordId, sourceModule, success = false, fail = false) {\n\t\t\tconst progressLoader = $.progressIndicator({ blockInfo: { enabled: true } });\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: sourceModule,\n\t\t\t\t\taction: 'Inventory',\n\t\t\t\t\tmode: 'getTableData',\n\t\t\t\t\trecord: recordId\n\t\t\t\t})\n\t\t\t\t\t.done(response => {\n\t\t\t\t\t\tlet activeModules = [];\n\t\t\t\t\t\tthis.getInventoryHeadContainer()\n\t\t\t\t\t\t\t.find('.js-inv-add-item')\n\t\t\t\t\t\t\t.each((index, addBtn) => {\n\t\t\t\t\t\t\t\tactiveModules.push($(addBtn).data('module'));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\tprogressLoader.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\tconst oldCurrencyChangeAction = this.currencyChangeActions;\n\t\t\t\t\t\tthis.currencyChangeActions = function changeCurrencyActions(select, option) {\n\t\t\t\t\t\t\tthis.currencyConvertValues(select, option);\n\t\t\t\t\t\t\tselect.data('oldValue', select.val());\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconst first = response.result[Object.keys(response.result)[0]];\n\t\t\t\t\t\tthis.setCurrencyParam(first.currencyparam);\n\t\t\t\t\t\tthis.setCurrency(first.currency);\n\t\t\t\t\t\tthis.setDiscountMode(first.discountmode);\n\t\t\t\t\t\tthis.setTaxMode(first.taxmode);\n\t\t\t\t\t\tthis.currencyChangeActions = oldCurrencyChangeAction;\n\t\t\t\t\t\t$.each(response.result, (index, row) => {\n\t\t\t\t\t\t\tif (activeModules.indexOf(row.moduleName) !== -1) {\n\t\t\t\t\t\t\t\tthis.addItem(row.moduleName, row.basetableid, row);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\t\t\ttext: app\n\t\t\t\t\t\t\t\t\t\t.vtranslate('JS_INVENTORY_ITEM_MODULE_NOT_FOUND')\n\t\t\t\t\t\t\t\t\t\t.replace('${sourceModule}', row.moduleName)\n\t\t\t\t\t\t\t\t\t\t.replace('${position}', row.info.name)\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.summaryCalculations();\n\t\t\t\t\t\tresolve(response.result);\n\t\t\t\t\t\tif (typeof success === 'function') {\n\t\t\t\t\t\t\tsuccess(response.result);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail((error, err) => {\n\t\t\t\t\t\tprogressLoader.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\treject(error, err);\n\t\t\t\t\t\tif (typeof fail === 'function') {\n\t\t\t\t\t\t\tfail(error, err);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function which will register all the events\n\t\t */\n\t\tregisterEvents: function(container) {\n\t\t\tthis.form = container;\n\t\t\tthis.registerInventorySaveData();\n\t\t\tthis.registerAddItem();\n\t\t\tthis.initItem();\n\t\t\tthis.registerSortableItems();\n\t\t\tthis.registerSubProducts();\n\t\t\tthis.registerChangeDiscount();\n\t\t\tthis.registerChangeTax();\n\t\t\tthis.registerClearReferenceSelection();\n\t\t\tthis.registerShowHideExpanded();\n\t\t\tthis.registerChangeCurrency();\n\t\t\tthis.setDefaultGlobalTax(container);\n\t\t}\n\t}\n);\n"],"names":["$","Class","container","this","inventoryInstance","moduleClassName","find","val","window","registerEvents","form","inventoryContainer","inventoryHeadContainer","summaryDiscountContainer","summaryTaxesContainer","summaryCurrenciesContainer","$inventoryItemsNo","rowNumber","parseInt","accountReferenceField","getInventoryItemsContainer","rowClass","length","showLineItemsDeleteIcon","app","getMainParams","hideLineItemsDeleteIcon","removeClass","addClass","element","closest","getForm","eq","clone","validationEngine","row","getInventoryHeadContainer","getTaxModeSelectElement","taxTypeElement","thisInstance","groupTax","getInventorySummaryTaxesContainer","items","newRow","isIndividualTaxMode","parentRow","taxParam","aggregationType","each","thisItem","App","Fields","Double","formatToDb","attr","setTaxParam","setTax","setTaxPercent","setDefaultGlobalTax","rowsCalculations","taxDefaultValue","data","isGroupTaxMode","formatToDisplay","JSON","stringify","quantityChangeActions","getDiscountModeSelectElement","groupDiscount","getInventorySummaryDiscountContainer","isIndividualDiscountMode","setDiscount","setDiscountParam","taxParams","undefined","parse","valuePrices","getNetPrice","taxRate","types","forEach","entry","taxValue","individualTax","globalTax","regionalTax","taxPercent","getNumberFromValue","discountParams","getTotalPrice","discountRate","discountValue","individualDiscount","discountType","individualDiscountType","globalDiscount","getDiscount","getQuantityValue","getUnitPriceValue","qty","purchase","price","index","getGrossPrice","trigger","display","text","parent","rowCalculations","summaryCalculations","calculateTotalPrice","calculateDiscounts","calculateNetPrice","calculateTaxes","calculateGrossPrice","calculateMargin","calculateItemNumbers","getTax","getTaxPercent","calculatSummary","calculatDiscountSummary","calculatTaxSummary","calculatCurrenciesSummary","calculatMarginPSummary","field","sum","sumRow","sumPrice","getNumberFromText","marginp","purchasePrice","discount","getAllDiscount","getInventorySummaryCurrenciesContainer","selected","base","conversionRate","baseConversionRate","parseFloat","taxs","getAllTaxs","html","value","appendTo","tax","typeSummary","netPrice","params","param","name","precent","old","setNetPrice","setGrossPrice","setTotalPrice","getPurchase","margin","setMargin","setMarginP","modal","netPriceBeforeDiscount","discountsType","individualTypeDiscount","prop","panel","netPriceWithoutTax","taxType","on","Vtiger_Edit_Js","recordPreSave","e","syncHeaderData","checkLimits","removeAttr","header","lineItemRow","rowName","showRecordsList","getCurrency","CONFIG","defaultCurrencyId","instance","setSelectEvent","request","responseData","id","done","result","setUnitPrice","errorLog","indicator","recordId","recordModule","removeSubProducts","inArray","subProductsCashe","addSubProducts","subProrductParams","progressInstace","progressIndicator","hide","fail","error","err","remove","subProductsContainer","priductText","append","referenceModule","unit","unitPrice","isGroupTax","recordData","description","unitPriceValues","unitPriceValuesJson","parameters","taxes","type","setPurchase","commentElement","next","editorInstance","CKEDITOR","instances","setData","triggerQtyParam","qtyPerUnit","loadSubProducts","perUnit","info","typeName","panels","i","push","extend","taxModalFields","inventoryRowExpanded","listInstance","getInstance","key","loadEditorElement","destroy","discountModalFields","parameter","array","isArray","arrayValue","filter","change","calculateDiscount","toString","input","formatNumber","calculateTax","account","getAccountId","limit","response","limitEnableSave","getModuleName","getSummaryGrossPrice","async","dataType","status","showModalWindow","select","option","showCurrencyChangeModal","currencyConvertValues","lockCurrencyChange","block","currencyParam","rate","hideModalWindow","one","previous","prevConversionRate","rowData","setName","setQuantity","setUnit","autoFields","unitText","subunit","setSubUnit","subunitText","setComment","comment1","net","gross","total","discountParam","discountparam","taxparam","tax_percent","module","baseTableId","getBasicRow","sequenceNumber","getNextLineItemRowNumber","replaced","replace","moduleLbls","children","initItem","registerAutoCompleteFields","setRowData","btn","addItem","sortable","ui","width","event","hideExpandedRow","item","startPos","numrow","child","after","before","updateRowSequence","currentTarget","getClosestRow","showExpandedRow","isRecordSelected","pricebooksModalHandler","_this","headContainer","showIndividualTax","showIndividualDiscount","referenceGroup","_this2","num","checkDeleteIcon","hasClass","totalPrice","initDiscountsParameters","registerChangeDiscountModal","checked","saveDiscountsParameters","getRecordId","sourceRecord","record","initTaxParameters","registerChangeTaxModal","symbol","currencyChangeActions","saveTaxsParameters","referenceSelectionEvent","selectedModule","dataUrl","babelHelpers.typeof","mapResultsToFields","registerDeleteLineItemEvent","registerPriceBookModal","registerRowChangeEvent","registerRowAutoComplete","Picklist","showSelect2ElementView","Date","register","validationEngineOptions","sourceModule","success","progressLoader","blockInfo","enabled","Promise","resolve","reject","activeModules","addBtn","mode","oldCurrencyChangeAction","_this4","first","Object","keys","setCurrencyParam","currencyparam","setCurrency","currency","setDiscountMode","discountmode","setTaxMode","taxmode","indexOf","moduleName","basetableid","showMessage","vtranslate","registerInventorySaveData","registerAddItem","registerSortableItems","registerSubProducts","registerChangeDiscount","registerChangeTax","registerClearReferenceSelection","registerShowHideExpanded","registerChangeCurrency"],"mappings":"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"}