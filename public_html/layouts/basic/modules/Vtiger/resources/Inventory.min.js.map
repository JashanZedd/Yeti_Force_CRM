{"version":3,"file":"Inventory.min.js","sources":["Inventory.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class(\n\t'Vtiger_Inventory_Js',\n\t{\n\t\tinventoryInstance: false,\n\t\t/**\n\t\t * Get inventory instance\n\t\t * @param {jQuery} container\n\t\t * @returns {Vtiger_Inventory_Js}\n\t\t */\n\t\tgetInventoryInstance: function(container) {\n\t\t\tif (this.inventoryInstance === false) {\n\t\t\t\tlet moduleClassName = container.find('[name=\"module\"]').val() + '_Inventory_Js';\n\t\t\t\tif (typeof window[moduleClassName] === 'undefined') {\n\t\t\t\t\tmoduleClassName = 'Vtiger_Inventory_Js';\n\t\t\t\t}\n\t\t\t\tif (typeof window[moduleClassName] !== 'undefined') {\n\t\t\t\t\tthis.inventoryInstance = new window[moduleClassName]();\n\t\t\t\t\tthis.inventoryInstance.registerEvents(container);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this.inventoryInstance;\n\t\t}\n\t},\n\t{\n\t\tform: false,\n\t\tinventoryContainer: false,\n\t\tinventoryHeadContainer: false,\n\t\tsummaryTaxesContainer: false,\n\t\tsummaryDiscountContainer: false,\n\t\tsummaryCurrenciesContainer: false,\n\t\trowClass: 'tr.inventoryRow',\n\t\tdiscountModalFields: [\n\t\t\t'aggregationType',\n\t\t\t'globalDiscount',\n\t\t\t'groupCheckbox',\n\t\t\t'groupDiscount',\n\t\t\t'individualDiscount',\n\t\t\t'individualDiscountType'\n\t\t],\n\t\ttaxModalFields: ['aggregationType', 'globalTax', 'groupCheckbox', 'groupTax', 'individualTax', 'regionalTax'],\n\t\t/**\n\t\t * Get current form element\n\t\t * @returns {jQuery}\n\t\t */\n\t\tgetForm() {\n\t\t\treturn this.form;\n\t\t},\n\t\t/**\n\t\t * Function that is used to get the line item container\n\t\t * @return : jQuery object\n\t\t */\n\t\tgetInventoryItemsContainer: function() {\n\t\t\tif (this.inventoryContainer === false) {\n\t\t\t\tthis.inventoryContainer = $('.inventoryItems');\n\t\t\t}\n\t\t\treturn this.inventoryContainer;\n\t\t},\n\t\tgetInventoryHeadContainer: function() {\n\t\t\tif (this.inventoryHeadContainer === false) {\n\t\t\t\tthis.inventoryHeadContainer = $('.inventoryHeader');\n\t\t\t}\n\t\t\treturn this.inventoryHeadContainer;\n\t\t},\n\t\tgetInventorySummaryDiscountContainer: function() {\n\t\t\tif (this.summaryDiscountContainer === false) {\n\t\t\t\tthis.summaryDiscountContainer = $('.inventorySummaryDiscounts');\n\t\t\t}\n\t\t\treturn this.summaryDiscountContainer;\n\t\t},\n\t\tgetInventorySummaryTaxesContainer: function() {\n\t\t\tif (this.summaryTaxesContainer === false) {\n\t\t\t\tthis.summaryTaxesContainer = $('.inventorySummaryTaxes');\n\t\t\t}\n\t\t\treturn this.summaryTaxesContainer;\n\t\t},\n\t\tgetInventorySummaryCurrenciesContainer: function() {\n\t\t\tif (this.summaryCurrenciesContainer === false) {\n\t\t\t\tthis.summaryCurrenciesContainer = $('.inventorySummaryCurrencies');\n\t\t\t}\n\t\t\treturn this.summaryCurrenciesContainer;\n\t\t},\n\t\tgetNextLineItemRowNumber: function() {\n\t\t\tvar $inventoryItemsNo = $('#inventoryItemsNo');\n\t\t\tvar rowNumber = parseInt($inventoryItemsNo.val()) + 1;\n\t\t\t$inventoryItemsNo.val(rowNumber);\n\t\t\treturn rowNumber;\n\t\t},\n\t\tgetAccountId: function() {\n\t\t\tvar accountReferenceField = $('#accountReferenceField').val();\n\t\t\tif (accountReferenceField != '') {\n\t\t\t\treturn $('[name=\"' + accountReferenceField + '\"]').val();\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\tcheckDeleteIcon: function() {\n\t\t\tif (this.getInventoryItemsContainer().find(this.rowClass).length > 1) {\n\t\t\t\tthis.showLineItemsDeleteIcon();\n\t\t\t} else if (app.getMainParams('isRequiredInventory')) {\n\t\t\t\tthis.hideLineItemsDeleteIcon();\n\t\t\t}\n\t\t},\n\t\tshowLineItemsDeleteIcon: function() {\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find('.deleteRow')\n\t\t\t\t.removeClass('d-none');\n\t\t},\n\t\thideLineItemsDeleteIcon: function() {\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find('.deleteRow')\n\t\t\t\t.addClass('d-none');\n\t\t},\n\t\tgetClosestRow: function(element) {\n\t\t\treturn element.closest(this.rowClass);\n\t\t},\n\t\t/**\n\t\t * Function which will return the basic row which can be used to add new rows\n\t\t * @return jQuery object which you can use to\n\t\t */\n\t\tgetBasicRow: function() {\n\t\t\treturn this.getForm()\n\t\t\t\t.find('.js-inventory-base-item')\n\t\t\t\t.eq(0)\n\t\t\t\t.clone(true, true);\n\t\t},\n\t\tisRecordSelected: function(element) {\n\t\t\tvar parentRow = element.closest('tr');\n\t\t\tvar productField = parentRow.find('.recordLabel');\n\t\t\treturn productField.validationEngine('validate');\n\t\t},\n\t\tgetTaxModeSelectElement: function(row) {\n\t\t\tvar items = this.getInventoryHeadContainer();\n\t\t\tif (items.find('thead .js-taxmode').length > 0) {\n\t\t\t\treturn $('.js-taxmode');\n\t\t\t}\n\t\t\tif (row) {\n\t\t\t\treturn row.find('.js-taxmode');\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tisIndividualTaxMode: function(row) {\n\t\t\tvar taxModeElement = this.getTaxModeSelectElement(row);\n\t\t\tvar selectedOption = taxModeElement.find('option:selected');\n\t\t\treturn selectedOption.val() == '1';\n\t\t},\n\t\tisGroupTaxMode: function() {\n\t\t\tvar taxTypeElement = this.getTaxModeSelectElement();\n\t\t\tif (taxTypeElement) {\n\t\t\t\tvar selectedOption = taxTypeElement.find('option:selected');\n\t\t\t\tif (selectedOption.val() == '0') {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tshowIndividualTax: function(row) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar groupTax = thisInstance.getInventorySummaryTaxesContainer().find('.groupTax');\n\t\t\tvar items = thisInstance.getInventoryItemsContainer();\n\t\t\tvar newRow = $('#blackIthemTable').find('tbody');\n\t\t\tif (thisInstance.isIndividualTaxMode()) {\n\t\t\t\tgroupTax.addClass('d-none');\n\t\t\t\titems.find('.changeTax').removeClass('d-none');\n\t\t\t\tnewRow.find('.changeTax').removeClass('d-none');\n\t\t\t\tlet parentRow = thisInstance.getInventoryItemsContainer();\n\t\t\t\tlet taxParam = { aggregationType: 'global' };\n\n\t\t\t\tparentRow.find(thisInstance.rowClass).each(function() {\n\t\t\t\t\tlet thisItem = $(this);\n\t\t\t\t\ttaxParam['globalTax'] = App.Fields.Double.formatToDb(thisItem.find('.js-tax').attr('data-default-tax'));\n\t\t\t\t\tthisInstance.setTaxParam(thisItem, taxParam);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthisInstance.setTax(items, 0);\n\t\t\t\tthisInstance.setTaxPercent(items, 0);\n\t\t\t\tthisInstance.setTaxParam(items, []);\n\t\t\t\tthisInstance.setDefaultGlobalTax(row);\n\t\t\t\tgroupTax.removeClass('d-none');\n\t\t\t\titems.find('.changeTax').addClass('d-none');\n\t\t\t\tnewRow.find('.changeTax').addClass('d-none');\n\t\t\t}\n\t\t\tthisInstance.rowsCalculations();\n\t\t},\n\t\tsetDefaultGlobalTax: function(row) {\n\t\t\tlet thisInstance = this;\n\t\t\tlet parentRow = thisInstance.getInventoryItemsContainer();\n\t\t\tlet taxDefaultValue = thisInstance\n\t\t\t\t.getInventorySummaryTaxesContainer()\n\t\t\t\t.find('.js-default-tax')\n\t\t\t\t.data('tax-default-value');\n\t\t\tlet isGroupTax = thisInstance.isGroupTaxMode();\n\t\t\tif (isGroupTax) {\n\t\t\t\tif (taxDefaultValue) {\n\t\t\t\t\tlet taxParam = { aggregationType: 'global' };\n\t\t\t\t\ttaxParam['globalTax'] = App.Fields.Double.formatToDisplay(taxDefaultValue);\n\t\t\t\t\ttaxParam['individualTax'] = '';\n\t\t\t\t\tthisInstance.setTaxParam($('#blackIthemTable'), taxParam);\n\t\t\t\t\tthisInstance.setTaxParam(parentRow, taxParam);\n\t\t\t\t\tparentRow.closest('.inventoryItems').data('taxParam', JSON.stringify(taxParam));\n\t\t\t\t\tparentRow.find(thisInstance.rowClass).each(function() {\n\t\t\t\t\t\tthisInstance.quantityChangeActions($(this));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthisInstance.setTaxParam($('#blackIthemTable'), []);\n\t\t\t\tparentRow.closest('.inventoryItems').data('taxParam', []);\n\t\t\t}\n\t\t},\n\t\tgetDiscountModeSelectElement: function(row) {\n\t\t\tvar items = this.getInventoryHeadContainer();\n\t\t\tif (items.find('thead .js-discountmode').length > 0) {\n\t\t\t\treturn $('.js-discountmode');\n\t\t\t}\n\t\t\treturn row.find('.js-discountmode');\n\t\t},\n\t\tisIndividualDiscountMode: function(row) {\n\t\t\tvar discountModeElement = this.getDiscountModeSelectElement(row);\n\t\t\tvar selectedOption = discountModeElement.find('option:selected');\n\t\t\treturn selectedOption.val() == '1';\n\t\t},\n\t\tshowIndividualDiscount: function(row) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar groupDiscount = thisInstance.getInventorySummaryDiscountContainer().find('.groupDiscount');\n\t\t\tvar items = thisInstance.getInventoryItemsContainer();\n\t\t\tvar newRow = $('#blackIthemTable').find('tbody');\n\t\t\tif (thisInstance.isIndividualDiscountMode(row)) {\n\t\t\t\tgroupDiscount.addClass('d-none');\n\t\t\t\titems.find('.changeDiscount').removeClass('d-none');\n\t\t\t\tnewRow.find('.changeDiscount').removeClass('d-none');\n\t\t\t} else {\n\t\t\t\tgroupDiscount.removeClass('d-none');\n\t\t\t\titems.find('.changeDiscount').addClass('d-none');\n\t\t\t\tnewRow.find('.changeDiscount').addClass('d-none');\n\t\t\t}\n\t\t\tthisInstance.setDiscount(items, 0);\n\t\t\tthisInstance.setDiscountParam(items, []);\n\t\t\tthisInstance.rowsCalculations();\n\t\t},\n\t\tgetCurrency: function() {\n\t\t\tlet currency = $('.js-currency', this.getInventoryHeadContainer());\n\t\t\treturn currency.find('option:selected').val();\n\t\t},\n\t\tgetTax: function(row) {\n\t\t\tvar taxParams = row.find('.taxParam').val();\n\t\t\tif (taxParams == '' || taxParams == '[]' || taxParams == undefined) return 0;\n\t\t\ttaxParams = JSON.parse(taxParams);\n\t\t\tvar aggregationType = $('.aggregationTypeTax').val();\n\t\t\tvar valuePrices = this.getNetPrice(row);\n\t\t\tvar taxRate = 0;\n\t\t\tvar types = taxParams.aggregationType;\n\t\t\tif (typeof types == 'string') {\n\t\t\t\ttypes = [types];\n\t\t\t}\n\t\t\tif (types) {\n\t\t\t\ttypes.forEach(function(entry) {\n\t\t\t\t\tvar taxValue = 0;\n\t\t\t\t\tswitch (entry) {\n\t\t\t\t\t\tcase 'individual':\n\t\t\t\t\t\t\ttaxValue = taxParams.individualTax;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'global':\n\t\t\t\t\t\t\ttaxValue = taxParams.globalTax;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'group':\n\t\t\t\t\t\t\ttaxValue = taxParams.groupTax;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'regional':\n\t\t\t\t\t\t\ttaxValue = taxParams.regionalTax;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\ttaxRate += valuePrices * (App.Fields.Double.formatToDb(taxValue) / 100);\n\t\t\t\t\tif (aggregationType == '2') {\n\t\t\t\t\t\tvaluePrices = valuePrices + taxRate;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn taxRate;\n\t\t},\n\t\tgetTaxPercent: function(row) {\n\t\t\tvar taxParams = row.find('.taxParam').val();\n\t\t\tif (taxParams == '' || taxParams == '[]' || taxParams == undefined) return 0;\n\t\t\ttaxParams = JSON.parse(taxParams);\n\t\t\tlet taxPercent = taxParams[taxParams.aggregationType + 'Tax'];\n\t\t\treturn taxPercent ? taxPercent : 0;\n\t\t},\n\t\tgetTaxParams: function(row) {\n\t\t\tvar taxParams = row.find('.taxParam').val();\n\t\t\tif (taxParams == '' || taxParams == '[]' || taxParams == undefined) return false;\n\t\t\treturn JSON.parse(taxParams);\n\t\t},\n\t\tgetQuantityValue: function(row) {\n\t\t\treturn $('.qty', row).getNumberFromValue();\n\t\t},\n\t\tgetUnitPriceValue: function(row) {\n\t\t\treturn $('.unitPrice', row).getNumberFromValue();\n\t\t},\n\t\tgetDiscount: function(row) {\n\t\t\tvar discountParams = row.find('.discountParam').val();\n\t\t\tvar aggregationType = $('.aggregationTypeDiscount').val();\n\t\t\tif (discountParams == '' || discountParams == 'null' || discountParams == '[]' || discountParams == undefined)\n\t\t\t\treturn 0;\n\t\t\tdiscountParams = JSON.parse(discountParams);\n\t\t\tvar valuePrices = this.getTotalPrice(row);\n\t\t\tvar discountRate = 0;\n\t\t\tvar types = discountParams.aggregationType;\n\t\t\tif (typeof types == 'string') {\n\t\t\t\ttypes = [types];\n\t\t\t}\n\t\t\tif (types) {\n\t\t\t\ttypes.forEach(function(entry) {\n\t\t\t\t\tvar discountValue;\n\t\t\t\t\tif (entry == 'individual') {\n\t\t\t\t\t\tdiscountValue = discountParams.individualDiscount;\n\t\t\t\t\t\tvar discountType = discountParams.individualDiscountType;\n\t\t\t\t\t\tif (discountType == 'percentage') {\n\t\t\t\t\t\t\tdiscountRate += valuePrices * (discountValue / 100);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdiscountRate += App.Fields.Double.formatToDb(discountValue);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (entry == 'global') {\n\t\t\t\t\t\tdiscountRate += valuePrices * (App.Fields.Double.formatToDb(discountParams.globalDiscount) / 100);\n\t\t\t\t\t}\n\t\t\t\t\tif (entry == 'group') {\n\t\t\t\t\t\tdiscountRate += valuePrices * (App.Fields.Double.formatToDb(discountParams.groupDiscount) / 100);\n\t\t\t\t\t}\n\t\t\t\t\tif (aggregationType == '2') {\n\t\t\t\t\t\tvaluePrices = valuePrices - discountRate;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn discountRate;\n\t\t},\n\t\tgetNetPrice: function(row) {\n\t\t\treturn this.getTotalPrice(row) - this.getDiscount(row);\n\t\t},\n\t\tgetTotalPrice: function(row) {\n\t\t\treturn this.getQuantityValue(row) * this.getUnitPriceValue(row);\n\t\t},\n\t\tgetGrossPrice: function(row) {\n\t\t\treturn $('.grossPrice', row).getNumberFromValue();\n\t\t},\n\t\tgetPurchase: function(row) {\n\t\t\tvar qty = this.getQuantityValue(row);\n\t\t\tvar element = $('.purchase', row);\n\t\t\tvar purchase = 0;\n\t\t\tif (element.length > 0) {\n\t\t\t\tpurchase = App.Fields.Double.formatToDb(element.val());\n\t\t\t}\n\t\t\treturn purchase * qty;\n\t\t},\n\t\tgetSummaryGrossPrice: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar price = 0;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tprice += thisInstance.getGrossPrice($(this));\n\t\t\t\t});\n\t\t\treturn App.Fields.Double.formatToDb(price);\n\t\t},\n\t\t/**\n\t\t * Set currency\n\t\t * @param {int} val\n\t\t */\n\t\tsetCurrency(val) {\n\t\t\tthis.getInventoryHeadContainer()\n\t\t\t\t.find('.js-currency')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set currency param\n\t\t * @param {string} val json string\n\t\t */\n\t\tsetCurrencyParam(val) {\n\t\t\tthis.getInventoryHeadContainer()\n\t\t\t\t.find('.js-currencyparam')\n\t\t\t\t.val(val);\n\t\t},\n\t\t/**\n\t\t * Set discount mode\n\t\t * @param {int} val\n\t\t */\n\t\tsetDiscountMode(val) {\n\t\t\tthis.getInventoryHeadContainer()\n\t\t\t\t.find('.js-discountmode')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set tax mode\n\t\t * @param {int} val\n\t\t */\n\t\tsetTaxMode(val) {\n\t\t\tthis.getInventoryHeadContainer()\n\t\t\t\t.find('.js-taxmode')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set inventory id\n\t\t * @param {jQuery} row\n\t\t * @param {int} val\n\t\t * @param {string} display\n\t\t */\n\t\tsetName(row, val, display) {\n\t\t\trow\n\t\t\t\t.find('.js-name')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t\trow\n\t\t\t\t.find('.js-name_display')\n\t\t\t\t.val(display)\n\t\t\t\t.attr('readonly', 'true')\n\t\t\t\t.trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set inventory row quantity\n\t\t * @param {jQuery} row\n\t\t * @param {int} val\n\t\t */\n\t\tsetQuantity(row, val) {\n\t\t\trow\n\t\t\t\t.find('.qty')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set unit original (db) value\n\t\t * @param {jQuery} row\n\t\t * @param {string} val\n\t\t * @param {string} display\n\t\t */\n\t\tsetUnit(row, val, display) {\n\t\t\trow\n\t\t\t\t.find('.unit')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t\trow\n\t\t\t\t.find('.unitText')\n\t\t\t\t.text(display)\n\t\t\t\t.trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set subUnit original (db) value\n\t\t * @param {jQuery} row\n\t\t * @param {string} val\n\t\t * @param {string} display\n\t\t */\n\t\tsetSubUnit(row, val, display) {\n\t\t\trow.find('.subunit').val(val);\n\t\t\trow.find('.subunitText').val(display);\n\t\t},\n\t\t/**\n\t\t * Set inventory row comment\n\t\t * @param {jQuery} row\n\t\t * @param {string} val\n\t\t */\n\t\tsetComment(row, val) {\n\t\t\trow\n\t\t\t\t.parent()\n\t\t\t\t.find('[numrowex=' + row.attr('numrow') + ']')\n\t\t\t\t.find('.comment')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t},\n\t\tsetUnitPrice: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\trow\n\t\t\t\t.find('.unitPrice')\n\t\t\t\t.val(val)\n\t\t\t\t.attr('title', val);\n\t\t\treturn this;\n\t\t},\n\t\tsetPurchase: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\trow.find('.purchase').val(val);\n\t\t\treturn this;\n\t\t},\n\t\tsetNetPrice: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.netPriceText', row).text(val);\n\t\t\t$('.netPrice', row).val(val);\n\t\t},\n\t\tsetGrossPrice: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.grossPriceText', row).text(val);\n\t\t\t$('.grossPrice', row).val(val);\n\t\t},\n\t\tsetTotalPrice: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.totalPriceText', row).text(val);\n\t\t\t$('.totalPrice', row).val(val);\n\t\t},\n\t\tsetMargin: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.margin', row).val(val);\n\t\t},\n\t\tsetMarginP: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.marginp', row).val(val);\n\t\t},\n\t\tsetDiscount: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.discount', row).val(val);\n\t\t},\n\t\tsetDiscountParam: function(row, val) {\n\t\t\t$('.discountParam', row).val(JSON.stringify(val));\n\t\t},\n\t\tsetTax: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.tax', row).val(val);\n\t\t},\n\t\tsetTaxPercent: function(row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.js-tax-percent', row).val(val);\n\t\t},\n\t\tsetTaxParam: function(row, val) {\n\t\t\t$('.taxParam', row).val(JSON.stringify(val));\n\t\t},\n\t\tquantityChangeActions: function(row) {\n\t\t\tthis.rowCalculations(row);\n\t\t\tthis.summaryCalculations();\n\t\t},\n\t\trowCalculations: function(row) {\n\t\t\tthis.calculateTotalPrice(row);\n\t\t\tthis.calculateDiscounts(row);\n\t\t\tthis.calculateNetPrice(row);\n\t\t\tthis.calculateTaxes(row);\n\t\t\tthis.calculateGrossPrice(row);\n\t\t\tthis.calculateMargin(row);\n\t\t},\n\t\trowsCalculations: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tthisInstance.quantityChangeActions($(this));\n\t\t\t\t});\n\t\t\tthisInstance.calculateItemNumbers();\n\t\t},\n\t\tcalculateDiscounts: function(row) {\n\t\t\tthis.setDiscount(row, this.getDiscount(row));\n\t\t},\n\t\tcalculateTaxes: function(row) {\n\t\t\tthis.setTax(row, this.getTax(row));\n\t\t\tthis.setTaxPercent(row, this.getTaxPercent(row));\n\t\t},\n\t\tsummaryCalculations: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tthisInstance\n\t\t\t\t.getInventoryItemsContainer()\n\t\t\t\t.find('tfoot .wisableTd')\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tthisInstance.calculatSummary($(this), $(this).data('sumfield'));\n\t\t\t\t});\n\t\t\tthisInstance.calculatDiscountSummary();\n\t\t\tthisInstance.calculatTaxSummary();\n\t\t\tthisInstance.calculatCurrenciesSummary();\n\t\t\tthisInstance.calculatMarginPSummary();\n\t\t},\n\t\tcalculatSummary: function(element, field) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar sum = 0;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tvar element = $(this).find('.' + field);\n\t\t\t\t\tif (element.length > 0) {\n\t\t\t\t\t\tsum += App.Fields.Double.formatToDb(element.val());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\telement.text(App.Fields.Double.formatToDisplay(sum));\n\t\t},\n\t\tcalculatMarginPSummary: function() {\n\t\t\tlet sumRow = this.getInventoryItemsContainer().find('tfoot'),\n\t\t\t\ttotalPriceField =\n\t\t\t\t\tsumRow.find('[data-sumfield=\"netPrice\"]').length > 0\n\t\t\t\t\t\t? sumRow.find('[data-sumfield=\"netPrice\"]')\n\t\t\t\t\t\t: sumRow.find('[data-sumfield=\"totalPrice\"]'),\n\t\t\t\tsumPrice = totalPriceField.getNumberFromText(),\n\t\t\t\tpurchase = 0,\n\t\t\t\tmarginp = 0;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(this.rowClass)\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tlet qty = $(this)\n\t\t\t\t\t\t\t.find('.qty')\n\t\t\t\t\t\t\t.getNumberFromValue(),\n\t\t\t\t\t\tpurchasePrice = $(this)\n\t\t\t\t\t\t\t.find('.purchase')\n\t\t\t\t\t\t\t.getNumberFromValue();\n\t\t\t\t\tif (qty > 0 && purchasePrice > 0) {\n\t\t\t\t\t\tpurchase += qty * purchasePrice;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\tlet subtraction = sumPrice - purchase;\n\t\t\tif (purchase !== 0 && sumPrice !== 0) {\n\t\t\t\tmarginp = (subtraction / sumPrice) * 100;\n\t\t\t}\n\t\t\tsumRow.find('[data-sumfield=\"marginP\"]').text(App.Fields.Double.formatToDisplay(marginp) + '%');\n\t\t},\n\t\tcalculatDiscountSummary: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar discount = thisInstance.getAllDiscount();\n\t\t\tvar container = thisInstance.getInventorySummaryDiscountContainer();\n\t\t\tcontainer.find('input').val(App.Fields.Double.formatToDisplay(discount));\n\t\t},\n\t\tgetAllDiscount: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar discount = 0;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tvar row = $(this);\n\t\t\t\t\tdiscount += thisInstance.getDiscount(row);\n\t\t\t\t});\n\t\t\treturn discount;\n\t\t},\n\t\tcalculatCurrenciesSummary: function() {\n\t\t\tlet container = this.getInventorySummaryCurrenciesContainer(),\n\t\t\t\tselected = $('.js-currency option:selected', this.getInventoryHeadContainer()),\n\t\t\t\tbase = $('.js-currency option[data-base-currency=\"1\"]', this.getInventoryHeadContainer()),\n\t\t\t\tconversionRate = selected.data('conversionRate'),\n\t\t\t\tbaseConversionRate = base.data('conversionRate');\n\t\t\tif (conversionRate == baseConversionRate) {\n\t\t\t\tcontainer.addClass('d-none');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconversionRate = parseFloat(baseConversionRate) / parseFloat(conversionRate);\n\t\t\tcontainer.removeClass('d-none');\n\t\t\tvar taxs = this.getAllTaxs();\n\t\t\tvar sum = 0;\n\t\t\tcontainer.find('.js-panel__body').html('');\n\t\t\t$.each(taxs, function(index, value) {\n\t\t\t\tif (value != undefined) {\n\t\t\t\t\tvalue = value * conversionRate;\n\t\t\t\t\tvar row = container.find('.d-none .form-group').clone();\n\t\t\t\t\trow.find('.percent').text(index + '%');\n\t\t\t\t\trow.find('input').val(App.Fields.Double.formatToDisplay(value));\n\t\t\t\t\trow.appendTo(container.find('.js-panel__body'));\n\t\t\t\t\tsum += value;\n\t\t\t\t}\n\t\t\t});\n\t\t\tcontainer.find('.js-panel__footer input').val(App.Fields.Double.formatToDisplay(sum));\n\t\t},\n\t\tcalculatTaxSummary: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar taxs = thisInstance.getAllTaxs();\n\t\t\tvar container = thisInstance.getInventorySummaryTaxesContainer();\n\t\t\tcontainer.find('.js-panel__body').html('');\n\t\t\tvar sum = 0;\n\t\t\tfor (var index in taxs) {\n\t\t\t\tvar row = container.find('.d-none .form-group').clone();\n\t\t\t\trow.find('.percent').text(App.Fields.Double.formatToDisplay(App.Fields.Double.formatToDb(index)) + '%');\n\t\t\t\trow.find('input').val(App.Fields.Double.formatToDisplay(taxs[index]));\n\t\t\t\trow.appendTo(container.find('.js-panel__body'));\n\t\t\t\tsum += taxs[index];\n\t\t\t}\n\t\t\tcontainer.find('.js-panel__footer input').val(App.Fields.Double.formatToDisplay(sum));\n\t\t},\n\t\tgetAllTaxs: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar tax = [];\n\t\t\tvar typeSummary = $('.aggregationTypeTax').val();\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tvar row = $(this);\n\t\t\t\t\tvar netPrice = thisInstance.getNetPrice(row);\n\t\t\t\t\tvar params = row.find('.taxParam').val();\n\t\t\t\t\tif (params != '' && params != '[]' && params != undefined) {\n\t\t\t\t\t\tvar param = JSON.parse(params);\n\t\t\t\t\t\tif (typeof param.aggregationType == 'string') {\n\t\t\t\t\t\t\tparam.aggregationType = [param.aggregationType];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (param.aggregationType)\n\t\t\t\t\t\t\t$.each(param.aggregationType, function(index, name) {\n\t\t\t\t\t\t\t\tname = name + 'Tax';\n\t\t\t\t\t\t\t\tvar precent = param[name];\n\t\t\t\t\t\t\t\tvar old = 0;\n\t\t\t\t\t\t\t\tif (tax[precent] != undefined) {\n\t\t\t\t\t\t\t\t\told = parseFloat(tax[precent]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvar taxRate = netPrice * (App.Fields.Double.formatToDb(precent) / 100);\n\t\t\t\t\t\t\t\ttax[precent] = old + taxRate;\n\t\t\t\t\t\t\t\tif (typeSummary == '2') {\n\t\t\t\t\t\t\t\t\tnetPrice += taxRate;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\treturn tax;\n\t\t},\n\t\tcalculateNetPrice: function(row) {\n\t\t\tthis.setNetPrice(row, this.getNetPrice(row));\n\t\t},\n\t\tcalculateGrossPrice: function(row) {\n\t\t\tvar netPrice = this.getNetPrice(row);\n\t\t\tif (this.isIndividualTaxMode(row) || this.isGroupTaxMode(row)) {\n\t\t\t\tnetPrice += this.getTax(row);\n\t\t\t}\n\t\t\tthis.setGrossPrice(row, netPrice);\n\t\t},\n\t\tcalculateTotalPrice: function(row) {\n\t\t\tthis.setTotalPrice(row, this.getTotalPrice(row));\n\t\t},\n\t\tcalculateMargin: function(row) {\n\t\t\tvar netPrice;\n\t\t\tif ($('.netPrice', row).length) {\n\t\t\t\tnetPrice = this.getNetPrice(row);\n\t\t\t} else {\n\t\t\t\tnetPrice = this.getTotalPrice(row) - this.getDiscount(row);\n\t\t\t}\n\t\t\tvar purchase = this.getPurchase(row);\n\t\t\tvar margin = netPrice - purchase;\n\t\t\tthis.setMargin(row, margin);\n\t\t\tvar marginp = '0';\n\t\t\tif (purchase !== 0) {\n\t\t\t\tmarginp = (margin / purchase) * 100;\n\t\t\t}\n\t\t\tthis.setMarginP(row, marginp);\n\t\t},\n\t\tcalculateDiscount: function(row, modal) {\n\t\t\tvar netPriceBeforeDiscount = App.Fields.Double.formatToDb(modal.find('.valueTotalPrice').text()),\n\t\t\t\tvaluePrices = netPriceBeforeDiscount,\n\t\t\t\tglobalDiscount = 0,\n\t\t\t\tgroupDiscount = 0,\n\t\t\t\tindividualDiscount = 0,\n\t\t\t\tvalueDiscount = 0;\n\n\t\t\tvar discountsType = modal.find('.discountsType').val();\n\n\t\t\tif (discountsType == '0' || discountsType == '1') {\n\t\t\t\tif (modal.find('.js-active .globalDiscount').length > 0) {\n\t\t\t\t\tglobalDiscount = App.Fields.Double.formatToDb(modal.find('.js-active .globalDiscount').val());\n\t\t\t\t}\n\t\t\t\tif (modal.find('.js-active .individualDiscountType').length > 0) {\n\t\t\t\t\tvar individualTypeDiscount = modal.find('.js-active .individualDiscountType:checked').val();\n\t\t\t\t\tvar value = App.Fields.Double.formatToDb(modal.find('.js-active .individualDiscountValue').val());\n\t\t\t\t\tif (individualTypeDiscount == 'percentage') {\n\t\t\t\t\t\tindividualDiscount = netPriceBeforeDiscount * (value / 100);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tindividualDiscount = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\tmodal.find('.js-active .groupCheckbox').length > 0 &&\n\t\t\t\t\tmodal.find('.js-active .groupCheckbox').prop('checked') == true\n\t\t\t\t) {\n\t\t\t\t\tgroupDiscount = App.Fields.Double.formatToDb(modal.find('.groupValue').val());\n\t\t\t\t\tgroupDiscount = netPriceBeforeDiscount * (groupDiscount / 100);\n\t\t\t\t}\n\n\t\t\t\tvaluePrices = valuePrices * ((100 - globalDiscount) / 100);\n\t\t\t\tvaluePrices = valuePrices - individualDiscount;\n\t\t\t\tvaluePrices = valuePrices - groupDiscount;\n\t\t\t} else if (discountsType == '2') {\n\t\t\t\tmodal.find('.js-active').each(function(index) {\n\t\t\t\t\tvar panel = $(this);\n\t\t\t\t\tif (panel.find('.globalDiscount').length > 0) {\n\t\t\t\t\t\tvar globalDiscount = App.Fields.Double.formatToDb(panel.find('.globalDiscount').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 - globalDiscount) / 100);\n\t\t\t\t\t} else if (panel.find('.groupCheckbox').length > 0 && panel.find('.groupCheckbox').prop('checked') == true) {\n\t\t\t\t\t\tvar groupDiscount = App.Fields.Double.formatToDb(panel.find('.groupValue').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 - groupDiscount) / 100);\n\t\t\t\t\t} else if (panel.find('.individualDiscountType').length > 0) {\n\t\t\t\t\t\tvar value = App.Fields.Double.formatToDb(panel.find('.individualDiscountValue').val());\n\t\t\t\t\t\tif (panel.find('.individualDiscountType[name=\"individualDiscountType\"]:checked').val() == 'percentage') {\n\t\t\t\t\t\t\tvaluePrices = valuePrices * ((100 - value) / 100);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvaluePrices = valuePrices - value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tmodal.find('.valuePrices').text(App.Fields.Double.formatToDisplay(valuePrices));\n\t\t\tmodal.find('.valueDiscount').text(App.Fields.Double.formatToDisplay(netPriceBeforeDiscount - valuePrices));\n\t\t},\n\t\tcalculateTax: function(row, modal) {\n\t\t\tvar netPriceWithoutTax = App.Fields.Double.formatToDb(modal.find('.valueNetPrice').text()),\n\t\t\t\tvaluePrices = netPriceWithoutTax,\n\t\t\t\tglobalTax = 0,\n\t\t\t\tgroupTax = 0,\n\t\t\t\tregionalTax = 0,\n\t\t\t\tindividualTax = 0;\n\n\t\t\tvar taxType = modal.find('.taxsType').val();\n\t\t\tif (taxType == '0' || taxType == '1') {\n\t\t\t\tif (modal.find('.js-active .globalTax').length > 0) {\n\t\t\t\t\tglobalTax = App.Fields.Double.formatToDb(modal.find('.js-active .globalTax').val());\n\t\t\t\t}\n\t\t\t\tif (modal.find('.js-active .individualTaxValue').length > 0) {\n\t\t\t\t\tvar value = App.Fields.Double.formatToDb(modal.find('.js-active .individualTaxValue').val());\n\t\t\t\t\tindividualTax = (value / 100) * valuePrices;\n\t\t\t\t}\n\t\t\t\tif (modal.find('.js-active .groupTax').length > 0) {\n\t\t\t\t\tgroupTax = App.Fields.Double.formatToDb(modal.find('.groupTax').val());\n\t\t\t\t\tgroupTax = netPriceWithoutTax * (groupTax / 100);\n\t\t\t\t}\n\t\t\t\tif (modal.find('.js-active .regionalTax').length > 0) {\n\t\t\t\t\tregionalTax = App.Fields.Double.formatToDb(modal.find('.regionalTax').val());\n\t\t\t\t\tregionalTax = netPriceWithoutTax * (regionalTax / 100);\n\t\t\t\t}\n\n\t\t\t\tvaluePrices = valuePrices * ((100 + globalTax) / 100);\n\t\t\t\tvaluePrices = valuePrices + individualTax;\n\t\t\t\tvaluePrices = valuePrices + groupTax;\n\t\t\t\tvaluePrices = valuePrices + regionalTax;\n\t\t\t} else if (taxType == '2') {\n\t\t\t\tmodal.find('.js-active').each(function(index) {\n\t\t\t\t\tvar panel = $(this);\n\t\t\t\t\tif (panel.find('.globalTax').length > 0) {\n\t\t\t\t\t\tvar globalTax = App.Fields.Double.formatToDb(panel.find('.globalTax').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 + globalTax) / 100);\n\t\t\t\t\t} else if (panel.find('.groupTax').length > 0) {\n\t\t\t\t\t\tvar groupTax = App.Fields.Double.formatToDb(panel.find('.groupTax').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 + groupTax) / 100);\n\t\t\t\t\t} else if (panel.find('.regionalTax').length > 0) {\n\t\t\t\t\t\tvar regionalTax = App.Fields.Double.formatToDb(panel.find('.regionalTax').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 + regionalTax) / 100);\n\t\t\t\t\t} else if (panel.find('.individualTaxValue').length > 0) {\n\t\t\t\t\t\tvar value = App.Fields.Double.formatToDb(panel.find('.individualTaxValue').val());\n\t\t\t\t\t\tvaluePrices = ((value + 100) / 100) * valuePrices;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (netPriceWithoutTax) {\n\t\t\t\tlet taxValue = ((valuePrices - netPriceWithoutTax) / netPriceWithoutTax) * 100;\n\t\t\t\tmodal.find('.js-tax-value').text(App.Fields.Double.formatToDisplay(taxValue));\n\t\t\t}\n\t\t\tmodal.find('.valuePrices').text(App.Fields.Double.formatToDisplay(valuePrices));\n\t\t\tmodal.find('.valueTax').text(App.Fields.Double.formatToDisplay(valuePrices - netPriceWithoutTax));\n\t\t},\n\t\tupdateRowSequence: function() {\n\t\t\tvar items = this.getInventoryItemsContainer();\n\t\t\titems.find(this.rowClass).each(function(index) {\n\t\t\t\t$(this)\n\t\t\t\t\t.find('.sequence')\n\t\t\t\t\t.val(index + 1);\n\t\t\t});\n\t\t},\n\t\tregisterInventorySaveData: function() {\n\t\t\tconst thisInstance = this;\n\t\t\tthisInstance.form.on(Vtiger_Edit_Js.recordPreSave, function(e, data) {\n\t\t\t\tthisInstance.syncHeaderData();\n\t\t\t\tif (!thisInstance.checkLimits(thisInstance.form)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tlet table = thisInstance.form.find('#blackIthemTable');\n\t\t\t\ttable.find('[name]').removeAttr('name');\n\t\t\t});\n\t\t},\n\t\tsyncHeaderData() {\n\t\t\tlet header = this.getInventoryHeadContainer();\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find('.js-sync')\n\t\t\t\t.each(function() {\n\t\t\t\t\tlet element = $(this);\n\t\t\t\t\telement.val(header.find('.js-' + element.data('syncId')).val());\n\t\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function which will be used to handle price book popup\n\t\t * @params :  element - popup image element\n\t\t */\n\t\tpricebooksModalHandler: function(element) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet lineItemRow = element.closest(this.rowClass);\n\t\t\tlet rowName = lineItemRow.find('.rowName');\n\t\t\tapp.showRecordsList(\n\t\t\t\t{\n\t\t\t\t\tmodule: 'PriceBooks',\n\t\t\t\t\tsrc_module: $('[name=\"popupReferenceModule\"]', rowName).val(),\n\t\t\t\t\tsrc_record: $('.sourceField', rowName).val(),\n\t\t\t\t\tsrc_field: $('[name=\"popupReferenceModule\"]', rowName).data('field'),\n\t\t\t\t\tcurrency_id: thisInstance.getCurrency() || CONFIG.defaultCurrencyId\n\t\t\t\t},\n\t\t\t\t(modal, instance) => {\n\t\t\t\t\tinstance.setSelectEvent(responseData => {\n\t\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\t\tmodule: 'PriceBooks',\n\t\t\t\t\t\t\taction: 'ProductListPrice',\n\t\t\t\t\t\t\trecord: responseData.id,\n\t\t\t\t\t\t\tsrc_record: $('.sourceField', rowName).val()\n\t\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\t\tif (data.result) {\n\t\t\t\t\t\t\t\tthisInstance.setUnitPrice(lineItemRow, data.result);\n\t\t\t\t\t\t\t\tthisInstance.quantityChangeActions(lineItemRow);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tapp.errorLog('Incorrect data', responseData);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\tsubProductsCashe: [],\n\t\tloadSubProducts: function(parentRow, indicator) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar recordId = $('input.sourceField', parentRow).val();\n\t\t\tvar recordModule = parentRow.find('.rowName input[name=\"popupReferenceModule\"]').val();\n\t\t\tthisInstance.removeSubProducts(parentRow);\n\t\t\tif (recordId == '0' || recordId == '' || $.inArray(recordModule, ['Products', 'Services']) < 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (thisInstance.subProductsCashe[recordId]) {\n\t\t\t\tthisInstance.addSubProducts(parentRow, thisInstance.subProductsCashe[recordId]);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar subProrductParams = {\n\t\t\t\tmodule: 'Products',\n\t\t\t\taction: 'SubProducts',\n\t\t\t\trecord: recordId\n\t\t\t};\n\t\t\tif (indicator) {\n\t\t\t\tvar progressInstace = $.progressIndicator();\n\t\t\t}\n\t\t\tAppConnector.request(subProrductParams)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tvar responseData = data.result;\n\t\t\t\t\tthisInstance.subProductsCashe[recordId] = responseData;\n\t\t\t\t\tthisInstance.addSubProducts(parentRow, responseData);\n\t\t\t\t\tif (progressInstace) {\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fail(function(error, err) {\n\t\t\t\t\tif (progressInstace) {\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\tremoveSubProducts: function(parentRow) {\n\t\t\tvar subProductsContainer = $('.subProductsContainer ul', parentRow);\n\t\t\tsubProductsContainer.find('li').remove();\n\t\t},\n\t\taddSubProducts: function(parentRow, responseData) {\n\t\t\tvar subProductsContainer = $('.subProductsContainer ul', parentRow);\n\t\t\tfor (var id in responseData) {\n\t\t\t\tvar priductText = $('<li>').text(responseData[id]);\n\t\t\t\tsubProductsContainer.append(priductText);\n\t\t\t}\n\t\t},\n\t\tmapResultsToFields: function(referenceModule, parentRow, responseData) {\n\t\t\tlet unit,\n\t\t\t\tunitPrice,\n\t\t\t\ttaxParam = [];\n\t\t\tvar thisInstance = this;\n\t\t\tvar isGroupTax = thisInstance.isGroupTaxMode();\n\t\t\tfor (var id in responseData) {\n\t\t\t\tvar recordData = responseData[id];\n\t\t\t\tvar description = recordData.description;\n\t\t\t\tvar unitPriceValues = recordData.unitPriceValues;\n\t\t\t\tvar unitPriceValuesJson = JSON.stringify(unitPriceValues);\n\t\t\t\t// Load taxses detail\n\t\t\t\tif (isGroupTax) {\n\t\t\t\t\tvar parameters = parentRow.closest('.inventoryItems').data('taxParam');\n\t\t\t\t\tif (parameters) {\n\t\t\t\t\t\ttaxParam = JSON.parse(parameters);\n\t\t\t\t\t}\n\t\t\t\t} else if (recordData['taxes']) {\n\t\t\t\t\ttaxParam = { aggregationType: recordData.taxes.type };\n\t\t\t\t\ttaxParam[recordData.taxes.type + 'Tax'] = recordData.taxes.value;\n\t\t\t\t}\n\t\t\t\tif (recordData['taxes']) {\n\t\t\t\t\tparentRow.find('.js-tax').attr('data-default-tax', App.Fields.Double.formatToDisplay(recordData.taxes.value));\n\t\t\t\t}\n\t\t\t\tthisInstance.setPurchase(parentRow, recordData.purchase);\n\t\t\t\tthisInstance.setTaxParam(parentRow, taxParam);\n\t\t\t\tthisInstance.setTax(parentRow, 0);\n\t\t\t\tthisInstance.setTaxPercent(parentRow, 0);\n\t\t\t\t// Load auto fields\n\t\t\t\tfor (var field in recordData['autoFields']) {\n\t\t\t\t\tparentRow.find('input.' + field).val(recordData['autoFields'][field]);\n\t\t\t\t\tif (recordData['autoFields'][field + 'Text']) {\n\t\t\t\t\t\tparentRow.find('.' + field + 'Text').text(recordData['autoFields'][field + 'Text']);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (recordData.price !== undefined) {\n\t\t\t\t\tthisInstance.setUnitPrice(parentRow, recordData.price);\n\t\t\t\t}\n\t\t\t\tif (unitPriceValuesJson !== undefined) {\n\t\t\t\t\t$('input.unitPrice', parentRow).attr('list-info', unitPriceValuesJson);\n\t\t\t\t}\n\t\t\t\tvar commentElement = $('textarea.commentTextarea', parentRow.next());\n\t\t\t\tvar editorInstance = CKEDITOR.instances[commentElement.attr('id')];\n\t\t\t\tif (editorInstance) {\n\t\t\t\t\teditorInstance.setData(description);\n\t\t\t\t} else {\n\t\t\t\t\tcommentElement.val(description);\n\t\t\t\t}\n\t\t\t\tif (typeof recordData['autoFields']['unit'] !== 'undefined') {\n\t\t\t\t\tunit = recordData['autoFields']['unit'];\n\t\t\t\t}\n\t\t\t\tthis.triggerQtyParam(unit, recordData.qtyPerUnit, parentRow);\n\t\t\t}\n\t\t\tif (referenceModule === 'Products') {\n\t\t\t\tthisInstance.loadSubProducts(parentRow, true);\n\t\t\t}\n\t\t\tthisInstance.quantityChangeActions(parentRow);\n\t\t},\n\t\t/**\n\t\t * Update qtyparam\n\t\t * @param {null|string} unit\n\t\t * @param int perUnit\n\t\t * @param {jQuery} parentRow\n\t\t */\n\t\ttriggerQtyParam(unit, perUnit, parentRow) {\n\t\t\tlet validationEngine;\n\t\t\tswitch (unit) {\n\t\t\t\tdefault:\n\t\t\t\t\t$('.qtyParamInfo', parentRow).addClass('d-none');\n\t\t\t\t\tvalidationEngine = 'validate[required,funcCall[Vtiger_NumberUserFormat_Validator_Js.invokeValidation]]';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'pack':\n\t\t\t\t\t$('.qtyParamInfo', parentRow)\n\t\t\t\t\t\t.removeClass('d-none')\n\t\t\t\t\t\t.removeClass('active');\n\t\t\t\t\t$('.qtyParamInfo', parentRow).attr('data-content', perUnit);\n\t\t\t\t\tvalidationEngine = 'validate[required,funcCall[Vtiger_WholeNumber_Validator_Js.invokeValidation]]';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'pcs':\n\t\t\t\t\t$('.qtyParamInfo', parentRow).addClass('d-none');\n\t\t\t\t\tvalidationEngine = 'validate[required,funcCall[Vtiger_WholeNumber_Validator_Js.invokeValidation]]';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t$('input.qty', parentRow).attr('data-validation-engine', validationEngine);\n\t\t},\n\t\tsaveDiscountsParameters: function(parentRow, modal) {\n\t\t\tvar thisInstance = this;\n\t\t\tlet info = {};\n\t\t\tlet typeName = 'aggregationType';\n\t\t\tlet panels = modal.find('[name=\"' + typeName + '\"]:checked');\n\t\t\tinfo[typeName] = [];\n\t\t\tpanels.each(function(i) {\n\t\t\t\tlet type = $(this).val(),\n\t\t\t\t\tcontainer = $(this).closest('.js-panel');\n\t\t\t\tif (panels.length > 1) {\n\t\t\t\t\tinfo[typeName].push(type);\n\t\t\t\t} else {\n\t\t\t\t\tinfo[typeName] = type;\n\t\t\t\t}\n\t\t\t\tcontainer.find('[name=\"' + type + 'Discount\"]').each(function() {\n\t\t\t\t\tlet param = type + 'Discount';\n\t\t\t\t\tlet element = $(this);\n\t\t\t\t\tif ('global' === type) {\n\t\t\t\t\t\tinfo[param] = element.val();\n\t\t\t\t\t} else if (\n\t\t\t\t\t\t'group' === type &&\n\t\t\t\t\t\telement\n\t\t\t\t\t\t\t.closest('.input-group')\n\t\t\t\t\t\t\t.find('.groupCheckbox')\n\t\t\t\t\t\t\t.prop('checked')\n\t\t\t\t\t) {\n\t\t\t\t\t\tinfo[param] = App.Fields.Double.formatToDb(element.val());\n\t\t\t\t\t} else if ('individual' === type) {\n\t\t\t\t\t\tlet name = 'individualDiscountType';\n\t\t\t\t\t\tinfo[name] = container.find('[name=\"' + name + '\"]:checked').val();\n\t\t\t\t\t\tinfo[param] = App.Fields.Double.formatToDb(element.val());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tthisInstance.setDiscountParam($('#blackIthemTable'), info);\n\t\t\tthisInstance.setDiscountParam(parentRow, info);\n\t\t},\n\t\tsaveTaxsParameters: function(parentRow, modal) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar info = {};\n\t\t\tvar extend = ['aggregationType', 'groupCheckbox', 'individualTaxType'];\n\t\t\t$.each(thisInstance.taxModalFields, function(index, param) {\n\t\t\t\tif ($.inArray(param, extend) >= 0) {\n\t\t\t\t\tif (modal.find('[name=\"' + param + '\"]:checked').length > 1) {\n\t\t\t\t\t\tinfo[param] = [];\n\t\t\t\t\t\tmodal.find('[name=\"' + param + '\"]:checked').each(function(index) {\n\t\t\t\t\t\t\tinfo[param].push($(this).val());\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinfo[param] = modal.find('[name=\"' + param + '\"]:checked').val();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tinfo[param] = App.Fields.Double.formatToDb(modal.find('[name=\"' + param + '\"]').val());\n\t\t\t\t}\n\t\t\t});\n\t\t\tparentRow.data('taxParam', JSON.stringify(info));\n\t\t\tthisInstance.setTaxParam(parentRow, info);\n\t\t\tthisInstance.setTaxParam($('#blackIthemTable'), info);\n\t\t},\n\t\tshowExpandedRow: function(row) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar items = thisInstance.getInventoryItemsContainer();\n\t\t\tvar inventoryRowExpanded = items.find('[numrowex=\"' + row.attr('numrow') + '\"]');\n\t\t\tvar element = row.find('.toggleVisibility');\n\t\t\telement.data('status', '1');\n\t\t\tinventoryRowExpanded.removeClass('d-none');\n\t\t\tvar listInstance = Vtiger_Edit_Js.getInstance();\n\t\t\t$.each(inventoryRowExpanded.find('.js-editor'), function(key, data) {\n\t\t\t\tlistInstance.loadEditorElement($(data));\n\t\t\t});\n\t\t},\n\t\thideExpandedRow: function(row) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar items = thisInstance.getInventoryItemsContainer();\n\t\t\tvar inventoryRowExpanded = items.find('[numrowex=\"' + row.attr('numrow') + '\"]');\n\t\t\tvar element = row.find('.toggleVisibility');\n\t\t\telement.data('status', '0');\n\t\t\tinventoryRowExpanded.addClass('d-none');\n\t\t\t$.each(inventoryRowExpanded.find('.js-editor'), function(key, data) {\n\t\t\t\tvar editorInstance = CKEDITOR.instances[$(data).attr('id')];\n\t\t\t\tif (editorInstance) {\n\t\t\t\t\teditorInstance.destroy();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tinitDiscountsParameters: function(parentRow, modal) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar parameters = parentRow.find('.discountParam').val();\n\t\t\tif (parameters == '' || parameters == undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tparameters = JSON.parse(parameters);\n\t\t\t$.each(thisInstance.discountModalFields, function(index, param) {\n\t\t\t\tlet parameter = parameters[param];\n\t\t\t\tlet field = modal.find('[name=\"' + param + '\"]');\n\t\t\t\tif (field.attr('type') == 'checkbox' || field.attr('type') == 'radio') {\n\t\t\t\t\tif ('groupCheckbox' === param && parameters['groupDiscount'] !== undefined) {\n\t\t\t\t\t\tfield.prop('checked', true);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tvar array = parameter;\n\t\t\t\t\tif (!$.isArray(array)) {\n\t\t\t\t\t\tarray = [array];\n\t\t\t\t\t}\n\t\t\t\t\t$.each(array, function(index, arrayValue) {\n\t\t\t\t\t\tvar value = field.filter('[value=\"' + arrayValue + '\"]').prop('checked', true);\n\t\t\t\t\t\tif (param == 'aggregationType') {\n\t\t\t\t\t\t\tvalue\n\t\t\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\t\t\tvalue.closest('.js-panel').addClass('js-active');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else if (field.prop('tagName') == 'SELECT') {\n\t\t\t\t\tfield\n\t\t\t\t\t\t.find('option[value=\"' + parameter + '\"]')\n\t\t\t\t\t\t.prop('selected', 'selected')\n\t\t\t\t\t\t.change();\n\t\t\t\t} else if (!field.prop('readonly')) {\n\t\t\t\t\tfield.val(parameter);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthisInstance.calculateDiscount(parentRow, modal);\n\t\t},\n\t\tinitTaxParameters: function(parentRow, modal) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet parameters;\n\t\t\tif (parentRow.data('taxParam')) {\n\t\t\t\tparameters = parentRow.data('taxParam');\n\t\t\t} else {\n\t\t\t\tparameters = parentRow.find('.taxParam').val();\n\t\t\t}\n\t\t\tif (!parameters) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tparameters = JSON.parse(parameters.toString());\n\t\t\t$.each(thisInstance.taxModalFields, function(index, param) {\n\t\t\t\tlet parameter = parameters[param],\n\t\t\t\t\tfield = modal.find('[name=\"' + param + '\"]');\n\n\t\t\t\tif (field.attr('type') === 'checkbox' || field.attr('type') === 'radio') {\n\t\t\t\t\tlet array = parameter,\n\t\t\t\t\t\tvalue;\n\t\t\t\t\tif (!$.isArray(array)) {\n\t\t\t\t\t\tarray = [array];\n\t\t\t\t\t}\n\t\t\t\t\t$.each(array, function(index, arrayValue) {\n\t\t\t\t\t\tvalue = field.filter('[value=\"' + arrayValue + '\"]').prop('checked', true);\n\t\t\t\t\t\tif (param === 'aggregationType') {\n\t\t\t\t\t\t\tvalue\n\t\t\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\t\t\tvalue.closest('.js-panel').addClass('js-active');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else if (field.prop('tagName') === 'SELECT') {\n\t\t\t\t\tfield\n\t\t\t\t\t\t.find('option[value=\"' + parameter + '\"]')\n\t\t\t\t\t\t.prop('selected', 'selected')\n\t\t\t\t\t\t.change();\n\t\t\t\t} else {\n\t\t\t\t\tlet input = modal.find('[name=\"' + param + '\"]');\n\t\t\t\t\tinput.val(parameter);\n\t\t\t\t\tif (param === 'individualTax') {\n\t\t\t\t\t\tinput.formatNumber();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tthisInstance.calculateTax(parentRow, modal);\n\t\t},\n\t\tlimitEnableSave: false,\n\t\tcheckLimits: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar account = thisInstance.getAccountId();\n\t\t\tvar limit = parseInt(app.getMainParams('inventoryLimit'));\n\t\t\tvar response = true;\n\n\t\t\tif (account == '' || thisInstance.limitEnableSave || !limit) {\n\t\t\t\treturn response;\n\t\t\t}\n\n\t\t\tvar params = {};\n\t\t\tparams.data = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'Inventory',\n\t\t\t\tmode: 'checkLimits',\n\t\t\t\trecord: account,\n\t\t\t\tcurrency: thisInstance.getCurrency(),\n\t\t\t\tprice: thisInstance.getSummaryGrossPrice()\n\t\t\t};\n\t\t\tparams.async = false;\n\t\t\tparams.dataType = 'json';\n\t\t\tvar progressInstace = $.progressIndicator();\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\tif (data.result.status == false) {\n\t\t\t\t\t\tapp.showModalWindow(data.result.html, function(data) {});\n\t\t\t\t\t\tresponse = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fail(function(error, err) {\n\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t});\n\t\t\treturn response;\n\t\t},\n\t\tcurrencyChangeActions: function(select, option) {\n\t\t\tif (option.data('baseCurrency') !== select.val()) {\n\t\t\t\tthis.showCurrencyChangeModal(select, option);\n\t\t\t} else {\n\t\t\t\tthis.currencyConvertValues(select, option);\n\t\t\t\tselect.data('oldValue', select.val());\n\t\t\t}\n\t\t},\n\t\tshowCurrencyChangeModal: function(select, option) {\n\t\t\tvar thisInstance = this;\n\t\t\tif (thisInstance.lockCurrencyChange == true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthisInstance.lockCurrencyChange = true;\n\t\t\tvar block = select.closest('th');\n\t\t\tvar modal = block.find('.modelContainer').clone();\n\t\t\tapp.showModalWindow(modal, function(data) {\n\t\t\t\tvar modal = $(data);\n\t\t\t\tvar currencyParam = JSON.parse(block.find('.js-currencyparam').val());\n\n\t\t\t\tif (currencyParam != false) {\n\t\t\t\t\tif (typeof currencyParam[option.val()] === 'undefined') {\n\t\t\t\t\t\tvar defaultCurrencyParams = {\n\t\t\t\t\t\t\tvalue: 1,\n\t\t\t\t\t\t\tdate: ''\n\t\t\t\t\t\t};\n\t\t\t\t\t\tcurrencyParam[option.val()] = defaultCurrencyParams;\n\t\t\t\t\t}\n\t\t\t\t\tmodal.find('.currencyName').text(option.text());\n\t\t\t\t\tmodal.find('.currencyRate').val(currencyParam[option.val()]['value']);\n\t\t\t\t\tmodal.find('.currencyDate').text(currencyParam[option.val()]['date']);\n\t\t\t\t}\n\t\t\t\tmodal\n\t\t\t\t\t.on('click', 'button[type=\"submit\"]', function(e) {\n\t\t\t\t\t\tvar rate = modal.find('.currencyRate').val();\n\t\t\t\t\t\tvar value = App.Fields.Double.formatToDb(rate);\n\t\t\t\t\t\tvar conversionRate = 1 / App.Fields.Double.formatToDb(rate);\n\n\t\t\t\t\t\toption.data('conversionRate', conversionRate);\n\t\t\t\t\t\tcurrencyParam[option.val()] = {\n\t\t\t\t\t\t\tdate: option.data('conversionDate'),\n\t\t\t\t\t\t\tvalue: value.toString(),\n\t\t\t\t\t\t\tconversion: conversionRate.toString()\n\t\t\t\t\t\t};\n\t\t\t\t\t\tblock.find('.js-currencyparam').val(JSON.stringify(currencyParam));\n\n\t\t\t\t\t\tthisInstance.currencyConvertValues(select, option);\n\t\t\t\t\t\tselect.data('oldValue', select.val());\n\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t\tthisInstance.lockCurrencyChange = false;\n\t\t\t\t\t})\n\t\t\t\t\t.one('hidden.bs.modal', function() {\n\t\t\t\t\t\tselect.val(select.data('oldValue')).change();\n\t\t\t\t\t\tthisInstance.lockCurrencyChange = false;\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tcurrencyConvertValues: function(select, selected) {\n\t\t\tvar thisInstance = this;\n\n\t\t\tvar previous = select.find('option[value=\"' + select.data('oldValue') + '\"]');\n\t\t\tvar conversionRate = selected.data('conversionRate');\n\t\t\tvar prevConversionRate = previous.data('conversionRate');\n\t\t\tconversionRate = parseFloat(conversionRate) / parseFloat(prevConversionRate);\n\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function(index) {\n\t\t\t\t\tvar row = $(this);\n\n\t\t\t\t\tthisInstance.setUnitPrice(\n\t\t\t\t\t\trow,\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(thisInstance.getUnitPriceValue(row) * conversionRate)\n\t\t\t\t\t);\n\t\t\t\t\tthisInstance.setDiscount(row, App.Fields.Double.formatToDb(thisInstance.getDiscount(row) * conversionRate));\n\t\t\t\t\tthisInstance.setTax(row, App.Fields.Double.formatToDb(thisInstance.getTax(row) * conversionRate));\n\t\t\t\t\tthisInstance.quantityChangeActions(row);\n\t\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Set up all row data that comes from request\n\t\t * @param {jQuery} row\n\t\t * @param {object} rowData\n\t\t */\n\t\tsetRowData(row, rowData) {\n\t\t\tthis.setName(row, rowData.name, rowData.info.name);\n\t\t\tthis.setQuantity(row, rowData.qty);\n\t\t\tthis.setUnit(row, rowData.info.autoFields.unit, rowData.info.autoFields.unitText);\n\t\t\tif (typeof rowData.info.autoFields !== 'undefined' && typeof rowData.info.autoFields.subunit !== 'undefined') {\n\t\t\t\tthis.setSubUnit(row, rowData.info.autoFields.subunit, rowData.info.autoFields.subunitText);\n\t\t\t}\n\t\t\tthis.setComment(row, rowData.comment1);\n\t\t\tthis.setUnitPrice(row, rowData.price);\n\t\t\tthis.setNetPrice(row, rowData.net);\n\t\t\tthis.setGrossPrice(row, rowData.gross);\n\t\t\tthis.setTotalPrice(row, rowData.total);\n\t\t\tlet discountParam = rowData.discountparam || null;\n\t\t\tthis.setDiscountParam(row, JSON.parse(discountParam));\n\t\t\tthis.setDiscount(row, rowData.discount);\n\t\t\tthis.setTaxParam(row, JSON.parse(rowData.taxparam));\n\t\t\tthis.setTax(row, rowData.tax);\n\t\t\tthis.setTaxPercent(row, rowData.tax_percent);\n\t\t},\n\t\t/**\n\t\t * Add new row to inventory list\n\t\t * @param {string} module\n\t\t * @param {string} baseTableId\n\t\t * @param {object} rowData [optional]\n\t\t */\n\t\taddItem(module, baseTableId, rowData = false) {\n\t\t\tconst items = this.getInventoryItemsContainer();\n\t\t\tlet newRow = this.getBasicRow();\n\t\t\tconst sequenceNumber = this.getNextLineItemRowNumber();\n\t\t\tconst replaced = newRow.html().replace(/\\_NUM_/g, sequenceNumber);\n\t\t\tconst moduleLbls = newRow.data('moduleLbls');\n\t\t\tnewRow.html(replaced);\n\t\t\tnewRow = newRow.children().appendTo(items.find('.js-inventory-items-body'));\n\t\t\tnewRow\n\t\t\t\t.find('.rowName input[name=\"popupReferenceModule\"]')\n\t\t\t\t.val(module)\n\t\t\t\t.data('field', baseTableId);\n\t\t\tnewRow\n\t\t\t\t.find('.js-module-icon')\n\t\t\t\t.removeClass()\n\t\t\t\t.addClass(`userIcon-${module}`);\n\t\t\tnewRow.find('.rowName span.input-group-text').attr('data-content', moduleLbls[module]);\n\t\t\tnewRow.find('.colPicklistField select').each(function(index, select) {\n\t\t\t\tselect = $(select);\n\t\t\t\tselect.find('option').each(function(index, option) {\n\t\t\t\t\toption = $(option);\n\t\t\t\t\tif (option.data('module') !== module) {\n\t\t\t\t\t\toption.remove();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.initItem(newRow);\n\t\t\tVtiger_Edit_Js.getInstance().registerAutoCompleteFields(newRow);\n\t\t\tif (rowData) {\n\t\t\t\tthis.setRowData(newRow, rowData);\n\t\t\t\tthis.quantityChangeActions(newRow);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Register add item button click\n\t\t * @param {jQuery} container\n\t\t */\n\t\tregisterAddItem() {\n\t\t\tconst thisInstance = this;\n\t\t\tconst itemsHeader = thisInstance.getInventoryHeadContainer();\n\t\t\titemsHeader.find('.js-inv-add-item').on('click', function(e) {\n\t\t\t\tconst btn = $(this);\n\t\t\t\tthisInstance.addItem(btn.data('module'), btn.data('field'));\n\t\t\t});\n\t\t},\n\t\tregisterSortableItems: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar items = thisInstance.getInventoryItemsContainer();\n\t\t\titems.sortable({\n\t\t\t\thandle: '.dragHandle',\n\t\t\t\titems: thisInstance.rowClass,\n\t\t\t\trevert: true,\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\tplaceholder: 'ui-state-highlight',\n\t\t\t\thelper: function(e, ui) {\n\t\t\t\t\tui.children().each(function(index, element) {\n\t\t\t\t\t\telement = $(element);\n\t\t\t\t\t\telement.width(element.width());\n\t\t\t\t\t});\n\t\t\t\t\treturn ui;\n\t\t\t\t},\n\t\t\t\tstart: function(event, ui) {\n\t\t\t\t\titems.find(thisInstance.rowClass).each(function(index, element) {\n\t\t\t\t\t\tvar row = $(element);\n\t\t\t\t\t\tthisInstance.hideExpandedRow(row);\n\t\t\t\t\t});\n\t\t\t\t\tui.item.startPos = ui.item.index();\n\t\t\t\t},\n\t\t\t\tstop: function(event, ui) {\n\t\t\t\t\tvar numrow = $(ui.item).attr('numrow');\n\t\t\t\t\tvar child = items\n\t\t\t\t\t\t.find('.numRow' + numrow)\n\t\t\t\t\t\t.remove()\n\t\t\t\t\t\t.clone();\n\t\t\t\t\titems.find('[numrow=\"' + numrow + '\"]').after(child);\n\t\t\t\t\tif (ui.item.startPos < ui.item.index()) {\n\t\t\t\t\t\tchild = items\n\t\t\t\t\t\t\t.find('.numRow' + numrow)\n\t\t\t\t\t\t\t.next()\n\t\t\t\t\t\t\t.remove()\n\t\t\t\t\t\t\t.clone();\n\t\t\t\t\t\titems.find('[numrow=\"' + numrow + '\"]').before(child);\n\t\t\t\t\t}\n\t\t\t\t\tthisInstance.updateRowSequence();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterShowHideExpanded: function() {\n\t\t\tconst thisInstance = this;\n\t\t\tthisInstance.form.on('click', '.toggleVisibility', function(e) {\n\t\t\t\tvar element = $(e.currentTarget);\n\t\t\t\tvar row = thisInstance.getClosestRow(element);\n\t\t\t\tif (element.data('status') == 0) {\n\t\t\t\t\tthisInstance.showExpandedRow(row);\n\t\t\t\t} else {\n\t\t\t\t\tthisInstance.hideExpandedRow(row);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterPriceBookModal: function(container) {\n\t\t\tvar thisInstance = this;\n\t\t\tcontainer.find('.js-price-book-modal').on('click', function(e) {\n\t\t\t\tvar element = $(e.currentTarget);\n\t\t\t\tvar response = thisInstance.isRecordSelected(element);\n\t\t\t\tif (response == true) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthisInstance.pricebooksModalHandler(element);\n\t\t\t});\n\t\t},\n\t\tregisterRowChangeEvent: function(container) {\n\t\t\tcontainer.on('focusout', '.qty', e => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\telement.formatNumber();\n\t\t\t\tthis.quantityChangeActions(this.getClosestRow(element));\n\t\t\t});\n\t\t\tcontainer.on('focusout', '.unitPrice', e => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\telement.formatNumber();\n\t\t\t\tthis.quantityChangeActions(this.getClosestRow(element));\n\t\t\t});\n\t\t\tcontainer.on('focusout', '.purchase', e => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\telement.formatNumber();\n\t\t\t\tthis.quantityChangeActions(this.getClosestRow(element));\n\t\t\t});\n\t\t\tvar headContainer = this.getInventoryHeadContainer();\n\t\t\theadContainer.on('change', '.js-taxmode', e => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tthis.showIndividualTax(this.getClosestRow(element));\n\t\t\t\tthis.rowsCalculations();\n\t\t\t});\n\t\t\theadContainer.on('change', '.js-discountmode', e => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tthis.showIndividualDiscount(this.getClosestRow(element));\n\t\t\t\tthis.rowsCalculations();\n\t\t\t});\n\t\t},\n\t\tregisterSubProducts: function() {\n\t\t\tconst thisInstance = this;\n\t\t\tthisInstance.form.find('.inventoryItems ' + thisInstance.rowClass).each(function(index) {\n\t\t\t\tthisInstance.loadSubProducts($(this), false);\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Register clear reference selection\n\t\t */\n\t\tregisterClearReferenceSelection() {\n\t\t\tthis.form.on('click', '.clearReferenceSelection', e => {\n\t\t\t\tconst referenceGroup = $(e.currentTarget).closest('div.referenceGroup');\n\t\t\t\tif (referenceGroup.length) {\n\t\t\t\t\treferenceGroup\n\t\t\t\t\t\t.find('input[id$=\"_display\"]')\n\t\t\t\t\t\t.val('')\n\t\t\t\t\t\t.removeAttr('readonly');\n\t\t\t\t} else {\n\t\t\t\t\tconst row = this.getClosestRow($(e.currentTarget));\n\t\t\t\t\tthis.removeSubProducts(row);\n\t\t\t\t\trow\n\t\t\t\t\t\t.find('.unitPrice,.tax,.discount,.margin,.purchase,.js-tax-percent')\n\t\t\t\t\t\t.val(App.Fields.Double.formatToDisplay(0));\n\t\t\t\t\trow.find('.qty').val(1);\n\t\t\t\t\trow.find('textarea,.valueVal').val('');\n\t\t\t\t\trow.find('.valueText').text('');\n\t\t\t\t\trow.find('.qtyParamInfo').addClass('d-none');\n\t\t\t\t\trow\n\t\t\t\t\t\t.find('.recordLabel')\n\t\t\t\t\t\t.val('')\n\t\t\t\t\t\t.removeAttr('readonly');\n\t\t\t\t\tif (!this.isGroupTaxMode()) {\n\t\t\t\t\t\tthis.setTaxParam(row, []);\n\t\t\t\t\t}\n\t\t\t\t\tthis.quantityChangeActions(row);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterDeleteLineItemEvent: function(container) {\n\t\t\tvar thisInstance = this;\n\t\t\tcontainer.on('click', '.deleteRow', function(e) {\n\t\t\t\tlet num = thisInstance.getClosestRow($(e.currentTarget)).attr('numrow');\n\t\t\t\tthisInstance\n\t\t\t\t\t.getInventoryItemsContainer()\n\t\t\t\t\t.find('[numrow=\"' + num + '\"], [numrowex=\"' + num + '\"]')\n\t\t\t\t\t.remove();\n\t\t\t\tthisInstance.checkDeleteIcon();\n\t\t\t\tthisInstance.rowsCalculations();\n\t\t\t\tif (thisInstance.getInventoryItemsContainer().find('.inventoryRow').length === 0) {\n\t\t\t\t\t$('#inventoryItemsNo').val(0);\n\t\t\t\t}\n\t\t\t\tthisInstance.updateRowSequence();\n\t\t\t});\n\t\t},\n\t\tregisterChangeDiscount: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tthisInstance.form.on('click', '.changeDiscount', function(e) {\n\t\t\t\tvar parentRow;\n\t\t\t\tvar element = $(e.currentTarget);\n\t\t\t\tvar params = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Inventory',\n\t\t\t\t\tmode: 'showDiscounts',\n\t\t\t\t\tcurrency: thisInstance.getCurrency(),\n\t\t\t\t\trelatedRecord: thisInstance.getAccountId()\n\t\t\t\t};\n\t\t\t\tif (element.hasClass('groupDiscount')) {\n\t\t\t\t\tparentRow = thisInstance.getInventoryItemsContainer();\n\t\t\t\t\tif (parentRow.find('tfoot .colTotalPrice').length != 0) {\n\t\t\t\t\t\tparams.totalPrice = App.Fields.Double.formatToDb(parentRow.find('tfoot .colTotalPrice').text());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tparams.totalPrice = 0;\n\t\t\t\t\t}\n\t\t\t\t\tparams.discountType = 1;\n\t\t\t\t} else {\n\t\t\t\t\tparentRow = element.closest(thisInstance.rowClass);\n\t\t\t\t\tparams.totalPrice = thisInstance.getTotalPrice(parentRow);\n\t\t\t\t\tparams.discountType = 0;\n\t\t\t\t}\n\n\t\t\t\tvar progressInstace = $.progressIndicator();\n\t\t\t\tAppConnector.request(params)\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tapp.showModalWindow(data, function(data) {\n\t\t\t\t\t\t\tthisInstance.initDiscountsParameters(parentRow, $(data));\n\t\t\t\t\t\t\tthisInstance.registerChangeDiscountModal(data, parentRow, params);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(error, err) {\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tregisterChangeDiscountModal: function(modal, parentRow, params) {\n\t\t\tvar thisInstance = this;\n\t\t\tmodal.on('change', '.individualDiscountType', function(e) {\n\t\t\t\tvar element = $(e.currentTarget);\n\t\t\t\tmodal.find('.individualDiscountContainer .input-group-text').text(element.data('symbol'));\n\t\t\t});\n\t\t\tmodal.on('change', '.activeCheckbox[name=\"aggregationType\"]', function(e) {\n\t\t\t\tvar element = $(e.currentTarget);\n\n\t\t\t\tif (element.attr('type') == 'checkbox' && this.checked) {\n\t\t\t\t\telement\n\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').addClass('js-active');\n\t\t\t\t} else if (element.attr('type') == 'radio') {\n\t\t\t\t\tmodal.find('.js-panel').removeClass('js-active');\n\t\t\t\t\tmodal.find('.js-panel .js-panel__body').addClass('d-none');\n\t\t\t\t\telement\n\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').addClass('js-active');\n\t\t\t\t} else {\n\t\t\t\t\telement\n\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t.addClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').removeClass('js-active');\n\t\t\t\t}\n\t\t\t});\n\t\t\tmodal.on(\n\t\t\t\t'change',\n\t\t\t\t'.activeCheckbox, .globalDiscount,.individualDiscountValue,.individualDiscountType,.groupCheckbox',\n\t\t\t\tfunction(e) {\n\t\t\t\t\tthisInstance.calculateDiscount(parentRow, modal);\n\t\t\t\t}\n\t\t\t);\n\t\t\tmodal.on('click', '.saveDiscount', function(e) {\n\t\t\t\tthisInstance.saveDiscountsParameters(parentRow, modal);\n\t\t\t\tif (params.discountType == 0) {\n\t\t\t\t\tthisInstance.setDiscount(parentRow, App.Fields.Double.formatToDb(modal.find('.valueDiscount').text()));\n\t\t\t\t\tthisInstance.quantityChangeActions(parentRow);\n\t\t\t\t} else {\n\t\t\t\t\tvar rate =\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.valueDiscount').text()) /\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.valueTotalPrice').text());\n\t\t\t\t\tparentRow.find(thisInstance.rowClass).each(function(index) {\n\t\t\t\t\t\tthisInstance.setDiscount($(this), thisInstance.getTotalPrice($(this)) * rate);\n\t\t\t\t\t\tthisInstance.quantityChangeActions($(this));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tapp.hideModalWindow();\n\t\t\t});\n\t\t},\n\t\tregisterChangeTax: function() {\n\t\t\tconst thisInstance = this;\n\t\t\tthisInstance.form.on('click', '.changeTax', function(e) {\n\t\t\t\tvar parentRow;\n\t\t\t\tvar element = $(e.currentTarget);\n\t\t\t\tvar params = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Inventory',\n\t\t\t\t\tmode: 'showTaxes',\n\t\t\t\t\tcurrency: thisInstance.getCurrency(),\n\t\t\t\t\tsourceRecord: app.getRecordId()\n\t\t\t\t};\n\t\t\t\tif (element.hasClass('groupTax')) {\n\t\t\t\t\tparentRow = thisInstance.getInventoryItemsContainer();\n\t\t\t\t\tvar totalPrice = 0;\n\t\t\t\t\tif (parentRow.find('tfoot .colNetPrice').length > 0) {\n\t\t\t\t\t\ttotalPrice = parentRow.find('tfoot .colNetPrice').text();\n\t\t\t\t\t} else if (parentRow.find('tfoot .colTotalPrice ').length > 0) {\n\t\t\t\t\t\ttotalPrice = parentRow.find('tfoot .colTotalPrice ').text();\n\t\t\t\t\t}\n\t\t\t\t\tparams.totalPrice = App.Fields.Double.formatToDb(totalPrice);\n\t\t\t\t\tparams.taxType = 1;\n\t\t\t\t} else {\n\t\t\t\t\tparentRow = element.closest(thisInstance.rowClass);\n\t\t\t\t\tlet sourceRecord = parentRow.find('.rowName .sourceField').val();\n\t\t\t\t\tparams.totalPrice = thisInstance.getNetPrice(parentRow);\n\t\t\t\t\tparams.taxType = 0;\n\t\t\t\t\tif (sourceRecord) {\n\t\t\t\t\t\tparams.record = sourceRecord;\n\t\t\t\t\t}\n\t\t\t\t\tparams.recordModule = parentRow.find('.rowName [name=\"popupReferenceModule\"]').val();\n\t\t\t\t}\n\t\t\t\tvar progressInstace = $.progressIndicator();\n\t\t\t\tAppConnector.request(params)\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tapp.showModalWindow(data, function(data) {\n\t\t\t\t\t\t\tthisInstance.initTaxParameters(parentRow, $(data));\n\t\t\t\t\t\t\tthisInstance.registerChangeTaxModal(data, parentRow, params);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(error, err) {\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tlockCurrencyChange: false,\n\t\tregisterChangeCurrency() {\n\t\t\tthis.getInventoryHeadContainer().on('change', '.js-currency', e => {\n\t\t\t\tlet element = $(e.currentTarget),\n\t\t\t\t\tsymbol = element.find('option:selected').data('conversionSymbol');\n\t\t\t\tthis.currencyChangeActions(element, element.find('option:selected'));\n\t\t\t\tthis.form.find('.currencySymbol').text(symbol);\n\t\t\t});\n\t\t},\n\t\tregisterChangeTaxModal: function(modal, parentRow, params) {\n\t\t\tvar thisInstance = this;\n\t\t\tmodal.on('change', '.individualTaxType', function(e) {\n\t\t\t\tvar element = $(e.currentTarget);\n\t\t\t\tmodal.find('.individualTaxContainer .input-group-text').text(element.data('symbol'));\n\t\t\t});\n\t\t\tmodal.on('change', '.activeCheckbox[name=\"aggregationType\"]', function(e) {\n\t\t\t\tvar element = $(e.currentTarget);\n\n\t\t\t\tif (element.attr('type') == 'checkbox' && this.checked) {\n\t\t\t\t\telement\n\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').addClass('js-active');\n\t\t\t\t} else if (element.attr('type') == 'radio') {\n\t\t\t\t\tmodal.find('.js-panel').removeClass('js-active');\n\t\t\t\t\tmodal.find('.js-panel .js-panel__body').addClass('d-none');\n\t\t\t\t\telement\n\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').addClass('js-active');\n\t\t\t\t} else {\n\t\t\t\t\telement\n\t\t\t\t\t\t.closest('.js-panel')\n\t\t\t\t\t\t.find('.js-panel__body')\n\t\t\t\t\t\t.addClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').removeClass('js-active');\n\t\t\t\t}\n\t\t\t});\n\t\t\tmodal.on('change', '.activeCheckbox, .globalTax, .individualTaxValue, .groupTax, .regionalTax', function(e) {\n\t\t\t\tthisInstance.calculateTax(parentRow, modal);\n\t\t\t});\n\t\t\tmodal.on('click', '.saveTaxs', function(e) {\n\t\t\t\tthisInstance.saveTaxsParameters(parentRow, modal);\n\t\t\t\tif (params.taxType == '0') {\n\t\t\t\t\tthisInstance.setTax(parentRow, App.Fields.Double.formatToDb(modal.find('.valueTax').text()));\n\t\t\t\t\tthisInstance.setTaxPercent(parentRow, App.Fields.Double.formatToDb(modal.find('.js-tax-value').text()));\n\t\t\t\t\tthisInstance.quantityChangeActions(parentRow);\n\t\t\t\t} else {\n\t\t\t\t\tvar rate =\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.valueTax').text()) /\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.valueNetPrice').text());\n\t\t\t\t\tparentRow.find(thisInstance.rowClass).each(function(index) {\n\t\t\t\t\t\tvar totalPrice;\n\t\t\t\t\t\tif ($('.netPrice', $(this)).length > 0) {\n\t\t\t\t\t\t\ttotalPrice = thisInstance.getNetPrice($(this));\n\t\t\t\t\t\t} else if ($('.totalPrice', $(this)).length > 0) {\n\t\t\t\t\t\t\ttotalPrice = thisInstance.getTotalPrice($(this));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthisInstance.setTax($(this), totalPrice * rate);\n\t\t\t\t\t\tthisInstance.setTaxPercent($(this), App.Fields.Double.formatToDb(modal.find('.js-tax-value').text()));\n\t\t\t\t\t\tthisInstance.quantityChangeActions($(this));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tapp.hideModalWindow();\n\t\t\t});\n\t\t},\n\t\tregisterRowAutoComplete: function(container) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet sourceFieldElement = container.find('.sourceField.js-name');\n\t\t\tsourceFieldElement.on(Vtiger_Edit_Js.referenceSelectionEvent, function(e, params) {\n\t\t\t\tvar record = params.record;\n\t\t\t\tvar element = $(e.currentTarget);\n\t\t\t\tvar parentRow = element.closest(thisInstance.rowClass);\n\t\t\t\tvar selectedModule = parentRow.find('.rowName [name=\"popupReferenceModule\"]').val();\n\t\t\t\tvar dataUrl =\n\t\t\t\t\t'index.php?module=' +\n\t\t\t\t\tapp.getModuleName() +\n\t\t\t\t\t'&action=Inventory&mode=getDetails&record=' +\n\t\t\t\t\trecord +\n\t\t\t\t\t'&fieldname=' +\n\t\t\t\t\telement.data('columnname');\n\t\t\t\tif (thisInstance.getCurrency()) {\n\t\t\t\t\tdataUrl += '&currency_id=' + thisInstance.getCurrency();\n\t\t\t\t}\n\t\t\t\tAppConnector.request(dataUrl).done(function(data) {\n\t\t\t\t\tfor (var id in data) {\n\t\t\t\t\t\tif (typeof data[id] == 'object') {\n\t\t\t\t\t\t\tvar recordData = data[id];\n\t\t\t\t\t\t\tthisInstance.mapResultsToFields(selectedModule, parentRow, recordData);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tcalculateItemNumbers: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar items = this.getInventoryItemsContainer();\n\t\t\tvar i = 1;\n\t\t\titems.find(thisInstance.rowClass).each(function(index) {\n\t\t\t\t$(this)\n\t\t\t\t\t.find('.itemNumberText')\n\t\t\t\t\t.text(i);\n\t\t\t\ti++;\n\t\t\t});\n\t\t},\n\t\tinitItem: function(container) {\n\t\t\tlet thisInstance = this;\n\t\t\tif (typeof container === 'undefined') {\n\t\t\t\tcontainer = thisInstance.getInventoryItemsContainer();\n\t\t\t}\n\t\t\tthisInstance.registerDeleteLineItemEvent(container);\n\t\t\tthisInstance.registerPriceBookModal(container);\n\t\t\tthisInstance.registerRowChangeEvent(container);\n\t\t\tthisInstance.registerRowAutoComplete(container);\n\t\t\tthisInstance.checkDeleteIcon();\n\t\t\tthisInstance.rowsCalculations();\n\t\t\tthisInstance.updateRowSequence();\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(container.find('.selectInv'));\n\t\t\tApp.Fields.Date.register(container, true, {}, 'dateFieldInv');\n\t\t\tcontainer.validationEngine('detach');\n\t\t\tcontainer.validationEngine(app.validationEngineOptions);\n\t\t},\n\t\t/**\n\t\t * Load inventory data for specified record\n\t\t * @param {int} recordId\n\t\t * @param {string} sourceModule\n\t\t * @param {function|bool} success callback\n\t\t * @param {function|bool} fail callback\n\t\t * @returns Promise\n\t\t */\n\t\tloadInventoryData(recordId, sourceModule, success = false, fail = false) {\n\t\t\tconst progressLoader = $.progressIndicator({ blockInfo: { enabled: true } });\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: sourceModule,\n\t\t\t\t\taction: 'Inventory',\n\t\t\t\t\tmode: 'getTableData',\n\t\t\t\t\trecord: recordId\n\t\t\t\t})\n\t\t\t\t\t.done(response => {\n\t\t\t\t\t\tlet activeModules = [];\n\t\t\t\t\t\tthis.getInventoryHeadContainer()\n\t\t\t\t\t\t\t.find('.js-inv-add-item')\n\t\t\t\t\t\t\t.each((index, addBtn) => {\n\t\t\t\t\t\t\t\tactiveModules.push($(addBtn).data('module'));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\tprogressLoader.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\tconst oldCurrencyChangeAction = this.currencyChangeActions;\n\t\t\t\t\t\tthis.currencyChangeActions = function changeCurrencyActions(select, option) {\n\t\t\t\t\t\t\tthis.currencyConvertValues(select, option);\n\t\t\t\t\t\t\tselect.data('oldValue', select.val());\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconst first = response.result[Object.keys(response.result)[0]];\n\t\t\t\t\t\tthis.setCurrencyParam(first.currencyparam);\n\t\t\t\t\t\tthis.setCurrency(first.currency);\n\t\t\t\t\t\tthis.setDiscountMode(first.discountmode);\n\t\t\t\t\t\tthis.setTaxMode(first.taxmode);\n\t\t\t\t\t\tthis.currencyChangeActions = oldCurrencyChangeAction;\n\t\t\t\t\t\t$.each(response.result, (index, row) => {\n\t\t\t\t\t\t\tif (activeModules.indexOf(row.moduleName) !== -1) {\n\t\t\t\t\t\t\t\tthis.addItem(row.moduleName, row.basetableid, row);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\t\t\ttext: app\n\t\t\t\t\t\t\t\t\t\t.vtranslate('JS_INVENTORY_ITEM_MODULE_NOT_FOUND')\n\t\t\t\t\t\t\t\t\t\t.replace('${sourceModule}', row.moduleName)\n\t\t\t\t\t\t\t\t\t\t.replace('${position}', row.info.name)\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.summaryCalculations();\n\t\t\t\t\t\tresolve(response.result);\n\t\t\t\t\t\tif (typeof success === 'function') {\n\t\t\t\t\t\t\tsuccess(response.result);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail((error, err) => {\n\t\t\t\t\t\tprogressLoader.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\treject(error, err);\n\t\t\t\t\t\tif (typeof fail === 'function') {\n\t\t\t\t\t\t\tfail(error, err);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function which will register all the events\n\t\t */\n\t\tregisterEvents: function(container) {\n\t\t\tthis.form = container;\n\t\t\tthis.registerInventorySaveData();\n\t\t\tthis.registerAddItem();\n\t\t\tthis.initItem();\n\t\t\tthis.registerSortableItems();\n\t\t\tthis.registerSubProducts();\n\t\t\tthis.registerChangeDiscount();\n\t\t\tthis.registerChangeTax();\n\t\t\tthis.registerClearReferenceSelection();\n\t\t\tthis.registerShowHideExpanded();\n\t\t\tthis.registerChangeCurrency();\n\t\t\tthis.setDefaultGlobalTax(container);\n\t\t}\n\t}\n);\n"],"names":["$","Class","container","inventoryInstance","moduleClassName","find","val","window","registerEvents","form","inventoryContainer","inventoryHeadContainer","summaryDiscountContainer","summaryTaxesContainer","summaryCurrenciesContainer","$inventoryItemsNo","rowNumber","parseInt","accountReferenceField","getInventoryItemsContainer","rowClass","length","showLineItemsDeleteIcon","app","getMainParams","hideLineItemsDeleteIcon","removeClass","addClass","element","closest","getForm","eq","clone","parentRow","productField","validationEngine","row","items","getInventoryHeadContainer","taxModeElement","getTaxModeSelectElement","selectedOption","taxTypeElement","thisInstance","groupTax","getInventorySummaryTaxesContainer","newRow","isIndividualTaxMode","taxParam","aggregationType","each","thisItem","App","Fields","Double","formatToDb","attr","setTaxParam","setTax","setTaxPercent","setDefaultGlobalTax","rowsCalculations","taxDefaultValue","data","isGroupTax","isGroupTaxMode","formatToDisplay","JSON","stringify","quantityChangeActions","discountModeElement","getDiscountModeSelectElement","groupDiscount","getInventorySummaryDiscountContainer","isIndividualDiscountMode","setDiscount","setDiscountParam","currency","taxParams","undefined","parse","valuePrices","getNetPrice","taxRate","types","forEach","entry","taxValue","individualTax","globalTax","regionalTax","taxPercent","getNumberFromValue","discountParams","getTotalPrice","discountRate","discountValue","individualDiscount","discountType","individualDiscountType","globalDiscount","getDiscount","getQuantityValue","getUnitPriceValue","qty","purchase","price","index","getGrossPrice","trigger","display","text","parent","rowCalculations","summaryCalculations","calculateTotalPrice","calculateDiscounts","calculateNetPrice","calculateTaxes","calculateGrossPrice","calculateMargin","calculateItemNumbers","getTax","getTaxPercent","calculatSummary","calculatDiscountSummary","calculatTaxSummary","calculatCurrenciesSummary","calculatMarginPSummary","field","sum","sumRow","totalPriceField","sumPrice","getNumberFromText","marginp","purchasePrice","subtraction","discount","getAllDiscount","getInventorySummaryCurrenciesContainer","selected","base","conversionRate","baseConversionRate","parseFloat","taxs","getAllTaxs","html","value","appendTo","tax","typeSummary","netPrice","params","param","name","precent","old","setNetPrice","setGrossPrice","setTotalPrice","getPurchase","margin","setMargin","setMarginP","modal","netPriceBeforeDiscount","discountsType","individualTypeDiscount","prop","panel","netPriceWithoutTax","taxType","on","Vtiger_Edit_Js","recordPreSave","e","syncHeaderData","checkLimits","table","removeAttr","header","lineItemRow","rowName","showRecordsList","getCurrency","CONFIG","defaultCurrencyId","instance","setSelectEvent","request","responseData","id","done","result","setUnitPrice","errorLog","indicator","recordId","recordModule","removeSubProducts","inArray","subProductsCashe","addSubProducts","subProrductParams","progressInstace","progressIndicator","hide","fail","error","err","subProductsContainer","remove","priductText","append","referenceModule","unit","unitPrice","recordData","description","unitPriceValues","unitPriceValuesJson","parameters","taxes","type","setPurchase","commentElement","next","editorInstance","CKEDITOR","instances","setData","triggerQtyParam","qtyPerUnit","loadSubProducts","perUnit","info","typeName","panels","i","push","extend","taxModalFields","inventoryRowExpanded","listInstance","getInstance","key","loadEditorElement","destroy","discountModalFields","parameter","array","isArray","arrayValue","filter","change","calculateDiscount","toString","input","formatNumber","calculateTax","account","getAccountId","limit","response","limitEnableSave","getModuleName","getSummaryGrossPrice","async","dataType","status","showModalWindow","select","option","showCurrencyChangeModal","currencyConvertValues","lockCurrencyChange","block","currencyParam","defaultCurrencyParams","rate","hideModalWindow","one","previous","prevConversionRate","rowData","setName","setQuantity","setUnit","autoFields","unitText","subunit","setSubUnit","subunitText","setComment","comment1","net","gross","total","discountParam","discountparam","taxparam","tax_percent","module","baseTableId","getBasicRow","sequenceNumber","getNextLineItemRowNumber","replaced","replace","moduleLbls","children","initItem","registerAutoCompleteFields","setRowData","itemsHeader","btn","addItem","sortable","ui","width","event","hideExpandedRow","item","startPos","numrow","child","after","before","updateRowSequence","currentTarget","getClosestRow","showExpandedRow","isRecordSelected","pricebooksModalHandler","headContainer","showIndividualTax","showIndividualDiscount","referenceGroup","num","checkDeleteIcon","hasClass","totalPrice","initDiscountsParameters","registerChangeDiscountModal","checked","saveDiscountsParameters","getRecordId","sourceRecord","record","initTaxParameters","registerChangeTaxModal","symbol","currencyChangeActions","saveTaxsParameters","sourceFieldElement","referenceSelectionEvent","selectedModule","dataUrl","babelHelpers.typeof","mapResultsToFields","registerDeleteLineItemEvent","registerPriceBookModal","registerRowChangeEvent","registerRowAutoComplete","Picklist","showSelect2ElementView","Date","register","validationEngineOptions","sourceModule","success","progressLoader","blockInfo","enabled","Promise","resolve","reject","activeModules","addBtn","mode","oldCurrencyChangeAction","changeCurrencyActions","first","Object","keys","setCurrencyParam","currencyparam","setCurrency","setDiscountMode","discountmode","setTaxMode","taxmode","indexOf","moduleName","basetableid","showMessage","vtranslate","registerInventorySaveData","registerAddItem","registerSortableItems","registerSubProducts","registerChangeDiscount","registerChangeTax","registerClearReferenceSelection","registerShowHideExpanded","registerChangeCurrency"],"mappings":"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"}