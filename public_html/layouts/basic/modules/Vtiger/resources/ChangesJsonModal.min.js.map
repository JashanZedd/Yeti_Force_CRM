{"version":3,"file":"ChangesJsonModal.min.js","sources":["ChangesJsonModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n$.Class(\n\t'Base_ChangesJsonModal_JS',\n\t{},\n\t{\n\t\t/**\n\t\t * Register select field\n\t\t */\n\t\tregisterSelectField: function () {\n\t\t\tlet editInstance = Vtiger_Edit_Js.getInstance(this.module);\n\t\t\tlet form = this.container.find('form');\n\t\t\tthis.container.find('.js-changesjson-select').on('change', (e) => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tlet blockElement = element.closest('.js-form-row-container').find('.fieldValue');\n\t\t\t\tlet fieldElement = blockElement.find('[data-validation-engine],[data-invalid-validation-engine]');\n\t\t\t\tlet fieldInfo = fieldElement.data('fieldinfo');\n\t\t\t\tif (element.prop('checked')) {\n\t\t\t\t\tthis.activeFieldValidation(fieldElement);\n\t\t\t\t} else {\n\t\t\t\t\tthis.inactiveFieldValidation(fieldElement);\n\t\t\t\t}\n\t\t\t\tif (fieldInfo !== undefined && fieldInfo.type === 'reference') {\n\t\t\t\t\tlet mapFields = editInstance.getMappingRelatedField(\n\t\t\t\t\t\tfieldInfo.name,\n\t\t\t\t\t\teditInstance.getReferencedModuleName(blockElement),\n\t\t\t\t\t\tform\n\t\t\t\t\t);\n\t\t\t\t\t$.each(mapFields, function (key, _) {\n\t\t\t\t\t\tlet checkboxElement = form.find('[id=\"selectRow' + key + '\"]');\n\t\t\t\t\t\tif (checkboxElement.length && checkboxElement.prop('disabled')) {\n\t\t\t\t\t\t\tcheckboxElement.prop('disabled', false);\n\t\t\t\t\t\t\tcheckboxElement.trigger('click');\n\t\t\t\t\t\t\tcheckboxElement.prop('disabled', true);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Deactivate field validation\n\t\t * @param {jQuery}\n\t\t */\n\t\tinactiveFieldValidation: function (field) {\n\t\t\tfield.validationEngine('hide');\n\t\t\tlet form = field.closest('form');\n\t\t\tlet invalidFields = form.data('jqv').InvalidFields;\n\t\t\tlet fields = [field.get(0)];\n\t\t\tfield.attr('data-invalid-validation-engine', field.attr('data-validation-engine'));\n\t\t\tfield.removeAttr('data-validation-engine');\n\n\t\t\tif (field.is('select') && field.hasClass('select2')) {\n\t\t\t\tlet selectElement = app.getSelect2ElementFromSelect(field);\n\t\t\t\tselectElement.validationEngine('hide');\n\t\t\t\tfields.push(selectElement.get(0));\n\t\t\t}\n\t\t\tfor (let i in fields) {\n\t\t\t\tlet response = jQuery.inArray(fields[i], invalidFields);\n\t\t\t\tif (response != '-1') {\n\t\t\t\t\tinvalidFields.splice(response, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Activate field validation\n\t\t * @param {jQuery}\n\t\t */\n\t\tactiveFieldValidation: function (field) {\n\t\t\tlet validationVal = field.attr('data-invalid-validation-engine');\n\t\t\tif (typeof validationVal === 'undefined') return;\n\t\t\tfield.attr('data-validation-engine', validationVal);\n\t\t\tfield.removeAttr('data-invalid-validation-engine');\n\t\t},\n\t\t/**\n\t\t * Function to inactive field for validation in a form\n\t\t * this will remove data-validation-engine attr of all the elements\n\t\t */\n\t\tinactiveFieldsValidation: function () {\n\t\t\tlet editFieldList = this.container.find('.js-edit-field-list').data('value');\n\t\t\tlet form = this.container.find('form');\n\t\t\tfor (let fieldName in editFieldList) {\n\t\t\t\tlet fieldInfo = editFieldList[fieldName];\n\n\t\t\t\tlet fieldElement = form.find('[name=\"' + fieldInfo.name + '\"]');\n\t\t\t\tif (fieldInfo.type == 'reference') {\n\t\t\t\t\tfieldElement = form.find('[name=\"' + fieldInfo.name + '_display\"]');\n\t\t\t\t} else if (fieldInfo.type == 'multipicklist' || fieldInfo.type == 'sharedOwner') {\n\t\t\t\t\tfieldElement = form.find('[name=\"' + fieldInfo.name + '[]\"]');\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\tfieldElement.length == 0 ||\n\t\t\t\t\tfieldElement.closest('.js-form-row-container').find('.js-changesjson-select').prop('checked')\n\t\t\t\t) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet elemData = fieldElement.data();\n\t\t\t\tlet validationVal = 'validate[]';\n\t\t\t\tif ('validationEngine' in elemData) {\n\t\t\t\t\tvalidationVal = elemData.validationEngine;\n\t\t\t\t\tdelete elemData.validationEngine;\n\t\t\t\t}\n\t\t\t\tfieldElement.attr('data-invalid-validation-engine', validationVal);\n\t\t\t\tfieldElement.removeAttr('data-validation-engine');\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Register change tab\n\t\t */\n\t\tregisterEventForTabClick: function () {\n\t\t\tlet form = this.container.find('form');\n\t\t\tthis.container.on('click', 'a[data-toggle=\"tab\"]', function (e) {\n\t\t\t\tform.validationEngine('validate');\n\t\t\t\tlet invalidFields = form.data('jqv').InvalidFields;\n\t\t\t\tif (invalidFields.length > 0) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Register events\n\t\t * @param {jQuery} container\n\t\t */\n\t\tregisterEvents(container) {\n\t\t\tthis.container = container;\n\t\t\tthis.module = container.find('[name=\"module\"]').val();\n\t\t\tthis.container.find('form').validationEngine(app.validationEngineOptions);\n\t\t\tthis.inactiveFieldsValidation();\n\t\t\tthis.registerEventForTabClick();\n\t\t\tthis.registerSelectField();\n\t\t\tVtiger_Edit_Js.getInstance(this.module).registerBasicEvents(container);\n\t\t}\n\t}\n);\n"],"names":["$","Class","registerSelectField","editInstance","Vtiger_Edit_Js","getInstance","module","form","container","find","on","e","element","currentTarget","blockElement","closest","fieldElement","fieldInfo","data","prop","activeFieldValidation","inactiveFieldValidation","type","getMappingRelatedField","name","getReferencedModuleName","each","mapFields","key","checkboxElement","length","trigger","field","validationEngine","invalidFields","InvalidFields","fields","get","attr","removeAttr","is","hasClass","app","getSelect2ElementFromSelect","selectElement","push","response","jQuery","inArray","i","splice","validationVal","inactiveFieldsValidation","fieldName","editFieldList","elemData","registerEventForTabClick","stopPropagation","registerEvents","val","validationEngineOptions","registerBasicEvents"],"mappings":"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"}