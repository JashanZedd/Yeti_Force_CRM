"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),App=window.App={Components:{Tree:{Basic:function(){function Basic(){var container=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$(".js-tree-container");classCallCheck(this,Basic),this.treeInstance=!1,this.treeData=!1,this.generateTree(container)}return createClass(Basic,[{key:"generateTree",value:function(container){!1===this.treeInstance&&(this.treeInstance=container,this.treeInstance.on("select_node.jstree",(function(e,data){void 0!==data.event&&$(data.event.target).hasClass("jstree-checkbox")||data.instance.select_node(data.node.children_d)})).on("deselect_node.jstree",(function(e,data){void 0!==data.event&&$(data.event.target).hasClass("jstree-checkbox")||data.instance.deselect_node(data.node.children_d)})).jstree({core:{data:this.getRecords(container),themes:{name:"proton",responsive:!0}},plugins:["search","checkbox"]}),this.registerSearchEvent())}},{key:"registerSearchEvent",value:function(){var self=this,searchTimeout=!1,treeSearch=$(".js-tree-search");treeSearch.on("keyup",(function(){searchTimeout&&clearTimeout(searchTimeout),searchTimeout=setTimeout((function(){var searchValue=treeSearch.val();self.treeInstance.jstree(!0).search(searchValue)}),250)}))}},{key:"getRecords",value:function(container){return!1===this.treeData&&"undefined"!==container&&(this.treeData=JSON.parse(container.find(".js-tree-data").val())),this.treeData}}]),Basic}()},QuickCreate:{moduleCache:{},createRecord:function(moduleName){var _this=this,params=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("parentIframe"!==CONFIG.modalTarget){var url="index.php?module="+moduleName+"&view=QuickCreateAjax";void 0===params.callbackFunction&&(params.callbackFunction=function(){}),("Detail"===app.getViewName()||"Edit"===app.getViewName()&&void 0!==app.getRecordId())&&"Settings"!=app.getParentModuleName()&&(url+="&sourceModule="+app.getModuleName(),url+="&sourceRecord="+app.getRecordId());var progress=$.progressIndicator({blockInfo:{enabled:!0}});this.getForm(url,moduleName,params).done((function(data){_this.showModal(data,params),app.registerEventForClockPicker(),progress.progressIndicator({mode:"hide"})}))}else window.parent.App.Components.QuickCreate.createRecord(moduleName,params)},getForm:function(url,moduleName){var params=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},aDeferred=$.Deferred(),requestParams=void 0,isCacheActive=!params.noCache||void 0===params.noCache;return isCacheActive&&App.Components.QuickCreate.moduleCache[moduleName]?(aDeferred.resolve(App.Components.QuickCreate.moduleCache[moduleName]),aDeferred.promise()):(requestParams=url,void 0!==params.data&&((requestParams={}).data=params.data,requestParams.url=url),AppConnector.request(requestParams).done((function(data){isCacheActive&&(App.Components.QuickCreate.moduleCache[moduleName]=data),aDeferred.resolve(data)})),aDeferred.promise())},showModal:function(html){var _this2=this,params=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};app.showModalWindow(html,(function(container){var quickCreateForm=container.find('form[name="QuickCreate"]'),moduleName=quickCreateForm.find('[name="module"]').val(),moduleClassName=moduleName+"_QuickCreate_Js";Vtiger_Edit_Js.getInstanceByModuleName(moduleName).registerBasicEvents(quickCreateForm),void 0!==window[moduleClassName]&&(new window[moduleClassName]).registerEvents(container),quickCreateForm.validationEngine(app.validationEngineOptions),void 0!==params.callbackPostShown&&params.callbackPostShown(quickCreateForm),_this2.registerPostLoadEvents(quickCreateForm,params),_this2.registerHelpInfo(quickCreateForm)}))},registerPostLoadEvents:function(form,params){var _this3=this,submitSuccessCallback=params.callbackFunction||function(){},goToFullFormCallBack=params.goToFullFormcallback||function(){};form.on("submit",(function(e){var form=$(e.currentTarget);if(form.hasClass("not_validation"))return!0;var moduleName=form.find('[name="module"]').val();if(void 0!==form.data("submit"))return!1;if(form.data("jqv").InvalidFields.length>0)return form.removeData("submit"),$.progressIndicator({mode:"hide"}),void e.preventDefault();form.data("submit","true"),$.progressIndicator({mode:"hide"});var recordPreSaveEvent=$.Event(Vtiger_Edit_Js.recordPreSave);if(form.trigger(recordPreSaveEvent,{value:"edit",module:moduleName}),recordPreSaveEvent.isDefaultPrevented())form.removeData("submit"),$.progressIndicator({mode:"hide"});else{var moduleInstance=Vtiger_Edit_Js.getInstanceByModuleName(moduleName),saveHandler=moduleInstance.quickCreateSave?moduleInstance.quickCreateSave:_this3.save,progress=$.progressIndicator({message:app.vtranslate("JS_SAVE_LOADER_INFO"),position:"html",blockInfo:{enabled:!0}});saveHandler(form).done((function(data){var modalContainer=form.closest(".modalContainer"),parentModuleName=app.getModuleName(),viewName=app.getViewName();(modalContainer.length&&app.hideModalWindow(!1,modalContainer[0].id),moduleName===parentModuleName&&"List"===viewName)&&(new Vtiger_List_Js).getListViewRecords();submitSuccessCallback(data),app.event.trigger("QuickCreate.AfterSaveFinal",data,form),progress.progressIndicator({mode:"hide"}),data.success&&Vtiger_Helper_Js.showPnotify({text:app.vtranslate("JS_SAVE_NOTIFY_SUCCESS"),type:"success"})}))}e.preventDefault()})),form.find(".js-full-editlink").on("click",(function(e){var form=$(e.currentTarget).closest("form"),editViewUrl=$(e.currentTarget).data("url");goToFullFormCallBack(form),_this3.goToFullForm(form,editViewUrl)})),this.registerTabEvents(form)},registerHelpInfo:function(){var container=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$('form[name="QuickCreate"]');app.showPopoverElementView(container.find(".js-help-info"))},goToFullForm:function(form){form.find('input[name="action"]').remove(),form.append('<input type="hidden" name="view" value="Edit" />'),$.each(form.find("[data-validation-engine]"),(function(key,data){$(data).removeAttr("data-validation-engine")})),form.addClass("not_validation"),form.submit()},registerTabEvents:function(form){var tabElements=form.find(".nav.nav-pills , .nav.nav-tabs").find("a"),quickCreateTabOnHide=function(target){$(target).find("[name]").each((function(index,element){(element=$(element)).attr("data-element-name",element.attr("name")).removeAttr("name")}))};tabElements.on("click",(function(e){var target;quickCreateTabOnHide(tabElements.not('[aria-expanded="false"]').attr("data-target")),target=$(this).attr("data-target"),$(target).find("[data-element-name]").each((function(index,element){(element=$(element)).attr("name",element.attr("data-element-name")).removeAttr("data-element-name")})),form.data("jqv").InvalidFields=[]})),tabElements.filter("a:not(.active)").each((function(e){quickCreateTabOnHide($(this).attr("data-target"))}))},save:function(form){var aDeferred=$.Deferred(),quickCreateSaveUrl=form.serializeFormData();return AppConnector.request(quickCreateSaveUrl).done((function(data){aDeferred.resolve(data)}),(function(textStatus,errorThrown){aDeferred.reject(textStatus,errorThrown)})),aDeferred.promise()}},QuickEdit:{showModal:function(){var params=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},self=this;params.view="QuickEditModal",AppConnector.request(params).done((function(html){app.showModalWindow(html,(function(container){var form=container.find('form[name="QuickEdit"]'),moduleName=form.find('[name="module"]').val(),moduleClassName=moduleName+"_QuickEdit_Js";Vtiger_Edit_Js.getInstanceByModuleName(moduleName).registerBasicEvents(form),void 0!==window[moduleClassName]&&(new window[moduleClassName]).registerEvents(container),form.validationEngine(app.validationEngineOptions),void 0!==params.callbackPostShown&&params.callbackPostShown(form,params),self.registerPostLoadEvents(form,params)}))}))},registerPostLoadEvents:function(form,params){var _this4=this,submitSuccessCallback=params.callbackFunction||function(){};form.on("submit",(function(e){var form=$(e.currentTarget);if(form.hasClass("not_validation"))return!0;var moduleName=form.find('[name="module"]').val();if(void 0!==form.data("submit"))return!1;if(form.data("jqv").InvalidFields.length>0)return form.removeData("submit"),$.progressIndicator({mode:"hide"}),void e.preventDefault();form.data("submit","true"),$.progressIndicator({mode:"hide"});var recordPreSaveEvent=$.Event(Vtiger_Edit_Js.recordPreSave);if(form.trigger(recordPreSaveEvent,{value:"edit",module:moduleName}),recordPreSaveEvent.isDefaultPrevented())form.removeData("submit"),$.progressIndicator({mode:"hide"});else{var moduleInstance=Vtiger_Edit_Js.getInstanceByModuleName(moduleName),saveHandler=moduleInstance.quickEditSave?moduleInstance.quickEditSave:_this4.save,progress=$.progressIndicator({message:app.vtranslate("JS_SAVE_LOADER_INFO"),position:"html",blockInfo:{enabled:!0}});saveHandler(form).done((function(data){var modalContainer=form.closest(".modalContainer"),parentModuleName=app.getModuleName(),viewName=app.getViewName();(modalContainer.length&&app.hideModalWindow(!1,modalContainer[0].id),moduleName===parentModuleName&&"List"===viewName)&&(new Vtiger_List_Js).getListViewRecords();submitSuccessCallback(data),app.event.trigger("QuickEdit.AfterSaveFinal",data,form),progress.progressIndicator({mode:"hide"}),data.success&&Vtiger_Helper_Js.showPnotify({text:app.vtranslate("JS_SAVE_NOTIFY_SUCCESS"),type:"success"}),"Detail"===viewName&&app.getRecordId()===form.find('[name="record"]').val()&&window.location.reload()}))}e.preventDefault()}))},save:function(form){var aDeferred=$.Deferred(),quickCreateSaveUrl=form.serializeFormData();return AppConnector.request(quickCreateSaveUrl).done((function(data){aDeferred.resolve(data)}),(function(textStatus,errorThrown){aDeferred.reject(textStatus,errorThrown)})),aDeferred.promise()}},Scrollbar:{defaults:{scrollbars:{autoHide:"leave"}},page:{instance:{},element:null},initPage:function(){var scrollbarContainer=$(".mainBody");scrollbarContainer.length||(scrollbarContainer=$("body")),this.page.instance=this.y(scrollbarContainer),this.page.element=$(this.page.instance.getElements().viewport)},xy:function(element){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return element.overlayScrollbars(options).overlayScrollbars()},y:function(element,options){var mergedOptions=Object.assign(this.defaults,options,{overflowBehavior:{x:"h"}});return element.overlayScrollbars(mergedOptions).overlayScrollbars()}}}},app=window.app={languageString:[],breakpoints:{xs:0,sm:576,md:768,lg:992,xl:1200,xxl:1300,xxxl:1700},cacheParams:[],modalEvents:[],mousePosition:{x:0,y:0},childFrame:!1,touchDevice:!1,event:new function(){this.el=$({}),this.trigger=function(){this.el.trigger(arguments[0],Array.prototype.slice.call(arguments,1))},this.on=function(){this.el.on.apply(this.el,arguments)},this.one=function(){this.el.one.apply(this.el,arguments)},this.off=function(){this.el.off.apply(this.el,arguments)}},getModuleName:function(){return this.getMainParams("module")},getParentModuleName:function(){return this.getMainParams("parent")},getViewName:function(){return this.getMainParams("view")},getRecordId:function(){var recordId,view=this.getViewName();return-1!==$.inArray(view,["Edit","PreferenceEdit","Detail","PreferenceDetail","DetailPreview"])&&(recordId=this.getMainParams("recordId")),recordId},getRecordDetails:function(params){var aDeferred=$.Deferred();return"Settings"===app.getParentModuleName()&&(params.parent="Settings"),AppConnector.request(Object.assign(params,{action:"GetData"})).done((function(data){data.success?aDeferred.resolve(data):aDeferred.reject(data.message)})).fail((function(error){aDeferred.reject()})),aDeferred.promise()},getLanguage:function(){return $("body").data("language")},getPageTitle:function(){return document.title},getWindowParent:function(){return void 0!==window.frames[0]&&void 0!==window.frames[0].app&&window.frames[0].app.childFrame?window.frames[0]:window},isWindowTop:function(){return window.top===window.self},isTouchDevice:function(){var supportsTouch=!1;return"ontouchstart"in window?supportsTouch=!0:window.navigator.msPointerEnabled?supportsTouch=!0:"ontouchstart"in document.documentElement&&(supportsTouch=!0),supportsTouch&&$("<style type='text/css'> ::-webkit-scrollbar { display: none;} </style>").appendTo("head"),supportsTouch},isJsonString:function(str){try{JSON.parse(str)}catch(e){return!1}return!0},setPageTitle:function(title){document.title=title},getContentsContainer:function(){return $(".bodyContents")},hidePopover:function(element){void 0===element&&(element=$("body .js-popover-tooltip")),element.popover("hide")},hidePopoversAfterClick:function(popoverParent){popoverParent.on("mousedown",(function(e){setTimeout((function(){popoverParent.popover("hide")}),100)}))},registerPopoverManualTrigger:function(element,manualTriggerDelay){var _this5=this;element.on("mouseleave",(function(e){setTimeout((function(){var currentPopover=_this5.getBindedPopover(element);$(":hover").filter(currentPopover).length||currentPopover.find(".js-popover-tooltip--record[aria-describedby]").length||currentPopover.popover("hide")}),500)})),element.on("mouseenter",(function(){setTimeout((function(){if(element.is(":hover")){element.popover("show");var currentPopover=_this5.getBindedPopover(element);currentPopover.on("mouseleave",(function(){setTimeout((function(){$(":hover").filter(currentPopover).length||currentPopover.find(".js-popover-tooltip--record[aria-describedby]").length||currentPopover.popover("hide"),$(":hover").filter($(".popover")).length||$(".popover").popover("hide")}),500)}))}}),manualTriggerDelay)})),app.hidePopoversAfterClick(element)},isEllipsisActive:function(element){var clone=element.clone().addClass("u-text-ellipsis--not-active").css(element.css(["font-size","font-weight","font-family"])).appendTo("body");return clone.find(".u-text-ellipsis").removeClass("u-text-ellipsis").addClass("u-text-ellipsis--not-active"),clone.width()-1>element.width()?(clone.remove(),!0):(clone.remove(),!1)},showPopoverElementView:function(){var selectElement=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$(".js-popover-tooltip"),params=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},defaultParams={trigger:"manual",manualTriggerDelay:500,placement:"auto",html:!0,template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',container:"body",boundary:"viewport",delay:{show:300,hide:100}};return selectElement.each((function(index,domElement){var element=$(domElement),elementParams=$.extend(!0,defaultParams,params,element.data());element.data("class")&&(elementParams.template='<div class="popover '+element.data("class")+'" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'),element.hasClass("delay0")&&(elementParams.delay={show:0,hide:0}),element.popover(elementParams),"manual"!==elementParams.trigger&&void 0!==elementParams.trigger||app.registerPopoverManualTrigger(element,elementParams.manualTriggerDelay),elementParams.callbackShown&&element.on("shown.bs.popover",(function(e){elementParams.callbackShown(e)})),element.addClass("popover-triggered")})),selectElement},registerPopoverEllipsis:function(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$element=_ref.element,element=void 0===_ref$element?$(".js-popover-tooltip--ellipsis"):_ref$element,_ref$params=_ref.params,params=void 0===_ref$params?{trigger:"hover focus"}:_ref$params,_ref$container=_ref.container,container=void 0===_ref$container?$(window):_ref$container,self=this;params={callbackShown:function(){self.setPopoverPosition(element,container)},trigger:"manual",placement:"right",template:'<div class="popover js-popover--before-positioned" role="tooltip"><div class="popover-body"></div></div>'};var popoverText=element.find(".js-popover-text").length?element.find(".js-popover-text"):element;app.isEllipsisActive(popoverText)?app.showPopoverElementView(element,params):element.addClass("popover-triggered")},registerPopoverEllipsisIcon:function(){var selectElement=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$(".js-popover-tooltip--ellipsis-icon"),params=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{trigger:"hover focus"};selectElement.each((function(index,domElement){var element=$(domElement),popoverText=element.find(".js-popover-text").length?element.find(".js-popover-text"):element;app.isEllipsisActive(popoverText)&&(element.find(".js-popover-icon").length&&(element.find(".js-popover-icon").removeClass("d-none"),params.selector=".js-popover-icon"),app.showPopoverElementView(element,params))}))},registerPopoverRecord:function(){var selectElement=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$("a.js-popover-tooltip--record"),customParams=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},container=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$(document),self=this,params={template:'<div class="popover c-popover--link js-popover--before-positioned" role="tooltip"><div class="popover-body"></div></div>',content:'<div class="d-none"></div>',manualTriggerDelay:app.getMainParams("recordPopoverDelay"),placement:"right",callbackShown:function(){if(!selectElement.attr("href"))return!1;var link=new URL(selectElement.eq(0).attr("href"),window.location.origin);if(!link.searchParams.get("record")||!link.searchParams.get("view"))return!1;var url=link.href;url=url.replace("view=","xview=")+"&view=RecordPopover";var popoverBody=self.getBindedPopover(selectElement).find(".popover-body");popoverBody.progressIndicator({});var appendPopoverData=function(data){popoverBody.progressIndicator({mode:"hide"}).html(data),"function"==typeof customParams.callback&&customParams.callback(popoverBody),self.setPopoverPosition(selectElement,container)},cacheData=window.popoverCache[url];void 0!==cacheData?appendPopoverData(cacheData):AppConnector.request(url).done((function(data){window.popoverCache[url]=data,appendPopoverData(data)}))}};app.showPopoverElementView(selectElement,params)},setPopoverPosition:function(popoverElement){arguments.length>1&&void 0!==arguments[1]?arguments[1]:$(window);var popover=this.getBindedPopover(popoverElement);if(popover.length){var iframeOffset=this.computePopoverIframeOffset(popoverElement),windowHeight=$(window).height(),windowWidth=$(window).width(),popoverPadding=10,popoverBody=popover.find(".popover-body"),popoverHeight=popoverBody.height(),popoverWidth=popoverBody.width(),offsetTop=app.mousePosition.y+iframeOffset.top,offsetLeft=app.mousePosition.x+iframeOffset.left;popoverHeight+offsetTop+popoverPadding>windowHeight&&(offsetTop=offsetTop-popoverHeight-popoverPadding),popoverWidth+offsetLeft+popoverPadding>windowWidth&&(offsetLeft=windowWidth-popoverWidth),popover.css({transform:"translate3d("+offsetLeft+"px, "+offsetTop+"px, 0)"}),popover.removeClass("js-popover--before-positioned"),popoverElement.one("hide.bs.popover",(function(){popover.addClass("js-popover--before-positioned")}))}},computePopoverIframeOffset:function(popoverElement){var iframeOffsetTop=0,iframeOffsetLeft=0;if(!$(document).find(popoverElement).length){var iframe=$(document).find("iframe"),iframeOffset=iframe.offset();if(iframeOffsetTop+=iframeOffset.top,iframeOffsetLeft+=iframeOffset.left,!iframe.contents().find(popoverElement).length){var iframeOffset2=iframe.contents().find("iframe").offset();iframeOffsetTop+=iframeOffset2.top,iframeOffsetLeft+=iframeOffset2.left}}return{top:iframeOffsetTop,left:iframeOffsetLeft}},getBindedPopover:function(element){return $("#"+element.attr("aria-describedby"))},registerChangeEventForMultiSelect:function(selectElement,params){if(void 0!==selectElement){var instance=selectElement.data("select2"),limit=params.maximumSelectionLength;selectElement.on("change",(function(e){var data=instance.data();$.isArray(data)&&data.length>=limit&&instance.updateResults()}))}},getSerializedData:function(parentElement,returnFormat){void 0===returnFormat&&(returnFormat="string");var encodedString=(parentElement=$(parentElement)).children().serialize();if("string"==returnFormat)return encodedString;var keyValueMap={},valueList=encodedString.split("&");for(var index in valueList){var keyValueArr=valueList[index].split("="),nameOfElement=keyValueArr[0],valueOfElement=keyValueArr[1];keyValueMap[nameOfElement]=decodeURIComponent(valueOfElement)}return keyValueMap},animateModal:function(modal,openAnimation,closeAnimation){modal.on("show.bs.modal",(function(e){modal.removeClass("animated "+closeAnimation),modal.addClass("animated "+openAnimation)})),modal.on("hide.bs.modal",(function(e){modal.removeClass("animated "+openAnimation),modal.addClass("animated "+closeAnimation)}))},showModalData:function(data,container,paramsObject,cb,url,sendByAjaxCb){var params={show:!0};app.getMainParams("backgroundClosingModal")||(params.backdrop="static",params.keyboard=!1),"object"===(void 0===paramsObject?"undefined":_typeof(paramsObject))&&(container.css(paramsObject),params=$.extend(params,paramsObject)),container.html(data),container.find(".modal").hasClass("static")&&(params.backdrop="static"),$.fn.modal.Constructor.prototype.enforceFocus=function(e){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy((function(e){if($(e.target).hasClass("select2-search__field"))return!0}),this))};var modalContainer=container.find(".modal:first");modalContainer.one("shown.bs.modal",(function(){cb(modalContainer),App.Fields.Picklist.showSelect2ElementView(modalContainer.find("select.select2")),App.Fields.Date.register(modalContainer),new App.Fields.Text.Editor(modalContainer.find(".js-editor"),{height:"5em",toolbar:"Min"}),app.registesterScrollbar(modalContainer)})),$("body").append(container),modalContainer.modal(params),this.registerModalEvents(modalContainer,sendByAjaxCb),this.registerDataTables(modalContainer.find(".dataTable"))},showModalWindow:function(data,url,cb){var paramsObject=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!app.isCurrentWindowTarget("app.showModalWindow",arguments))return!1;var thisInstance=this,sendByAjaxCb=void 0;Window.lastModalId="modal_"+Math.random().toString(36).substr(2,9),"object"!==(void 0===data?"undefined":_typeof(data))||null==data||data instanceof $||(null!=data.id&&(Window.lastModalId=data.id),paramsObject=data.css,cb=data.cb,url=data.url,"undefined"!==data.sendByAjaxCb&&(sendByAjaxCb=data.sendByAjaxCb),data=data.data),"function"==typeof url?("object"===(void 0===cb?"undefined":_typeof(cb))&&(paramsObject=cb),cb=url,url=!1):"object"===(void 0===url?"undefined":_typeof(url))&&(cb=function(){},paramsObject=url,url=!1),"function"!=typeof cb&&(cb=function(){}),"function"!=typeof sendByAjaxCb&&(sendByAjaxCb=function(){}),void 0!==paramsObject&&void 0!==paramsObject.modalId&&(Window.lastModalId=paramsObject.modalId);var container=$("#"+Window.lastModalId);return container.length&&container.remove(),(container=$("<div></div>")).attr("id",Window.lastModalId).addClass("modalContainer js-modal-container"),container.one("hidden.bs.modal",(function(){container.remove();var backdrop=$(".modal-backdrop");$(".modal.show").length||backdrop.remove(),backdrop.length>0&&$("body").addClass("modal-open")})),data?thisInstance.showModalData(data,container,paramsObject,cb,url,sendByAjaxCb):$.get(url).done((function(response){thisInstance.showModalData(response,container,paramsObject,cb,url,sendByAjaxCb)})),container},isCurrentWindowTarget:function(sourceFunction,args){var isCurrentWindowTarget=!0;return"parentIframe"===CONFIG.modalTarget&&(this.childFrame=!0,(sourceFunction=sourceFunction.split(".")).unshift("parent"),(sourceFunction=sourceFunction.reduce((function(o,i){return o[i]}),window)).apply(window.parent.app,args),isCurrentWindowTarget=!1),isCurrentWindowTarget},hideModalWindow:function(callback,id){if(!app.isCurrentWindowTarget("app.hideModalWindow",arguments))return!1;var container=void 0;if(!((container=callback&&"object"===(void 0===callback?"undefined":_typeof(callback))?callback:null==id?$(".modalContainer"):$("#"+id)).length<=0)){"function"!=typeof callback&&(callback=function(){});var modalContainer=container.find(".modal");modalContainer.modal("hide");var backdrop=$(".modal-backdrop:last");0==$(".modalContainer").length&&backdrop.length&&backdrop.remove(),modalContainer.one("hidden.bs.modal",callback)}},registerModalController:function(modalId,modalContainer,cb){var windowParent=this.childFrame?window.parent:window;void 0===modalId&&(modalId=Window.lastModalId),void 0===modalContainer&&(modalContainer=$("#"+modalId+" .js-modal-data"));var modalClass=modalContainer.data("module")+"_"+modalContainer.data("view")+"_JS";if(void 0!==windowParent[modalClass]){var instance=new windowParent[modalClass];"function"==typeof cb&&cb(modalContainer,instance),instance.registerEvents(modalContainer),modalId&&app.modalEvents[modalId]&&app.modalEvents[modalId](modalContainer,instance)}if(void 0!==windowParent[modalClass="Base_"+modalContainer.data("view")+"_JS"]){var _instance=new windowParent[modalClass];"function"==typeof cb&&cb(modalContainer,_instance),_instance.registerEvents(modalContainer),modalId&&app.modalEvents[modalId]&&app.modalEvents[modalId](modalContainer,_instance)}},registerModalEvents:function(container,sendByAjaxCb){var form=container.find("form"),validationForm=!1;form.hasClass("validateForm")&&(form.validationEngine(app.validationEngineOptions),validationForm=!0),form.hasClass("sendByAjax")&&form.on("submit",(function(e){var save=!0;if(e.preventDefault(),validationForm&&form.data("jqv").InvalidFields.length>0&&(app.formAlignmentAfterValidation(form),save=!1),save){var progressIndicatorElement=$.progressIndicator({blockInfo:{enabled:!0}}),formData=form.serializeFormData();AppConnector.request(formData).done((function(responseData){if(sendByAjaxCb(formData,responseData),responseData.success&&responseData.result&&(responseData.result.notify&&Vtiger_Helper_Js.showMessage(responseData.result.notify),responseData.result.procesStop))return progressIndicatorElement.progressIndicator({mode:"hide"}),!1;app.hideModalWindow(),progressIndicatorElement.progressIndicator({mode:"hide"})})).fail((function(){progressIndicatorElement.progressIndicator({mode:"hide"})}))}}))},isHidden:function(element){return"none"==element.css("display")},isInvisible:function(element){return"hidden"==element.css("visibility")},validationEngineOptions:{scroll:!1,promptPosition:"topLeft",prettySelect:!0,usePrefix:"s2id_"},validationEngineOptionsForRecord:{scroll:!1,promptPosition:"topLeft",prettySelect:!0,usePrefix:"s2id_",validateNonVisibleFields:!0,onBeforePromptType:function(field){var block=field.closest(".js-toggle-panel");block.find(".blockContent").is(":hidden")&&block.find(".blockHeader").click()}},scrollOptions:{wheelSpeed:.1},formAlignmentAfterValidation:function(form){var formError=form.find(".formError:not('.greenPopup'):first");if(formError.length>0){var resizedDestnation=formError.offset().top-105;$("html").animate({scrollTop:resizedDestnation},"slow")}},convertToDatePickerFormat:function(dateFormat){switch(dateFormat){case"yyyy-mm-dd":return"Y-m-d";case"mm-dd-yyyy":return"m-d-Y";case"dd-mm-yyyy":return"d-m-Y";case"yyyy.mm.dd":return"Y.m.d";case"mm.dd.yyyy":return"m.d.Y";case"dd.mm.yyyy":return"d.m.Y";case"yyyy/mm/dd":return"Y/m/d";case"mm/dd/yyyy":return"m/d/Y";case"dd/mm/yyyy":return"d/m/Y"}},convertTojQueryDatePickerFormat:function(dateFormat){var i=void 0,dotMode="-";-1!==dateFormat.indexOf("-")&&(dotMode="-"),-1!==dateFormat.indexOf(".")&&(dotMode="."),-1!==dateFormat.indexOf("/")&&(dotMode="/");var splitDateFormat=dateFormat.split(dotMode);for(i in splitDateFormat){var sectionDate=splitDateFormat[i];4===sectionDate.length&&(splitDateFormat[i]=sectionDate.substring(0,2))}return splitDateFormat.join(dotMode)},getDateInDBInsertFormat:function(dateFormat,dateString){var i=0,dotMode="-";-1!==dateFormat.indexOf("-")?dotMode="-":-1!==dateFormat.indexOf(".")?dotMode=".":-1!==dateFormat.indexOf("/")&&(dotMode="/");var dateFormatParts=dateFormat.split(dotMode),day="",month="",year="",dateParts=dateString.split(dotMode);for(i in dateFormatParts){switch(dateFormatParts[i]){case"dd":day=dateParts[i];break;case"mm":month=dateParts[i];break;case"yyyy":year=dateParts[i]}}return year+"-"+month+"-"+day},registerEventForDateFields:function(parentElement){void 0===parentElement&&(parentElement=$("body"));var element=void 0;(element=(parentElement=$(parentElement)).hasClass("dateField")?parentElement:$(".dateField",parentElement)).datepicker({autoclose:!0}).on("changeDate",(function(ev){var currentElement=$(ev.currentTarget),dateFormat=currentElement.data("dateFormat").toUpperCase(),date=$.datepicker.formatDate(moment(ev.date).format(dateFormat),ev.date);currentElement.val(date)})),App.Fields.Utils.hideMobileKeyboard(element)},registerEventForClockPicker:function(){var timeInputs=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$(".clockPicker");if(timeInputs.hasClass("clockPicker")||(timeInputs=timeInputs.find(".clockPicker")),timeInputs.length){var params={placement:"bottom",autoclose:!0,minutestep:5};$(".js-clock__btn").on("click",(function(e){e.stopPropagation();var tempElement=$(e.currentTarget).closest(".time").find("input.clockPicker");"disabled"!==tempElement.attr("disabled")&&"readonly"!==tempElement.attr("readonly")&&tempElement.clockpicker("show")}));var formatTimeString=function(timeInput){if(params.twelvehour){var meridiemTime="";params.afterDone=function(){var timeString=timeInput.val(),timeStringFormatted=timeString.slice(0,timeString.length-2)+" "+meridiemTime;timeInput.val(timeStringFormatted),app.event.trigger("Clockpicker.changed",timeInput)},params.beforeHide=function(){meridiemTime=$(".clockpicker-buttons-am-pm:visible").find("a:not(.text-white-50)").text()}}else params.afterDone=function(){app.event.trigger("Clockpicker.changed",timeInput)}};timeInputs.each((function(i,e){var timeInput=$(e),formatTime=timeInputs.data("format")||CONFIG.hourFormat;params.twelvehour=12===parseInt(formatTime),formatTimeString(timeInput),timeInput.clockpicker(params)})),App.Fields.Utils.hideMobileKeyboard(timeInputs)}},registerDataTables:function(table){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null!=$.fn.dataTable&&(0!=table.length&&($.extend($.fn.dataTable.defaults,{language:{sLengthMenu:app.vtranslate("JS_S_LENGTH_MENU"),sZeroRecords:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfo:app.vtranslate("JS_S_INFO"),sInfoEmpty:app.vtranslate("JS_S_INFO_EMPTY"),sSearch:app.vtranslate("JS_SEARCH"),sEmptyTable:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfoFiltered:app.vtranslate("JS_S_INFO_FILTERED"),sLoadingRecords:app.vtranslate("JS_LOADING_OF_RECORDS"),sProcessing:app.vtranslate("JS_LOADING_OF_RECORDS"),oPaginate:{sFirst:app.vtranslate("JS_S_FIRST"),sPrevious:app.vtranslate("JS_S_PREVIOUS"),sNext:app.vtranslate("JS_S_NEXT"),sLast:app.vtranslate("JS_S_LAST")},oAria:{sSortAscending:app.vtranslate("JS_S_SORT_ASCENDING"),sSortDescending:app.vtranslate("JS_S_SORT_DESCENDING")}}}),table.DataTable(options)))},getSelect2ElementFromSelect:function(selectElement){var selectId=selectElement.attr("id");return $("#"+("select2-"+selectId+"-container")).closest(".select2-container")},setInheritWidth:function(elements){$(elements).each((function(index,element){var parentWidth=$(element).parent().width();$(element).width(parentWidth)}))},showNewScrollbar:function(element){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{wheelPropagation:!0};if(void 0!==element&&element.length)return new PerfectScrollbar(element[0],Object.assign(this.scrollOptions,options))},showNewScrollbarTopBottomRight:function(element){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0!==element&&element.length){options=Object.assign(this.scrollOptions,options);var scrollbarTopLeftInit=new PerfectScrollbar(element[0],options),scrollbarTopElement=element.find(".ps__rail-x").first();scrollbarTopElement.css({top:0,bottom:"auto"}),scrollbarTopElement.find(".ps__thumb-x").css({top:2,bottom:"auto"});var scrollbarBottomRightInit=new PerfectScrollbar(element[0],options);return[scrollbarTopLeftInit,scrollbarBottomRightInit]}},showNewScrollbarTopBottom:function(element){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{wheelPropagation:!0,suppressScrollY:!0};if(void 0!==element&&element.length){options=Object.assign(this.scrollOptions,options),new PerfectScrollbar(element[0],options),new PerfectScrollbar(element[0],options);var scrollbarTopElement=element.find(".ps__rail-x").first();scrollbarTopElement.css({top:0,bottom:"auto"}),scrollbarTopElement.find(".ps__thumb-x").css({top:2,bottom:"auto"})}},showNewScrollbarTop:function(element){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{wheelPropagation:!0,suppressScrollY:!0};if(void 0!==element&&element.length){options=Object.assign(this.scrollOptions,options),new PerfectScrollbar(element[0],options);var scrollbarTopElement=element.find(".ps__rail-x").first();scrollbarTopElement.css({top:0,bottom:"auto"}),scrollbarTopElement.find(".ps__thumb-x").css({top:2,bottom:"auto"})}},showNewScrollbarLeft:function(element){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{wheelPropagation:!0};if(void 0!==element&&element.length){options=Object.assign(this.scrollOptions,options),new PerfectScrollbar(element[0],options);var scrollbarLeftElement=element.children(".ps__rail-y").first();scrollbarLeftElement.css({left:0,right:"auto"}),scrollbarLeftElement.find(".ps__thumb-y").css({left:2,right:"auto"})}},showScrollBar:function(element){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return void 0===options.height&&(options.height=element.css("height")),element.slimScroll(options)},registerMiddleClickScroll:function(container){var middleScroll=!1;container.on("mousedown",(function(e){if(2==e.which&&0==middleScroll){middleScroll=!0;var mouseY=e.pageY,mouseX=e.pageX;$(document).on("mousemove",(function(e){if(1==middleScroll){$("body").addClass("u-cursor-scroll-all");var mouseMoveY=mouseY-e.pageY,scrollerY=container.scrollTop()-mouseMoveY-100,mouseMoveX=mouseX-e.pageX,scrollerX=container.scrollLeft()-mouseMoveX-100;container.scrollTop(scrollerY),container.scrollLeft(scrollerX)}}))}})),container.on("mouseup",(function(){$("body").removeClass("u-cursor-scroll-all"),middleScroll=!1}))},vtranslate:function(key){return key in LANG?LANG[key]:key},cacheNSKey:function(key){return"yf."+key},cacheGet:function(key){return key=this.cacheNSKey(key),store.get(key)},cacheSet:function(key,value){key=this.cacheNSKey(key),store.set(key,value)},cacheClear:function(key){return key=this.cacheNSKey(key),store.remove(key)},moduleCacheSet:function(key,value){var orgKey=key;key=this.getModuleName()+"_"+key,this.cacheSet(key,value);var cacheKey="mCache"+this.getModuleName(),moduleCache=this.cacheGet(cacheKey);(moduleCache=null==moduleCache?[]:moduleCache.split(",")).push(orgKey),this.cacheSet(cacheKey,Vtiger_Helper_Js.unique(moduleCache).join(","))},moduleCacheGet:function(key){return this.cacheGet(this.getModuleName()+"_"+key)},moduleCacheKeys:function(){var cacheKey="mCache"+this.getModuleName(),modules=this.cacheGet(cacheKey);return modules?modules.split(","):[]},moduleCacheClear:function(key){var thisInstance=this,moduleName=this.getModuleName(),cacheKey="mCache"+moduleName,moduleCache=this.cacheGet(cacheKey);moduleCache=null==moduleCache?[]:moduleCache.split(","),$.each(moduleCache,(function(index,value){thisInstance.cacheClear(moduleName+"_"+value)})),thisInstance.cacheClear(cacheKey)},htmlEncode:function(value){return value?$("<div />").text(value).html():""},htmlDecode:function(value){return value?$("<div />").html(value).text():""},placeAtCenter:function(element){element.css("position","absolute"),element.css("top",($(window).height()-element.outerHeight())/2+$(window).scrollTop()+"px"),element.css("left",($(window).width()-element.outerWidth())/2+$(window).scrollLeft()+"px")},getvalidationEngineOptions:function(select2Status){return Object.assign({},app.validationEngineOptions)},notifyPostAjaxReady:function(){$(document).trigger("postajaxready")},listenPostAjaxReady:function(callback){$(document).on("postajaxready",callback)},setFormValues:function(kv){for(var k in kv)$(k).val(kv[k])},setRTEValues:function(kv){for(var k in kv){var rte=CKEDITOR.instances[k];rte&&rte.setData(kv[k])}},getPageController:function(){if(window.pageController)return window.pageController;var moduleName=app.getModuleName(),view=app.getViewName(),parentModule=app.getParentModuleName(),moduleClassName=parentModule+"_"+moduleName+"_"+view+"_Js";void 0===window[moduleClassName]&&(moduleClassName=parentModule+"_Vtiger_"+view+"_Js"),void 0===window[moduleClassName]&&(moduleClassName=moduleName+"_"+view+"_Js");var extendModules=$("#extendModules").val();if(void 0===window[moduleClassName]&&null!=extendModules&&(moduleClassName=extendModules+"_"+view+"_Js"),void 0===window[moduleClassName]&&(moduleClassName="Vtiger_"+view+"_Js"),void 0!==window[moduleClassName]){if("function"==typeof window[moduleClassName])return window.pageController=new window[moduleClassName];if("object"===_typeof(window[moduleClassName]))return window.pageController=window[moduleClassName]}var moduleBaseClassName=parentModule+"_"+moduleName+"_Index_Js";if(void 0!==window[moduleBaseClassName]){if("function"==typeof window[moduleBaseClassName])return window.pageController=new window[moduleBaseClassName];if("object"===_typeof(window[moduleBaseClassName]))return window.pageController=window[moduleBaseClassName]}},getDecodedValue:function(value){return $("<div></div>").html(value).text()},getCookie:function(c_name){var c_value=document.cookie,c_start=c_value.indexOf(" "+c_name+"=");if(-1===c_start&&(c_start=c_value.indexOf(c_name+"=")),-1===c_start)c_value=null;else{c_start=c_value.indexOf("=",c_start)+1;var c_end=c_value.indexOf(";",c_start);-1===c_end&&(c_end=c_value.length),c_value=unescape(c_value.substring(c_start,c_end))}return c_value},setCookie:function(c_name,value,exdays){var exdate=new Date;exdate.setDate(exdate.getDate()+exdays);var c_value=escape(value)+(null==exdays?"":"; expires="+exdate.toUTCString());document.cookie=c_name+"="+c_value},getUrlVar:function(varName){var vars;return(vars={},window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(m,key,value){vars[key]=value})),vars)[varName]},getStringDate:function(date){var d=date.getDate(),m=date.getMonth()+1;return date.getFullYear()+"-"+(m=m<=9?"0"+m:m)+"-"+(d=d<=9?"0"+d:d)},formatDate:function(date){var y=date.getFullYear(),m=date.getMonth()+1,d=date.getDate(),h=date.getHours(),i=date.getMinutes(),s=date.getSeconds();return y+"-"+this.formatDateZ(m)+"-"+this.formatDateZ(d)+" "+this.formatDateZ(h)+":"+this.formatDateZ(i)+":"+this.formatDateZ(s)},formatDateZ:function(i){return i<=9?"0"+i:i},howManyDaysFromDate:function(time){var fromTime=time.getTime(),today=new Date,toTime=new Date(today.getFullYear(),today.getMonth(),today.getDate()).getTime();return Math.floor((toTime-fromTime)/864e5)+1},saveAjax:function(mode,param,addToParams){var aDeferred=$.Deferred(),params={};if(params.module=app.getModuleName(),params.parent=app.getParentModuleName(),params.action="SaveAjax",mode&&(params.mode=mode),params.param=param,null!=addToParams)for(var i in addToParams)params[i]=addToParams[i];return AppConnector.request(params).done((function(data){aDeferred.resolve(data)})).fail((function(textStatus,errorThrown){aDeferred.reject(textStatus,errorThrown)})),aDeferred.promise()},removeEmptyFilesInput:function(form){for(var i=0;i<form.elements.length;i++)"file"===form.elements[i].type&&""===form.elements[i].value&&form.elements[i].parentNode.removeChild(form.elements[i])},getMainParams:function(param,json){if(param in CONFIG)return CONFIG[param];void 0===app.cacheParams[param]&&(app.cacheParams[param]=$("#"+param).val());var value=app.cacheParams[param];return json&&(value=value?JSON.parse(value):[]),value},setMainParams:function(param,value){app.cacheParams[param]=value,$("#"+param).val(value)},errorLog:function(error,err,errorThrown){CONFIG.debug&&(console.warn("%cYetiForce debug mode!!!","color: red; font-family: sans-serif; font-size: 1.5em; font-weight: bolder; text-shadow: #000 1px 1px;"),"object"===(void 0===error?"undefined":_typeof(error))&&error.responseText&&(error=error.responseText),"object"===(void 0===error?"undefined":_typeof(error))&&error.statusText&&(error=error.statusText),error&&console.error(error),err&&"error"!==err&&console.error(err),errorThrown&&console.error(errorThrown))},registerQuickEditModal:function(container){void 0===container&&(container=$("body")),container.on("click",".js-quick-edit-modal",(function(e){e.preventDefault();var element=$(this),data={module:element.data("module"),record:element.data("record")};element.data("values")&&$.extend(data,element.data("values")),element.data("mandatoryFields")&&(data.mandatoryFields=element.data("mandatoryFields")),element.data("showLayout")&&(data.showLayout=element.data("showLayout")),element.data("editFields")&&(data.editFields=element.data("editFields")),App.Components.QuickEdit.showModal(data)}))},registerModal:function(container){void 0===container&&(container=$("body")),container.off("click","button.showModal, a.showModal, .js-show-modal").on("click","button.showModal, a.showModal, .js-show-modal",(function(e){e.preventDefault();var currentElement=$(e.currentTarget),url=currentElement.data("url");if(void 0!==url){currentElement.hasClass("js-popover-tooltip")&&currentElement.popover("hide"),currentElement.hasClass("disabledOnClick")&&currentElement.attr("disabled",!0);var modalWindowParams={url:url,cb:function(container){var call=currentElement.data("cb");if(void 0!==call)if(-1!==call.indexOf(".")){var callerArray=call.split(".");"object"!==_typeof(window[callerArray[0]])&&"function"!=typeof window[callerArray[0]]||window[callerArray[0]][callerArray[1]](container)}else"function"==typeof window[call]&&window[call](container);currentElement.removeAttr("disabled")}};currentElement.data("modalid")&&(modalWindowParams.id=currentElement.data("modalid")),app.showModalWindow(modalWindowParams)}e.stopPropagation()}))},playSound:function(action){var soundsConfig=app.getMainParams("sounds");soundsConfig.IS_ENABLED&&new Audio(app.getMainParams("soundFilesPath")+soundsConfig[action]).play()},registerIframeAndMoreContent:function(){var showMoreModal=function(e){e.preventDefault(),e.stopPropagation();var btn=$(e.currentTarget),message=btn.data("iframe")?btn.siblings("iframe").clone().show():btn.closest(".js-more-content").find(".fullContent").html();bootbox.dialog({message:message,title:'<span class="mdi mdi-overscan"></span>  '+app.vtranslate("JS_FULL_TEXT"),className:"u-word-break modal-fullscreen",buttons:{danger:{label:'<span class="fas fa-times mr-1"></span>'+app.vtranslate("JS_CLOSE"),className:"btn-danger",callback:function(){}}}})};$(".js-more").on("click",showMoreModal),$(document).on("click",".js-more",showMoreModal)},registerIframeEvents:function(content){content.find(".js-iframe-full-height").each((function(){var iframe=$(this);iframe.on("load",(function(e){iframe.height(iframe.contents().find("body").height()+50)}))})),content.find(".js-modal-iframe").each((function(){var iframe=$(this);iframe.on("load",(function(e){var height=iframe.contents().find("body").height();height&&height<iframe.height()&&iframe.height(height+50)}))}))},registerMenu:function(){var self=this;self.keyboard={DOWN:40,ESCAPE:27,LEFT:37,RIGHT:39,SPACE:32,UP:38},self.sidebarBtn=$(".js-sidebar-btn").first(),self.sidebar=$(".js-sidebar").first(),self.sidebarBtn.on("click",self.toggleSidebar.bind(self)),$("a.nav-link,[tabindex],input,select,textarea,button").on("focus",(function(e){self.sidebarBtn[0]==e.target||self.sidebar.find(e.target).length||(self.sidebar.find(":focus").length?self.openSidebar():self.sidebar.hasClass("js-expand")&&self.closeSidebar())})),self.sidebar.on("mouseenter",self.openSidebar.bind(self)).on("mouseleave",self.closeSidebar.bind(self)),self.sidebar.find(".js-menu__content").on("keydown",self.sidebarKeyboard.bind(self)),self.sidebar.on("keydown",(function(e){e.which==self.keyboard.ESCAPE&&(self.closeSidebar(),self.sidebarBtn.is(":tabbable")?self.sidebarBtn.focus():$(":tabbable").eq(parseInt($(":tabbable").index(self.sidebar.find(":tabbable").last()))+1).focus())})),self.sidebar.find(".js-submenu").on("shown.bs.collapse",(function(e){$(e.target).find(":tabbable").first().focus()})),$(".js-submenu-toggler").on("click",(function(e){$(e.currentTarget).hasClass("collapsed")||$(e.target).closest(".toggler").length||(window.location=$(e.currentTarget).attr("href"))})),self.registerPinEvent()},openSidebar:function(){this.sidebar.addClass("js-expand"),this.sidebarBtn.attr("aria-expanded",!0)},closeSidebar:function(){this.sidebar.removeClass("js-expand"),this.sidebarBtn.attr("aria-expanded",!1)},toggleSidebar:function(){this.sidebar.hasClass("js-expand")?this.closeSidebar():(this.openSidebar(),this.sidebar.find(".js-menu__content :tabbable").first().focus())},registerPinEvent:function(){var self=this,pinButton=self.sidebar.find(".js-menu--pin"),baseContainer=self.sidebar.closest(".js-base-container");pinButton.on("click",(function(){var hideMenu=0;baseContainer.removeClass("c-menu--animation"),"0"===pinButton.attr("data-show")?(hideMenu="on",pinButton.removeClass("u-opacity-muted"),baseContainer.addClass("c-menu--open"),self.sidebar.off("mouseleave mouseenter")):(pinButton.addClass("u-opacity-muted"),baseContainer.removeClass("c-menu--open"),self.sidebar.on("mouseenter",self.openSidebar.bind(self)).on("mouseleave",self.closeSidebar.bind(self)),self.closeSidebar.bind(self)),AppConnector.request({module:"Users",action:"SaveAjax",field:"leftpanelhide",record:CONFIG.userId,value:hideMenu}).done((function(responseData){responseData.success&&responseData.result&&pinButton.attr("data-show",hideMenu)})),setTimeout((function(){baseContainer.addClass("c-menu--animation")}),300)}))},sidebarKeyboard:function(e){var target=$(e.target);if(e.which==this.keyboard.LEFT){if(target.hasClass("js-submenu-toggler")&&!target.hasClass("collapsed"))return target.click(),!1;var toggler=$(e.target).closest(".js-submenu").prev(".js-submenu-toggler");if(toggler.length&&!toggler.hasClass("collapsed"))return toggler.click().focus(),!1}else{if(target.hasClass("js-submenu-toggler")&&e.which==this.keyboard.RIGHT&&target.hasClass("collapsed")||target.hasClass("js-submenu-toggler")&&e.which==this.keyboard.SPACE)return target.click(),!1;if(e.which==this.keyboard.UP)return this.sidebar.find(".js-menu__content :tabbable").eq(parseInt(this.sidebar.find(".js-menu__content :tabbable").index(target))-1).focus(),!1;if(e.which==this.keyboard.DOWN)return this.sidebar.find(".js-menu__content :tabbable").eq(parseInt(this.sidebar.find(".js-menu__content :tabbable").index(target))+1).focus(),!1}},registerTabdrop:function(){var tabs=$(".js-tabdrop");if(tabs.length){var tab=tabs.find("> li");tab.each((function(){$(this).removeClass("d-none")})),tabs.tabdrop({text:app.vtranslate("JS_MORE")}),tabs.find("> li.dropdown").appendTo(tabs),tab.on("click",(function(e){setTimeout((function(){$(window).trigger("resize")}),500)})),$(window).trigger("resize")}},getScreenHeight:function(percantage){return void 0===percantage&&(percantage=100),$(window).height()*percantage/100},clearBrowsingHistory:function(){AppConnector.request({module:"Home",action:"BrowsingHistory"}).done((function(response){$(".historyList").html('<a class="item dropdown-item" href="#" role="listitem">'+app.vtranslate("JS_NO_RECORDS")+"</a>")}))},openUrl:function(url){"parentIframe"===CONFIG.openUrlTarget?window.parent.location.href=url:window.location.href=url},openUrlMethodPost:function(url){var postData=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},formAttr=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};$.extend(formAttr,{method:"post",action:url,style:"display:none;"});var form=$("<form></form>",formAttr);"undefined"!=typeof csrfMagicName&&(postData[csrfMagicName]=csrfMagicToken),$.each(postData,(function(index,value){var input=$(document.createElement("input"));input.attr("type","hidden"),input.attr("name",index),input.val(value),form.append(input)})),$("body").append(form),form.submit(),form.remove()},convertUrlToObject:function(url){var urlObject={};return url.split("index.php?")[1].split("&").forEach((function(el){if(el.includes("=")){var values=el.split("=");urlObject[values[0]]=values[1]}})),urlObject},convertObjectToUrl:function(){var urlData=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},entryFile=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"index.php?",url=entryFile;return Object.keys(urlData).forEach((function(key){var value=urlData[key];"object"===(void 0===value?"undefined":_typeof(value))||"string"==typeof value&&value.startsWith("<")||(url+=key+"="+value+"&")})),url},showConfirmation:function(data,element){var params={};data&&(params=$.extend(params,data)),element&&(element=$(element),params.title||(params.title=element.html()+" "+(element.data("content")?element.data("content"):"")),params.message||(params.message=element.data("confirm")),params.url||(params.url=element.data("url"))),Vtiger_Helper_Js.showConfirmationBox(params).done((function(){"href"==params.type?AppConnector.request(params.url).done((function(data){app.openUrl(data.result)})):"reloadTab"==params.type&&AppConnector.request(params.url).done((function(data){Vtiger_Detail_Js.getInstance().reloadTabContent()}))}))},formatToHourText:function(decTime){var type=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"short",withSeconds=arguments.length>2&&void 0!==arguments[2]&&arguments[2],withMinutes=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],short="short"===type,hour=Math.floor(decTime),min=Math.floor(60*(decTime-hour)),sec=Math.round(60*(60*(decTime-hour)-min)),result="";return hour&&(result+=short?hour+app.vtranslate("JS_H"):hour+" "+app.vtranslate("JS_H_LONG")),(hour||min)&&withMinutes&&(result+=short?" "+min+app.vtranslate("JS_M"):" "+min+" "+app.vtranslate("JS_M_LONG")),!1!==withSeconds&&(result+=short?" "+sec+app.vtranslate("JS_S"):" "+sec+" "+app.vtranslate("JS_S_LONG")),hour||min||!1!==withSeconds||!withMinutes||(result+=short?"0"+app.vtranslate("JS_M"):"0 "+app.vtranslate("JS_M_LONG")),hour||min||!1!==withSeconds||withMinutes||(result+=short?"0"+app.vtranslate("JS_H"):"0 "+app.vtranslate("JS_H_LONG")),result.trim()},showRecordsList:function(){var params=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},cb=arguments[1],afterShowModal=arguments[2];params.view||(params.view="RecordsList"),this.showRecordsListModal(params).done((function(modal){"function"==typeof afterShowModal&&afterShowModal(modal),app.registerModalController(!1,modal,cb)}))},showRecordsListModal:function(params){var aDeferred=$.Deferred();return AppConnector.request(params).done((function(requestData){app.showModalWindow(requestData,(function(modal){aDeferred.resolve(modal)}))})).fail((function(textStatus,errorThrown){aDeferred.reject(textStatus,errorThrown)})),aDeferred.promise()},htmlToImage:function(element,callback){var options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{imageType:"image/png",logging:!1};element=$(element).get(0);var imageType=options.imageType;return delete options.imageType,html2canvas(element,options).then((function(canvas){var base64Image=canvas.toDataURL(imageType);return"function"==typeof callback&&callback(base64Image),base64Image}))},decodeHTML:function(html){var txt=document.createElement("textarea");return txt.innerHTML=html,txt.value},showAlert:function(customParams){var userParams=customParams;"string"==typeof customParams&&((userParams={}).text=customParams);var params={target:document.body,data:{type:"error",hide:!1,stack:{dir1:"down",modal:!0,firstpos1:25},modules:{Confirm:{confirm:!0,buttons:[{text:"Ok",promptTrigger:!0,primary:!0,click:function(notice){notice.close()}}]},Buttons:{closer:!1,sticker:!1},History:{history:!1}}}};return void 0!==userParams&&(params.data=$.extend(params.data,userParams)),new PNotify(params)},showConfirmModal:function(customParams){var confirmCallback=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},cancelCallback=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},aDeferred=$.Deferred(),userParams=customParams;"string"==typeof customParams&&((userParams={}).text=customParams);var params={target:document.body,data:{hide:!1,icon:"fas fa-question-circle",stack:{dir1:"down",modal:!0,firstpos1:25},modules:{Confirm:{confirm:!0,buttons:[{text:app.vtranslate("JS_OK"),primary:!0,promptTrigger:!0,click:function(notice){notice.close(),confirmCallback(),aDeferred.resolve(!0)}},{text:app.vtranslate("JS_CANCEL"),click:function(notice){notice.close(),cancelCallback(),aDeferred.resolve(!1)}}]},Buttons:{closer:!1,sticker:!1},History:{history:!1}}}};return void 0!==userParams&&(params.data=$.extend(params.data,userParams)),new PNotify(params),aDeferred.promise()},registesterScrollbar:function(container){container.find(".js-scrollbar").each((function(){var element=$(this),scrollbarFnName=element.data("scrollbarFnName");"function"==typeof app[scrollbarFnName]?app[scrollbarFnName](element):app.showNewScrollbar(element)}))},registerPopover:function(){var container=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$(document);window.popoverCache={},container.on("mousemove",(function(e){app.mousePosition={x:e.pageX,y:e.pageY}})),container.on("mouseenter",'.js-popover-tooltip, .js-popover-tooltip--record, .js-popover-tooltip--ellipsis, [data-field-type="reference"], [data-field-type="multireference"]',(function(e){var currentTarget=$(e.currentTarget);currentTarget.find(".js-popover-tooltip--record").length||currentTarget.hasClass("popover-triggered")||(currentTarget.hasClass("js-popover-tooltip--record")?(app.registerPopoverRecord(currentTarget,{},container),currentTarget.trigger("mouseenter")):!currentTarget.hasClass("js-popover-tooltip--record")&&currentTarget.data("field-type")?app.registerPopoverRecord(currentTarget.children("a"),{},container):currentTarget.hasClass("js-popover-tooltip--record")||currentTarget.find(".js-popover-tooltip--record").length||currentTarget.data("field-type")||(currentTarget.hasClass("js-popover-tooltip--ellipsis")?app.registerPopoverEllipsis({element:currentTarget,container:container}):app.showPopoverElementView(currentTarget),currentTarget.trigger("mouseenter")))}))},showNotify:function(params){void 0===params.type&&(params.type="info"),void 0===params.title&&(params.title=app.vtranslate("JS_MESSAGE")),Vtiger_Helper_Js.showPnotify(params)},showDesktopNotification:function(params){params=$.extend(params,{modules:{Desktop:{desktop:!0,fallback:!1,icon:params.icon}}}),PNotify.notice(params)},setPnotifyDefaultOptions:function(){PNotify.defaults.textTrusted=!0,PNotify.defaults.titleTrusted=!0,PNotify.defaults.styling="bootstrap4",PNotify.defaults.icons="fontawesome5"},registerFormatNumber:function(){$(document).on("focusout",".js-format-numer",(function(e){$(e.currentTarget).formatNumber()}))},registerToggleIconClick:function(container){container.on("click",".js-toggle-icon, .js-toggle-icon__container",(function(e){var icon=$(e.target);icon.hasClass("js-toggle-icon__container")&&(icon=icon.find(".js-toggle-icon"));var iconData=icon.data();icon.toggleClass(iconData.active+" "+iconData.inactive),e.stopPropagation()}))},stripHtml:function(html){var temporalDiv=document.createElement("div");return temporalDiv.innerHTML=html,temporalDiv.textContent||temporalDiv.innerText||""}};CKEDITOR.disableAutoInline=!0,$(document).ready((function(){Quasar.iconSet.set(Quasar.iconSet.mdiV3);var document=$(this);app.registerToggleIconClick(document),app.touchDevice=app.isTouchDevice(),app.setPnotifyDefaultOptions(),App.Fields.Picklist.changeSelectElementView(),app.registerPopoverEllipsisIcon(),app.registerPopover(),app.registerFormatNumber(),app.registerIframeAndMoreContent(),app.registerModal(),app.registerQuickEditModal(),app.registerMenu(),app.registerTabdrop(),app.registerIframeEvents(document),app.registesterScrollbar(document),App.Components.Scrollbar.initPage(),String.prototype.toCamelCase=function(){var value=this.valueOf();return value.charAt(0).toUpperCase()+value.slice(1).toLowerCase()},(/MSIE/.test(navigator.userAgent)||/Trident/.test(navigator.userAgent))&&$("textarea").resizable();var pageController=app.getPageController();pageController&&pageController.registerEvents()})),function($){$.fn.getNumberFromValue=function(){return App.Fields.Double.formatToDb($(this).val())},$.fn.getNumberFromText=function(){return App.Fields.Double.formatToDb($(this).text())},$.fn.setValue=function(value){var type=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"value";return App.Fields.Utils.setValue($(this),value,type)},$.fn.formatNumber=function(){var element=$(this);element.val(App.Fields.Double.formatToDisplay(App.Fields.Double.formatToDb(element.val()),!1))},$.fn.disable=function(){this.attr("disabled","disabled")},$.fn.enable=function(){this.removeAttr("disabled")},$.fn.serializeFormData=function(){var form=$(this);for(var instance in CKEDITOR.instances)CKEDITOR.instances[instance].updateElement();var values=form.serializeArray(),data={};values&&$(values).each((function(k,v){if(v.name in data&&"object"!==_typeof(data[v.name])){var element=form.find('[name="'+v.name+'"]');if(element.is("select")&&null!=element.attr("multiple")){var prevValue=data[v.name];data[v.name]=[],data[v.name].push(prevValue)}}"object"===_typeof(data[v.name])?data[v.name].push(v.value):data[v.name]=v.value}));var autocompletes=$('[data-type="autocomplete"]',$(this));return $(autocompletes).each((function(i){var ac=$(autocompletes[i]);data[ac.attr("name")]=ac.data("value")})),data},$.expr[":"].icontains=function(obj,index,meta,stack){return-1!==(obj.textContent||obj.innerText||$(obj).text()||"").toLowerCase().indexOf(meta[3].toLowerCase())},$.fn.removeTextNode=function(){$(this).contents().filter((function(){return 3==this.nodeType})).remove()},bootbox.setLocale(CONFIG.langKey)}($);
//# sourceMappingURL=app.min.js.map
