{"version":3,"file":"BriaSoftphone.min.js","sources":["BriaSoftphone.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\nIntegrations_Pbx_Base.driver = 'BriaSoftphone';\n/**\n * @classdesc Bria Softphone Pbx integrations class.\n * @class\n */\nwindow.Integrations_Pbx_BriaSoftphone = class Integrations_Pbx_BriaSoftphone extends Integrations_Pbx_Base {\n\t/** @inheritdoc */\n\tconstructor(container) {\n\t\tsuper(container);\n\t\tthis.btnText = this.accountName = this.lastEvent = this.status = this.connected = false;\n\t\ttry {\n\t\t\tthis.initWebsocket();\n\t\t} catch (e) {\n\t\t\tconsole.warn('WebSocket exception: ' + e);\n\t\t\tthis.connected = false;\n\t\t}\n\t\tthis.container.find('.js-phone-status-btn').on('click', (e) => {\n\t\t\tif (this.connected) {\n\t\t\t\tthis.bringToFront();\n\t\t\t}\n\t\t});\n\t}\n\t/** @inheritdoc */\n\tperformCall(data) {\n\t\tif (this.connected) {\n\t\t\tthis.apiCall(\n\t\t\t\t'call',\n\t\t\t\t`<dial type=\"audio\"><number>${data.phone}</number><displayName></displayName><suppressMainWindow>false</suppressMainWindow></dial>`\n\t\t\t);\n\t\t} else {\n\t\t\tapp.showError({\n\t\t\t\ttitle: app.vtranslate('JS_UNEXPECTED_ERROR')\n\t\t\t});\n\t\t}\n\t}\n\t/**\n\t * Connection initialization via websocket\n\t */\n\tinitWebsocket() {\n\t\tthis.connected = false;\n\t\tthis.websocket = new WebSocket('wss://cpclientapi.softphone.com:9002/counterpath/socketapi/v1/');\n\t\tthis.websocket.onopen = (e) => {\n\t\t\tthis.connected = true;\n\t\t\tthis.setStatus('Connected', e);\n\t\t\tthis.getStatus('account', '<accountType>sip</accountType>');\n\t\t};\n\t\tthis.websocket.onclose = (e) => {\n\t\t\tif (this.connected) {\n\t\t\t\tthis.setStatus('Disconnected', e);\n\t\t\t} else {\n\t\t\t\tthis.setStatus('Close', e);\n\t\t\t}\n\t\t\tthis.connected = false;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.initWebsocket();\n\t\t\t}, 5000);\n\t\t};\n\t\tthis.websocket.onerror = (e) => {\n\t\t\tthis.connected = false;\n\t\t\tthis.setStatus('Error', e);\n\t\t\tthis.websocket.close();\n\t\t};\n\t\tthis.websocket.onmessage = (e) => {\n\t\t\tthis.received(e.data);\n\t\t};\n\t}\n\t/**\n\t * Update button\n\t */\n\tupdateBtn() {\n\t\tconst btn = this.container.find('.js-phone-status-btn'),\n\t\t\tbtnIcon = btn.find('.js-icon'),\n\t\t\tbtnText = btn.find('.js-text');\n\t\tbtn.removeClass('d-none');\n\t\tbtn.attr('class', function (i, c) {\n\t\t\treturn c.replace(/(^|\\s)btn-\\S+/g, '');\n\t\t});\n\t\tlet title = this.status;\n\t\tswitch (this.status) {\n\t\t\tcase 'Ringing':\n\t\t\t\tbtn.addClass('btn-primary');\n\t\t\t\tbtnIcon.removeClass().addClass('fa-solid fa-phone-volume js-icon');\n\t\t\t\tbreak;\n\t\t\tcase 'Service Unavailable':\n\t\t\t\tbtn.addClass('btn-warning');\n\t\t\t\tbtnIcon.removeClass().addClass('fa-solid fa-phone-slash js-icon');\n\t\t\t\tbreak;\n\t\t\tcase 'Disconnected':\n\t\t\tcase 'Close':\n\t\t\t\tbtn.addClass('btn-danger');\n\t\t\t\tbtnIcon.removeClass().addClass('fa-solid fa-phone-slash js-icon');\n\t\t\t\tbreak;\n\t\t\tcase 'Connected':\n\t\t\tdefault:\n\t\t\t\tbtn.addClass('btn-success');\n\t\t\t\tbtnIcon.removeClass().addClass('fa-solid fa-phone-flip js-icon');\n\t\t\t\tbreak;\n\t\t}\n\t\tif (this.lastEvent && (this.lastEvent.code || this.lastEvent.name)) {\n\t\t\ttitle += ' (' + (this.lastEvent.code || this.lastEvent.name) + ')';\n\t\t}\n\t\tbtn.attr('title', title);\n\t\tif (this.btnText) {\n\t\t\tbtnText.text(this.btnText).addClass('ml-2');\n\t\t} else {\n\t\t\tbtnText.removeClass('ml-2');\n\t\t}\n\t}\n\t/**\n\t * Message event\n\t * @param {object} data\n\t */\n\treceived(data) {\n\t\tconst message = this.parseMessage(data);\n\t\tif (message['errorCode']) {\n\t\t\tthis.setStatus(message['errorText']);\n\t\t} else {\n\t\t\tswitch (message['messageType']) {\n\t\t\t\tcase 'RESPONSE':\n\t\t\t\t\tthis.response(message['xml']);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'EVENT':\n\t\t\t\t\tthis.event(message['xml']);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.updateBtn();\n\t}\n\t/**\n\t * Response message type\n\t * @param {jQuery} xml\n\t */\n\tresponse(xml) {\n\t\tif (xml) {\n\t\t\tconst type = xml.children(':first').attr('type'),\n\t\t\t\tfn = 'request' + type.charAt(0).toUpperCase() + type.slice(1);\n\t\t\tthis.log('|◄| ' + fn + ' [' + (fn in this) + ']', xml.get(0));\n\t\t\tif (fn in this) {\n\t\t\t\tthis[fn](xml.find(type));\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Event message type\n\t * @param {jQuery} xml\n\t */\n\tevent(xml) {\n\t\tif (xml) {\n\t\t\tconst type = xml.children(':first').attr('type'),\n\t\t\t\tfn = 'event' + type.charAt(0).toUpperCase() + type.slice(1);\n\t\t\tthis.log('|◄| ' + fn + ' [' + (fn in this) + ']', xml.get(0));\n\t\t\tif (fn in this) {\n\t\t\t\tthis[fn]();\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Account details request\n\t * @param {jQuery} xml\n\t * @description `|◄| requestAccount [true]`\n\t */\n\trequestAccount(xml) {\n\t\tthis.btnText = this.accountName = xml.find('accountName').text();\n\t\tconst value = app.cacheGet('PBX|lastCallHistoryUpdate|' + this.accountName, null);\n\t\tif (value == null || Math.floor((Date.now() - value) / 1000) > 300) {\n\t\t\tapp.cacheClear('PBX|lastCallHistoryUpdate|' + this.accountName);\n\t\t\tthis.getStatus('callHistory', '<count>20</count><entryType>all</entryType>');\n\t\t}\n\t}\n\t/**\n\t * Call history details request\n\t * @param {jQuery} xml\n\t * @description `|◄| requestCallHistory [true]`\n\t */\n\trequestCallHistory(xml) {\n\t\tlet calls = [];\n\t\txml.each((_, callsXml) => {\n\t\t\tlet call = {};\n\t\t\t$(callsXml)\n\t\t\t\t.children()\n\t\t\t\t.each((_, callXml) => {\n\t\t\t\t\tcall[callXml.tagName] = callXml.textContent;\n\t\t\t\t});\n\t\t\tcalls.push(call);\n\t\t});\n\t\tAppConnector.request({\n\t\t\tmodule: 'AppComponents',\n\t\t\taction: 'Pbx',\n\t\t\tmode: 'saveCalls',\n\t\t\taccountName: this.accountName,\n\t\t\tcalls: calls\n\t\t}).done((response) => {\n\t\t\tif (response.result.loadMore === true) {\n\t\t\t\tthis.getStatus('callHistory', '<count>100</count><entryType>all</entryType>');\n\t\t\t}\n\t\t});\n\t\tapp.cacheSet('PBX|lastCallHistoryUpdate|' + this.accountName, Date.now());\n\t}\n\t/**\n\t * Call request\n\t * @param {jQuery} xml\n\t * @description `|◄| requestCall [true]`\n\t */\n\trequestCall(xml) {\n\t\tif (xml.length) {\n\t\t\tthis.setStatus('Ringing');\n\t\t\tthis.btnText = xml.find('displayName').text();\n\t\t} else {\n\t\t\tthis.setStatus('Connected');\n\t\t\tthis.btnText = this.accountName;\n\t\t}\n\t}\n\t/**\n\t * Call history event\n\t * @description `|◄| eventCallHistory [true]`\n\t */\n\teventCallHistory() {\n\t\tthis.getStatus('callHistory', '<count>5</count><entryType>all</entryType>');\n\t}\n\t/**\n\t * Call event\n\t * @description `|◄| eventCall [true]`\n\t */\n\teventCall() {\n\t\tthis.setStatus('Ringing');\n\t\tthis.getStatus('call');\n\t}\n\t/**\n\t * Get status from phone application\n\t * @param {string} type\n\t * @param {string} custom\n\t * @description `|►| status`\n\t */\n\tgetStatus(type, custom) {\n\t\tif (!custom) {\n\t\t\tcustom = '';\n\t\t}\n\t\tthis.apiCall('status', `<status><type>${type}</type>${custom}</status>`);\n\t}\n\t/**\n\t * Show phone app\n\t * @description `|►| bringToFront`\n\t */\n\tbringToFront() {\n\t\tthis.apiCall('bringToFront', `<bringToFront><window>main</window></bringToFront>`);\n\t}\n\t/**\n\t * Set status event\n\t * @param {string} status\n\t * @param {Event} e\n\t */\n\tsetStatus(status, e) {\n\t\tthis.status = status;\n\t\tthis.lastEvent = e;\n\t\tthis.updateBtn();\n\t\tthis.log('☎ %c' + status);\n\t}\n\t/**\n\t * Send a request to the phone application\n\t * @param {string} method\n\t * @param {string} body\n\t */\n\tapiCall(method, body) {\n\t\tthis.log('|►| ' + method, body);\n\t\tbody = '<?xml version=\"1.0\" encoding=\"utf-8\" ?>\\r\\n' + body;\n\t\tlet msg = 'GET /' + method + '\\r\\nUser-Agent: YetiForce CRM';\n\t\tmsg += '\\r\\nContent-Type: application/xml\\r\\nContent-Length: ';\n\t\tmsg += body.length + '\\r\\n\\r\\n' + body;\n\t\tthis.websocket.send(msg);\n\t}\n\t/**\n\t * Parse response from websocket\n\t * @param {string} msg\n\t * @returns {object}\n\t */\n\tparseMessage(msg) {\n\t\tlet response = {},\n\t\t\tcontent = '';\n\t\tconst lines = msg.replace(/\\r\\n/g, '\\n').split('\\n');\n\t\tlet line = lines[0];\n\t\tif (line.substr(0, 4) == 'POST') {\n\t\t\tresponse['messageType'] = 'EVENT';\n\t\t\tline = line.substr(5).trim();\n\t\t\tresponse['eventType'] = line.substr(0, 13);\n\t\t} else if (line.substr(0, 8) == 'HTTP/1.1') {\n\t\t\tline = line.substr(8).trim();\n\t\t\tif (line.substr(0, 6) == '200 OK') {\n\t\t\t\tresponse['messageType'] = 'RESPONSE';\n\t\t\t} else if (line[0] == '4' || line[0] == '5') {\n\t\t\t\tresponse['messageType'] = 'ERROR';\n\t\t\t\tresponse['errorCode'] = line.substr(0, 3);\n\t\t\t\tresponse['errorText'] = line.substr(4);\n\t\t\t}\n\t\t}\n\t\tlet i = 1;\n\t\tfor (; i < lines.length; i++) {\n\t\t\tif (lines[i][0] == '<') {\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\t\tfor (; i < lines.length; i++) {\n\t\t\tcontent += lines[i];\n\t\t\tif (i < lines.length - 1) {\n\t\t\t\tcontent += '\\n';\n\t\t\t}\n\t\t}\n\t\tif (content.length > 0) {\n\t\t\tconst parser = new DOMParser();\n\t\t\tresponse['xml'] = $(parser.parseFromString(content, 'text/xml'));\n\t\t}\n\t\treturn response;\n\t}\n};\n"],"names":["Integrations_Pbx_Base","driver","window","Integrations_Pbx_BriaSoftphone","container","btnText","accountName","lastEvent","status","connected","initWebsocket","e","console","warn","find","on","bringToFront","data","apiCall","phone","app","showError","title","vtranslate","websocket","WebSocket","onopen","setStatus","getStatus","onclose","setTimeout","onerror","close","onmessage","received","btn","btnIcon","removeClass","attr","i","c","replace","addClass","code","name","text","message","parseMessage","response","event","updateBtn","xml","type","children","fn","charAt","toUpperCase","slice","log","get","cacheGet","value","Math","floor","Date","now","cacheClear","calls","each","_","callsXml","$","callXml","call","tagName","textContent","push","AppConnector","request","module","action","mode","done","result","loadMore","cacheSet","length","custom","method","body","msg","send","content","lines","split","line","substr","trim","parser","parseFromString"],"mappings":"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"}