{"version":3,"file":"Connector.min.js","sources":["Connector.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nAppConnector = {\n\n\t/**\n\t * Sends a pjax request (push state +ajax)\n\t * The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequestPjax: function (params) {\n\t\treturn AppConnector._request(params, true);\n\t},\n\n\t/**\n\t *  Sends ajax request to the specified url.\n\t *  The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequest: function (params, rawData) {\n\t\treturn AppConnector._request(params, false, rawData);\n\t},\n\n\t_request: function (params, pjaxMode, rawData) {\n\t\tconst aDeferred = jQuery.Deferred();\n\t\tif (typeof rawData === \"undefined\") {\n\t\t\trawData = false;\n\t\t}\n\t\tif (typeof pjaxMode === \"undefined\") {\n\t\t\tpjaxMode = false;\n\t\t}\n\t\tif (typeof params === \"undefined\") {\n\t\t\tparams = {};\n\t\t}\n\t\tlet fullUrl = '',\n\t\t\tindex,\n\t\t\tcallerParams;\n\t\t//caller has send only data\n\t\tif (typeof params.data === \"undefined\" || rawData) {\n\t\t\tif (typeof params === 'string') {\n\t\t\t\tcallerParams = fullUrl = params;\n\t\t\t\tindex = callerParams.indexOf('?');\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tlet subStr = callerParams.substr(0, index + 1);//need to replace only \"index.php?\" or \"?\"\n\t\t\t\t\tcallerParams = callerParams.replace(subStr, '');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcallerParams = $.extend({}, params);\n\t\t\t}\n\t\t\tparams = {};\n\t\t\tparams.data = callerParams;\n\t\t}\n\t\t//Make the request as post by default\n\t\tif (typeof params.type === \"undefined\" || rawData)\n\t\t\tparams.type = 'POST';\n\t\tif (typeof params.jsonp === \"undefined\" || rawData)\n\t\t\tparams.jsonp = false;\n\n\t\t//By default we expect json from the server\n\t\tif (typeof params.dataType === \"undefined\" || rawData) {\n\t\t\tlet data = params.data;\n\t\t\t//view will return html\n\t\t\tparams.dataType = 'json';\n\t\t\tif (data.hasOwnProperty('view')) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t} else if (typeof data === 'string' && data.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t\tif (typeof params.url !== \"undefined\" && params.url.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t}\n\t\t//If url contains params then seperate them and make them as data\n\t\tif (typeof params.url !== \"undefined\" && params.url.indexOf('?') !== -1) {\n\t\t\tfullUrl = params.url;\n\t\t\tlet urlSplit = params.url.split('?'),\n\t\t\t\tqueryString = urlSplit[1];\n\t\t\tparams.url = urlSplit[0];\n\t\t\tlet queryParameters = queryString.split('&');\n\t\t\tfor (index = 0; index < queryParameters.length; index++) {\n\t\t\t\tlet queryParam = queryParameters[index],\n\t\t\t\t\tqueryParamComponents = queryParam.split('=');\n\t\t\t\tparams.data[queryParamComponents[0]] = queryParamComponents[1];\n\t\t\t}\n\t\t}\n\t\tif (typeof params.url === \"undefined\" || params.url.length <= 0) {\n\t\t\tparams.url = 'index.php';\n\t\t}\n\t\tparams.success = function (data, status, jqXHR) {\n\t\t\tif (data !== null && typeof data === 'object' && data.error) {\n\t\t\t\tapp.errorLog(data.error);\n\t\t\t\tif (data.error.message) {\n\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\ttext: data.error.message,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\taDeferred.resolve(data);\n\t\t};\n\t\tparams.error = function (jqXHR, textStatus, errorThrown) {\n\t\t\tlet action = jqXHR.getResponseHeader('yf-action');\n\t\t\tif (action === 'logout') {\n\t\t\t\twindow.location.href = 'index.php';\n\t\t\t}\n\t\t\tif (CONFIG.debug) {\n\t\t\t\tif (jqXHR.status === 406) {\n\t\t\t\t\tlet sep = \"-\".repeat(150);\n\t\t\t\t\tconsole.warn(\"%cYetiForce debug mode!!!\", \"color: red; font-family: sans-serif; font-size: 1.5em; font-weight: bolder; text-shadow: #000 1px 1px;\");\n\t\t\t\t\tconsole.error('Error: ' + errorThrown, '\\n' + sep + '\\nTrace:\\n' + sep + '\\n' + jqXHR.responseJSON.error.trace, '\\n' + sep + '\\nParams:\\n' + sep + '\\n' + JSON.stringify(params, null, '\\t'));\n\t\t\t\t} else {\n\t\t\t\t\tapp.errorLog(jqXHR, textStatus, errorThrown);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t};\n\t\tjQuery.ajax(params);\n\t\tif (pjaxMode) {\n\t\t\tif (fullUrl === '') {\n\t\t\t\tfullUrl = 'index.php?' + $.param(params.data);\n\t\t\t} else if (fullUrl.indexOf('index.php?') === -1) {\n\t\t\t\tfullUrl = 'index.php?' + fullUrl;\n\t\t\t}\n\t\t\tif (history.pushState && fullUrl !== '') {\n\t\t\t\tconst currentHref = window.location.href;\n\t\t\t\tif (!history.state) {\n\t\t\t\t\thistory.replaceState(currentHref, \"title 1\", currentHref);\n\t\t\t\t}\n\t\t\t\thistory.pushState(fullUrl, \"title 2\", fullUrl);\n\t\t\t}\n\t\t}\n\t\treturn aDeferred.promise();\n\t},\n\n\trequestForm: function (url, params) {\n\t\tvar newEle = '<form action=' + url + ' method=\"POST\">';\n\t\tif (typeof csrfMagicName !== \"undefined\") {\n\t\t\tnewEle += '<input type=\"hidden\" name=\"' + csrfMagicName + '\"  value=\\'' + csrfMagicToken + '\\'>';\n\t\t}\n\t\tif (typeof params !== \"undefined\") {\n\t\t\tjQuery.each(params, function (index, value) {\n\t\t\t\tnewEle += '<input type=\"hidden\" name=\"' + index + '\"  value=\\'' + value + '\\'>';\n\t\t\t});\n\t\t}\n\t\tnewEle += '</form>';\n\t\tvar form = new jQuery(newEle);\n\t\tform.appendTo('body').submit();\n\t},\n}\n\n"],"names":["AppConnector","requestPjax","params","_request","request","rawData","pjaxMode","jQuery","Deferred","callerParams","fullUrl","data","$","extend","index","indexOf","substr","replace","subStr","type","jsonp","dataType","hasOwnProperty","url","split","queryString","urlSplit","queryParameters","length","queryParamComponents","queryParam","success","error","app","errorLog","message","Vtiger_Helper_Js","showMessage","text","aDeferred","resolve","jqXHR","textStatus","errorThrown","getResponseHeader","window","location","href","CONFIG","debug","status","console","warn","responseJSON","trace","JSON","stringify","reject","ajax","param","history","pushState","state","replaceState","currentHref","promise","requestForm","newEle","csrfMagicName","csrfMagicToken","each","value","form","appendTo","submit"],"mappings":"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"}