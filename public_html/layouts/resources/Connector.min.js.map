{"version":3,"file":"Connector.min.js","sources":["Connector.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nwindow.AppConnector = {\n\t/**\n\t * Sends a pjax request (push state +ajax)\n\t * The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequestPjax: function (params) {\n\t\treturn AppConnector._request(params, true);\n\t},\n\n\t/**\n\t *  Sends ajax request to the specified url.\n\t *  The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequest: function (params, rawData) {\n\t\treturn AppConnector._request(params, false, rawData);\n\t},\n\n\t_request: function (params, pjaxMode, rawData) {\n\t\tconst aDeferred = jQuery.Deferred();\n\t\tif (typeof rawData === 'undefined') {\n\t\t\trawData = false;\n\t\t}\n\t\tif (typeof pjaxMode === 'undefined') {\n\t\t\tpjaxMode = false;\n\t\t}\n\t\tif (typeof params === 'undefined') {\n\t\t\tparams = {};\n\t\t}\n\t\tlet fullUrl = '',\n\t\t\tindex,\n\t\t\tcallerParams;\n\t\t//caller has send only data\n\t\tif (typeof params.data === 'undefined' || rawData) {\n\t\t\tif (typeof params === 'string') {\n\t\t\t\tcallerParams = fullUrl = params;\n\t\t\t\tindex = callerParams.indexOf('?');\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tlet subStr = callerParams.substr(0, index + 1); //need to replace only \"index.php?\" or \"?\"\n\t\t\t\t\tcallerParams = callerParams.replace(subStr, '');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcallerParams = $.extend({}, params);\n\t\t\t}\n\t\t\tparams = {};\n\t\t\tparams.data = callerParams;\n\t\t}\n\t\t//Make the request as post by default\n\t\tif (typeof params.type === 'undefined' || rawData) params.type = 'POST';\n\t\tif (typeof params.jsonp === 'undefined' || rawData) params.jsonp = false;\n\n\t\t//By default we expect json from the server\n\t\tif (typeof params.dataType === 'undefined' || rawData) {\n\t\t\tlet data = params.data;\n\t\t\t//view will return html\n\t\t\tparams.dataType = 'json';\n\t\t\tif (data.hasOwnProperty('view')) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t} else if (typeof data === 'string' && data.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t\tif (typeof params.url !== 'undefined' && params.url.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t}\n\t\t//If url contains params then seperate them and make them as data\n\t\tif (typeof params.url !== 'undefined' && params.url.indexOf('?') !== -1) {\n\t\t\tfullUrl = params.url;\n\t\t\tlet urlSplit = params.url.split('?'),\n\t\t\t\tqueryString = urlSplit[1];\n\t\t\tparams.url = urlSplit[0];\n\t\t\tlet queryParameters = queryString.split('&');\n\t\t\tfor (index = 0; index < queryParameters.length; index++) {\n\t\t\t\tlet queryParam = queryParameters[index],\n\t\t\t\t\tqueryParamComponents = queryParam.split('=');\n\t\t\t\tparams.data[queryParamComponents[0]] = queryParamComponents[1];\n\t\t\t}\n\t\t}\n\t\tif (typeof params.url === 'undefined' || params.url.length <= 0) {\n\t\t\tparams.url = 'index.php';\n\t\t}\n\t\tparams.success = function (data, status, jqXHR) {\n\t\t\tif (data !== null && typeof data === 'object' && data.error) {\n\t\t\t\tapp.errorLog(data.error);\n\t\t\t\tif (data.error.message) {\n\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\ttext: data.error.message,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\taDeferred.resolve(data);\n\t\t};\n\t\tparams.error = function (jqXHR, textStatus, errorThrown) {\n\t\t\tlet action = jqXHR.getResponseHeader('yf-action');\n\t\t\tif (action === 'logout') {\n\t\t\t\twindow.location.href = 'index.php';\n\t\t\t}\n\t\t\tif (CONFIG.debug) {\n\t\t\t\tif (jqXHR.status === 406) {\n\t\t\t\t\tlet sep = '-'.repeat(150);\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'%cYetiForce debug mode!!!',\n\t\t\t\t\t\t'color: red; font-family: sans-serif; font-size: 1.5em; font-weight: bolder; text-shadow: #000 1px 1px;'\n\t\t\t\t\t);\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'Error: ' + errorThrown,\n\t\t\t\t\t\t'\\n' + sep + '\\nTrace:\\n' + sep + '\\n' + (jqXHR.responseJSON ? jqXHR.responseJSON.error.trace : ''),\n\t\t\t\t\t\t'\\n' + sep + '\\nParams:\\n' + sep + '\\n' + JSON.stringify(params, null, '\\t')\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tapp.errorLog(jqXHR, textStatus, errorThrown);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (textStatus == 'error' && jqXHR.responseJSON) {\n\t\t\t\ttextStatus = jqXHR.responseJSON.error.message;\n\t\t\t}\n\t\t\taDeferred.reject(textStatus, errorThrown, jqXHR);\n\t\t};\n\t\tif (params.data === '') {\n\t\t\tapp.showNotify({ type: 'error', title: app.vtranslate('JS_ERROR') });\n\t\t\treturn aDeferred.reject();\n\t\t}\n\t\tjQuery.ajax(params);\n\t\tif (pjaxMode) {\n\t\t\tapp.changeUrl(params);\n\t\t}\n\t\treturn aDeferred.promise();\n\t},\n\t/**\n\t * Send form data\n\t * @param {string} url\n\t * @param {object} postData\n\t * @param {object} formAttr\n\t */\n\trequestForm: function (url, postData = {}, formAttr = {}) {\n\t\t$.extend(formAttr, {\n\t\t\tmethod: 'post',\n\t\t\taction: url,\n\t\t\tstyle: 'display:none;'\n\t\t});\n\t\tlet form = $('<form></form>', formAttr);\n\t\tif (typeof csrfMagicName !== 'undefined') {\n\t\t\tpostData[csrfMagicName] = csrfMagicToken;\n\t\t}\n\t\t$.each(postData, (index, value) => {\n\t\t\tlet isMultiple = typeof value === 'object' && value.length && index.slice(-2) === '[]';\n\t\t\tconst item = document.createElement(isMultiple ? 'select' : 'input');\n\n\t\t\titem.setAttribute('type', 'hidden');\n\t\t\titem.setAttribute('name', index);\n\n\t\t\tif (isMultiple) {\n\t\t\t\titem.setAttribute('multiple', 'multiple');\n\t\t\t\tfor (let i in value) {\n\t\t\t\t\tlet option = document.createElement('option');\n\t\t\t\t\toption.setAttribute('value', value[i]);\n\t\t\t\t\toption.setAttribute('selected', true);\n\t\t\t\t\titem.appendChild(option);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem.setAttribute('value', value);\n\t\t\t}\n\t\t\tform.append(item);\n\t\t});\n\t\t$('body').append(form);\n\t\tform.trigger('submit');\n\t\tform.remove();\n\t}\n};\n"],"names":["window","AppConnector","requestPjax","params","_request","request","rawData","pjaxMode","jQuery","Deferred","index","callerParams","fullUrl","data","$","extend","indexOf","subStr","substr","replace","type","jsonp","dataType","hasOwnProperty","url","urlSplit","split","queryString","queryParameters","length","queryParam","queryParamComponents","success","error","app","errorLog","message","Vtiger_Helper_Js","showMessage","text","aDeferred","resolve","jqXHR","textStatus","errorThrown","action","getResponseHeader","location","href","CONFIG","debug","status","repeat","console","warn","responseJSON","trace","JSON","stringify","reject","showNotify","title","vtranslate","ajax","changeUrl","promise","requestForm","postData","formAttr","method","style","form","csrfMagicName","csrfMagicToken","each","value","isMultiple","slice","item","document","createElement","setAttribute","option","i","appendChild","append","trigger","remove"],"mappings":"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"}