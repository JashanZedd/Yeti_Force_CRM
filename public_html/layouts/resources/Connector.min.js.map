{"version":3,"file":"Connector.min.js","sources":["Connector.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nwindow.AppConnector = {\n\t/**\n\t * Sends a pjax request (push state +ajax)\n\t * The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequestPjax: function(params) {\n\t\treturn AppConnector._request(params, true);\n\t},\n\n\t/**\n\t *  Sends ajax request to the specified url.\n\t *  The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequest: function(params, rawData) {\n\t\treturn AppConnector._request(params, false, rawData);\n\t},\n\n\t_request: function(params, pjaxMode, rawData) {\n\t\tconst aDeferred = jQuery.Deferred();\n\t\tif (typeof rawData === 'undefined') {\n\t\t\trawData = false;\n\t\t}\n\t\tif (typeof pjaxMode === 'undefined') {\n\t\t\tpjaxMode = false;\n\t\t}\n\t\tif (typeof params === 'undefined') {\n\t\t\tparams = {};\n\t\t}\n\t\tlet fullUrl = '',\n\t\t\tindex,\n\t\t\tcallerParams;\n\t\t//caller has send only data\n\t\tif (typeof params.data === 'undefined' || rawData) {\n\t\t\tif (typeof params === 'string') {\n\t\t\t\tcallerParams = fullUrl = params;\n\t\t\t\tindex = callerParams.indexOf('?');\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tlet subStr = callerParams.substr(0, index + 1); //need to replace only \"index.php?\" or \"?\"\n\t\t\t\t\tcallerParams = callerParams.replace(subStr, '');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcallerParams = $.extend({}, params);\n\t\t\t}\n\t\t\tparams = {};\n\t\t\tparams.data = callerParams;\n\t\t}\n\t\t//Make the request as post by default\n\t\tif (typeof params.type === 'undefined' || rawData) params.type = 'POST';\n\t\tif (typeof params.jsonp === 'undefined' || rawData) params.jsonp = false;\n\n\t\t//By default we expect json from the server\n\t\tif (typeof params.dataType === 'undefined' || rawData) {\n\t\t\tlet data = params.data;\n\t\t\t//view will return html\n\t\t\tparams.dataType = 'json';\n\t\t\tif (data.hasOwnProperty('view')) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t} else if (typeof data === 'string' && data.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t\tif (typeof params.url !== 'undefined' && params.url.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t}\n\t\t//If url contains params then seperate them and make them as data\n\t\tif (typeof params.url !== 'undefined' && params.url.indexOf('?') !== -1) {\n\t\t\tfullUrl = params.url;\n\t\t\tlet urlSplit = params.url.split('?'),\n\t\t\t\tqueryString = urlSplit[1];\n\t\t\tparams.url = urlSplit[0];\n\t\t\tlet queryParameters = queryString.split('&');\n\t\t\tfor (index = 0; index < queryParameters.length; index++) {\n\t\t\t\tlet queryParam = queryParameters[index],\n\t\t\t\t\tqueryParamComponents = queryParam.split('=');\n\t\t\t\tparams.data[queryParamComponents[0]] = queryParamComponents[1];\n\t\t\t}\n\t\t}\n\t\tif (typeof params.url === 'undefined' || params.url.length <= 0) {\n\t\t\tparams.url = 'index.php';\n\t\t}\n\t\tparams.success = function(data, status, jqXHR) {\n\t\t\tif (data !== null && typeof data === 'object' && data.error) {\n\t\t\t\tapp.errorLog(data.error);\n\t\t\t\tif (data.error.message) {\n\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\ttext: data.error.message,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\taDeferred.resolve(data);\n\t\t};\n\t\tparams.error = function(jqXHR, textStatus, errorThrown) {\n\t\t\tlet action = jqXHR.getResponseHeader('yf-action');\n\t\t\tif (action === 'logout') {\n\t\t\t\twindow.location.href = 'index.php';\n\t\t\t}\n\t\t\tif (CONFIG.debug) {\n\t\t\t\tif (jqXHR.status === 406) {\n\t\t\t\t\tlet sep = '-'.repeat(150);\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'%cYetiForce debug mode!!!',\n\t\t\t\t\t\t'color: red; font-family: sans-serif; font-size: 1.5em; font-weight: bolder; text-shadow: #000 1px 1px;'\n\t\t\t\t\t);\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'Error: ' + errorThrown,\n\t\t\t\t\t\t'\\n' +\n\t\t\t\t\t\t\tsep +\n\t\t\t\t\t\t\t'\\nTrace:\\n' +\n\t\t\t\t\t\t\tsep +\n\t\t\t\t\t\t\t'\\n' +\n\t\t\t\t\t\t\t(jqXHR.responseJSON ? jqXHR.responseJSON.error.trace : ''),\n\t\t\t\t\t\t'\\n' + sep + '\\nParams:\\n' + sep + '\\n' + JSON.stringify(params, null, '\\t')\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tapp.errorLog(jqXHR, textStatus, errorThrown);\n\t\t\t\t}\n\t\t\t}\n\t\t\taDeferred.reject(textStatus, errorThrown, jqXHR);\n\t\t};\n\t\tif (params.data === '') {\n\t\t\tapp.showNotify({ type: 'error', title: app.vtranslate('JS_ERROR') });\n\t\t\treturn aDeferred.reject();\n\t\t}\n\t\tjQuery.ajax(params);\n\t\tif (pjaxMode) {\n\t\t\tif (typeof params.data.historyUrl !== 'undefined') {\n\t\t\t\tfullUrl = params.data.historyUrl;\n\t\t\t}\n\t\t\tif (fullUrl === '') {\n\t\t\t\tfullUrl = 'index.php?' + $.param(params.data);\n\t\t\t} else if (fullUrl.indexOf('index.php?') === -1) {\n\t\t\t\tfullUrl = 'index.php?' + fullUrl;\n\t\t\t}\n\t\t\tif (app.isWindowTop() && history.pushState && fullUrl !== '') {\n\t\t\t\tconst currentHref = window.location.href;\n\t\t\t\tif (!history.state) {\n\t\t\t\t\thistory.replaceState(currentHref, 'title 1', currentHref);\n\t\t\t\t}\n\t\t\t\thistory.pushState(fullUrl, 'title 2', fullUrl);\n\t\t\t}\n\t\t}\n\t\treturn aDeferred.promise();\n\t},\n\n\trequestForm: function(url, params = {}) {\n\t\tapp.openUrlMethodPost(url, params);\n\t}\n};\n"],"names":["window","AppConnector","params","_request","rawData","pjaxMode","aDeferred","jQuery","Deferred","fullUrl","index","callerParams","data","indexOf","subStr","substr","replace","$","extend","type","jsonp","dataType","hasOwnProperty","url","urlSplit","split","queryString","queryParameters","length","queryParamComponents","success","status","jqXHR","error","errorLog","message","showMessage","resolve","textStatus","errorThrown","getResponseHeader","location","href","CONFIG","debug","sep","repeat","warn","responseJSON","trace","JSON","stringify","reject","showNotify","title","app","vtranslate","ajax","historyUrl","param","isWindowTop","history","pushState","currentHref","state","replaceState","promise","openUrlMethodPost"],"mappings":"iPAUAA,OAAOC,aAAe,aAUR,SAASC,eACdD,aAAaE,SAASD,QAAQ,YAY7B,SAASA,OAAQE,gBAClBH,aAAaE,SAASD,QAAQ,EAAOE,mBAGnC,SAASF,OAAQG,SAAUD,aAC9BE,UAAYC,OAAOC,gBACF,IAAZJ,mBACA,QAEa,IAAbC,qBACC,QAEU,IAAXH,gBACD,QAENO,QAAU,GACbC,aACAC,4BAE0B,IAAhBT,OAAOU,MAAwBR,QAAS,IAC5B,iBAAXF,YAGK,yBAFAO,QAAUP,QACJW,QAAQ,MACX,KACbC,OAASH,aAAaI,OAAO,EAAGL,MAAQ,gBAC7BC,aAAaK,QAAQF,OAAQ,uBAG9BG,EAAEC,OAAO,GAAIhB,gBAEpB,IACFU,KAAOD,sBAGY,IAAhBT,OAAOiB,MAAwBf,WAASF,OAAOiB,KAAO,cACrC,IAAjBjB,OAAOkB,OAAyBhB,WAASF,OAAOkB,OAAQ,QAGpC,IAApBlB,OAAOmB,UAA4BjB,QAAS,KAClDQ,KAAOV,OAAOU,YAEXS,SAAW,OACdT,KAAKU,eAAe,eAChBD,SAAW,OACQ,iBAATT,OAAiD,IAA5BA,KAAKC,QAAQ,mBAC5CQ,SAAW,aAEO,IAAfnB,OAAOqB,MAAyD,IAAlCrB,OAAOqB,IAAIV,QAAQ,mBACpDQ,SAAW,gBAIM,IAAfnB,OAAOqB,MAAoD,IAA7BrB,OAAOqB,IAAIV,QAAQ,KAAa,SAC9DX,OAAOqB,QACbC,SAAWtB,OAAOqB,IAAIE,MAAM,KAC/BC,YAAcF,SAAS,UACjBD,IAAMC,SAAS,OAClBG,gBAAkBD,YAAYD,MAAM,SACnCf,MAAQ,EAAGA,MAAQiB,gBAAgBC,OAAQlB,QAAS,KAEvDmB,qBADgBF,gBAAgBjB,OACEe,MAAM,YAClCb,KAAKiB,qBAAqB,IAAMA,qBAAqB,aAGpC,IAAf3B,OAAOqB,KAAuBrB,OAAOqB,IAAIK,QAAU,YACtDL,IAAM,oBAEPO,QAAU,SAASlB,KAAMmB,OAAQC,OAC1B,OAATpB,MAAiC,qBAATA,yBAAAA,QAAqBA,KAAKqB,YACjDC,SAAStB,KAAKqB,OACdrB,KAAKqB,MAAME,0BACGC,YAAY,MACtBxB,KAAKqB,MAAME,aACX,qBAICE,QAAQzB,cAEZqB,MAAQ,SAASD,MAAOM,WAAYC,gBAE3B,WADFP,MAAMQ,kBAAkB,sBAE7BC,SAASC,KAAO,aAEpBC,OAAOC,SACW,MAAjBZ,MAAMD,OAAgB,KACrBc,IAAM,IAAIC,OAAO,aACbC,KACP,4BACA,kHAEOd,MACP,UAAYM,YACZ,KACCM,IACA,aACAA,IACA,MACCb,MAAMgB,aAAehB,MAAMgB,aAAaf,MAAMgB,MAAQ,IACxD,KAAOJ,IAAM,cAAgBA,IAAM,KAAOK,KAAKC,UAAUjD,OAAQ,KAAM,gBAGpEgC,SAASF,MAAOM,WAAYC,uBAGxBa,OAAOd,WAAYC,YAAaP,QAEvB,KAAhB9B,OAAOU,gBACNyC,WAAW,CAAElC,KAAM,QAASmC,MAAOC,IAAIC,WAAW,cAC/ClD,UAAU8C,mBAEXK,KAAKvD,QACRG,gBACmC,IAA3BH,OAAOU,KAAK8C,qBACZxD,OAAOU,KAAK8C,YAEP,KAAZjD,gBACO,aAAeQ,EAAE0C,MAAMzD,OAAOU,OACK,IAAnCH,QAAQI,QAAQ,wBAChB,aAAeJ,SAEtB8C,IAAIK,eAAiBC,QAAQC,WAAyB,KAAZrD,SAAgB,KACvDsD,YAAc/D,OAAOyC,SAASC,KAC/BmB,QAAQG,eACJC,aAAaF,YAAa,UAAWA,qBAEtCD,UAAUrD,QAAS,UAAWA,gBAGjCH,UAAU4D,uBAGL,SAAS3C,SAAKrB,8DAAS,OAC/BiE,kBAAkB5C,IAAKrB"}