{"version":3,"file":"Connector.min.js","sources":["Connector.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nwindow.AppConnector = {\n\t/**\n\t * Sends a pjax request (push state +ajax)\n\t * The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequestPjax: function(params) {\n\t\treturn AppConnector._request(params, true);\n\t},\n\n\t/**\n\t *  Sends ajax request to the specified url.\n\t *  The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequest: function(params, rawData) {\n\t\treturn AppConnector._request(params, false, rawData);\n\t},\n\n\t_request: function(params, pjaxMode, rawData) {\n\t\tconst aDeferred = jQuery.Deferred();\n\t\tif (typeof rawData === 'undefined') {\n\t\t\trawData = false;\n\t\t}\n\t\tif (typeof pjaxMode === 'undefined') {\n\t\t\tpjaxMode = false;\n\t\t}\n\t\tif (typeof params === 'undefined') {\n\t\t\tparams = {};\n\t\t}\n\t\tlet fullUrl = '',\n\t\t\tindex,\n\t\t\tcallerParams;\n\t\t//caller has send only data\n\t\tif (typeof params.data === 'undefined' || rawData) {\n\t\t\tif (typeof params === 'string') {\n\t\t\t\tcallerParams = fullUrl = params;\n\t\t\t\tindex = callerParams.indexOf('?');\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tlet subStr = callerParams.substr(0, index + 1); //need to replace only \"index.php?\" or \"?\"\n\t\t\t\t\tcallerParams = callerParams.replace(subStr, '');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcallerParams = $.extend({}, params);\n\t\t\t}\n\t\t\tparams = {};\n\t\t\tparams.data = callerParams;\n\t\t}\n\t\t//Make the request as post by default\n\t\tif (typeof params.type === 'undefined' || rawData) params.type = 'POST';\n\t\tif (typeof params.jsonp === 'undefined' || rawData) params.jsonp = false;\n\n\t\t//By default we expect json from the server\n\t\tif (typeof params.dataType === 'undefined' || rawData) {\n\t\t\tlet data = params.data;\n\t\t\t//view will return html\n\t\t\tparams.dataType = 'json';\n\t\t\tif (data.hasOwnProperty('view')) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t} else if (typeof data === 'string' && data.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t\tif (typeof params.url !== 'undefined' && params.url.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t}\n\t\t//If url contains params then seperate them and make them as data\n\t\tif (typeof params.url !== 'undefined' && params.url.indexOf('?') !== -1) {\n\t\t\tfullUrl = params.url;\n\t\t\tlet urlSplit = params.url.split('?'),\n\t\t\t\tqueryString = urlSplit[1];\n\t\t\tparams.url = urlSplit[0];\n\t\t\tlet queryParameters = queryString.split('&');\n\t\t\tfor (index = 0; index < queryParameters.length; index++) {\n\t\t\t\tlet queryParam = queryParameters[index],\n\t\t\t\t\tqueryParamComponents = queryParam.split('=');\n\t\t\t\tparams.data[queryParamComponents[0]] = queryParamComponents[1];\n\t\t\t}\n\t\t}\n\t\tif (typeof params.url === 'undefined' || params.url.length <= 0) {\n\t\t\tparams.url = 'index.php';\n\t\t}\n\t\tparams.success = function(data, status, jqXHR) {\n\t\t\tif (data !== null && typeof data === 'object' && data.error) {\n\t\t\t\tapp.errorLog(data.error);\n\t\t\t\tif (data.error.message) {\n\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\ttext: data.error.message,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\taDeferred.resolve(data);\n\t\t};\n\t\tparams.error = function(jqXHR, textStatus, errorThrown) {\n\t\t\tlet action = jqXHR.getResponseHeader('yf-action');\n\t\t\tif (action === 'logout') {\n\t\t\t\twindow.location.href = 'index.php';\n\t\t\t}\n\t\t\tif (CONFIG.debug) {\n\t\t\t\tif (jqXHR.status === 406) {\n\t\t\t\t\tlet sep = '-'.repeat(150);\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'%cYetiForce debug mode!!!',\n\t\t\t\t\t\t'color: red; font-family: sans-serif; font-size: 1.5em; font-weight: bolder; text-shadow: #000 1px 1px;'\n\t\t\t\t\t);\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'Error: ' + errorThrown,\n\t\t\t\t\t\t'\\n' +\n\t\t\t\t\t\t\tsep +\n\t\t\t\t\t\t\t'\\nTrace:\\n' +\n\t\t\t\t\t\t\tsep +\n\t\t\t\t\t\t\t'\\n' +\n\t\t\t\t\t\t\t(jqXHR.responseJSON ? jqXHR.responseJSON.error.trace : ''),\n\t\t\t\t\t\t'\\n' + sep + '\\nParams:\\n' + sep + '\\n' + JSON.stringify(params, null, '\\t')\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tapp.errorLog(jqXHR, textStatus, errorThrown);\n\t\t\t\t}\n\t\t\t}\n\t\t\taDeferred.reject(textStatus, errorThrown, jqXHR);\n\t\t};\n\t\tif (params.data === '') {\n\t\t\tapp.showNotify({ type: 'error', title: app.vtranslate('JS_ERROR') });\n\t\t\treturn aDeferred.reject();\n\t\t}\n\t\tjQuery.ajax(params);\n\t\tif (pjaxMode) {\n\t\t\tif (typeof params.data.historyUrl !== 'undefined') {\n\t\t\t\tfullUrl = params.data.historyUrl;\n\t\t\t}\n\t\t\tif (fullUrl === '') {\n\t\t\t\tfullUrl = 'index.php?' + $.param(params.data);\n\t\t\t} else if (fullUrl.indexOf('index.php?') === -1) {\n\t\t\t\tfullUrl = 'index.php?' + fullUrl;\n\t\t\t}\n\t\t\tif (app.isWindowTop() && history.pushState && fullUrl !== '') {\n\t\t\t\tconst currentHref = window.location.href;\n\t\t\t\tif (!history.state) {\n\t\t\t\t\thistory.replaceState(currentHref, 'title 1', currentHref);\n\t\t\t\t}\n\t\t\t\thistory.pushState(fullUrl, 'title 2', fullUrl);\n\t\t\t}\n\t\t}\n\t\treturn aDeferred.promise();\n\t},\n\n\trequestForm: function(url, params = {}) {\n\t\tapp.openUrlMethodPost(url, params);\n\t}\n};\n"],"names":["window","AppConnector","params","_request","rawData","pjaxMode","aDeferred","jQuery","Deferred","fullUrl","index","callerParams","data","indexOf","subStr","substr","replace","$","extend","type","jsonp","dataType","hasOwnProperty","url","urlSplit","split","queryString","queryParameters","length","queryParam","queryParamComponents","success","status","jqXHR","error","errorLog","message","showMessage","resolve","textStatus","errorThrown","action","getResponseHeader","location","href","CONFIG","debug","sep","repeat","warn","responseJSON","trace","JSON","stringify","reject","showNotify","title","app","vtranslate","ajax","historyUrl","param","isWindowTop","history","pushState","currentHref","state","replaceState","promise","openUrlMethodPost"],"mappings":"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"}