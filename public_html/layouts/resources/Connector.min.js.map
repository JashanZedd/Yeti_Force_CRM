{"version":3,"file":"Connector.min.js","sources":["Connector.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nwindow.AppConnector = {\n\t/**\n\t * Sends a pjax request (push state +ajax)\n\t * The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequestPjax: function (params) {\n\t\treturn AppConnector._request(params, true);\n\t},\n\n\t/**\n\t *  Sends ajax request to the specified url.\n\t *  The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequest: function (params, rawData) {\n\t\treturn AppConnector._request(params, false, rawData);\n\t},\n\n\t_request: function (params, pjaxMode, rawData) {\n\t\tconst aDeferred = jQuery.Deferred();\n\t\tif (typeof rawData === 'undefined') {\n\t\t\trawData = false;\n\t\t}\n\t\tif (typeof pjaxMode === 'undefined') {\n\t\t\tpjaxMode = false;\n\t\t}\n\t\tif (typeof params === 'undefined') {\n\t\t\tparams = {};\n\t\t}\n\t\tlet fullUrl = '',\n\t\t\tindex,\n\t\t\tcallerParams;\n\t\t//caller has send only data\n\t\tif (typeof params.data === 'undefined' || rawData) {\n\t\t\tif (typeof params === 'string') {\n\t\t\t\tcallerParams = fullUrl = params;\n\t\t\t\tindex = callerParams.indexOf('?');\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tlet subStr = callerParams.substr(0, index + 1); //need to replace only \"index.php?\" or \"?\"\n\t\t\t\t\tcallerParams = callerParams.replace(subStr, '');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcallerParams = $.extend({}, params);\n\t\t\t}\n\t\t\tparams = {};\n\t\t\tparams.data = callerParams;\n\t\t}\n\t\t//Make the request as post by default\n\t\tif (typeof params.type === 'undefined' || rawData) params.type = 'POST';\n\t\tif (typeof params.jsonp === 'undefined' || rawData) params.jsonp = false;\n\n\t\t//By default we expect json from the server\n\t\tif (typeof params.dataType === 'undefined' || rawData) {\n\t\t\tlet data = params.data;\n\t\t\t//view will return html\n\t\t\tparams.dataType = 'json';\n\t\t\tif (data.hasOwnProperty('view')) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t} else if (typeof data === 'string' && data.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t\tif (typeof params.url !== 'undefined' && params.url.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t}\n\t\t//If url contains params then seperate them and make them as data\n\t\tif (typeof params.url !== 'undefined' && params.url.indexOf('?') !== -1) {\n\t\t\tfullUrl = params.url;\n\t\t\tlet urlSplit = params.url.split('?'),\n\t\t\t\tqueryString = urlSplit[1];\n\t\t\tparams.url = urlSplit[0];\n\t\t\tlet queryParameters = queryString.split('&');\n\t\t\tfor (index = 0; index < queryParameters.length; index++) {\n\t\t\t\tlet queryParam = queryParameters[index],\n\t\t\t\t\tqueryParamComponents = queryParam.split('=');\n\t\t\t\tparams.data[queryParamComponents[0]] = queryParamComponents[1];\n\t\t\t}\n\t\t}\n\t\tif (typeof params.url === 'undefined' || params.url.length <= 0) {\n\t\t\tparams.url = 'index.php';\n\t\t}\n\t\tparams.success = function (data, status, jqXHR) {\n\t\t\tif (data !== null && typeof data === 'object' && data.error) {\n\t\t\t\tapp.errorLog(data.error);\n\t\t\t\tif (data.error.message) {\n\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\ttext: data.error.message,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\taDeferred.resolve(data);\n\t\t};\n\t\tparams.error = function (jqXHR, textStatus, errorThrown) {\n\t\t\tlet action = jqXHR.getResponseHeader('yf-action');\n\t\t\tif (action === 'logout') {\n\t\t\t\twindow.location.href = 'index.php';\n\t\t\t}\n\t\t\tif (CONFIG.debug) {\n\t\t\t\tif (jqXHR.status === 406) {\n\t\t\t\t\tlet sep = '-'.repeat(150);\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'%cYetiForce debug mode!!!',\n\t\t\t\t\t\t'color: red; font-family: sans-serif; font-size: 1.5em; font-weight: bolder; text-shadow: #000 1px 1px;'\n\t\t\t\t\t);\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'Error: ' + errorThrown,\n\t\t\t\t\t\t'\\n' + sep + '\\nTrace:\\n' + sep + '\\n' + (jqXHR.responseJSON ? jqXHR.responseJSON.error.trace : ''),\n\t\t\t\t\t\t'\\n' + sep + '\\nParams:\\n' + sep + '\\n' + JSON.stringify(params, null, '\\t')\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tapp.errorLog(jqXHR, textStatus, errorThrown);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (textStatus == 'error' && jqXHR.responseJSON) {\n\t\t\t\ttextStatus = jqXHR.responseJSON.error.message;\n\t\t\t}\n\t\t\taDeferred.reject(textStatus, errorThrown, jqXHR);\n\t\t};\n\t\tif (params.data === '') {\n\t\t\tapp.showNotify({ type: 'error', title: app.vtranslate('JS_ERROR') });\n\t\t\treturn aDeferred.reject();\n\t\t}\n\t\tjQuery.ajax(params);\n\t\tif (pjaxMode) {\n\t\t\tapp.changeUrl(params);\n\t\t}\n\t\treturn aDeferred.promise();\n\t},\n\t/**\n\t * Send form data\n\t * @param {string} url\n\t * @param {object} postData\n\t * @param {object} formAttr\n\t */\n\trequestForm: function (url, postData = {}, formAttr = {}) {\n\t\t$.extend(formAttr, {\n\t\t\tmethod: 'post',\n\t\t\taction: url,\n\t\t\tstyle: 'display:none;'\n\t\t});\n\t\tlet form = $('<form></form>', formAttr);\n\t\tif (typeof csrfMagicName !== 'undefined') {\n\t\t\tpostData[csrfMagicName] = csrfMagicToken;\n\t\t}\n\t\t$.each(postData, (index, value) => {\n\t\t\tlet isMultiple = typeof value === 'object' && value.length && index.slice(-2) === '[]';\n\t\t\tconst item = document.createElement(isMultiple ? 'select' : 'input');\n\n\t\t\titem.setAttribute('type', 'hidden');\n\t\t\titem.setAttribute('name', index);\n\n\t\t\tif (isMultiple) {\n\t\t\t\titem.setAttribute('multiple', 'multiple');\n\t\t\t\tfor (let i in value) {\n\t\t\t\t\tlet option = document.createElement('option');\n\t\t\t\t\toption.setAttribute('value', value[i]);\n\t\t\t\t\toption.setAttribute('selected', true);\n\t\t\t\t\titem.appendChild(option);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem.setAttribute('value', value);\n\t\t\t}\n\t\t\tform.append(item);\n\t\t});\n\t\t$('body').append(form);\n\t\tform.trigger('submit');\n\t\tform.remove();\n\t}\n};\n"],"names":["window","AppConnector","requestPjax","params","_request","request","rawData","pjaxMode","aDeferred","jQuery","Deferred","index","callerParams","fullUrl","data","$","extend","indexOf","subStr","substr","replace","type","jsonp","dataType","hasOwnProperty","url","urlSplit","split","queryString","queryParameters","length","queryParam","queryParamComponents","success","error","app","errorLog","message","Vtiger_Helper_Js","showMessage","text","resolve","jqXHR","textStatus","errorThrown","action","getResponseHeader","location","href","CONFIG","debug","status","repeat","console","warn","responseJSON","trace","JSON","stringify","reject","showNotify","title","vtranslate","ajax","changeUrl","promise","requestForm","postData","formAttr","method","style","form","csrfMagicName","csrfMagicToken","each","value","isMultiple","slice","item","document","createElement","setAttribute","i","option","appendChild","append","trigger","remove"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uFACA,sBAEAA,OAAAA,CAAAA,GAAAA,CAAAA,CAAAA,yBAAAA,CAAAA,OAAAA,OAAAA,CAAAA,UAAAA,EAAAA,OAAAA,MAAAA,EAAAA,QAAAA,EAAAA,OAAAA,MAAAA,CAAAA,QAAAA,CAAAA,SAAAA,GAAAA,CAAAA,CAAAA,OAAAA,OAAAA,GAAAA,CAAAA,CAAAA,SAAAA,GAAAA,CAAAA,CAAAA,OAAAA,GAAAA,EAAAA,UAAAA,EAAAA,OAAAA,MAAAA,EAAAA,GAAAA,CAAAA,WAAAA,GAAAA,MAAAA,EAAAA,GAAAA,GAAAA,MAAAA,CAAAA,SAAAA,CAAAA,QAAAA,CAAAA,OAAAA,GAAAA,CAAAA,CAAAA,OAAAA,CAAAA,GAAAA,CAAAA,CAAAA,MAAM,CAACC,YAAP,CAAsB;AAEtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IACCC,WAAW,CAAE,SAAUC,WAAAA,CAAAA,MAAV,CAAkB,CAC9B,OAAOF,YAAY,CAACG,QAAb,CAAsBD,MAAtB,CAAA,CAAA,CAAA,CACP,CAZoB;AAetB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IACCE,OAAO,CAAE,SAAUF,OAAAA,CAAAA,MAAV,CAAkBG,OAAlB,CAA2B,CACnC,OAAOL,YAAY,CAACG,QAAb,CAAsBD,MAAtB,CAAqCG,CAAAA,CAAAA,CAAAA,OAArC,CACP,CAzBoB,CA2BrBF,QAAQ,CAAE,SAAA,QAAA,CAAUD,MAAV,CAAkBI,QAAlB,CAA4BD,OAA5B,CAAqC,CAC9C,IAAME,SAAS,CAAGC,MAAM,CAACC,QAAP,EAAlB,CACuB,WAAnB,EAAOJ,OAAAA,OAFmC,GAG7CA,OAAO,CAHsC,CAAA,CAAA,CAAA,CAKtB,WAApB,EAAOC,OAAAA,QALmC,GAM7CA,QAAQ,CANqC,CAAA,CAAA,CAAA,CAQxB,WAAlB,EAAA,OAAOJ,MARmC,GAS7CA,MAAM,CAAG,EAToC,CAW9C,CAAA,IACCQ,KADD,CAECC,YAFD,CAAIC,OAAO,CAAG,EAAd,CAGA;AACA,GAA2B,WAAvB,EAAA,OAAOV,MAAM,CAACW,IAAd,EAAsCR,OAA1C,CAAmD,CAClD,GAAsB,QAAlB,EAAOH,OAAAA,MAAX,CAQCS,YAAY,CAAGG,CAAC,CAACC,MAAF,CAAS,EAAT,CAAab,MAAb,CARhB,CAGC,KAAA,GAFAS,YAAY,CAAGC,OAAO,CAAGV,MAEzB,CADAQ,KAAK,CAAGC,YAAY,CAACK,OAAb,CAAqB,GAArB,CACR,CAAc,CAAC,CAAX,GAAAN,KAAJ,CAAkB,CACjB,IAAIO,MAAM,CAAGN,YAAY,CAACO,MAAb,CAAoB,CAApB,CAAuBR,KAAK,CAAG,CAA/B,CAAb,CAAgD;AAChDC,YAAY,CAAGA,YAAY,CAACQ,OAAb,CAAqBF,MAArB,CAA6B,EAA7B,EACf,CAIFf,MAAM,CAAG,EAXyC,CAYlDA,MAAM,CAACW,IAAP,CAAcF,aACd,CACD;AAIA;AACA,GAJ2B,CAAA,WAAvB,SAAOT,MAAM,CAACkB,IAAd,EAAsCf,OAI1C,IAJmDH,MAAM,CAACkB,IAAP,CAAc,MAIjE,CAH4B,CAAA,CAAA,WAAxB,SAAOlB,MAAM,CAACmB,KAAd,EAAuChB,OAG3C,IAHoDH,MAAM,CAACmB,KAAP,CAGpD,CAAA,CAAA,CAAA,CAA+B,WAA3B,EAAOnB,OAAAA,MAAM,CAACoB,QAAd,EAA0CjB,OAA9C,CAAuD,CACtD,IAAIQ,IAAI,CAAGX,MAAM,CAACW,IAAlB,CACA;AACAX,MAAM,CAACoB,QAAP,CAAkB,MAHoC,CAIlDT,IAAI,CAACU,cAAL,CAAoB,MAApB,CAJkD,CAKrDrB,MAAM,CAACoB,QAAP,CAAkB,MALmC,CAM3B,QAAhB,EAAOT,OAAAA,IAAP,EAAuD,CAAC,CAA5B,GAAAA,IAAI,CAACG,OAAL,CAAa,QAAb,CANe,GAOrDd,MAAM,CAACoB,QAAP,CAAkB,MAPmC,CAS5B,CAAA,WAAtB,EAAOpB,OAAAA,MAAM,CAACsB,GAAd,EAAsE,CAAC,CAAlC,GAAAtB,MAAM,CAACsB,GAAP,CAAWR,OAAX,CAAmB,QAAnB,CATa,GAUrDd,MAAM,CAACoB,QAAP,CAAkB,MAVmC,EAYtD,CACD;AACA,GAA0B,WAAtB,SAAOpB,MAAM,CAACsB,GAAd,EAAiE,CAAC,CAA7B,GAAAtB,MAAM,CAACsB,GAAP,CAAWR,OAAX,CAAmB,GAAnB,CAAzC,CAAyE,CACxEJ,OAAO,CAAGV,MAAM,CAACsB,GADuD,CAExE,IAAIC,QAAQ,CAAGvB,MAAM,CAACsB,GAAP,CAAWE,KAAX,CAAiB,GAAjB,CAAf,CACCC,WAAW,CAAGF,QAAQ,CAAC,CAAD,CADvB,CAEAvB,MAAM,CAACsB,GAAP,CAAaC,QAAQ,CAAC,CAAD,CAJmD,CAKxE,IAAIG,eAAe,CAAGD,WAAW,CAACD,KAAZ,CAAkB,GAAlB,CAAtB,CACA,IAAKhB,KAAK,CAAG,CAAb,CAAgBA,KAAK,CAAGkB,eAAe,CAACC,MAAxC,CAAgDnB,KAAK,EAArD,CAAyD,CACxD,IAAIoB,UAAU,CAAGF,eAAe,CAAClB,KAAD,CAAhC,CACCqB,oBAAoB,CAAGD,UAAU,CAACJ,KAAX,CAAiB,GAAjB,CADxB,CAEAxB,MAAM,CAACW,IAAP,CAAYkB,oBAAoB,CAAC,CAAD,CAAhC,CAAuCA,CAAAA,oBAAoB,CAAC,CAAD,EAC3D,CACD,CA3D6C,OAAA,CAAA,CA4DpB,WAAtB,EAAO7B,OAAAA,MAAM,CAACsB,GAAd,EAA0D,CAArB,EAAAtB,MAAM,CAACsB,GAAP,CAAWK,MA5DN,IA6D7C3B,MAAM,CAACsB,GAAP,CAAa,WA7DgC,CA+D9CtB,CAAAA,MAAM,CAAC8B,OAAP,CAAiB,SAAUnB,IAAV,CAA+B,CAClC,IAAT,GAAAA,IAAI,EAA6B,QAAhB,GAAA,OAAA,CAAOA,IAAP,CAAjB,EAA6CA,IAAI,CAACoB,KADP,GAE9CC,GAAG,CAACC,QAAJ,CAAatB,IAAI,CAACoB,KAAlB,CAF8C,CAG1CpB,IAAI,CAACoB,KAAL,CAAWG,OAH+B,EAI7CC,gBAAgB,CAACC,WAAjB,CAA6B,CAC5BC,IAAI,CAAE1B,IAAI,CAACoB,KAAL,CAAWG,OADW,CAE5BhB,IAAI,CAAE,OAFsB,CAA7B,CAJ6C,EAU/Cb,SAAS,CAACiC,OAAV,CAAkB3B,IAAlB,EACA,CA1E6C,CA2E9CX,MAAM,CAAC+B,KAAP,CAAe,SAAUQ,KAAV,CAAiBC,UAAjB,CAA6BC,WAA7B,CAA0C,CACxD,IAAIC,MAAM,CAAGH,KAAK,CAACI,iBAAN,CAAwB,WAAxB,CAAb,CAIA,GAHe,QAAX,GAAAD,MAGJ,GAFC7C,MAAM,CAAC+C,QAAP,CAAgBC,IAAhB,CAAuB,WAExB,CAAIC,CAAAA,MAAM,CAACC,KAAX,CACC,GAAqB,GAAjB,GAAAR,KAAK,CAACS,MAAV,CAA0B,CACf,GAAIC,CAAAA,MAAJ,CAAW,GAAX,CADe,CAEzBC,OAAO,CAACC,IAAR,CACC,2BADD,CAEC,wGAFD,CAFyB,CAMzBD,OAAO,CAACnB,KAAR,CACC,SAAA,CAAYU,WADb,CAEC,4TAA0CF,EAAAA,KAAK,CAACa,YAAN,CAAqBb,KAAK,CAACa,YAAN,CAAmBrB,KAAnB,CAAyBsB,KAA9C,CAAsD,EAAhG,CAFD,CAGC,6TAAA,CAA0CC,IAAI,CAACC,SAAL,CAAevD,MAAf,CAAuB,IAAvB,CAA6B,IAA7B,CAH3C,EAKA,CAXD,KAYCgC,GAAG,CAACC,QAAJ,CAAaM,KAAb,CAAoBC,UAApB,CAAgCC,WAAhC,CAZD,CAeiB,OAAd,EAAAD,UAAU,EAAeD,KAAK,CAACa,YArBqB,GAsBvDZ,UAAU,CAAGD,KAAK,CAACa,YAAN,CAAmBrB,KAAnB,CAAyBG,OAtBiB,CAwBxD7B,CAAAA,SAAS,CAACmD,MAAV,CAAiBhB,UAAjB,CAA6BC,WAA7B,CAA0CF,KAA1C,EACA,CApG6C,CAqG1B,EAAhB,GAAAvC,MAAM,CAACW,IArGmC,GAsG7CqB,GAAG,CAACyB,UAAJ,CAAe,CAAEvC,IAAI,CAAE,OAAR,CAAiBwC,KAAK,CAAE1B,GAAG,CAAC2B,UAAJ,CAAe,UAAf,CAAxB,CAAf,CAtG6C,CAuGtCtD,SAAS,CAACmD,MAAV,EAvGsC,GAyG9ClD,MAAM,CAACsD,IAAP,CAAY5D,MAAZ,CAzG8C,CA0G1CI,QA1G0C,EA2G7C4B,GAAG,CAAC6B,SAAJ,CAAc7D,MAAd,CA3G6C,CA6GvCK,SAAS,CAACyD,OAAV,EA7GuC,CA8G9C,CAzIoB;AA2ItB;AACA;AACA;AACA;AACA,IACCC,WAAW,CAAE,SAAA,WAAA,CAAUzC,GAAV,CAA6C,KAA9B0C,QAA8B,CAAnB,CAAA,CAAA,SAAA,CAAA,MAAA,EAAA,SAAA,CAAA,CAAA,CAAA,GAAA,KAAA,CAAA,CAAA,SAAA,CAAA,CAAA,CAAA,CAAA,EAAmB,CAAfC,QAAe,wDAAJ,EAAI,CACzDrD,CAAC,CAACC,MAAF,CAASoD,QAAT,CAAmB,CAClBC,MAAM,CAAE,MADU,CAElBxB,MAAM,CAAEpB,GAFU,CAGlB6C,KAAK,CAAE,eAHW,CAAnB,CADyD,CAMzD,IAAIC,IAAI,CAAGxD,CAAC,CAAC,eAAD,CAAkBqD,QAAlB,CAAZ,CAC6B,WAAzB,EAAOI,OAAAA,aAP8C,GAQxDL,QAAQ,CAACK,aAAD,CAAR,CAA0BC,cAR8B,CAAA,CAUzD1D,CAAC,CAAC2D,IAAF,CAAOP,QAAP,CAAiB,SAACxD,KAAD,CAAQgE,KAAR,CAAkB,CAAA,IAC9BC,UAAU,CAAoB,QAAjB,WAAOD,KAAP,CAAA,EAA6BA,KAAK,CAAC7C,MAAnC,EAAiE,IAApB,GAAAnB,KAAK,CAACkE,KAAN,CAAY,CAAC,CAAb,CAD5B,CAE5BC,IAAI,CAAGC,QAAQ,CAACC,aAAT,CAAuBJ,UAAU,CAAG,QAAH,CAAc,OAA/C,CAFqB,CAOlC,GAHAE,IAAI,CAACG,YAAL,CAAkB,MAAlB,CAA0B,QAA1B,CAGA,CAFAH,IAAI,CAACG,YAAL,CAAkB,MAAlB,CAA0BtE,KAA1B,CAEA,CAAIiE,UAAJ,CAEC,IAAK,IAAIM,CAAT,IADAJ,IAAI,CAACG,YAAL,CAAkB,UAAlB,CAA8B,UAA9B,CACA,CAAcN,KAAd,CAAqB,CACpB,IAAIQ,MAAM,CAAGJ,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAb,CACAG,MAAM,CAACF,YAAP,CAAoB,OAApB,CAA6BN,KAAK,CAACO,CAAD,CAAlC,CAFoB,CAGpBC,MAAM,CAACF,YAAP,CAAoB,UAApB,CAAA,CAAA,CAAA,CAHoB,CAIpBH,IAAI,CAACM,WAAL,CAAiBD,MAAjB,EACA,CAPF,KASCL,IAAI,CAACG,YAAL,CAAkB,OAAlB,CAA2BN,KAA3B,CATD,CAWAJ,IAAI,CAACc,MAAL,CAAYP,IAAZ,EACA,CAnBD,CAVyD,CA8BzD/D,CAAC,CAAC,MAAD,CAAD,CAAUsE,MAAV,CAAiBd,IAAjB,CA9ByD,CA+BzDA,IAAI,CAACe,OAAL,CAAa,QAAb,CA/ByD,CAgCzDf,IAAI,CAACgB,MAAL,GACA,CAjLoB;;"}