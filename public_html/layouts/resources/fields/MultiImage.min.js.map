{"version":3,"file":"MultiImage.min.js","sources":["MultiImage.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nclass MultiImage {\n\t/**\n\t * Create class instance\n\t *\n\t * @param {HTMLElement|jQuery} inputElement - input type file element inside component\n\t */\n\tconstructor(element) {\n\t\tconst thisInstance = this;\n\t\tthis.elements = {};\n\t\tthis.options = {\n\t\t\tshowCarousel: true\n\t\t};\n\t\tthis.detailView = false;\n\t\tthis.elements.fileInput = element.find('.js-multi-image__file').eq(0);\n\t\tif (this.elements.fileInput.length === 0) {\n\t\t\tthis.detailView = true;\n\t\t}\n\t\tthis.elements.component = element.eq(0);\n\t\tthis.elements.form = element.closest('form').eq(0);\n\t\t$(this.elements.form).on('submit', this.onFormSubmit);\n\t\tthis.elements.addButton = this.elements.component.find('.js-multi-image__file-btn').eq(0);\n\t\tthis.elements.values = this.elements.component.find('.js-multi-image__values').eq(0);\n\t\tthis.elements.progressBar = this.elements.component.find('.js-multi-image__progress-bar').eq(0);\n\t\tthis.elements.progress = this.elements.component.find('.js-multi-image__progress').eq(0);\n\t\tthis.elements.result = this.elements.component.find('.js-multi-image__result').eq(0);\n\t\tthis.fieldInfo = this.elements.values.data('fieldinfo');\n\t\tthis.options.formats = this.fieldInfo.formats;\n\t\tthis.options.limit = this.fieldInfo.limit;\n\t\tthis.options.maxFileSize = this.fieldInfo.maxFileSize || CONFIG.maxUploadLimit;\n\t\tthis.options.maxFileSizeDisplay = this.fieldInfo.maxFileSizeDisplay || '';\n\t\tif (!this.detailView) {\n\t\t\tthis.files = JSON.parse(this.elements.values.val());\n\t\t} else {\n\t\t\tthis.files = this.elements.values.data('value');\n\t\t}\n\t\tif (!this.detailView) {\n\t\t\tthis.elements.fileInput.detach();\n\t\t\tthis.elements.addButton.click(this.addButtonClick.bind(this));\n\t\t\tthis.elements.fileInput.fileupload({\n\t\t\t\tdataType: 'json',\n\t\t\t\treplaceFileInput: false,\n\t\t\t\tfileInput: this.fileInput,\n\t\t\t\tautoUpload: false,\n\t\t\t\tsubmit: this.submit.bind(this),\n\t\t\t\tadd: this.add.bind(this),\n\t\t\t\tprogressall: this.progressAll.bind(this),\n\t\t\t\tchange: this.change.bind(this),\n\t\t\t\tdrop: this.change.bind(this),\n\t\t\t\tdragover: this.dragOver.bind(this),\n\t\t\t\tfail: this.uploadError.bind(this),\n\t\t\t\tdone: this.uploadSuccess.bind(this)\n\t\t\t});\n\t\t\tthis.elements.component.on('dragleave', this.dragLeave.bind(this));\n\t\t\tthis.elements.component.on('dragend', this.dragLeave.bind(this));\n\t\t\tthis.elements.fileInput.fileupload('option', 'dropZone', $(this.elements.component));\n\t\t\tthis.enableDragNDrop();\n\t\t}\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-img', function () {\n\t\t\tthisInstance.zoomPreview($(this).data('hash'));\n\t\t});\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-zoom', function (e) {\n\t\t\te.preventDefault();\n\t\t\tthisInstance.zoomPreview($(this).data('hash'));\n\t\t});\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-download', function (e) {\n\t\t\te.preventDefault();\n\t\t\tthisInstance.download($(this).data('hash'));\n\t\t});\n\t\tif (!this.detailView) {\n\t\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-delete', function (e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthisInstance.deleteFile($(this).data('hash'));\n\t\t\t});\n\t\t}\n\t\tthis.loadExistingFiles();\n\t}\n\n\t/**\n\t * Prevent form submission before file upload end\n\t * @param e\n\t */\n\tonFormSubmit(e) {\n\t\tif (App.Fields.MultiImage.currentFileUploads) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\te.stopImmediatePropagation();\n\t\t\tapp.showAlert(app.vtranslate('JS_WAIT_FOR_FILE_UPLOAD'));\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Prevent form submission\n\t *\n\t * @param {Event} e\n\t */\n\taddButtonClick(e) {\n\t\te.preventDefault();\n\t\tthis.elements.fileInput.trigger('click');\n\t}\n\n\t/**\n\t * Submit event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tsubmit(_e, data) {\n\t\tdata.formData = {\n\t\t\thash: data.files[0].hash\n\t\t};\n\t\tApp.Fields.MultiImage.currentFileUploads++;\n\t\tthis.progressInstance = $.progressIndicator({\n\t\t\tposition: 'replace',\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true,\n\t\t\t\telementToBlock: this.elements.component\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Get file information\n\t *\n\t * @param {String} hash - file id\n\t * @returns {Object}\n\t */\n\tgetFileInfo(hash) {\n\t\tfor (let i = 0, len = this.files.length; i < len; i++) {\n\t\t\tconst file = this.files[i];\n\t\t\tif (file.hash === hash) {\n\t\t\t\treturn file;\n\t\t\t}\n\t\t}\n\t\tapp.errorLog(`File '${hash}' not found.`);\n\t\tapp.showNotify({\n\t\t\ttext: app.vtranslate('JS_INVALID_FILE_HASH') + ` [${hash}]`,\n\t\t\ttype: 'error'\n\t\t});\n\t}\n\n\t/**\n\t * Add property to file info object\n\t *\n\t * @param {String} hash - file id\n\t * @param {String} propertyName\n\t * @param {any} value\n\t * @returns {Object}\n\t */\n\taddFileInfoProperty(hash, propertyName, value) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tfileInfo[propertyName] = value;\n\t\treturn fileInfo;\n\t}\n\n\t/**\n\t * Error event handler from file upload request\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tuploadError(_e, data) {\n\t\tthis.progressInstance.progressIndicator({ mode: 'hide' });\n\t\tapp.errorLog('File upload error.');\n\t\tconst { jqXHR, files } = data;\n\t\tconst response = jqXHR.responseJSON;\n\t\t// first try to show error for concrete file\n\t\tif (\n\t\t\tresponse !== null &&\n\t\t\ttypeof response !== 'undefined' &&\n\t\t\ttypeof response.result !== 'undefined' &&\n\t\t\ttypeof response.result.attach !== 'undefined' &&\n\t\t\tArray.isArray(response.result.attach)\n\t\t) {\n\t\t\tresponse.result.attach.forEach((fileAttach) => {\n\t\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t\t\tthis.deleteFile(fileAttach.hash, false);\n\t\t\t\tif (typeof fileAttach.error === 'string') {\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttextTrusted: false,\n\t\t\t\t\t\ttext: fileAttach.error,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttextTrusted: false,\n\t\t\t\t\t\ttitle: app.vtranslate('JS_FILE_UPLOAD_ERROR'),\n\t\t\t\t\t\ttext: fileAttach.name,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.updateFormValues();\n\t\t\treturn;\n\t\t}\n\t\t// else show default upload error\n\t\tfiles.forEach((file) => {\n\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t\tthis.deleteFile(file.hash, false);\n\t\t\tapp.showNotify({\n\t\t\t\ttextTrusted: false,\n\t\t\t\ttitle: app.vtranslate('JS_FILE_UPLOAD_ERROR'),\n\t\t\t\ttext: file.name,\n\t\t\t\ttype: 'error'\n\t\t\t});\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Success event handler from file upload request\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tuploadSuccess(e, data) {\n\t\tthis.progressInstance.progressIndicator({ mode: 'hide' });\n\t\tconst { result } = data;\n\t\tconst attach = result.result.attach;\n\t\tattach.forEach((fileAttach) => {\n\t\t\tconst hash = fileAttach.hash;\n\t\t\tif (!hash) {\n\t\t\t\treturn app.errorLog(new Error(app.vtranslate('JS_INVALID_FILE_HASH')));\n\t\t\t}\n\t\t\tif (typeof fileAttach.key === 'undefined') {\n\t\t\t\treturn this.uploadError(e, data);\n\t\t\t}\n\t\t\tif (typeof fileAttach.info !== 'undefined' && fileAttach.info) {\n\t\t\t\tapp.showNotify({\n\t\t\t\t\ttextTrusted: false,\n\t\t\t\t\ttype: 'notice',\n\t\t\t\t\ttitle: fileAttach.info,\n\t\t\t\t\ttext: fileAttach.name\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst fileInfo = this.getFileInfo(hash);\n\t\t\tthis.addFileInfoProperty(hash, 'key', fileAttach.key);\n\t\t\tthis.addFileInfoProperty(hash, 'size', fileAttach.size);\n\t\t\tthis.addFileInfoProperty(hash, 'sizeDisplay', fileAttach.sizeDisplay || fileAttach.size);\n\t\t\tthis.addFileInfoProperty(hash, 'name', fileAttach.name);\n\t\t\tthis.addFileInfoProperty(hash, 'type', fileAttach.type || '');\n\t\t\tthis.generatePreviewFromFile(fileInfo.file, (template, imageSrc) => {\n\t\t\t\tthis.addFileInfoProperty(hash, 'previewElement', this.addPreviewPopover(fileInfo, template, imageSrc));\n\t\t\t\tthis.redraw();\n\t\t\t});\n\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Update form input values\n\t */\n\tupdateFormValues() {\n\t\tthis.elements.fileInput.val(null);\n\t\tconst formValues = this.files.map((file) => {\n\t\t\treturn { key: file.key, name: file.name, size: file.size, type: file.type || '' };\n\t\t});\n\t\tthis.elements.values.val(JSON.stringify(formValues));\n\t}\n\n\t/**\n\t * Validate file\n\t *\n\t * @param {Object} file\n\t * @returns {boolean}\n\t */\n\tvalidateFormat(file) {\n\t\tlet valid = false;\n\t\tthis.options.formats.forEach((format) => {\n\t\t\tif (file.type === 'image/' + format) {\n\t\t\t\tvalid = true;\n\t\t\t}\n\t\t});\n\t\tif (!valid) {\n\t\t\tapp.showNotify({\n\t\t\t\ttitle: `${app.vtranslate('JS_INVALID_FILE_TYPE')}`,\n\t\t\t\ttext: `${app.vtranslate('JS_AVAILABLE_FILE_TYPES')}: ${this.options.formats.join(', ')}`,\n\t\t\t\ttype: 'error'\n\t\t\t});\n\t\t}\n\t\treturn valid;\n\t}\n\n\t/**\n\t * Validate maximum file size\n\t * @param {Object} file\n\t * @returns {Boolean}\n\t */\n\tvalidateSize(file) {\n\t\tlet result = typeof file.size === 'number' && file.size < this.options.maxFileSize;\n\t\tif (!result) {\n\t\t\tapp.showNotify({\n\t\t\t\ttext: `${app.vtranslate('JS_UPLOADED_FILE_SIZE_EXCEEDS')} <br> [${this.options.maxFileSizeDisplay}]`,\n\t\t\t\ttype: 'error'\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * Show limit error\n\t */\n\tshowLimitError() {\n\t\tthis.elements.fileInput.val('');\n\t\tapp.showNotify({\n\t\t\ttext: `${app.vtranslate('JS_FILE_LIMIT')} [${this.options.limit}]`,\n\t\t\ttype: 'error'\n\t\t});\n\t}\n\n\t/**\n\t * Get only valid files from list\n\t *\n\t * @param {Array} files\n\t * @returns {Array}\n\t */\n\tfilterValidFiles(files) {\n\t\tif (files.length + this.files.length > this.options.limit) {\n\t\t\tthis.showLimitError();\n\t\t\treturn [];\n\t\t}\n\t\treturn files.filter((file) => {\n\t\t\treturn this.validateFormat(file) && this.validateSize(file);\n\t\t});\n\t}\n\n\t/**\n\t * Set files hash\n\t * @param {Array} files\n\t * @returns {Array}\n\t */\n\tsetFilesHash(files) {\n\t\tconst addedFiles = [];\n\t\tfor (let i = 0, len = files.length; i < len; i++) {\n\t\t\tconst file = files[i];\n\t\t\tif (typeof file.hash === 'undefined') {\n\t\t\t\tif (this.files.length < this.options.limit) {\n\t\t\t\t\tfile.hash = App.Fields.Text.generateRandomHash(CONFIG.userId);\n\t\t\t\t\tthis.files.push({ hash: file.hash, imageSrc: file.imageSrc, name: file.name, file });\n\t\t\t\t\taddedFiles.push(file);\n\t\t\t\t} else {\n\t\t\t\t\tthis.showLimitError();\n\t\t\t\t\treturn addedFiles;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn addedFiles;\n\t}\n\n\t/**\n\t * Add event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {object} data\n\t */\n\tadd(_e, data) {\n\t\tif (data.files.length > 0) {\n\t\t\tdata.submit();\n\t\t}\n\t}\n\n\t/**\n\t * Progressall event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tprogressAll(_e, data) {\n\t\tconst progress = parseInt((data.loaded / data.total) * 100, 10);\n\t\tthis.elements.progressBar.css({ width: progress + '%' });\n\t\tif (progress === 100) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.elements.progress.addClass('d-none');\n\t\t\t\tthis.elements.progressBar.css({ width: '0%' });\n\t\t\t}, 1000);\n\t\t} else {\n\t\t\tthis.elements.progress.removeClass('d-none');\n\t\t}\n\t}\n\n\t/**\n\t * Dragover event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t */\n\tdragOver(_e) {\n\t\tthis.elements.component.addClass('c-multi-image__drop-effect');\n\t}\n\n\t/**\n\t * Dragleave event handler\n\t * @param {Event} e\n\t */\n\tdragLeave(_e) {\n\t\tthis.elements.component.removeClass('c-multi-image__drop-effect');\n\t}\n\n\t/**\n\t * Download file according to source type (base64/file from server)\n\t *\n\t * @param {String} hash\n\t */\n\tdownload(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tif (fileInfo.imageSrc.substr(0, 8).toLowerCase() === 'file.php') {\n\t\t\treturn this.downloadFile(hash);\n\t\t} else {\n\t\t\treturn this.downloadBase64(hash);\n\t\t}\n\t}\n\n\t/**\n\t * Download file that exists on the server already\n\t * @param {String} hash\n\t */\n\tdownloadFile(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tconst link = document.createElement('a');\n\t\t$(link).css('display', 'none');\n\t\tif (typeof link.download === 'string') {\n\t\t\tdocument.body.appendChild(link); // Firefox requires the link to be in the body\n\t\t\tlink.download = fileInfo.name;\n\t\t\tlink.href = fileInfo.imageSrc;\n\t\t\tlink.click();\n\t\t\tdocument.body.removeChild(link); // remove the link when done\n\t\t} else {\n\t\t\tlocation.replace(fileInfo.imageSrc);\n\t\t}\n\t}\n\n\t/**\n\t * Download file from base64 image\n\t *\n\t * @param {String} hash\n\t */\n\tdownloadBase64(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tconst imageUrl =\n\t\t\t`data:application/octet-stream;filename=${fileInfo.name};base64,` + fileInfo.imageSrc.split(',')[1];\n\t\tconst link = document.createElement('a');\n\t\t$(link).css('display', 'none');\n\t\tif (typeof link.download === 'string') {\n\t\t\tdocument.body.appendChild(link); // Firefox requires the link to be in the body\n\t\t\tlink.download = fileInfo.name;\n\t\t\tlink.href = imageUrl;\n\t\t\tlink.click();\n\t\t\tdocument.body.removeChild(link); // remove the link when done\n\t\t} else {\n\t\t\tlocation.replace(imageUrl);\n\t\t}\n\t}\n\n\t/**\n\t * Display modal window with large preview\n\t *\n\t * @param {string} hash\n\t */\n\tzoomPreview(hash) {\n\t\tconst self = this;\n\t\tlet fileInfo = this.getFileInfo(hash);\n\t\tconst titleTemplate = () => {\n\t\t\tconst titleObject = document.createElement('span');\n\t\t\tconst icon = document.createElement('i');\n\t\t\ticon.setAttribute('class', `fa fa-image`);\n\t\t\ttitleObject.appendChild(icon);\n\t\t\ttitleObject.appendChild(document.createTextNode(` ${fileInfo.name}`));\n\t\t\treturn titleObject.innerHTML;\n\t\t};\n\n\t\tlet buttons = [];\n\t\tif (!self.detailView) {\n\t\t\tbuttons.push({\n\t\t\t\ttext: app.vtranslate('JS_DELETE'),\n\t\t\t\ticon: 'fa fa-trash-alt',\n\t\t\t\tclass: 'float-left btn btn-danger js-delete'\n\t\t\t});\n\t\t}\n\t\tbuttons.push(\n\t\t\t{\n\t\t\t\ttext: app.vtranslate('JS_DOWNLOAD'),\n\t\t\t\ticon: 'fa fa-download',\n\t\t\t\tclass: 'float-left btn btn-success js-success'\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: app.vtranslate('JS_CLOSE'),\n\t\t\t\ticon: 'fa fa-times',\n\t\t\t\tclass: 'btn btn-warning',\n\t\t\t\tdata: { dismiss: 'modal' }\n\t\t\t}\n\t\t);\n\t\tapp.showModalHtml({\n\t\t\tclass: 'modal-lg',\n\t\t\theader: titleTemplate(),\n\t\t\tfooterButtons: buttons,\n\t\t\tbody: self.options.showCarousel\n\t\t\t\t? self.generateCarousel(hash)\n\t\t\t\t: `<img src=\"${fileInfo.imageSrc}\" class=\"w-100\" />`,\n\t\t\tcb: (modal) => {\n\t\t\t\tmodal.on('click', '.js-delete', function () {\n\t\t\t\t\tself.deleteFile(fileInfo.hash);\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t});\n\t\t\t\tmodal.on('click', '.js-success', function () {\n\t\t\t\t\tself.download(fileInfo.hash);\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t});\n\t\t\t\tif (self.options.showCarousel) {\n\t\t\t\t\tmodal.find(`#carousel-${hash}`).on('slid.bs.carousel', (e) => {\n\t\t\t\t\t\tfileInfo = self.getFileInfo($(e.relatedTarget).data('hash'));\n\t\t\t\t\t\tmodal.find('.js-modal-title').html(titleTemplate());\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Remove file from preview and from file list\n\t *\n\t * @param {String} hash\n\t */\n\tdeleteFileCallback(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tif (fileInfo.previewElement) {\n\t\t\tfileInfo.previewElement.popover('dispose').remove();\n\t\t}\n\t\tthis.files = this.files.filter((file) => file.hash !== fileInfo.hash);\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Delete image from input field\n\t * Should be called with this pointing on button element with data-hash attribute\n\t *\n\t * @param {string} hash\n\t * @param {boolean} showConfirmation - dialog?\n\t */\n\tdeleteFile(hash, showConfirmation = true) {\n\t\tif (showConfirmation) {\n\t\t\tconst fileInfo = this.getFileInfo(hash);\n\t\t\tapp.showConfirmModal({\n\t\t\t\ttitle: fileInfo.name,\n\t\t\t\ttext: app.vtranslate('JS_DELETE_FILE_CONFIRMATION'),\n\t\t\t\ttitleTrusted: false,\n\t\t\t\ticon: 'fa fa-trash-alt',\n\t\t\t\tconfirmedCallback: () => {\n\t\t\t\t\tthis.deleteFileCallback(hash);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.deleteFileCallback(hash);\n\t\t}\n\t}\n\n\t/**\n\t * File change event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {object} data\n\t */\n\tchange(e, data) {\n\t\tdata.files = this.filterValidFiles(data.files);\n\t\tdata.files = this.setFilesHash(data.files);\n\t\tthis.dragLeave(e);\n\t}\n\n\t/**\n\t * Generate and apply popover to preview\n\t *\n\t * @param {File} file\n\t * @param {string} template\n\t * @param {string} imageSrc\n\t * @returns {jQuery}\n\t */\n\taddPreviewPopover(file, template, imageSrc) {\n\t\tconst thisInstance = this;\n\t\tlet fileSize = '';\n\t\tconst fileInfo = this.getFileInfo(file.hash);\n\t\tlet size = fileInfo.sizeDisplay || fileInfo.size;\n\t\tif (size) {\n\t\t\tfileSize = `<div class=\"p-1 bg-white border rounded small position-absolute\">${size}</div>`;\n\t\t}\n\t\tlet deleteBtn = '';\n\t\tif (!this.detailView) {\n\t\t\tdeleteBtn = `<button class=\"btn btn-sm btn-danger c-btn-collapsible js-multi-image__popover-btn-delete\" type=\"button\" data-hash=\"${\n\t\t\t\tfile.hash\n\t\t\t}\" data-js=\"click\"><i class=\"fa fa-trash-alt\"></i> <span class=\"c-btn-collapsible__text\">${app.vtranslate(\n\t\t\t\t'JS_DELETE'\n\t\t\t)}</span></button>`;\n\t\t}\n\n\t\tconst titleObject = document.createElement('span');\n\t\ttitleObject.appendChild(document.createTextNode(fileInfo.name));\n\n\t\treturn $(template).popover({\n\t\t\tcontainer: thisInstance.elements.component,\n\t\t\ttitle: `<div class=\"u-text-ellipsis\"><i class=\"fa fa-image\"></i> ` + titleObject.innerHTML + `</div>`,\n\t\t\thtml: true,\n\t\t\tsanitize: false,\n\t\t\ttrigger: 'focus',\n\t\t\tplacement: 'top',\n\t\t\tcontent: `<img src=\"${imageSrc}\" class=\"w-100 js-multi-image__popover-img c-multi-image__popover-img\" data-hash=\"${file.hash}\" data-js=\"click\"/>`,\n\t\t\ttemplate: `<div class=\"popover\" role=\"tooltip\">\n\t\t\t\t<div class=\"arrow\"></div>\n\t\t\t\t<h3 class=\"popover-header\"></h3>\n\t\t\t\t<div class=\"popover-body\"></div>\n\t\t\t\t<div class=\"text-right popover-footer js-multi-image__popover-actions\">\n\t\t\t\t\t${fileSize}\n\t\t\t\t\t${deleteBtn}\n\t\t\t\t\t<button class=\"btn btn-sm btn-success c-btn-collapsible js-multi-image__popover-btn-download\" type=\"button\" data-hash=\"${\n\t\t\t\t\t\tfile.hash\n\t\t\t\t\t}\" data-js=\"click\"><i class=\"fa fa-download\"></i> <span class=\"c-btn-collapsible__text\">${app.vtranslate(\n\t\t\t\t'JS_DOWNLOAD'\n\t\t\t)}</span></button>\n\t\t\t\t\t<button class=\"btn btn-sm btn-primary c-btn-collapsible js-multi-image__popover-btn-zoom\" type=\"button\" data-hash=\"${\n\t\t\t\t\t\tfile.hash\n\t\t\t\t\t}\" data-js=\"click\"><i class=\"fa fa-search-plus\"></i> <span class=\"c-btn-collapsible__text\">${app.vtranslate(\n\t\t\t\t'JS_ZOOM_IN'\n\t\t\t)}</span></button>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t});\n\t}\n\n\t/**\n\t * Remove preview popover\n\t *\n\t * @param {String} hash\n\t */\n\tremovePreviewPopover(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tif (typeof fileInfo.previewElement !== 'undefined') {\n\t\t\tfileInfo.previewElement.popover('dispose');\n\t\t}\n\t}\n\n\t/**\n\t * Hide popovers when user starts moving file preview\n\t *\n\t * @param {Event} e\n\t * @param {Object} ui\n\t */\n\tsortOver(_e, _ui) {\n\t\tthis.elements.result.find('.js-multi-image__preview').popover('hide');\n\t}\n\n\t/**\n\t * Update file position according to elements order\n\t *\n\t * @param {Event} e\n\t * @param {Object} ui\n\t */\n\tsortStop(_e, _ui) {\n\t\tconst actualElements = this.elements.result.find('.js-multi-image__preview').toArray();\n\t\tthis.files = actualElements.map((element) => {\n\t\t\tfor (let i = 0, len = this.files.length; i < len; i++) {\n\t\t\t\tconst elementHash = $(element).data('hash');\n\t\t\t\tif (this.files[i].hash === elementHash) {\n\t\t\t\t\treturn this.files[i];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.redraw();\n\t}\n\n\t/**\n\t * Redraw view according to in-memory positions\n\t */\n\tredraw() {\n\t\tthis.files.forEach((file) => {\n\t\t\tthis.elements.result.append(file.previewElement);\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Enable drag and drop files repositioning\n\t */\n\tenableDragNDrop() {\n\t\tthis.elements.result\n\t\t\t.sortable({\n\t\t\t\thandle: '.js-multi-image__preview-img',\n\t\t\t\titems: '.js-multi-image__preview',\n\t\t\t\tover: this.sortOver.bind(this),\n\t\t\t\tstop: this.sortStop.bind(this)\n\t\t\t})\n\t\t\t.disableSelection()\n\t\t\t.on('mousedown', '.js-multi-image__preview-img', function () {\n\t\t\t\tthis.focus(); // focus to show popover\n\t\t\t});\n\t}\n\n\t/**\n\t * Generate preview of images and append to multi image results view\n\t *\n\t * @param {Array} files - array of Files\n\t * @param {function} callback\n\t */\n\tgeneratePreviewElements(files, callback) {\n\t\tlet preview = (file, template, imageSrc) => {\n\t\t\tfile.preview = this.addPreviewPopover(file, template, imageSrc);\n\t\t\tthis.addFileInfoProperty(file.hash, 'previewElement', file.preview);\n\t\t\tcallback(file.preview);\n\t\t};\n\t\tfiles.forEach((file) => {\n\t\t\tif (file instanceof File) {\n\t\t\t\tthis.generatePreviewFromFile(file, (template, imageSrc) => {\n\t\t\t\t\tpreview(file, template, imageSrc);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.generatePreviewFromValue(file, (template, imageSrc) => {\n\t\t\t\t\tpreview(file, template, imageSrc);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Generate preview of image as html string\n\t *\n\t * @param {File} file\n\t * @param {function} callback\n\t */\n\tgeneratePreviewFromFile(file, callback) {\n\t\tconst fr = new FileReader();\n\t\tfr.onload = () => {\n\t\t\tfile.imageSrc = fr.result;\n\t\t\tthis.addFileInfoProperty(file.hash, 'imageSrc', file.imageSrc);\n\t\t\tcallback(this.createPreview(file), fr.result);\n\t\t};\n\t\tfr.readAsDataURL(file);\n\t}\n\n\t/**\n\t * Generate preview of image as html string from existing values\n\t *\n\t * @param {File} file\n\t * @param {function} callback\n\t */\n\tgeneratePreviewFromValue(file, callback) {\n\t\tcallback(this.createPreview(file), file.imageSrc);\n\t}\n\t/**\n\t * Create Preview element\n\t * @param {Object} file\n\t * @returns {String}\n\t */\n\tcreatePreview(file) {\n\t\tconst container = document.createElement('div');\n\t\tconst item = document.createElement('div');\n\t\titem.setAttribute('class', 'd-inline-block mr-1 js-multi-image__preview');\n\t\titem.setAttribute('id', `js-multi-image__preview-hash-${file.hash}`);\n\t\titem.setAttribute('data-hash', file.hash);\n\n\t\tconst subElement = document.createElement('div');\n\t\tsubElement.setAttribute('class', 'img-thumbnail js-multi-image__preview-img c-multi-image__preview-img');\n\t\tsubElement.setAttribute('data-hash', file.hash);\n\t\tsubElement.setAttribute('style', `background-image:url(${file.imageSrc})`);\n\t\tsubElement.setAttribute('tabindex', '0');\n\t\tsubElement.setAttribute('title', file.name);\n\t\titem.appendChild(subElement);\n\t\tcontainer.appendChild(item);\n\n\t\treturn container.innerHTML;\n\t}\n\n\t/**\n\t * Load files that were in valueInput as json string\n\t */\n\tloadExistingFiles() {\n\t\tthis.files = this.files\n\t\t\t.map((file) => {\n\t\t\t\tfile.hash = App.Fields.Text.generateRandomHash(CONFIG.userId);\n\t\t\t\treturn file;\n\t\t\t})\n\t\t\t.slice(0, this.options.limit);\n\t\tthis.generatePreviewElements(this.files, (element) => {\n\t\t\tthis.elements.result.append(element);\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Generate carousel for all files in large preview\n\t *\n\t * @param {String} hash\n\t */\n\tgenerateCarousel(hash) {\n\t\tif (this.files.length <= 1) {\n\t\t\tconst fileInfo = this.getFileInfo(hash);\n\t\t\treturn `<img class=\"d-block w-100\" src=\"${fileInfo.imageSrc}\">`;\n\t\t}\n\t\tlet template = `<div id=\"carousel-${hash}\" class=\"carousel slide c-carousel\" data-ride=\"carousel\" data-js=\"container\">\n\t\t  <div class=\"carousel-inner\">`;\n\t\tthis.files.forEach((file) => {\n\t\t\ttemplate += `<div class=\"carousel-item c-carousel__item`;\n\t\t\tif (file.hash === hash) {\n\t\t\t\ttemplate += ` active`;\n\t\t\t}\n\t\t\ttemplate += `\" data-hash=\"${file.hash}\">\n\t\t      <img class=\"d-block w-100 c-carousel__image\" src=\"${file.imageSrc}\">\n\t\t    </div>`;\n\t\t});\n\t\ttemplate += `<a class=\"carousel-control-prev c-carousel__prevnext-btn c-carousel__prev-btn\" href=\"#carousel-${hash}\" role=\"button\" data-slide=\"prev\" data-js=\"click\">\n\t\t    <span class=\"fas fa-caret-left fa-2x c-carousel__prev-icon mr-1\" aria-hidden=\"true\"></span>\n\t\t  </a>\n\t\t  <a class=\"carousel-control-next c-carousel__prevnext-btn c-carousel__next-btn\" href=\"#carousel-${hash}\" role=\"button\" data-slide=\"next\" data-js=\"click\">\n\t\t    <span class=\"fas fa-caret-right fa-2x c-carousel__next-icon ml-1\" aria-hidden=\"true\"></span>\n\t\t  </a>\n\t\t</div>`;\n\t\treturn template;\n\t}\n}\n"],"names":["MultiImage","element","elements","options","showCarousel","detailView","fileInput","find","eq","length","component","form","closest","$","on","onFormSubmit","addButton","values","progressBar","progress","result","fieldInfo","data","formats","limit","maxFileSize","CONFIG","maxUploadLimit","maxFileSizeDisplay","files","JSON","parse","val","detach","click","addButtonClick","bind","fileupload","dataType","replaceFileInput","autoUpload","submit","add","progressall","progressAll","change","drop","dragover","dragOver","fail","uploadError","done","uploadSuccess","dragLeave","enableDragNDrop","thisInstance","zoomPreview","e","preventDefault","download","deleteFile","loadExistingFiles","App","Fields","currentFileUploads","stopPropagation","stopImmediatePropagation","app","showAlert","vtranslate","trigger","_e","formData","hash","progressInstance","progressIndicator","position","blockInfo","enabled","elementToBlock","file","i","len","errorLog","showNotify","text","type","propertyName","value","getFileInfo","fileInfo","mode","jqXHR","response","responseJSON","attach","Array","isArray","forEach","fileAttach","error","textTrusted","title","name","updateFormValues","key","info","addFileInfoProperty","size","sizeDisplay","generatePreviewFromFile","template","imageSrc","addPreviewPopover","redraw","map","stringify","formValues","format","valid","join","showLimitError","filter","validateFormat","validateSize","addedFiles","Text","generateRandomHash","userId","push","parseInt","loaded","total","css","width","setTimeout","addClass","removeClass","substr","toLowerCase","downloadFile","downloadBase64","link","document","createElement","body","appendChild","href","removeChild","location","replace","imageUrl","split","titleTemplate","icon","setAttribute","titleObject","createTextNode","innerHTML","buttons","self","class","dismiss","showModalHtml","header","footerButtons","generateCarousel","cb","modal","hideModalWindow","relatedTarget","html","previewElement","popover","remove","showConfirmation","showConfirmModal","titleTrusted","confirmedCallback","deleteFileCallback","filterValidFiles","setFilesHash","fileSize","deleteBtn","container","sanitize","placement","content","actualElements","toArray","elementHash","append","sortable","handle","items","over","sortOver","stop","sortStop","disableSelection","focus","callback","preview","generatePreviewFromValue","fr","onload","createPreview","readAsDataURL","item","subElement","slice","generatePreviewElements"],"mappings":"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"}