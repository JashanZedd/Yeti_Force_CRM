{"version":3,"file":"MultiImage.min.js","sources":["MultiImage.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nclass MultiImage {\n\t/**\n\t * Create class instance\n\t *\n\t * @param {HTMLElement|jQuery} inputElement - input type file element inside component\n\t */\n\tconstructor(element) {\n\t\tconst thisInstance = this;\n\t\tthis.elements = {};\n\t\tthis.options = {\n\t\t\tzoomTitleAnimation: {\n\t\t\t\tin: 'fadeIn',\n\t\t\t\tout: 'fadeOut'\n\t\t\t},\n\t\t\tshowCarousel: true\n\t\t};\n\t\tthis.detailView = false;\n\t\tthis.elements.fileInput = element.find('.js-multi-image__file').eq(0);\n\t\tif (this.elements.fileInput.length === 0) {\n\t\t\tthis.detailView = true;\n\t\t}\n\t\tthis.elements.component = element.eq(0);\n\t\tthis.elements.form = element.closest('form').eq(0);\n\t\t$(this.elements.form).on('submit', this.onFormSubmit);\n\t\tthis.elements.addButton = this.elements.component.find('.js-multi-image__file-btn').eq(0);\n\t\tthis.elements.values = this.elements.component.find('.js-multi-image__values').eq(0);\n\t\tthis.elements.progressBar = this.elements.component.find('.js-multi-image__progress-bar').eq(0);\n\t\tthis.elements.progress = this.elements.component.find('.js-multi-image__progress').eq(0);\n\t\tthis.elements.result = this.elements.component.find('.js-multi-image__result').eq(0);\n\t\tthis.fieldInfo = this.elements.values.data('fieldinfo');\n\t\tthis.options.formats = this.fieldInfo.formats;\n\t\tthis.options.limit = this.fieldInfo.limit;\n\t\tif (!this.detailView) {\n\t\t\tthis.files = JSON.parse(this.elements.values.val());\n\t\t} else {\n\t\t\tthis.files = this.elements.values.data('value');\n\t\t}\n\t\tif (!this.detailView) {\n\t\t\tthis.elements.fileInput.detach();\n\t\t\tthis.elements.addButton.click(this.addButtonClick.bind(this));\n\t\t\tthis.elements.fileInput.fileupload({\n\t\t\t\tdataType: 'json',\n\t\t\t\treplaceFileInput: false,\n\t\t\t\tfileInput: this.fileInput,\n\t\t\t\tautoUpload: false,\n\t\t\t\tsubmit: this.submit.bind(this),\n\t\t\t\tadd: this.add.bind(this),\n\t\t\t\tprogressall: this.progressAll.bind(this),\n\t\t\t\tchange: this.change.bind(this),\n\t\t\t\tdrop: this.change.bind(this),\n\t\t\t\tdragover: this.dragOver.bind(this),\n\t\t\t\tfail: this.uploadError.bind(this),\n\t\t\t\tdone: this.uploadSuccess.bind(this)\n\t\t\t});\n\t\t\tthis.elements.component.on('dragleave', this.dragLeave.bind(this));\n\t\t\tthis.elements.component.on('dragend', this.dragLeave.bind(this));\n\t\t\tthis.elements.fileInput.fileupload('option', 'dropZone', $(this.elements.component));\n\t\t\tthis.enableDragNDrop();\n\t\t}\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-img', function(e) {\n\t\t\tthisInstance.zoomPreview($(this).data('hash'));\n\t\t});\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-zoom', function(e) {\n\t\t\te.preventDefault();\n\t\t\tthisInstance.zoomPreview($(this).data('hash'));\n\t\t});\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-download', function(e) {\n\t\t\te.preventDefault();\n\t\t\tthisInstance.download($(this).data('hash'));\n\t\t});\n\t\tif (!this.detailView) {\n\t\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-delete', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthisInstance.deleteFile($(this).data('hash'));\n\t\t\t});\n\t\t}\n\t\tthis.loadExistingFiles();\n\t\tif (typeof $.fn.animateCss === 'undefined') {\n\t\t\t$.fn.extend({\n\t\t\t\tanimateCss: function(animationName, callback) {\n\t\t\t\t\tlet animationEnd = (function(el) {\n\t\t\t\t\t\tlet animations = {\n\t\t\t\t\t\t\tanimation: 'animationend',\n\t\t\t\t\t\t\tOAnimation: 'oAnimationEnd',\n\t\t\t\t\t\t\tMozAnimation: 'mozAnimationEnd',\n\t\t\t\t\t\t\tWebkitAnimation: 'webkitAnimationEnd'\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfor (let t in animations) {\n\t\t\t\t\t\t\tif (el.style[t] !== undefined) {\n\t\t\t\t\t\t\t\treturn animations[t];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})(document.createElement('div'));\n\t\t\t\t\tthis.addClass('animated ' + animationName).one(animationEnd, function() {\n\t\t\t\t\t\t$(this).removeClass('animated ' + animationName);\n\n\t\t\t\t\t\tif (typeof callback === 'function') callback();\n\t\t\t\t\t});\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Prevent form submission before file upload end\n\t * @param e\n\t */\n\tonFormSubmit(e) {\n\t\tif (App.Fields.MultiImage.currentFileUploads) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\te.stopImmediatePropagation();\n\t\t\tbootbox.alert(app.vtranslate('JS_WAIT_FOR_FILE_UPLOAD'));\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Prevent form submission\n\t *\n\t * @param {Event} e\n\t */\n\taddButtonClick(e) {\n\t\te.preventDefault();\n\t\tthis.elements.fileInput.trigger('click');\n\t}\n\n\t/**\n\t * Submit event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tsubmit(e, data) {\n\t\tdata.formData = {\n\t\t\thash: data.files[0].hash\n\t\t};\n\t\tApp.Fields.MultiImage.currentFileUploads++;\n\t}\n\n\t/**\n\t * Get file information\n\t *\n\t * @param {String} hash - file id\n\t * @returns {Object}\n\t */\n\tgetFileInfo(hash) {\n\t\tfor (let i = 0, len = this.files.length; i < len; i++) {\n\t\t\tconst file = this.files[i];\n\t\t\tif (file.hash === hash) {\n\t\t\t\treturn file;\n\t\t\t}\n\t\t}\n\t\tapp.errorLog(`File '${hash}' not found.`);\n\t\tVtiger_Helper_Js.showPnotify({ text: app.vtranslate('JS_INVALID_FILE_HASH') + ` [${hash}]` });\n\t}\n\n\t/**\n\t * Add property to file info object\n\t *\n\t * @param {String} hash - file id\n\t * @param {String} propertyName\n\t * @param {any} value\n\t * @returns {Object}\n\t */\n\taddFileInfoProperty(hash, propertyName, value) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tfileInfo[propertyName] = value;\n\t\treturn fileInfo;\n\t}\n\n\t/**\n\t * Error event handler from file upload request\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tuploadError(e, data) {\n\t\tapp.errorLog('File upload error.');\n\t\tconst { jqXHR, files } = data;\n\t\tif (typeof jqXHR.responseJSON === 'undefined' || jqXHR.responseJSON === null) {\n\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t\treturn Vtiger_Helper_Js.showPnotify(app.vtranslate('JS_FILE_UPLOAD_ERROR'));\n\t\t}\n\t\tconst response = jqXHR.responseJSON;\n\t\t// first try to show error for concrete file\n\t\tif (\n\t\t\ttypeof response.result !== 'undefined' &&\n\t\t\ttypeof response.result.attach !== 'undefined' &&\n\t\t\tArray.isArray(response.result.attach)\n\t\t) {\n\t\t\tresponse.result.attach.forEach(fileAttach => {\n\t\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t\t\tthis.deleteFile(fileAttach.hash, false);\n\t\t\t\tif (typeof fileAttach.error === 'string') {\n\t\t\t\t\tVtiger_Helper_Js.showPnotify(fileAttach.error + ` [${fileAttach.name}]`);\n\t\t\t\t} else {\n\t\t\t\t\tVtiger_Helper_Js.showPnotify(app.vtranslate('JS_FILE_UPLOAD_ERROR') + ` [${fileAttach.name}]`);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.updateFormValues();\n\t\t\treturn;\n\t\t}\n\t\t// else show default upload error\n\t\tfiles.forEach(file => {\n\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t\tthis.deleteFile(file.hash, false);\n\t\t\tVtiger_Helper_Js.showPnotify(app.vtranslate('JS_FILE_UPLOAD_ERROR') + ` [${file.name}]`);\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Success event handler from file upload request\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tuploadSuccess(e, data) {\n\t\tconst { result } = data;\n\t\tconst attach = result.result.attach;\n\t\tattach.forEach(fileAttach => {\n\t\t\tconst hash = fileAttach.hash;\n\t\t\tif (!hash) {\n\t\t\t\treturn app.errorLog(new Error(app.vtranslate('JS_INVALID_FILE_HASH') + ` [${hash}]`));\n\t\t\t}\n\t\t\tif (typeof fileAttach.key === 'undefined') {\n\t\t\t\treturn this.uploadError(e, data);\n\t\t\t}\n\t\t\tif (typeof fileAttach.info !== 'undefined' && fileAttach.info) {\n\t\t\t\tVtiger_Helper_Js.showPnotify({ type: 'notice', text: fileAttach.info + ` [${fileAttach.name}]` });\n\t\t\t}\n\t\t\tconst fileInfo = this.getFileInfo(hash);\n\t\t\tthis.addFileInfoProperty(hash, 'key', fileAttach.key);\n\t\t\tthis.addFileInfoProperty(hash, 'size', fileAttach.size);\n\t\t\tthis.addFileInfoProperty(hash, 'name', fileAttach.name);\n\t\t\tthis.removePreviewPopover(hash);\n\t\t\tthis.addPreviewPopover(fileInfo.file, fileInfo.previewElement, fileInfo.imageSrc);\n\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Update form input values\n\t */\n\tupdateFormValues() {\n\t\tthis.elements.fileInput.val(null);\n\t\tconst formValues = this.files.map(file => {\n\t\t\treturn { key: file.key, name: file.name, size: file.size };\n\t\t});\n\t\tthis.elements.values.val(JSON.stringify(formValues));\n\t}\n\n\t/**\n\t * Validate file\n\t *\n\t * @param {Object} file\n\t * @returns {boolean}\n\t */\n\tvalidateFile(file) {\n\t\tlet valid = false;\n\t\tthis.options.formats.forEach(format => {\n\t\t\tif (file.type === 'image/' + format) {\n\t\t\t\tvalid = true;\n\t\t\t}\n\t\t});\n\t\tif (!valid) {\n\t\t\tVtiger_Helper_Js.showPnotify(\n\t\t\t\t`${app.vtranslate('JS_INVALID_FILE_TYPE')} [${file.name}]\\n${app.vtranslate(\n\t\t\t\t\t'JS_AVAILABLE_FILE_TYPES'\n\t\t\t\t)}  [${this.options.formats.join(', ')}]`\n\t\t\t);\n\t\t}\n\t\treturn valid;\n\t}\n\n\t/**\n\t * Show limit error\n\t */\n\tshowLimitError() {\n\t\tthis.elements.fileInput.val('');\n\t\tVtiger_Helper_Js.showPnotify(`${app.vtranslate('JS_FILE_LIMIT')} [${this.options.limit}]`);\n\t}\n\n\t/**\n\t * Get only valid files from list\n\t *\n\t * @param {Array} files\n\t * @returns {Array}\n\t */\n\tfilterValidFiles(files) {\n\t\tif (files.length + this.files.length > this.options.limit) {\n\t\t\tthis.showLimitError();\n\t\t\treturn [];\n\t\t}\n\t\treturn files.filter(file => {\n\t\t\treturn this.validateFile(file);\n\t\t});\n\t}\n\n\t/**\n\t * Set files hash\n\t * @param {Array} files\n\t * @returns {Array}\n\t */\n\tsetFilesHash(files) {\n\t\tconst addedFiles = [];\n\t\tfor (let i = 0, len = files.length; i < len; i++) {\n\t\t\tconst file = files[i];\n\t\t\tif (typeof file.hash === 'undefined') {\n\t\t\t\tif (this.files.length < this.options.limit) {\n\t\t\t\t\tfile.hash = App.Fields.Text.generateRandomHash(CONFIG.userId);\n\t\t\t\t\tthis.files.push({ hash: file.hash, imageSrc: file.imageSrc, name: file.name, file });\n\t\t\t\t\taddedFiles.push(file);\n\t\t\t\t} else {\n\t\t\t\t\tthis.showLimitError();\n\t\t\t\t\treturn addedFiles;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn addedFiles;\n\t}\n\n\t/**\n\t * Add event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {object} data\n\t */\n\tadd(e, data) {\n\t\tif (data.files.length > 0) {\n\t\t\tdata.submit();\n\t\t}\n\t}\n\n\t/**\n\t * Progressall event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tprogressAll(e, data) {\n\t\tconst progress = parseInt((data.loaded / data.total) * 100, 10);\n\t\tthis.elements.progressBar.css({ width: progress + '%' });\n\t\tif (progress === 100) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.elements.progress.addClass('d-none');\n\t\t\t\tthis.elements.progressBar.css({ width: '0%' });\n\t\t\t}, 1000);\n\t\t} else {\n\t\t\tthis.elements.progress.removeClass('d-none');\n\t\t}\n\t}\n\n\t/**\n\t * Dragover event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t */\n\tdragOver(e) {\n\t\tthis.elements.component.addClass('c-multi-image__drop-effect');\n\t}\n\n\t/**\n\t * Dragleave event handler\n\t * @param {Event} e\n\t */\n\tdragLeave(e) {\n\t\tthis.elements.component.removeClass('c-multi-image__drop-effect');\n\t}\n\n\t/**\n\t * Download file according to source type (base64/file from server)\n\t *\n\t * @param {String} hash\n\t */\n\tdownload(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tif (fileInfo.imageSrc.substr(0, 8).toLowerCase() === 'file.php') {\n\t\t\treturn this.downloadFile(hash);\n\t\t} else {\n\t\t\treturn this.downloadBase64(hash);\n\t\t}\n\t}\n\n\t/**\n\t * Download file that exists on the server already\n\t * @param {String} hash\n\t */\n\tdownloadFile(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tconst link = document.createElement('a');\n\t\t$(link).css('display', 'none');\n\t\tif (typeof link.download === 'string') {\n\t\t\tdocument.body.appendChild(link); // Firefox requires the link to be in the body\n\t\t\tlink.download = fileInfo.name;\n\t\t\tlink.href = fileInfo.imageSrc;\n\t\t\tlink.click();\n\t\t\tdocument.body.removeChild(link); // remove the link when done\n\t\t} else {\n\t\t\tlocation.replace(fileInfo.imageSrc);\n\t\t}\n\t}\n\n\t/**\n\t * Download file from base64 image\n\t *\n\t * @param {String} hash\n\t */\n\tdownloadBase64(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tconst imageUrl =\n\t\t\t`data:application/octet-stream;filename=${fileInfo.name};base64,` + fileInfo.imageSrc.split(',')[1];\n\t\tconst link = document.createElement('a');\n\t\t$(link).css('display', 'none');\n\t\tif (typeof link.download === 'string') {\n\t\t\tdocument.body.appendChild(link); // Firefox requires the link to be in the body\n\t\t\tlink.download = fileInfo.name;\n\t\t\tlink.href = imageUrl;\n\t\t\tlink.click();\n\t\t\tdocument.body.removeChild(link); // remove the link when done\n\t\t} else {\n\t\t\tlocation.replace(imageUrl);\n\t\t}\n\t}\n\n\t/**\n\t * Display modal window with large preview\n\t *\n\t * @param {string} hash\n\t */\n\tzoomPreview(hash) {\n\t\tconst thisInstance = this;\n\t\tlet fileInfo = this.getFileInfo(hash);\n\t\tconst titleTemplate = () => `<i class=\"fa fa-image\"></i> ${fileInfo.name}`;\n\t\tconst bootboxOptions = {\n\t\t\tsize: 'large',\n\t\t\tbackdrop: true,\n\t\t\tonEscape: true,\n\t\t\ttitle: `<span id=\"bootbox-title-${hash}\" class=\"animated ${\n\t\t\t\tthis.options.zoomTitleAnimation.in\n\t\t\t}\">${titleTemplate()}</span>`,\n\t\t\tmessage: `<img src=\"${fileInfo.imageSrc}\" class=\"w-100\" />`,\n\t\t\tbuttons: {}\n\t\t};\n\t\tif (this.options.showCarousel) {\n\t\t\tbootboxOptions.message = this.generateCarousel(hash);\n\t\t}\n\t\tif (!this.detailView) {\n\t\t\tbootboxOptions.buttons.Delete = {\n\t\t\t\tlabel: `<i class=\"fa fa-trash-alt\"></i> ${app.vtranslate('JS_DELETE')}`,\n\t\t\t\tclassName: 'float-left btn btn-danger',\n\t\t\t\tcallback() {\n\t\t\t\t\tthisInstance.deleteFile(fileInfo.hash);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\tbootboxOptions.buttons.Download = {\n\t\t\tlabel: `<i class=\"fa fa-download\"></i> ${app.vtranslate('JS_DOWNLOAD')}`,\n\t\t\tclassName: 'float-left btn btn-success',\n\t\t\tcallback() {\n\t\t\t\tthisInstance.download(fileInfo.hash);\n\t\t\t}\n\t\t};\n\t\tbootboxOptions.buttons.Close = {\n\t\t\tlabel: `<i class=\"fa fa-times\"></i> ${app.vtranslate('JS_CLOSE')}`,\n\t\t\tclassName: 'btn btn-warning',\n\t\t\tcallback: () => {}\n\t\t};\n\t\tbootbox.dialog(bootboxOptions);\n\t\tif (this.options.showCarousel) {\n\t\t\t$(`#bootbox-title-${hash}`).css({\n\t\t\t\t'animation-duration': '350ms'\n\t\t\t});\n\t\t\t$(`#carousel-${hash}`).on('slide.bs.carousel', e => {\n\t\t\t\tfileInfo = this.getFileInfo($(e.relatedTarget).data('hash'));\n\t\t\t\tconst aniIn = this.options.zoomTitleAnimation.in;\n\t\t\t\tconst aniOut = this.options.zoomTitleAnimation.out;\n\t\t\t\t$(`#bootbox-title-${hash}`).animateCss(aniOut, () => {\n\t\t\t\t\t$(`#bootbox-title-${hash}`)\n\t\t\t\t\t\t.html(titleTemplate())\n\t\t\t\t\t\t.removeClass('animated ' + aniOut)\n\t\t\t\t\t\t.animateCss(aniIn);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Remove file from preview and from file list\n\t *\n\t * @param {String} hash\n\t */\n\tdeleteFileCallback(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tfileInfo.previewElement.popover('dispose').remove();\n\t\tthis.files = this.files.filter(file => file.hash !== fileInfo.hash);\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Delete image from input field\n\t * Should be called with this pointing on button element with data-hash attribute\n\t *\n\t * @param {string} hash\n\t * @param {boolean} showConfirmation - dialog?\n\t */\n\tdeleteFile(hash, showConfirmation = true) {\n\t\tif (showConfirmation) {\n\t\t\tconst fileInfo = this.getFileInfo(hash);\n\t\t\tbootbox.confirm({\n\t\t\t\ttitle: `<i class=\"fa fa-trash-alt\"></i> ${app.vtranslate('JS_DELETE_FILE')}`,\n\t\t\t\tmessage: `${app.vtranslate('JS_DELETE_FILE_CONFIRMATION')} <span class=\"font-weight-bold\">${\n\t\t\t\t\tfileInfo.name\n\t\t\t\t}</span>?`,\n\t\t\t\tcallback: result => {\n\t\t\t\t\tif (result) {\n\t\t\t\t\t\tthis.deleteFileCallback(hash);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.deleteFileCallback(hash);\n\t\t}\n\t}\n\n\t/**\n\t * File change event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {object} data\n\t */\n\tchange(e, data) {\n\t\tdata.files = this.filterValidFiles(data.files);\n\t\tdata.files = this.setFilesHash(data.files);\n\t\tthis.dragLeave(e);\n\t\tif (data.files.length) {\n\t\t\tthis.generatePreviewElements(data.files, element => {\n\t\t\t\tthis.redraw();\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Generate and apply popover to preview\n\t *\n\t * @param {File} file\n\t * @param {string} template\n\t * @param {string} imageSrc\n\t * @returns {jQuery}\n\t */\n\taddPreviewPopover(file, template, imageSrc) {\n\t\tconst thisInstance = this;\n\t\tlet fileSize = '';\n\t\tconst fileInfo = this.getFileInfo(file.hash);\n\t\tif (typeof fileInfo.size !== 'undefined') {\n\t\t\tfileSize = `<div class=\"p-1 bg-white border rounded small position-absolute\">${fileInfo.size}</div>`;\n\t\t}\n\t\tlet deleteBtn = '';\n\t\tif (!this.detailView) {\n\t\t\tdeleteBtn = `<button class=\"btn btn-sm btn-danger c-btn-collapsible js-multi-image__popover-btn-delete\" type=\"button\" data-hash=\"${\n\t\t\t\tfile.hash\n\t\t\t}\" data-js=\"click\"><i class=\"fa fa-trash-alt\"></i> <span class=\"c-btn-collapsible__text\">${app.vtranslate(\n\t\t\t\t'JS_DELETE'\n\t\t\t)}</span></button>`;\n\t\t}\n\t\treturn $(template).popover({\n\t\t\tcontainer: thisInstance.elements.component,\n\t\t\ttitle: `<div class=\"u-text-ellipsis\"><i class=\"fa fa-image\"></i> ${file.name}</div>`,\n\t\t\thtml: true,\n\t\t\tsanitize: false,\n\t\t\ttrigger: 'focus',\n\t\t\tplacement: 'top',\n\t\t\tcontent: `<img src=\"${imageSrc}\" class=\"w-100 js-multi-image__popover-img c-multi-image__popover-img\" data-hash=\"${\n\t\t\t\tfile.hash\n\t\t\t}\" data-js=\"click\"/>`,\n\t\t\ttemplate: `<div class=\"popover\" role=\"tooltip\">\n\t\t\t\t<div class=\"arrow\"></div>\n\t\t\t\t<h3 class=\"popover-header\"></h3>\n\t\t\t\t<div class=\"popover-body\"></div>\n\t\t\t\t<div class=\"text-right popover-footer js-multi-image__popover-actions\">\n\t\t\t\t\t${fileSize}\n\t\t\t\t\t${deleteBtn}\n\t\t\t\t\t<button class=\"btn btn-sm btn-success c-btn-collapsible js-multi-image__popover-btn-download\" type=\"button\" data-hash=\"${\n\t\t\t\t\t\tfile.hash\n\t\t\t\t\t}\" data-js=\"click\"><i class=\"fa fa-download\"></i> <span class=\"c-btn-collapsible__text\">${app.vtranslate(\n\t\t\t\t'JS_DOWNLOAD'\n\t\t\t)}</span></button>\n\t\t\t\t\t<button class=\"btn btn-sm btn-primary c-btn-collapsible js-multi-image__popover-btn-zoom\" type=\"button\" data-hash=\"${\n\t\t\t\t\t\tfile.hash\n\t\t\t\t\t}\" data-js=\"click\"><i class=\"fa fa-search-plus\"></i> <span class=\"c-btn-collapsible__text\">${app.vtranslate(\n\t\t\t\t'JS_ZOOM_IN'\n\t\t\t)}</span></button>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t});\n\t}\n\n\t/**\n\t * Remove preview popover\n\t *\n\t * @param {String} hash\n\t */\n\tremovePreviewPopover(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tif (typeof fileInfo.previewElement !== 'undefined') {\n\t\t\tfileInfo.previewElement.popover('dispose');\n\t\t}\n\t}\n\n\t/**\n\t * Hide popovers when user starts moving file preview\n\t *\n\t * @param {Event} e\n\t * @param {Object} ui\n\t */\n\tsortOver(e, ui) {\n\t\tthis.elements.result.find('.js-multi-image__preview').popover('hide');\n\t}\n\n\t/**\n\t * Update file position according to elements order\n\t *\n\t * @param {Event} e\n\t * @param {Object} ui\n\t */\n\tsortStop(e, ui) {\n\t\tconst actualElements = this.elements.result.find('.js-multi-image__preview').toArray();\n\t\tthis.files = actualElements.map(element => {\n\t\t\tfor (let i = 0, len = this.files.length; i < len; i++) {\n\t\t\t\tconst elementHash = $(element).data('hash');\n\t\t\t\tif (this.files[i].hash === elementHash) {\n\t\t\t\t\treturn this.files[i];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.redraw();\n\t}\n\n\t/**\n\t * Redraw view according to in-memory positions\n\t */\n\tredraw() {\n\t\tthis.files.forEach(file => {\n\t\t\tthis.elements.result.append(file.previewElement);\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Enable drag and drop files repositioning\n\t */\n\tenableDragNDrop() {\n\t\tthis.elements.result\n\t\t\t.sortable({\n\t\t\t\thandle: '.js-multi-image__preview-img',\n\t\t\t\titems: '.js-multi-image__preview',\n\t\t\t\tover: this.sortOver.bind(this),\n\t\t\t\tstop: this.sortStop.bind(this)\n\t\t\t})\n\t\t\t.disableSelection()\n\t\t\t.on('mousedown', '.js-multi-image__preview-img', function(e) {\n\t\t\t\tthis.focus(); // focus to show popover\n\t\t\t});\n\t}\n\n\t/**\n\t * Generate preview of images and append to multi image results view\n\t *\n\t * @param {Array} files - array of Files\n\t * @param {function} callback\n\t */\n\tgeneratePreviewElements(files, callback) {\n\t\tfiles.forEach(file => {\n\t\t\tif (file instanceof File) {\n\t\t\t\tthis.generatePreviewFromFile(file, (template, imageSrc) => {\n\t\t\t\t\tfile.preview = this.addPreviewPopover(file, template, imageSrc);\n\t\t\t\t\tthis.addFileInfoProperty(file.hash, 'previewElement', file.preview);\n\t\t\t\t\tcallback(file.preview);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.generatePreviewFromValue(file, (template, imageSrc) => {\n\t\t\t\t\tfile.preview = this.addPreviewPopover(file, template, imageSrc);\n\t\t\t\t\tthis.addFileInfoProperty(file.hash, 'previewElement', file.preview);\n\t\t\t\t\tcallback(file.preview);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Generate preview of image as html string\n\t *\n\t * @param {File} file\n\t * @param {function} callback\n\t */\n\tgeneratePreviewFromFile(file, callback) {\n\t\tconst fr = new FileReader();\n\t\tfr.onload = () => {\n\t\t\tfile.imageSrc = fr.result;\n\t\t\tthis.addFileInfoProperty(file.hash, 'imageSrc', file.imageSrc);\n\t\t\tcallback(\n\t\t\t\t`<div class=\"d-inline-block mr-1 js-multi-image__preview\" id=\"js-multi-image__preview-hash-${\n\t\t\t\t\tfile.hash\n\t\t\t\t}\" data-hash=\"${file.hash}\" data-js=\"container|click\">\n\t\t\t\t\t<div class=\"img-thumbnail js-multi-image__preview-img c-multi-image__preview-img\" data-hash=\"${\n\t\t\t\t\t\tfile.hash\n\t\t\t\t\t}\" data-js=\"drag\" style=\"background-image:url(${fr.result})\" tabindex=\"0\" title=\"${file.name}\"></div>\n\t\t\t</div>`,\n\t\t\t\tfr.result\n\t\t\t);\n\t\t};\n\t\tfr.readAsDataURL(file);\n\t}\n\n\t/**\n\t * Generate preview of image as html string from existing values\n\t *\n\t * @param {File} file\n\t * @param {function} callback\n\t */\n\tgeneratePreviewFromValue(file, callback) {\n\t\tcallback(\n\t\t\t`<div class=\"d-inline-block mr-1 js-multi-image__preview\" id=\"js-multi-image__preview-hash-${\n\t\t\t\tfile.hash\n\t\t\t}\" data-hash=\"${file.hash}\" data-js=\"container|click\">\n\t\t\t\t<div class=\"img-thumbnail js-multi-image__preview-img c-multi-image__preview-img\" data-hash=\"${\n\t\t\t\t\tfile.hash\n\t\t\t\t}\" data-js=\"drag\" style=\"background-image:url(${file.imageSrc})\" tabindex=\"0\" title=\"${file.name}\"></div>\n\t\t</div>`,\n\t\t\tfile.imageSrc\n\t\t);\n\t}\n\n\t/**\n\t * Load files that were in valueInput as json string\n\t */\n\tloadExistingFiles() {\n\t\tthis.files = this.files\n\t\t\t.map(file => {\n\t\t\t\tfile.hash = App.Fields.Text.generateRandomHash(CONFIG.userId);\n\t\t\t\treturn file;\n\t\t\t})\n\t\t\t.slice(0, this.options.limit);\n\t\tthis.generatePreviewElements(this.files, element => {\n\t\t\tthis.elements.result.append(element);\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Generate carousel for all files in large preview\n\t *\n\t * @param {String} hash\n\t */\n\tgenerateCarousel(hash) {\n\t\tif (this.files.length <= 1) {\n\t\t\tconst fileInfo = this.getFileInfo(hash);\n\t\t\treturn `<img class=\"d-block w-100\" src=\"${fileInfo.imageSrc}\">`;\n\t\t}\n\t\tlet template = `<div id=\"carousel-${hash}\" class=\"carousel slide c-carousel\" data-ride=\"carousel\" data-js=\"container\">\n\t\t  <div class=\"carousel-inner\">`;\n\t\tthis.files.forEach(file => {\n\t\t\ttemplate += `<div class=\"carousel-item c-carousel__item`;\n\t\t\tif (file.hash === hash) {\n\t\t\t\ttemplate += ` active`;\n\t\t\t}\n\t\t\ttemplate += `\" data-hash=\"${file.hash}\">\n\t\t      <img class=\"d-block w-100 c-carousel__image\" src=\"${file.imageSrc}\">\n\t\t    </div>`;\n\t\t});\n\t\ttemplate += `<a class=\"carousel-control-prev c-carousel__prevnext-btn c-carousel__prev-btn\" href=\"#carousel-${hash}\" role=\"button\" data-slide=\"prev\" data-js=\"click\">\n\t\t    <span class=\"fas fa-caret-left fa-2x c-carousel__prev-icon mr-1\" aria-hidden=\"true\"></span>\n\t\t  </a>\n\t\t  <a class=\"carousel-control-next c-carousel__prevnext-btn c-carousel__next-btn\" href=\"#carousel-${hash}\" role=\"button\" data-slide=\"next\" data-js=\"click\">\n\t\t    <span class=\"fas fa-caret-right fa-2x c-carousel__next-icon ml-1\" aria-hidden=\"true\"></span>\n\t\t  </a>\n\t\t</div>`;\n\t\treturn template;\n\t}\n}\n"],"names":["MultiImage","element","thisInstance","this","elements","options","detailView","fileInput","find","eq","length","component","form","closest","on","onFormSubmit","addButton","values","progressBar","progress","result","fieldInfo","data","formats","limit","files","JSON","parse","val","detach","click","addButtonClick","bind","fileupload","submit","add","progressAll","change","dragOver","uploadError","uploadSuccess","dragLeave","$","enableDragNDrop","e","zoomPreview","preventDefault","download","deleteFile","loadExistingFiles","fn","animateCss","extend","animationName","callback","animationEnd","el","animations","t","undefined","style","document","createElement","addClass","one","removeClass","App","Fields","currentFileUploads","stopPropagation","stopImmediatePropagation","alert","app","vtranslate","trigger","formData","hash","i","len","file","errorLog","showPnotify","text","propertyName","value","fileInfo","getFileInfo","jqXHR","responseJSON","Vtiger_Helper_Js","response","attach","Array","isArray","forEach","fileAttach","error","name","updateFormValues","Error","key","_this2","info","type","addFileInfoProperty","size","removePreviewPopover","addPreviewPopover","previewElement","imageSrc","formValues","map","stringify","valid","format","join","showLimitError","filter","_this3","validateFile","addedFiles","Text","generateRandomHash","CONFIG","userId","push","parseInt","loaded","total","css","width","substr","toLowerCase","downloadFile","downloadBase64","link","body","appendChild","href","removeChild","replace","imageUrl","split","titleTemplate","bootboxOptions","zoomTitleAnimation","in","showCarousel","message","generateCarousel","buttons","Delete","Download","Close","dialog","_this5","relatedTarget","aniIn","aniOut","out","html","popover","remove","showConfirmation","confirm","deleteFileCallback","filterValidFiles","setFilesHash","generatePreviewElements","redraw","template","fileSize","deleteBtn","ui","actualElements","toArray","_this8","elementHash","append","sortable","sortOver","sortStop","disableSelection","focus","File","generatePreviewFromFile","preview","_this10","generatePreviewFromValue","fr","FileReader","onload","readAsDataURL","slice"],"mappings":"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"}