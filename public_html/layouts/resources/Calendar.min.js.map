{"version":3,"file":"Calendar.min.js","sources":["Calendar.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n/** Class representing a calendar. */\nwindow.Calendar_Js = class {\n\t/**\n\t * Create calendar's options.\n\t * @param {jQuery} container\n\t * @param {bool} readonly\n\t */\n\tconstructor(container = $('.js-base-container'), readonly = false) {\n\t\tthis.calendarView = false;\n\t\tthis.calendarCreateView = false;\n\t\tthis.container = container;\n\t\tthis.readonly = readonly;\n\t\tthis.browserHistoryConfig = readonly ? {} : this.setBrowserHistoryOptions();\n\t\tthis.calendarOptions = this.setCalendarOptions();\n\t\tthis.eventTypeKeyName = false;\n\t}\n\n\t/**\n\t * Set calendar's options.\n\t * @returns {object}\n\t */\n\tsetCalendarOptions() {\n\t\treturn Object.assign(this.setCalendarBasicOptions(), this.setCalendarAdvancedOptions(), this.setCalendarModuleOptions(), this.browserHistoryConfig);\n\t}\n\n\t/**\n\t * Set calendar's basic options.\n\t * @returns {object}\n\t */\n\tsetCalendarBasicOptions() {\n\t\tlet eventLimit = app.getMainParams('eventLimit'),\n\t\t\tuserDefaultActivityView = app.getMainParams('activity_view'),\n\t\t\tdefaultView = app.moduleCacheGet('defaultView'),\n\t\t\tuserDefaultTimeFormat = CONFIG.hourFormat;\n\t\tif (eventLimit == 'true') {\n\t\t\teventLimit = true;\n\t\t} else if (eventLimit == 'false') {\n\t\t\teventLimit = false;\n\t\t} else {\n\t\t\teventLimit = parseInt(eventLimit) + 1;\n\t\t}\n\t\tif (userDefaultActivityView === 'Today') {\n\t\t\tuserDefaultActivityView = app.getMainParams('dayView');\n\t\t} else if (userDefaultActivityView === 'This Week') {\n\t\t\tuserDefaultActivityView = app.getMainParams('weekView');\n\t\t} else {\n\t\t\tuserDefaultActivityView = 'month';\n\t\t}\n\t\tif (defaultView != null) {\n\t\t\tuserDefaultActivityView = defaultView;\n\t\t}\n\t\tif (userDefaultTimeFormat == 24) {\n\t\t\tuserDefaultTimeFormat = 'H:mm';\n\t\t} else {\n\t\t\tuserDefaultTimeFormat = 'h:mmt';\n\t\t}\n\t\tlet options = {\n\t\t\ttimeFormat: userDefaultTimeFormat,\n\t\t\tslotLabelFormat: userDefaultTimeFormat,\n\t\t\tdefaultView: userDefaultActivityView,\n\t\t\tslotMinutes: 15,\n\t\t\tdefaultEventMinutes: 0,\n\t\t\tforceEventDuration: true,\n\t\t\tdefaultTimedEventDuration: '01:00:00',\n\t\t\teventLimit: eventLimit,\n\t\t\teventLimitText: app.vtranslate('JS_MORE'),\n\t\t\tselectHelper: true,\n\t\t\tscrollTime: app.getMainParams('startHour') + ':00',\n\t\t\tmonthNamesShort: [app.vtranslate('JS_JAN'), app.vtranslate('JS_FEB'), app.vtranslate('JS_MAR'),\n\t\t\t\tapp.vtranslate('JS_APR'), app.vtranslate('JS_MAY'), app.vtranslate('JS_JUN'), app.vtranslate('JS_JUL'),\n\t\t\t\tapp.vtranslate('JS_AUG'), app.vtranslate('JS_SEP'), app.vtranslate('JS_OCT'), app.vtranslate('JS_NOV'),\n\t\t\t\tapp.vtranslate('JS_DEC')],\n\t\t\tdayNames: [app.vtranslate('JS_SUNDAY'), app.vtranslate('JS_MONDAY'), app.vtranslate('JS_TUESDAY'),\n\t\t\t\tapp.vtranslate('JS_WEDNESDAY'), app.vtranslate('JS_THURSDAY'), app.vtranslate('JS_FRIDAY'),\n\t\t\t\tapp.vtranslate('JS_SATURDAY')],\n\t\t\tbuttonText: {\n\t\t\t\ttoday: app.vtranslate('JS_CURRENT'),\n\t\t\t\tyear: app.vtranslate('JS_YEAR'),\n\t\t\t\tmonth: app.vtranslate('JS_MONTH'),\n\t\t\t\tweek: app.vtranslate('JS_WEEK'),\n\t\t\t\tday: app.vtranslate('JS_DAY')\n\t\t\t},\n\t\t\tallDayText: app.vtranslate('JS_ALL_DAY'),\n\t\t};\n\t\tif (app.moduleCacheGet('start') !== null) {\n\t\t\tlet s = moment(app.moduleCacheGet('start')).valueOf();\n\t\t\tlet e = moment(app.moduleCacheGet('end')).valueOf();\n\t\t\toptions.defaultDate = moment(moment(s + ((e - s) / 2)).format('YYYY-MM-DD'));\n\t\t}\n\t\treturn Object.assign(this.setCalendarMinimalOptions(), options);\n\t}\n\n\t/**\n\t * Set calendar's minimal options.\n\t * @returns {object}\n\t */\n\tsetCalendarMinimalOptions() {\n\t\tlet hiddenDays = [];\n\t\tif (app.getMainParams('switchingDays') === 'workDays') {\n\t\t\thiddenDays = app.getMainParams('hiddenDays', true);\n\t\t}\n\t\treturn {\n\t\t\tfirstDay: CONFIG.firstDayOfWeekNo,\n\t\t\tselectable: true,\n\t\t\thiddenDays: hiddenDays,\n\t\t\tmonthNames: [app.vtranslate('JS_JANUARY'), app.vtranslate('JS_FEBRUARY'), app.vtranslate('JS_MARCH'),\n\t\t\t\tapp.vtranslate('JS_APRIL'), app.vtranslate('JS_MAY'), app.vtranslate('JS_JUNE'), app.vtranslate('JS_JULY'),\n\t\t\t\tapp.vtranslate('JS_AUGUST'), app.vtranslate('JS_SEPTEMBER'), app.vtranslate('JS_OCTOBER'),\n\t\t\t\tapp.vtranslate('JS_NOVEMBER'), app.vtranslate('JS_DECEMBER')],\n\t\t\tdayNamesShort: [app.vtranslate('JS_SUN'), app.vtranslate('JS_MON'), app.vtranslate('JS_TUE'),\n\t\t\t\tapp.vtranslate('JS_WED'), app.vtranslate('JS_THU'), app.vtranslate('JS_FRI'),\n\t\t\t\tapp.vtranslate('JS_SAT')],\n\t\t};\n\t}\n\n\t/**\n\t * Set calendar's advanced options.\n\t * @returns {object}\n\t */\n\tsetCalendarAdvancedOptions() {\n\t\tlet self = this;\n\t\treturn {\n\t\t\theader: {\n\t\t\t\tleft: 'month,' + app.getMainParams('weekView') + ',' + app.getMainParams('dayView'),\n\t\t\t\tcenter: 'title today',\n\t\t\t\tright: 'prev,next'\n\t\t\t},\n\t\t\tallDaySlot: app.getMainParams('allDaySlot'),\n\t\t\tviews: {\n\t\t\t\tbasic: {\n\t\t\t\t\teventLimit: false,\n\t\t\t\t}\n\t\t\t},\n\t\t\teventDrop: function (event, delta, revertFunc) {\n\t\t\t\tself.updateEvent(event, delta, revertFunc);\n\t\t\t},\n\t\t\teventResize: function (event, delta, revertFunc) {\n\t\t\t\tself.updateEvent(event, delta, revertFunc);\n\t\t\t},\n\t\t\tviewRender: function () {\n\t\t\t\tself.loadCalendarData();\n\t\t\t},\n\t\t\teventRender: self.eventRenderer,\n\t\t\theight: this.setCalendarHeight(this.container)\n\t\t}\n\t}\n\n\t/**\n\t * Update calendar's event.\n\t * @param {Object} event\n\t * @param {Object} delta\n\t * @param {Object} revertFunc\n\t */\n\tupdateEvent(event, delta, revertFunc) {\n\t\tlet progressInstance = jQuery.progressIndicator({blockInfo: {enabled: true}});\n\t\tlet start = event.start.format();\n\t\tlet params = {\n\t\t\tmodule: CONFIG.module,\n\t\t\taction: 'Calendar',\n\t\t\tmode: 'updateEvent',\n\t\t\tid: event.id,\n\t\t\tstart: start,\n\t\t\tdelta: delta._data,\n\t\t\tallDay: event.allDay\n\t\t};\n\t\tAppConnector.request(params).done(function (response) {\n\t\t\tif (!response['result']) {\n\t\t\t\tVtiger_Helper_Js.showPnotify(app.vtranslate('JS_NO_EDIT_PERMISSION'));\n\t\t\t\trevertFunc();\n\t\t\t}\n\t\t\tprogressInstance.progressIndicator({'mode': 'hide'});\n\t\t}).fail(function () {\n\t\t\tprogressInstance.progressIndicator({'mode': 'hide'});\n\t\t\tVtiger_Helper_Js.showPnotify(app.vtranslate('JS_NO_EDIT_PERMISSION'));\n\t\t\trevertFunc();\n\t\t});\n\t}\n\n\t/**\n\t * Render event.\n\t * @param {Object} event\n\t * @param {jQuery} element\n\t */\n\teventRenderer(event, element) {\n\t\telement.find('.fc-title').html(event.title);\n\t\tif (event.rendering === 'background') {\n\t\t\telement.append(`<span class=\"js-popover-text d-block\"><span class=\"${event.icon} js-popover-icon mr-1\"></span>${event.title}</span>`);\n\t\t\telement.addClass('js-popover-tooltip--ellipsis').attr('data-content', event.title);\n\t\t\tapp.registerPopoverEllipsis(element);\n\t\t}\n\t}\n\n\t/**\n\t * Returns counted calendar height.\n\t * @returns {(number|string)}\n\t */\n\tsetCalendarHeight() {\n\t\tlet calendarH;\n\t\tif ($(window).width() > 993) {\n\t\t\tlet calendarContainer = this.container.find('.js-calendar__container'),\n\t\t\t\tcalendarPadding;\n\t\t\tif (this.container.hasClass('js-modal-container')) {\n\t\t\t\tcalendarPadding = this.container.find('.js-modal-header').outerHeight(); // modal needs bigger padding to prevent modal's scrollbar\n\t\t\t} else {\n\t\t\t\tcalendarPadding = this.container.find('.js-contents-div').css('margin-left').replace('px', ''); //equals calendar padding bottom to left margin\n\t\t\t}\n\t\t\tlet setCalendarH = () => {\n\t\t\t\treturn $(window).height() - this.container.find('.js-calendar__container').offset().top - $('.js-footer').height() - calendarPadding;\n\t\t\t};\n\t\t\tcalendarH = setCalendarH();\n\t\t\tnew ResizeSensor(this.container.find('.contentsDiv'), () => {\n\t\t\t\tcalendarContainer.fullCalendar('option', 'height', setCalendarH());\n\t\t\t\tcalendarContainer.height(calendarH + 10); // without this line calendar scroll stops working\n\t\t\t});\n\t\t} else if ($(window).width() < 993) {\n\t\t\tcalendarH = 'auto';\n\t\t}\n\t\treturn calendarH;\n\t}\n\n\t/**\n\t * Set calendar module's options.\n\t * @returns {object}\n\t */\n\tsetCalendarModuleOptions() {\n\t\treturn {};\n\t}\n\n\t/**\n\t * Set calendar options from browser history.\n\t * @returns {object}\n\t */\n\tsetBrowserHistoryOptions() {\n\t\tlet historyParams = app.getMainParams('historyParams', true),\n\t\t\toptions = null;\n\t\tif (historyParams && (historyParams.length || Object.keys(historyParams).length)) {\n\t\t\toptions = {\n\t\t\t\tstart: historyParams.start,\n\t\t\t\tend: historyParams.end,\n\t\t\t\tuser: historyParams.user.split(\",\").map((x) => {\n\t\t\t\t\treturn parseInt(x)\n\t\t\t\t}),\n\t\t\t\ttime: historyParams.time,\n\t\t\t\thiddenDays: historyParams.hiddenDays.split(\",\").map((x) => {\n\t\t\t\t\tlet parsedValue = parseInt(x);\n\t\t\t\t\treturn isNaN(parsedValue) ? '' : parsedValue;\n\t\t\t\t}),\n\t\t\t\tcvid: historyParams.cvid,\n\t\t\t\tdefaultView: historyParams.viewType\n\t\t\t};\n\t\t\tlet dateFormat = CONFIG.dateFormat.toUpperCase();\n\t\t\tlet s = moment(options.start, dateFormat).valueOf();\n\t\t\tlet e = moment(options.end, dateFormat).valueOf();\n\t\t\toptions.defaultDate = moment(moment(s + ((e - s) / 2)).format('YYYY-MM-DD'));\n\t\t\tObject.keys(options).forEach(key => options[key] === 'undefined' && delete options[key]);\n\t\t\tapp.moduleCacheSet('browserHistoryEvent', false);\n\t\t\tapp.setMainParams('showType', options.time);\n\t\t\tapp.setMainParams('usersId', options.user);\n\t\t\tapp.setMainParams('defaultView', options.defaultView);\n\t\t}\n\t\twindow.addEventListener('popstate', function (event) {\n\t\t\tapp.moduleCacheSet('browserHistoryEvent', true)\n\t\t}, false);\n\t\treturn options;\n\t}\n\n\t/**\n\t * Register events.\n\t * @returns {object}\n\t */\n\tregisterEvents() {\n\t\tthis.renderCalendar();\n\t\tthis.registerSitebarEvents();\n\t\tthis.registerButtonSelectAll();\n\t\tthis.registerAddButton();\n\t}\n\n\t/**\n\t * Invokes fullcalendar with options.\n\t */\n\trenderCalendar() {\n\t\tthis.getCalendarView().fullCalendar(this.calendarOptions);\n\t}\n\n\t/**\n\t * Register sitebar events.\n\t */\n\tregisterSitebarEvents() {\n\t\t$('.bodyContents').on('Vtiger.Widget.Load.undefined', () => {\n\t\t\tthis.registerSelect2Event();\n\t\t});\n\t}\n\n\t/**\n\t * Load calendar data\n\t */\n\tloadCalendarData() {\n\t\tconst defaultParams = this.getDefaultParams();\n\t\tthis.getCalendarView().fullCalendar('removeEvents');\n\t\tif (!defaultParams.emptyFilters) {\n\t\t\tconst progressInstance = $.progressIndicator();\n\t\t\tAppConnector.request(defaultParams).done((events) => {\n\t\t\t\tthis.getCalendarView().fullCalendar('addEventSource', events.result);\n\t\t\t\tprogressInstance.hide();\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Default params\n\t * @returns {{module: *, action: string, mode: string, start: *, end: *, user: *, emptyFilters: boolean}}\n\t */\n\tgetDefaultParams() {\n\t\tlet formatDate = CONFIG.dateFormat.toUpperCase(),\n\t\t\tview = this.getCalendarView().fullCalendar('getView'),\n\t\t\tusers = app.moduleCacheGet('calendar-users') || CONFIG.userId;\n\t\tlet params = {\n\t\t\tmodule: CONFIG.module,\n\t\t\taction: 'Calendar',\n\t\t\tmode: 'getEvents',\n\t\t\tstart: view.start.format(formatDate),\n\t\t\tend: view.end.format(formatDate),\n\t\t\tuser: users,\n\t\t\temptyFilters: users.length === 0\n\t\t}\n\t\tif (app.moduleCacheGet('calendar-types')) {\n\t\t\tparams.types = app.moduleCacheGet('calendar-types');\n\t\t\tparams.emptyFilters = users.length === 0 || params.types.length === 0;\n\t\t} else {\n\t\t\tparams.types = [];\n\t\t}\n\t\treturn params;\n\t}\n\n\t/**\n\t * Register select2 event.\n\t */\n\tregisterSelect2Event() {\n\t\tlet self = this;\n\t\t$('.siteBarRight .js-calendar__filter__select').each(function () {\n\t\t\tlet element = $(this);\n\t\t\tlet name = element.data('cache');\n\t\t\tlet cachedValue = app.moduleCacheGet(name);\n\t\t\tif (element.length > 0 && cachedValue !== undefined) {\n\t\t\t\tif (element.prop('tagName') == 'SELECT') {\n\t\t\t\t\telement.val(cachedValue);\n\t\t\t\t}\n\t\t\t} else if (element.length > 0 && cachedValue === undefined && !element.find(':selected').length) {\n\t\t\t\tlet allOptions = [];\n\t\t\t\telement.find('option').each((i, option) => {\n\t\t\t\t\tallOptions.push($(option).val());\n\t\t\t\t});\n\t\t\t\telement.val(allOptions);\n\t\t\t\tapp.moduleCacheSet(name, cachedValue);\n\t\t\t}\n\t\t});\n\t\tlet selectsElements = $('.siteBarRight .select2, .siteBarRight .filterField');\n\t\tselectsElements.off('change');\n\t\tApp.Fields.Picklist.showSelect2ElementView(selectsElements);\n\t\tselectsElements.on('change', function () {\n\t\t\tlet element = $(this);\n\t\t\tlet value = element.val();\n\t\t\tif (value == null) {\n\t\t\t\tvalue = '';\n\t\t\t}\n\t\t\tif (element.attr('type') == 'checkbox') {\n\t\t\t\tvalue = element.is(':checked');\n\t\t\t}\n\t\t\tapp.moduleCacheSet(element.data('cache'), value);\n\t\t\tself.loadCalendarData();\n\t\t});\n\t}\n\n\t/**\n\t * Register button select all.\n\t */\n\tregisterButtonSelectAll() {\n\t\tlet selectBtn = $('.selectAllBtn');\n\t\tselectBtn.on('click', function (e) {\n\t\t\tlet selectAllLabel = $(this).find('.selectAll');\n\t\t\tlet deselectAllLabel = $(this).find('.deselectAll');\n\t\t\tif (selectAllLabel.hasClass('d-none')) {\n\t\t\t\tselectAllLabel.removeClass('d-none');\n\t\t\t\tdeselectAllLabel.addClass('d-none');\n\t\t\t\t$(this).closest('.quickWidget').find('select option').prop(\"selected\", false);\n\t\t\t} else {\n\t\t\t\t$(this).closest('.quickWidget').find('select option').prop(\"selected\", true);\n\t\t\t\tdeselectAllLabel.removeClass('d-none');\n\t\t\t\tselectAllLabel.addClass('d-none');\n\t\t\t}\n\t\t\t$(this).closest('.quickWidget').find('select').trigger(\"change\");\n\t\t});\n\t}\n\n\t/**\n\t * Register add button.\n\t */\n\tregisterAddButton() {\n\t\tconst self = this;\n\t\t$('.js-add').on('click', (e) => {\n\t\t\tself.getCalendarCreateView().done((data) => {\n\t\t\t\tconst headerInstance = new Vtiger_Header_Js();\n\t\t\t\theaderInstance.handleQuickCreateData(data, {\n\t\t\t\t\tcallbackFunction: (data) => {\n\t\t\t\t\t\tself.addCalendarEvent(data.result);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Get calendar create view.\n\t * @returns {promise}\n\t */\n\tgetCalendarCreateView() {\n\t\tlet self = this;\n\t\tlet aDeferred = jQuery.Deferred();\n\n\t\tif (this.calendarCreateView !== false) {\n\t\t\taDeferred.resolve(this.calendarCreateView.clone(true, true));\n\t\t\treturn aDeferred.promise();\n\t\t}\n\t\tlet progressInstance = jQuery.progressIndicator();\n\t\tthis.loadCalendarCreateView().done(function (data) {\n\t\t\tprogressInstance.hide();\n\t\t\tself.calendarCreateView = data;\n\t\t\taDeferred.resolve(data.clone(true, true));\n\t\t}).fail(function () {\n\t\t\tprogressInstance.hide();\n\t\t});\n\t\treturn aDeferred.promise();\n\t}\n\n\t/**\n\t * Load calendar create view.\n\t * @returns {promise}\n\t */\n\tloadCalendarCreateView() {\n\t\tlet aDeferred = jQuery.Deferred();\n\t\tlet moduleName = app.getModuleName();\n\t\tlet url = 'index.php?module=' + moduleName + '&view=QuickCreateAjax';\n\t\tlet headerInstance = Vtiger_Header_Js.getInstance();\n\t\theaderInstance.getQuickCreateForm(url, moduleName).done(function (data) {\n\t\t\taDeferred.resolve(jQuery(data));\n\t\t}).fail(function (textStatus, errorThrown) {\n\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t});\n\t\treturn aDeferred.promise();\n\t}\n\n\t/**\n\t * Add event data to render.\n\t */\n\tgetEventRenderData(calendarDetails) {\n\t\tconst calendar = this.getCalendarView();\n\t\tconst eventObject = {\n\t\t\tid: calendarDetails._recordId,\n\t\t\ttitle: calendarDetails._recordLabel,\n\t\t\tstart: calendar.fullCalendar('moment', calendarDetails.date_start.value + ' ' + calendarDetails.time_start.value).format(),\n\t\t\tend: calendar.fullCalendar('moment', calendarDetails.due_date.value + ' ' + calendarDetails.time_end.value).format(),\n\t\t\tstart_display: calendarDetails.date_start.display_value + ' ' + calendarDetails.time_start.display_value,\n\t\t\tend_display: calendarDetails.due_date.display_value + ' ' + calendarDetails.time_end.display_value,\n\t\t\turl: `index.php?module=${CONFIG.module}&view=Detail&record=${calendarDetails._recordId}`,\n\t\t\tclassName: `js-popover-tooltip--record ownerCBg_${calendarDetails.assigned_user_id.value} picklistCBr_${CONFIG.module}_${$('.js-calendar__filter__select[data-cache=\"calendar-types\"]').length ? this.eventTypeKeyName + '_' + calendarDetails[this.eventTypeKeyName]['value'] : ''}`,\n\t\t\tallDay: typeof calendarDetails.allday === 'undefined' ? false : calendarDetails.allday.value == 'on'\n\t\t};\n\t\treturn eventObject;\n\t}\n\n\tisNewEventToDisplay(eventObject) {\n\t\tlet ownerSelects = $('.js-calendar__filter__select[data-cache=\"calendar-users\"]').add($('.js-calendar__filter__select[data-cache=\"calendar-groups\"]'));\n\t\tif ($.inArray(eventObject.assigned_user_id.value, ownerSelects.val()) < 0) {\n\t\t\tthis.refreshFilterValues(eventObject, ownerSelects);\n\t\t\treturn false;\n\t\t}\n\t\tlet calendarTypes = $('.js-calendar__filter__select[data-cache=\"calendar-types\"]');\n\t\tif (calendarTypes.length) {\n\t\t\tif (!this.eventTypeKeyName) {\n\t\t\t\tthis.setEventTypeKey(eventObject);\n\t\t\t}\n\t\t\tif ($.inArray(eventObject[this.eventTypeKeyName]['value'], calendarTypes.val()) < 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tsetEventTypeKey(eventObject) {\n\t\tlet self = this;\n\t\tObject.keys(eventObject).forEach(function (key, index) {\n\t\t\tif (key.endsWith('type')) { // there are different names for event types in modules\n\t\t\t\tself.eventTypeKeyName = key;\n\t\t\t}\n\t\t});\n\t}\n\n\trefreshFilterValues(eventObject, filtersValues) {\n\t\tif (CONFIG.searchShowOwnerOnlyInList) {\n\t\t\tlet allOptions = [];\n\t\t\tfiltersValues.find('option').each((i, option) => {\n\t\t\t\tallOptions.push($(option).val());\n\t\t\t});\n\t\t\tif ($.inArray(eventObject.assigned_user_id.value, allOptions) < 0) {\n\t\t\t\tAppConnector.request(`module=${CONFIG.module}&view=RightPanel&mode=getUsersList`).done((usersData) => {\n\t\t\t\t\tlet filterUsers = $('.js-calendar__filter--users');\n\t\t\t\t\tlet filterGroups = $('.js-calendar__filter--groups');\n\t\t\t\t\tfilterUsers.html(usersData);\n\t\t\t\t\tif (usersData) {\n\t\t\t\t\t\tfilterUsers.closest('.js-toggle-panel').removeClass('d-none');\n\t\t\t\t\t}\n\t\t\t\t\tif (filterGroups.length) {\n\t\t\t\t\t\tAppConnector.request(`module=${CONFIG.module}&view=RightPanel&mode=getGroupsList`).done((groupsData) => {\n\t\t\t\t\t\t\tfilterGroups.html(groupsData);\n\t\t\t\t\t\t\tif (groupsData) {\n\t\t\t\t\t\t\t\tfilterGroups.closest('.js-toggle-panel').removeClass('d-none');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.registerSelect2Event();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.registerSelect2Event();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Add calendar event.\n\t */\n\taddCalendarEvent(eventObject) {\n\t\tif (this.isNewEventToDisplay(eventObject)) {\n\t\t\tthis.getCalendarView().fullCalendar('renderEvent', this.getEventRenderData(eventObject));\n\t\t}\n\t}\n\n\t/**\n\t * Get calendar container.\n\t * @returns {(boolean|jQuery)}\n\t */\n\tgetCalendarView() {\n\t\tif (this.calendarView == false) {\n\t\t\tthis.calendarView = this.container.find('.js-calendar__container');\n\t\t}\n\t\treturn this.calendarView;\n\t}\n};\n\n/**\n *  Class representing a calendar with creating events by day click instead of selecting days.\n * @extends Calendar_Js\n */\nwindow.Calendar_Unselectable_Js = class extends Calendar_Js {\n\t/**\n\t * Set calendar module options.\n\t * @returns {{allDaySlot: boolean, dayClick: object, selectable: boolean}}\n\t */\n\tsetCalendarModuleOptions() {\n\t\tlet self = this;\n\t\treturn {\n\t\t\tallDaySlot: false,\n\t\t\tdayClick: function (date) {\n\t\t\t\tself.registerDayClickEvent(date.format());\n\t\t\t\tself.getCalendarView().fullCalendar('unselect');\n\t\t\t},\n\t\t\tselectable: false,\n\t\t\teditable: true\n\t\t};\n\t}\n\n\t/**\n\t * Register day click event.\n\t * @param {string} date\n\t */\n\tregisterDayClickEvent(date) {\n\t\tlet self = this;\n\t\tself.getCalendarCreateView().done(function (data) {\n\t\t\tif (data.length <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet dateFormat = data.find('[name=\"date_start\"]').data('dateFormat').toUpperCase(),\n\t\t\t\ttimeFormat = data.find('[name=\"time_start\"]').data('format'),\n\t\t\t\tdefaultTimeFormat = 'hh:mm A';\n\t\t\tif (timeFormat == 24) {\n\t\t\t\tdefaultTimeFormat = 'HH:mm';\n\t\t\t}\n\t\t\tlet startDateInstance = Date.parse(date);\n\t\t\tlet startDateString = moment(date).format(dateFormat);\n\t\t\tlet startTimeString = moment(date).format(defaultTimeFormat);\n\t\t\tlet endDateInstance = Date.parse(date);\n\t\t\tlet endDateString = moment(date).format(dateFormat);\n\n\t\t\tlet view = self.getCalendarView().fullCalendar('getView');\n\t\t\tlet endTimeString;\n\t\t\tif ('month' == view.name) {\n\t\t\t\tlet diffDays = parseInt((endDateInstance - startDateInstance) / (1000 * 60 * 60 * 24));\n\t\t\t\tif (diffDays > 1) {\n\t\t\t\t\tlet defaultFirstHour = app.getMainParams('startHour');\n\t\t\t\t\tlet explodedTime = defaultFirstHour.split(':');\n\t\t\t\t\tstartTimeString = explodedTime['0'];\n\t\t\t\t\tlet defaultLastHour = app.getMainParams('endHour');\n\t\t\t\t\texplodedTime = defaultLastHour.split(':');\n\t\t\t\t\tendTimeString = explodedTime['0'];\n\t\t\t\t} else {\n\t\t\t\t\tlet now = new Date();\n\t\t\t\t\tstartTimeString = moment(now).format(defaultTimeFormat);\n\t\t\t\t\tendTimeString = moment(now).add(15, 'minutes').format(defaultTimeFormat);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tendTimeString = moment(endDateInstance).add(30, 'minutes').format(defaultTimeFormat);\n\t\t\t}\n\t\t\tdata.find('[name=\"date_start\"]').val(startDateString);\n\t\t\tdata.find('[name=\"due_date\"]').val(endDateString);\n\t\t\tdata.find('[name=\"time_start\"]').val(startTimeString);\n\t\t\tdata.find('[name=\"time_end\"]').val(endTimeString);\n\n\t\t\tlet headerInstance = new Vtiger_Header_Js();\n\t\t\theaderInstance.handleQuickCreateData(data, {\n\t\t\t\tcallbackFunction(data) {\n\t\t\t\t\tself.addCalendarEvent(data.result, dateFormat);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n};\n"],"names":["window","Calendar_Js","$","readonly","calendarView","calendarCreateView","container","browserHistoryConfig","setBrowserHistoryOptions","calendarOptions","setCalendarOptions","eventTypeKeyName","assign","setCalendarBasicOptions","setCalendarAdvancedOptions","setCalendarModuleOptions","app","getMainParams","userDefaultActivityView","defaultView","moduleCacheGet","userDefaultTimeFormat","CONFIG","hourFormat","eventLimit","parseInt","timeFormat","slotLabelFormat","slotMinutes","defaultEventMinutes","forceEventDuration","defaultTimedEventDuration","eventLimitText","vtranslate","selectHelper","scrollTime","monthNamesShort","dayNames","buttonText","today","year","month","week","day","allDayText","moment","valueOf","e","options","defaultDate","s","format","setCalendarMinimalOptions","hiddenDays","firstDay","firstDayOfWeekNo","selectable","monthNames","dayNamesShort","header","left","center","right","allDaySlot","views","basic","eventDrop","event","delta","revertFunc","self","updateEvent","eventResize","viewRender","loadCalendarData","eventRender","eventRenderer","height","setCalendarHeight","jQuery","progressIndicator","blockInfo","enabled","start","params","module","action","mode","id","_data","allDay","AppConnector","request","done","response","Vtiger_Helper_Js","showPnotify","progressInstance","fail","element","find","html","title","rendering","append","icon","addClass","attr","registerPopoverEllipsis","calendarH","width","calendarContainer","calendarPadding","hasClass","outerHeight","css","replace","offset","top","setCalendarH","fullCalendar","historyParams","length","Object","keys","end","user","split","map","x","time","parsedValue","cvid","viewType","dateFormat","toUpperCase","forEach","key","moduleCacheSet","setMainParams","addEventListener","renderCalendar","registerSitebarEvents","registerButtonSelectAll","registerAddButton","getCalendarView","on","registerSelect2Event","defaultParams","getDefaultParams","emptyFilters","events","result","hide","view","users","userId","formatDate","types","each","name","data","cachedValue","prop","val","i","option","allOptions","push","selectsElements","off","App","Fields","Picklist","showSelect2ElementView","value","is","selectBtn","deselectAllLabel","selectAllLabel","removeClass","closest","trigger","getCalendarCreateView","headerInstance","handleQuickCreateData","callbackFunction","addCalendarEvent","aDeferred","Deferred","resolve","clone","promise","loadCalendarCreateView","moduleName","getModuleName","Vtiger_Header_Js","getInstance","getQuickCreateForm","textStatus","errorThrown","reject","calendarDetails","eventObject","_recordId","_recordLabel","calendar","date_start","time_start","due_date","time_end","start_display","display_value","end_display","url","className","assigned_user_id","allday","add","inArray","ownerSelects","refreshFilterValues","calendarTypes","setEventTypeKey","endsWith","filtersValues","searchShowOwnerOnlyInList","usersData","filterGroups","filterUsers","groupsData","isNewEventToDisplay","getEventRenderData","Calendar_Unselectable_Js","dayClick","date","registerDayClickEvent","editable","defaultTimeFormat","Date","parse","startDateString","startTimeString","endDateInstance","endDateString","endTimeString","startDateInstance","explodedTime","defaultFirstHour","defaultLastHour","now"],"mappings":"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"}