{"version":3,"file":"Calendar.min.js","sources":["Calendar.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n/** Class representing a calendar. */\nwindow.Calendar_Js = class {\n\t/**\n\t * Create calendar's options.\n\t * @param {jQuery} container\n\t * @param {bool} readonly\n\t */\n\tconstructor(container = $('.js-base-container'), readonly = false, browserHistory = true) {\n\t\tthis.calendarView = false;\n\t\tthis.calendarCreateView = false;\n\t\tthis.container = container;\n\t\tthis.readonly = readonly;\n\t\tthis.eventCreate = app.getMainParams('eventCreate');\n\t\tthis.eventEdit = app.getMainParams('eventEdit');\n\t\tthis.browserHistory = !readonly && browserHistory\n\t\tthis.browserHistoryConfig = this.browserHistory ? {} : this.setBrowserHistoryOptions();\n\t\tthis.calendarOptions = this.setCalendarOptions();\n\t\tthis.eventTypeKeyName = false;\n\t\tthis.module = app.getModuleName();\n\t}\n\n\t/**\n\t * Set calendar's options.\n\t * @returns {object}\n\t */\n\tsetCalendarOptions() {\n\t\treturn Object.assign(\n\t\t\tthis.setCalendarBasicOptions(),\n\t\t\tthis.setCalendarAdvancedOptions(),\n\t\t\tthis.setCalendarModuleOptions(),\n\t\t\tthis.browserHistoryConfig\n\t\t);\n\t}\n\n\t/**\n\t * Set calendar's basic options.\n\t * @returns {object}\n\t */\n\tsetCalendarBasicOptions() {\n\t\tlet eventLimit = app.getMainParams('eventLimit'),\n\t\t\tuserDefaultActivityView = app.getMainParams('activity_view'),\n\t\t\tdefaultView = app.moduleCacheGet('defaultView'),\n\t\t\tuserDefaultTimeFormat = CONFIG.hourFormat;\n\t\tif (eventLimit == 'true') {\n\t\t\teventLimit = true;\n\t\t} else if (eventLimit == 'false') {\n\t\t\teventLimit = false;\n\t\t} else {\n\t\t\teventLimit = parseInt(eventLimit) + 1;\n\t\t}\n\t\tif (userDefaultActivityView === 'Today') {\n\t\t\tuserDefaultActivityView = app.getMainParams('dayView');\n\t\t} else if (userDefaultActivityView === 'This Week') {\n\t\t\tuserDefaultActivityView = app.getMainParams('weekView');\n\t\t} else {\n\t\t\tuserDefaultActivityView = 'month';\n\t\t}\n\t\tif (defaultView != null) {\n\t\t\tuserDefaultActivityView = defaultView;\n\t\t}\n\t\tif (userDefaultTimeFormat == 24) {\n\t\t\tuserDefaultTimeFormat = 'H:mm';\n\t\t} else {\n\t\t\tuserDefaultTimeFormat = 'h:mmt';\n\t\t}\n\t\tlet options = {\n\t\t\ttimeFormat: userDefaultTimeFormat,\n\t\t\tslotLabelFormat: userDefaultTimeFormat,\n\t\t\tdefaultView: userDefaultActivityView,\n\t\t\tslotMinutes: 15,\n\t\t\tdefaultEventMinutes: 0,\n\t\t\tforceEventDuration: true,\n\t\t\tdefaultTimedEventDuration: '01:00:00',\n\t\t\teventLimit: eventLimit,\n\t\t\teventLimitText: app.vtranslate('JS_MORE'),\n\t\t\tselectHelper: true,\n\t\t\tscrollTime: app.getMainParams('startHour') + ':00',\n\t\t\tmonthNamesShort: [\n\t\t\t\tapp.vtranslate('JS_JAN'),\n\t\t\t\tapp.vtranslate('JS_FEB'),\n\t\t\t\tapp.vtranslate('JS_MAR'),\n\t\t\t\tapp.vtranslate('JS_APR'),\n\t\t\t\tapp.vtranslate('JS_MAY'),\n\t\t\t\tapp.vtranslate('JS_JUN'),\n\t\t\t\tapp.vtranslate('JS_JUL'),\n\t\t\t\tapp.vtranslate('JS_AUG'),\n\t\t\t\tapp.vtranslate('JS_SEP'),\n\t\t\t\tapp.vtranslate('JS_OCT'),\n\t\t\t\tapp.vtranslate('JS_NOV'),\n\t\t\t\tapp.vtranslate('JS_DEC')\n\t\t\t],\n\t\t\tdayNames: [\n\t\t\t\tapp.vtranslate('JS_SUNDAY'),\n\t\t\t\tapp.vtranslate('JS_MONDAY'),\n\t\t\t\tapp.vtranslate('JS_TUESDAY'),\n\t\t\t\tapp.vtranslate('JS_WEDNESDAY'),\n\t\t\t\tapp.vtranslate('JS_THURSDAY'),\n\t\t\t\tapp.vtranslate('JS_FRIDAY'),\n\t\t\t\tapp.vtranslate('JS_SATURDAY')\n\t\t\t],\n\t\t\tbuttonText: {\n\t\t\t\ttoday: app.vtranslate('JS_CURRENT'),\n\t\t\t\tyear: app.vtranslate('JS_YEAR'),\n\t\t\t\tmonth: app.vtranslate('JS_MONTH'),\n\t\t\t\tweek: app.vtranslate('JS_WEEK'),\n\t\t\t\tday: app.vtranslate('JS_DAY')\n\t\t\t},\n\t\t\tallDayText: app.vtranslate('JS_ALL_DAY')\n\t\t};\n\t\tif (app.moduleCacheGet('start') !== null) {\n\t\t\tlet s = moment(app.moduleCacheGet('start')).valueOf();\n\t\t\tlet e = moment(app.moduleCacheGet('end')).valueOf();\n\t\t\toptions.defaultDate = moment(moment(s + (e - s) / 2).format('YYYY-MM-DD'));\n\t\t}\n\t\treturn Object.assign(this.setCalendarMinimalOptions(), options);\n\t}\n\n\t/**\n\t * Converts the date format.\n\t * @param {string} partOfDate\n\t */\n\tparseDateFormat(partOfDate) {\n\t\tlet parseMonthFormat = {\n\t\t\t'yyyy-mm-dd': 'YYYY-MMMM',\n\t\t\t'mm-dd-yyyy': 'MMMM-YYYY',\n\t\t\t'dd-mm-yyyy': 'MMMM-YYYY',\n\t\t\t'yyyy.mm.dd': 'YYYY.MMMM',\n\t\t\t'mm.dd.yyyy': 'MMMM.YYYY',\n\t\t\t'dd.mm.yyyy': 'MMMM.YYYY',\n\t\t\t'yyyy/mm/dd': 'YYYY/MMMM',\n\t\t\t'mm/dd/yyyy': 'MMMM/YYYY',\n\t\t\t'dd/mm/yyyy': 'MMMM/YYYY'\n\t\t};\n\t\tlet parseWeekAndDayFormat = {\n\t\t\t'yyyy-mm-dd': 'YYYY-MMM-D',\n\t\t\t'mm-dd-yyyy': 'MMM-D-YYYY',\n\t\t\t'dd-mm-yyyy': 'D-MMM-YYYY',\n\t\t\t'yyyy.mm.dd': 'YYYY.MMM.D',\n\t\t\t'mm.dd.yyyy': 'MMM.D.YYYY',\n\t\t\t'dd.mm.yyyy': 'D.MMM.YYYY',\n\t\t\t'yyyy/mm/dd': 'YYYY/MMM/D',\n\t\t\t'mm/dd/yyyy': 'MMM/D/YYYY',\n\t\t\t'dd/mm/yyyy': 'D/MMM/YYYY'\n\t\t};\n\t\tlet formatDate = CONFIG.dateFormat;\n\t\tswitch (partOfDate) {\n\t\t\tcase 'month':\n\t\t\t\treturn parseMonthFormat[formatDate];\n\t\t\t\tbreak;\n\t\t\tcase 'week':\n\t\t\t\treturn parseWeekAndDayFormat[formatDate];\n\t\t\t\tbreak;\n\t\t\tcase 'day':\n\t\t\t\treturn parseWeekAndDayFormat[formatDate];\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Set calendar's minimal options.\n\t * @returns {object}\n\t */\n\tsetCalendarMinimalOptions() {\n\t\tlet hiddenDays = [];\n\t\tif (app.getMainParams('switchingDays') === 'workDays') {\n\t\t\thiddenDays = app.getMainParams('hiddenDays', true);\n\t\t}\n\t\treturn {\n\t\t\tfirstDay: CONFIG.firstDayOfWeekNo,\n\t\t\tselectable: true,\n\t\t\thiddenDays: hiddenDays,\n\t\t\tmonthNames: [\n\t\t\t\tapp.vtranslate('JS_JANUARY'),\n\t\t\t\tapp.vtranslate('JS_FEBRUARY'),\n\t\t\t\tapp.vtranslate('JS_MARCH'),\n\t\t\t\tapp.vtranslate('JS_APRIL'),\n\t\t\t\tapp.vtranslate('JS_MAY'),\n\t\t\t\tapp.vtranslate('JS_JUNE'),\n\t\t\t\tapp.vtranslate('JS_JULY'),\n\t\t\t\tapp.vtranslate('JS_AUGUST'),\n\t\t\t\tapp.vtranslate('JS_SEPTEMBER'),\n\t\t\t\tapp.vtranslate('JS_OCTOBER'),\n\t\t\t\tapp.vtranslate('JS_NOVEMBER'),\n\t\t\t\tapp.vtranslate('JS_DECEMBER')\n\t\t\t],\n\t\t\tdayNamesShort: [\n\t\t\t\tapp.vtranslate('JS_SUN'),\n\t\t\t\tapp.vtranslate('JS_MON'),\n\t\t\t\tapp.vtranslate('JS_TUE'),\n\t\t\t\tapp.vtranslate('JS_WED'),\n\t\t\t\tapp.vtranslate('JS_THU'),\n\t\t\t\tapp.vtranslate('JS_FRI'),\n\t\t\t\tapp.vtranslate('JS_SAT')\n\t\t\t]\n\t\t};\n\t}\n\n\t/**\n\t * Set calendar's advanced options.\n\t * @returns {object}\n\t */\n\tsetCalendarAdvancedOptions() {\n\t\tlet self = this;\n\t\treturn {\n\t\t\teditable: !this.readonly && this.eventEdit,\n\t\t\tselectable: !this.readonly && this.eventCreate,\n\t\t\theader: {\n\t\t\t\tleft: 'month,' + app.getMainParams('weekView') + ',' + app.getMainParams('dayView'),\n\t\t\t\tcenter: 'title today',\n\t\t\t\tright: 'prev,next'\n\t\t\t},\n\t\t\tallDaySlot: app.getMainParams('allDaySlot'),\n\t\t\tviews: {\n\t\t\t\tbasic: {\n\t\t\t\t\teventLimit: false\n\t\t\t\t},\n\t\t\t\tmonth: {\n\t\t\t\t\ttitleFormat: this.parseDateFormat('month')\n\t\t\t\t},\n\t\t\t\tweek: {\n\t\t\t\t\ttitleFormat: this.parseDateFormat('week')\n\t\t\t\t},\n\t\t\t\tday: {\n\t\t\t\t\ttitleFormat: this.parseDateFormat('day')\n\t\t\t\t}\n\t\t\t},\n\t\t\teventDrop: function(event, delta, revertFunc) {\n\t\t\t\tself.updateEvent(event, delta, revertFunc);\n\t\t\t},\n\t\t\teventResize: function(event, delta, revertFunc) {\n\t\t\t\tself.updateEvent(event, delta, revertFunc);\n\t\t\t},\n\t\t\tviewRender: function() {\n\t\t\t\tself.loadCalendarData();\n\t\t\t},\n\t\t\teventRender: self.eventRenderer,\n\t\t\theight: this.setCalendarHeight(this.container)\n\t\t};\n\t}\n\n\t/**\n\t * Update calendar's event.\n\t * @param {Object} event\n\t * @param {Object} delta\n\t * @param {Object} revertFunc\n\t */\n\tupdateEvent(event, delta, revertFunc) {\n\t\tlet progressInstance = jQuery.progressIndicator({ blockInfo: { enabled: true } });\n\t\tlet start = event.start.format();\n\t\tlet params = {\n\t\t\tmodule: CONFIG.module,\n\t\t\taction: 'Calendar',\n\t\t\tmode: 'updateEvent',\n\t\t\tid: event.id,\n\t\t\tstart: start,\n\t\t\tdelta: delta._data,\n\t\t\tallDay: event.allDay\n\t\t};\n\t\tAppConnector.request(params)\n\t\t\t.done(function(response) {\n\t\t\t\tif (!response['result']) {\n\t\t\t\t\tVtiger_Helper_Js.showPnotify(app.vtranslate('JS_NO_EDIT_PERMISSION'));\n\t\t\t\t\trevertFunc();\n\t\t\t\t} else {\n\t\t\t\t\twindow.popoverCache = {};\n\t\t\t\t}\n\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t})\n\t\t\t.fail(function() {\n\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\tVtiger_Helper_Js.showPnotify(app.vtranslate('JS_NO_EDIT_PERMISSION'));\n\t\t\t\trevertFunc();\n\t\t\t});\n\t}\n\n\t/**\n\t * Render event.\n\t * @param {Object} event\n\t * @param {jQuery} element\n\t */\n\teventRenderer(event, element) {\n\t\telement.find('.fc-title').html(event.title);\n\t\tif (event.rendering === 'background') {\n\t\t\telement.append(\n\t\t\t\t`<span class=\"js-popover-text d-block\"><span class=\"${event.icon} js-popover-icon mr-1\"></span>${event.title}</span>`\n\t\t\t);\n\t\t\telement.addClass('js-popover-tooltip--ellipsis').attr('data-content', event.title);\n\t\t\tapp.registerPopoverEllipsis({ element });\n\t\t}\n\t}\n\n\t/**\n\t * Returns counted calendar height.\n\t * @returns {(number|string)}\n\t */\n\tsetCalendarHeight() {\n\t\tconst defaultHeightValue = 'auto';\n\t\tif ($(window).width() > 993) {\n\t\t\tlet calendarContainer = this.container.find('.js-calendar__container'),\n\t\t\t\tcalendarPadding;\n\t\t\tif (this.container.hasClass('js-modal-container')) {\n\t\t\t\tcalendarPadding = this.container.find('.js-modal-header').outerHeight(); // modal needs bigger padding to prevent modal's scrollbar\n\t\t\t} else {\n\t\t\t\tcalendarPadding = this.container\n\t\t\t\t\t.find('.js-contents-div')\n\t\t\t\t\t.css('margin-left')\n\t\t\t\t\t.replace('px', ''); //equals calendar padding bottom to left margin\n\t\t\t}\n\t\t\tlet setCalendarH = () => {\n\t\t\t\treturn (\n\t\t\t\t\t$(window).height() -\n\t\t\t\t\tthis.container.find('.js-calendar__container').offset().top -\n\t\t\t\t\t$('.js-footer').height() -\n\t\t\t\t\tcalendarPadding\n\t\t\t\t);\n\t\t\t};\n\t\t\tnew ResizeSensor(this.container.find('.contentsDiv'), () => {\n\t\t\t\tcalendarContainer.fullCalendar('option', 'height', setCalendarH());\n\t\t\t});\n\t\t}\n\t\treturn defaultHeightValue;\n\t}\n\n\t/**\n\t * Set calendar module's options.\n\t * @returns {object}\n\t */\n\tsetCalendarModuleOptions() {\n\t\treturn {};\n\t}\n\n\t/**\n\t * Set calendar options from browser history.\n\t * @returns {object}\n\t */\n\tsetBrowserHistoryOptions() {\n\t\tlet historyParams = app.getMainParams('historyParams', true),\n\t\t\toptions = null;\n\t\tif (historyParams && (historyParams.length || Object.keys(historyParams).length)) {\n\t\t\toptions = {\n\t\t\t\tstart: historyParams.start,\n\t\t\t\tend: historyParams.end,\n\t\t\t\tuser: historyParams.user.split(',').map(x => {\n\t\t\t\t\treturn parseInt(x);\n\t\t\t\t}),\n\t\t\t\ttime: historyParams.time,\n\t\t\t\thiddenDays: historyParams.hiddenDays.split(',').map(x => {\n\t\t\t\t\tlet parsedValue = parseInt(x);\n\t\t\t\t\treturn isNaN(parsedValue) ? '' : parsedValue;\n\t\t\t\t}),\n\t\t\t\tcvid: historyParams.cvid,\n\t\t\t\tdefaultView: historyParams.viewType\n\t\t\t};\n\t\t\tlet dateFormat = CONFIG.dateFormat.toUpperCase();\n\t\t\tlet s = moment(options.start, dateFormat).valueOf();\n\t\t\tlet e = moment(options.end, dateFormat).valueOf();\n\t\t\toptions.defaultDate = moment(moment(s + (e - s) / 2).format('YYYY-MM-DD'));\n\t\t\tObject.keys(options).forEach(key => options[key] === 'undefined' && delete options[key]);\n\t\t\tapp.moduleCacheSet('browserHistoryEvent', false);\n\t\t\tapp.setMainParams('showType', options.time);\n\t\t\tapp.setMainParams('usersId', options.user);\n\t\t\tapp.setMainParams('defaultView', options.defaultView);\n\t\t}\n\t\twindow.addEventListener(\n\t\t\t'popstate',\n\t\t\tfunction(event) {\n\t\t\t\tapp.moduleCacheSet('browserHistoryEvent', true);\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\t\treturn options;\n\t}\n\n\t/**\n\t * Register events.\n\t * @returns {object}\n\t */\n\tregisterEvents() {\n\t\tthis.renderCalendar();\n\t\tthis.registerSitebarEvents();\n\t\tthis.registerButtonSelectAll();\n\t\tthis.registerAddButton();\n\t}\n\n\t/**\n\t * Invokes fullcalendar with options.\n\t */\n\trenderCalendar() {\n\t\tthis.getCalendarView().fullCalendar(this.calendarOptions);\n\t}\n\n\t/**\n\t * Register sitebar events.\n\t */\n\tregisterSitebarEvents() {\n\t\t$('.bodyContents').on('Vtiger.Widget.Load.undefined', () => {\n\t\t\tthis.registerSelect2Event();\n\t\t});\n\t}\n\n\t/**\n\t * Load calendar data\n\t */\n\tloadCalendarData() {\n\t\tconst defaultParams = this.getDefaultParams();\n\t\tthis.getCalendarView().fullCalendar('removeEvents');\n\t\tif (!defaultParams.emptyFilters) {\n\t\t\tconst progressInstance = $.progressIndicator();\n\t\t\tAppConnector.request(defaultParams).done(events => {\n\t\t\t\tthis.getCalendarView().fullCalendar('addEventSource', events.result);\n\t\t\t\tprogressInstance.hide();\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Default params\n\t * @returns {{module: *, action: string, mode: string, start: *, end: *, user: *, emptyFilters: boolean}}\n\t */\n\tgetDefaultParams() {\n\t\tlet formatDate = CONFIG.dateFormat.toUpperCase(),\n\t\t\tview = this.getCalendarView().fullCalendar('getView'),\n\t\t\tusers = app.moduleCacheGet('calendar-users') || CONFIG.userId;\n\t\tlet params = {\n\t\t\tmodule: CONFIG.module,\n\t\t\taction: 'Calendar',\n\t\t\tmode: 'getEvents',\n\t\t\tstart: view.start.format(formatDate),\n\t\t\tend: view.end.format(formatDate),\n\t\t\tuser: users,\n\t\t\temptyFilters: users.length === 0\n\t\t};\n\t\tif (app.moduleCacheGet('calendar-types')) {\n\t\t\tparams.types = app.moduleCacheGet('calendar-types');\n\t\t\tparams.emptyFilters = users.length === 0 || params.types.length === 0;\n\t\t} else {\n\t\t\tparams.types = [];\n\t\t}\n\t\treturn params;\n\t}\n\n\t/**\n\t * Register select2 event.\n\t */\n\tregisterSelect2Event() {\n\t\tlet self = this;\n\t\t$('.siteBarRight .js-calendar__filter__select').each(function() {\n\t\t\tlet element = $(this);\n\t\t\tlet name = element.data('cache');\n\t\t\tlet cachedValue = app.moduleCacheGet(name);\n\t\t\tif (element.length > 0 && cachedValue !== undefined) {\n\t\t\t\tif (element.prop('tagName') == 'SELECT') {\n\t\t\t\t\telement.val(cachedValue);\n\t\t\t\t}\n\t\t\t} else if (element.length > 0 && cachedValue === undefined && !element.find(':selected').length) {\n\t\t\t\tlet allOptions = [];\n\t\t\t\telement.find('option').each((i, option) => {\n\t\t\t\t\tallOptions.push($(option).val());\n\t\t\t\t});\n\t\t\t\telement.val(allOptions);\n\t\t\t\tapp.moduleCacheSet(name, cachedValue);\n\t\t\t}\n\t\t});\n\t\tlet selectsElements = $('.siteBarRight .select2, .siteBarRight .filterField');\n\t\tselectsElements.off('change');\n\t\tApp.Fields.Picklist.showSelect2ElementView(selectsElements);\n\t\tselectsElements.on('change', function() {\n\t\t\tlet element = $(this);\n\t\t\tlet value = element.val();\n\t\t\tif (value == null) {\n\t\t\t\tvalue = '';\n\t\t\t}\n\t\t\tif (element.attr('type') == 'checkbox') {\n\t\t\t\tvalue = element.is(':checked');\n\t\t\t}\n\t\t\tapp.moduleCacheSet(element.data('cache'), value);\n\t\t\tself.loadCalendarData();\n\t\t});\n\t}\n\n\t/**\n\t * Register button select all.\n\t */\n\tregisterButtonSelectAll() {\n\t\tlet selectBtn = $('.selectAllBtn');\n\t\tselectBtn.on('click', function(e) {\n\t\t\tlet selectAllLabel = $(this).find('.selectAll');\n\t\t\tlet deselectAllLabel = $(this).find('.deselectAll');\n\t\t\tif (selectAllLabel.hasClass('d-none')) {\n\t\t\t\tselectAllLabel.removeClass('d-none');\n\t\t\t\tdeselectAllLabel.addClass('d-none');\n\t\t\t\t$(this)\n\t\t\t\t\t.closest('.quickWidget')\n\t\t\t\t\t.find('select option')\n\t\t\t\t\t.prop('selected', false);\n\t\t\t} else {\n\t\t\t\t$(this)\n\t\t\t\t\t.closest('.quickWidget')\n\t\t\t\t\t.find('select option')\n\t\t\t\t\t.prop('selected', true);\n\t\t\t\tdeselectAllLabel.removeClass('d-none');\n\t\t\t\tselectAllLabel.addClass('d-none');\n\t\t\t}\n\t\t\t$(this)\n\t\t\t\t.closest('.quickWidget')\n\t\t\t\t.find('select')\n\t\t\t\t.trigger('change');\n\t\t});\n\t}\n\n\t/**\n\t * Register add button.\n\t */\n\tregisterAddButton() {\n\t\tconst self = this;\n\t\t$('.js-add').on('click', e => {\n\t\t\tself.getCalendarCreateView().done(data => {\n\t\t\t\tconst headerInstance = new Vtiger_Header_Js();\n\t\t\t\theaderInstance.handleQuickCreateData(data, {\n\t\t\t\t\tcallbackFunction: data => {\n\t\t\t\t\t\tself.addCalendarEvent(data.result);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Get calendar create view.\n\t * @returns {promise}\n\t */\n\tgetCalendarCreateView() {\n\t\tlet self = this;\n\t\tlet aDeferred = jQuery.Deferred();\n\n\t\tif (this.calendarCreateView !== false) {\n\t\t\taDeferred.resolve(this.calendarCreateView.clone(true, true));\n\t\t\treturn aDeferred.promise();\n\t\t}\n\t\tlet progressInstance = jQuery.progressIndicator();\n\t\tthis.loadCalendarCreateView()\n\t\t\t.done(function(data) {\n\t\t\t\tprogressInstance.hide();\n\t\t\t\tself.calendarCreateView = data;\n\t\t\t\taDeferred.resolve(data.clone(true, true));\n\t\t\t})\n\t\t\t.fail(function() {\n\t\t\t\tprogressInstance.hide();\n\t\t\t});\n\t\treturn aDeferred.promise();\n\t}\n\n\t/**\n\t * Load calendar create view.\n\t * @returns {promise}\n\t */\n\tloadCalendarCreateView() {\n\t\tlet aDeferred = jQuery.Deferred();\n\t\tlet moduleName = app.getModuleName();\n\t\tlet url = 'index.php?module=' + moduleName + '&view=QuickCreateAjax';\n\t\tlet headerInstance = Vtiger_Header_Js.getInstance();\n\t\theaderInstance\n\t\t\t.getQuickCreateForm(url, moduleName)\n\t\t\t.done(function(data) {\n\t\t\t\taDeferred.resolve(jQuery(data));\n\t\t\t})\n\t\t\t.fail(function(textStatus, errorThrown) {\n\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t});\n\t\treturn aDeferred.promise();\n\t}\n\n\t/**\n\t * Add event data to render.\n\t */\n\tgetEventRenderData(calendarDetails) {\n\t\tconst calendar = this.getCalendarView();\n\t\tconst eventObject = {\n\t\t\tid: calendarDetails._recordId,\n\t\t\ttitle: calendarDetails._recordLabel,\n\t\t\tstart: calendar\n\t\t\t\t.fullCalendar('moment', calendarDetails.date_start.value + ' ' + calendarDetails.time_start.value)\n\t\t\t\t.format(),\n\t\t\tend: calendar\n\t\t\t\t.fullCalendar('moment', calendarDetails.due_date.value + ' ' + calendarDetails.time_end.value)\n\t\t\t\t.format(),\n\t\t\tstart_display: calendarDetails.date_start.display_value + ' ' + calendarDetails.time_start.display_value,\n\t\t\tend_display: calendarDetails.due_date.display_value + ' ' + calendarDetails.time_end.display_value,\n\t\t\turl: `index.php?module=${CONFIG.module}&view=Detail&record=${calendarDetails._recordId}`,\n\t\t\tclassName: `js-popover-tooltip--record ownerCBg_${calendarDetails.assigned_user_id.value} picklistCBr_${\n\t\t\t\tCONFIG.module\n\t\t\t}_${\n\t\t\t\t$('.js-calendar__filter__select[data-cache=\"calendar-types\"]').length\n\t\t\t\t\t? this.eventTypeKeyName + '_' + calendarDetails[this.eventTypeKeyName]['value']\n\t\t\t\t\t: ''\n\t\t\t}`,\n\t\t\tallDay: typeof calendarDetails.allday === 'undefined' ? false : calendarDetails.allday.value == 'on'\n\t\t};\n\t\treturn eventObject;\n\t}\n\n\tisNewEventToDisplay(eventObject) {\n\t\tlet ownerSelects = $('.js-calendar__filter__select[data-cache=\"calendar-users\"]').add(\n\t\t\t$('.js-calendar__filter__select[data-cache=\"calendar-groups\"]')\n\t\t);\n\t\tif ($.inArray(eventObject.assigned_user_id.value, ownerSelects.val()) < 0) {\n\t\t\tthis.refreshFilterValues(eventObject, ownerSelects);\n\t\t\treturn false;\n\t\t}\n\t\tlet calendarTypes = $('.js-calendar__filter__select[data-cache=\"calendar-types\"]');\n\t\tif (calendarTypes.length) {\n\t\t\tif (!this.eventTypeKeyName) {\n\t\t\t\tthis.setEventTypeKey(eventObject);\n\t\t\t}\n\t\t\tif ($.inArray(eventObject[this.eventTypeKeyName]['value'], calendarTypes.val()) < 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tsetEventTypeKey(eventObject) {\n\t\tlet self = this;\n\t\tObject.keys(eventObject).forEach(function(key, index) {\n\t\t\tif (key.endsWith('type')) {\n\t\t\t\t// there are different names for event types in modules\n\t\t\t\tself.eventTypeKeyName = key;\n\t\t\t}\n\t\t});\n\t}\n\n\trefreshFilterValues(eventObject, filtersValues) {\n\t\tif (CONFIG.searchShowOwnerOnlyInList) {\n\t\t\tlet allOptions = [];\n\t\t\tfiltersValues.find('option').each((i, option) => {\n\t\t\t\tallOptions.push($(option).val());\n\t\t\t});\n\t\t\tif ($.inArray(eventObject.assigned_user_id.value, allOptions) < 0) {\n\t\t\t\tAppConnector.request(`module=${CONFIG.module}&view=RightPanel&mode=getUsersList`).done(usersData => {\n\t\t\t\t\tlet filterUsers = $('.js-calendar__filter--users');\n\t\t\t\t\tlet filterGroups = $('.js-calendar__filter--groups');\n\t\t\t\t\tfilterUsers.html(usersData);\n\t\t\t\t\tif (usersData) {\n\t\t\t\t\t\tfilterUsers.closest('.js-toggle-panel').removeClass('d-none');\n\t\t\t\t\t}\n\t\t\t\t\tif (filterGroups.length) {\n\t\t\t\t\t\tAppConnector.request(`module=${CONFIG.module}&view=RightPanel&mode=getGroupsList`).done(\n\t\t\t\t\t\t\tgroupsData => {\n\t\t\t\t\t\t\t\tfilterGroups.html(groupsData);\n\t\t\t\t\t\t\t\tif (groupsData) {\n\t\t\t\t\t\t\t\t\tfilterGroups.closest('.js-toggle-panel').removeClass('d-none');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthis.registerSelect2Event();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.registerSelect2Event();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Add calendar event.\n\t */\n\taddCalendarEvent(eventObject) {\n\t\tif (this.isNewEventToDisplay(eventObject)) {\n\t\t\tthis.getCalendarView().fullCalendar('renderEvent', this.getEventRenderData(eventObject));\n\t\t}\n\t}\n\n\t/**\n\t * Get calendar container.\n\t * @returns {(boolean|jQuery)}\n\t */\n\tgetCalendarView() {\n\t\tif (this.calendarView == false) {\n\t\t\tthis.calendarView = this.container.find('.js-calendar__container');\n\t\t}\n\t\treturn this.calendarView;\n\t}\n};\n\n/**\n *  Class representing a calendar with creating events by day click instead of selecting days.\n * @extends Calendar_Js\n */\nwindow.Calendar_Unselectable_Js = class extends Calendar_Js {\n\t/**\n\t * Set calendar module options.\n\t * @returns {{allDaySlot: boolean, dayClick: object, selectable: boolean}}\n\t */\n\tsetCalendarModuleOptions() {\n\t\tlet self = this;\n\t\treturn {\n\t\t\tallDaySlot: false,\n\t\t\tdayClick: this.eventCreate\n\t\t\t\t? function(date) {\n\t\t\t\t\t\tself.registerDayClickEvent(date.format());\n\t\t\t\t\t\tself.getCalendarView().fullCalendar('unselect');\n\t\t\t\t  }\n\t\t\t\t: false,\n\t\t\tselectable: false\n\t\t};\n\t}\n\n\t/**\n\t * Register day click event.\n\t * @param {string} date\n\t */\n\tregisterDayClickEvent(date) {\n\t\tlet self = this;\n\t\tself.getCalendarCreateView().done(function(data) {\n\t\t\tif (data.length <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet dateFormat = data\n\t\t\t\t\t.find('[name=\"date_start\"]')\n\t\t\t\t\t.data('dateFormat')\n\t\t\t\t\t.toUpperCase(),\n\t\t\t\ttimeFormat = data.find('[name=\"time_start\"]').data('format'),\n\t\t\t\tdefaultTimeFormat = 'hh:mm A';\n\t\t\tif (timeFormat == 24) {\n\t\t\t\tdefaultTimeFormat = 'HH:mm';\n\t\t\t}\n\t\t\tlet startDateInstance = Date.parse(date);\n\t\t\tlet startDateString = moment(date).format(dateFormat);\n\t\t\tlet startTimeString = moment(date).format(defaultTimeFormat);\n\t\t\tlet endDateInstance = Date.parse(date);\n\t\t\tlet endDateString = moment(date).format(dateFormat);\n\n\t\t\tlet view = self.getCalendarView().fullCalendar('getView');\n\t\t\tlet endTimeString;\n\t\t\tif ('month' == view.name) {\n\t\t\t\tlet diffDays = parseInt((endDateInstance - startDateInstance) / (1000 * 60 * 60 * 24));\n\t\t\t\tif (diffDays > 1) {\n\t\t\t\t\tlet defaultFirstHour = app.getMainParams('startHour');\n\t\t\t\t\tlet explodedTime = defaultFirstHour.split(':');\n\t\t\t\t\tstartTimeString = explodedTime['0'];\n\t\t\t\t\tlet defaultLastHour = app.getMainParams('endHour');\n\t\t\t\t\texplodedTime = defaultLastHour.split(':');\n\t\t\t\t\tendTimeString = explodedTime['0'];\n\t\t\t\t} else {\n\t\t\t\t\tlet now = new Date();\n\t\t\t\t\tstartTimeString = moment(now).format(defaultTimeFormat);\n\t\t\t\t\tendTimeString = moment(now)\n\t\t\t\t\t\t.add(15, 'minutes')\n\t\t\t\t\t\t.format(defaultTimeFormat);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tendTimeString = moment(endDateInstance)\n\t\t\t\t\t.add(30, 'minutes')\n\t\t\t\t\t.format(defaultTimeFormat);\n\t\t\t}\n\t\t\tdata.find('[name=\"date_start\"]').val(startDateString);\n\t\t\tdata.find('[name=\"due_date\"]').val(endDateString);\n\t\t\tdata.find('[name=\"time_start\"]').val(startTimeString);\n\t\t\tdata.find('[name=\"time_end\"]').val(endTimeString);\n\n\t\t\tlet headerInstance = new Vtiger_Header_Js();\n\t\t\theaderInstance.handleQuickCreateData(data, {\n\t\t\t\tcallbackFunction(data) {\n\t\t\t\t\tself.addCalendarEvent(data.result, dateFormat);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n};\n"],"names":["window","Calendar_Js","container","$","readonly","browserHistory","calendarView","calendarCreateView","eventCreate","app","getMainParams","eventEdit","browserHistoryConfig","this","setBrowserHistoryOptions","calendarOptions","setCalendarOptions","eventTypeKeyName","module","getModuleName","Object","assign","setCalendarBasicOptions","setCalendarAdvancedOptions","setCalendarModuleOptions","eventLimit","userDefaultActivityView","defaultView","moduleCacheGet","userDefaultTimeFormat","CONFIG","hourFormat","parseInt","options","vtranslate","s","moment","valueOf","e","defaultDate","format","setCalendarMinimalOptions","partOfDate","parseWeekAndDayFormat","formatDate","dateFormat","hiddenDays","firstDayOfWeekNo","self","parseDateFormat","event","delta","revertFunc","updateEvent","loadCalendarData","eventRenderer","setCalendarHeight","progressInstance","jQuery","progressIndicator","blockInfo","enabled","start","params","id","_data","allDay","request","done","response","popoverCache","showPnotify","mode","fail","element","find","html","title","rendering","append","icon","addClass","attr","registerPopoverEllipsis","width","calendarContainer","calendarPadding","hasClass","outerHeight","css","replace","ResizeSensor","fullCalendar","height","_this","offset","top","historyParams","length","keys","end","user","split","map","x","time","parsedValue","isNaN","cvid","viewType","toUpperCase","forEach","key","moduleCacheSet","setMainParams","addEventListener","renderCalendar","registerSitebarEvents","registerButtonSelectAll","registerAddButton","getCalendarView","on","registerSelect2Event","defaultParams","getDefaultParams","emptyFilters","events","result","hide","view","users","userId","types","each","name","data","cachedValue","undefined","prop","val","allOptions","i","option","push","selectsElements","off","Fields","Picklist","showSelect2ElementView","value","is","selectAllLabel","deselectAllLabel","removeClass","closest","trigger","getCalendarCreateView","Vtiger_Header_Js","handleQuickCreateData","addCalendarEvent","aDeferred","Deferred","resolve","clone","promise","loadCalendarCreateView","moduleName","url","getInstance","getQuickCreateForm","textStatus","errorThrown","reject","calendarDetails","calendar","_recordId","_recordLabel","date_start","time_start","due_date","time_end","display_value","assigned_user_id","allday","eventObject","ownerSelects","add","inArray","refreshFilterValues","calendarTypes","setEventTypeKey","index","endsWith","filtersValues","searchShowOwnerOnlyInList","filterUsers","filterGroups","usersData","groupsData","isNewEventToDisplay","getEventRenderData","Calendar_Unselectable_Js","date","registerDayClickEvent","defaultTimeFormat","startDateInstance","Date","parse","startDateString","startTimeString","endDateInstance","endDateString","endTimeString","explodedTime","now"],"mappings":"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"}