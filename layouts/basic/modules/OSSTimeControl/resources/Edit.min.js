
Vtiger_Edit_Js("OSSTimeControl_Edit_Js",{},{registerGenerateTCFieldTimeAndCost:function(){var c=this;$('input[name="sum_time"]').attr("readonly","readonly").css("width","80px");var a=c.differenceDays();var b=(Math.round((a/3600000)*100)/100).toFixed(2);jQuery('input[name="sum_time"]').val(b);jQuery(".dateField").change(function(){a=c.differenceDays();if(a=="Error"){return false}b=(Math.round((a/3600000)*100)/100).toFixed(2);jQuery('input[name="sum_time"]').val(b)});jQuery(".clockPicker").change(function(){a=c.differenceDays();if(a=="Error"){return false}b=(Math.round((a/3600000)*100)/100).toFixed(2);jQuery('input[name="sum_time"]').val(b)})},differenceDays:function(){var b=jQuery('input[name="date_start"]');var n=b.data("date-format");var c=b.val();var f=jQuery('input[name="due_date"]');var i=f.data("date-format");var k=f.val();var a=jQuery('input[name="time_start"]');var e=jQuery('input[name="time_end"]');var j=a.val();var h=e.val();var l=c+" "+j;var o=k+" "+h;var g=Vtiger_Helper_Js.getDateInstance(l,n);var m=Vtiger_Helper_Js.getDateInstance(o,i);var d=m-g;if(d>=0){return d}return"Error"},registerRecordPreSaveEvent:function(a){var c=this;var b=$('.recordEditView[name="QuickCreate"]');if(b.length==0){b=this.getForm()}b.on(Vtiger_Edit_Js.recordPreSave,function(h,g){var d=c.differenceDays();if(d=="Error"){var f={text:app.vtranslate("JS_DATE_SHOULD_BE_GREATER_THAN"),type:"error"};Vtiger_Helper_Js.showPnotify(f);return false}else{d=d/1000/60/60;if(d>24){var f={text:app.vtranslate("JS_DATE_NOT_SHOULD_BE_GREATER_THAN_24H"),type:"error"};Vtiger_Helper_Js.showPnotify(f);return false}b.submit()}})},registerGenerateTCFromHelpDesk:function(){var c=this;var a=jQuery('input[name="sourceRecord"]').val();var b=jQuery('input[name="sourceModule"]').val();if(typeof a!="undefined"){var d={};d.data={module:"OSSTimeControl",action:"GetTCInfo",id:a,sourceModule:b};d.async=false;d.dataType="json";AppConnector.request(d).then(function(g){var e=g.result;if(e.success){var f=e.sourceData;if(b=="HelpDesk"){if("contact_id" in f){jQuery('[name="contactid"]').val(f.contact_id);jQuery('[name="contactid_display"]').val(c.replaceAll(f.contact_label,"&oacute;","ó")).prop("readonly",true)}if("parent_id" in f){jQuery('[name="accountid"]').val(f.parent_id);jQuery('[name="accountid_display"]').val(c.replaceAll(f.account_label,"&oacute;","ó")).prop("readonly",true)}}else{if(b=="Project"){if("contact_label" in f){jQuery('[name="contactid"]').val(f.contact_id);jQuery('[name="contactid_display"]').val(c.replaceAll(f.contact_label,"&oacute;","ó")).prop("readonly",true)}if("account_label" in f){jQuery('[name="accountid"]').val(f.linktoaccountscontacts);jQuery('[name="accountid_display"]').val(c.replaceAll(f.account_label,"&oacute;","ó")).prop("readonly",true)}}}}else{var h={text:app.vtranslate("message"),animation:"show",type:"error",sticker:false,hover_sticker:false,};Vtiger_Helper_Js.showPnotify(h)}},function(g,e){var f={text:app.vtranslate("JS_ERROR_CONNECTING"),type:"error"};Vtiger_Helper_Js.showPnotify(f)})}},escapeRegExp:function(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},replaceAll:function(a,d,b){var c=this;a=a.replace(new RegExp(c.escapeRegExp("&Oacute;"),"g"),"Ó");return a.replace(new RegExp(c.escapeRegExp(d),"g"),b)},registerBasicEvents:function(a){this._super(a);this.registerRecordPreSaveEvent(a)},registerEvents:function(){this._super();this.registerGenerateTCFieldTimeAndCost();this.registerGenerateTCFromHelpDesk()}});