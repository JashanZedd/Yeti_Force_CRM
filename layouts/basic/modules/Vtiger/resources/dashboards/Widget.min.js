
jQuery.Class("Vtiger_Widget_Js",{widgetPostLoadEvent:"Vtiget.Dashboard.PostLoad",widgetPostRefereshEvent:"Vtiger.Dashboard.PostRefresh",getInstance:function(b,d,a){if(typeof a=="undefined"){a=app.getModuleName()}var g=d.toCamelCase();var h=window[a+"_"+g+"_Widget_Js"];var e=window["Vtiger_"+g+"_Widget_Js"];var c=window["YetiForce_"+g+"_Widget_Js"];var i=Vtiger_Widget_Js;if(typeof h!="undefined"){var f=new h(b)}else{if(typeof e!="undefined"){var f=new e(b)}else{if(typeof c!="undefined"){var f=new c(b)}else{var f=new i(b)}}}return f}},{container:false,plotContainer:false,plotInstance:false,chartData:[],paramCache:false,init:function(a){this.setContainer(jQuery(a));this.registerWidgetPostLoadEvent(a);this.registerWidgetPostRefreshEvent(a);this.registerCache(a)},getContainer:function(){return this.container},setContainer:function(a){this.container=a;return this},isEmptyData:function(){var a=this.getContainer();return(a.find(".noDataMsg").length>0)?true:false},getUserDateFormat:function(){return jQuery("#userDateFormat").val()},getPlotContainer:function(b){if(typeof b=="undefined"){b=false}if(this.plotContainer==false||!b){var a=this.getContainer();this.plotContainer=a.find(".widgetChartContainer")}return this.plotContainer},restrictContentDrag:function(){this.getContainer().on("mousedown.draggable",function(c){var b=jQuery(c.target);var a=b.closest(".dashboardWidgetHeader").length>0?true:false;if(a){return}c.stopPropagation()})},convertToDateRangePicketFormat:function(a){switch(a){case"yyyy-mm-dd":return"yyyy-MM-dd";break;case"mm-dd-yyyy":return"MM-dd-yyyy";break;case"dd-mm-yyyy":return"dd-MM-yyyy";break;case"yyyy.mm.dd":return"yyyy.MM.dd";break;case"mm.dd.yyyy":return"MM.dd.yyyy";break;case"dd.mm.yyyy":return"dd.MM.yyyy";break;case"yyyy/mm/dd":return"yyyy/MM/dd";break;case"mm/dd/yyyy":return"MM/dd/yyyy";break;case"dd/mm/yyyy":return"dd/MM/yyyy";break}},generateData:function(){var d=this;var a=d.getContainer();var b=a.find(".widgetData").val();var f=JSON.parse(b);var e=[];for(var c in f){e.push(f[c]);d.chartData[f[c].id]=f[c]}return{chartData:e}},loadChart:function(){},positionNoDataMsg:function(){var a=this.getContainer();var c=a.find(".dashboardWidgetContent");var b=c.find(".noDataMsg");b.position({my:"center center",at:"center center",of:c})},postLoadWidget:function(){if(!this.isEmptyData()){this.loadChart()}else{this.positionNoDataMsg()}this.registerSectionClick();this.registerFilter();this.registerFilterChangeEvent();this.restrictContentDrag();app.showBtnSwitch(this.getContainer().find(".switchBtn"));this.registerWidgetSwitch();this.registerChangeSorting();this.registerLoadMore()},postRefreshWidget:function(){if(!this.isEmptyData()){this.loadChart()}else{this.positionNoDataMsg()}this.registerSectionClick();this.registerLoadMore()},setSortingButton:function(f){if(f.length){var c=this.getContainer();var a=c.find('a[name="drefresh"]');var e=a.data("url");e=e.replace("&sortorder=desc","");e=e.replace("&sortorder=asc","");e+="&sortorder=";var g=f.data("sort");var b="desc";var h="glyphicon-sort-by-attributes-alt";if(g=="desc"){b="asc";h="glyphicon-sort-by-attributes"}f.data("sort",b);f.attr("title",f.data(b));f.attr("alt",f.data(b));e+=b;var d=f.find(".glyphicon");d.removeClass().addClass("glyphicon").addClass(h);a.data("url",e)}},registerChangeSorting:function(){var b=this;var a=this.getContainer();b.setSortingButton(a.find(".changeRecordSort"));a.find(".changeRecordSort").click(function(d){var c=a.find('a[name="drefresh"]');b.setSortingButton(jQuery(d.currentTarget));c.click()})},registerWidgetSwitch:function(){var a=this;var b=this.getContainer().find(".dashboardWidgetHeader .switchBtnReload");a.setUrlSwitch(b);b.on("switchChange.bootstrapSwitch",function(g,f){var d=jQuery(g.currentTarget);var h=d.closest(".dashboardWidgetHeader");var c=h.find('a[name="drefresh"]');a.setUrlSwitch(d).then(function(e){if(e){c.click()}})})},setUrlSwitch:function(b){var a=jQuery.Deferred();b.each(function(h,i){var g=jQuery(i);var f=g.closest(".dashboardWidgetHeader");var k=f.find('a[name="drefresh"]');var c=k.data("url");var d=g.data("urlparams");if(d!=""){var m=g.data("on-val");var l=g.data("off-val");c=c.replace("&"+d+"="+m,"");c=c.replace("&"+d+"="+l,"");c+="&"+d+"=";if(g.prop("checked")){c+=m}else{c+=l}k.data("url",c);a.resolve(true)}else{a.reject()}});return a.promise()},getFilterData:function(){return{}},refreshWidget:function(){var h=this;var i=this.getContainer();var d=i.find('a[name="drefresh"]');var a=d.data("url");var f=i.find(".dashboardWidgetContent");var c=a;var e=i.find(".widgetFilter");if(e.length>0){c={};c.url=a;c.data={};e.each(function(q,o){var r=jQuery(o);if(r.is(".dateRange")){var m=r.val();if(m.length<=0){return true}var l=r.attr("name");var n=m.split(",");c.data[l]={};c.data[l].start=n[0];c.data[l].end=n[1]}else{var k=r.attr("type");var p=r.attr("name");if("checkbox"==k){var s=r.is(":checked");c.data[p]=s}else{var s=r.val();c.data[p]=s}}})}var g=this.getFilterData();if(!jQuery.isEmptyObject(g)){if(typeof c=="string"){a=c;c={};c.url=a;c.data={}}c.data=jQuery.extend(c.data,this.getFilterData())}var b=i.find(".dashboardWidgetContent");b.html("");b.progressIndicator();if(this.paramCache){h.setFilterToCache(c.url,c.data)}AppConnector.request(c).then(function(k){b.progressIndicator({mode:"hide"});f.html(k).trigger(Vtiger_Widget_Js.widgetPostRefereshEvent)},function(){b.progressIndicator({mode:"hide"})})},registerFilter:function(){var d=this;var a=this.getContainer();var b=a.find("input.dateRange");var c=false;if(b.length<=0){return}var e={calendars:3,mode:"range",className:"rangeCalendar",onChange:function(g){c=true;var f=jQuery(this).data("datepicker").el;jQuery(f).val(g)},onHide:function(){if(c){a.find('a[name="drefresh"]').trigger("click");c=false}},onBeforeShow:function(f){jQuery(f).css("z-index","3")}};b.addClass("dateField").attr("data-date-format",d.getUserDateFormat());app.registerEventForDatePickerFields(b,false,e)},registerFilterChangeEvent:function(){this.getContainer().on("change",".widgetFilter",function(b){var a=jQuery(b.currentTarget).closest("li");a.find('a[name="drefresh"]').trigger("click")})},registerWidgetPostLoadEvent:function(a){var b=this;a.on(Vtiger_Widget_Js.widgetPostLoadEvent,function(c){b.postLoadWidget()})},registerWidgetPostRefreshEvent:function(a){var b=this;a.on(Vtiger_Widget_Js.widgetPostRefereshEvent,function(c){b.postRefreshWidget()})},registerSectionClick:function(){},registerLoadMore:function(){var c=this;var b=c.getContainer();var a=b.find(".dashboardWidgetContent");a.off("click","a.showMoreHistory");a.on("click","a.showMoreHistory",function(k){var g=jQuery(k.currentTarget);g.hide();var i=jQuery(k.delegateTarget).closest(".dashboardWidget");jQuery(i).find(".slimScrollDiv").css("overflow","visible");var d=i.find(".owner").val();var h=i.find("[name='type']").val();var f=g.data("url")+"&content=true&owner="+d;if(i.find("[name='type']").length>0){f+="&type="+h}if(i.find(".changeRecordSort").length>0){f+="&sortorder="+i.find(".changeRecordSort").data("sort")}a.progressIndicator();AppConnector.request(f).then(function(e){a.progressIndicator({mode:"hide"});jQuery(i).find(".dashboardWidgetContent").append(e);g.parent().remove()})})},setFilterToCache:function(c,g){var f=c;var a=this.getContainer();f=f.replace("&content=","&notcontent=");for(var e in g){if(typeof g[e]=="object"){g[e]=JSON.stringify(g[e])}f+="&"+e+"="+g[e]}var d=app.getMainParams("current_user_id");var b=a.data("name");app.cacheSet(b+d,f)},registerCache:function(a){if(a.data("cache")==1){this.paramCache=true}}});Vtiger_Widget_Js("Vtiger_History_Widget_Js",{},{postLoadWidget:function(){this._super();var a=jQuery(".dashboardWidgetContent",this.getContainer());this.registerLoadMore()},postRefreshWidget:function(){this._super();this.registerLoadMore()},registerLoadMore:function(){var c=this;var b=c.getContainer();var a=b.find(".dashboardWidgetContent");var d=a.find(".load-more");d.click(function(){var h=c.getContainer();var g=h.find('a[name="drefresh"]');var f=g.data("url");var l=f;var e=h.find(".widgetFilter");if(e.length>0){l={url:f,data:{}};e.each(function(n,p){var m=jQuery(p);var o=m.attr("name");var q=m.val();l.data[o]=q})}var k=c.getFilterData();if(!jQuery.isEmptyObject(k)){if(typeof l=="string"){l={url:f,data:{}}}l.data=jQuery.extend(l.data,c.getFilterData())}l.data.page=d.data("nextpage");var i=h.find(".dashboardWidgetContent");i.progressIndicator();AppConnector.request(l).then(function(m){i.progressIndicator({mode:"hide"});d.replaceWith(m);c.registerLoadMore()},function(){i.progressIndicator({mode:"hide"})})})}});Vtiger_Widget_Js("Vtiger_Funnel_Widget_Js",{},{postLoadWidget:function(){this._super();var a=this;this.getContainer().on("jqplotDataClick",function(e,d,i,h,g){var c=a.getContainer().find(".widgetData").val();var f=JSON.parse(c);var b=f[i][3];if(b){window.location.href=b}});this.getContainer().on("jqplotDataHighlight",function(b,c,d,e){$(".jqplot-event-canvas").css("cursor","pointer")});this.getContainer().on("jqplotDataUnhighlight",function(b,c,d,e){$(".jqplot-event-canvas").css("cursor","auto")})},loadChart:function(){var a=this.getContainer();var d=a.find(".widgetData").val();var e=new Array();var c=JSON.parse(d);for(var b=0;b<c.length;b++){e[b]=c[b][2];c[b][1]=parseFloat(c[b][1])}this.getPlotContainer(false).jqplot([c],{seriesDefaults:{renderer:jQuery.jqplot.FunnelRenderer,rendererOptions:{sectionMargin:12,widthRatio:0.1,showDataLabels:true,dataLabelThreshold:0,dataLabels:"value"}},legend:{show:true,location:"ne",placement:"outside",labels:e,xoffset:20}})},registerSectionClick:function(){this.getContainer().on("jqplotDataClick",function(){var b=arguments[3];var a=b[0]})}});Vtiger_Widget_Js("Vtiger_Pie_Widget_Js",{},{generateData:function(){var a=this.getContainer();var b=a.find(".widgetData").val();var f=JSON.parse(b);var e=[];for(var c in f){var g=f[c];var d=[g.last_name,g.id];e.push(d)}return{chartData:e}},loadChart:function(){var a=this.generateData();this.getPlotContainer(false).jqplot([a.chartData],{seriesDefaults:{renderer:jQuery.jqplot.PieRenderer,rendererOptions:{showDataLabels:true,dataLabels:"value"}},legend:{show:true,location:"e"},title:a.title})},registerSectionClick:function(){this.getPlotContainer().on("jqplotDataClick",function(){var b=arguments[3];var a=b[2]})}});Vtiger_Widget_Js("Vtiger_Barchat_Widget_Js",{},{generateChartData:function(){var a=this.getContainer();var b=a.find(".widgetData").val();var g=JSON.parse(b);var f=[];var e=new Array();var d=0;for(var c in g){var h=g[c];h[0]=parseInt(h[0]);e.push(app.getDecodedValue(h[1]));f.push(h[0]);if(parseInt(h[0])>d){d=parseInt(h[0])}}d=d+2+(d/100)*25;return{chartData:[f],yMaxValue:d,labels:e}},loadChart:function(){var a=this.generateChartData();this.getPlotContainer(false).jqplot(a.chartData,{title:a.title,animate:!$.jqplot.use_excanvas,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{showDataLabels:true,dataLabels:"value",barDirection:"vertical"},pointLabels:{show:true,edgeTolerance:-15}},axes:{xaxis:{tickRenderer:jQuery.jqplot.CanvasAxisTickRenderer,renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:a.labels,tickOptions:{angle:-45}},yaxis:{min:0,max:a.yMaxValue,tickOptions:{formatString:"%d"},pad:1.2}},legend:{show:(a.data_labels)?true:false,location:"e",placement:"outside",showLabels:(a.data_labels)?true:false,showSwatch:(a.data_labels)?true:false,labels:a.data_labels}})}});Vtiger_Widget_Js("Vtiger_MultiBarchat_Widget_Js",{getCharRelatedData:function(){var a=this.getContainer();var h=a.find(".widgetData").val();var c=new Array();var d=new Array();var m=new Array();for(var l=0;l<h.length;l++){if($.inArray(h[l].last_name,c)==-1){c.push(h[l].last_name)}if($.inArray(h[l].sales_stage,d)==-1){d.push(h[l].sales_stage)}}for(j in d){var f=new Array();for(l in c){var e=0;for(var g in h){var b=h[g];if(b.sales_stage==d[j]&&b.last_name==c[l]){e=parseInt(b.count);break}}f.push(e)}m.push(f)}return{data:m,ticks:c,labels:d}},loadChart:function(){var c=this.getCharRelatedData();var b=c.data;var a=c.ticks;var d=c.labels;$.jqplot.CanvasAxisTickRenderer.pt2px=2.4;this.getPlotContainer(false).jqplot(b,{stackSeries:true,captureRightClick:true,seriesDefaults:{renderer:$.jqplot.BarRenderer,rendererOptions:{barMargin:10,highlightMouseDown:true,highlightMouseOver:true},pointLabels:{show:true,hideZeros:true}},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{angle:-45,pt2px:4},ticks:a},yaxis:{padMin:0,min:0}},legend:{show:true,location:"e",placement:"outside",labels:d}})}});Vtiger_Widget_Js("Vtiger_Minilist_Widget_Js",{},{postLoadWidget:function(){app.hideModalWindow();this.restrictContentDrag();this.registerFilterChangeEvent()}});Vtiger_Widget_Js("Vtiger_Tagcloud_Widget_Js",{},{postLoadWidget:function(){this._super();this.registerTagCloud();this.registerTagClickEvent()},registerTagCloud:function(){jQuery("#tagCloud").find("a").tagcloud({size:{start:parseInt("12"),end:parseInt("30"),unit:"px"},color:{start:"#0266c9",end:"#759dc4"}})},registerChangeEventForModulesList:function(){jQuery("#tagSearchModulesList").on("change",function(c){var a=jQuery(c.currentTarget);if(a.val()=="all"){jQuery('[name="tagSearchModuleResults"]').removeClass("hide")}else{jQuery('[name="tagSearchModuleResults"]').removeClass("hide");var b=a.val();jQuery('[name="tagSearchModuleResults"]').filter(":not(#"+b+")").addClass("hide")}})},registerTagClickEvent:function(){var b=this;var a=this.getContainer();a.on("click",".tagName",function(f){var c=jQuery(f.currentTarget);var d=c.data("tagid");var g={module:app.getModuleName(),view:"TagCloudSearchAjax",tag_id:d,tag_name:c.text()};AppConnector.request(g).then(function(e){var h={data:e,css:{"min-width":"40%"}};app.showModalWindow(h);b.registerChangeEventForModulesList()})})},postRefreshWidget:function(){this._super();this.registerTagCloud()}});Vtiger_Widget_Js("Vtiger_Notebook_Widget_Js",{},{postLoadWidget:function(){this.reinitNotebookView()},reinitNotebookView:function(){var a=this;app.showScrollBar(jQuery(".dashboard_notebookWidget_viewarea",this.container),{height:"200px"});jQuery(".dashboard_notebookWidget_edit",this.container).click(function(){a.editNotebookContent()});jQuery(".dashboard_notebookWidget_save",this.container).click(function(){a.saveNotebookContent()})},editNotebookContent:function(){jQuery(".dashboard_notebookWidget_text",this.container).show();jQuery(".dashboard_notebookWidget_view",this.container).hide()},saveNotebookContent:function(){var b=this;var a=jQuery(".dashboard_notebookWidget_textarea",this.container);var c=this.container.data("url");var e=c+"&content=true&mode=save&contents="+encodeURIComponent(a.val());var d=this.container.find(".dashboardWidgetContent");d.progressIndicator();AppConnector.request(e).then(function(f){d.progressIndicator({mode:"hide"});jQuery(".dashboardWidgetContent",b.container).html(f);b.reinitNotebookView()})}});Vtiger_Widget_Js("Vtiger_KpiBarchat_Widget_Js",{},{generateChartData:function(){var a=this.getContainer();var b=a.find(".widgetData").val();var f=JSON.parse(b);var e=[];var d=new Array();var c=0;return{chartData:[[[f.result,f.all]]],yMaxValue:f.maxValue,labels:""}},loadChart:function(){var a=this.generateChartData();this.getPlotContainer(false).jqplot(a.chartData,{animate:!$.jqplot.use_excanvas,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{showDataLabels:true,dataLabels:"value",barDirection:"horizontal"},},axes:{xaxis:{min:0,max:a.yMaxValue,},yaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,}}})}});Vtiger_Widget_Js("YetiForce_Pie_Widget_Js",{},{loadChart:function(){var a=this;var b=a.generateData();a.plotInstance=$.plot(a.getPlotContainer(false),b.chartData,{series:{pie:{show:true,label:{formatter:a.getLabelFormat}}},legend:{show:false},grid:{hoverable:true,clickable:true},})},getLabelFormat:function(a,b){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+b.color+";'>"+a+"<br/>"+b.data[0][1]+"</div>"},registerSectionClick:function(){var a=this;a.getPlotContainer().bind("plothover",function(c,d,b){if(b){$(this).css("cursor","pointer")}else{$(this).css("cursor","auto")}});a.getPlotContainer().bind("plotclick",function(c,d,b){if(b){if(b.series.links){window.location.href=b.series.links}}})}});Vtiger_Widget_Js("YetiForce_Bar_Widget_Js",{},{generateData:function(){var d=this;var a=d.getContainer();var b=a.find(".widgetData").val();var f=JSON.parse(b);var e=[];for(var c in f.chart){e.push(f.chart[c]);d.chartData[f.chart[c].id]=f.chart[c]}return{chartData:e,ticks:f.ticks,links:f.links,legend:f.legend,valueLabels:f.valueLabels?f.valueLabels:{}}},loadChart:function(){var b=this;var c=b.generateData();var a={xaxis:{minTickSize:1,ticks:c.ticks},yaxis:{min:0,tickDecimals:0},grid:{hoverable:true,clickable:true},series:{bars:{show:true,barWidth:0.9,dataLabels:false,align:"center",lineWidth:0},valueLabels:c.valueLabels,stack:true},};b.plotInstance=$.plot(b.getPlotContainer(false),c.chartData,a)},getLabelFormat:function(a,b){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+b.color+";'>"+a+"<br/>"+b.data[0][1]+"</div>"},registerSectionClick:function(){var a=this;var b=a.generateData();a.getPlotContainer().bind("plothover",function(d,e,c){if(c){$(this).css("cursor","pointer")}else{$(this).css("cursor","auto")}});a.getPlotContainer().bind("plotclick",function(d,e,c){if(c){$(b.links).each(function(){if(c.dataIndex==this[0]){window.location.href=this[1]}})}})}});Vtiger_Widget_Js("YetiForce_Calendar_Widget_Js",{},{calendarView:false,calendarCreateView:false,weekDaysArray:{Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},registerCalendar:function(){var i=this;var a="month";var c=i.getContainer();var g=jQuery("#time_format").val();if(g==24){g="H(:mm)"}else{g="h(:mm) A"}var e=jQuery("#start_day").val();var h=i.weekDaysArray[e];var f=jQuery("#start_hour").val();var k=f.split(":");f=k["0"];var b=app.getMainParams("defaultDate");if(this.paramCache&&b!=moment().format("YYYY-MM-DD")){b=moment(b).format("D")==1?moment(b):moment(b).add(1,"M")}i.getCalendarView().fullCalendar({header:{left:" ",center:"prev title next",right:" "},defaultDate:b,timeFormat:g,axisFormat:g,firstHour:f,firstDay:h,defaultView:a,editable:false,slotMinutes:15,theme:false,defaultEventMinutes:0,eventLimit:true,allDaySlot:false,monthNames:[app.vtranslate("JS_JANUARY"),app.vtranslate("JS_FEBRUARY"),app.vtranslate("JS_MARCH"),app.vtranslate("JS_APRIL"),app.vtranslate("JS_MAY"),app.vtranslate("JS_JUNE"),app.vtranslate("JS_JULY"),app.vtranslate("JS_AUGUST"),app.vtranslate("JS_SEPTEMBER"),app.vtranslate("JS_OCTOBER"),app.vtranslate("JS_NOVEMBER"),app.vtranslate("JS_DECEMBER")],monthNamesShort:[app.vtranslate("JS_JAN"),app.vtranslate("JS_FEB"),app.vtranslate("JS_MAR"),app.vtranslate("JS_APR"),app.vtranslate("JS_MAY"),app.vtranslate("JS_JUN"),app.vtranslate("JS_JUL"),app.vtranslate("JS_AUG"),app.vtranslate("JS_SEP"),app.vtranslate("JS_OCT"),app.vtranslate("JS_NOV"),app.vtranslate("JS_DEC")],dayNames:[app.vtranslate("JS_SUNDAY"),app.vtranslate("JS_MONDAY"),app.vtranslate("JS_TUESDAY"),app.vtranslate("JS_WEDNESDAY"),app.vtranslate("JS_THURSDAY"),app.vtranslate("JS_FRIDAY"),app.vtranslate("JS_SATURDAY")],dayNamesShort:[app.vtranslate("JS_SUN"),app.vtranslate("JS_MON"),app.vtranslate("JS_TUE"),app.vtranslate("JS_WED"),app.vtranslate("JS_THU"),app.vtranslate("JS_FRI"),app.vtranslate("JS_SAT")],buttonText:{today:app.vtranslate("JS_TODAY"),month:app.vtranslate("JS_MONTH"),week:app.vtranslate("JS_WEEK"),day:app.vtranslate("JS_DAY")},allDayText:app.vtranslate("JS_ALL_DAY"),eventLimitText:app.vtranslate("JS_MORE")});i.getCalendarView().find("td.fc-day-number").mouseenter(function(){jQuery('<span class="plus pull-left glyphicon glyphicon-plus"></span>').prependTo($(this))}).mouseleave(function(){$(this).find(".plus").remove()});i.getCalendarView().find("td.fc-day-number").click(function(){var l=$(this).data("date");var m={noCache:true};m.data={date_start:l,due_date:l};m.callbackFunction=function(){i.getCalendarView().closest(".dashboardWidget").find('a[name="drefresh"]').trigger("click")};Vtiger_Header_Js.getInstance().quickCreateModule("Calendar",m)});var d=c.find(".switchBtn");app.showBtnSwitch(d);d.on("switchChange.bootstrapSwitch",function(m,l){if(l){c.find(".widgetFilterSwitch").val("current")}else{c.find(".widgetFilterSwitch").val("history")}i.refreshWidget()})},loadCalendarData:function(d){var l=this;l.getCalendarView().fullCalendar("removeEvents");var k=l.getCalendarView().fullCalendar("getView");var h=k.start.format();var c=k.end.format();var m=l.getContainer();var f=m.find(".owner").val();if(f=="all"){f=""}var e={module:"Calendar",action:"Calendar",mode:"getEvents",start:h,end:c,user:f,widget:true};if(m.find(".customFilter").length>0){var a=m.find(".customFilter").val();e.customFilter=a}if(m.find(".widgetFilterSwitch").length>0){e.time=m.find(".widgetFilterSwitch").val()}if(this.paramCache){var i=this.getContainer().find('a[name="drefresh"]');var b=i.data("url");var g={owner:f,customFilter:a,start:h};l.setFilterToCache(b,g)}AppConnector.request(e).then(function(p){var n=(l.getCalendarView().find(".fc-bg :first").height()-l.getCalendarView().find(".fc-day-number").height())-10;var q=(l.getCalendarView().find(".fc-day-number").width()/2)-10;for(var o in p.result){p.result[o]["width"]=q;p.result[o]["height"]=n}l.getCalendarView().fullCalendar("addEventSource",p.result);l.getCalendarView().find(".fc-event-container a").click(function(){var s=l.getContainer();var t="index.php?module=Calendar&view=List";if(a){t+="&viewname="+s.find("select.widgetFilter.customFilter").val()}t+="&search_params=[[";if(s.find(".widgetFilter.owner option:selected").val()!="all"){t+='["assigned_user_id","c","'+s.find(".widgetFilter.owner option:selected").data("name")+'"],'}if(m.find(".widgetFilterSwitch").length>0){var r=m.find(".widgetFilterSwitch").data();t+='["activitystatus","e","'+r[e.time]+'"],'}window.location.href=t+'["activitytype","e","'+$(this).data("type")+'"],["date_start","ir","'+$(this).data("date")+'"]]]'})})},getCalendarView:function(){if(this.calendarView==false){this.calendarView=this.getContainer().find("#calendarview")}return this.calendarView},getMonthName:function(){var a=this;var b=a.getCalendarView().find(".fc-toolbar h2").text();if(b){this.getContainer().find(".headerCalendar .month").html("<h3>"+b+"</h3>")}},registerChangeView:function(){var d=this;var a=this.getContainer();a.find(".fc-toolbar").addClass("hide");var e=a.find(".fc-toolbar h2").text();if(e){var b=a.find(".headerCalendar").removeClass("hide").find(".month").append("<h3>"+e+"</h3>");var c=a.find(".headerCalendar button");c.each(function(){var f=jQuery(this).data("type");jQuery(this).on("click",function(){d.getCalendarView().find(".fc-toolbar ."+f).trigger("click");d.loadCalendarData();d.getMonthName()})})}},postLoadWidget:function(){this.registerCalendar();this.loadCalendarData(true);this.registerChangeView();this.registerFilterChangeEvent()},refreshWidget:function(){var b=this;var a=this.getContainer().find(".dashboardWidgetContent");a.progressIndicator();b.loadCalendarData();a.progressIndicator({mode:"hide"})},});Vtiger_Widget_Js("YetiForce_Calendaractivities_Widget_Js",{},{modalView:false,postLoadWidget:function(){this._super();this.registerActivityChange();this.registerListViewButton()},postRefreshWidget:function(){this._super();this.registerActivityChange()},registerActivityChange:function(){var b=this;var a=this.getContainer().find(".dashboardWidgetContent");a.find(".changeActivity").on("click",function(f){if(jQuery(f.target).is("a")||b.modalView){return}var d=jQuery(this).data("url");if(typeof d!="undefined"){var c=function(){b.modalView=false};b.modalView=true;app.showModalWindow(null,d,c)}})},registerListViewButton:function(){var b=this;var a=b.getContainer();a.find(".goToListView").on("click",function(){var c=a.find(".status").prop("checked");if(a.data("name")=="OverdueActivities"){c="PLL_OVERDUE"}else{if(c){c="PLL_IN_REALIZATION"}else{c="PLL_PLANNED"}}window.location.href='index.php?module=Calendar&view=List&search_params=[[["assigned_user_id","c","'+a.find(".widgetFilter.owner option:selected").data("name")+'"],["activitystatus","e","'+c+'"]]]'})}});YetiForce_Calendaractivities_Widget_Js("YetiForce_Assignedupcomingcalendartasks_Widget_Js",{},{});YetiForce_Calendaractivities_Widget_Js("YetiForce_Creatednotmineactivities_Widget_Js",{},{});YetiForce_Calendaractivities_Widget_Js("YetiForce_Overdueactivities_Widget_Js",{},{});YetiForce_Calendaractivities_Widget_Js("YetiForce_Assignedoverduecalendartasks_Widget_Js",{},{});