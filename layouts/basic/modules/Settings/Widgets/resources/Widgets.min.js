
jQuery.Class("Settings_Widgets_Index_Js",{},{getTabId:function(){return $(".WidgetsManage [name='tabid']").val()},getType:function(){return $(".form-modalAddWidget [name='type']").val()},createStep2:function(b){var c=this;var a=c.getTabId();var d=jQuery.progressIndicator({position:"html"});app.showModalWindow(null,"index.php?parent=Settings&module=Widgets&view=Widget&mode=createStep2&type="+b+"&tabId="+a,function(f){f.find(".HelpInfoPopover").hover(function(){$(this).popover("show")},function(){$(this).popover("hide")});if(b=="RelatedModule"){c.loadFilters(f);c.loadCheckboxs(f);f.find("select[name='relatedmodule']").change(function(){c.changeRelatedModule()})}d.progressIndicator({mode:"hide"});var e=jQuery("form",f);e.submit(function(h){h.preventDefault();var g=e.serializeFormData();c.registerSaveEvent("saveWidget",{data:g,tabid:a,});c.reloadWidgets();app.hideModalWindow()})})},loadWidgets:function(){var a=this;var b=jQuery(".blocksSortable");b.sortable({revert:true,connectWith:".blocksSortable",tolerance:"pointer",cursor:"move",placeholder:"state-highlight",stop:function(c,d){a.updateSequence()}})},updateSequence:function(){var b=this;var c={};$(".blockSortable").each(function(d){c[$(this).data("id")]={index:d,column:$(this).closest(".blocksSortable").data("column")}});var a=$.progressIndicator({message:app.vtranslate("Saving changes"),blockInfo:{enabled:true}});b.registerSaveEvent("updateSequence",{data:c,tabid:$("input[name='tabid']").val(),});a.progressIndicator({mode:"hide"})},reloadWidgets:function(){var b=this;var a=jQuery.progressIndicator({message:app.vtranslate("Loading data"),position:"html",blockInfo:{enabled:true}});var c={};c.module="Widgets";c.view="Index";c.parent="Settings";c.source=$("input[name='tabid']").val();AppConnector.request(c).then(function(d){jQuery("div.contentsDiv").html(d);b.registerEvents();$("input[name='ModulesList']").select2();a.progressIndicator({mode:"hide"})})},registerSaveEvent:function(d,a){var c="";var b={};b.data={module:app.getModuleName(),parent:app.getParentModuleName(),action:"SaveAjax",mode:d,params:a};if(d=="saveWidget"){b.async=false}else{b.async=true}b.dataType="json";AppConnector.request(b).then(function(f){var e=f.result;var g={text:e.message,animation:"show",type:"success"};Vtiger_Helper_Js.showPnotify(g);c=e.success},function(f,e){})},loadFilters:function(f){var c=JSON.parse(jQuery("#filters").val());var d=f.find("select[name='relatedmodule'] option:selected").val();var e=f.find("select[name='filter']");var a=f.find("input[name='filter_selected']").val();e.empty();e.append($("<option/>",{value:"-",text:app.vtranslate("None")}));if(c[d]!==undefined){$.each(c[d],function(g,i){var h={value:g,text:i};if(a==g){h.selected="selected"}e.append($("<option/>",h))})}var b=jQuery("input[name='filterv']").val();if(b!=undefined){e.val(b)}e.select2()},loadCheckboxs:function(f){var a=JSON.parse(jQuery("#checkboxs").val());var e=f.find("select[name='relatedmodule'] option:selected").val();var b=f.find("select[name='checkbox']");var c=f.find("input[name='checkbox_selected']").val();b.empty();b.append($("<option/>",{value:"-",text:app.vtranslate("None")}));if(a[e]!==undefined){$.each(a[e],function(g,i){var h={value:g,text:i};if(c==g){h.selected="selected"}b.append($("<option/>",h))})}var d=jQuery("input[name='checkboxv']").val();if(d!=undefined){b.val(d)}b.select2()},changeRelatedModule:function(c){var b=this;var a=jQuery(".form-modalAddWidget");b.loadFilters(a);b.loadCheckboxs(a)},registerEvents:function(){var a=this;this.loadWidgets();$(".WidgetsManage select[name='ModulesList']").change(function(c){var b=$(c.currentTarget);$("input[name='tabid']").val(b.val());a.reloadWidgets()});$(".WidgetsManage .addWidget").click(function(d){var c=jQuery.progressIndicator({position:"html"});var b=$(".WidgetsManage select[name='ModulesList']").val();app.showModalWindow(null,"index.php?parent=Settings&module=Widgets&view=Widget&mod="+b,function(f){c.progressIndicator({mode:"hide"});var e=jQuery("form",f);e.submit(function(h){h.preventDefault();var g=e.find('[name="type"]').val();a.createStep2(g)})})});$(".WidgetsManage .editWidget").click(function(d){var c=$(d.currentTarget);var b=c.closest(".blockSortable");app.showModalWindow(null,"index.php?parent=Settings&module=Widgets&view=Widget&mode=edit&id="+b.data("id"),function(f){jQuery("#massEditHeader.modal-title").text(app.vtranslate("JS_EDIT_WIDGET"));f.find(".HelpInfoPopover").hover(function(){$(this).popover("show")},function(){$(this).popover("hide")});if(a.getType()=="RelatedModule"){a.loadFilters(f);a.loadCheckboxs(f);f.find("select[name='relatedmodule']").change(function(){a.changeRelatedModule()})}var e=jQuery("form",f);e.submit(function(h){h.preventDefault();var g=$.progressIndicator({message:app.vtranslate("Loading data"),blockInfo:{enabled:true}});var i=e.serializeFormData();a.registerSaveEvent("saveWidget",{data:i,tabid:$("input[name='tabid']").val(),});a.reloadWidgets();app.hideModalWindow();g.progressIndicator({mode:"hide"})})})});$(".WidgetsManage .removeWidget").click(function(d){var c=$(d.currentTarget);var b=c.closest(".blockSortable");a.registerSaveEvent("removeWidget",{wid:b.data("id"),});a.reloadWidgets()})}});