
Inventory_Edit_Js("Calculations_Edit_Js",{},{recalculateMargin:function(d){var c=d.find(".listPrice").val();var b=d.find(".purchase").val();var e=c-b;var a="0";d.find(".margin").val(e);if(b!=0){a=(e/b)*100}d.find(".marginp").val(a)},recalculateAllMargin:function(){var g=parseInt(jQuery(".numberOfCurrencyDecimal").val());var d=this;var c=this.getLineItemContentsContainer();var f=0;var b=0;var e=0;c.find("tr."+this.rowClass).each(function(h,j){var i=jQuery(j);var k=parseFloat(i.find(".qty").val());f+=parseFloat(i.find(".productTotal").val())*k;b+=parseFloat(i.find(".purchase").val())*k;e+=parseFloat(i.find(".margin").val())*k});b=b.toFixed(g);jQuery(".total_purchase").text(b);e=e.toFixed(g);jQuery(".total_margin").text(e);var a=0;if(b!=0){a=(e/b)*100}a=a.toFixed(g);jQuery(".total_marginp").text(a)},registerRecalculateMargin:function(){var b=this;var a=this.getLineItemContentsContainer();a.on("focusout",".listPrice",function(f){var c=jQuery(f.currentTarget);var d=c.closest("tr."+b.rowClass);b.recalculateMargin(d);b.recalculateAllMargin()});a.on("focusout",".purchase",function(f){var c=jQuery(f.currentTarget);var d=c.closest("tr."+b.rowClass);b.recalculateMargin(d);b.recalculateAllMargin()});a.on("focusout",".listPrice",function(c){b.recalculateAllMargin()});a.on("focusout",".qty",function(c){b.recalculateAllMargin()})},getPopUpParams:function(a){var f=this._super(a);var d=jQuery('input[class="sourceField"]',a);if(d.attr("name")=="ticketid"||d.attr("name")=="potentialid"||d.attr("name")=="projectid"){var c=this.getForm();var e=c.find('[name="relatedid"]');if(e.length>0&&e.val().length>0){var b=e.closest(".fieldValue");f.related_parent_id=e.val();f.related_parent_module=b.find('[name="popupReferenceModule"]').val()}}return f},searchModuleNames:function(e){var a=jQuery.Deferred();if(typeof e.module=="undefined"){e.module=app.getModuleName()}if(typeof e.action=="undefined"){e.action="BasicAjax"}if(e.search_module=="HelpDesk"||e.search_module=="Potentials"||e.search_module=="Project"){var c=this.getForm();var d=c.find('[name="relatedid"]');if(d.length>0&&d.val().length>0){var b=d.closest(".fieldValue");e.parent_id=d.val();e.parent_module=b.find('[name="popupReferenceModule"]').val()}}else{if(e.search_module=="Products"||e.search_module=="Services"){e.potentialid=jQuery('[name="potentialid"]').val()}}AppConnector.request(e).then(function(f){a.resolve(f)},function(f){a.reject()});return a.promise()},registerQuantityChangeEventHandler:function(){var b=this;var a=this.getLineItemContentsContainer();a.on("focusout",".qty",function(f){var c=jQuery(f.currentTarget);var d=c.closest("tr."+b.rowClass);b.quantityChangeActions(d)})},calculateGrandTotal:function(){var d=parseInt(jQuery(".numberOfCurrencyDecimal").val());var b=this;var a=this.getLineItemContentsContainer();var c=0;a.find("tr."+this.rowClass).each(function(e,g){var f=jQuery(g);c+=parseFloat(f.find(".productTotal").text())});c=c.toFixed(d);jQuery('input[name="total"]').val(c);this.setGrandTotal(c)},registerAddingNewProductsAndServices:function(){var b=this;var a=this.getLineItemContentsContainer();jQuery("#addProduct").on("click",function(){var d=b.getBasicRow().addClass(b.rowClass);jQuery('.lineItemPopup[data-module-name="Services"]',d).closest("span.input-group-addon").remove();var c=b.getNextLineItemRowNumber();d=d.appendTo(a);b.checkLineItemRow();d.find("input.rowNumber").val(c);b.updateLineItemsElementWithSequenceNumber(d,c);d.find("input.productName").addClass("autoComplete");b.registerLineItemAutoComplete(d);d.find("textarea.lineItemCommentBox").addClass("ckEditorSource");b.registerEventForCkEditor()});jQuery("#addService").on("click",function(){var d=b.getBasicRow().addClass(b.rowClass);jQuery('.lineItemPopup[data-module-name="Products"]',d).closest("span.input-group-addon").remove();var c=b.getNextLineItemRowNumber();d=d.appendTo(a);b.checkLineItemRow();d.find("input.rowNumber").val(c);b.updateLineItemsElementWithSequenceNumber(d,c);d.find("input.productName").addClass("autoComplete");b.registerLineItemAutoComplete(d);d.find("textarea.lineItemCommentBox").addClass("ckEditorSource");b.registerEventForCkEditor()})},registerSubmitEvent:function(){var a=this;var b=this.getForm();this._super();b.submit(function(d){a.updateLineItemElementByOrder();var c=a.getLineItemContentsContainer();jQuery(".discountSave",c).trigger("click");a.lineItemToTalResultCalculations();a.saveProductCount();a.saveSubTotalValue();a.saveTotalValue();a.savePreTaxTotalValue()})},registerEvents:function(){this._super();this.registerQuantityChangeEventHandler();this.registerEventForCopyAddress();this.registerRecalculateMargin()}});