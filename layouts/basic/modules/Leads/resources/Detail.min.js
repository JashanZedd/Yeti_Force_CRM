
Vtiger_Detail_Js("Leads_Detail_Js",{cache:{},detailCurrentInstance:false,convertLead:function(b,c){var a=Leads_Detail_Js.detailCurrentInstance;a.convertLeadContainer=false;a.convertLeadForm=false;a.convertLeadModules=false;if(jQuery.isEmptyObject(Leads_Detail_Js.cache)){AppConnector.request(b).then(function(d){if(d){Leads_Detail_Js.cache=d;a.displayConvertLeadModel(d,c)}},function(d,e){})}else{a.displayConvertLeadModel(Leads_Detail_Js.cache,c)}}},{convertLeadForm:false,convertLeadContainer:false,convertLeadModules:false,init:function(){this._super();Leads_Detail_Js.detailCurrentInstance=this},disableConvertLeadButton:function(a){jQuery(a).attr("disabled","disabled")},enableConvertLeadButton:function(a){jQuery(a).removeAttr("disabled")},removeDisableAttr:function(a){a.find("input,textarea,select").removeAttr("disabled")},addDisableAttr:function(a){a.find("input,textarea,select").attr("disabled","disabled")},displayConvertLeadModel:function(f,h){var a=this;var b=jQuery(f).find("#convertLeadError");if(b.length!="0"){var e=b.val();var c=jQuery(f).find("#convertLeadErrorTitle").val();var g={title:c,text:e,addclass:"convertLeadNotify",width:"35%",pnotify_after_open:function(){a.disableConvertLeadButton(h)},pnotify_after_close:function(){a.enableConvertLeadButton(h)}};Vtiger_Helper_Js.showPnotify(g)}else{var d=function(k){var i=Vtiger_Edit_Js.getInstance();jQuery(k).find(".fieldInfo").collapse({parent:"#leadAccordion",toggle:false});app.showScrollBar(jQuery(k).find("#leadAccordion"),{height:"420px"});i.registerBasicEvents(k);var j=a.getConvertLeadModules();jQuery.each(j,function(l,m){a.checkingModuleSelection(m)});a.registerForReferenceField();a.registerForDisableCheckEvent();a.registerConvertLeadEvents();a.getConvertLeadForm().validationEngine(app.validationEngineOptions);a.registerConvertLeadSubmit()};app.showModalWindow(f,function(i){if(typeof d=="function"){d(i)}},{"text-align":"left"})}},checkingModuleSelection:function(d){var a=this;var c=jQuery(d).val();var b=jQuery(d).closest(".accordion-group").find("#"+c+"_FieldInfo");if(jQuery(d).is(":checked")){a.removeDisableAttr(b)}else{a.addDisableAttr(b)}},registerForReferenceField:function(){var a=this.getConvertLeadContainer();var b=jQuery(".reference",a);if(b.length>0){jQuery("#AccountsModule").attr("readonly","readonly")}},registerForDisableCheckEvent:function(){var a=this;var b=this.getConvertLeadContainer();var d=jQuery(".reference",b);var c=jQuery("#conAccMandatory").val();jQuery("#ContactsModule").on("click",function(){if((jQuery("#ContactsModule").is(":checked"))&&c){jQuery("#AccountsModule").attr({disabled:"disabled",checked:"checked"})}else{jQuery("#AccountsModule").removeAttr("disabled")}})},registerConvertLeadEvents:function(){var b=this.getConvertLeadContainer();var a=this;b.on("hidden.bs.collapse",".accordion-body",function(d){var c=jQuery(d.currentTarget);c.closest(".convertLeadModules").find(".iconArrow").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down")}).on("shown.bs.collapse",".accordion-body",function(d){var c=jQuery(d.currentTarget);c.closest(".convertLeadModules").find(".iconArrow").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up")});b.on("click",".transferModule",function(g){var f=jQuery(g.currentTarget);var d=f.val();var c=jQuery("#"+d+"_FieldInfo");if(f.is(":checked")){jQuery("#"+d+"Module").attr("checked","checked");c.collapse("show");a.removeDisableAttr(c)}});b.on("click",".convertLeadModuleSelection",function(i){var h=jQuery(i.currentTarget);var f=h.val();var d=h.closest(".accordion-group").find("#"+f+"_FieldInfo");var k=jQuery("#transfer"+f);var g=jQuery('input[name="transferModule"]').not(k);var j=jQuery(g).val();var c=jQuery("#"+j+"Module");if(h.is(":checked")){d.collapse("show");a.removeDisableAttr(d);if(!c.is(":checked")){jQuery(k).attr("checked","checked")}}else{d.collapse("hide");a.addDisableAttr(d);jQuery(k).removeAttr("checked");if(c.is(":checked")){jQuery(g).attr("checked","checked")}}i.stopImmediatePropagation()})},registerConvertLeadSubmit:function(){var b=this;var a=this.getConvertLeadForm();a.on("jqv.form.validating",function(d){var c=jQuery(d.currentTarget).data("jqv");c.InvalidFields=[]});a.on("submit",function(j){var m=b.getConvertLeadModules();var h=[];var d=a.find("#ContactsModule");var g=a.find("#AccountsModule");var k=a.data("jqv").InvalidFields;if(k.length>0){var f=k[0];var c=jQuery(f).closest("div.accordion-body");c.collapse("show");j.preventDefault();return}jQuery.each(m,function(e,n){if(jQuery(n).is(":checked")){h.push(jQuery(n).val())}});a.find('input[name="modules"]').val(JSON.stringify(h));var i=d.length;var l=g.length;if(i!="0"&&l!="0"){if(jQuery.inArray("Accounts",h)==-1&&jQuery.inArray("Contacts",h)==-1){alert(app.vtranslate("JS_SELECT_ORGANIZATION_OR_CONTACT_TO_CONVERT_LEAD"));j.preventDefault()}}else{if(l!="0"){if(jQuery.inArray("Accounts",h)==-1){alert(app.vtranslate("JS_SELECT_ORGANIZATION"));j.preventDefault()}}else{if(i!="0"){if(jQuery.inArray("Contacts",h)==-1){alert(app.vtranslate("JS_SELECT_CONTACTS"));j.preventDefault()}}}}})},getConvertLeadModules:function(){var a=this.getConvertLeadContainer();if(this.convertLeadModules==false){this.convertLeadModules=jQuery(".convertLeadModuleSelection",a)}return this.convertLeadModules},getConvertLeadForm:function(){if(this.convertLeadForm==false){this.convertLeadForm=jQuery("#convertLeadForm")}return this.convertLeadForm},getConvertLeadContainer:function(){if(this.convertLeadContainer==false){this.convertLeadContainer=jQuery("#leadAccordion")}return this.convertLeadContainer},saveFieldValues:function(c){var b=jQuery.Deferred();var e=this.getRecordId();var f={};if(typeof c!="undefined"){f=c}f.record=e;f.module=app.getModuleName();f.action="SaveAjax";AppConnector.request(f).then(function(g){b.resolve(g)});if(c.field=="leadstatus"){var d=jQuery(".btn-convertLead");var a=JSON.parse(jQuery("#conversion_available_status").val());if(a.length===0||jQuery.inArray(c.value,a)!=-1){d.removeClass("hide")}else{d.addClass("hide")}}return b.promise()},updateConvertLeadvalue:function(){var b=Vtiger_Detail_Js.getInstance();var a=b.getContentHolder();a.on(b.fieldUpdatedEvent,"input,select",function(g,i){var d=jQuery(g.currentTarget);var k=d.attr("name");var h=i["new"];if(!(jQuery.isEmptyObject(Leads_Detail_Js.cache))){var j=jQuery(Leads_Detail_Js.cache);var c=j.find('[name="'+k+'"]');if(d.is("select")){var f=c.val();c.find('option[value="'+f+'"]').removeAttr("selected");c.find('option[value="'+h+'"]').attr("selected","selected");c.trigger("chosen:updated")}else{c.attr("value",h)}Leads_Detail_Js.cache=j}})},registerEvents:function(){this._super();this.updateConvertLeadvalue()}});