
Vtiger_List_Js("Rss_List_Js",{},{getDocumentHeight:function(){return jQuery(document).height()},registerRssAddButtonClickEvent:function(){var a=this;jQuery(document).on("click",".rssAddButton",function(b){a.showRssAddForm()})},showRssAddForm:function(){var a=this;var b=jQuery.progressIndicator();a.getRssAddFormUi().then(function(e){var d=jQuery(".rssAddFormContainer").find("#rssAddFormUi");if(d.length>0){d=d.clone(true,true);b.hide();var c=function(h){var i=app.validationEngineOptions;var g=h.find("#rssAddForm");i.onValidationComplete=function(k,j){if(j){a.rssFeedSave(k)}return false};g.validationEngine(i)};var f={data:d,cb:c};app.showModalWindow(f)}})},getRssAddFormUi:function(b){var a=jQuery.Deferred();var e=jQuery(".rssAddFormContainer");var d=e.find("#rssAddFormUi");if(d.length==0){var c={module:app.getModuleName(),view:"ViewTypes",mode:"getRssAddForm"};AppConnector.request(c).then(function(f){e.html(f);a.resolve(f)},function(g,f){a.reject(g,f)})}else{a.resolve()}return a.promise()},rssFeedSave:function(b){var a=this;var c=b.serializeFormData();var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var e={module:app.getModuleName(),action:"Save",feedurl:c.feedurl};AppConnector.request(e).then(function(f){d.progressIndicator({mode:"hide"});if(f.result.success){app.hideModalWindow();a.getRssFeeds(f.result.id).then(function(){a.loadRssWidget().then(function(){var h={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate(f.result.message),animation:"show",type:"info"};Vtiger_Helper_Js.showPnotify(h)})})}else{var g={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate(f.result.message),animation:"show"};Vtiger_Helper_Js.showPnotify(g)}})},registerRssUrlClickEvent:function(){var a=this;jQuery(".quickWidgetContainer").on("click",".rssLink",function(c){var b=jQuery(c.currentTarget);var d=b.data("id");a.getRssFeeds(d)})},getRssFeeds:function(f){var c=this;var b=jQuery.Deferred();var a=c.getListViewContainer();var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var e={module:app.getModuleName(),view:"List",id:f};AppConnector.requestPjax(e).then(function(g){b.resolve(g);a.find("#listViewContents").html(g);c.setFeedContainerHeight(a);d.progressIndicator({mode:"hide"})});return b.promise()},setFeedContainerHeight:function(b){var a=this.getDocumentHeight()/1.5;b.find(".feedListContainer").height(a)},registerFeedClickEvent:function(a){var b=this;a.on("click",".feedLink",function(f){var d=jQuery(f.currentTarget);var c=d.data("url");var g=b.getFrameElement(c);a.find(".feedFrame").html(g)})},getFrameElement:function(a){var b=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var c=jQuery("<iframe>",{id:"feedFrame",scrolling:"auto",width:"100%",height:this.getDocumentHeight()/2});c.addClass("table-bordered");this.getHtml(a).then(function(d){b.progressIndicator({mode:"hide"});var e=c[0].contentDocument;e.open();e.write(d);e.close()});return c},getHtml:function(b){var a=jQuery.Deferred();var c={module:app.getModuleName(),action:"GetHtml",url:b};AppConnector.request(c).then(function(d){a.resolve(d.result.html)});return a.promise()},registerDeleteRecordClickEvent:function(){var a=this.getListViewContainer();var b=this;a.on("click","#deleteButton",function(c){b.deleteRecord(a)})},deleteRecord:function(a){var d=this;var b=a.find("#recordId").val();var c=app.vtranslate("LBL_DELETE_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:c}).then(function(i){var g=app.getModuleName();var f={module:g,action:"DeleteAjax",record:b};var j=app.vtranslate("JS_RECORD_GETTING_DELETED");var h=jQuery.progressIndicator({message:j,position:"html",blockInfo:{enabled:true}});AppConnector.request(f).then(function(e){h.progressIndicator({mode:"hide"});if(e.success){d.getRssFeeds().then(function(){d.loadRssWidget()})}else{var k={text:app.vtranslate(e.error.message),title:app.vtranslate("JS_LBL_PERMISSION")};Vtiger_Helper_Js.showPnotify(k)}},function(e,k){})},function(e,f){})},registerMakeDefaultClickEvent:function(a){var b=this;a.on("click","#makeDefaultButton",function(){b.makeDefault(a)})},makeDefault:function(b){var e=Vtiger_List_Js.getInstance();var d=b.find("#recordId").val();var c=app.getModuleName();var a={module:c,action:"MakeDefaultAjax",record:d};var f=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(a).then(function(g){f.progressIndicator({mode:"hide"});if(g.success){var h={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate(g.result.message),animation:"show",type:"info"};Vtiger_Helper_Js.showPnotify(h)}else{var h={text:app.vtranslate(g.error.message),title:app.vtranslate("JS_LBL_PERMISSION")};Vtiger_Helper_Js.showPnotify(h)}})},loadRssWidget:function(){var a=jQuery.Deferred();var c=jQuery(".widgetContainer");var b=c.data("url");AppConnector.request(b).then(function(d){a.resolve(d);c.html(d)});return a.promise()},registerEvents:function(){this._super();var a=this.getListViewContainer();this.registerRssAddButtonClickEvent();this.registerRssUrlClickEvent();this.registerFeedClickEvent(a);this.registerMakeDefaultClickEvent(a);this.setFeedContainerHeight(a)}});