
function SaveResult(){this.skipCheckData=[];this.skipCheckDataOneTime="";this.executeTaskStatus=true;this.recordValue=false;this.loadFormData=function(a){this.recordValue=a};this.checkData=function(d,c){var a=this;var f={};var e=[];var b=true;delete a.recordValue.__vtrftk;delete a.recordValue.picklistDependency;delete d.__vtrftk;delete d.picklistDependency;if(a.recordValue!=false){$.each(a.recordValue,function(g,h){d["p_"+g]=h})}f.data={module:"DataAccess",parent:"Settings",action:"ExecuteHandlers",param:d,};f.async=false;f.dataType="json";AppConnector.request(f).then(function(g){e=g.result["data"];Vtiger_Helper_Js.hidePnotify();$.each(e,function(i,h){if(jQuery.inArray(i,a.skipCheckData)!=-1||a.skipCheckDataOneTime===i){return}if(typeof h.type!="undefined"){b=a.executeTask(h,i,c)}});a.skipCheckDataOneTime=""});return b};this.executeTask=function(c,a,b){switch(c.type){case 0:this.showNotify(c.info);this.executeTaskStatus=c.save_record;break;case 1:this.showQuickCreate(c,this.executeTaskStatus,b,a);view=app.getViewName();if(view!="Detail"){this.executeTaskStatus=false}break;case 2:if(c.save_record){this.executeTaskStatus=c.save_record;break}this.showNotify(c.info,c.type,b,a);view=app.getViewName();if(view!="Detail"){this.executeTaskStatus=false}break}return this.executeTaskStatus};this.showNotify=function(e,c,d,b){var a=this;var f={text:e.text,type:"info",animation:"show",width:"auto"};if(e.ntype){f.type=e.ntype}if(typeof d!="undefined"&&c==2){f.confirm={confirm:true,buttons:[{text:app.vtranslate("JS_OK"),addClass:"btn-primary saveButton",click:function(g){a.skipCheckData.push(b);g.remove();d.submit()}},{addClass:"hide",}]};f.buttons={closer:false,sticker:false};f.history={history:false};f.before_open=function(g){setTimeout(function(){g.get().find(".saveButton").trigger("click")},10000)}}f=jQuery.extend(e,f);Vtiger_Helper_Js.showPnotify(f)};this.showQuickCreate=function(g,k,d,l){var m=this;var b=g.module;var j=jQuery('input[name="record"]').val();if(j==undefined){j=jQuery("#recordId").val()}var h=jQuery('input[name="module"]').val();var o=function(r){var p,q,s;if(b=="Calendar"){jQuery('<input type="hidden" name="parent_id" value="'+j+'">').appendTo(r)}if(h=="HelpDesk"){jQuery('<input type="hidden" name="ticketid" value="'+j+'">').appendTo(r)}if(h=="ProjectTask"){jQuery('<input type="hidden" name="projecttaskid" value="'+j+'">').appendTo(r)}if(h=="Potentials"){jQuery('<input type="hidden" name="potentialid" value="'+j+'">').appendTo(r)}jQuery('<input type="hidden" name="sourceModule" value="'+h+'" />').appendTo(r);jQuery('<input type="hidden" name="sourceRecord" value="'+j+'" />').appendTo(r);jQuery('<input type="hidden" name="relationOperation" value="true" />').appendTo(r)};var c=function(p){if(typeof d!="undefined"){m.skipCheckData.push(l);d.submit()}};var e={};var f={};var n="index.php?module="+b+"&view=QuickCreateAjax";f.sourceModule=h;f.sourceRecord=j;f.relationOperation=true;if((app.getViewName()=="Detail"||app.getViewName()=="Edit")&&b=="OSSTimeControl"){if(g.title){f.name=g.title}else{f.name=jQuery(".recordLabel").attr("title")}}e.callbackFunction=c;e.callbackPostShown=o;e.data=f;e.noCache=true;var a=jQuery.progressIndicator();var i=new Vtiger_Header_Js();i.getQuickCreateForm(n,b,e).then(function(p){i.handleQuickCreateData(p,e);a.progressIndicator({mode:"hide"});jQuery('form[name="QuickCreate"]').closest(".modal").on("click",".cancelLinkContainer,.close",function(q){if(typeof d!="undefined"){m.skipCheckDataOneTime=l;d.submit()}})})}};