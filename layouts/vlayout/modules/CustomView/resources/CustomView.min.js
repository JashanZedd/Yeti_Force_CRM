
var Vtiger_CustomView_Js={contentsCotainer:false,columnListSelect2Element:false,advanceFilterInstance:false,columnSelectElement:false,selectedColumnsList:false,loadFilterView:function(a){var b=jQuery.progressIndicator();AppConnector.request(a).then(function(d){app.hideModalWindow();var c=jQuery(".contentsDiv").html(d);b.progressIndicator({mode:"hide"});Vtiger_CustomView_Js.registerEvents();Vtiger_CustomView_Js.advanceFilterInstance=Vtiger_AdvanceFilter_Js.getInstance(jQuery(".filterContainer",c))},function(c,d){})},loadDateFilterValues:function(){var c=jQuery("#standardDateFilter option:selected");var a=c.data("currentdate");var b=c.data("enddate");jQuery("#standardFilterCurrentDate").val(a);jQuery("#standardFilterEndDate").val(b)},getContentsContainer:function(){if(Vtiger_CustomView_Js.contentsCotainer==false){Vtiger_CustomView_Js.contentsCotainer=jQuery("div.contentsDiv")}return Vtiger_CustomView_Js.contentsCotainer},getColumnListSelect2Element:function(){return Vtiger_CustomView_Js.columnListSelect2Element},getColumnSelectElement:function(){if(Vtiger_CustomView_Js.columnSelectElement==false){Vtiger_CustomView_Js.columnSelectElement=jQuery("#viewColumnsSelect")}return Vtiger_CustomView_Js.columnSelectElement},getSelectedColumnsList:function(){if(Vtiger_CustomView_Js.selectedColumnsList==false){Vtiger_CustomView_Js.selectedColumnsList=jQuery("#selectedColumnsList")}return Vtiger_CustomView_Js.selectedColumnsList},getSelectedColumns:function(){var a=Vtiger_CustomView_Js.getColumnSelectElement();return a.val()},saveFilter:function(){var a=jQuery.Deferred();var c=jQuery("#CustomView");var d=c.serializeFormData();var b=jQuery.progressIndicator({blockInfo:{enabled:true}});AppConnector.request(d).then(function(e){b.progressIndicator({mode:"hide"});a.resolve(e)},function(e){b.progressIndicator({mode:"hide"});a.reject(e)});return a.promise()},saveAndViewFilter:function(){Vtiger_CustomView_Js.saveFilter().then(function(a){if(a.success){if(app.getParentModuleName()=="Settings"){var b="index.php?module=CustomView&parent=Settings&view=Index"}else{var b=a.result["listviewurl"]}window.location.href=b}else{var c={title:app.vtranslate("JS_DUPLICATE_RECORD"),text:a.error.message};Vtiger_Helper_Js.showPnotify(c)}},function(a){})},registerSelect2ElementForColumnsSelection:function(){var a=Vtiger_CustomView_Js.getColumnSelectElement();return app.changeSelectElementView(a,"selectize",{plugins:["drag_drop","remove_button"],maxItems:12})},registerEvents:function(){var c=Vtiger_CustomView_Js.columnListSelect2Element=Vtiger_CustomView_Js.registerSelect2ElementForColumnsSelection();var a=Vtiger_CustomView_Js.getContentsContainer();jQuery(".stndrdFilterDateSelect").datepicker();jQuery(".chzn-select").chosen();var b=c[0].selectize;var d=JSON.parse(jQuery('input[name="columnslist"]').val());b.clear();for(i in d){b.addItem(d[i])}jQuery("#standardDateFilter").change(function(){Vtiger_CustomView_Js.loadDateFilterValues()});jQuery("#CustomView").submit(function(l){var k=Vtiger_CustomView_Js.getColumnSelectElement();if(jQuery("#viewname").val().length>40){var h={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_VIEWNAME_ALERT")};Vtiger_Helper_Js.showPnotify(h);l.preventDefault();return}var n=JSON.parse(jQuery("#mandatoryFieldsList").val());var g=k.val();var m=true;for(var j=0;j<g.length;j++){if(jQuery.inArray(g[j],n)>=0){m=false;break}}if(m){var p=app.vtranslate("JS_PLEASE_SELECT_ATLEAST_ONE_MANDATORY_FIELD");c.validationEngine("showPrompt",p,"error","topLeft",true);l.preventDefault();return}else{c.validationEngine("hide")}var p=jQuery(l.currentTarget).validationEngine("validate");if(p==true){var o={};if((jQuery("#standardFilterCurrentDate").val()!="")&&(jQuery("#standardFilterEndDate").val()!="")&&(jQuery("select.standardFilterColumn option:selected").val()!="none")){o.columnname=jQuery("select.standardFilterColumn option:selected").val();o.stdfilter=jQuery("select#standardDateFilter option:selected").val();o.startdate=jQuery("#standardFilterCurrentDate").val();o.enddate=jQuery("#standardFilterEndDate").val();jQuery("#stdfilterlist").val(JSON.stringify(o))}var f=Vtiger_CustomView_Js.advanceFilterInstance.getValues();jQuery("#advfilterlist").val(JSON.stringify(f));jQuery('input[name="columnslist"]',a).val(JSON.stringify(Vtiger_CustomView_Js.getSelectedColumns()));Vtiger_CustomView_Js.saveAndViewFilter();return false}else{app.formAlignmentAfterValidation(jQuery(l.currentTarget))}});jQuery("#CustomView").validationEngine(app.validationEngineOptions)}};