
Vtiger_List_Js("Settings_Users_List_Js",{deleteRecord:function(b){var a=app.vtranslate("LBL_DELETE_USER_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:a}).then(function(c){AppConnector.request(b).then(function(d){if(d){var e=function(f){var g=app.validationEngineOptions;g.onValidationComplete=function(i,h){if(h){Settings_Users_List_Js.deleteUser(i)}return false};jQuery("#deleteUser").validationEngine(app.validationEngineOptions)};app.showModalWindow(d,function(f){if(typeof e=="function"){e(f)}})}})},function(c,d){})},deleteUser:function(c){var a=c.find('[name="userid"]').val();var b=c.find('[name="tranfer_owner_id"]').val();var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var e={module:app.getModuleName(),action:"DeleteAjax",transfer_user_id:b,userid:a,permanent:jQuery('[name="deleteUserPermanent"]:checked',c).val()};AppConnector.request(e).then(function(f){if(f.success){app.hideModalWindow();d.progressIndicator({mode:"hide"});e={title:app.vtranslate("JS_MESSAGE"),text:f.result.message,animation:"show",type:"success"};Vtiger_Helper_Js.showPnotify(e);jQuery("[data-id="+a+"]").hide()}})},deleteUserPermanently:function(a,d){d.stopPropagation();var c=app.vtranslate("LBL_DELETE_USER_PERMANENT_CONFIRMATION");var b="index.php?module="+app.getModuleName()+"&parent="+app.getParentModuleName()+"&view=DeleteUser&mode=permanent&record="+a;Vtiger_Helper_Js.showConfirmationBox({message:c}).then(function(e){AppConnector.request(b).then(function(f){if(f){var g=function(h){var i=app.validationEngineOptions;i.onValidationComplete=function(k,j){if(j){var l=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var m={module:app.getModuleName(),action:"DeleteAjax",userid:a,transfer_user_id:k.find('[name="tranfer_owner_id"]').val(),mode:"permanent"};app.hideModalWindow();AppConnector.request(m).then(function(n){if(n.success){l.progressIndicator({mode:"hide"});m={title:app.vtranslate("JS_MESSAGE"),text:n.result.message,animation:"show",type:"error"};Vtiger_Helper_Js.showPnotify(m);jQuery("[data-id="+a+"]").hide()}})}return false};jQuery("#deleteUser").validationEngine(app.validationEngineOptions)};app.showModalWindow(f,function(h){if(typeof g=="function"){g(h)}})}})})},restoreUser:function(a,b){b.stopPropagation();Vtiger_Helper_Js.showConfirmationBox({message:app.vtranslate("LBL_RESTORE_CONFIRMATION")}).then(function(){var c=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var d={module:app.getModuleName(),action:"SaveAjax",userid:a,mode:"restoreUser"};AppConnector.request(d).then(function(e){if(e.success){c.progressIndicator({mode:"hide"});Vtiger_Helper_Js.showPnotify(e.result.message);var f=e.result.listViewUrl;window.location.href=f}})})},triggerExportAction:function(){var a=window.location.href;var c=a.split("?");var b=jQuery("<form>",{method:"post",action:c[0]+"?module=Users&source_module=Users&action=ExportData"}).append(jQuery("<input>",{name:csrfMagicName,value:csrfMagicToken,type:"hidden"}));jQuery(b).appendTo("body")[0].submit()},triggerEditPasswords:function(a,d){var f=this;var e=Vtiger_List_Js.getInstance();var c=this.getSelectedRecordCount();if(parseInt(c)==0||typeof c=="undefined"){alert(app.vtranslate("JS_PLEASE_SELECT_ONE_RECORD"));return false}var b=e.readSelectedIds(true);AppConnector.request(a+"&userids="+b).then(function(g){if(g){var h=function(i){var j=app.validationEngineOptions;j.onValidationComplete=function(l,k){if(k){f.editPasswords(l)}return false};jQuery("#changePassword").validationEngine(app.validationEngineOptions)};app.showModalWindow(g,function(i){if(typeof h=="function"){h(i)}})}})},editPasswords:function(c){var e=c.find('[name="new_password"]');var b=c.find('[name="confirm_password"]');var a=c.find('[name="userids"]').val();if(e.val()==b.val()){var d={module:app.getModuleName(),action:"SaveAjax",mode:"editPasswords",new_password:e.val(),userids:a};AppConnector.request(d).then(function(f){if(f.success){app.hideModalWindow();Vtiger_Helper_Js.showPnotify(app.vtranslate(f.result.message))}else{Vtiger_Helper_Js.showPnotify(f.error.message);return false}})}else{e.validationEngine("showPrompt",app.vtranslate("JS_REENTER_PASSWORDS"),"error","topLeft",true);return false}}},{getPageJumpParams:function(){var c=app.getModuleName();var b=this.getCurrentCvId();var a={module:c,view:"ListAjax",mode:"getPageCount",search_key:"status",operator:"e",search_value:jQuery("#usersFilter").val()};return a},registerDeleteRecordClickEvent:function(){var a=this.getListViewContentContainer();a.on("click",".deleteRecordButton",function(d){var c=jQuery(d.currentTarget);var b=c.closest("tr");var f=jQuery('[name="deleteActionUrl"]',b).val();Settings_Users_List_Js.deleteRecord(f);d.stopPropagation()})},usersFilter:function(){var a=this;jQuery("#usersFilter").change(function(){var b=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var c={module:app.getModuleName(),view:"List",parent:app.getParentModuleName(),search_key:"status",operator:"e",search_value:jQuery("#usersFilter").val()};AppConnector.request(c).then(function(d){b.progressIndicator({mode:"hide"});jQuery("#listViewContents").html(d);a.updatePagination();a.registerListViewSelect();app.showSelect2ElementView(jQuery("#listViewContents").find("select.select2"))})})},registerEvents:function(){this._super();this.usersFilter()}});