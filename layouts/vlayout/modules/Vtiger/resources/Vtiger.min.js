
var Vtiger_Index_Js={showEmailPreview:function(a,d){var b=Vtiger_Popup_Js.getInstance();var c={};c.module="Emails";c.view="ComposeEmail";c.mode="emailPreview";c.record=a;c.parentId=d;c.relatedLoad=true;b.show(c)},registerWidgetsEvents:function(){var a=jQuery("div.widgetContainer");a.on("shown.bs.collapse",function(d){var c=jQuery(d.currentTarget);Vtiger_Index_Js.loadWidgets(c);var b=c.attr("id");app.cacheSet(b,1)});a.on("hidden.bs.collapse",function(g){var d=jQuery(g.currentTarget);var f=d.parent().find(".imageElement");var b=f.data("rightimage");f.attr("src",b);var c=d.attr("id");app.cacheSet(c,0)})},loadWidgets:function(e,c){var d=jQuery(".loadingWidgetMsg").html();if(e.find(".panel-body").html()!=""){var f=e.parent().find(".imageElement");var a=f.data("downimage");f.attr("src",a);e.css("height","auto");return}e.progressIndicator({message:d});var b=e.data("url");var g={type:"GET",url:"index.php",dataType:"html",data:b};AppConnector.request(g).then(function(k){if(typeof c=="undefined"){c=true}if(c){e.progressIndicator({mode:"hide"});var j=e.parent().find(".imageElement");var h=j.data("downimage");j.attr("src",h);e.css("height","auto")}e.html(k);var i=e.closest(".quickWidget").find(".quickWidgetHeader").data("label");jQuery(".bodyContents").trigger("Vtiger.Widget.Load."+i,jQuery(e))})},loadWidgetsOnLoad:function(){var a=jQuery("div.widgetContainer");a.each(function(c,e){var f=jQuery(e);var d=f.attr("id");var h=app.cacheGet(d);if(h!=null){if(h==1){Vtiger_Index_Js.loadWidgets(f);f.addClass("in")}else{var g=f.parent().find(".imageElement");var b=g.data("rightimage");g.attr("src",b)}}})},changeSkin:function(){jQuery(".themeElement").on("click",function(b){b.stopPropagation();var a=jQuery(b.currentTarget);a.closest("#themeContainer").hide();var d=jQuery("#progressDiv");d.progressIndicator();var c={module:"Users",action:"SaveAjax",record:jQuery("#current_user_id").val(),field:"theme",value:a.data("skinName")};AppConnector.request(c).then(function(e){if(e.success&&e.result){d.progressIndicator({mode:"hide"});jQuery(".settingIcons").removeClass("open");window.location.reload()}},function(e,f){})})},showComposeEmailPopup:function(c,a){var b="Emails";Vtiger_Helper_Js.checkServerConfig(b).then(function(e){if(e==true){var d=jQuery.extend({"text-align":"left"},d);AppConnector.request(c).then(function(i){var m=[];if(i){i=jQuery(i);var h=i.find("#SendEmailFormStep1");var g=h.find(".emailField");var f=g.length;var l=new Emails_MassEdit_Js();if(f>1){app.showModalWindow(i,function(n){l.registerEmailFieldSelectionEvent();if(jQuery("#multiEmailContainer").height()>300){jQuery("#multiEmailContainer").slimScroll({height:"300px",railVisible:true,alwaysVisible:true,size:"6px"})}},d)}else{g.attr("checked","checked");var k=h.serializeFormData();var j=l.showComposeEmailForm(k);m.push(j)}}if(typeof a=="function"){a.apply(null,m)}},function(f,g){})}else{Vtiger_Helper_Js.showPnotify(app.vtranslate("JS_EMAIL_SERVER_CONFIGURATION"))}})},registerActivityReminder:function(){var a=jQuery("#activityReminder").val();if(a!=""){a=a*1000;var c=new Date().getTime();var b=app.cacheGet("nextActivityReminderCheckTime",0);if((c+a)>b){Vtiger_Index_Js.requestReminder(true);setTimeout("Vtiger_Index_Js.requestReminder()",a);app.cacheSet("nextActivityReminderCheckTime",c+parseInt(a))}}},requestReminder:function(a){var d=this;var c=$(".remindersNoticeContainer");var b="index.php?module=Calendar&view=Reminders";if(a){b+="&type_remainder=true"}AppConnector.request(b).then(function(e){c.append(e);d.refreshNumberNotifications(c);c.find(".reminderAccept").on("click",function(i){var h=jQuery(i.currentTarget);var g=h.closest(".panel").data("record");var f="index.php?module=Calendar&action=ActivityReminder&mode=cancelReminder&record="+g;AppConnector.request(f).then(function(j){h.closest(".panel").fadeOut(300,function(){$(this).remove();d.refreshNumberNotifications(c)})})});c.find(".reminderPostpone").on("click",function(i){var h=jQuery(i.currentTarget);var g=h.closest(".panel").data("record");var f="index.php?module=Calendar&action=ActivityReminder&mode=postpone&record="+g+"&time="+h.data("time");AppConnector.request(f).then(function(j){h.closest(".panel").fadeOut(300,function(){$(this).remove();d.refreshNumberNotifications(c)})})})})},refreshNumberNotifications:function(c){var a=$(".remindersNotice .badge");var b=c.find(".panel:visible").length;a.text(b);a.removeClass("hide");if(b>0){$(".remindersNotice").effect("pulsate",1500)}else{a.addClass("hide")}},registerResizeEvent:function(){$(window).resize(function(){if(this.resizeTO){clearTimeout(this.resizeTO)}this.resizeTO=setTimeout(function(){$(this).trigger("resizeEnd")},600)});$(window).bind("resizeEnd",function(){Vtiger_Index_Js.adjustTopMenuBarItems()})},adjustTopMenuBarItems:function(){var g=125;var f=($(window).outerWidth()<1161)?jQuery("#mediumNav"):jQuery("#largeNav");var b=f.parent().outerWidth();var h=jQuery(".opttabs",f),d=h.length;var a=d;function e(){var j=(a>0)?h[a-1]:null;if(j){j=jQuery(j);j.hide();a--}return j}var c=false;do{if((b-f.outerWidth())<g){var i=e();if(i==null||(b-f.outerWidth())>g){if(i){i.hide()}c=true;break}}else{c=true;break}}while(!c);jQuery(window).load(function(){jQuery("#topMenus").css({overflow:"visible"})})},registerTooltipEvents:function(){var c=jQuery.merge(jQuery('[data-field-type="reference"] > a'),jQuery('[data-field-type="multireference"] > a'));var e=[];var b=true;function h(){a();var k=jQuery(this);var j=k.attr("href")?k.attr("href"):"";if(j==""){return}j=j.replace("view=","xview=")+"&view=TooltipAjax";var i=b?jQuery('[data-url-cached="'+j+'"]'):null;if(i&&i.length){g(k,i.html())}else{AppConnector.request(j).then(function(l){i=jQuery("<div>").css({display:"none"}).attr("data-url-cached",j);i.html(l);jQuery("body").append(i);g(k,l)})}}function d(k){var j=window.innerWidth;var i=jQuery(k).offset().left;if(j-i>400){return"right"}return"left"}function g(j,k){var i=d(j);j.popover({trigger:"manual",content:k,animation:false,html:true,placement:i,template:'<div class="popover popover-tooltip"><div class="arrow"></div><div class="popover-inner"><button name="vtTooltipClose" class="close" style="color:white;opacity:1;font-weight:lighter;position:relative;top:3px;right:3px;">x</button><h3 class="popover-title"></h3><div class="popover-content"><div></div></div></div></div>'});e.push(j.popover("show"));f()}function a(){var i=null;while(i=e.pop()){i.popover("hide")}}c.each(function(i,j){jQuery(j).hoverIntent({interval:100,sensitivity:7,timeout:10,over:h,out:a})});function f(){jQuery('button[name="vtTooltipClose"]').on("click",function(j){var i=e.pop();i.popover("hide")})}},registerShowHideLeftPanelEvent:function(){jQuery("#toggleButton").click(function(f){f.preventDefault();var c=jQuery("#leftPanel");var a=jQuery("#centerPanel");var d=document.getElementById("rightPanel");var h=jQuery("#tButtonImage");if(c.attr("class").indexOf(" hide")==-1){var b=1;c.addClass("hide");if(d&&jQuery(d).attr("class").indexOf("hide")==-1){a.removeClass("col-md-8").addClass("col-md-10")}else{a.removeClass("col-md-10").addClass("col-md-12")}h.removeClass("glyphicon-chevron-left").addClass("glyphicon-chevron-right")}else{var b=0;c.removeClass("hide");if(d&&jQuery(d).attr("class").indexOf("hide")==-1){a.removeClass("col-md-10").addClass("col-md-8")}else{a.removeClass("col-md-12").addClass("col-md-10")}h.removeClass("glyphicon-chevron-right").addClass("glyphicon-chevron-left")}var g={module:"Users",action:"IndexAjax",mode:"toggleLeftPanel",showPanel:b};AppConnector.request(g)})},registerShowHideRightPanelEvent:function(){jQuery("#toggleRightPanelButton").click(function(f){f.preventDefault();var c=jQuery("#leftPanel");var b=jQuery("#centerPanel");var d=jQuery("#rightPanel");var g=jQuery("#tRightPanelButtonImage");var a=c.attr("class").indexOf(" hide");if(d.attr("class").indexOf("hide")==-1){d.addClass("hide");if(a==-1){b.removeClass("col-md-8").addClass("col-md-10")}else{b.removeClass("col-md-10").addClass("col-md-12")}g.removeClass("glyphicon-chevron-right").addClass("glyphicon-chevron-left")}else{d.removeClass("hide");if(a==-1){b.removeClass("col-md-10").addClass("col-md-8")}else{b.removeClass("col-md-12").addClass("col-md-10")}g.removeClass("glyphicon-chevron-left").addClass("glyphicon-chevron-right")}})},loadPreSaveRecord:function(a){SaveResult=new SaveResult();return SaveResult.checkData(a)},registerEvents:function(){Vtiger_Index_Js.registerWidgetsEvents();Vtiger_Index_Js.loadWidgetsOnLoad();Vtiger_Index_Js.registerActivityReminder();Vtiger_Index_Js.adjustTopMenuBarItems();Vtiger_Index_Js.registerPostAjaxEvents();Vtiger_Index_Js.changeSkin();Vtiger_Index_Js.registerShowHideLeftPanelEvent();Vtiger_Index_Js.registerShowHideRightPanelEvent();Vtiger_Index_Js.registerResizeEvent()},registerPostAjaxEvents:function(){Vtiger_Index_Js.registerTooltipEvents()}};jQuery(document).ready(function(){Vtiger_Index_Js.registerEvents();app.listenPostAjaxReady(function(){Vtiger_Index_Js.registerPostAjaxEvents()})});