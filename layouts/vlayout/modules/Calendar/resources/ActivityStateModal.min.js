
jQuery.Class("Calendar_ActivityStateModal_Js",{},{registerActivityState:function(){var a=this;jQuery("#activityStateModal button:not(.close)").on("click",function(h){var g=jQuery(h.currentTarget);g.closest(".modal").addClass("hide");if(a.saveResultInstance==undefined){a.saveResultInstance=new SaveResult()}if(g.data("type")=="1"){a.updateActivityState(g)}var f=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var d="Calendar";var c="index.php?module=Calendar&view=QuickCreateAjax&sourceModule=Calendar&sourceRecord="+g.data("id");var i={};i.noCache=true;var b=Vtiger_Header_Js.getInstance();b.getQuickCreateForm(c,d,i).then(function(e){f.progressIndicator({mode:"hide"});b.handleQuickCreateData(e,{callbackFunction:function(j){if(j&&j.success&&g.data("type")=="0"){a.updateActivityState(g)}var k={};k.record=g.data("id");k.module="Calendar";k.view="quick_edit";k.activitystatus=g.data("state");a.saveResultInstance.checkData(k)}})})})},updateActivityState:function(c){var a=this;var d={module:"Calendar",action:"ActivityStateAjax",record:c.data("id"),state:c.data("state")};app.hideModalWindow();var b=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(d).then(function(j){if(j.success){var k=app.getViewName();if(k==="Detail"){var i=jQuery(".activityWidgetContainer .widgetContentBlock");var h=Vtiger_Detail_Js.getInstance();if(i.length){h.loadWidget(i)}else{var f=h.getTabByLabel(h.detailViewRecentActivitiesTabLabel);if(f){f.trigger("click")}if(app.getModuleName()=="Calendar"){f=((!h.getSelectedTab().length||h.getSelectedTab().data("linkKey")==h.detailViewDetailsTabLabel)?h.getTabContainer().find('[data-link-key="'+h.detailViewDetailsTabLabel+'"]'):jQuery("<div></div>"));jQuery(".showModal.closeCalendarRekord").addClass("hide");f.trigger("click")}}}if(k=="List"){var g=new Vtiger_List_Js();g.getListViewRecords()}if(k=="DashBoard"){var e=new Vtiger_DashBoard_Js();e.getContainer().find('a[name="drefresh"]').trigger("click")}if(app.getModuleName()=="Calendar"&&k=="Calendar"){var e=Calendar_CalendarView_Js.getInstanceByView();e.loadCalendarData()}Vtiger_Index_Js.requestReminder();b.progressIndicator({mode:"hide"})}else{return false}})},registerEvents:function(){this.registerActivityState()}});jQuery(document).ready(function(b){var a=new Calendar_ActivityStateModal_Js();a.registerEvents()});